var e5=Object.defineProperty;var t5=(t,e,n)=>e in t?e5(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var qo=(t,e,n)=>t5(t,typeof e!="symbol"?e+"":e,n);function n5(t,e){for(var n=0;n<e.length;n++){const s=e[n];if(typeof s!="string"&&!Array.isArray(s)){for(const o in s)if(o!=="default"&&!(o in t)){const r=Object.getOwnPropertyDescriptor(s,o);r&&Object.defineProperty(t,o,r.get?r:{enumerable:!0,get:()=>s[o]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();function Cx(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function s5(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if(typeof e=="function"){var n=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(s){var o=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(n,s,o.get?o:{enumerable:!0,get:function(){return t[s]}})}),n}var pC={exports:{}},Nh={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var VD;function o5(){if(VD)return Nh;VD=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(s,o,r){var i=null;if(r!==void 0&&(i=""+r),o.key!==void 0&&(i=""+o.key),"key"in o){r={};for(var a in o)a!=="key"&&(r[a]=o[a])}else r=o;return o=r.ref,{$$typeof:t,type:s,key:i,ref:o!==void 0?o:null,props:r}}return Nh.Fragment=e,Nh.jsx=n,Nh.jsxs=n,Nh}var zD;function r5(){return zD||(zD=1,pC.exports=o5()),pC.exports}var U=r5(),mC={exports:{}},tt={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var BD;function i5(){if(BD)return tt;BD=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),r=Symbol.for("react.consumer"),i=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),h=Symbol.iterator;function p(B){return B===null||typeof B!="object"?null:(B=h&&B[h]||B["@@iterator"],typeof B=="function"?B:null)}var x={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},b=Object.assign,w={};function C(B,X,ie){this.props=B,this.context=X,this.refs=w,this.updater=ie||x}C.prototype.isReactComponent={},C.prototype.setState=function(B,X){if(typeof B!="object"&&typeof B!="function"&&B!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,B,X,"setState")},C.prototype.forceUpdate=function(B){this.updater.enqueueForceUpdate(this,B,"forceUpdate")};function T(){}T.prototype=C.prototype;function N(B,X,ie){this.props=B,this.context=X,this.refs=w,this.updater=ie||x}var I=N.prototype=new T;I.constructor=N,b(I,C.prototype),I.isPureReactComponent=!0;var k=Array.isArray,A={H:null,A:null,T:null,S:null,V:null},$=Object.prototype.hasOwnProperty;function M(B,X,ie,re,ye,ve){return ie=ve.ref,{$$typeof:t,type:B,key:X,ref:ie!==void 0?ie:null,props:ve}}function O(B,X){return M(B.type,X,void 0,void 0,void 0,B.props)}function F(B){return typeof B=="object"&&B!==null&&B.$$typeof===t}function P(B){var X={"=":"=0",":":"=2"};return"$"+B.replace(/[=:]/g,function(ie){return X[ie]})}var D=/\/+/g;function H(B,X){return typeof B=="object"&&B!==null&&B.key!=null?P(""+B.key):X.toString(36)}function Z(){}function ne(B){switch(B.status){case"fulfilled":return B.value;case"rejected":throw B.reason;default:switch(typeof B.status=="string"?B.then(Z,Z):(B.status="pending",B.then(function(X){B.status==="pending"&&(B.status="fulfilled",B.value=X)},function(X){B.status==="pending"&&(B.status="rejected",B.reason=X)})),B.status){case"fulfilled":return B.value;case"rejected":throw B.reason}}throw B}function Q(B,X,ie,re,ye){var ve=typeof B;(ve==="undefined"||ve==="boolean")&&(B=null);var be=!1;if(B===null)be=!0;else switch(ve){case"bigint":case"string":case"number":be=!0;break;case"object":switch(B.$$typeof){case t:case e:be=!0;break;case d:return be=B._init,Q(be(B._payload),X,ie,re,ye)}}if(be)return ye=ye(B),be=re===""?"."+H(B,0):re,k(ye)?(ie="",be!=null&&(ie=be.replace(D,"$&/")+"/"),Q(ye,X,ie,"",function(De){return De})):ye!=null&&(F(ye)&&(ye=O(ye,ie+(ye.key==null||B&&B.key===ye.key?"":(""+ye.key).replace(D,"$&/")+"/")+be)),X.push(ye)),1;be=0;var Re=re===""?".":re+":";if(k(B))for(var Ae=0;Ae<B.length;Ae++)re=B[Ae],ve=Re+H(re,Ae),be+=Q(re,X,ie,ve,ye);else if(Ae=p(B),typeof Ae=="function")for(B=Ae.call(B),Ae=0;!(re=B.next()).done;)re=re.value,ve=Re+H(re,Ae++),be+=Q(re,X,ie,ve,ye);else if(ve==="object"){if(typeof B.then=="function")return Q(ne(B),X,ie,re,ye);throw X=String(B),Error("Objects are not valid as a React child (found: "+(X==="[object Object]"?"object with keys {"+Object.keys(B).join(", ")+"}":X)+"). If you meant to render a collection of children, use an array instead.")}return be}function G(B,X,ie){if(B==null)return B;var re=[],ye=0;return Q(B,re,"","",function(ve){return X.call(ie,ve,ye++)}),re}function q(B){if(B._status===-1){var X=B._result;X=X(),X.then(function(ie){(B._status===0||B._status===-1)&&(B._status=1,B._result=ie)},function(ie){(B._status===0||B._status===-1)&&(B._status=2,B._result=ie)}),B._status===-1&&(B._status=0,B._result=X)}if(B._status===1)return B._result.default;throw B._result}var J=typeof reportError=="function"?reportError:function(B){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var X=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof B=="object"&&B!==null&&typeof B.message=="string"?String(B.message):String(B),error:B});if(!window.dispatchEvent(X))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",B);return}console.error(B)};function oe(){}return tt.Children={map:G,forEach:function(B,X,ie){G(B,function(){X.apply(this,arguments)},ie)},count:function(B){var X=0;return G(B,function(){X++}),X},toArray:function(B){return G(B,function(X){return X})||[]},only:function(B){if(!F(B))throw Error("React.Children.only expected to receive a single React element child.");return B}},tt.Component=C,tt.Fragment=n,tt.Profiler=o,tt.PureComponent=N,tt.StrictMode=s,tt.Suspense=l,tt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=A,tt.__COMPILER_RUNTIME={__proto__:null,c:function(B){return A.H.useMemoCache(B)}},tt.cache=function(B){return function(){return B.apply(null,arguments)}},tt.cloneElement=function(B,X,ie){if(B==null)throw Error("The argument must be a React element, but you passed "+B+".");var re=b({},B.props),ye=B.key,ve=void 0;if(X!=null)for(be in X.ref!==void 0&&(ve=void 0),X.key!==void 0&&(ye=""+X.key),X)!$.call(X,be)||be==="key"||be==="__self"||be==="__source"||be==="ref"&&X.ref===void 0||(re[be]=X[be]);var be=arguments.length-2;if(be===1)re.children=ie;else if(1<be){for(var Re=Array(be),Ae=0;Ae<be;Ae++)Re[Ae]=arguments[Ae+2];re.children=Re}return M(B.type,ye,void 0,void 0,ve,re)},tt.createContext=function(B){return B={$$typeof:i,_currentValue:B,_currentValue2:B,_threadCount:0,Provider:null,Consumer:null},B.Provider=B,B.Consumer={$$typeof:r,_context:B},B},tt.createElement=function(B,X,ie){var re,ye={},ve=null;if(X!=null)for(re in X.key!==void 0&&(ve=""+X.key),X)$.call(X,re)&&re!=="key"&&re!=="__self"&&re!=="__source"&&(ye[re]=X[re]);var be=arguments.length-2;if(be===1)ye.children=ie;else if(1<be){for(var Re=Array(be),Ae=0;Ae<be;Ae++)Re[Ae]=arguments[Ae+2];ye.children=Re}if(B&&B.defaultProps)for(re in be=B.defaultProps,be)ye[re]===void 0&&(ye[re]=be[re]);return M(B,ve,void 0,void 0,null,ye)},tt.createRef=function(){return{current:null}},tt.forwardRef=function(B){return{$$typeof:a,render:B}},tt.isValidElement=F,tt.lazy=function(B){return{$$typeof:d,_payload:{_status:-1,_result:B},_init:q}},tt.memo=function(B,X){return{$$typeof:u,type:B,compare:X===void 0?null:X}},tt.startTransition=function(B){var X=A.T,ie={};A.T=ie;try{var re=B(),ye=A.S;ye!==null&&ye(ie,re),typeof re=="object"&&re!==null&&typeof re.then=="function"&&re.then(oe,J)}catch(ve){J(ve)}finally{A.T=X}},tt.unstable_useCacheRefresh=function(){return A.H.useCacheRefresh()},tt.use=function(B){return A.H.use(B)},tt.useActionState=function(B,X,ie){return A.H.useActionState(B,X,ie)},tt.useCallback=function(B,X){return A.H.useCallback(B,X)},tt.useContext=function(B){return A.H.useContext(B)},tt.useDebugValue=function(){},tt.useDeferredValue=function(B,X){return A.H.useDeferredValue(B,X)},tt.useEffect=function(B,X,ie){var re=A.H;if(typeof ie=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return re.useEffect(B,X)},tt.useId=function(){return A.H.useId()},tt.useImperativeHandle=function(B,X,ie){return A.H.useImperativeHandle(B,X,ie)},tt.useInsertionEffect=function(B,X){return A.H.useInsertionEffect(B,X)},tt.useLayoutEffect=function(B,X){return A.H.useLayoutEffect(B,X)},tt.useMemo=function(B,X){return A.H.useMemo(B,X)},tt.useOptimistic=function(B,X){return A.H.useOptimistic(B,X)},tt.useReducer=function(B,X,ie){return A.H.useReducer(B,X,ie)},tt.useRef=function(B){return A.H.useRef(B)},tt.useState=function(B){return A.H.useState(B)},tt.useSyncExternalStore=function(B,X,ie){return A.H.useSyncExternalStore(B,X,ie)},tt.useTransition=function(){return A.H.useTransition()},tt.version="19.1.1",tt}var UD;function Mp(){return UD||(UD=1,mC.exports=i5()),mC.exports}var ce=Mp();const Ge=Cx(ce);var gC={exports:{}},Eh={},yC={exports:{}},xC={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var GD;function a5(){return GD||(GD=1,(function(t){function e(G,q){var J=G.length;G.push(q);e:for(;0<J;){var oe=J-1>>>1,B=G[oe];if(0<o(B,q))G[oe]=q,G[J]=B,J=oe;else break e}}function n(G){return G.length===0?null:G[0]}function s(G){if(G.length===0)return null;var q=G[0],J=G.pop();if(J!==q){G[0]=J;e:for(var oe=0,B=G.length,X=B>>>1;oe<X;){var ie=2*(oe+1)-1,re=G[ie],ye=ie+1,ve=G[ye];if(0>o(re,J))ye<B&&0>o(ve,re)?(G[oe]=ve,G[ye]=J,oe=ye):(G[oe]=re,G[ie]=J,oe=ie);else if(ye<B&&0>o(ve,J))G[oe]=ve,G[ye]=J,oe=ye;else break e}}return q}function o(G,q){var J=G.sortIndex-q.sortIndex;return J!==0?J:G.id-q.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;t.unstable_now=function(){return r.now()}}else{var i=Date,a=i.now();t.unstable_now=function(){return i.now()-a}}var l=[],u=[],d=1,h=null,p=3,x=!1,b=!1,w=!1,C=!1,T=typeof setTimeout=="function"?setTimeout:null,N=typeof clearTimeout=="function"?clearTimeout:null,I=typeof setImmediate<"u"?setImmediate:null;function k(G){for(var q=n(u);q!==null;){if(q.callback===null)s(u);else if(q.startTime<=G)s(u),q.sortIndex=q.expirationTime,e(l,q);else break;q=n(u)}}function A(G){if(w=!1,k(G),!b)if(n(l)!==null)b=!0,$||($=!0,H());else{var q=n(u);q!==null&&Q(A,q.startTime-G)}}var $=!1,M=-1,O=5,F=-1;function P(){return C?!0:!(t.unstable_now()-F<O)}function D(){if(C=!1,$){var G=t.unstable_now();F=G;var q=!0;try{e:{b=!1,w&&(w=!1,N(M),M=-1),x=!0;var J=p;try{t:{for(k(G),h=n(l);h!==null&&!(h.expirationTime>G&&P());){var oe=h.callback;if(typeof oe=="function"){h.callback=null,p=h.priorityLevel;var B=oe(h.expirationTime<=G);if(G=t.unstable_now(),typeof B=="function"){h.callback=B,k(G),q=!0;break t}h===n(l)&&s(l),k(G)}else s(l);h=n(l)}if(h!==null)q=!0;else{var X=n(u);X!==null&&Q(A,X.startTime-G),q=!1}}break e}finally{h=null,p=J,x=!1}q=void 0}}finally{q?H():$=!1}}}var H;if(typeof I=="function")H=function(){I(D)};else if(typeof MessageChannel<"u"){var Z=new MessageChannel,ne=Z.port2;Z.port1.onmessage=D,H=function(){ne.postMessage(null)}}else H=function(){T(D,0)};function Q(G,q){M=T(function(){G(t.unstable_now())},q)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(G){G.callback=null},t.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<G?Math.floor(1e3/G):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_next=function(G){switch(p){case 1:case 2:case 3:var q=3;break;default:q=p}var J=p;p=q;try{return G()}finally{p=J}},t.unstable_requestPaint=function(){C=!0},t.unstable_runWithPriority=function(G,q){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var J=p;p=G;try{return q()}finally{p=J}},t.unstable_scheduleCallback=function(G,q,J){var oe=t.unstable_now();switch(typeof J=="object"&&J!==null?(J=J.delay,J=typeof J=="number"&&0<J?oe+J:oe):J=oe,G){case 1:var B=-1;break;case 2:B=250;break;case 5:B=1073741823;break;case 4:B=1e4;break;default:B=5e3}return B=J+B,G={id:d++,callback:q,priorityLevel:G,startTime:J,expirationTime:B,sortIndex:-1},J>oe?(G.sortIndex=J,e(u,G),n(l)===null&&G===n(u)&&(w?(N(M),M=-1):w=!0,Q(A,J-oe))):(G.sortIndex=B,e(l,G),b||x||(b=!0,$||($=!0,H()))),G},t.unstable_shouldYield=P,t.unstable_wrapCallback=function(G){var q=p;return function(){var J=p;p=q;try{return G.apply(this,arguments)}finally{p=J}}}})(xC)),xC}var HD;function l5(){return HD||(HD=1,yC.exports=a5()),yC.exports}var vC={exports:{}},Is={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var WD;function u5(){if(WD)return Is;WD=1;var t=Mp();function e(l){var u="https://react.dev/errors/"+l;if(1<arguments.length){u+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)u+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+l+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var s={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},o=Symbol.for("react.portal");function r(l,u,d){var h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:o,key:h==null?null:""+h,children:l,containerInfo:u,implementation:d}}var i=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function a(l,u){if(l==="font")return"";if(typeof u=="string")return u==="use-credentials"?u:""}return Is.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,Is.createPortal=function(l,u){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)throw Error(e(299));return r(l,u,null,d)},Is.flushSync=function(l){var u=i.T,d=s.p;try{if(i.T=null,s.p=2,l)return l()}finally{i.T=u,s.p=d,s.d.f()}},Is.preconnect=function(l,u){typeof l=="string"&&(u?(u=u.crossOrigin,u=typeof u=="string"?u==="use-credentials"?u:"":void 0):u=null,s.d.C(l,u))},Is.prefetchDNS=function(l){typeof l=="string"&&s.d.D(l)},Is.preinit=function(l,u){if(typeof l=="string"&&u&&typeof u.as=="string"){var d=u.as,h=a(d,u.crossOrigin),p=typeof u.integrity=="string"?u.integrity:void 0,x=typeof u.fetchPriority=="string"?u.fetchPriority:void 0;d==="style"?s.d.S(l,typeof u.precedence=="string"?u.precedence:void 0,{crossOrigin:h,integrity:p,fetchPriority:x}):d==="script"&&s.d.X(l,{crossOrigin:h,integrity:p,fetchPriority:x,nonce:typeof u.nonce=="string"?u.nonce:void 0})}},Is.preinitModule=function(l,u){if(typeof l=="string")if(typeof u=="object"&&u!==null){if(u.as==null||u.as==="script"){var d=a(u.as,u.crossOrigin);s.d.M(l,{crossOrigin:d,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0})}}else u==null&&s.d.M(l)},Is.preload=function(l,u){if(typeof l=="string"&&typeof u=="object"&&u!==null&&typeof u.as=="string"){var d=u.as,h=a(d,u.crossOrigin);s.d.L(l,d,{crossOrigin:h,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0,type:typeof u.type=="string"?u.type:void 0,fetchPriority:typeof u.fetchPriority=="string"?u.fetchPriority:void 0,referrerPolicy:typeof u.referrerPolicy=="string"?u.referrerPolicy:void 0,imageSrcSet:typeof u.imageSrcSet=="string"?u.imageSrcSet:void 0,imageSizes:typeof u.imageSizes=="string"?u.imageSizes:void 0,media:typeof u.media=="string"?u.media:void 0})}},Is.preloadModule=function(l,u){if(typeof l=="string")if(u){var d=a(u.as,u.crossOrigin);s.d.m(l,{as:typeof u.as=="string"&&u.as!=="script"?u.as:void 0,crossOrigin:d,integrity:typeof u.integrity=="string"?u.integrity:void 0})}else s.d.m(l)},Is.requestFormReset=function(l){s.d.r(l)},Is.unstable_batchedUpdates=function(l,u){return l(u)},Is.useFormState=function(l,u,d){return i.H.useFormState(l,u,d)},Is.useFormStatus=function(){return i.H.useHostTransitionStatus()},Is.version="19.1.1",Is}var qD;function c5(){if(qD)return vC.exports;qD=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),vC.exports=u5(),vC.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var KD;function d5(){if(KD)return Eh;KD=1;var t=l5(),e=Mp(),n=c5();function s(c){var f="https://react.dev/errors/"+c;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)f+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+c+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(c){return!(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)}function r(c){var f=c,m=c;if(c.alternate)for(;f.return;)f=f.return;else{c=f;do f=c,(f.flags&4098)!==0&&(m=f.return),c=f.return;while(c)}return f.tag===3?m:null}function i(c){if(c.tag===13){var f=c.memoizedState;if(f===null&&(c=c.alternate,c!==null&&(f=c.memoizedState)),f!==null)return f.dehydrated}return null}function a(c){if(r(c)!==c)throw Error(s(188))}function l(c){var f=c.alternate;if(!f){if(f=r(c),f===null)throw Error(s(188));return f!==c?null:c}for(var m=c,v=f;;){var S=m.return;if(S===null)break;var E=S.alternate;if(E===null){if(v=S.return,v!==null){m=v;continue}break}if(S.child===E.child){for(E=S.child;E;){if(E===m)return a(S),c;if(E===v)return a(S),f;E=E.sibling}throw Error(s(188))}if(m.return!==v.return)m=S,v=E;else{for(var _=!1,z=S.child;z;){if(z===m){_=!0,m=S,v=E;break}if(z===v){_=!0,v=S,m=E;break}z=z.sibling}if(!_){for(z=E.child;z;){if(z===m){_=!0,m=E,v=S;break}if(z===v){_=!0,v=E,m=S;break}z=z.sibling}if(!_)throw Error(s(189))}}if(m.alternate!==v)throw Error(s(190))}if(m.tag!==3)throw Error(s(188));return m.stateNode.current===m?c:f}function u(c){var f=c.tag;if(f===5||f===26||f===27||f===6)return c;for(c=c.child;c!==null;){if(f=u(c),f!==null)return f;c=c.sibling}return null}var d=Object.assign,h=Symbol.for("react.element"),p=Symbol.for("react.transitional.element"),x=Symbol.for("react.portal"),b=Symbol.for("react.fragment"),w=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),T=Symbol.for("react.provider"),N=Symbol.for("react.consumer"),I=Symbol.for("react.context"),k=Symbol.for("react.forward_ref"),A=Symbol.for("react.suspense"),$=Symbol.for("react.suspense_list"),M=Symbol.for("react.memo"),O=Symbol.for("react.lazy"),F=Symbol.for("react.activity"),P=Symbol.for("react.memo_cache_sentinel"),D=Symbol.iterator;function H(c){return c===null||typeof c!="object"?null:(c=D&&c[D]||c["@@iterator"],typeof c=="function"?c:null)}var Z=Symbol.for("react.client.reference");function ne(c){if(c==null)return null;if(typeof c=="function")return c.$$typeof===Z?null:c.displayName||c.name||null;if(typeof c=="string")return c;switch(c){case b:return"Fragment";case C:return"Profiler";case w:return"StrictMode";case A:return"Suspense";case $:return"SuspenseList";case F:return"Activity"}if(typeof c=="object")switch(c.$$typeof){case x:return"Portal";case I:return(c.displayName||"Context")+".Provider";case N:return(c._context.displayName||"Context")+".Consumer";case k:var f=c.render;return c=c.displayName,c||(c=f.displayName||f.name||"",c=c!==""?"ForwardRef("+c+")":"ForwardRef"),c;case M:return f=c.displayName||null,f!==null?f:ne(c.type)||"Memo";case O:f=c._payload,c=c._init;try{return ne(c(f))}catch{}}return null}var Q=Array.isArray,G=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,q=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,J={pending:!1,data:null,method:null,action:null},oe=[],B=-1;function X(c){return{current:c}}function ie(c){0>B||(c.current=oe[B],oe[B]=null,B--)}function re(c,f){B++,oe[B]=c.current,c.current=f}var ye=X(null),ve=X(null),be=X(null),Re=X(null);function Ae(c,f){switch(re(be,f),re(ve,c),re(ye,null),f.nodeType){case 9:case 11:c=(c=f.documentElement)&&(c=c.namespaceURI)?hD(c):0;break;default:if(c=f.tagName,f=f.namespaceURI)f=hD(f),c=pD(f,c);else switch(c){case"svg":c=1;break;case"math":c=2;break;default:c=0}}ie(ye),re(ye,c)}function De(){ie(ye),ie(ve),ie(be)}function Ke(c){c.memoizedState!==null&&re(Re,c);var f=ye.current,m=pD(f,c.type);f!==m&&(re(ve,c),re(ye,m))}function Xe(c){ve.current===c&&(ie(ye),ie(ve)),Re.current===c&&(ie(Re),bh._currentValue=J)}var dt=Object.prototype.hasOwnProperty,wt=t.unstable_scheduleCallback,$t=t.unstable_cancelCallback,It=t.unstable_shouldYield,Ct=t.unstable_requestPaint,it=t.unstable_now,Dt=t.unstable_getCurrentPriorityLevel,js=t.unstable_ImmediatePriority,an=t.unstable_UserBlockingPriority,Vs=t.unstable_NormalPriority,Qn=t.unstable_LowPriority,go=t.unstable_IdlePriority,Ts=t.log,yo=t.unstable_setDisableYieldValue,Ss=null,jt=null;function Rn(c){if(typeof Ts=="function"&&yo(c),jt&&typeof jt.setStrictMode=="function")try{jt.setStrictMode(Ss,c)}catch{}}var ln=Math.clz32?Math.clz32:Ee,ul=Math.log,cl=Math.LN2;function Ee(c){return c>>>=0,c===0?32:31-(ul(c)/cl|0)|0}var Ve=256,ft=4194304;function Tt(c){var f=c&42;if(f!==0)return f;switch(c&-c){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return c&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return c}}function zn(c,f,m){var v=c.pendingLanes;if(v===0)return 0;var S=0,E=c.suspendedLanes,_=c.pingedLanes;c=c.warmLanes;var z=v&134217727;return z!==0?(v=z&~E,v!==0?S=Tt(v):(_&=z,_!==0?S=Tt(_):m||(m=z&~c,m!==0&&(S=Tt(m))))):(z=v&~E,z!==0?S=Tt(z):_!==0?S=Tt(_):m||(m=v&~c,m!==0&&(S=Tt(m)))),S===0?0:f!==0&&f!==S&&(f&E)===0&&(E=S&-S,m=f&-f,E>=m||E===32&&(m&4194048)!==0)?f:S}function ir(c,f){return(c.pendingLanes&~(c.suspendedLanes&~c.pingedLanes)&f)===0}function li(c,f){switch(c){case 1:case 2:case 4:case 8:case 64:return f+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Bn(){var c=Ve;return Ve<<=1,(Ve&4194048)===0&&(Ve=256),c}function Oo(){var c=ft;return ft<<=1,(ft&62914560)===0&&(ft=4194304),c}function Zi(c){for(var f=[],m=0;31>m;m++)f.push(c);return f}function ar(c,f){c.pendingLanes|=f,f!==268435456&&(c.suspendedLanes=0,c.pingedLanes=0,c.warmLanes=0)}function UW(c,f,m,v,S,E){var _=c.pendingLanes;c.pendingLanes=m,c.suspendedLanes=0,c.pingedLanes=0,c.warmLanes=0,c.expiredLanes&=m,c.entangledLanes&=m,c.errorRecoveryDisabledLanes&=m,c.shellSuspendCounter=0;var z=c.entanglements,Y=c.expirationTimes,fe=c.hiddenUpdates;for(m=_&~m;0<m;){var xe=31-ln(m),Ce=1<<xe;z[xe]=0,Y[xe]=-1;var he=fe[xe];if(he!==null)for(fe[xe]=null,xe=0;xe<he.length;xe++){var pe=he[xe];pe!==null&&(pe.lane&=-536870913)}m&=~Ce}v!==0&&ZA(c,v,0),E!==0&&S===0&&c.tag!==0&&(c.suspendedLanes|=E&~(_&~f))}function ZA(c,f,m){c.pendingLanes|=f,c.suspendedLanes&=~f;var v=31-ln(f);c.entangledLanes|=f,c.entanglements[v]=c.entanglements[v]|1073741824|m&4194090}function QA(c,f){var m=c.entangledLanes|=f;for(c=c.entanglements;m;){var v=31-ln(m),S=1<<v;S&f|c[v]&f&&(c[v]|=f),m&=~S}}function ow(c){switch(c){case 2:c=1;break;case 8:c=4;break;case 32:c=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:c=128;break;case 268435456:c=134217728;break;default:c=0}return c}function rw(c){return c&=-c,2<c?8<c?(c&134217727)!==0?32:268435456:8:2}function e2(){var c=q.p;return c!==0?c:(c=window.event,c===void 0?32:_D(c.type))}function GW(c,f){var m=q.p;try{return q.p=c,f()}finally{q.p=m}}var Qi=Math.random().toString(36).slice(2),Ns="__reactFiber$"+Qi,Zs="__reactProps$"+Qi,_u="__reactContainer$"+Qi,iw="__reactEvents$"+Qi,HW="__reactListeners$"+Qi,WW="__reactHandles$"+Qi,t2="__reactResources$"+Qi,$f="__reactMarker$"+Qi;function aw(c){delete c[Ns],delete c[Zs],delete c[iw],delete c[HW],delete c[WW]}function Mu(c){var f=c[Ns];if(f)return f;for(var m=c.parentNode;m;){if(f=m[_u]||m[Ns]){if(m=f.alternate,f.child!==null||m!==null&&m.child!==null)for(c=xD(c);c!==null;){if(m=c[Ns])return m;c=xD(c)}return f}c=m,m=c.parentNode}return null}function Fu(c){if(c=c[Ns]||c[_u]){var f=c.tag;if(f===5||f===6||f===13||f===26||f===27||f===3)return c}return null}function Df(c){var f=c.tag;if(f===5||f===26||f===27||f===6)return c.stateNode;throw Error(s(33))}function Ou(c){var f=c[t2];return f||(f=c[t2]={hoistableStyles:new Map,hoistableScripts:new Map}),f}function es(c){c[$f]=!0}var n2=new Set,s2={};function dl(c,f){Pu(c,f),Pu(c+"Capture",f)}function Pu(c,f){for(s2[c]=f,c=0;c<f.length;c++)n2.add(f[c])}var qW=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),o2={},r2={};function KW(c){return dt.call(r2,c)?!0:dt.call(o2,c)?!1:qW.test(c)?r2[c]=!0:(o2[c]=!0,!1)}function $g(c,f,m){if(KW(f))if(m===null)c.removeAttribute(f);else{switch(typeof m){case"undefined":case"function":case"symbol":c.removeAttribute(f);return;case"boolean":var v=f.toLowerCase().slice(0,5);if(v!=="data-"&&v!=="aria-"){c.removeAttribute(f);return}}c.setAttribute(f,""+m)}}function Dg(c,f,m){if(m===null)c.removeAttribute(f);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":c.removeAttribute(f);return}c.setAttribute(f,""+m)}}function ui(c,f,m,v){if(v===null)c.removeAttribute(m);else{switch(typeof v){case"undefined":case"function":case"symbol":case"boolean":c.removeAttribute(m);return}c.setAttributeNS(f,m,""+v)}}var lw,i2;function Lu(c){if(lw===void 0)try{throw Error()}catch(m){var f=m.stack.trim().match(/\n( *(at )?)/);lw=f&&f[1]||"",i2=-1<m.stack.indexOf(`
    at`)?" (<anonymous>)":-1<m.stack.indexOf("@")?"@unknown:0:0":""}return`
`+lw+c+i2}var uw=!1;function cw(c,f){if(!c||uw)return"";uw=!0;var m=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var v={DetermineComponentFrameRoot:function(){try{if(f){var Ce=function(){throw Error()};if(Object.defineProperty(Ce.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ce,[])}catch(pe){var he=pe}Reflect.construct(c,[],Ce)}else{try{Ce.call()}catch(pe){he=pe}c.call(Ce.prototype)}}else{try{throw Error()}catch(pe){he=pe}(Ce=c())&&typeof Ce.catch=="function"&&Ce.catch(function(){})}}catch(pe){if(pe&&he&&typeof pe.stack=="string")return[pe.stack,he.stack]}return[null,null]}};v.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var S=Object.getOwnPropertyDescriptor(v.DetermineComponentFrameRoot,"name");S&&S.configurable&&Object.defineProperty(v.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var E=v.DetermineComponentFrameRoot(),_=E[0],z=E[1];if(_&&z){var Y=_.split(`
`),fe=z.split(`
`);for(S=v=0;v<Y.length&&!Y[v].includes("DetermineComponentFrameRoot");)v++;for(;S<fe.length&&!fe[S].includes("DetermineComponentFrameRoot");)S++;if(v===Y.length||S===fe.length)for(v=Y.length-1,S=fe.length-1;1<=v&&0<=S&&Y[v]!==fe[S];)S--;for(;1<=v&&0<=S;v--,S--)if(Y[v]!==fe[S]){if(v!==1||S!==1)do if(v--,S--,0>S||Y[v]!==fe[S]){var xe=`
`+Y[v].replace(" at new "," at ");return c.displayName&&xe.includes("<anonymous>")&&(xe=xe.replace("<anonymous>",c.displayName)),xe}while(1<=v&&0<=S);break}}}finally{uw=!1,Error.prepareStackTrace=m}return(m=c?c.displayName||c.name:"")?Lu(m):""}function XW(c){switch(c.tag){case 26:case 27:case 5:return Lu(c.type);case 16:return Lu("Lazy");case 13:return Lu("Suspense");case 19:return Lu("SuspenseList");case 0:case 15:return cw(c.type,!1);case 11:return cw(c.type.render,!1);case 1:return cw(c.type,!0);case 31:return Lu("Activity");default:return""}}function a2(c){try{var f="";do f+=XW(c),c=c.return;while(c);return f}catch(m){return`
Error generating stack: `+m.message+`
`+m.stack}}function Po(c){switch(typeof c){case"bigint":case"boolean":case"number":case"string":case"undefined":return c;case"object":return c;default:return""}}function l2(c){var f=c.type;return(c=c.nodeName)&&c.toLowerCase()==="input"&&(f==="checkbox"||f==="radio")}function YW(c){var f=l2(c)?"checked":"value",m=Object.getOwnPropertyDescriptor(c.constructor.prototype,f),v=""+c[f];if(!c.hasOwnProperty(f)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var S=m.get,E=m.set;return Object.defineProperty(c,f,{configurable:!0,get:function(){return S.call(this)},set:function(_){v=""+_,E.call(this,_)}}),Object.defineProperty(c,f,{enumerable:m.enumerable}),{getValue:function(){return v},setValue:function(_){v=""+_},stopTracking:function(){c._valueTracker=null,delete c[f]}}}}function _g(c){c._valueTracker||(c._valueTracker=YW(c))}function u2(c){if(!c)return!1;var f=c._valueTracker;if(!f)return!0;var m=f.getValue(),v="";return c&&(v=l2(c)?c.checked?"true":"false":c.value),c=v,c!==m?(f.setValue(c),!0):!1}function Mg(c){if(c=c||(typeof document<"u"?document:void 0),typeof c>"u")return null;try{return c.activeElement||c.body}catch{return c.body}}var JW=/[\n"\\]/g;function Lo(c){return c.replace(JW,function(f){return"\\"+f.charCodeAt(0).toString(16)+" "})}function dw(c,f,m,v,S,E,_,z){c.name="",_!=null&&typeof _!="function"&&typeof _!="symbol"&&typeof _!="boolean"?c.type=_:c.removeAttribute("type"),f!=null?_==="number"?(f===0&&c.value===""||c.value!=f)&&(c.value=""+Po(f)):c.value!==""+Po(f)&&(c.value=""+Po(f)):_!=="submit"&&_!=="reset"||c.removeAttribute("value"),f!=null?fw(c,_,Po(f)):m!=null?fw(c,_,Po(m)):v!=null&&c.removeAttribute("value"),S==null&&E!=null&&(c.defaultChecked=!!E),S!=null&&(c.checked=S&&typeof S!="function"&&typeof S!="symbol"),z!=null&&typeof z!="function"&&typeof z!="symbol"&&typeof z!="boolean"?c.name=""+Po(z):c.removeAttribute("name")}function c2(c,f,m,v,S,E,_,z){if(E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"&&(c.type=E),f!=null||m!=null){if(!(E!=="submit"&&E!=="reset"||f!=null))return;m=m!=null?""+Po(m):"",f=f!=null?""+Po(f):m,z||f===c.value||(c.value=f),c.defaultValue=f}v=v??S,v=typeof v!="function"&&typeof v!="symbol"&&!!v,c.checked=z?c.checked:!!v,c.defaultChecked=!!v,_!=null&&typeof _!="function"&&typeof _!="symbol"&&typeof _!="boolean"&&(c.name=_)}function fw(c,f,m){f==="number"&&Mg(c.ownerDocument)===c||c.defaultValue===""+m||(c.defaultValue=""+m)}function Vu(c,f,m,v){if(c=c.options,f){f={};for(var S=0;S<m.length;S++)f["$"+m[S]]=!0;for(m=0;m<c.length;m++)S=f.hasOwnProperty("$"+c[m].value),c[m].selected!==S&&(c[m].selected=S),S&&v&&(c[m].defaultSelected=!0)}else{for(m=""+Po(m),f=null,S=0;S<c.length;S++){if(c[S].value===m){c[S].selected=!0,v&&(c[S].defaultSelected=!0);return}f!==null||c[S].disabled||(f=c[S])}f!==null&&(f.selected=!0)}}function d2(c,f,m){if(f!=null&&(f=""+Po(f),f!==c.value&&(c.value=f),m==null)){c.defaultValue!==f&&(c.defaultValue=f);return}c.defaultValue=m!=null?""+Po(m):""}function f2(c,f,m,v){if(f==null){if(v!=null){if(m!=null)throw Error(s(92));if(Q(v)){if(1<v.length)throw Error(s(93));v=v[0]}m=v}m==null&&(m=""),f=m}m=Po(f),c.defaultValue=m,v=c.textContent,v===m&&v!==""&&v!==null&&(c.value=v)}function zu(c,f){if(f){var m=c.firstChild;if(m&&m===c.lastChild&&m.nodeType===3){m.nodeValue=f;return}}c.textContent=f}var jW=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function h2(c,f,m){var v=f.indexOf("--")===0;m==null||typeof m=="boolean"||m===""?v?c.setProperty(f,""):f==="float"?c.cssFloat="":c[f]="":v?c.setProperty(f,m):typeof m!="number"||m===0||jW.has(f)?f==="float"?c.cssFloat=m:c[f]=(""+m).trim():c[f]=m+"px"}function p2(c,f,m){if(f!=null&&typeof f!="object")throw Error(s(62));if(c=c.style,m!=null){for(var v in m)!m.hasOwnProperty(v)||f!=null&&f.hasOwnProperty(v)||(v.indexOf("--")===0?c.setProperty(v,""):v==="float"?c.cssFloat="":c[v]="");for(var S in f)v=f[S],f.hasOwnProperty(S)&&m[S]!==v&&h2(c,S,v)}else for(var E in f)f.hasOwnProperty(E)&&h2(c,E,f[E])}function hw(c){if(c.indexOf("-")===-1)return!1;switch(c){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ZW=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),QW=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Fg(c){return QW.test(""+c)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":c}var pw=null;function mw(c){return c=c.target||c.srcElement||window,c.correspondingUseElement&&(c=c.correspondingUseElement),c.nodeType===3?c.parentNode:c}var Bu=null,Uu=null;function m2(c){var f=Fu(c);if(f&&(c=f.stateNode)){var m=c[Zs]||null;e:switch(c=f.stateNode,f.type){case"input":if(dw(c,m.value,m.defaultValue,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name),f=m.name,m.type==="radio"&&f!=null){for(m=c;m.parentNode;)m=m.parentNode;for(m=m.querySelectorAll('input[name="'+Lo(""+f)+'"][type="radio"]'),f=0;f<m.length;f++){var v=m[f];if(v!==c&&v.form===c.form){var S=v[Zs]||null;if(!S)throw Error(s(90));dw(v,S.value,S.defaultValue,S.defaultValue,S.checked,S.defaultChecked,S.type,S.name)}}for(f=0;f<m.length;f++)v=m[f],v.form===c.form&&u2(v)}break e;case"textarea":d2(c,m.value,m.defaultValue);break e;case"select":f=m.value,f!=null&&Vu(c,!!m.multiple,f,!1)}}}var gw=!1;function g2(c,f,m){if(gw)return c(f,m);gw=!0;try{var v=c(f);return v}finally{if(gw=!1,(Bu!==null||Uu!==null)&&(by(),Bu&&(f=Bu,c=Uu,Uu=Bu=null,m2(f),c)))for(f=0;f<c.length;f++)m2(c[f])}}function _f(c,f){var m=c.stateNode;if(m===null)return null;var v=m[Zs]||null;if(v===null)return null;m=v[f];e:switch(f){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(v=!v.disabled)||(c=c.type,v=!(c==="button"||c==="input"||c==="select"||c==="textarea")),c=!v;break e;default:c=!1}if(c)return null;if(m&&typeof m!="function")throw Error(s(231,f,typeof m));return m}var ci=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),yw=!1;if(ci)try{var Mf={};Object.defineProperty(Mf,"passive",{get:function(){yw=!0}}),window.addEventListener("test",Mf,Mf),window.removeEventListener("test",Mf,Mf)}catch{yw=!1}var ea=null,xw=null,Og=null;function y2(){if(Og)return Og;var c,f=xw,m=f.length,v,S="value"in ea?ea.value:ea.textContent,E=S.length;for(c=0;c<m&&f[c]===S[c];c++);var _=m-c;for(v=1;v<=_&&f[m-v]===S[E-v];v++);return Og=S.slice(c,1<v?1-v:void 0)}function Pg(c){var f=c.keyCode;return"charCode"in c?(c=c.charCode,c===0&&f===13&&(c=13)):c=f,c===10&&(c=13),32<=c||c===13?c:0}function Lg(){return!0}function x2(){return!1}function Qs(c){function f(m,v,S,E,_){this._reactName=m,this._targetInst=S,this.type=v,this.nativeEvent=E,this.target=_,this.currentTarget=null;for(var z in c)c.hasOwnProperty(z)&&(m=c[z],this[z]=m?m(E):E[z]);return this.isDefaultPrevented=(E.defaultPrevented!=null?E.defaultPrevented:E.returnValue===!1)?Lg:x2,this.isPropagationStopped=x2,this}return d(f.prototype,{preventDefault:function(){this.defaultPrevented=!0;var m=this.nativeEvent;m&&(m.preventDefault?m.preventDefault():typeof m.returnValue!="unknown"&&(m.returnValue=!1),this.isDefaultPrevented=Lg)},stopPropagation:function(){var m=this.nativeEvent;m&&(m.stopPropagation?m.stopPropagation():typeof m.cancelBubble!="unknown"&&(m.cancelBubble=!0),this.isPropagationStopped=Lg)},persist:function(){},isPersistent:Lg}),f}var fl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(c){return c.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Vg=Qs(fl),Ff=d({},fl,{view:0,detail:0}),eq=Qs(Ff),vw,bw,Of,zg=d({},Ff,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Cw,button:0,buttons:0,relatedTarget:function(c){return c.relatedTarget===void 0?c.fromElement===c.srcElement?c.toElement:c.fromElement:c.relatedTarget},movementX:function(c){return"movementX"in c?c.movementX:(c!==Of&&(Of&&c.type==="mousemove"?(vw=c.screenX-Of.screenX,bw=c.screenY-Of.screenY):bw=vw=0,Of=c),vw)},movementY:function(c){return"movementY"in c?c.movementY:bw}}),v2=Qs(zg),tq=d({},zg,{dataTransfer:0}),nq=Qs(tq),sq=d({},Ff,{relatedTarget:0}),ww=Qs(sq),oq=d({},fl,{animationName:0,elapsedTime:0,pseudoElement:0}),rq=Qs(oq),iq=d({},fl,{clipboardData:function(c){return"clipboardData"in c?c.clipboardData:window.clipboardData}}),aq=Qs(iq),lq=d({},fl,{data:0}),b2=Qs(lq),uq={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},cq={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},dq={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function fq(c){var f=this.nativeEvent;return f.getModifierState?f.getModifierState(c):(c=dq[c])?!!f[c]:!1}function Cw(){return fq}var hq=d({},Ff,{key:function(c){if(c.key){var f=uq[c.key]||c.key;if(f!=="Unidentified")return f}return c.type==="keypress"?(c=Pg(c),c===13?"Enter":String.fromCharCode(c)):c.type==="keydown"||c.type==="keyup"?cq[c.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Cw,charCode:function(c){return c.type==="keypress"?Pg(c):0},keyCode:function(c){return c.type==="keydown"||c.type==="keyup"?c.keyCode:0},which:function(c){return c.type==="keypress"?Pg(c):c.type==="keydown"||c.type==="keyup"?c.keyCode:0}}),pq=Qs(hq),mq=d({},zg,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),w2=Qs(mq),gq=d({},Ff,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Cw}),yq=Qs(gq),xq=d({},fl,{propertyName:0,elapsedTime:0,pseudoElement:0}),vq=Qs(xq),bq=d({},zg,{deltaX:function(c){return"deltaX"in c?c.deltaX:"wheelDeltaX"in c?-c.wheelDeltaX:0},deltaY:function(c){return"deltaY"in c?c.deltaY:"wheelDeltaY"in c?-c.wheelDeltaY:"wheelDelta"in c?-c.wheelDelta:0},deltaZ:0,deltaMode:0}),wq=Qs(bq),Cq=d({},fl,{newState:0,oldState:0}),Tq=Qs(Cq),Sq=[9,13,27,32],Tw=ci&&"CompositionEvent"in window,Pf=null;ci&&"documentMode"in document&&(Pf=document.documentMode);var Nq=ci&&"TextEvent"in window&&!Pf,C2=ci&&(!Tw||Pf&&8<Pf&&11>=Pf),T2=" ",S2=!1;function N2(c,f){switch(c){case"keyup":return Sq.indexOf(f.keyCode)!==-1;case"keydown":return f.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function E2(c){return c=c.detail,typeof c=="object"&&"data"in c?c.data:null}var Gu=!1;function Eq(c,f){switch(c){case"compositionend":return E2(f);case"keypress":return f.which!==32?null:(S2=!0,T2);case"textInput":return c=f.data,c===T2&&S2?null:c;default:return null}}function Iq(c,f){if(Gu)return c==="compositionend"||!Tw&&N2(c,f)?(c=y2(),Og=xw=ea=null,Gu=!1,c):null;switch(c){case"paste":return null;case"keypress":if(!(f.ctrlKey||f.altKey||f.metaKey)||f.ctrlKey&&f.altKey){if(f.char&&1<f.char.length)return f.char;if(f.which)return String.fromCharCode(f.which)}return null;case"compositionend":return C2&&f.locale!=="ko"?null:f.data;default:return null}}var kq={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function I2(c){var f=c&&c.nodeName&&c.nodeName.toLowerCase();return f==="input"?!!kq[c.type]:f==="textarea"}function k2(c,f,m,v){Bu?Uu?Uu.push(v):Uu=[v]:Bu=v,f=Ey(f,"onChange"),0<f.length&&(m=new Vg("onChange","change",null,m,v),c.push({event:m,listeners:f}))}var Lf=null,Vf=null;function Aq(c){lD(c,0)}function Bg(c){var f=Df(c);if(u2(f))return c}function A2(c,f){if(c==="change")return f}var R2=!1;if(ci){var Sw;if(ci){var Nw="oninput"in document;if(!Nw){var $2=document.createElement("div");$2.setAttribute("oninput","return;"),Nw=typeof $2.oninput=="function"}Sw=Nw}else Sw=!1;R2=Sw&&(!document.documentMode||9<document.documentMode)}function D2(){Lf&&(Lf.detachEvent("onpropertychange",_2),Vf=Lf=null)}function _2(c){if(c.propertyName==="value"&&Bg(Vf)){var f=[];k2(f,Vf,c,mw(c)),g2(Aq,f)}}function Rq(c,f,m){c==="focusin"?(D2(),Lf=f,Vf=m,Lf.attachEvent("onpropertychange",_2)):c==="focusout"&&D2()}function $q(c){if(c==="selectionchange"||c==="keyup"||c==="keydown")return Bg(Vf)}function Dq(c,f){if(c==="click")return Bg(f)}function _q(c,f){if(c==="input"||c==="change")return Bg(f)}function Mq(c,f){return c===f&&(c!==0||1/c===1/f)||c!==c&&f!==f}var xo=typeof Object.is=="function"?Object.is:Mq;function zf(c,f){if(xo(c,f))return!0;if(typeof c!="object"||c===null||typeof f!="object"||f===null)return!1;var m=Object.keys(c),v=Object.keys(f);if(m.length!==v.length)return!1;for(v=0;v<m.length;v++){var S=m[v];if(!dt.call(f,S)||!xo(c[S],f[S]))return!1}return!0}function M2(c){for(;c&&c.firstChild;)c=c.firstChild;return c}function F2(c,f){var m=M2(c);c=0;for(var v;m;){if(m.nodeType===3){if(v=c+m.textContent.length,c<=f&&v>=f)return{node:m,offset:f-c};c=v}e:{for(;m;){if(m.nextSibling){m=m.nextSibling;break e}m=m.parentNode}m=void 0}m=M2(m)}}function O2(c,f){return c&&f?c===f?!0:c&&c.nodeType===3?!1:f&&f.nodeType===3?O2(c,f.parentNode):"contains"in c?c.contains(f):c.compareDocumentPosition?!!(c.compareDocumentPosition(f)&16):!1:!1}function P2(c){c=c!=null&&c.ownerDocument!=null&&c.ownerDocument.defaultView!=null?c.ownerDocument.defaultView:window;for(var f=Mg(c.document);f instanceof c.HTMLIFrameElement;){try{var m=typeof f.contentWindow.location.href=="string"}catch{m=!1}if(m)c=f.contentWindow;else break;f=Mg(c.document)}return f}function Ew(c){var f=c&&c.nodeName&&c.nodeName.toLowerCase();return f&&(f==="input"&&(c.type==="text"||c.type==="search"||c.type==="tel"||c.type==="url"||c.type==="password")||f==="textarea"||c.contentEditable==="true")}var Fq=ci&&"documentMode"in document&&11>=document.documentMode,Hu=null,Iw=null,Bf=null,kw=!1;function L2(c,f,m){var v=m.window===m?m.document:m.nodeType===9?m:m.ownerDocument;kw||Hu==null||Hu!==Mg(v)||(v=Hu,"selectionStart"in v&&Ew(v)?v={start:v.selectionStart,end:v.selectionEnd}:(v=(v.ownerDocument&&v.ownerDocument.defaultView||window).getSelection(),v={anchorNode:v.anchorNode,anchorOffset:v.anchorOffset,focusNode:v.focusNode,focusOffset:v.focusOffset}),Bf&&zf(Bf,v)||(Bf=v,v=Ey(Iw,"onSelect"),0<v.length&&(f=new Vg("onSelect","select",null,f,m),c.push({event:f,listeners:v}),f.target=Hu)))}function hl(c,f){var m={};return m[c.toLowerCase()]=f.toLowerCase(),m["Webkit"+c]="webkit"+f,m["Moz"+c]="moz"+f,m}var Wu={animationend:hl("Animation","AnimationEnd"),animationiteration:hl("Animation","AnimationIteration"),animationstart:hl("Animation","AnimationStart"),transitionrun:hl("Transition","TransitionRun"),transitionstart:hl("Transition","TransitionStart"),transitioncancel:hl("Transition","TransitionCancel"),transitionend:hl("Transition","TransitionEnd")},Aw={},V2={};ci&&(V2=document.createElement("div").style,"AnimationEvent"in window||(delete Wu.animationend.animation,delete Wu.animationiteration.animation,delete Wu.animationstart.animation),"TransitionEvent"in window||delete Wu.transitionend.transition);function pl(c){if(Aw[c])return Aw[c];if(!Wu[c])return c;var f=Wu[c],m;for(m in f)if(f.hasOwnProperty(m)&&m in V2)return Aw[c]=f[m];return c}var z2=pl("animationend"),B2=pl("animationiteration"),U2=pl("animationstart"),Oq=pl("transitionrun"),Pq=pl("transitionstart"),Lq=pl("transitioncancel"),G2=pl("transitionend"),H2=new Map,Rw="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Rw.push("scrollEnd");function lr(c,f){H2.set(c,f),dl(f,[c])}var W2=new WeakMap;function Vo(c,f){if(typeof c=="object"&&c!==null){var m=W2.get(c);return m!==void 0?m:(f={value:c,source:f,stack:a2(f)},W2.set(c,f),f)}return{value:c,source:f,stack:a2(f)}}var zo=[],qu=0,$w=0;function Ug(){for(var c=qu,f=$w=qu=0;f<c;){var m=zo[f];zo[f++]=null;var v=zo[f];zo[f++]=null;var S=zo[f];zo[f++]=null;var E=zo[f];if(zo[f++]=null,v!==null&&S!==null){var _=v.pending;_===null?S.next=S:(S.next=_.next,_.next=S),v.pending=S}E!==0&&q2(m,S,E)}}function Gg(c,f,m,v){zo[qu++]=c,zo[qu++]=f,zo[qu++]=m,zo[qu++]=v,$w|=v,c.lanes|=v,c=c.alternate,c!==null&&(c.lanes|=v)}function Dw(c,f,m,v){return Gg(c,f,m,v),Hg(c)}function Ku(c,f){return Gg(c,null,null,f),Hg(c)}function q2(c,f,m){c.lanes|=m;var v=c.alternate;v!==null&&(v.lanes|=m);for(var S=!1,E=c.return;E!==null;)E.childLanes|=m,v=E.alternate,v!==null&&(v.childLanes|=m),E.tag===22&&(c=E.stateNode,c===null||c._visibility&1||(S=!0)),c=E,E=E.return;return c.tag===3?(E=c.stateNode,S&&f!==null&&(S=31-ln(m),c=E.hiddenUpdates,v=c[S],v===null?c[S]=[f]:v.push(f),f.lane=m|536870912),E):null}function Hg(c){if(50<fh)throw fh=0,L1=null,Error(s(185));for(var f=c.return;f!==null;)c=f,f=c.return;return c.tag===3?c.stateNode:null}var Xu={};function Vq(c,f,m,v){this.tag=c,this.key=m,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=f,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=v,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function vo(c,f,m,v){return new Vq(c,f,m,v)}function _w(c){return c=c.prototype,!(!c||!c.isReactComponent)}function di(c,f){var m=c.alternate;return m===null?(m=vo(c.tag,f,c.key,c.mode),m.elementType=c.elementType,m.type=c.type,m.stateNode=c.stateNode,m.alternate=c,c.alternate=m):(m.pendingProps=f,m.type=c.type,m.flags=0,m.subtreeFlags=0,m.deletions=null),m.flags=c.flags&65011712,m.childLanes=c.childLanes,m.lanes=c.lanes,m.child=c.child,m.memoizedProps=c.memoizedProps,m.memoizedState=c.memoizedState,m.updateQueue=c.updateQueue,f=c.dependencies,m.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext},m.sibling=c.sibling,m.index=c.index,m.ref=c.ref,m.refCleanup=c.refCleanup,m}function K2(c,f){c.flags&=65011714;var m=c.alternate;return m===null?(c.childLanes=0,c.lanes=f,c.child=null,c.subtreeFlags=0,c.memoizedProps=null,c.memoizedState=null,c.updateQueue=null,c.dependencies=null,c.stateNode=null):(c.childLanes=m.childLanes,c.lanes=m.lanes,c.child=m.child,c.subtreeFlags=0,c.deletions=null,c.memoizedProps=m.memoizedProps,c.memoizedState=m.memoizedState,c.updateQueue=m.updateQueue,c.type=m.type,f=m.dependencies,c.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),c}function Wg(c,f,m,v,S,E){var _=0;if(v=c,typeof c=="function")_w(c)&&(_=1);else if(typeof c=="string")_=B6(c,m,ye.current)?26:c==="html"||c==="head"||c==="body"?27:5;else e:switch(c){case F:return c=vo(31,m,f,S),c.elementType=F,c.lanes=E,c;case b:return ml(m.children,S,E,f);case w:_=8,S|=24;break;case C:return c=vo(12,m,f,S|2),c.elementType=C,c.lanes=E,c;case A:return c=vo(13,m,f,S),c.elementType=A,c.lanes=E,c;case $:return c=vo(19,m,f,S),c.elementType=$,c.lanes=E,c;default:if(typeof c=="object"&&c!==null)switch(c.$$typeof){case T:case I:_=10;break e;case N:_=9;break e;case k:_=11;break e;case M:_=14;break e;case O:_=16,v=null;break e}_=29,m=Error(s(130,c===null?"null":typeof c,"")),v=null}return f=vo(_,m,f,S),f.elementType=c,f.type=v,f.lanes=E,f}function ml(c,f,m,v){return c=vo(7,c,v,f),c.lanes=m,c}function Mw(c,f,m){return c=vo(6,c,null,f),c.lanes=m,c}function Fw(c,f,m){return f=vo(4,c.children!==null?c.children:[],c.key,f),f.lanes=m,f.stateNode={containerInfo:c.containerInfo,pendingChildren:null,implementation:c.implementation},f}var Yu=[],Ju=0,qg=null,Kg=0,Bo=[],Uo=0,gl=null,fi=1,hi="";function yl(c,f){Yu[Ju++]=Kg,Yu[Ju++]=qg,qg=c,Kg=f}function X2(c,f,m){Bo[Uo++]=fi,Bo[Uo++]=hi,Bo[Uo++]=gl,gl=c;var v=fi;c=hi;var S=32-ln(v)-1;v&=~(1<<S),m+=1;var E=32-ln(f)+S;if(30<E){var _=S-S%5;E=(v&(1<<_)-1).toString(32),v>>=_,S-=_,fi=1<<32-ln(f)+S|m<<S|v,hi=E+c}else fi=1<<E|m<<S|v,hi=c}function Ow(c){c.return!==null&&(yl(c,1),X2(c,1,0))}function Pw(c){for(;c===qg;)qg=Yu[--Ju],Yu[Ju]=null,Kg=Yu[--Ju],Yu[Ju]=null;for(;c===gl;)gl=Bo[--Uo],Bo[Uo]=null,hi=Bo[--Uo],Bo[Uo]=null,fi=Bo[--Uo],Bo[Uo]=null}var zs=null,fn=null,kt=!1,xl=null,Dr=!1,Lw=Error(s(519));function vl(c){var f=Error(s(418,""));throw Hf(Vo(f,c)),Lw}function Y2(c){var f=c.stateNode,m=c.type,v=c.memoizedProps;switch(f[Ns]=c,f[Zs]=v,m){case"dialog":pt("cancel",f),pt("close",f);break;case"iframe":case"object":case"embed":pt("load",f);break;case"video":case"audio":for(m=0;m<ph.length;m++)pt(ph[m],f);break;case"source":pt("error",f);break;case"img":case"image":case"link":pt("error",f),pt("load",f);break;case"details":pt("toggle",f);break;case"input":pt("invalid",f),c2(f,v.value,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name,!0),_g(f);break;case"select":pt("invalid",f);break;case"textarea":pt("invalid",f),f2(f,v.value,v.defaultValue,v.children),_g(f)}m=v.children,typeof m!="string"&&typeof m!="number"&&typeof m!="bigint"||f.textContent===""+m||v.suppressHydrationWarning===!0||fD(f.textContent,m)?(v.popover!=null&&(pt("beforetoggle",f),pt("toggle",f)),v.onScroll!=null&&pt("scroll",f),v.onScrollEnd!=null&&pt("scrollend",f),v.onClick!=null&&(f.onclick=Iy),f=!0):f=!1,f||vl(c)}function J2(c){for(zs=c.return;zs;)switch(zs.tag){case 5:case 13:Dr=!1;return;case 27:case 3:Dr=!0;return;default:zs=zs.return}}function Uf(c){if(c!==zs)return!1;if(!kt)return J2(c),kt=!0,!1;var f=c.tag,m;if((m=f!==3&&f!==27)&&((m=f===5)&&(m=c.type,m=!(m!=="form"&&m!=="button")||eC(c.type,c.memoizedProps)),m=!m),m&&fn&&vl(c),J2(c),f===13){if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(s(317));e:{for(c=c.nextSibling,f=0;c;){if(c.nodeType===8)if(m=c.data,m==="/$"){if(f===0){fn=cr(c.nextSibling);break e}f--}else m!=="$"&&m!=="$!"&&m!=="$?"||f++;c=c.nextSibling}fn=null}}else f===27?(f=fn,ga(c.type)?(c=oC,oC=null,fn=c):fn=f):fn=zs?cr(c.stateNode.nextSibling):null;return!0}function Gf(){fn=zs=null,kt=!1}function j2(){var c=xl;return c!==null&&(no===null?no=c:no.push.apply(no,c),xl=null),c}function Hf(c){xl===null?xl=[c]:xl.push(c)}var Vw=X(null),bl=null,pi=null;function ta(c,f,m){re(Vw,f._currentValue),f._currentValue=m}function mi(c){c._currentValue=Vw.current,ie(Vw)}function zw(c,f,m){for(;c!==null;){var v=c.alternate;if((c.childLanes&f)!==f?(c.childLanes|=f,v!==null&&(v.childLanes|=f)):v!==null&&(v.childLanes&f)!==f&&(v.childLanes|=f),c===m)break;c=c.return}}function Bw(c,f,m,v){var S=c.child;for(S!==null&&(S.return=c);S!==null;){var E=S.dependencies;if(E!==null){var _=S.child;E=E.firstContext;e:for(;E!==null;){var z=E;E=S;for(var Y=0;Y<f.length;Y++)if(z.context===f[Y]){E.lanes|=m,z=E.alternate,z!==null&&(z.lanes|=m),zw(E.return,m,c),v||(_=null);break e}E=z.next}}else if(S.tag===18){if(_=S.return,_===null)throw Error(s(341));_.lanes|=m,E=_.alternate,E!==null&&(E.lanes|=m),zw(_,m,c),_=null}else _=S.child;if(_!==null)_.return=S;else for(_=S;_!==null;){if(_===c){_=null;break}if(S=_.sibling,S!==null){S.return=_.return,_=S;break}_=_.return}S=_}}function Wf(c,f,m,v){c=null;for(var S=f,E=!1;S!==null;){if(!E){if((S.flags&524288)!==0)E=!0;else if((S.flags&262144)!==0)break}if(S.tag===10){var _=S.alternate;if(_===null)throw Error(s(387));if(_=_.memoizedProps,_!==null){var z=S.type;xo(S.pendingProps.value,_.value)||(c!==null?c.push(z):c=[z])}}else if(S===Re.current){if(_=S.alternate,_===null)throw Error(s(387));_.memoizedState.memoizedState!==S.memoizedState.memoizedState&&(c!==null?c.push(bh):c=[bh])}S=S.return}c!==null&&Bw(f,c,m,v),f.flags|=262144}function Xg(c){for(c=c.firstContext;c!==null;){if(!xo(c.context._currentValue,c.memoizedValue))return!0;c=c.next}return!1}function wl(c){bl=c,pi=null,c=c.dependencies,c!==null&&(c.firstContext=null)}function Es(c){return Z2(bl,c)}function Yg(c,f){return bl===null&&wl(c),Z2(c,f)}function Z2(c,f){var m=f._currentValue;if(f={context:f,memoizedValue:m,next:null},pi===null){if(c===null)throw Error(s(308));pi=f,c.dependencies={lanes:0,firstContext:f},c.flags|=524288}else pi=pi.next=f;return m}var zq=typeof AbortController<"u"?AbortController:function(){var c=[],f=this.signal={aborted:!1,addEventListener:function(m,v){c.push(v)}};this.abort=function(){f.aborted=!0,c.forEach(function(m){return m()})}},Bq=t.unstable_scheduleCallback,Uq=t.unstable_NormalPriority,Un={$$typeof:I,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Uw(){return{controller:new zq,data:new Map,refCount:0}}function qf(c){c.refCount--,c.refCount===0&&Bq(Uq,function(){c.controller.abort()})}var Kf=null,Gw=0,ju=0,Zu=null;function Gq(c,f){if(Kf===null){var m=Kf=[];Gw=0,ju=W1(),Zu={status:"pending",value:void 0,then:function(v){m.push(v)}}}return Gw++,f.then(Q2,Q2),f}function Q2(){if(--Gw===0&&Kf!==null){Zu!==null&&(Zu.status="fulfilled");var c=Kf;Kf=null,ju=0,Zu=null;for(var f=0;f<c.length;f++)(0,c[f])()}}function Hq(c,f){var m=[],v={status:"pending",value:null,reason:null,then:function(S){m.push(S)}};return c.then(function(){v.status="fulfilled",v.value=f;for(var S=0;S<m.length;S++)(0,m[S])(f)},function(S){for(v.status="rejected",v.reason=S,S=0;S<m.length;S++)(0,m[S])(void 0)}),v}var eR=G.S;G.S=function(c,f){typeof f=="object"&&f!==null&&typeof f.then=="function"&&Gq(c,f),eR!==null&&eR(c,f)};var Cl=X(null);function Hw(){var c=Cl.current;return c!==null?c:qt.pooledCache}function Jg(c,f){f===null?re(Cl,Cl.current):re(Cl,f.pool)}function tR(){var c=Hw();return c===null?null:{parent:Un._currentValue,pool:c}}var Xf=Error(s(460)),nR=Error(s(474)),jg=Error(s(542)),Ww={then:function(){}};function sR(c){return c=c.status,c==="fulfilled"||c==="rejected"}function Zg(){}function oR(c,f,m){switch(m=c[m],m===void 0?c.push(f):m!==f&&(f.then(Zg,Zg),f=m),f.status){case"fulfilled":return f.value;case"rejected":throw c=f.reason,iR(c),c;default:if(typeof f.status=="string")f.then(Zg,Zg);else{if(c=qt,c!==null&&100<c.shellSuspendCounter)throw Error(s(482));c=f,c.status="pending",c.then(function(v){if(f.status==="pending"){var S=f;S.status="fulfilled",S.value=v}},function(v){if(f.status==="pending"){var S=f;S.status="rejected",S.reason=v}})}switch(f.status){case"fulfilled":return f.value;case"rejected":throw c=f.reason,iR(c),c}throw Yf=f,Xf}}var Yf=null;function rR(){if(Yf===null)throw Error(s(459));var c=Yf;return Yf=null,c}function iR(c){if(c===Xf||c===jg)throw Error(s(483))}var na=!1;function qw(c){c.updateQueue={baseState:c.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Kw(c,f){c=c.updateQueue,f.updateQueue===c&&(f.updateQueue={baseState:c.baseState,firstBaseUpdate:c.firstBaseUpdate,lastBaseUpdate:c.lastBaseUpdate,shared:c.shared,callbacks:null})}function sa(c){return{lane:c,tag:0,payload:null,callback:null,next:null}}function oa(c,f,m){var v=c.updateQueue;if(v===null)return null;if(v=v.shared,(_t&2)!==0){var S=v.pending;return S===null?f.next=f:(f.next=S.next,S.next=f),v.pending=f,f=Hg(c),q2(c,null,m),f}return Gg(c,v,f,m),Hg(c)}function Jf(c,f,m){if(f=f.updateQueue,f!==null&&(f=f.shared,(m&4194048)!==0)){var v=f.lanes;v&=c.pendingLanes,m|=v,f.lanes=m,QA(c,m)}}function Xw(c,f){var m=c.updateQueue,v=c.alternate;if(v!==null&&(v=v.updateQueue,m===v)){var S=null,E=null;if(m=m.firstBaseUpdate,m!==null){do{var _={lane:m.lane,tag:m.tag,payload:m.payload,callback:null,next:null};E===null?S=E=_:E=E.next=_,m=m.next}while(m!==null);E===null?S=E=f:E=E.next=f}else S=E=f;m={baseState:v.baseState,firstBaseUpdate:S,lastBaseUpdate:E,shared:v.shared,callbacks:v.callbacks},c.updateQueue=m;return}c=m.lastBaseUpdate,c===null?m.firstBaseUpdate=f:c.next=f,m.lastBaseUpdate=f}var Yw=!1;function jf(){if(Yw){var c=Zu;if(c!==null)throw c}}function Zf(c,f,m,v){Yw=!1;var S=c.updateQueue;na=!1;var E=S.firstBaseUpdate,_=S.lastBaseUpdate,z=S.shared.pending;if(z!==null){S.shared.pending=null;var Y=z,fe=Y.next;Y.next=null,_===null?E=fe:_.next=fe,_=Y;var xe=c.alternate;xe!==null&&(xe=xe.updateQueue,z=xe.lastBaseUpdate,z!==_&&(z===null?xe.firstBaseUpdate=fe:z.next=fe,xe.lastBaseUpdate=Y))}if(E!==null){var Ce=S.baseState;_=0,xe=fe=Y=null,z=E;do{var he=z.lane&-536870913,pe=he!==z.lane;if(pe?(vt&he)===he:(v&he)===he){he!==0&&he===ju&&(Yw=!0),xe!==null&&(xe=xe.next={lane:0,tag:z.tag,payload:z.payload,callback:null,next:null});e:{var Ye=c,He=z;he=f;var zt=m;switch(He.tag){case 1:if(Ye=He.payload,typeof Ye=="function"){Ce=Ye.call(zt,Ce,he);break e}Ce=Ye;break e;case 3:Ye.flags=Ye.flags&-65537|128;case 0:if(Ye=He.payload,he=typeof Ye=="function"?Ye.call(zt,Ce,he):Ye,he==null)break e;Ce=d({},Ce,he);break e;case 2:na=!0}}he=z.callback,he!==null&&(c.flags|=64,pe&&(c.flags|=8192),pe=S.callbacks,pe===null?S.callbacks=[he]:pe.push(he))}else pe={lane:he,tag:z.tag,payload:z.payload,callback:z.callback,next:null},xe===null?(fe=xe=pe,Y=Ce):xe=xe.next=pe,_|=he;if(z=z.next,z===null){if(z=S.shared.pending,z===null)break;pe=z,z=pe.next,pe.next=null,S.lastBaseUpdate=pe,S.shared.pending=null}}while(!0);xe===null&&(Y=Ce),S.baseState=Y,S.firstBaseUpdate=fe,S.lastBaseUpdate=xe,E===null&&(S.shared.lanes=0),fa|=_,c.lanes=_,c.memoizedState=Ce}}function aR(c,f){if(typeof c!="function")throw Error(s(191,c));c.call(f)}function lR(c,f){var m=c.callbacks;if(m!==null)for(c.callbacks=null,c=0;c<m.length;c++)aR(m[c],f)}var Qu=X(null),Qg=X(0);function uR(c,f){c=Ci,re(Qg,c),re(Qu,f),Ci=c|f.baseLanes}function Jw(){re(Qg,Ci),re(Qu,Qu.current)}function jw(){Ci=Qg.current,ie(Qu),ie(Qg)}var ra=0,at=null,Lt=null,$n=null,ey=!1,ec=!1,Tl=!1,ty=0,Qf=0,tc=null,Wq=0;function bn(){throw Error(s(321))}function Zw(c,f){if(f===null)return!1;for(var m=0;m<f.length&&m<c.length;m++)if(!xo(c[m],f[m]))return!1;return!0}function Qw(c,f,m,v,S,E){return ra=E,at=f,f.memoizedState=null,f.updateQueue=null,f.lanes=0,G.H=c===null||c.memoizedState===null?qR:KR,Tl=!1,E=m(v,S),Tl=!1,ec&&(E=dR(f,m,v,S)),cR(c),E}function cR(c){G.H=ay;var f=Lt!==null&&Lt.next!==null;if(ra=0,$n=Lt=at=null,ey=!1,Qf=0,tc=null,f)throw Error(s(300));c===null||ts||(c=c.dependencies,c!==null&&Xg(c)&&(ts=!0))}function dR(c,f,m,v){at=c;var S=0;do{if(ec&&(tc=null),Qf=0,ec=!1,25<=S)throw Error(s(301));if(S+=1,$n=Lt=null,c.updateQueue!=null){var E=c.updateQueue;E.lastEffect=null,E.events=null,E.stores=null,E.memoCache!=null&&(E.memoCache.index=0)}G.H=Zq,E=f(m,v)}while(ec);return E}function qq(){var c=G.H,f=c.useState()[0];return f=typeof f.then=="function"?eh(f):f,c=c.useState()[0],(Lt!==null?Lt.memoizedState:null)!==c&&(at.flags|=1024),f}function e1(){var c=ty!==0;return ty=0,c}function t1(c,f,m){f.updateQueue=c.updateQueue,f.flags&=-2053,c.lanes&=~m}function n1(c){if(ey){for(c=c.memoizedState;c!==null;){var f=c.queue;f!==null&&(f.pending=null),c=c.next}ey=!1}ra=0,$n=Lt=at=null,ec=!1,Qf=ty=0,tc=null}function eo(){var c={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return $n===null?at.memoizedState=$n=c:$n=$n.next=c,$n}function Dn(){if(Lt===null){var c=at.alternate;c=c!==null?c.memoizedState:null}else c=Lt.next;var f=$n===null?at.memoizedState:$n.next;if(f!==null)$n=f,Lt=c;else{if(c===null)throw at.alternate===null?Error(s(467)):Error(s(310));Lt=c,c={memoizedState:Lt.memoizedState,baseState:Lt.baseState,baseQueue:Lt.baseQueue,queue:Lt.queue,next:null},$n===null?at.memoizedState=$n=c:$n=$n.next=c}return $n}function s1(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function eh(c){var f=Qf;return Qf+=1,tc===null&&(tc=[]),c=oR(tc,c,f),f=at,($n===null?f.memoizedState:$n.next)===null&&(f=f.alternate,G.H=f===null||f.memoizedState===null?qR:KR),c}function ny(c){if(c!==null&&typeof c=="object"){if(typeof c.then=="function")return eh(c);if(c.$$typeof===I)return Es(c)}throw Error(s(438,String(c)))}function o1(c){var f=null,m=at.updateQueue;if(m!==null&&(f=m.memoCache),f==null){var v=at.alternate;v!==null&&(v=v.updateQueue,v!==null&&(v=v.memoCache,v!=null&&(f={data:v.data.map(function(S){return S.slice()}),index:0})))}if(f==null&&(f={data:[],index:0}),m===null&&(m=s1(),at.updateQueue=m),m.memoCache=f,m=f.data[f.index],m===void 0)for(m=f.data[f.index]=Array(c),v=0;v<c;v++)m[v]=P;return f.index++,m}function gi(c,f){return typeof f=="function"?f(c):f}function sy(c){var f=Dn();return r1(f,Lt,c)}function r1(c,f,m){var v=c.queue;if(v===null)throw Error(s(311));v.lastRenderedReducer=m;var S=c.baseQueue,E=v.pending;if(E!==null){if(S!==null){var _=S.next;S.next=E.next,E.next=_}f.baseQueue=S=E,v.pending=null}if(E=c.baseState,S===null)c.memoizedState=E;else{f=S.next;var z=_=null,Y=null,fe=f,xe=!1;do{var Ce=fe.lane&-536870913;if(Ce!==fe.lane?(vt&Ce)===Ce:(ra&Ce)===Ce){var he=fe.revertLane;if(he===0)Y!==null&&(Y=Y.next={lane:0,revertLane:0,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null}),Ce===ju&&(xe=!0);else if((ra&he)===he){fe=fe.next,he===ju&&(xe=!0);continue}else Ce={lane:0,revertLane:fe.revertLane,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null},Y===null?(z=Y=Ce,_=E):Y=Y.next=Ce,at.lanes|=he,fa|=he;Ce=fe.action,Tl&&m(E,Ce),E=fe.hasEagerState?fe.eagerState:m(E,Ce)}else he={lane:Ce,revertLane:fe.revertLane,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null},Y===null?(z=Y=he,_=E):Y=Y.next=he,at.lanes|=Ce,fa|=Ce;fe=fe.next}while(fe!==null&&fe!==f);if(Y===null?_=E:Y.next=z,!xo(E,c.memoizedState)&&(ts=!0,xe&&(m=Zu,m!==null)))throw m;c.memoizedState=E,c.baseState=_,c.baseQueue=Y,v.lastRenderedState=E}return S===null&&(v.lanes=0),[c.memoizedState,v.dispatch]}function i1(c){var f=Dn(),m=f.queue;if(m===null)throw Error(s(311));m.lastRenderedReducer=c;var v=m.dispatch,S=m.pending,E=f.memoizedState;if(S!==null){m.pending=null;var _=S=S.next;do E=c(E,_.action),_=_.next;while(_!==S);xo(E,f.memoizedState)||(ts=!0),f.memoizedState=E,f.baseQueue===null&&(f.baseState=E),m.lastRenderedState=E}return[E,v]}function fR(c,f,m){var v=at,S=Dn(),E=kt;if(E){if(m===void 0)throw Error(s(407));m=m()}else m=f();var _=!xo((Lt||S).memoizedState,m);_&&(S.memoizedState=m,ts=!0),S=S.queue;var z=mR.bind(null,v,S,c);if(th(2048,8,z,[c]),S.getSnapshot!==f||_||$n!==null&&$n.memoizedState.tag&1){if(v.flags|=2048,nc(9,oy(),pR.bind(null,v,S,m,f),null),qt===null)throw Error(s(349));E||(ra&124)!==0||hR(v,f,m)}return m}function hR(c,f,m){c.flags|=16384,c={getSnapshot:f,value:m},f=at.updateQueue,f===null?(f=s1(),at.updateQueue=f,f.stores=[c]):(m=f.stores,m===null?f.stores=[c]:m.push(c))}function pR(c,f,m,v){f.value=m,f.getSnapshot=v,gR(f)&&yR(c)}function mR(c,f,m){return m(function(){gR(f)&&yR(c)})}function gR(c){var f=c.getSnapshot;c=c.value;try{var m=f();return!xo(c,m)}catch{return!0}}function yR(c){var f=Ku(c,2);f!==null&&So(f,c,2)}function a1(c){var f=eo();if(typeof c=="function"){var m=c;if(c=m(),Tl){Rn(!0);try{m()}finally{Rn(!1)}}}return f.memoizedState=f.baseState=c,f.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:gi,lastRenderedState:c},f}function xR(c,f,m,v){return c.baseState=m,r1(c,Lt,typeof v=="function"?v:gi)}function Kq(c,f,m,v,S){if(iy(c))throw Error(s(485));if(c=f.action,c!==null){var E={payload:S,action:c,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(_){E.listeners.push(_)}};G.T!==null?m(!0):E.isTransition=!1,v(E),m=f.pending,m===null?(E.next=f.pending=E,vR(f,E)):(E.next=m.next,f.pending=m.next=E)}}function vR(c,f){var m=f.action,v=f.payload,S=c.state;if(f.isTransition){var E=G.T,_={};G.T=_;try{var z=m(S,v),Y=G.S;Y!==null&&Y(_,z),bR(c,f,z)}catch(fe){l1(c,f,fe)}finally{G.T=E}}else try{E=m(S,v),bR(c,f,E)}catch(fe){l1(c,f,fe)}}function bR(c,f,m){m!==null&&typeof m=="object"&&typeof m.then=="function"?m.then(function(v){wR(c,f,v)},function(v){return l1(c,f,v)}):wR(c,f,m)}function wR(c,f,m){f.status="fulfilled",f.value=m,CR(f),c.state=m,f=c.pending,f!==null&&(m=f.next,m===f?c.pending=null:(m=m.next,f.next=m,vR(c,m)))}function l1(c,f,m){var v=c.pending;if(c.pending=null,v!==null){v=v.next;do f.status="rejected",f.reason=m,CR(f),f=f.next;while(f!==v)}c.action=null}function CR(c){c=c.listeners;for(var f=0;f<c.length;f++)(0,c[f])()}function TR(c,f){return f}function SR(c,f){if(kt){var m=qt.formState;if(m!==null){e:{var v=at;if(kt){if(fn){t:{for(var S=fn,E=Dr;S.nodeType!==8;){if(!E){S=null;break t}if(S=cr(S.nextSibling),S===null){S=null;break t}}E=S.data,S=E==="F!"||E==="F"?S:null}if(S){fn=cr(S.nextSibling),v=S.data==="F!";break e}}vl(v)}v=!1}v&&(f=m[0])}}return m=eo(),m.memoizedState=m.baseState=f,v={pending:null,lanes:0,dispatch:null,lastRenderedReducer:TR,lastRenderedState:f},m.queue=v,m=GR.bind(null,at,v),v.dispatch=m,v=a1(!1),E=h1.bind(null,at,!1,v.queue),v=eo(),S={state:f,dispatch:null,action:c,pending:null},v.queue=S,m=Kq.bind(null,at,S,E,m),S.dispatch=m,v.memoizedState=c,[f,m,!1]}function NR(c){var f=Dn();return ER(f,Lt,c)}function ER(c,f,m){if(f=r1(c,f,TR)[0],c=sy(gi)[0],typeof f=="object"&&f!==null&&typeof f.then=="function")try{var v=eh(f)}catch(_){throw _===Xf?jg:_}else v=f;f=Dn();var S=f.queue,E=S.dispatch;return m!==f.memoizedState&&(at.flags|=2048,nc(9,oy(),Xq.bind(null,S,m),null)),[v,E,c]}function Xq(c,f){c.action=f}function IR(c){var f=Dn(),m=Lt;if(m!==null)return ER(f,m,c);Dn(),f=f.memoizedState,m=Dn();var v=m.queue.dispatch;return m.memoizedState=c,[f,v,!1]}function nc(c,f,m,v){return c={tag:c,create:m,deps:v,inst:f,next:null},f=at.updateQueue,f===null&&(f=s1(),at.updateQueue=f),m=f.lastEffect,m===null?f.lastEffect=c.next=c:(v=m.next,m.next=c,c.next=v,f.lastEffect=c),c}function oy(){return{destroy:void 0,resource:void 0}}function kR(){return Dn().memoizedState}function ry(c,f,m,v){var S=eo();v=v===void 0?null:v,at.flags|=c,S.memoizedState=nc(1|f,oy(),m,v)}function th(c,f,m,v){var S=Dn();v=v===void 0?null:v;var E=S.memoizedState.inst;Lt!==null&&v!==null&&Zw(v,Lt.memoizedState.deps)?S.memoizedState=nc(f,E,m,v):(at.flags|=c,S.memoizedState=nc(1|f,E,m,v))}function AR(c,f){ry(8390656,8,c,f)}function RR(c,f){th(2048,8,c,f)}function $R(c,f){return th(4,2,c,f)}function DR(c,f){return th(4,4,c,f)}function _R(c,f){if(typeof f=="function"){c=c();var m=f(c);return function(){typeof m=="function"?m():f(null)}}if(f!=null)return c=c(),f.current=c,function(){f.current=null}}function MR(c,f,m){m=m!=null?m.concat([c]):null,th(4,4,_R.bind(null,f,c),m)}function u1(){}function FR(c,f){var m=Dn();f=f===void 0?null:f;var v=m.memoizedState;return f!==null&&Zw(f,v[1])?v[0]:(m.memoizedState=[c,f],c)}function OR(c,f){var m=Dn();f=f===void 0?null:f;var v=m.memoizedState;if(f!==null&&Zw(f,v[1]))return v[0];if(v=c(),Tl){Rn(!0);try{c()}finally{Rn(!1)}}return m.memoizedState=[v,f],v}function c1(c,f,m){return m===void 0||(ra&1073741824)!==0?c.memoizedState=f:(c.memoizedState=m,c=V$(),at.lanes|=c,fa|=c,m)}function PR(c,f,m,v){return xo(m,f)?m:Qu.current!==null?(c=c1(c,m,v),xo(c,f)||(ts=!0),c):(ra&42)===0?(ts=!0,c.memoizedState=m):(c=V$(),at.lanes|=c,fa|=c,f)}function LR(c,f,m,v,S){var E=q.p;q.p=E!==0&&8>E?E:8;var _=G.T,z={};G.T=z,h1(c,!1,f,m);try{var Y=S(),fe=G.S;if(fe!==null&&fe(z,Y),Y!==null&&typeof Y=="object"&&typeof Y.then=="function"){var xe=Hq(Y,v);nh(c,f,xe,To(c))}else nh(c,f,v,To(c))}catch(Ce){nh(c,f,{then:function(){},status:"rejected",reason:Ce},To())}finally{q.p=E,G.T=_}}function Yq(){}function d1(c,f,m,v){if(c.tag!==5)throw Error(s(476));var S=VR(c).queue;LR(c,S,f,J,m===null?Yq:function(){return zR(c),m(v)})}function VR(c){var f=c.memoizedState;if(f!==null)return f;f={memoizedState:J,baseState:J,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:gi,lastRenderedState:J},next:null};var m={};return f.next={memoizedState:m,baseState:m,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:gi,lastRenderedState:m},next:null},c.memoizedState=f,c=c.alternate,c!==null&&(c.memoizedState=f),f}function zR(c){var f=VR(c).next.queue;nh(c,f,{},To())}function f1(){return Es(bh)}function BR(){return Dn().memoizedState}function UR(){return Dn().memoizedState}function Jq(c){for(var f=c.return;f!==null;){switch(f.tag){case 24:case 3:var m=To();c=sa(m);var v=oa(f,c,m);v!==null&&(So(v,f,m),Jf(v,f,m)),f={cache:Uw()},c.payload=f;return}f=f.return}}function jq(c,f,m){var v=To();m={lane:v,revertLane:0,action:m,hasEagerState:!1,eagerState:null,next:null},iy(c)?HR(f,m):(m=Dw(c,f,m,v),m!==null&&(So(m,c,v),WR(m,f,v)))}function GR(c,f,m){var v=To();nh(c,f,m,v)}function nh(c,f,m,v){var S={lane:v,revertLane:0,action:m,hasEagerState:!1,eagerState:null,next:null};if(iy(c))HR(f,S);else{var E=c.alternate;if(c.lanes===0&&(E===null||E.lanes===0)&&(E=f.lastRenderedReducer,E!==null))try{var _=f.lastRenderedState,z=E(_,m);if(S.hasEagerState=!0,S.eagerState=z,xo(z,_))return Gg(c,f,S,0),qt===null&&Ug(),!1}catch{}finally{}if(m=Dw(c,f,S,v),m!==null)return So(m,c,v),WR(m,f,v),!0}return!1}function h1(c,f,m,v){if(v={lane:2,revertLane:W1(),action:v,hasEagerState:!1,eagerState:null,next:null},iy(c)){if(f)throw Error(s(479))}else f=Dw(c,m,v,2),f!==null&&So(f,c,2)}function iy(c){var f=c.alternate;return c===at||f!==null&&f===at}function HR(c,f){ec=ey=!0;var m=c.pending;m===null?f.next=f:(f.next=m.next,m.next=f),c.pending=f}function WR(c,f,m){if((m&4194048)!==0){var v=f.lanes;v&=c.pendingLanes,m|=v,f.lanes=m,QA(c,m)}}var ay={readContext:Es,use:ny,useCallback:bn,useContext:bn,useEffect:bn,useImperativeHandle:bn,useLayoutEffect:bn,useInsertionEffect:bn,useMemo:bn,useReducer:bn,useRef:bn,useState:bn,useDebugValue:bn,useDeferredValue:bn,useTransition:bn,useSyncExternalStore:bn,useId:bn,useHostTransitionStatus:bn,useFormState:bn,useActionState:bn,useOptimistic:bn,useMemoCache:bn,useCacheRefresh:bn},qR={readContext:Es,use:ny,useCallback:function(c,f){return eo().memoizedState=[c,f===void 0?null:f],c},useContext:Es,useEffect:AR,useImperativeHandle:function(c,f,m){m=m!=null?m.concat([c]):null,ry(4194308,4,_R.bind(null,f,c),m)},useLayoutEffect:function(c,f){return ry(4194308,4,c,f)},useInsertionEffect:function(c,f){ry(4,2,c,f)},useMemo:function(c,f){var m=eo();f=f===void 0?null:f;var v=c();if(Tl){Rn(!0);try{c()}finally{Rn(!1)}}return m.memoizedState=[v,f],v},useReducer:function(c,f,m){var v=eo();if(m!==void 0){var S=m(f);if(Tl){Rn(!0);try{m(f)}finally{Rn(!1)}}}else S=f;return v.memoizedState=v.baseState=S,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:c,lastRenderedState:S},v.queue=c,c=c.dispatch=jq.bind(null,at,c),[v.memoizedState,c]},useRef:function(c){var f=eo();return c={current:c},f.memoizedState=c},useState:function(c){c=a1(c);var f=c.queue,m=GR.bind(null,at,f);return f.dispatch=m,[c.memoizedState,m]},useDebugValue:u1,useDeferredValue:function(c,f){var m=eo();return c1(m,c,f)},useTransition:function(){var c=a1(!1);return c=LR.bind(null,at,c.queue,!0,!1),eo().memoizedState=c,[!1,c]},useSyncExternalStore:function(c,f,m){var v=at,S=eo();if(kt){if(m===void 0)throw Error(s(407));m=m()}else{if(m=f(),qt===null)throw Error(s(349));(vt&124)!==0||hR(v,f,m)}S.memoizedState=m;var E={value:m,getSnapshot:f};return S.queue=E,AR(mR.bind(null,v,E,c),[c]),v.flags|=2048,nc(9,oy(),pR.bind(null,v,E,m,f),null),m},useId:function(){var c=eo(),f=qt.identifierPrefix;if(kt){var m=hi,v=fi;m=(v&~(1<<32-ln(v)-1)).toString(32)+m,f=""+f+"R"+m,m=ty++,0<m&&(f+="H"+m.toString(32)),f+=""}else m=Wq++,f=""+f+"r"+m.toString(32)+"";return c.memoizedState=f},useHostTransitionStatus:f1,useFormState:SR,useActionState:SR,useOptimistic:function(c){var f=eo();f.memoizedState=f.baseState=c;var m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return f.queue=m,f=h1.bind(null,at,!0,m),m.dispatch=f,[c,f]},useMemoCache:o1,useCacheRefresh:function(){return eo().memoizedState=Jq.bind(null,at)}},KR={readContext:Es,use:ny,useCallback:FR,useContext:Es,useEffect:RR,useImperativeHandle:MR,useInsertionEffect:$R,useLayoutEffect:DR,useMemo:OR,useReducer:sy,useRef:kR,useState:function(){return sy(gi)},useDebugValue:u1,useDeferredValue:function(c,f){var m=Dn();return PR(m,Lt.memoizedState,c,f)},useTransition:function(){var c=sy(gi)[0],f=Dn().memoizedState;return[typeof c=="boolean"?c:eh(c),f]},useSyncExternalStore:fR,useId:BR,useHostTransitionStatus:f1,useFormState:NR,useActionState:NR,useOptimistic:function(c,f){var m=Dn();return xR(m,Lt,c,f)},useMemoCache:o1,useCacheRefresh:UR},Zq={readContext:Es,use:ny,useCallback:FR,useContext:Es,useEffect:RR,useImperativeHandle:MR,useInsertionEffect:$R,useLayoutEffect:DR,useMemo:OR,useReducer:i1,useRef:kR,useState:function(){return i1(gi)},useDebugValue:u1,useDeferredValue:function(c,f){var m=Dn();return Lt===null?c1(m,c,f):PR(m,Lt.memoizedState,c,f)},useTransition:function(){var c=i1(gi)[0],f=Dn().memoizedState;return[typeof c=="boolean"?c:eh(c),f]},useSyncExternalStore:fR,useId:BR,useHostTransitionStatus:f1,useFormState:IR,useActionState:IR,useOptimistic:function(c,f){var m=Dn();return Lt!==null?xR(m,Lt,c,f):(m.baseState=c,[c,m.queue.dispatch])},useMemoCache:o1,useCacheRefresh:UR},sc=null,sh=0;function ly(c){var f=sh;return sh+=1,sc===null&&(sc=[]),oR(sc,c,f)}function oh(c,f){f=f.props.ref,c.ref=f!==void 0?f:null}function uy(c,f){throw f.$$typeof===h?Error(s(525)):(c=Object.prototype.toString.call(f),Error(s(31,c==="[object Object]"?"object with keys {"+Object.keys(f).join(", ")+"}":c)))}function XR(c){var f=c._init;return f(c._payload)}function YR(c){function f(ae,se){if(c){var de=ae.deletions;de===null?(ae.deletions=[se],ae.flags|=16):de.push(se)}}function m(ae,se){if(!c)return null;for(;se!==null;)f(ae,se),se=se.sibling;return null}function v(ae){for(var se=new Map;ae!==null;)ae.key!==null?se.set(ae.key,ae):se.set(ae.index,ae),ae=ae.sibling;return se}function S(ae,se){return ae=di(ae,se),ae.index=0,ae.sibling=null,ae}function E(ae,se,de){return ae.index=de,c?(de=ae.alternate,de!==null?(de=de.index,de<se?(ae.flags|=67108866,se):de):(ae.flags|=67108866,se)):(ae.flags|=1048576,se)}function _(ae){return c&&ae.alternate===null&&(ae.flags|=67108866),ae}function z(ae,se,de,we){return se===null||se.tag!==6?(se=Mw(de,ae.mode,we),se.return=ae,se):(se=S(se,de),se.return=ae,se)}function Y(ae,se,de,we){var Oe=de.type;return Oe===b?xe(ae,se,de.props.children,we,de.key):se!==null&&(se.elementType===Oe||typeof Oe=="object"&&Oe!==null&&Oe.$$typeof===O&&XR(Oe)===se.type)?(se=S(se,de.props),oh(se,de),se.return=ae,se):(se=Wg(de.type,de.key,de.props,null,ae.mode,we),oh(se,de),se.return=ae,se)}function fe(ae,se,de,we){return se===null||se.tag!==4||se.stateNode.containerInfo!==de.containerInfo||se.stateNode.implementation!==de.implementation?(se=Fw(de,ae.mode,we),se.return=ae,se):(se=S(se,de.children||[]),se.return=ae,se)}function xe(ae,se,de,we,Oe){return se===null||se.tag!==7?(se=ml(de,ae.mode,we,Oe),se.return=ae,se):(se=S(se,de),se.return=ae,se)}function Ce(ae,se,de){if(typeof se=="string"&&se!==""||typeof se=="number"||typeof se=="bigint")return se=Mw(""+se,ae.mode,de),se.return=ae,se;if(typeof se=="object"&&se!==null){switch(se.$$typeof){case p:return de=Wg(se.type,se.key,se.props,null,ae.mode,de),oh(de,se),de.return=ae,de;case x:return se=Fw(se,ae.mode,de),se.return=ae,se;case O:var we=se._init;return se=we(se._payload),Ce(ae,se,de)}if(Q(se)||H(se))return se=ml(se,ae.mode,de,null),se.return=ae,se;if(typeof se.then=="function")return Ce(ae,ly(se),de);if(se.$$typeof===I)return Ce(ae,Yg(ae,se),de);uy(ae,se)}return null}function he(ae,se,de,we){var Oe=se!==null?se.key:null;if(typeof de=="string"&&de!==""||typeof de=="number"||typeof de=="bigint")return Oe!==null?null:z(ae,se,""+de,we);if(typeof de=="object"&&de!==null){switch(de.$$typeof){case p:return de.key===Oe?Y(ae,se,de,we):null;case x:return de.key===Oe?fe(ae,se,de,we):null;case O:return Oe=de._init,de=Oe(de._payload),he(ae,se,de,we)}if(Q(de)||H(de))return Oe!==null?null:xe(ae,se,de,we,null);if(typeof de.then=="function")return he(ae,se,ly(de),we);if(de.$$typeof===I)return he(ae,se,Yg(ae,de),we);uy(ae,de)}return null}function pe(ae,se,de,we,Oe){if(typeof we=="string"&&we!==""||typeof we=="number"||typeof we=="bigint")return ae=ae.get(de)||null,z(se,ae,""+we,Oe);if(typeof we=="object"&&we!==null){switch(we.$$typeof){case p:return ae=ae.get(we.key===null?de:we.key)||null,Y(se,ae,we,Oe);case x:return ae=ae.get(we.key===null?de:we.key)||null,fe(se,ae,we,Oe);case O:var ut=we._init;return we=ut(we._payload),pe(ae,se,de,we,Oe)}if(Q(we)||H(we))return ae=ae.get(de)||null,xe(se,ae,we,Oe,null);if(typeof we.then=="function")return pe(ae,se,de,ly(we),Oe);if(we.$$typeof===I)return pe(ae,se,de,Yg(se,we),Oe);uy(se,we)}return null}function Ye(ae,se,de,we){for(var Oe=null,ut=null,Ue=se,We=se=0,ss=null;Ue!==null&&We<de.length;We++){Ue.index>We?(ss=Ue,Ue=null):ss=Ue.sibling;var Nt=he(ae,Ue,de[We],we);if(Nt===null){Ue===null&&(Ue=ss);break}c&&Ue&&Nt.alternate===null&&f(ae,Ue),se=E(Nt,se,We),ut===null?Oe=Nt:ut.sibling=Nt,ut=Nt,Ue=ss}if(We===de.length)return m(ae,Ue),kt&&yl(ae,We),Oe;if(Ue===null){for(;We<de.length;We++)Ue=Ce(ae,de[We],we),Ue!==null&&(se=E(Ue,se,We),ut===null?Oe=Ue:ut.sibling=Ue,ut=Ue);return kt&&yl(ae,We),Oe}for(Ue=v(Ue);We<de.length;We++)ss=pe(Ue,ae,We,de[We],we),ss!==null&&(c&&ss.alternate!==null&&Ue.delete(ss.key===null?We:ss.key),se=E(ss,se,We),ut===null?Oe=ss:ut.sibling=ss,ut=ss);return c&&Ue.forEach(function(wa){return f(ae,wa)}),kt&&yl(ae,We),Oe}function He(ae,se,de,we){if(de==null)throw Error(s(151));for(var Oe=null,ut=null,Ue=se,We=se=0,ss=null,Nt=de.next();Ue!==null&&!Nt.done;We++,Nt=de.next()){Ue.index>We?(ss=Ue,Ue=null):ss=Ue.sibling;var wa=he(ae,Ue,Nt.value,we);if(wa===null){Ue===null&&(Ue=ss);break}c&&Ue&&wa.alternate===null&&f(ae,Ue),se=E(wa,se,We),ut===null?Oe=wa:ut.sibling=wa,ut=wa,Ue=ss}if(Nt.done)return m(ae,Ue),kt&&yl(ae,We),Oe;if(Ue===null){for(;!Nt.done;We++,Nt=de.next())Nt=Ce(ae,Nt.value,we),Nt!==null&&(se=E(Nt,se,We),ut===null?Oe=Nt:ut.sibling=Nt,ut=Nt);return kt&&yl(ae,We),Oe}for(Ue=v(Ue);!Nt.done;We++,Nt=de.next())Nt=pe(Ue,ae,We,Nt.value,we),Nt!==null&&(c&&Nt.alternate!==null&&Ue.delete(Nt.key===null?We:Nt.key),se=E(Nt,se,We),ut===null?Oe=Nt:ut.sibling=Nt,ut=Nt);return c&&Ue.forEach(function(Q6){return f(ae,Q6)}),kt&&yl(ae,We),Oe}function zt(ae,se,de,we){if(typeof de=="object"&&de!==null&&de.type===b&&de.key===null&&(de=de.props.children),typeof de=="object"&&de!==null){switch(de.$$typeof){case p:e:{for(var Oe=de.key;se!==null;){if(se.key===Oe){if(Oe=de.type,Oe===b){if(se.tag===7){m(ae,se.sibling),we=S(se,de.props.children),we.return=ae,ae=we;break e}}else if(se.elementType===Oe||typeof Oe=="object"&&Oe!==null&&Oe.$$typeof===O&&XR(Oe)===se.type){m(ae,se.sibling),we=S(se,de.props),oh(we,de),we.return=ae,ae=we;break e}m(ae,se);break}else f(ae,se);se=se.sibling}de.type===b?(we=ml(de.props.children,ae.mode,we,de.key),we.return=ae,ae=we):(we=Wg(de.type,de.key,de.props,null,ae.mode,we),oh(we,de),we.return=ae,ae=we)}return _(ae);case x:e:{for(Oe=de.key;se!==null;){if(se.key===Oe)if(se.tag===4&&se.stateNode.containerInfo===de.containerInfo&&se.stateNode.implementation===de.implementation){m(ae,se.sibling),we=S(se,de.children||[]),we.return=ae,ae=we;break e}else{m(ae,se);break}else f(ae,se);se=se.sibling}we=Fw(de,ae.mode,we),we.return=ae,ae=we}return _(ae);case O:return Oe=de._init,de=Oe(de._payload),zt(ae,se,de,we)}if(Q(de))return Ye(ae,se,de,we);if(H(de)){if(Oe=H(de),typeof Oe!="function")throw Error(s(150));return de=Oe.call(de),He(ae,se,de,we)}if(typeof de.then=="function")return zt(ae,se,ly(de),we);if(de.$$typeof===I)return zt(ae,se,Yg(ae,de),we);uy(ae,de)}return typeof de=="string"&&de!==""||typeof de=="number"||typeof de=="bigint"?(de=""+de,se!==null&&se.tag===6?(m(ae,se.sibling),we=S(se,de),we.return=ae,ae=we):(m(ae,se),we=Mw(de,ae.mode,we),we.return=ae,ae=we),_(ae)):m(ae,se)}return function(ae,se,de,we){try{sh=0;var Oe=zt(ae,se,de,we);return sc=null,Oe}catch(Ue){if(Ue===Xf||Ue===jg)throw Ue;var ut=vo(29,Ue,null,ae.mode);return ut.lanes=we,ut.return=ae,ut}finally{}}}var oc=YR(!0),JR=YR(!1),Go=X(null),_r=null;function ia(c){var f=c.alternate;re(Gn,Gn.current&1),re(Go,c),_r===null&&(f===null||Qu.current!==null||f.memoizedState!==null)&&(_r=c)}function jR(c){if(c.tag===22){if(re(Gn,Gn.current),re(Go,c),_r===null){var f=c.alternate;f!==null&&f.memoizedState!==null&&(_r=c)}}else aa()}function aa(){re(Gn,Gn.current),re(Go,Go.current)}function yi(c){ie(Go),_r===c&&(_r=null),ie(Gn)}var Gn=X(0);function cy(c){for(var f=c;f!==null;){if(f.tag===13){var m=f.memoizedState;if(m!==null&&(m=m.dehydrated,m===null||m.data==="$?"||sC(m)))return f}else if(f.tag===19&&f.memoizedProps.revealOrder!==void 0){if((f.flags&128)!==0)return f}else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===c)break;for(;f.sibling===null;){if(f.return===null||f.return===c)return null;f=f.return}f.sibling.return=f.return,f=f.sibling}return null}function p1(c,f,m,v){f=c.memoizedState,m=m(v,f),m=m==null?f:d({},f,m),c.memoizedState=m,c.lanes===0&&(c.updateQueue.baseState=m)}var m1={enqueueSetState:function(c,f,m){c=c._reactInternals;var v=To(),S=sa(v);S.payload=f,m!=null&&(S.callback=m),f=oa(c,S,v),f!==null&&(So(f,c,v),Jf(f,c,v))},enqueueReplaceState:function(c,f,m){c=c._reactInternals;var v=To(),S=sa(v);S.tag=1,S.payload=f,m!=null&&(S.callback=m),f=oa(c,S,v),f!==null&&(So(f,c,v),Jf(f,c,v))},enqueueForceUpdate:function(c,f){c=c._reactInternals;var m=To(),v=sa(m);v.tag=2,f!=null&&(v.callback=f),f=oa(c,v,m),f!==null&&(So(f,c,m),Jf(f,c,m))}};function ZR(c,f,m,v,S,E,_){return c=c.stateNode,typeof c.shouldComponentUpdate=="function"?c.shouldComponentUpdate(v,E,_):f.prototype&&f.prototype.isPureReactComponent?!zf(m,v)||!zf(S,E):!0}function QR(c,f,m,v){c=f.state,typeof f.componentWillReceiveProps=="function"&&f.componentWillReceiveProps(m,v),typeof f.UNSAFE_componentWillReceiveProps=="function"&&f.UNSAFE_componentWillReceiveProps(m,v),f.state!==c&&m1.enqueueReplaceState(f,f.state,null)}function Sl(c,f){var m=f;if("ref"in f){m={};for(var v in f)v!=="ref"&&(m[v]=f[v])}if(c=c.defaultProps){m===f&&(m=d({},m));for(var S in c)m[S]===void 0&&(m[S]=c[S])}return m}var dy=typeof reportError=="function"?reportError:function(c){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var f=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof c=="object"&&c!==null&&typeof c.message=="string"?String(c.message):String(c),error:c});if(!window.dispatchEvent(f))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",c);return}console.error(c)};function e$(c){dy(c)}function t$(c){console.error(c)}function n$(c){dy(c)}function fy(c,f){try{var m=c.onUncaughtError;m(f.value,{componentStack:f.stack})}catch(v){setTimeout(function(){throw v})}}function s$(c,f,m){try{var v=c.onCaughtError;v(m.value,{componentStack:m.stack,errorBoundary:f.tag===1?f.stateNode:null})}catch(S){setTimeout(function(){throw S})}}function g1(c,f,m){return m=sa(m),m.tag=3,m.payload={element:null},m.callback=function(){fy(c,f)},m}function o$(c){return c=sa(c),c.tag=3,c}function r$(c,f,m,v){var S=m.type.getDerivedStateFromError;if(typeof S=="function"){var E=v.value;c.payload=function(){return S(E)},c.callback=function(){s$(f,m,v)}}var _=m.stateNode;_!==null&&typeof _.componentDidCatch=="function"&&(c.callback=function(){s$(f,m,v),typeof S!="function"&&(ha===null?ha=new Set([this]):ha.add(this));var z=v.stack;this.componentDidCatch(v.value,{componentStack:z!==null?z:""})})}function Qq(c,f,m,v,S){if(m.flags|=32768,v!==null&&typeof v=="object"&&typeof v.then=="function"){if(f=m.alternate,f!==null&&Wf(f,m,S,!0),m=Go.current,m!==null){switch(m.tag){case 13:return _r===null?z1():m.alternate===null&&hn===0&&(hn=3),m.flags&=-257,m.flags|=65536,m.lanes=S,v===Ww?m.flags|=16384:(f=m.updateQueue,f===null?m.updateQueue=new Set([v]):f.add(v),U1(c,v,S)),!1;case 22:return m.flags|=65536,v===Ww?m.flags|=16384:(f=m.updateQueue,f===null?(f={transitions:null,markerInstances:null,retryQueue:new Set([v])},m.updateQueue=f):(m=f.retryQueue,m===null?f.retryQueue=new Set([v]):m.add(v)),U1(c,v,S)),!1}throw Error(s(435,m.tag))}return U1(c,v,S),z1(),!1}if(kt)return f=Go.current,f!==null?((f.flags&65536)===0&&(f.flags|=256),f.flags|=65536,f.lanes=S,v!==Lw&&(c=Error(s(422),{cause:v}),Hf(Vo(c,m)))):(v!==Lw&&(f=Error(s(423),{cause:v}),Hf(Vo(f,m))),c=c.current.alternate,c.flags|=65536,S&=-S,c.lanes|=S,v=Vo(v,m),S=g1(c.stateNode,v,S),Xw(c,S),hn!==4&&(hn=2)),!1;var E=Error(s(520),{cause:v});if(E=Vo(E,m),dh===null?dh=[E]:dh.push(E),hn!==4&&(hn=2),f===null)return!0;v=Vo(v,m),m=f;do{switch(m.tag){case 3:return m.flags|=65536,c=S&-S,m.lanes|=c,c=g1(m.stateNode,v,c),Xw(m,c),!1;case 1:if(f=m.type,E=m.stateNode,(m.flags&128)===0&&(typeof f.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(ha===null||!ha.has(E))))return m.flags|=65536,S&=-S,m.lanes|=S,S=o$(S),r$(S,c,m,v),Xw(m,S),!1}m=m.return}while(m!==null);return!1}var i$=Error(s(461)),ts=!1;function gs(c,f,m,v){f.child=c===null?JR(f,null,m,v):oc(f,c.child,m,v)}function a$(c,f,m,v,S){m=m.render;var E=f.ref;if("ref"in v){var _={};for(var z in v)z!=="ref"&&(_[z]=v[z])}else _=v;return wl(f),v=Qw(c,f,m,_,E,S),z=e1(),c!==null&&!ts?(t1(c,f,S),xi(c,f,S)):(kt&&z&&Ow(f),f.flags|=1,gs(c,f,v,S),f.child)}function l$(c,f,m,v,S){if(c===null){var E=m.type;return typeof E=="function"&&!_w(E)&&E.defaultProps===void 0&&m.compare===null?(f.tag=15,f.type=E,u$(c,f,E,v,S)):(c=Wg(m.type,null,v,f,f.mode,S),c.ref=f.ref,c.return=f,f.child=c)}if(E=c.child,!S1(c,S)){var _=E.memoizedProps;if(m=m.compare,m=m!==null?m:zf,m(_,v)&&c.ref===f.ref)return xi(c,f,S)}return f.flags|=1,c=di(E,v),c.ref=f.ref,c.return=f,f.child=c}function u$(c,f,m,v,S){if(c!==null){var E=c.memoizedProps;if(zf(E,v)&&c.ref===f.ref)if(ts=!1,f.pendingProps=v=E,S1(c,S))(c.flags&131072)!==0&&(ts=!0);else return f.lanes=c.lanes,xi(c,f,S)}return y1(c,f,m,v,S)}function c$(c,f,m){var v=f.pendingProps,S=v.children,E=c!==null?c.memoizedState:null;if(v.mode==="hidden"){if((f.flags&128)!==0){if(v=E!==null?E.baseLanes|m:m,c!==null){for(S=f.child=c.child,E=0;S!==null;)E=E|S.lanes|S.childLanes,S=S.sibling;f.childLanes=E&~v}else f.childLanes=0,f.child=null;return d$(c,f,v,m)}if((m&536870912)!==0)f.memoizedState={baseLanes:0,cachePool:null},c!==null&&Jg(f,E!==null?E.cachePool:null),E!==null?uR(f,E):Jw(),jR(f);else return f.lanes=f.childLanes=536870912,d$(c,f,E!==null?E.baseLanes|m:m,m)}else E!==null?(Jg(f,E.cachePool),uR(f,E),aa(),f.memoizedState=null):(c!==null&&Jg(f,null),Jw(),aa());return gs(c,f,S,m),f.child}function d$(c,f,m,v){var S=Hw();return S=S===null?null:{parent:Un._currentValue,pool:S},f.memoizedState={baseLanes:m,cachePool:S},c!==null&&Jg(f,null),Jw(),jR(f),c!==null&&Wf(c,f,v,!0),null}function hy(c,f){var m=f.ref;if(m===null)c!==null&&c.ref!==null&&(f.flags|=4194816);else{if(typeof m!="function"&&typeof m!="object")throw Error(s(284));(c===null||c.ref!==m)&&(f.flags|=4194816)}}function y1(c,f,m,v,S){return wl(f),m=Qw(c,f,m,v,void 0,S),v=e1(),c!==null&&!ts?(t1(c,f,S),xi(c,f,S)):(kt&&v&&Ow(f),f.flags|=1,gs(c,f,m,S),f.child)}function f$(c,f,m,v,S,E){return wl(f),f.updateQueue=null,m=dR(f,v,m,S),cR(c),v=e1(),c!==null&&!ts?(t1(c,f,E),xi(c,f,E)):(kt&&v&&Ow(f),f.flags|=1,gs(c,f,m,E),f.child)}function h$(c,f,m,v,S){if(wl(f),f.stateNode===null){var E=Xu,_=m.contextType;typeof _=="object"&&_!==null&&(E=Es(_)),E=new m(v,E),f.memoizedState=E.state!==null&&E.state!==void 0?E.state:null,E.updater=m1,f.stateNode=E,E._reactInternals=f,E=f.stateNode,E.props=v,E.state=f.memoizedState,E.refs={},qw(f),_=m.contextType,E.context=typeof _=="object"&&_!==null?Es(_):Xu,E.state=f.memoizedState,_=m.getDerivedStateFromProps,typeof _=="function"&&(p1(f,m,_,v),E.state=f.memoizedState),typeof m.getDerivedStateFromProps=="function"||typeof E.getSnapshotBeforeUpdate=="function"||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(_=E.state,typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount(),_!==E.state&&m1.enqueueReplaceState(E,E.state,null),Zf(f,v,E,S),jf(),E.state=f.memoizedState),typeof E.componentDidMount=="function"&&(f.flags|=4194308),v=!0}else if(c===null){E=f.stateNode;var z=f.memoizedProps,Y=Sl(m,z);E.props=Y;var fe=E.context,xe=m.contextType;_=Xu,typeof xe=="object"&&xe!==null&&(_=Es(xe));var Ce=m.getDerivedStateFromProps;xe=typeof Ce=="function"||typeof E.getSnapshotBeforeUpdate=="function",z=f.pendingProps!==z,xe||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(z||fe!==_)&&QR(f,E,v,_),na=!1;var he=f.memoizedState;E.state=he,Zf(f,v,E,S),jf(),fe=f.memoizedState,z||he!==fe||na?(typeof Ce=="function"&&(p1(f,m,Ce,v),fe=f.memoizedState),(Y=na||ZR(f,m,Y,v,he,fe,_))?(xe||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount()),typeof E.componentDidMount=="function"&&(f.flags|=4194308)):(typeof E.componentDidMount=="function"&&(f.flags|=4194308),f.memoizedProps=v,f.memoizedState=fe),E.props=v,E.state=fe,E.context=_,v=Y):(typeof E.componentDidMount=="function"&&(f.flags|=4194308),v=!1)}else{E=f.stateNode,Kw(c,f),_=f.memoizedProps,xe=Sl(m,_),E.props=xe,Ce=f.pendingProps,he=E.context,fe=m.contextType,Y=Xu,typeof fe=="object"&&fe!==null&&(Y=Es(fe)),z=m.getDerivedStateFromProps,(fe=typeof z=="function"||typeof E.getSnapshotBeforeUpdate=="function")||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(_!==Ce||he!==Y)&&QR(f,E,v,Y),na=!1,he=f.memoizedState,E.state=he,Zf(f,v,E,S),jf();var pe=f.memoizedState;_!==Ce||he!==pe||na||c!==null&&c.dependencies!==null&&Xg(c.dependencies)?(typeof z=="function"&&(p1(f,m,z,v),pe=f.memoizedState),(xe=na||ZR(f,m,xe,v,he,pe,Y)||c!==null&&c.dependencies!==null&&Xg(c.dependencies))?(fe||typeof E.UNSAFE_componentWillUpdate!="function"&&typeof E.componentWillUpdate!="function"||(typeof E.componentWillUpdate=="function"&&E.componentWillUpdate(v,pe,Y),typeof E.UNSAFE_componentWillUpdate=="function"&&E.UNSAFE_componentWillUpdate(v,pe,Y)),typeof E.componentDidUpdate=="function"&&(f.flags|=4),typeof E.getSnapshotBeforeUpdate=="function"&&(f.flags|=1024)):(typeof E.componentDidUpdate!="function"||_===c.memoizedProps&&he===c.memoizedState||(f.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||_===c.memoizedProps&&he===c.memoizedState||(f.flags|=1024),f.memoizedProps=v,f.memoizedState=pe),E.props=v,E.state=pe,E.context=Y,v=xe):(typeof E.componentDidUpdate!="function"||_===c.memoizedProps&&he===c.memoizedState||(f.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||_===c.memoizedProps&&he===c.memoizedState||(f.flags|=1024),v=!1)}return E=v,hy(c,f),v=(f.flags&128)!==0,E||v?(E=f.stateNode,m=v&&typeof m.getDerivedStateFromError!="function"?null:E.render(),f.flags|=1,c!==null&&v?(f.child=oc(f,c.child,null,S),f.child=oc(f,null,m,S)):gs(c,f,m,S),f.memoizedState=E.state,c=f.child):c=xi(c,f,S),c}function p$(c,f,m,v){return Gf(),f.flags|=256,gs(c,f,m,v),f.child}var x1={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function v1(c){return{baseLanes:c,cachePool:tR()}}function b1(c,f,m){return c=c!==null?c.childLanes&~m:0,f&&(c|=Ho),c}function m$(c,f,m){var v=f.pendingProps,S=!1,E=(f.flags&128)!==0,_;if((_=E)||(_=c!==null&&c.memoizedState===null?!1:(Gn.current&2)!==0),_&&(S=!0,f.flags&=-129),_=(f.flags&32)!==0,f.flags&=-33,c===null){if(kt){if(S?ia(f):aa(),kt){var z=fn,Y;if(Y=z){e:{for(Y=z,z=Dr;Y.nodeType!==8;){if(!z){z=null;break e}if(Y=cr(Y.nextSibling),Y===null){z=null;break e}}z=Y}z!==null?(f.memoizedState={dehydrated:z,treeContext:gl!==null?{id:fi,overflow:hi}:null,retryLane:536870912,hydrationErrors:null},Y=vo(18,null,null,0),Y.stateNode=z,Y.return=f,f.child=Y,zs=f,fn=null,Y=!0):Y=!1}Y||vl(f)}if(z=f.memoizedState,z!==null&&(z=z.dehydrated,z!==null))return sC(z)?f.lanes=32:f.lanes=536870912,null;yi(f)}return z=v.children,v=v.fallback,S?(aa(),S=f.mode,z=py({mode:"hidden",children:z},S),v=ml(v,S,m,null),z.return=f,v.return=f,z.sibling=v,f.child=z,S=f.child,S.memoizedState=v1(m),S.childLanes=b1(c,_,m),f.memoizedState=x1,v):(ia(f),w1(f,z))}if(Y=c.memoizedState,Y!==null&&(z=Y.dehydrated,z!==null)){if(E)f.flags&256?(ia(f),f.flags&=-257,f=C1(c,f,m)):f.memoizedState!==null?(aa(),f.child=c.child,f.flags|=128,f=null):(aa(),S=v.fallback,z=f.mode,v=py({mode:"visible",children:v.children},z),S=ml(S,z,m,null),S.flags|=2,v.return=f,S.return=f,v.sibling=S,f.child=v,oc(f,c.child,null,m),v=f.child,v.memoizedState=v1(m),v.childLanes=b1(c,_,m),f.memoizedState=x1,f=S);else if(ia(f),sC(z)){if(_=z.nextSibling&&z.nextSibling.dataset,_)var fe=_.dgst;_=fe,v=Error(s(419)),v.stack="",v.digest=_,Hf({value:v,source:null,stack:null}),f=C1(c,f,m)}else if(ts||Wf(c,f,m,!1),_=(m&c.childLanes)!==0,ts||_){if(_=qt,_!==null&&(v=m&-m,v=(v&42)!==0?1:ow(v),v=(v&(_.suspendedLanes|m))!==0?0:v,v!==0&&v!==Y.retryLane))throw Y.retryLane=v,Ku(c,v),So(_,c,v),i$;z.data==="$?"||z1(),f=C1(c,f,m)}else z.data==="$?"?(f.flags|=192,f.child=c.child,f=null):(c=Y.treeContext,fn=cr(z.nextSibling),zs=f,kt=!0,xl=null,Dr=!1,c!==null&&(Bo[Uo++]=fi,Bo[Uo++]=hi,Bo[Uo++]=gl,fi=c.id,hi=c.overflow,gl=f),f=w1(f,v.children),f.flags|=4096);return f}return S?(aa(),S=v.fallback,z=f.mode,Y=c.child,fe=Y.sibling,v=di(Y,{mode:"hidden",children:v.children}),v.subtreeFlags=Y.subtreeFlags&65011712,fe!==null?S=di(fe,S):(S=ml(S,z,m,null),S.flags|=2),S.return=f,v.return=f,v.sibling=S,f.child=v,v=S,S=f.child,z=c.child.memoizedState,z===null?z=v1(m):(Y=z.cachePool,Y!==null?(fe=Un._currentValue,Y=Y.parent!==fe?{parent:fe,pool:fe}:Y):Y=tR(),z={baseLanes:z.baseLanes|m,cachePool:Y}),S.memoizedState=z,S.childLanes=b1(c,_,m),f.memoizedState=x1,v):(ia(f),m=c.child,c=m.sibling,m=di(m,{mode:"visible",children:v.children}),m.return=f,m.sibling=null,c!==null&&(_=f.deletions,_===null?(f.deletions=[c],f.flags|=16):_.push(c)),f.child=m,f.memoizedState=null,m)}function w1(c,f){return f=py({mode:"visible",children:f},c.mode),f.return=c,c.child=f}function py(c,f){return c=vo(22,c,null,f),c.lanes=0,c.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},c}function C1(c,f,m){return oc(f,c.child,null,m),c=w1(f,f.pendingProps.children),c.flags|=2,f.memoizedState=null,c}function g$(c,f,m){c.lanes|=f;var v=c.alternate;v!==null&&(v.lanes|=f),zw(c.return,f,m)}function T1(c,f,m,v,S){var E=c.memoizedState;E===null?c.memoizedState={isBackwards:f,rendering:null,renderingStartTime:0,last:v,tail:m,tailMode:S}:(E.isBackwards=f,E.rendering=null,E.renderingStartTime=0,E.last=v,E.tail=m,E.tailMode=S)}function y$(c,f,m){var v=f.pendingProps,S=v.revealOrder,E=v.tail;if(gs(c,f,v.children,m),v=Gn.current,(v&2)!==0)v=v&1|2,f.flags|=128;else{if(c!==null&&(c.flags&128)!==0)e:for(c=f.child;c!==null;){if(c.tag===13)c.memoizedState!==null&&g$(c,m,f);else if(c.tag===19)g$(c,m,f);else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===f)break e;for(;c.sibling===null;){if(c.return===null||c.return===f)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}v&=1}switch(re(Gn,v),S){case"forwards":for(m=f.child,S=null;m!==null;)c=m.alternate,c!==null&&cy(c)===null&&(S=m),m=m.sibling;m=S,m===null?(S=f.child,f.child=null):(S=m.sibling,m.sibling=null),T1(f,!1,S,m,E);break;case"backwards":for(m=null,S=f.child,f.child=null;S!==null;){if(c=S.alternate,c!==null&&cy(c)===null){f.child=S;break}c=S.sibling,S.sibling=m,m=S,S=c}T1(f,!0,m,null,E);break;case"together":T1(f,!1,null,null,void 0);break;default:f.memoizedState=null}return f.child}function xi(c,f,m){if(c!==null&&(f.dependencies=c.dependencies),fa|=f.lanes,(m&f.childLanes)===0)if(c!==null){if(Wf(c,f,m,!1),(m&f.childLanes)===0)return null}else return null;if(c!==null&&f.child!==c.child)throw Error(s(153));if(f.child!==null){for(c=f.child,m=di(c,c.pendingProps),f.child=m,m.return=f;c.sibling!==null;)c=c.sibling,m=m.sibling=di(c,c.pendingProps),m.return=f;m.sibling=null}return f.child}function S1(c,f){return(c.lanes&f)!==0?!0:(c=c.dependencies,!!(c!==null&&Xg(c)))}function e6(c,f,m){switch(f.tag){case 3:Ae(f,f.stateNode.containerInfo),ta(f,Un,c.memoizedState.cache),Gf();break;case 27:case 5:Ke(f);break;case 4:Ae(f,f.stateNode.containerInfo);break;case 10:ta(f,f.type,f.memoizedProps.value);break;case 13:var v=f.memoizedState;if(v!==null)return v.dehydrated!==null?(ia(f),f.flags|=128,null):(m&f.child.childLanes)!==0?m$(c,f,m):(ia(f),c=xi(c,f,m),c!==null?c.sibling:null);ia(f);break;case 19:var S=(c.flags&128)!==0;if(v=(m&f.childLanes)!==0,v||(Wf(c,f,m,!1),v=(m&f.childLanes)!==0),S){if(v)return y$(c,f,m);f.flags|=128}if(S=f.memoizedState,S!==null&&(S.rendering=null,S.tail=null,S.lastEffect=null),re(Gn,Gn.current),v)break;return null;case 22:case 23:return f.lanes=0,c$(c,f,m);case 24:ta(f,Un,c.memoizedState.cache)}return xi(c,f,m)}function x$(c,f,m){if(c!==null)if(c.memoizedProps!==f.pendingProps)ts=!0;else{if(!S1(c,m)&&(f.flags&128)===0)return ts=!1,e6(c,f,m);ts=(c.flags&131072)!==0}else ts=!1,kt&&(f.flags&1048576)!==0&&X2(f,Kg,f.index);switch(f.lanes=0,f.tag){case 16:e:{c=f.pendingProps;var v=f.elementType,S=v._init;if(v=S(v._payload),f.type=v,typeof v=="function")_w(v)?(c=Sl(v,c),f.tag=1,f=h$(null,f,v,c,m)):(f.tag=0,f=y1(null,f,v,c,m));else{if(v!=null){if(S=v.$$typeof,S===k){f.tag=11,f=a$(null,f,v,c,m);break e}else if(S===M){f.tag=14,f=l$(null,f,v,c,m);break e}}throw f=ne(v)||v,Error(s(306,f,""))}}return f;case 0:return y1(c,f,f.type,f.pendingProps,m);case 1:return v=f.type,S=Sl(v,f.pendingProps),h$(c,f,v,S,m);case 3:e:{if(Ae(f,f.stateNode.containerInfo),c===null)throw Error(s(387));v=f.pendingProps;var E=f.memoizedState;S=E.element,Kw(c,f),Zf(f,v,null,m);var _=f.memoizedState;if(v=_.cache,ta(f,Un,v),v!==E.cache&&Bw(f,[Un],m,!0),jf(),v=_.element,E.isDehydrated)if(E={element:v,isDehydrated:!1,cache:_.cache},f.updateQueue.baseState=E,f.memoizedState=E,f.flags&256){f=p$(c,f,v,m);break e}else if(v!==S){S=Vo(Error(s(424)),f),Hf(S),f=p$(c,f,v,m);break e}else{switch(c=f.stateNode.containerInfo,c.nodeType){case 9:c=c.body;break;default:c=c.nodeName==="HTML"?c.ownerDocument.body:c}for(fn=cr(c.firstChild),zs=f,kt=!0,xl=null,Dr=!0,m=JR(f,null,v,m),f.child=m;m;)m.flags=m.flags&-3|4096,m=m.sibling}else{if(Gf(),v===S){f=xi(c,f,m);break e}gs(c,f,v,m)}f=f.child}return f;case 26:return hy(c,f),c===null?(m=CD(f.type,null,f.pendingProps,null))?f.memoizedState=m:kt||(m=f.type,c=f.pendingProps,v=ky(be.current).createElement(m),v[Ns]=f,v[Zs]=c,xs(v,m,c),es(v),f.stateNode=v):f.memoizedState=CD(f.type,c.memoizedProps,f.pendingProps,c.memoizedState),null;case 27:return Ke(f),c===null&&kt&&(v=f.stateNode=vD(f.type,f.pendingProps,be.current),zs=f,Dr=!0,S=fn,ga(f.type)?(oC=S,fn=cr(v.firstChild)):fn=S),gs(c,f,f.pendingProps.children,m),hy(c,f),c===null&&(f.flags|=4194304),f.child;case 5:return c===null&&kt&&((S=v=fn)&&(v=k6(v,f.type,f.pendingProps,Dr),v!==null?(f.stateNode=v,zs=f,fn=cr(v.firstChild),Dr=!1,S=!0):S=!1),S||vl(f)),Ke(f),S=f.type,E=f.pendingProps,_=c!==null?c.memoizedProps:null,v=E.children,eC(S,E)?v=null:_!==null&&eC(S,_)&&(f.flags|=32),f.memoizedState!==null&&(S=Qw(c,f,qq,null,null,m),bh._currentValue=S),hy(c,f),gs(c,f,v,m),f.child;case 6:return c===null&&kt&&((c=m=fn)&&(m=A6(m,f.pendingProps,Dr),m!==null?(f.stateNode=m,zs=f,fn=null,c=!0):c=!1),c||vl(f)),null;case 13:return m$(c,f,m);case 4:return Ae(f,f.stateNode.containerInfo),v=f.pendingProps,c===null?f.child=oc(f,null,v,m):gs(c,f,v,m),f.child;case 11:return a$(c,f,f.type,f.pendingProps,m);case 7:return gs(c,f,f.pendingProps,m),f.child;case 8:return gs(c,f,f.pendingProps.children,m),f.child;case 12:return gs(c,f,f.pendingProps.children,m),f.child;case 10:return v=f.pendingProps,ta(f,f.type,v.value),gs(c,f,v.children,m),f.child;case 9:return S=f.type._context,v=f.pendingProps.children,wl(f),S=Es(S),v=v(S),f.flags|=1,gs(c,f,v,m),f.child;case 14:return l$(c,f,f.type,f.pendingProps,m);case 15:return u$(c,f,f.type,f.pendingProps,m);case 19:return y$(c,f,m);case 31:return v=f.pendingProps,m=f.mode,v={mode:v.mode,children:v.children},c===null?(m=py(v,m),m.ref=f.ref,f.child=m,m.return=f,f=m):(m=di(c.child,v),m.ref=f.ref,f.child=m,m.return=f,f=m),f;case 22:return c$(c,f,m);case 24:return wl(f),v=Es(Un),c===null?(S=Hw(),S===null&&(S=qt,E=Uw(),S.pooledCache=E,E.refCount++,E!==null&&(S.pooledCacheLanes|=m),S=E),f.memoizedState={parent:v,cache:S},qw(f),ta(f,Un,S)):((c.lanes&m)!==0&&(Kw(c,f),Zf(f,null,null,m),jf()),S=c.memoizedState,E=f.memoizedState,S.parent!==v?(S={parent:v,cache:v},f.memoizedState=S,f.lanes===0&&(f.memoizedState=f.updateQueue.baseState=S),ta(f,Un,v)):(v=E.cache,ta(f,Un,v),v!==S.cache&&Bw(f,[Un],m,!0))),gs(c,f,f.pendingProps.children,m),f.child;case 29:throw f.pendingProps}throw Error(s(156,f.tag))}function vi(c){c.flags|=4}function v$(c,f){if(f.type!=="stylesheet"||(f.state.loading&4)!==0)c.flags&=-16777217;else if(c.flags|=16777216,!ID(f)){if(f=Go.current,f!==null&&((vt&4194048)===vt?_r!==null:(vt&62914560)!==vt&&(vt&536870912)===0||f!==_r))throw Yf=Ww,nR;c.flags|=8192}}function my(c,f){f!==null&&(c.flags|=4),c.flags&16384&&(f=c.tag!==22?Oo():536870912,c.lanes|=f,lc|=f)}function rh(c,f){if(!kt)switch(c.tailMode){case"hidden":f=c.tail;for(var m=null;f!==null;)f.alternate!==null&&(m=f),f=f.sibling;m===null?c.tail=null:m.sibling=null;break;case"collapsed":m=c.tail;for(var v=null;m!==null;)m.alternate!==null&&(v=m),m=m.sibling;v===null?f||c.tail===null?c.tail=null:c.tail.sibling=null:v.sibling=null}}function un(c){var f=c.alternate!==null&&c.alternate.child===c.child,m=0,v=0;if(f)for(var S=c.child;S!==null;)m|=S.lanes|S.childLanes,v|=S.subtreeFlags&65011712,v|=S.flags&65011712,S.return=c,S=S.sibling;else for(S=c.child;S!==null;)m|=S.lanes|S.childLanes,v|=S.subtreeFlags,v|=S.flags,S.return=c,S=S.sibling;return c.subtreeFlags|=v,c.childLanes=m,f}function t6(c,f,m){var v=f.pendingProps;switch(Pw(f),f.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return un(f),null;case 1:return un(f),null;case 3:return m=f.stateNode,v=null,c!==null&&(v=c.memoizedState.cache),f.memoizedState.cache!==v&&(f.flags|=2048),mi(Un),De(),m.pendingContext&&(m.context=m.pendingContext,m.pendingContext=null),(c===null||c.child===null)&&(Uf(f)?vi(f):c===null||c.memoizedState.isDehydrated&&(f.flags&256)===0||(f.flags|=1024,j2())),un(f),null;case 26:return m=f.memoizedState,c===null?(vi(f),m!==null?(un(f),v$(f,m)):(un(f),f.flags&=-16777217)):m?m!==c.memoizedState?(vi(f),un(f),v$(f,m)):(un(f),f.flags&=-16777217):(c.memoizedProps!==v&&vi(f),un(f),f.flags&=-16777217),null;case 27:Xe(f),m=be.current;var S=f.type;if(c!==null&&f.stateNode!=null)c.memoizedProps!==v&&vi(f);else{if(!v){if(f.stateNode===null)throw Error(s(166));return un(f),null}c=ye.current,Uf(f)?Y2(f):(c=vD(S,v,m),f.stateNode=c,vi(f))}return un(f),null;case 5:if(Xe(f),m=f.type,c!==null&&f.stateNode!=null)c.memoizedProps!==v&&vi(f);else{if(!v){if(f.stateNode===null)throw Error(s(166));return un(f),null}if(c=ye.current,Uf(f))Y2(f);else{switch(S=ky(be.current),c){case 1:c=S.createElementNS("http://www.w3.org/2000/svg",m);break;case 2:c=S.createElementNS("http://www.w3.org/1998/Math/MathML",m);break;default:switch(m){case"svg":c=S.createElementNS("http://www.w3.org/2000/svg",m);break;case"math":c=S.createElementNS("http://www.w3.org/1998/Math/MathML",m);break;case"script":c=S.createElement("div"),c.innerHTML="<script><\/script>",c=c.removeChild(c.firstChild);break;case"select":c=typeof v.is=="string"?S.createElement("select",{is:v.is}):S.createElement("select"),v.multiple?c.multiple=!0:v.size&&(c.size=v.size);break;default:c=typeof v.is=="string"?S.createElement(m,{is:v.is}):S.createElement(m)}}c[Ns]=f,c[Zs]=v;e:for(S=f.child;S!==null;){if(S.tag===5||S.tag===6)c.appendChild(S.stateNode);else if(S.tag!==4&&S.tag!==27&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===f)break e;for(;S.sibling===null;){if(S.return===null||S.return===f)break e;S=S.return}S.sibling.return=S.return,S=S.sibling}f.stateNode=c;e:switch(xs(c,m,v),m){case"button":case"input":case"select":case"textarea":c=!!v.autoFocus;break e;case"img":c=!0;break e;default:c=!1}c&&vi(f)}}return un(f),f.flags&=-16777217,null;case 6:if(c&&f.stateNode!=null)c.memoizedProps!==v&&vi(f);else{if(typeof v!="string"&&f.stateNode===null)throw Error(s(166));if(c=be.current,Uf(f)){if(c=f.stateNode,m=f.memoizedProps,v=null,S=zs,S!==null)switch(S.tag){case 27:case 5:v=S.memoizedProps}c[Ns]=f,c=!!(c.nodeValue===m||v!==null&&v.suppressHydrationWarning===!0||fD(c.nodeValue,m)),c||vl(f)}else c=ky(c).createTextNode(v),c[Ns]=f,f.stateNode=c}return un(f),null;case 13:if(v=f.memoizedState,c===null||c.memoizedState!==null&&c.memoizedState.dehydrated!==null){if(S=Uf(f),v!==null&&v.dehydrated!==null){if(c===null){if(!S)throw Error(s(318));if(S=f.memoizedState,S=S!==null?S.dehydrated:null,!S)throw Error(s(317));S[Ns]=f}else Gf(),(f.flags&128)===0&&(f.memoizedState=null),f.flags|=4;un(f),S=!1}else S=j2(),c!==null&&c.memoizedState!==null&&(c.memoizedState.hydrationErrors=S),S=!0;if(!S)return f.flags&256?(yi(f),f):(yi(f),null)}if(yi(f),(f.flags&128)!==0)return f.lanes=m,f;if(m=v!==null,c=c!==null&&c.memoizedState!==null,m){v=f.child,S=null,v.alternate!==null&&v.alternate.memoizedState!==null&&v.alternate.memoizedState.cachePool!==null&&(S=v.alternate.memoizedState.cachePool.pool);var E=null;v.memoizedState!==null&&v.memoizedState.cachePool!==null&&(E=v.memoizedState.cachePool.pool),E!==S&&(v.flags|=2048)}return m!==c&&m&&(f.child.flags|=8192),my(f,f.updateQueue),un(f),null;case 4:return De(),c===null&&Y1(f.stateNode.containerInfo),un(f),null;case 10:return mi(f.type),un(f),null;case 19:if(ie(Gn),S=f.memoizedState,S===null)return un(f),null;if(v=(f.flags&128)!==0,E=S.rendering,E===null)if(v)rh(S,!1);else{if(hn!==0||c!==null&&(c.flags&128)!==0)for(c=f.child;c!==null;){if(E=cy(c),E!==null){for(f.flags|=128,rh(S,!1),c=E.updateQueue,f.updateQueue=c,my(f,c),f.subtreeFlags=0,c=m,m=f.child;m!==null;)K2(m,c),m=m.sibling;return re(Gn,Gn.current&1|2),f.child}c=c.sibling}S.tail!==null&&it()>xy&&(f.flags|=128,v=!0,rh(S,!1),f.lanes=4194304)}else{if(!v)if(c=cy(E),c!==null){if(f.flags|=128,v=!0,c=c.updateQueue,f.updateQueue=c,my(f,c),rh(S,!0),S.tail===null&&S.tailMode==="hidden"&&!E.alternate&&!kt)return un(f),null}else 2*it()-S.renderingStartTime>xy&&m!==536870912&&(f.flags|=128,v=!0,rh(S,!1),f.lanes=4194304);S.isBackwards?(E.sibling=f.child,f.child=E):(c=S.last,c!==null?c.sibling=E:f.child=E,S.last=E)}return S.tail!==null?(f=S.tail,S.rendering=f,S.tail=f.sibling,S.renderingStartTime=it(),f.sibling=null,c=Gn.current,re(Gn,v?c&1|2:c&1),f):(un(f),null);case 22:case 23:return yi(f),jw(),v=f.memoizedState!==null,c!==null?c.memoizedState!==null!==v&&(f.flags|=8192):v&&(f.flags|=8192),v?(m&536870912)!==0&&(f.flags&128)===0&&(un(f),f.subtreeFlags&6&&(f.flags|=8192)):un(f),m=f.updateQueue,m!==null&&my(f,m.retryQueue),m=null,c!==null&&c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(m=c.memoizedState.cachePool.pool),v=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(v=f.memoizedState.cachePool.pool),v!==m&&(f.flags|=2048),c!==null&&ie(Cl),null;case 24:return m=null,c!==null&&(m=c.memoizedState.cache),f.memoizedState.cache!==m&&(f.flags|=2048),mi(Un),un(f),null;case 25:return null;case 30:return null}throw Error(s(156,f.tag))}function n6(c,f){switch(Pw(f),f.tag){case 1:return c=f.flags,c&65536?(f.flags=c&-65537|128,f):null;case 3:return mi(Un),De(),c=f.flags,(c&65536)!==0&&(c&128)===0?(f.flags=c&-65537|128,f):null;case 26:case 27:case 5:return Xe(f),null;case 13:if(yi(f),c=f.memoizedState,c!==null&&c.dehydrated!==null){if(f.alternate===null)throw Error(s(340));Gf()}return c=f.flags,c&65536?(f.flags=c&-65537|128,f):null;case 19:return ie(Gn),null;case 4:return De(),null;case 10:return mi(f.type),null;case 22:case 23:return yi(f),jw(),c!==null&&ie(Cl),c=f.flags,c&65536?(f.flags=c&-65537|128,f):null;case 24:return mi(Un),null;case 25:return null;default:return null}}function b$(c,f){switch(Pw(f),f.tag){case 3:mi(Un),De();break;case 26:case 27:case 5:Xe(f);break;case 4:De();break;case 13:yi(f);break;case 19:ie(Gn);break;case 10:mi(f.type);break;case 22:case 23:yi(f),jw(),c!==null&&ie(Cl);break;case 24:mi(Un)}}function ih(c,f){try{var m=f.updateQueue,v=m!==null?m.lastEffect:null;if(v!==null){var S=v.next;m=S;do{if((m.tag&c)===c){v=void 0;var E=m.create,_=m.inst;v=E(),_.destroy=v}m=m.next}while(m!==S)}}catch(z){Ut(f,f.return,z)}}function la(c,f,m){try{var v=f.updateQueue,S=v!==null?v.lastEffect:null;if(S!==null){var E=S.next;v=E;do{if((v.tag&c)===c){var _=v.inst,z=_.destroy;if(z!==void 0){_.destroy=void 0,S=f;var Y=m,fe=z;try{fe()}catch(xe){Ut(S,Y,xe)}}}v=v.next}while(v!==E)}}catch(xe){Ut(f,f.return,xe)}}function w$(c){var f=c.updateQueue;if(f!==null){var m=c.stateNode;try{lR(f,m)}catch(v){Ut(c,c.return,v)}}}function C$(c,f,m){m.props=Sl(c.type,c.memoizedProps),m.state=c.memoizedState;try{m.componentWillUnmount()}catch(v){Ut(c,f,v)}}function ah(c,f){try{var m=c.ref;if(m!==null){switch(c.tag){case 26:case 27:case 5:var v=c.stateNode;break;case 30:v=c.stateNode;break;default:v=c.stateNode}typeof m=="function"?c.refCleanup=m(v):m.current=v}}catch(S){Ut(c,f,S)}}function Mr(c,f){var m=c.ref,v=c.refCleanup;if(m!==null)if(typeof v=="function")try{v()}catch(S){Ut(c,f,S)}finally{c.refCleanup=null,c=c.alternate,c!=null&&(c.refCleanup=null)}else if(typeof m=="function")try{m(null)}catch(S){Ut(c,f,S)}else m.current=null}function T$(c){var f=c.type,m=c.memoizedProps,v=c.stateNode;try{e:switch(f){case"button":case"input":case"select":case"textarea":m.autoFocus&&v.focus();break e;case"img":m.src?v.src=m.src:m.srcSet&&(v.srcset=m.srcSet)}}catch(S){Ut(c,c.return,S)}}function N1(c,f,m){try{var v=c.stateNode;T6(v,c.type,m,f),v[Zs]=f}catch(S){Ut(c,c.return,S)}}function S$(c){return c.tag===5||c.tag===3||c.tag===26||c.tag===27&&ga(c.type)||c.tag===4}function E1(c){e:for(;;){for(;c.sibling===null;){if(c.return===null||S$(c.return))return null;c=c.return}for(c.sibling.return=c.return,c=c.sibling;c.tag!==5&&c.tag!==6&&c.tag!==18;){if(c.tag===27&&ga(c.type)||c.flags&2||c.child===null||c.tag===4)continue e;c.child.return=c,c=c.child}if(!(c.flags&2))return c.stateNode}}function I1(c,f,m){var v=c.tag;if(v===5||v===6)c=c.stateNode,f?(m.nodeType===9?m.body:m.nodeName==="HTML"?m.ownerDocument.body:m).insertBefore(c,f):(f=m.nodeType===9?m.body:m.nodeName==="HTML"?m.ownerDocument.body:m,f.appendChild(c),m=m._reactRootContainer,m!=null||f.onclick!==null||(f.onclick=Iy));else if(v!==4&&(v===27&&ga(c.type)&&(m=c.stateNode,f=null),c=c.child,c!==null))for(I1(c,f,m),c=c.sibling;c!==null;)I1(c,f,m),c=c.sibling}function gy(c,f,m){var v=c.tag;if(v===5||v===6)c=c.stateNode,f?m.insertBefore(c,f):m.appendChild(c);else if(v!==4&&(v===27&&ga(c.type)&&(m=c.stateNode),c=c.child,c!==null))for(gy(c,f,m),c=c.sibling;c!==null;)gy(c,f,m),c=c.sibling}function N$(c){var f=c.stateNode,m=c.memoizedProps;try{for(var v=c.type,S=f.attributes;S.length;)f.removeAttributeNode(S[0]);xs(f,v,m),f[Ns]=c,f[Zs]=m}catch(E){Ut(c,c.return,E)}}var bi=!1,wn=!1,k1=!1,E$=typeof WeakSet=="function"?WeakSet:Set,ns=null;function s6(c,f){if(c=c.containerInfo,Z1=My,c=P2(c),Ew(c)){if("selectionStart"in c)var m={start:c.selectionStart,end:c.selectionEnd};else e:{m=(m=c.ownerDocument)&&m.defaultView||window;var v=m.getSelection&&m.getSelection();if(v&&v.rangeCount!==0){m=v.anchorNode;var S=v.anchorOffset,E=v.focusNode;v=v.focusOffset;try{m.nodeType,E.nodeType}catch{m=null;break e}var _=0,z=-1,Y=-1,fe=0,xe=0,Ce=c,he=null;t:for(;;){for(var pe;Ce!==m||S!==0&&Ce.nodeType!==3||(z=_+S),Ce!==E||v!==0&&Ce.nodeType!==3||(Y=_+v),Ce.nodeType===3&&(_+=Ce.nodeValue.length),(pe=Ce.firstChild)!==null;)he=Ce,Ce=pe;for(;;){if(Ce===c)break t;if(he===m&&++fe===S&&(z=_),he===E&&++xe===v&&(Y=_),(pe=Ce.nextSibling)!==null)break;Ce=he,he=Ce.parentNode}Ce=pe}m=z===-1||Y===-1?null:{start:z,end:Y}}else m=null}m=m||{start:0,end:0}}else m=null;for(Q1={focusedElem:c,selectionRange:m},My=!1,ns=f;ns!==null;)if(f=ns,c=f.child,(f.subtreeFlags&1024)!==0&&c!==null)c.return=f,ns=c;else for(;ns!==null;){switch(f=ns,E=f.alternate,c=f.flags,f.tag){case 0:break;case 11:case 15:break;case 1:if((c&1024)!==0&&E!==null){c=void 0,m=f,S=E.memoizedProps,E=E.memoizedState,v=m.stateNode;try{var Ye=Sl(m.type,S,m.elementType===m.type);c=v.getSnapshotBeforeUpdate(Ye,E),v.__reactInternalSnapshotBeforeUpdate=c}catch(He){Ut(m,m.return,He)}}break;case 3:if((c&1024)!==0){if(c=f.stateNode.containerInfo,m=c.nodeType,m===9)nC(c);else if(m===1)switch(c.nodeName){case"HEAD":case"HTML":case"BODY":nC(c);break;default:c.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((c&1024)!==0)throw Error(s(163))}if(c=f.sibling,c!==null){c.return=f.return,ns=c;break}ns=f.return}}function I$(c,f,m){var v=m.flags;switch(m.tag){case 0:case 11:case 15:ua(c,m),v&4&&ih(5,m);break;case 1:if(ua(c,m),v&4)if(c=m.stateNode,f===null)try{c.componentDidMount()}catch(_){Ut(m,m.return,_)}else{var S=Sl(m.type,f.memoizedProps);f=f.memoizedState;try{c.componentDidUpdate(S,f,c.__reactInternalSnapshotBeforeUpdate)}catch(_){Ut(m,m.return,_)}}v&64&&w$(m),v&512&&ah(m,m.return);break;case 3:if(ua(c,m),v&64&&(c=m.updateQueue,c!==null)){if(f=null,m.child!==null)switch(m.child.tag){case 27:case 5:f=m.child.stateNode;break;case 1:f=m.child.stateNode}try{lR(c,f)}catch(_){Ut(m,m.return,_)}}break;case 27:f===null&&v&4&&N$(m);case 26:case 5:ua(c,m),f===null&&v&4&&T$(m),v&512&&ah(m,m.return);break;case 12:ua(c,m);break;case 13:ua(c,m),v&4&&R$(c,m),v&64&&(c=m.memoizedState,c!==null&&(c=c.dehydrated,c!==null&&(m=f6.bind(null,m),R6(c,m))));break;case 22:if(v=m.memoizedState!==null||bi,!v){f=f!==null&&f.memoizedState!==null||wn,S=bi;var E=wn;bi=v,(wn=f)&&!E?ca(c,m,(m.subtreeFlags&8772)!==0):ua(c,m),bi=S,wn=E}break;case 30:break;default:ua(c,m)}}function k$(c){var f=c.alternate;f!==null&&(c.alternate=null,k$(f)),c.child=null,c.deletions=null,c.sibling=null,c.tag===5&&(f=c.stateNode,f!==null&&aw(f)),c.stateNode=null,c.return=null,c.dependencies=null,c.memoizedProps=null,c.memoizedState=null,c.pendingProps=null,c.stateNode=null,c.updateQueue=null}var Zt=null,to=!1;function wi(c,f,m){for(m=m.child;m!==null;)A$(c,f,m),m=m.sibling}function A$(c,f,m){if(jt&&typeof jt.onCommitFiberUnmount=="function")try{jt.onCommitFiberUnmount(Ss,m)}catch{}switch(m.tag){case 26:wn||Mr(m,f),wi(c,f,m),m.memoizedState?m.memoizedState.count--:m.stateNode&&(m=m.stateNode,m.parentNode.removeChild(m));break;case 27:wn||Mr(m,f);var v=Zt,S=to;ga(m.type)&&(Zt=m.stateNode,to=!1),wi(c,f,m),gh(m.stateNode),Zt=v,to=S;break;case 5:wn||Mr(m,f);case 6:if(v=Zt,S=to,Zt=null,wi(c,f,m),Zt=v,to=S,Zt!==null)if(to)try{(Zt.nodeType===9?Zt.body:Zt.nodeName==="HTML"?Zt.ownerDocument.body:Zt).removeChild(m.stateNode)}catch(E){Ut(m,f,E)}else try{Zt.removeChild(m.stateNode)}catch(E){Ut(m,f,E)}break;case 18:Zt!==null&&(to?(c=Zt,yD(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,m.stateNode),Sh(c)):yD(Zt,m.stateNode));break;case 4:v=Zt,S=to,Zt=m.stateNode.containerInfo,to=!0,wi(c,f,m),Zt=v,to=S;break;case 0:case 11:case 14:case 15:wn||la(2,m,f),wn||la(4,m,f),wi(c,f,m);break;case 1:wn||(Mr(m,f),v=m.stateNode,typeof v.componentWillUnmount=="function"&&C$(m,f,v)),wi(c,f,m);break;case 21:wi(c,f,m);break;case 22:wn=(v=wn)||m.memoizedState!==null,wi(c,f,m),wn=v;break;default:wi(c,f,m)}}function R$(c,f){if(f.memoizedState===null&&(c=f.alternate,c!==null&&(c=c.memoizedState,c!==null&&(c=c.dehydrated,c!==null))))try{Sh(c)}catch(m){Ut(f,f.return,m)}}function o6(c){switch(c.tag){case 13:case 19:var f=c.stateNode;return f===null&&(f=c.stateNode=new E$),f;case 22:return c=c.stateNode,f=c._retryCache,f===null&&(f=c._retryCache=new E$),f;default:throw Error(s(435,c.tag))}}function A1(c,f){var m=o6(c);f.forEach(function(v){var S=h6.bind(null,c,v);m.has(v)||(m.add(v),v.then(S,S))})}function bo(c,f){var m=f.deletions;if(m!==null)for(var v=0;v<m.length;v++){var S=m[v],E=c,_=f,z=_;e:for(;z!==null;){switch(z.tag){case 27:if(ga(z.type)){Zt=z.stateNode,to=!1;break e}break;case 5:Zt=z.stateNode,to=!1;break e;case 3:case 4:Zt=z.stateNode.containerInfo,to=!0;break e}z=z.return}if(Zt===null)throw Error(s(160));A$(E,_,S),Zt=null,to=!1,E=S.alternate,E!==null&&(E.return=null),S.return=null}if(f.subtreeFlags&13878)for(f=f.child;f!==null;)$$(f,c),f=f.sibling}var ur=null;function $$(c,f){var m=c.alternate,v=c.flags;switch(c.tag){case 0:case 11:case 14:case 15:bo(f,c),wo(c),v&4&&(la(3,c,c.return),ih(3,c),la(5,c,c.return));break;case 1:bo(f,c),wo(c),v&512&&(wn||m===null||Mr(m,m.return)),v&64&&bi&&(c=c.updateQueue,c!==null&&(v=c.callbacks,v!==null&&(m=c.shared.hiddenCallbacks,c.shared.hiddenCallbacks=m===null?v:m.concat(v))));break;case 26:var S=ur;if(bo(f,c),wo(c),v&512&&(wn||m===null||Mr(m,m.return)),v&4){var E=m!==null?m.memoizedState:null;if(v=c.memoizedState,m===null)if(v===null)if(c.stateNode===null){e:{v=c.type,m=c.memoizedProps,S=S.ownerDocument||S;t:switch(v){case"title":E=S.getElementsByTagName("title")[0],(!E||E[$f]||E[Ns]||E.namespaceURI==="http://www.w3.org/2000/svg"||E.hasAttribute("itemprop"))&&(E=S.createElement(v),S.head.insertBefore(E,S.querySelector("head > title"))),xs(E,v,m),E[Ns]=c,es(E),v=E;break e;case"link":var _=ND("link","href",S).get(v+(m.href||""));if(_){for(var z=0;z<_.length;z++)if(E=_[z],E.getAttribute("href")===(m.href==null||m.href===""?null:m.href)&&E.getAttribute("rel")===(m.rel==null?null:m.rel)&&E.getAttribute("title")===(m.title==null?null:m.title)&&E.getAttribute("crossorigin")===(m.crossOrigin==null?null:m.crossOrigin)){_.splice(z,1);break t}}E=S.createElement(v),xs(E,v,m),S.head.appendChild(E);break;case"meta":if(_=ND("meta","content",S).get(v+(m.content||""))){for(z=0;z<_.length;z++)if(E=_[z],E.getAttribute("content")===(m.content==null?null:""+m.content)&&E.getAttribute("name")===(m.name==null?null:m.name)&&E.getAttribute("property")===(m.property==null?null:m.property)&&E.getAttribute("http-equiv")===(m.httpEquiv==null?null:m.httpEquiv)&&E.getAttribute("charset")===(m.charSet==null?null:m.charSet)){_.splice(z,1);break t}}E=S.createElement(v),xs(E,v,m),S.head.appendChild(E);break;default:throw Error(s(468,v))}E[Ns]=c,es(E),v=E}c.stateNode=v}else ED(S,c.type,c.stateNode);else c.stateNode=SD(S,v,c.memoizedProps);else E!==v?(E===null?m.stateNode!==null&&(m=m.stateNode,m.parentNode.removeChild(m)):E.count--,v===null?ED(S,c.type,c.stateNode):SD(S,v,c.memoizedProps)):v===null&&c.stateNode!==null&&N1(c,c.memoizedProps,m.memoizedProps)}break;case 27:bo(f,c),wo(c),v&512&&(wn||m===null||Mr(m,m.return)),m!==null&&v&4&&N1(c,c.memoizedProps,m.memoizedProps);break;case 5:if(bo(f,c),wo(c),v&512&&(wn||m===null||Mr(m,m.return)),c.flags&32){S=c.stateNode;try{zu(S,"")}catch(pe){Ut(c,c.return,pe)}}v&4&&c.stateNode!=null&&(S=c.memoizedProps,N1(c,S,m!==null?m.memoizedProps:S)),v&1024&&(k1=!0);break;case 6:if(bo(f,c),wo(c),v&4){if(c.stateNode===null)throw Error(s(162));v=c.memoizedProps,m=c.stateNode;try{m.nodeValue=v}catch(pe){Ut(c,c.return,pe)}}break;case 3:if($y=null,S=ur,ur=Ay(f.containerInfo),bo(f,c),ur=S,wo(c),v&4&&m!==null&&m.memoizedState.isDehydrated)try{Sh(f.containerInfo)}catch(pe){Ut(c,c.return,pe)}k1&&(k1=!1,D$(c));break;case 4:v=ur,ur=Ay(c.stateNode.containerInfo),bo(f,c),wo(c),ur=v;break;case 12:bo(f,c),wo(c);break;case 13:bo(f,c),wo(c),c.child.flags&8192&&c.memoizedState!==null!=(m!==null&&m.memoizedState!==null)&&(F1=it()),v&4&&(v=c.updateQueue,v!==null&&(c.updateQueue=null,A1(c,v)));break;case 22:S=c.memoizedState!==null;var Y=m!==null&&m.memoizedState!==null,fe=bi,xe=wn;if(bi=fe||S,wn=xe||Y,bo(f,c),wn=xe,bi=fe,wo(c),v&8192)e:for(f=c.stateNode,f._visibility=S?f._visibility&-2:f._visibility|1,S&&(m===null||Y||bi||wn||Nl(c)),m=null,f=c;;){if(f.tag===5||f.tag===26){if(m===null){Y=m=f;try{if(E=Y.stateNode,S)_=E.style,typeof _.setProperty=="function"?_.setProperty("display","none","important"):_.display="none";else{z=Y.stateNode;var Ce=Y.memoizedProps.style,he=Ce!=null&&Ce.hasOwnProperty("display")?Ce.display:null;z.style.display=he==null||typeof he=="boolean"?"":(""+he).trim()}}catch(pe){Ut(Y,Y.return,pe)}}}else if(f.tag===6){if(m===null){Y=f;try{Y.stateNode.nodeValue=S?"":Y.memoizedProps}catch(pe){Ut(Y,Y.return,pe)}}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===c)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===c)break e;for(;f.sibling===null;){if(f.return===null||f.return===c)break e;m===f&&(m=null),f=f.return}m===f&&(m=null),f.sibling.return=f.return,f=f.sibling}v&4&&(v=c.updateQueue,v!==null&&(m=v.retryQueue,m!==null&&(v.retryQueue=null,A1(c,m))));break;case 19:bo(f,c),wo(c),v&4&&(v=c.updateQueue,v!==null&&(c.updateQueue=null,A1(c,v)));break;case 30:break;case 21:break;default:bo(f,c),wo(c)}}function wo(c){var f=c.flags;if(f&2){try{for(var m,v=c.return;v!==null;){if(S$(v)){m=v;break}v=v.return}if(m==null)throw Error(s(160));switch(m.tag){case 27:var S=m.stateNode,E=E1(c);gy(c,E,S);break;case 5:var _=m.stateNode;m.flags&32&&(zu(_,""),m.flags&=-33);var z=E1(c);gy(c,z,_);break;case 3:case 4:var Y=m.stateNode.containerInfo,fe=E1(c);I1(c,fe,Y);break;default:throw Error(s(161))}}catch(xe){Ut(c,c.return,xe)}c.flags&=-3}f&4096&&(c.flags&=-4097)}function D$(c){if(c.subtreeFlags&1024)for(c=c.child;c!==null;){var f=c;D$(f),f.tag===5&&f.flags&1024&&f.stateNode.reset(),c=c.sibling}}function ua(c,f){if(f.subtreeFlags&8772)for(f=f.child;f!==null;)I$(c,f.alternate,f),f=f.sibling}function Nl(c){for(c=c.child;c!==null;){var f=c;switch(f.tag){case 0:case 11:case 14:case 15:la(4,f,f.return),Nl(f);break;case 1:Mr(f,f.return);var m=f.stateNode;typeof m.componentWillUnmount=="function"&&C$(f,f.return,m),Nl(f);break;case 27:gh(f.stateNode);case 26:case 5:Mr(f,f.return),Nl(f);break;case 22:f.memoizedState===null&&Nl(f);break;case 30:Nl(f);break;default:Nl(f)}c=c.sibling}}function ca(c,f,m){for(m=m&&(f.subtreeFlags&8772)!==0,f=f.child;f!==null;){var v=f.alternate,S=c,E=f,_=E.flags;switch(E.tag){case 0:case 11:case 15:ca(S,E,m),ih(4,E);break;case 1:if(ca(S,E,m),v=E,S=v.stateNode,typeof S.componentDidMount=="function")try{S.componentDidMount()}catch(fe){Ut(v,v.return,fe)}if(v=E,S=v.updateQueue,S!==null){var z=v.stateNode;try{var Y=S.shared.hiddenCallbacks;if(Y!==null)for(S.shared.hiddenCallbacks=null,S=0;S<Y.length;S++)aR(Y[S],z)}catch(fe){Ut(v,v.return,fe)}}m&&_&64&&w$(E),ah(E,E.return);break;case 27:N$(E);case 26:case 5:ca(S,E,m),m&&v===null&&_&4&&T$(E),ah(E,E.return);break;case 12:ca(S,E,m);break;case 13:ca(S,E,m),m&&_&4&&R$(S,E);break;case 22:E.memoizedState===null&&ca(S,E,m),ah(E,E.return);break;case 30:break;default:ca(S,E,m)}f=f.sibling}}function R1(c,f){var m=null;c!==null&&c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(m=c.memoizedState.cachePool.pool),c=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(c=f.memoizedState.cachePool.pool),c!==m&&(c!=null&&c.refCount++,m!=null&&qf(m))}function $1(c,f){c=null,f.alternate!==null&&(c=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==c&&(f.refCount++,c!=null&&qf(c))}function Fr(c,f,m,v){if(f.subtreeFlags&10256)for(f=f.child;f!==null;)_$(c,f,m,v),f=f.sibling}function _$(c,f,m,v){var S=f.flags;switch(f.tag){case 0:case 11:case 15:Fr(c,f,m,v),S&2048&&ih(9,f);break;case 1:Fr(c,f,m,v);break;case 3:Fr(c,f,m,v),S&2048&&(c=null,f.alternate!==null&&(c=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==c&&(f.refCount++,c!=null&&qf(c)));break;case 12:if(S&2048){Fr(c,f,m,v),c=f.stateNode;try{var E=f.memoizedProps,_=E.id,z=E.onPostCommit;typeof z=="function"&&z(_,f.alternate===null?"mount":"update",c.passiveEffectDuration,-0)}catch(Y){Ut(f,f.return,Y)}}else Fr(c,f,m,v);break;case 13:Fr(c,f,m,v);break;case 23:break;case 22:E=f.stateNode,_=f.alternate,f.memoizedState!==null?E._visibility&2?Fr(c,f,m,v):lh(c,f):E._visibility&2?Fr(c,f,m,v):(E._visibility|=2,rc(c,f,m,v,(f.subtreeFlags&10256)!==0)),S&2048&&R1(_,f);break;case 24:Fr(c,f,m,v),S&2048&&$1(f.alternate,f);break;default:Fr(c,f,m,v)}}function rc(c,f,m,v,S){for(S=S&&(f.subtreeFlags&10256)!==0,f=f.child;f!==null;){var E=c,_=f,z=m,Y=v,fe=_.flags;switch(_.tag){case 0:case 11:case 15:rc(E,_,z,Y,S),ih(8,_);break;case 23:break;case 22:var xe=_.stateNode;_.memoizedState!==null?xe._visibility&2?rc(E,_,z,Y,S):lh(E,_):(xe._visibility|=2,rc(E,_,z,Y,S)),S&&fe&2048&&R1(_.alternate,_);break;case 24:rc(E,_,z,Y,S),S&&fe&2048&&$1(_.alternate,_);break;default:rc(E,_,z,Y,S)}f=f.sibling}}function lh(c,f){if(f.subtreeFlags&10256)for(f=f.child;f!==null;){var m=c,v=f,S=v.flags;switch(v.tag){case 22:lh(m,v),S&2048&&R1(v.alternate,v);break;case 24:lh(m,v),S&2048&&$1(v.alternate,v);break;default:lh(m,v)}f=f.sibling}}var uh=8192;function ic(c){if(c.subtreeFlags&uh)for(c=c.child;c!==null;)M$(c),c=c.sibling}function M$(c){switch(c.tag){case 26:ic(c),c.flags&uh&&c.memoizedState!==null&&G6(ur,c.memoizedState,c.memoizedProps);break;case 5:ic(c);break;case 3:case 4:var f=ur;ur=Ay(c.stateNode.containerInfo),ic(c),ur=f;break;case 22:c.memoizedState===null&&(f=c.alternate,f!==null&&f.memoizedState!==null?(f=uh,uh=16777216,ic(c),uh=f):ic(c));break;default:ic(c)}}function F$(c){var f=c.alternate;if(f!==null&&(c=f.child,c!==null)){f.child=null;do f=c.sibling,c.sibling=null,c=f;while(c!==null)}}function ch(c){var f=c.deletions;if((c.flags&16)!==0){if(f!==null)for(var m=0;m<f.length;m++){var v=f[m];ns=v,P$(v,c)}F$(c)}if(c.subtreeFlags&10256)for(c=c.child;c!==null;)O$(c),c=c.sibling}function O$(c){switch(c.tag){case 0:case 11:case 15:ch(c),c.flags&2048&&la(9,c,c.return);break;case 3:ch(c);break;case 12:ch(c);break;case 22:var f=c.stateNode;c.memoizedState!==null&&f._visibility&2&&(c.return===null||c.return.tag!==13)?(f._visibility&=-3,yy(c)):ch(c);break;default:ch(c)}}function yy(c){var f=c.deletions;if((c.flags&16)!==0){if(f!==null)for(var m=0;m<f.length;m++){var v=f[m];ns=v,P$(v,c)}F$(c)}for(c=c.child;c!==null;){switch(f=c,f.tag){case 0:case 11:case 15:la(8,f,f.return),yy(f);break;case 22:m=f.stateNode,m._visibility&2&&(m._visibility&=-3,yy(f));break;default:yy(f)}c=c.sibling}}function P$(c,f){for(;ns!==null;){var m=ns;switch(m.tag){case 0:case 11:case 15:la(8,m,f);break;case 23:case 22:if(m.memoizedState!==null&&m.memoizedState.cachePool!==null){var v=m.memoizedState.cachePool.pool;v!=null&&v.refCount++}break;case 24:qf(m.memoizedState.cache)}if(v=m.child,v!==null)v.return=m,ns=v;else e:for(m=c;ns!==null;){v=ns;var S=v.sibling,E=v.return;if(k$(v),v===m){ns=null;break e}if(S!==null){S.return=E,ns=S;break e}ns=E}}}var r6={getCacheForType:function(c){var f=Es(Un),m=f.data.get(c);return m===void 0&&(m=c(),f.data.set(c,m)),m}},i6=typeof WeakMap=="function"?WeakMap:Map,_t=0,qt=null,ht=null,vt=0,Mt=0,Co=null,da=!1,ac=!1,D1=!1,Ci=0,hn=0,fa=0,El=0,_1=0,Ho=0,lc=0,dh=null,no=null,M1=!1,F1=0,xy=1/0,vy=null,ha=null,ys=0,pa=null,uc=null,cc=0,O1=0,P1=null,L$=null,fh=0,L1=null;function To(){if((_t&2)!==0&&vt!==0)return vt&-vt;if(G.T!==null){var c=ju;return c!==0?c:W1()}return e2()}function V$(){Ho===0&&(Ho=(vt&536870912)===0||kt?Bn():536870912);var c=Go.current;return c!==null&&(c.flags|=32),Ho}function So(c,f,m){(c===qt&&(Mt===2||Mt===9)||c.cancelPendingCommit!==null)&&(dc(c,0),ma(c,vt,Ho,!1)),ar(c,m),((_t&2)===0||c!==qt)&&(c===qt&&((_t&2)===0&&(El|=m),hn===4&&ma(c,vt,Ho,!1)),Or(c))}function z$(c,f,m){if((_t&6)!==0)throw Error(s(327));var v=!m&&(f&124)===0&&(f&c.expiredLanes)===0||ir(c,f),S=v?u6(c,f):B1(c,f,!0),E=v;do{if(S===0){ac&&!v&&ma(c,f,0,!1);break}else{if(m=c.current.alternate,E&&!a6(m)){S=B1(c,f,!1),E=!1;continue}if(S===2){if(E=f,c.errorRecoveryDisabledLanes&E)var _=0;else _=c.pendingLanes&-536870913,_=_!==0?_:_&536870912?536870912:0;if(_!==0){f=_;e:{var z=c;S=dh;var Y=z.current.memoizedState.isDehydrated;if(Y&&(dc(z,_).flags|=256),_=B1(z,_,!1),_!==2){if(D1&&!Y){z.errorRecoveryDisabledLanes|=E,El|=E,S=4;break e}E=no,no=S,E!==null&&(no===null?no=E:no.push.apply(no,E))}S=_}if(E=!1,S!==2)continue}}if(S===1){dc(c,0),ma(c,f,0,!0);break}e:{switch(v=c,E=S,E){case 0:case 1:throw Error(s(345));case 4:if((f&4194048)!==f)break;case 6:ma(v,f,Ho,!da);break e;case 2:no=null;break;case 3:case 5:break;default:throw Error(s(329))}if((f&62914560)===f&&(S=F1+300-it(),10<S)){if(ma(v,f,Ho,!da),zn(v,0,!0)!==0)break e;v.timeoutHandle=mD(B$.bind(null,v,m,no,vy,M1,f,Ho,El,lc,da,E,2,-0,0),S);break e}B$(v,m,no,vy,M1,f,Ho,El,lc,da,E,0,-0,0)}}break}while(!0);Or(c)}function B$(c,f,m,v,S,E,_,z,Y,fe,xe,Ce,he,pe){if(c.timeoutHandle=-1,Ce=f.subtreeFlags,(Ce&8192||(Ce&16785408)===16785408)&&(vh={stylesheets:null,count:0,unsuspend:U6},M$(f),Ce=H6(),Ce!==null)){c.cancelPendingCommit=Ce(X$.bind(null,c,f,E,m,v,S,_,z,Y,xe,1,he,pe)),ma(c,E,_,!fe);return}X$(c,f,E,m,v,S,_,z,Y)}function a6(c){for(var f=c;;){var m=f.tag;if((m===0||m===11||m===15)&&f.flags&16384&&(m=f.updateQueue,m!==null&&(m=m.stores,m!==null)))for(var v=0;v<m.length;v++){var S=m[v],E=S.getSnapshot;S=S.value;try{if(!xo(E(),S))return!1}catch{return!1}}if(m=f.child,f.subtreeFlags&16384&&m!==null)m.return=f,f=m;else{if(f===c)break;for(;f.sibling===null;){if(f.return===null||f.return===c)return!0;f=f.return}f.sibling.return=f.return,f=f.sibling}}return!0}function ma(c,f,m,v){f&=~_1,f&=~El,c.suspendedLanes|=f,c.pingedLanes&=~f,v&&(c.warmLanes|=f),v=c.expirationTimes;for(var S=f;0<S;){var E=31-ln(S),_=1<<E;v[E]=-1,S&=~_}m!==0&&ZA(c,m,f)}function by(){return(_t&6)===0?(hh(0),!1):!0}function V1(){if(ht!==null){if(Mt===0)var c=ht.return;else c=ht,pi=bl=null,n1(c),sc=null,sh=0,c=ht;for(;c!==null;)b$(c.alternate,c),c=c.return;ht=null}}function dc(c,f){var m=c.timeoutHandle;m!==-1&&(c.timeoutHandle=-1,N6(m)),m=c.cancelPendingCommit,m!==null&&(c.cancelPendingCommit=null,m()),V1(),qt=c,ht=m=di(c.current,null),vt=f,Mt=0,Co=null,da=!1,ac=ir(c,f),D1=!1,lc=Ho=_1=El=fa=hn=0,no=dh=null,M1=!1,(f&8)!==0&&(f|=f&32);var v=c.entangledLanes;if(v!==0)for(c=c.entanglements,v&=f;0<v;){var S=31-ln(v),E=1<<S;f|=c[S],v&=~E}return Ci=f,Ug(),m}function U$(c,f){at=null,G.H=ay,f===Xf||f===jg?(f=rR(),Mt=3):f===nR?(f=rR(),Mt=4):Mt=f===i$?8:f!==null&&typeof f=="object"&&typeof f.then=="function"?6:1,Co=f,ht===null&&(hn=1,fy(c,Vo(f,c.current)))}function G$(){var c=G.H;return G.H=ay,c===null?ay:c}function H$(){var c=G.A;return G.A=r6,c}function z1(){hn=4,da||(vt&4194048)!==vt&&Go.current!==null||(ac=!0),(fa&134217727)===0&&(El&134217727)===0||qt===null||ma(qt,vt,Ho,!1)}function B1(c,f,m){var v=_t;_t|=2;var S=G$(),E=H$();(qt!==c||vt!==f)&&(vy=null,dc(c,f)),f=!1;var _=hn;e:do try{if(Mt!==0&&ht!==null){var z=ht,Y=Co;switch(Mt){case 8:V1(),_=6;break e;case 3:case 2:case 9:case 6:Go.current===null&&(f=!0);var fe=Mt;if(Mt=0,Co=null,fc(c,z,Y,fe),m&&ac){_=0;break e}break;default:fe=Mt,Mt=0,Co=null,fc(c,z,Y,fe)}}l6(),_=hn;break}catch(xe){U$(c,xe)}while(!0);return f&&c.shellSuspendCounter++,pi=bl=null,_t=v,G.H=S,G.A=E,ht===null&&(qt=null,vt=0,Ug()),_}function l6(){for(;ht!==null;)W$(ht)}function u6(c,f){var m=_t;_t|=2;var v=G$(),S=H$();qt!==c||vt!==f?(vy=null,xy=it()+500,dc(c,f)):ac=ir(c,f);e:do try{if(Mt!==0&&ht!==null){f=ht;var E=Co;t:switch(Mt){case 1:Mt=0,Co=null,fc(c,f,E,1);break;case 2:case 9:if(sR(E)){Mt=0,Co=null,q$(f);break}f=function(){Mt!==2&&Mt!==9||qt!==c||(Mt=7),Or(c)},E.then(f,f);break e;case 3:Mt=7;break e;case 4:Mt=5;break e;case 7:sR(E)?(Mt=0,Co=null,q$(f)):(Mt=0,Co=null,fc(c,f,E,7));break;case 5:var _=null;switch(ht.tag){case 26:_=ht.memoizedState;case 5:case 27:var z=ht;if(!_||ID(_)){Mt=0,Co=null;var Y=z.sibling;if(Y!==null)ht=Y;else{var fe=z.return;fe!==null?(ht=fe,wy(fe)):ht=null}break t}}Mt=0,Co=null,fc(c,f,E,5);break;case 6:Mt=0,Co=null,fc(c,f,E,6);break;case 8:V1(),hn=6;break e;default:throw Error(s(462))}}c6();break}catch(xe){U$(c,xe)}while(!0);return pi=bl=null,G.H=v,G.A=S,_t=m,ht!==null?0:(qt=null,vt=0,Ug(),hn)}function c6(){for(;ht!==null&&!It();)W$(ht)}function W$(c){var f=x$(c.alternate,c,Ci);c.memoizedProps=c.pendingProps,f===null?wy(c):ht=f}function q$(c){var f=c,m=f.alternate;switch(f.tag){case 15:case 0:f=f$(m,f,f.pendingProps,f.type,void 0,vt);break;case 11:f=f$(m,f,f.pendingProps,f.type.render,f.ref,vt);break;case 5:n1(f);default:b$(m,f),f=ht=K2(f,Ci),f=x$(m,f,Ci)}c.memoizedProps=c.pendingProps,f===null?wy(c):ht=f}function fc(c,f,m,v){pi=bl=null,n1(f),sc=null,sh=0;var S=f.return;try{if(Qq(c,S,f,m,vt)){hn=1,fy(c,Vo(m,c.current)),ht=null;return}}catch(E){if(S!==null)throw ht=S,E;hn=1,fy(c,Vo(m,c.current)),ht=null;return}f.flags&32768?(kt||v===1?c=!0:ac||(vt&536870912)!==0?c=!1:(da=c=!0,(v===2||v===9||v===3||v===6)&&(v=Go.current,v!==null&&v.tag===13&&(v.flags|=16384))),K$(f,c)):wy(f)}function wy(c){var f=c;do{if((f.flags&32768)!==0){K$(f,da);return}c=f.return;var m=t6(f.alternate,f,Ci);if(m!==null){ht=m;return}if(f=f.sibling,f!==null){ht=f;return}ht=f=c}while(f!==null);hn===0&&(hn=5)}function K$(c,f){do{var m=n6(c.alternate,c);if(m!==null){m.flags&=32767,ht=m;return}if(m=c.return,m!==null&&(m.flags|=32768,m.subtreeFlags=0,m.deletions=null),!f&&(c=c.sibling,c!==null)){ht=c;return}ht=c=m}while(c!==null);hn=6,ht=null}function X$(c,f,m,v,S,E,_,z,Y){c.cancelPendingCommit=null;do Cy();while(ys!==0);if((_t&6)!==0)throw Error(s(327));if(f!==null){if(f===c.current)throw Error(s(177));if(E=f.lanes|f.childLanes,E|=$w,UW(c,m,E,_,z,Y),c===qt&&(ht=qt=null,vt=0),uc=f,pa=c,cc=m,O1=E,P1=S,L$=v,(f.subtreeFlags&10256)!==0||(f.flags&10256)!==0?(c.callbackNode=null,c.callbackPriority=0,p6(Vs,function(){return Q$(),null})):(c.callbackNode=null,c.callbackPriority=0),v=(f.flags&13878)!==0,(f.subtreeFlags&13878)!==0||v){v=G.T,G.T=null,S=q.p,q.p=2,_=_t,_t|=4;try{s6(c,f,m)}finally{_t=_,q.p=S,G.T=v}}ys=1,Y$(),J$(),j$()}}function Y$(){if(ys===1){ys=0;var c=pa,f=uc,m=(f.flags&13878)!==0;if((f.subtreeFlags&13878)!==0||m){m=G.T,G.T=null;var v=q.p;q.p=2;var S=_t;_t|=4;try{$$(f,c);var E=Q1,_=P2(c.containerInfo),z=E.focusedElem,Y=E.selectionRange;if(_!==z&&z&&z.ownerDocument&&O2(z.ownerDocument.documentElement,z)){if(Y!==null&&Ew(z)){var fe=Y.start,xe=Y.end;if(xe===void 0&&(xe=fe),"selectionStart"in z)z.selectionStart=fe,z.selectionEnd=Math.min(xe,z.value.length);else{var Ce=z.ownerDocument||document,he=Ce&&Ce.defaultView||window;if(he.getSelection){var pe=he.getSelection(),Ye=z.textContent.length,He=Math.min(Y.start,Ye),zt=Y.end===void 0?He:Math.min(Y.end,Ye);!pe.extend&&He>zt&&(_=zt,zt=He,He=_);var ae=F2(z,He),se=F2(z,zt);if(ae&&se&&(pe.rangeCount!==1||pe.anchorNode!==ae.node||pe.anchorOffset!==ae.offset||pe.focusNode!==se.node||pe.focusOffset!==se.offset)){var de=Ce.createRange();de.setStart(ae.node,ae.offset),pe.removeAllRanges(),He>zt?(pe.addRange(de),pe.extend(se.node,se.offset)):(de.setEnd(se.node,se.offset),pe.addRange(de))}}}}for(Ce=[],pe=z;pe=pe.parentNode;)pe.nodeType===1&&Ce.push({element:pe,left:pe.scrollLeft,top:pe.scrollTop});for(typeof z.focus=="function"&&z.focus(),z=0;z<Ce.length;z++){var we=Ce[z];we.element.scrollLeft=we.left,we.element.scrollTop=we.top}}My=!!Z1,Q1=Z1=null}finally{_t=S,q.p=v,G.T=m}}c.current=f,ys=2}}function J$(){if(ys===2){ys=0;var c=pa,f=uc,m=(f.flags&8772)!==0;if((f.subtreeFlags&8772)!==0||m){m=G.T,G.T=null;var v=q.p;q.p=2;var S=_t;_t|=4;try{I$(c,f.alternate,f)}finally{_t=S,q.p=v,G.T=m}}ys=3}}function j$(){if(ys===4||ys===3){ys=0,Ct();var c=pa,f=uc,m=cc,v=L$;(f.subtreeFlags&10256)!==0||(f.flags&10256)!==0?ys=5:(ys=0,uc=pa=null,Z$(c,c.pendingLanes));var S=c.pendingLanes;if(S===0&&(ha=null),rw(m),f=f.stateNode,jt&&typeof jt.onCommitFiberRoot=="function")try{jt.onCommitFiberRoot(Ss,f,void 0,(f.current.flags&128)===128)}catch{}if(v!==null){f=G.T,S=q.p,q.p=2,G.T=null;try{for(var E=c.onRecoverableError,_=0;_<v.length;_++){var z=v[_];E(z.value,{componentStack:z.stack})}}finally{G.T=f,q.p=S}}(cc&3)!==0&&Cy(),Or(c),S=c.pendingLanes,(m&4194090)!==0&&(S&42)!==0?c===L1?fh++:(fh=0,L1=c):fh=0,hh(0)}}function Z$(c,f){(c.pooledCacheLanes&=f)===0&&(f=c.pooledCache,f!=null&&(c.pooledCache=null,qf(f)))}function Cy(c){return Y$(),J$(),j$(),Q$()}function Q$(){if(ys!==5)return!1;var c=pa,f=O1;O1=0;var m=rw(cc),v=G.T,S=q.p;try{q.p=32>m?32:m,G.T=null,m=P1,P1=null;var E=pa,_=cc;if(ys=0,uc=pa=null,cc=0,(_t&6)!==0)throw Error(s(331));var z=_t;if(_t|=4,O$(E.current),_$(E,E.current,_,m),_t=z,hh(0,!1),jt&&typeof jt.onPostCommitFiberRoot=="function")try{jt.onPostCommitFiberRoot(Ss,E)}catch{}return!0}finally{q.p=S,G.T=v,Z$(c,f)}}function eD(c,f,m){f=Vo(m,f),f=g1(c.stateNode,f,2),c=oa(c,f,2),c!==null&&(ar(c,2),Or(c))}function Ut(c,f,m){if(c.tag===3)eD(c,c,m);else for(;f!==null;){if(f.tag===3){eD(f,c,m);break}else if(f.tag===1){var v=f.stateNode;if(typeof f.type.getDerivedStateFromError=="function"||typeof v.componentDidCatch=="function"&&(ha===null||!ha.has(v))){c=Vo(m,c),m=o$(2),v=oa(f,m,2),v!==null&&(r$(m,v,f,c),ar(v,2),Or(v));break}}f=f.return}}function U1(c,f,m){var v=c.pingCache;if(v===null){v=c.pingCache=new i6;var S=new Set;v.set(f,S)}else S=v.get(f),S===void 0&&(S=new Set,v.set(f,S));S.has(m)||(D1=!0,S.add(m),c=d6.bind(null,c,f,m),f.then(c,c))}function d6(c,f,m){var v=c.pingCache;v!==null&&v.delete(f),c.pingedLanes|=c.suspendedLanes&m,c.warmLanes&=~m,qt===c&&(vt&m)===m&&(hn===4||hn===3&&(vt&62914560)===vt&&300>it()-F1?(_t&2)===0&&dc(c,0):_1|=m,lc===vt&&(lc=0)),Or(c)}function tD(c,f){f===0&&(f=Oo()),c=Ku(c,f),c!==null&&(ar(c,f),Or(c))}function f6(c){var f=c.memoizedState,m=0;f!==null&&(m=f.retryLane),tD(c,m)}function h6(c,f){var m=0;switch(c.tag){case 13:var v=c.stateNode,S=c.memoizedState;S!==null&&(m=S.retryLane);break;case 19:v=c.stateNode;break;case 22:v=c.stateNode._retryCache;break;default:throw Error(s(314))}v!==null&&v.delete(f),tD(c,m)}function p6(c,f){return wt(c,f)}var Ty=null,hc=null,G1=!1,Sy=!1,H1=!1,Il=0;function Or(c){c!==hc&&c.next===null&&(hc===null?Ty=hc=c:hc=hc.next=c),Sy=!0,G1||(G1=!0,g6())}function hh(c,f){if(!H1&&Sy){H1=!0;do for(var m=!1,v=Ty;v!==null;){if(c!==0){var S=v.pendingLanes;if(S===0)var E=0;else{var _=v.suspendedLanes,z=v.pingedLanes;E=(1<<31-ln(42|c)+1)-1,E&=S&~(_&~z),E=E&201326741?E&201326741|1:E?E|2:0}E!==0&&(m=!0,rD(v,E))}else E=vt,E=zn(v,v===qt?E:0,v.cancelPendingCommit!==null||v.timeoutHandle!==-1),(E&3)===0||ir(v,E)||(m=!0,rD(v,E));v=v.next}while(m);H1=!1}}function m6(){nD()}function nD(){Sy=G1=!1;var c=0;Il!==0&&(S6()&&(c=Il),Il=0);for(var f=it(),m=null,v=Ty;v!==null;){var S=v.next,E=sD(v,f);E===0?(v.next=null,m===null?Ty=S:m.next=S,S===null&&(hc=m)):(m=v,(c!==0||(E&3)!==0)&&(Sy=!0)),v=S}hh(c)}function sD(c,f){for(var m=c.suspendedLanes,v=c.pingedLanes,S=c.expirationTimes,E=c.pendingLanes&-62914561;0<E;){var _=31-ln(E),z=1<<_,Y=S[_];Y===-1?((z&m)===0||(z&v)!==0)&&(S[_]=li(z,f)):Y<=f&&(c.expiredLanes|=z),E&=~z}if(f=qt,m=vt,m=zn(c,c===f?m:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),v=c.callbackNode,m===0||c===f&&(Mt===2||Mt===9)||c.cancelPendingCommit!==null)return v!==null&&v!==null&&$t(v),c.callbackNode=null,c.callbackPriority=0;if((m&3)===0||ir(c,m)){if(f=m&-m,f===c.callbackPriority)return f;switch(v!==null&&$t(v),rw(m)){case 2:case 8:m=an;break;case 32:m=Vs;break;case 268435456:m=go;break;default:m=Vs}return v=oD.bind(null,c),m=wt(m,v),c.callbackPriority=f,c.callbackNode=m,f}return v!==null&&v!==null&&$t(v),c.callbackPriority=2,c.callbackNode=null,2}function oD(c,f){if(ys!==0&&ys!==5)return c.callbackNode=null,c.callbackPriority=0,null;var m=c.callbackNode;if(Cy()&&c.callbackNode!==m)return null;var v=vt;return v=zn(c,c===qt?v:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),v===0?null:(z$(c,v,f),sD(c,it()),c.callbackNode!=null&&c.callbackNode===m?oD.bind(null,c):null)}function rD(c,f){if(Cy())return null;z$(c,f,!0)}function g6(){E6(function(){(_t&6)!==0?wt(js,m6):nD()})}function W1(){return Il===0&&(Il=Bn()),Il}function iD(c){return c==null||typeof c=="symbol"||typeof c=="boolean"?null:typeof c=="function"?c:Fg(""+c)}function aD(c,f){var m=f.ownerDocument.createElement("input");return m.name=f.name,m.value=f.value,c.id&&m.setAttribute("form",c.id),f.parentNode.insertBefore(m,f),c=new FormData(c),m.parentNode.removeChild(m),c}function y6(c,f,m,v,S){if(f==="submit"&&m&&m.stateNode===S){var E=iD((S[Zs]||null).action),_=v.submitter;_&&(f=(f=_[Zs]||null)?iD(f.formAction):_.getAttribute("formAction"),f!==null&&(E=f,_=null));var z=new Vg("action","action",null,v,S);c.push({event:z,listeners:[{instance:null,listener:function(){if(v.defaultPrevented){if(Il!==0){var Y=_?aD(S,_):new FormData(S);d1(m,{pending:!0,data:Y,method:S.method,action:E},null,Y)}}else typeof E=="function"&&(z.preventDefault(),Y=_?aD(S,_):new FormData(S),d1(m,{pending:!0,data:Y,method:S.method,action:E},E,Y))},currentTarget:S}]})}}for(var q1=0;q1<Rw.length;q1++){var K1=Rw[q1],x6=K1.toLowerCase(),v6=K1[0].toUpperCase()+K1.slice(1);lr(x6,"on"+v6)}lr(z2,"onAnimationEnd"),lr(B2,"onAnimationIteration"),lr(U2,"onAnimationStart"),lr("dblclick","onDoubleClick"),lr("focusin","onFocus"),lr("focusout","onBlur"),lr(Oq,"onTransitionRun"),lr(Pq,"onTransitionStart"),lr(Lq,"onTransitionCancel"),lr(G2,"onTransitionEnd"),Pu("onMouseEnter",["mouseout","mouseover"]),Pu("onMouseLeave",["mouseout","mouseover"]),Pu("onPointerEnter",["pointerout","pointerover"]),Pu("onPointerLeave",["pointerout","pointerover"]),dl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),dl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),dl("onBeforeInput",["compositionend","keypress","textInput","paste"]),dl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),dl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),dl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ph="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),b6=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(ph));function lD(c,f){f=(f&4)!==0;for(var m=0;m<c.length;m++){var v=c[m],S=v.event;v=v.listeners;e:{var E=void 0;if(f)for(var _=v.length-1;0<=_;_--){var z=v[_],Y=z.instance,fe=z.currentTarget;if(z=z.listener,Y!==E&&S.isPropagationStopped())break e;E=z,S.currentTarget=fe;try{E(S)}catch(xe){dy(xe)}S.currentTarget=null,E=Y}else for(_=0;_<v.length;_++){if(z=v[_],Y=z.instance,fe=z.currentTarget,z=z.listener,Y!==E&&S.isPropagationStopped())break e;E=z,S.currentTarget=fe;try{E(S)}catch(xe){dy(xe)}S.currentTarget=null,E=Y}}}}function pt(c,f){var m=f[iw];m===void 0&&(m=f[iw]=new Set);var v=c+"__bubble";m.has(v)||(uD(f,c,2,!1),m.add(v))}function X1(c,f,m){var v=0;f&&(v|=4),uD(m,c,v,f)}var Ny="_reactListening"+Math.random().toString(36).slice(2);function Y1(c){if(!c[Ny]){c[Ny]=!0,n2.forEach(function(m){m!=="selectionchange"&&(b6.has(m)||X1(m,!1,c),X1(m,!0,c))});var f=c.nodeType===9?c:c.ownerDocument;f===null||f[Ny]||(f[Ny]=!0,X1("selectionchange",!1,f))}}function uD(c,f,m,v){switch(_D(f)){case 2:var S=K6;break;case 8:S=X6;break;default:S=uC}m=S.bind(null,f,m,c),S=void 0,!yw||f!=="touchstart"&&f!=="touchmove"&&f!=="wheel"||(S=!0),v?S!==void 0?c.addEventListener(f,m,{capture:!0,passive:S}):c.addEventListener(f,m,!0):S!==void 0?c.addEventListener(f,m,{passive:S}):c.addEventListener(f,m,!1)}function J1(c,f,m,v,S){var E=v;if((f&1)===0&&(f&2)===0&&v!==null)e:for(;;){if(v===null)return;var _=v.tag;if(_===3||_===4){var z=v.stateNode.containerInfo;if(z===S)break;if(_===4)for(_=v.return;_!==null;){var Y=_.tag;if((Y===3||Y===4)&&_.stateNode.containerInfo===S)return;_=_.return}for(;z!==null;){if(_=Mu(z),_===null)return;if(Y=_.tag,Y===5||Y===6||Y===26||Y===27){v=E=_;continue e}z=z.parentNode}}v=v.return}g2(function(){var fe=E,xe=mw(m),Ce=[];e:{var he=H2.get(c);if(he!==void 0){var pe=Vg,Ye=c;switch(c){case"keypress":if(Pg(m)===0)break e;case"keydown":case"keyup":pe=pq;break;case"focusin":Ye="focus",pe=ww;break;case"focusout":Ye="blur",pe=ww;break;case"beforeblur":case"afterblur":pe=ww;break;case"click":if(m.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":pe=v2;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":pe=nq;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":pe=yq;break;case z2:case B2:case U2:pe=rq;break;case G2:pe=vq;break;case"scroll":case"scrollend":pe=eq;break;case"wheel":pe=wq;break;case"copy":case"cut":case"paste":pe=aq;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":pe=w2;break;case"toggle":case"beforetoggle":pe=Tq}var He=(f&4)!==0,zt=!He&&(c==="scroll"||c==="scrollend"),ae=He?he!==null?he+"Capture":null:he;He=[];for(var se=fe,de;se!==null;){var we=se;if(de=we.stateNode,we=we.tag,we!==5&&we!==26&&we!==27||de===null||ae===null||(we=_f(se,ae),we!=null&&He.push(mh(se,we,de))),zt)break;se=se.return}0<He.length&&(he=new pe(he,Ye,null,m,xe),Ce.push({event:he,listeners:He}))}}if((f&7)===0){e:{if(he=c==="mouseover"||c==="pointerover",pe=c==="mouseout"||c==="pointerout",he&&m!==pw&&(Ye=m.relatedTarget||m.fromElement)&&(Mu(Ye)||Ye[_u]))break e;if((pe||he)&&(he=xe.window===xe?xe:(he=xe.ownerDocument)?he.defaultView||he.parentWindow:window,pe?(Ye=m.relatedTarget||m.toElement,pe=fe,Ye=Ye?Mu(Ye):null,Ye!==null&&(zt=r(Ye),He=Ye.tag,Ye!==zt||He!==5&&He!==27&&He!==6)&&(Ye=null)):(pe=null,Ye=fe),pe!==Ye)){if(He=v2,we="onMouseLeave",ae="onMouseEnter",se="mouse",(c==="pointerout"||c==="pointerover")&&(He=w2,we="onPointerLeave",ae="onPointerEnter",se="pointer"),zt=pe==null?he:Df(pe),de=Ye==null?he:Df(Ye),he=new He(we,se+"leave",pe,m,xe),he.target=zt,he.relatedTarget=de,we=null,Mu(xe)===fe&&(He=new He(ae,se+"enter",Ye,m,xe),He.target=de,He.relatedTarget=zt,we=He),zt=we,pe&&Ye)t:{for(He=pe,ae=Ye,se=0,de=He;de;de=pc(de))se++;for(de=0,we=ae;we;we=pc(we))de++;for(;0<se-de;)He=pc(He),se--;for(;0<de-se;)ae=pc(ae),de--;for(;se--;){if(He===ae||ae!==null&&He===ae.alternate)break t;He=pc(He),ae=pc(ae)}He=null}else He=null;pe!==null&&cD(Ce,he,pe,He,!1),Ye!==null&&zt!==null&&cD(Ce,zt,Ye,He,!0)}}e:{if(he=fe?Df(fe):window,pe=he.nodeName&&he.nodeName.toLowerCase(),pe==="select"||pe==="input"&&he.type==="file")var Oe=A2;else if(I2(he))if(R2)Oe=_q;else{Oe=$q;var ut=Rq}else pe=he.nodeName,!pe||pe.toLowerCase()!=="input"||he.type!=="checkbox"&&he.type!=="radio"?fe&&hw(fe.elementType)&&(Oe=A2):Oe=Dq;if(Oe&&(Oe=Oe(c,fe))){k2(Ce,Oe,m,xe);break e}ut&&ut(c,he,fe),c==="focusout"&&fe&&he.type==="number"&&fe.memoizedProps.value!=null&&fw(he,"number",he.value)}switch(ut=fe?Df(fe):window,c){case"focusin":(I2(ut)||ut.contentEditable==="true")&&(Hu=ut,Iw=fe,Bf=null);break;case"focusout":Bf=Iw=Hu=null;break;case"mousedown":kw=!0;break;case"contextmenu":case"mouseup":case"dragend":kw=!1,L2(Ce,m,xe);break;case"selectionchange":if(Fq)break;case"keydown":case"keyup":L2(Ce,m,xe)}var Ue;if(Tw)e:{switch(c){case"compositionstart":var We="onCompositionStart";break e;case"compositionend":We="onCompositionEnd";break e;case"compositionupdate":We="onCompositionUpdate";break e}We=void 0}else Gu?N2(c,m)&&(We="onCompositionEnd"):c==="keydown"&&m.keyCode===229&&(We="onCompositionStart");We&&(C2&&m.locale!=="ko"&&(Gu||We!=="onCompositionStart"?We==="onCompositionEnd"&&Gu&&(Ue=y2()):(ea=xe,xw="value"in ea?ea.value:ea.textContent,Gu=!0)),ut=Ey(fe,We),0<ut.length&&(We=new b2(We,c,null,m,xe),Ce.push({event:We,listeners:ut}),Ue?We.data=Ue:(Ue=E2(m),Ue!==null&&(We.data=Ue)))),(Ue=Nq?Eq(c,m):Iq(c,m))&&(We=Ey(fe,"onBeforeInput"),0<We.length&&(ut=new b2("onBeforeInput","beforeinput",null,m,xe),Ce.push({event:ut,listeners:We}),ut.data=Ue)),y6(Ce,c,fe,m,xe)}lD(Ce,f)})}function mh(c,f,m){return{instance:c,listener:f,currentTarget:m}}function Ey(c,f){for(var m=f+"Capture",v=[];c!==null;){var S=c,E=S.stateNode;if(S=S.tag,S!==5&&S!==26&&S!==27||E===null||(S=_f(c,m),S!=null&&v.unshift(mh(c,S,E)),S=_f(c,f),S!=null&&v.push(mh(c,S,E))),c.tag===3)return v;c=c.return}return[]}function pc(c){if(c===null)return null;do c=c.return;while(c&&c.tag!==5&&c.tag!==27);return c||null}function cD(c,f,m,v,S){for(var E=f._reactName,_=[];m!==null&&m!==v;){var z=m,Y=z.alternate,fe=z.stateNode;if(z=z.tag,Y!==null&&Y===v)break;z!==5&&z!==26&&z!==27||fe===null||(Y=fe,S?(fe=_f(m,E),fe!=null&&_.unshift(mh(m,fe,Y))):S||(fe=_f(m,E),fe!=null&&_.push(mh(m,fe,Y)))),m=m.return}_.length!==0&&c.push({event:f,listeners:_})}var w6=/\r\n?/g,C6=/\u0000|\uFFFD/g;function dD(c){return(typeof c=="string"?c:""+c).replace(w6,`
`).replace(C6,"")}function fD(c,f){return f=dD(f),dD(c)===f}function Iy(){}function Vt(c,f,m,v,S,E){switch(m){case"children":typeof v=="string"?f==="body"||f==="textarea"&&v===""||zu(c,v):(typeof v=="number"||typeof v=="bigint")&&f!=="body"&&zu(c,""+v);break;case"className":Dg(c,"class",v);break;case"tabIndex":Dg(c,"tabindex",v);break;case"dir":case"role":case"viewBox":case"width":case"height":Dg(c,m,v);break;case"style":p2(c,v,E);break;case"data":if(f!=="object"){Dg(c,"data",v);break}case"src":case"href":if(v===""&&(f!=="a"||m!=="href")){c.removeAttribute(m);break}if(v==null||typeof v=="function"||typeof v=="symbol"||typeof v=="boolean"){c.removeAttribute(m);break}v=Fg(""+v),c.setAttribute(m,v);break;case"action":case"formAction":if(typeof v=="function"){c.setAttribute(m,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof E=="function"&&(m==="formAction"?(f!=="input"&&Vt(c,f,"name",S.name,S,null),Vt(c,f,"formEncType",S.formEncType,S,null),Vt(c,f,"formMethod",S.formMethod,S,null),Vt(c,f,"formTarget",S.formTarget,S,null)):(Vt(c,f,"encType",S.encType,S,null),Vt(c,f,"method",S.method,S,null),Vt(c,f,"target",S.target,S,null)));if(v==null||typeof v=="symbol"||typeof v=="boolean"){c.removeAttribute(m);break}v=Fg(""+v),c.setAttribute(m,v);break;case"onClick":v!=null&&(c.onclick=Iy);break;case"onScroll":v!=null&&pt("scroll",c);break;case"onScrollEnd":v!=null&&pt("scrollend",c);break;case"dangerouslySetInnerHTML":if(v!=null){if(typeof v!="object"||!("__html"in v))throw Error(s(61));if(m=v.__html,m!=null){if(S.children!=null)throw Error(s(60));c.innerHTML=m}}break;case"multiple":c.multiple=v&&typeof v!="function"&&typeof v!="symbol";break;case"muted":c.muted=v&&typeof v!="function"&&typeof v!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(v==null||typeof v=="function"||typeof v=="boolean"||typeof v=="symbol"){c.removeAttribute("xlink:href");break}m=Fg(""+v),c.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",m);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":v!=null&&typeof v!="function"&&typeof v!="symbol"?c.setAttribute(m,""+v):c.removeAttribute(m);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":v&&typeof v!="function"&&typeof v!="symbol"?c.setAttribute(m,""):c.removeAttribute(m);break;case"capture":case"download":v===!0?c.setAttribute(m,""):v!==!1&&v!=null&&typeof v!="function"&&typeof v!="symbol"?c.setAttribute(m,v):c.removeAttribute(m);break;case"cols":case"rows":case"size":case"span":v!=null&&typeof v!="function"&&typeof v!="symbol"&&!isNaN(v)&&1<=v?c.setAttribute(m,v):c.removeAttribute(m);break;case"rowSpan":case"start":v==null||typeof v=="function"||typeof v=="symbol"||isNaN(v)?c.removeAttribute(m):c.setAttribute(m,v);break;case"popover":pt("beforetoggle",c),pt("toggle",c),$g(c,"popover",v);break;case"xlinkActuate":ui(c,"http://www.w3.org/1999/xlink","xlink:actuate",v);break;case"xlinkArcrole":ui(c,"http://www.w3.org/1999/xlink","xlink:arcrole",v);break;case"xlinkRole":ui(c,"http://www.w3.org/1999/xlink","xlink:role",v);break;case"xlinkShow":ui(c,"http://www.w3.org/1999/xlink","xlink:show",v);break;case"xlinkTitle":ui(c,"http://www.w3.org/1999/xlink","xlink:title",v);break;case"xlinkType":ui(c,"http://www.w3.org/1999/xlink","xlink:type",v);break;case"xmlBase":ui(c,"http://www.w3.org/XML/1998/namespace","xml:base",v);break;case"xmlLang":ui(c,"http://www.w3.org/XML/1998/namespace","xml:lang",v);break;case"xmlSpace":ui(c,"http://www.w3.org/XML/1998/namespace","xml:space",v);break;case"is":$g(c,"is",v);break;case"innerText":case"textContent":break;default:(!(2<m.length)||m[0]!=="o"&&m[0]!=="O"||m[1]!=="n"&&m[1]!=="N")&&(m=ZW.get(m)||m,$g(c,m,v))}}function j1(c,f,m,v,S,E){switch(m){case"style":p2(c,v,E);break;case"dangerouslySetInnerHTML":if(v!=null){if(typeof v!="object"||!("__html"in v))throw Error(s(61));if(m=v.__html,m!=null){if(S.children!=null)throw Error(s(60));c.innerHTML=m}}break;case"children":typeof v=="string"?zu(c,v):(typeof v=="number"||typeof v=="bigint")&&zu(c,""+v);break;case"onScroll":v!=null&&pt("scroll",c);break;case"onScrollEnd":v!=null&&pt("scrollend",c);break;case"onClick":v!=null&&(c.onclick=Iy);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!s2.hasOwnProperty(m))e:{if(m[0]==="o"&&m[1]==="n"&&(S=m.endsWith("Capture"),f=m.slice(2,S?m.length-7:void 0),E=c[Zs]||null,E=E!=null?E[m]:null,typeof E=="function"&&c.removeEventListener(f,E,S),typeof v=="function")){typeof E!="function"&&E!==null&&(m in c?c[m]=null:c.hasAttribute(m)&&c.removeAttribute(m)),c.addEventListener(f,v,S);break e}m in c?c[m]=v:v===!0?c.setAttribute(m,""):$g(c,m,v)}}}function xs(c,f,m){switch(f){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":pt("error",c),pt("load",c);var v=!1,S=!1,E;for(E in m)if(m.hasOwnProperty(E)){var _=m[E];if(_!=null)switch(E){case"src":v=!0;break;case"srcSet":S=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,f));default:Vt(c,f,E,_,m,null)}}S&&Vt(c,f,"srcSet",m.srcSet,m,null),v&&Vt(c,f,"src",m.src,m,null);return;case"input":pt("invalid",c);var z=E=_=S=null,Y=null,fe=null;for(v in m)if(m.hasOwnProperty(v)){var xe=m[v];if(xe!=null)switch(v){case"name":S=xe;break;case"type":_=xe;break;case"checked":Y=xe;break;case"defaultChecked":fe=xe;break;case"value":E=xe;break;case"defaultValue":z=xe;break;case"children":case"dangerouslySetInnerHTML":if(xe!=null)throw Error(s(137,f));break;default:Vt(c,f,v,xe,m,null)}}c2(c,E,z,Y,fe,_,S,!1),_g(c);return;case"select":pt("invalid",c),v=_=E=null;for(S in m)if(m.hasOwnProperty(S)&&(z=m[S],z!=null))switch(S){case"value":E=z;break;case"defaultValue":_=z;break;case"multiple":v=z;default:Vt(c,f,S,z,m,null)}f=E,m=_,c.multiple=!!v,f!=null?Vu(c,!!v,f,!1):m!=null&&Vu(c,!!v,m,!0);return;case"textarea":pt("invalid",c),E=S=v=null;for(_ in m)if(m.hasOwnProperty(_)&&(z=m[_],z!=null))switch(_){case"value":v=z;break;case"defaultValue":S=z;break;case"children":E=z;break;case"dangerouslySetInnerHTML":if(z!=null)throw Error(s(91));break;default:Vt(c,f,_,z,m,null)}f2(c,v,S,E),_g(c);return;case"option":for(Y in m)if(m.hasOwnProperty(Y)&&(v=m[Y],v!=null))switch(Y){case"selected":c.selected=v&&typeof v!="function"&&typeof v!="symbol";break;default:Vt(c,f,Y,v,m,null)}return;case"dialog":pt("beforetoggle",c),pt("toggle",c),pt("cancel",c),pt("close",c);break;case"iframe":case"object":pt("load",c);break;case"video":case"audio":for(v=0;v<ph.length;v++)pt(ph[v],c);break;case"image":pt("error",c),pt("load",c);break;case"details":pt("toggle",c);break;case"embed":case"source":case"link":pt("error",c),pt("load",c);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(fe in m)if(m.hasOwnProperty(fe)&&(v=m[fe],v!=null))switch(fe){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,f));default:Vt(c,f,fe,v,m,null)}return;default:if(hw(f)){for(xe in m)m.hasOwnProperty(xe)&&(v=m[xe],v!==void 0&&j1(c,f,xe,v,m,void 0));return}}for(z in m)m.hasOwnProperty(z)&&(v=m[z],v!=null&&Vt(c,f,z,v,m,null))}function T6(c,f,m,v){switch(f){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var S=null,E=null,_=null,z=null,Y=null,fe=null,xe=null;for(pe in m){var Ce=m[pe];if(m.hasOwnProperty(pe)&&Ce!=null)switch(pe){case"checked":break;case"value":break;case"defaultValue":Y=Ce;default:v.hasOwnProperty(pe)||Vt(c,f,pe,null,v,Ce)}}for(var he in v){var pe=v[he];if(Ce=m[he],v.hasOwnProperty(he)&&(pe!=null||Ce!=null))switch(he){case"type":E=pe;break;case"name":S=pe;break;case"checked":fe=pe;break;case"defaultChecked":xe=pe;break;case"value":_=pe;break;case"defaultValue":z=pe;break;case"children":case"dangerouslySetInnerHTML":if(pe!=null)throw Error(s(137,f));break;default:pe!==Ce&&Vt(c,f,he,pe,v,Ce)}}dw(c,_,z,Y,fe,xe,E,S);return;case"select":pe=_=z=he=null;for(E in m)if(Y=m[E],m.hasOwnProperty(E)&&Y!=null)switch(E){case"value":break;case"multiple":pe=Y;default:v.hasOwnProperty(E)||Vt(c,f,E,null,v,Y)}for(S in v)if(E=v[S],Y=m[S],v.hasOwnProperty(S)&&(E!=null||Y!=null))switch(S){case"value":he=E;break;case"defaultValue":z=E;break;case"multiple":_=E;default:E!==Y&&Vt(c,f,S,E,v,Y)}f=z,m=_,v=pe,he!=null?Vu(c,!!m,he,!1):!!v!=!!m&&(f!=null?Vu(c,!!m,f,!0):Vu(c,!!m,m?[]:"",!1));return;case"textarea":pe=he=null;for(z in m)if(S=m[z],m.hasOwnProperty(z)&&S!=null&&!v.hasOwnProperty(z))switch(z){case"value":break;case"children":break;default:Vt(c,f,z,null,v,S)}for(_ in v)if(S=v[_],E=m[_],v.hasOwnProperty(_)&&(S!=null||E!=null))switch(_){case"value":he=S;break;case"defaultValue":pe=S;break;case"children":break;case"dangerouslySetInnerHTML":if(S!=null)throw Error(s(91));break;default:S!==E&&Vt(c,f,_,S,v,E)}d2(c,he,pe);return;case"option":for(var Ye in m)if(he=m[Ye],m.hasOwnProperty(Ye)&&he!=null&&!v.hasOwnProperty(Ye))switch(Ye){case"selected":c.selected=!1;break;default:Vt(c,f,Ye,null,v,he)}for(Y in v)if(he=v[Y],pe=m[Y],v.hasOwnProperty(Y)&&he!==pe&&(he!=null||pe!=null))switch(Y){case"selected":c.selected=he&&typeof he!="function"&&typeof he!="symbol";break;default:Vt(c,f,Y,he,v,pe)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var He in m)he=m[He],m.hasOwnProperty(He)&&he!=null&&!v.hasOwnProperty(He)&&Vt(c,f,He,null,v,he);for(fe in v)if(he=v[fe],pe=m[fe],v.hasOwnProperty(fe)&&he!==pe&&(he!=null||pe!=null))switch(fe){case"children":case"dangerouslySetInnerHTML":if(he!=null)throw Error(s(137,f));break;default:Vt(c,f,fe,he,v,pe)}return;default:if(hw(f)){for(var zt in m)he=m[zt],m.hasOwnProperty(zt)&&he!==void 0&&!v.hasOwnProperty(zt)&&j1(c,f,zt,void 0,v,he);for(xe in v)he=v[xe],pe=m[xe],!v.hasOwnProperty(xe)||he===pe||he===void 0&&pe===void 0||j1(c,f,xe,he,v,pe);return}}for(var ae in m)he=m[ae],m.hasOwnProperty(ae)&&he!=null&&!v.hasOwnProperty(ae)&&Vt(c,f,ae,null,v,he);for(Ce in v)he=v[Ce],pe=m[Ce],!v.hasOwnProperty(Ce)||he===pe||he==null&&pe==null||Vt(c,f,Ce,he,v,pe)}var Z1=null,Q1=null;function ky(c){return c.nodeType===9?c:c.ownerDocument}function hD(c){switch(c){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function pD(c,f){if(c===0)switch(f){case"svg":return 1;case"math":return 2;default:return 0}return c===1&&f==="foreignObject"?0:c}function eC(c,f){return c==="textarea"||c==="noscript"||typeof f.children=="string"||typeof f.children=="number"||typeof f.children=="bigint"||typeof f.dangerouslySetInnerHTML=="object"&&f.dangerouslySetInnerHTML!==null&&f.dangerouslySetInnerHTML.__html!=null}var tC=null;function S6(){var c=window.event;return c&&c.type==="popstate"?c===tC?!1:(tC=c,!0):(tC=null,!1)}var mD=typeof setTimeout=="function"?setTimeout:void 0,N6=typeof clearTimeout=="function"?clearTimeout:void 0,gD=typeof Promise=="function"?Promise:void 0,E6=typeof queueMicrotask=="function"?queueMicrotask:typeof gD<"u"?function(c){return gD.resolve(null).then(c).catch(I6)}:mD;function I6(c){setTimeout(function(){throw c})}function ga(c){return c==="head"}function yD(c,f){var m=f,v=0,S=0;do{var E=m.nextSibling;if(c.removeChild(m),E&&E.nodeType===8)if(m=E.data,m==="/$"){if(0<v&&8>v){m=v;var _=c.ownerDocument;if(m&1&&gh(_.documentElement),m&2&&gh(_.body),m&4)for(m=_.head,gh(m),_=m.firstChild;_;){var z=_.nextSibling,Y=_.nodeName;_[$f]||Y==="SCRIPT"||Y==="STYLE"||Y==="LINK"&&_.rel.toLowerCase()==="stylesheet"||m.removeChild(_),_=z}}if(S===0){c.removeChild(E),Sh(f);return}S--}else m==="$"||m==="$?"||m==="$!"?S++:v=m.charCodeAt(0)-48;else v=0;m=E}while(m);Sh(f)}function nC(c){var f=c.firstChild;for(f&&f.nodeType===10&&(f=f.nextSibling);f;){var m=f;switch(f=f.nextSibling,m.nodeName){case"HTML":case"HEAD":case"BODY":nC(m),aw(m);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(m.rel.toLowerCase()==="stylesheet")continue}c.removeChild(m)}}function k6(c,f,m,v){for(;c.nodeType===1;){var S=m;if(c.nodeName.toLowerCase()!==f.toLowerCase()){if(!v&&(c.nodeName!=="INPUT"||c.type!=="hidden"))break}else if(v){if(!c[$f])switch(f){case"meta":if(!c.hasAttribute("itemprop"))break;return c;case"link":if(E=c.getAttribute("rel"),E==="stylesheet"&&c.hasAttribute("data-precedence"))break;if(E!==S.rel||c.getAttribute("href")!==(S.href==null||S.href===""?null:S.href)||c.getAttribute("crossorigin")!==(S.crossOrigin==null?null:S.crossOrigin)||c.getAttribute("title")!==(S.title==null?null:S.title))break;return c;case"style":if(c.hasAttribute("data-precedence"))break;return c;case"script":if(E=c.getAttribute("src"),(E!==(S.src==null?null:S.src)||c.getAttribute("type")!==(S.type==null?null:S.type)||c.getAttribute("crossorigin")!==(S.crossOrigin==null?null:S.crossOrigin))&&E&&c.hasAttribute("async")&&!c.hasAttribute("itemprop"))break;return c;default:return c}}else if(f==="input"&&c.type==="hidden"){var E=S.name==null?null:""+S.name;if(S.type==="hidden"&&c.getAttribute("name")===E)return c}else return c;if(c=cr(c.nextSibling),c===null)break}return null}function A6(c,f,m){if(f==="")return null;for(;c.nodeType!==3;)if((c.nodeType!==1||c.nodeName!=="INPUT"||c.type!=="hidden")&&!m||(c=cr(c.nextSibling),c===null))return null;return c}function sC(c){return c.data==="$!"||c.data==="$?"&&c.ownerDocument.readyState==="complete"}function R6(c,f){var m=c.ownerDocument;if(c.data!=="$?"||m.readyState==="complete")f();else{var v=function(){f(),m.removeEventListener("DOMContentLoaded",v)};m.addEventListener("DOMContentLoaded",v),c._reactRetry=v}}function cr(c){for(;c!=null;c=c.nextSibling){var f=c.nodeType;if(f===1||f===3)break;if(f===8){if(f=c.data,f==="$"||f==="$!"||f==="$?"||f==="F!"||f==="F")break;if(f==="/$")return null}}return c}var oC=null;function xD(c){c=c.previousSibling;for(var f=0;c;){if(c.nodeType===8){var m=c.data;if(m==="$"||m==="$!"||m==="$?"){if(f===0)return c;f--}else m==="/$"&&f++}c=c.previousSibling}return null}function vD(c,f,m){switch(f=ky(m),c){case"html":if(c=f.documentElement,!c)throw Error(s(452));return c;case"head":if(c=f.head,!c)throw Error(s(453));return c;case"body":if(c=f.body,!c)throw Error(s(454));return c;default:throw Error(s(451))}}function gh(c){for(var f=c.attributes;f.length;)c.removeAttributeNode(f[0]);aw(c)}var Wo=new Map,bD=new Set;function Ay(c){return typeof c.getRootNode=="function"?c.getRootNode():c.nodeType===9?c:c.ownerDocument}var Ti=q.d;q.d={f:$6,r:D6,D:_6,C:M6,L:F6,m:O6,X:L6,S:P6,M:V6};function $6(){var c=Ti.f(),f=by();return c||f}function D6(c){var f=Fu(c);f!==null&&f.tag===5&&f.type==="form"?zR(f):Ti.r(c)}var mc=typeof document>"u"?null:document;function wD(c,f,m){var v=mc;if(v&&typeof f=="string"&&f){var S=Lo(f);S='link[rel="'+c+'"][href="'+S+'"]',typeof m=="string"&&(S+='[crossorigin="'+m+'"]'),bD.has(S)||(bD.add(S),c={rel:c,crossOrigin:m,href:f},v.querySelector(S)===null&&(f=v.createElement("link"),xs(f,"link",c),es(f),v.head.appendChild(f)))}}function _6(c){Ti.D(c),wD("dns-prefetch",c,null)}function M6(c,f){Ti.C(c,f),wD("preconnect",c,f)}function F6(c,f,m){Ti.L(c,f,m);var v=mc;if(v&&c&&f){var S='link[rel="preload"][as="'+Lo(f)+'"]';f==="image"&&m&&m.imageSrcSet?(S+='[imagesrcset="'+Lo(m.imageSrcSet)+'"]',typeof m.imageSizes=="string"&&(S+='[imagesizes="'+Lo(m.imageSizes)+'"]')):S+='[href="'+Lo(c)+'"]';var E=S;switch(f){case"style":E=gc(c);break;case"script":E=yc(c)}Wo.has(E)||(c=d({rel:"preload",href:f==="image"&&m&&m.imageSrcSet?void 0:c,as:f},m),Wo.set(E,c),v.querySelector(S)!==null||f==="style"&&v.querySelector(yh(E))||f==="script"&&v.querySelector(xh(E))||(f=v.createElement("link"),xs(f,"link",c),es(f),v.head.appendChild(f)))}}function O6(c,f){Ti.m(c,f);var m=mc;if(m&&c){var v=f&&typeof f.as=="string"?f.as:"script",S='link[rel="modulepreload"][as="'+Lo(v)+'"][href="'+Lo(c)+'"]',E=S;switch(v){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":E=yc(c)}if(!Wo.has(E)&&(c=d({rel:"modulepreload",href:c},f),Wo.set(E,c),m.querySelector(S)===null)){switch(v){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(m.querySelector(xh(E)))return}v=m.createElement("link"),xs(v,"link",c),es(v),m.head.appendChild(v)}}}function P6(c,f,m){Ti.S(c,f,m);var v=mc;if(v&&c){var S=Ou(v).hoistableStyles,E=gc(c);f=f||"default";var _=S.get(E);if(!_){var z={loading:0,preload:null};if(_=v.querySelector(yh(E)))z.loading=5;else{c=d({rel:"stylesheet",href:c,"data-precedence":f},m),(m=Wo.get(E))&&rC(c,m);var Y=_=v.createElement("link");es(Y),xs(Y,"link",c),Y._p=new Promise(function(fe,xe){Y.onload=fe,Y.onerror=xe}),Y.addEventListener("load",function(){z.loading|=1}),Y.addEventListener("error",function(){z.loading|=2}),z.loading|=4,Ry(_,f,v)}_={type:"stylesheet",instance:_,count:1,state:z},S.set(E,_)}}}function L6(c,f){Ti.X(c,f);var m=mc;if(m&&c){var v=Ou(m).hoistableScripts,S=yc(c),E=v.get(S);E||(E=m.querySelector(xh(S)),E||(c=d({src:c,async:!0},f),(f=Wo.get(S))&&iC(c,f),E=m.createElement("script"),es(E),xs(E,"link",c),m.head.appendChild(E)),E={type:"script",instance:E,count:1,state:null},v.set(S,E))}}function V6(c,f){Ti.M(c,f);var m=mc;if(m&&c){var v=Ou(m).hoistableScripts,S=yc(c),E=v.get(S);E||(E=m.querySelector(xh(S)),E||(c=d({src:c,async:!0,type:"module"},f),(f=Wo.get(S))&&iC(c,f),E=m.createElement("script"),es(E),xs(E,"link",c),m.head.appendChild(E)),E={type:"script",instance:E,count:1,state:null},v.set(S,E))}}function CD(c,f,m,v){var S=(S=be.current)?Ay(S):null;if(!S)throw Error(s(446));switch(c){case"meta":case"title":return null;case"style":return typeof m.precedence=="string"&&typeof m.href=="string"?(f=gc(m.href),m=Ou(S).hoistableStyles,v=m.get(f),v||(v={type:"style",instance:null,count:0,state:null},m.set(f,v)),v):{type:"void",instance:null,count:0,state:null};case"link":if(m.rel==="stylesheet"&&typeof m.href=="string"&&typeof m.precedence=="string"){c=gc(m.href);var E=Ou(S).hoistableStyles,_=E.get(c);if(_||(S=S.ownerDocument||S,_={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},E.set(c,_),(E=S.querySelector(yh(c)))&&!E._p&&(_.instance=E,_.state.loading=5),Wo.has(c)||(m={rel:"preload",as:"style",href:m.href,crossOrigin:m.crossOrigin,integrity:m.integrity,media:m.media,hrefLang:m.hrefLang,referrerPolicy:m.referrerPolicy},Wo.set(c,m),E||z6(S,c,m,_.state))),f&&v===null)throw Error(s(528,""));return _}if(f&&v!==null)throw Error(s(529,""));return null;case"script":return f=m.async,m=m.src,typeof m=="string"&&f&&typeof f!="function"&&typeof f!="symbol"?(f=yc(m),m=Ou(S).hoistableScripts,v=m.get(f),v||(v={type:"script",instance:null,count:0,state:null},m.set(f,v)),v):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,c))}}function gc(c){return'href="'+Lo(c)+'"'}function yh(c){return'link[rel="stylesheet"]['+c+"]"}function TD(c){return d({},c,{"data-precedence":c.precedence,precedence:null})}function z6(c,f,m,v){c.querySelector('link[rel="preload"][as="style"]['+f+"]")?v.loading=1:(f=c.createElement("link"),v.preload=f,f.addEventListener("load",function(){return v.loading|=1}),f.addEventListener("error",function(){return v.loading|=2}),xs(f,"link",m),es(f),c.head.appendChild(f))}function yc(c){return'[src="'+Lo(c)+'"]'}function xh(c){return"script[async]"+c}function SD(c,f,m){if(f.count++,f.instance===null)switch(f.type){case"style":var v=c.querySelector('style[data-href~="'+Lo(m.href)+'"]');if(v)return f.instance=v,es(v),v;var S=d({},m,{"data-href":m.href,"data-precedence":m.precedence,href:null,precedence:null});return v=(c.ownerDocument||c).createElement("style"),es(v),xs(v,"style",S),Ry(v,m.precedence,c),f.instance=v;case"stylesheet":S=gc(m.href);var E=c.querySelector(yh(S));if(E)return f.state.loading|=4,f.instance=E,es(E),E;v=TD(m),(S=Wo.get(S))&&rC(v,S),E=(c.ownerDocument||c).createElement("link"),es(E);var _=E;return _._p=new Promise(function(z,Y){_.onload=z,_.onerror=Y}),xs(E,"link",v),f.state.loading|=4,Ry(E,m.precedence,c),f.instance=E;case"script":return E=yc(m.src),(S=c.querySelector(xh(E)))?(f.instance=S,es(S),S):(v=m,(S=Wo.get(E))&&(v=d({},m),iC(v,S)),c=c.ownerDocument||c,S=c.createElement("script"),es(S),xs(S,"link",v),c.head.appendChild(S),f.instance=S);case"void":return null;default:throw Error(s(443,f.type))}else f.type==="stylesheet"&&(f.state.loading&4)===0&&(v=f.instance,f.state.loading|=4,Ry(v,m.precedence,c));return f.instance}function Ry(c,f,m){for(var v=m.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),S=v.length?v[v.length-1]:null,E=S,_=0;_<v.length;_++){var z=v[_];if(z.dataset.precedence===f)E=z;else if(E!==S)break}E?E.parentNode.insertBefore(c,E.nextSibling):(f=m.nodeType===9?m.head:m,f.insertBefore(c,f.firstChild))}function rC(c,f){c.crossOrigin==null&&(c.crossOrigin=f.crossOrigin),c.referrerPolicy==null&&(c.referrerPolicy=f.referrerPolicy),c.title==null&&(c.title=f.title)}function iC(c,f){c.crossOrigin==null&&(c.crossOrigin=f.crossOrigin),c.referrerPolicy==null&&(c.referrerPolicy=f.referrerPolicy),c.integrity==null&&(c.integrity=f.integrity)}var $y=null;function ND(c,f,m){if($y===null){var v=new Map,S=$y=new Map;S.set(m,v)}else S=$y,v=S.get(m),v||(v=new Map,S.set(m,v));if(v.has(c))return v;for(v.set(c,null),m=m.getElementsByTagName(c),S=0;S<m.length;S++){var E=m[S];if(!(E[$f]||E[Ns]||c==="link"&&E.getAttribute("rel")==="stylesheet")&&E.namespaceURI!=="http://www.w3.org/2000/svg"){var _=E.getAttribute(f)||"";_=c+_;var z=v.get(_);z?z.push(E):v.set(_,[E])}}return v}function ED(c,f,m){c=c.ownerDocument||c,c.head.insertBefore(m,f==="title"?c.querySelector("head > title"):null)}function B6(c,f,m){if(m===1||f.itemProp!=null)return!1;switch(c){case"meta":case"title":return!0;case"style":if(typeof f.precedence!="string"||typeof f.href!="string"||f.href==="")break;return!0;case"link":if(typeof f.rel!="string"||typeof f.href!="string"||f.href===""||f.onLoad||f.onError)break;switch(f.rel){case"stylesheet":return c=f.disabled,typeof f.precedence=="string"&&c==null;default:return!0}case"script":if(f.async&&typeof f.async!="function"&&typeof f.async!="symbol"&&!f.onLoad&&!f.onError&&f.src&&typeof f.src=="string")return!0}return!1}function ID(c){return!(c.type==="stylesheet"&&(c.state.loading&3)===0)}var vh=null;function U6(){}function G6(c,f,m){if(vh===null)throw Error(s(475));var v=vh;if(f.type==="stylesheet"&&(typeof m.media!="string"||matchMedia(m.media).matches!==!1)&&(f.state.loading&4)===0){if(f.instance===null){var S=gc(m.href),E=c.querySelector(yh(S));if(E){c=E._p,c!==null&&typeof c=="object"&&typeof c.then=="function"&&(v.count++,v=Dy.bind(v),c.then(v,v)),f.state.loading|=4,f.instance=E,es(E);return}E=c.ownerDocument||c,m=TD(m),(S=Wo.get(S))&&rC(m,S),E=E.createElement("link"),es(E);var _=E;_._p=new Promise(function(z,Y){_.onload=z,_.onerror=Y}),xs(E,"link",m),f.instance=E}v.stylesheets===null&&(v.stylesheets=new Map),v.stylesheets.set(f,c),(c=f.state.preload)&&(f.state.loading&3)===0&&(v.count++,f=Dy.bind(v),c.addEventListener("load",f),c.addEventListener("error",f))}}function H6(){if(vh===null)throw Error(s(475));var c=vh;return c.stylesheets&&c.count===0&&aC(c,c.stylesheets),0<c.count?function(f){var m=setTimeout(function(){if(c.stylesheets&&aC(c,c.stylesheets),c.unsuspend){var v=c.unsuspend;c.unsuspend=null,v()}},6e4);return c.unsuspend=f,function(){c.unsuspend=null,clearTimeout(m)}}:null}function Dy(){if(this.count--,this.count===0){if(this.stylesheets)aC(this,this.stylesheets);else if(this.unsuspend){var c=this.unsuspend;this.unsuspend=null,c()}}}var _y=null;function aC(c,f){c.stylesheets=null,c.unsuspend!==null&&(c.count++,_y=new Map,f.forEach(W6,c),_y=null,Dy.call(c))}function W6(c,f){if(!(f.state.loading&4)){var m=_y.get(c);if(m)var v=m.get(null);else{m=new Map,_y.set(c,m);for(var S=c.querySelectorAll("link[data-precedence],style[data-precedence]"),E=0;E<S.length;E++){var _=S[E];(_.nodeName==="LINK"||_.getAttribute("media")!=="not all")&&(m.set(_.dataset.precedence,_),v=_)}v&&m.set(null,v)}S=f.instance,_=S.getAttribute("data-precedence"),E=m.get(_)||v,E===v&&m.set(null,S),m.set(_,S),this.count++,v=Dy.bind(this),S.addEventListener("load",v),S.addEventListener("error",v),E?E.parentNode.insertBefore(S,E.nextSibling):(c=c.nodeType===9?c.head:c,c.insertBefore(S,c.firstChild)),f.state.loading|=4}}var bh={$$typeof:I,Provider:null,Consumer:null,_currentValue:J,_currentValue2:J,_threadCount:0};function q6(c,f,m,v,S,E,_,z){this.tag=1,this.containerInfo=c,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Zi(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Zi(0),this.hiddenUpdates=Zi(null),this.identifierPrefix=v,this.onUncaughtError=S,this.onCaughtError=E,this.onRecoverableError=_,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=z,this.incompleteTransitions=new Map}function kD(c,f,m,v,S,E,_,z,Y,fe,xe,Ce){return c=new q6(c,f,m,_,z,Y,fe,Ce),f=1,E===!0&&(f|=24),E=vo(3,null,null,f),c.current=E,E.stateNode=c,f=Uw(),f.refCount++,c.pooledCache=f,f.refCount++,E.memoizedState={element:v,isDehydrated:m,cache:f},qw(E),c}function AD(c){return c?(c=Xu,c):Xu}function RD(c,f,m,v,S,E){S=AD(S),v.context===null?v.context=S:v.pendingContext=S,v=sa(f),v.payload={element:m},E=E===void 0?null:E,E!==null&&(v.callback=E),m=oa(c,v,f),m!==null&&(So(m,c,f),Jf(m,c,f))}function $D(c,f){if(c=c.memoizedState,c!==null&&c.dehydrated!==null){var m=c.retryLane;c.retryLane=m!==0&&m<f?m:f}}function lC(c,f){$D(c,f),(c=c.alternate)&&$D(c,f)}function DD(c){if(c.tag===13){var f=Ku(c,67108864);f!==null&&So(f,c,67108864),lC(c,67108864)}}var My=!0;function K6(c,f,m,v){var S=G.T;G.T=null;var E=q.p;try{q.p=2,uC(c,f,m,v)}finally{q.p=E,G.T=S}}function X6(c,f,m,v){var S=G.T;G.T=null;var E=q.p;try{q.p=8,uC(c,f,m,v)}finally{q.p=E,G.T=S}}function uC(c,f,m,v){if(My){var S=cC(v);if(S===null)J1(c,f,v,Fy,m),MD(c,v);else if(J6(S,c,f,m,v))v.stopPropagation();else if(MD(c,v),f&4&&-1<Y6.indexOf(c)){for(;S!==null;){var E=Fu(S);if(E!==null)switch(E.tag){case 3:if(E=E.stateNode,E.current.memoizedState.isDehydrated){var _=Tt(E.pendingLanes);if(_!==0){var z=E;for(z.pendingLanes|=2,z.entangledLanes|=2;_;){var Y=1<<31-ln(_);z.entanglements[1]|=Y,_&=~Y}Or(E),(_t&6)===0&&(xy=it()+500,hh(0))}}break;case 13:z=Ku(E,2),z!==null&&So(z,E,2),by(),lC(E,2)}if(E=cC(v),E===null&&J1(c,f,v,Fy,m),E===S)break;S=E}S!==null&&v.stopPropagation()}else J1(c,f,v,null,m)}}function cC(c){return c=mw(c),dC(c)}var Fy=null;function dC(c){if(Fy=null,c=Mu(c),c!==null){var f=r(c);if(f===null)c=null;else{var m=f.tag;if(m===13){if(c=i(f),c!==null)return c;c=null}else if(m===3){if(f.stateNode.current.memoizedState.isDehydrated)return f.tag===3?f.stateNode.containerInfo:null;c=null}else f!==c&&(c=null)}}return Fy=c,null}function _D(c){switch(c){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Dt()){case js:return 2;case an:return 8;case Vs:case Qn:return 32;case go:return 268435456;default:return 32}default:return 32}}var fC=!1,ya=null,xa=null,va=null,wh=new Map,Ch=new Map,ba=[],Y6="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function MD(c,f){switch(c){case"focusin":case"focusout":ya=null;break;case"dragenter":case"dragleave":xa=null;break;case"mouseover":case"mouseout":va=null;break;case"pointerover":case"pointerout":wh.delete(f.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ch.delete(f.pointerId)}}function Th(c,f,m,v,S,E){return c===null||c.nativeEvent!==E?(c={blockedOn:f,domEventName:m,eventSystemFlags:v,nativeEvent:E,targetContainers:[S]},f!==null&&(f=Fu(f),f!==null&&DD(f)),c):(c.eventSystemFlags|=v,f=c.targetContainers,S!==null&&f.indexOf(S)===-1&&f.push(S),c)}function J6(c,f,m,v,S){switch(f){case"focusin":return ya=Th(ya,c,f,m,v,S),!0;case"dragenter":return xa=Th(xa,c,f,m,v,S),!0;case"mouseover":return va=Th(va,c,f,m,v,S),!0;case"pointerover":var E=S.pointerId;return wh.set(E,Th(wh.get(E)||null,c,f,m,v,S)),!0;case"gotpointercapture":return E=S.pointerId,Ch.set(E,Th(Ch.get(E)||null,c,f,m,v,S)),!0}return!1}function FD(c){var f=Mu(c.target);if(f!==null){var m=r(f);if(m!==null){if(f=m.tag,f===13){if(f=i(m),f!==null){c.blockedOn=f,GW(c.priority,function(){if(m.tag===13){var v=To();v=ow(v);var S=Ku(m,v);S!==null&&So(S,m,v),lC(m,v)}});return}}else if(f===3&&m.stateNode.current.memoizedState.isDehydrated){c.blockedOn=m.tag===3?m.stateNode.containerInfo:null;return}}}c.blockedOn=null}function Oy(c){if(c.blockedOn!==null)return!1;for(var f=c.targetContainers;0<f.length;){var m=cC(c.nativeEvent);if(m===null){m=c.nativeEvent;var v=new m.constructor(m.type,m);pw=v,m.target.dispatchEvent(v),pw=null}else return f=Fu(m),f!==null&&DD(f),c.blockedOn=m,!1;f.shift()}return!0}function OD(c,f,m){Oy(c)&&m.delete(f)}function j6(){fC=!1,ya!==null&&Oy(ya)&&(ya=null),xa!==null&&Oy(xa)&&(xa=null),va!==null&&Oy(va)&&(va=null),wh.forEach(OD),Ch.forEach(OD)}function Py(c,f){c.blockedOn===f&&(c.blockedOn=null,fC||(fC=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,j6)))}var Ly=null;function PD(c){Ly!==c&&(Ly=c,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Ly===c&&(Ly=null);for(var f=0;f<c.length;f+=3){var m=c[f],v=c[f+1],S=c[f+2];if(typeof v!="function"){if(dC(v||m)===null)continue;break}var E=Fu(m);E!==null&&(c.splice(f,3),f-=3,d1(E,{pending:!0,data:S,method:m.method,action:v},v,S))}}))}function Sh(c){function f(Y){return Py(Y,c)}ya!==null&&Py(ya,c),xa!==null&&Py(xa,c),va!==null&&Py(va,c),wh.forEach(f),Ch.forEach(f);for(var m=0;m<ba.length;m++){var v=ba[m];v.blockedOn===c&&(v.blockedOn=null)}for(;0<ba.length&&(m=ba[0],m.blockedOn===null);)FD(m),m.blockedOn===null&&ba.shift();if(m=(c.ownerDocument||c).$$reactFormReplay,m!=null)for(v=0;v<m.length;v+=3){var S=m[v],E=m[v+1],_=S[Zs]||null;if(typeof E=="function")_||PD(m);else if(_){var z=null;if(E&&E.hasAttribute("formAction")){if(S=E,_=E[Zs]||null)z=_.formAction;else if(dC(S)!==null)continue}else z=_.action;typeof z=="function"?m[v+1]=z:(m.splice(v,3),v-=3),PD(m)}}}function hC(c){this._internalRoot=c}Vy.prototype.render=hC.prototype.render=function(c){var f=this._internalRoot;if(f===null)throw Error(s(409));var m=f.current,v=To();RD(m,v,c,f,null,null)},Vy.prototype.unmount=hC.prototype.unmount=function(){var c=this._internalRoot;if(c!==null){this._internalRoot=null;var f=c.containerInfo;RD(c.current,2,null,c,null,null),by(),f[_u]=null}};function Vy(c){this._internalRoot=c}Vy.prototype.unstable_scheduleHydration=function(c){if(c){var f=e2();c={blockedOn:null,target:c,priority:f};for(var m=0;m<ba.length&&f!==0&&f<ba[m].priority;m++);ba.splice(m,0,c),m===0&&FD(c)}};var LD=e.version;if(LD!=="19.1.1")throw Error(s(527,LD,"19.1.1"));q.findDOMNode=function(c){var f=c._reactInternals;if(f===void 0)throw typeof c.render=="function"?Error(s(188)):(c=Object.keys(c).join(","),Error(s(268,c)));return c=l(f),c=c!==null?u(c):null,c=c===null?null:c.stateNode,c};var Z6={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:G,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var zy=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!zy.isDisabled&&zy.supportsFiber)try{Ss=zy.inject(Z6),jt=zy}catch{}}return Eh.createRoot=function(c,f){if(!o(c))throw Error(s(299));var m=!1,v="",S=e$,E=t$,_=n$,z=null;return f!=null&&(f.unstable_strictMode===!0&&(m=!0),f.identifierPrefix!==void 0&&(v=f.identifierPrefix),f.onUncaughtError!==void 0&&(S=f.onUncaughtError),f.onCaughtError!==void 0&&(E=f.onCaughtError),f.onRecoverableError!==void 0&&(_=f.onRecoverableError),f.unstable_transitionCallbacks!==void 0&&(z=f.unstable_transitionCallbacks)),f=kD(c,1,!1,null,null,m,v,S,E,_,z,null),c[_u]=f.current,Y1(c),new hC(f)},Eh.hydrateRoot=function(c,f,m){if(!o(c))throw Error(s(299));var v=!1,S="",E=e$,_=t$,z=n$,Y=null,fe=null;return m!=null&&(m.unstable_strictMode===!0&&(v=!0),m.identifierPrefix!==void 0&&(S=m.identifierPrefix),m.onUncaughtError!==void 0&&(E=m.onUncaughtError),m.onCaughtError!==void 0&&(_=m.onCaughtError),m.onRecoverableError!==void 0&&(z=m.onRecoverableError),m.unstable_transitionCallbacks!==void 0&&(Y=m.unstable_transitionCallbacks),m.formState!==void 0&&(fe=m.formState)),f=kD(c,1,!0,f,m??null,v,S,E,_,z,Y,fe),f.context=AD(null),m=f.current,v=To(),v=ow(v),S=sa(v),S.callback=null,oa(m,S,v),m=v,f.current.lanes=m,ar(f,m),Or(f),c[_u]=f.current,Y1(c),new Vy(f)},Eh.version="19.1.1",Eh}var XD;function f5(){if(XD)return gC.exports;XD=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),gC.exports=d5(),gC.exports}var h5=f5();const p5=Cx(h5),YS=ce.createContext({});function JS(t){const e=ce.useRef(null);return e.current===null&&(e.current=t()),e.current}const jS=typeof window<"u",qP=jS?ce.useLayoutEffect:ce.useEffect,Tx=ce.createContext(null);function ZS(t,e){t.indexOf(e)===-1&&t.push(e)}function QS(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}const Di=(t,e,n)=>n>e?e:n<t?t:n;let eN=()=>{};const _i={},KP=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t);function XP(t){return typeof t=="object"&&t!==null}const YP=t=>/^0[^.\s]+$/u.test(t);function tN(t){let e;return()=>(e===void 0&&(e=t()),e)}const er=t=>t,m5=(t,e)=>n=>e(t(n)),Fp=(...t)=>t.reduce(m5),rp=(t,e,n)=>{const s=e-t;return s===0?1:(n-t)/s};class nN{constructor(){this.subscriptions=[]}add(e){return ZS(this.subscriptions,e),()=>QS(this.subscriptions,e)}notify(e,n,s){const o=this.subscriptions.length;if(o)if(o===1)this.subscriptions[0](e,n,s);else for(let r=0;r<o;r++){const i=this.subscriptions[r];i&&i(e,n,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Kr=t=>t*1e3,Xr=t=>t/1e3;function JP(t,e){return e?t*(1e3/e):0}const jP=(t,e,n)=>(((1-3*n+3*e)*t+(3*n-6*e))*t+3*e)*t,g5=1e-7,y5=12;function x5(t,e,n,s,o){let r,i,a=0;do i=e+(n-e)/2,r=jP(i,s,o)-t,r>0?n=i:e=i;while(Math.abs(r)>g5&&++a<y5);return i}function Op(t,e,n,s){if(t===e&&n===s)return er;const o=r=>x5(r,0,1,t,n);return r=>r===0||r===1?r:jP(o(r),e,s)}const ZP=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,QP=t=>e=>1-t(1-e),eL=Op(.33,1.53,.69,.99),sN=QP(eL),tL=ZP(sN),nL=t=>(t*=2)<1?.5*sN(t):.5*(2-Math.pow(2,-10*(t-1))),oN=t=>1-Math.sin(Math.acos(t)),sL=QP(oN),oL=ZP(oN),v5=Op(.42,0,1,1),b5=Op(0,0,.58,1),rL=Op(.42,0,.58,1),w5=t=>Array.isArray(t)&&typeof t[0]!="number",iL=t=>Array.isArray(t)&&typeof t[0]=="number",C5={linear:er,easeIn:v5,easeInOut:rL,easeOut:b5,circIn:oN,circInOut:oL,circOut:sL,backIn:sN,backInOut:tL,backOut:eL,anticipate:nL},T5=t=>typeof t=="string",YD=t=>{if(iL(t)){eN(t.length===4);const[e,n,s,o]=t;return Op(e,n,s,o)}else if(T5(t))return C5[t];return t},By=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function S5(t,e){let n=new Set,s=new Set,o=!1,r=!1;const i=new WeakSet;let a={delta:0,timestamp:0,isProcessing:!1};function l(d){i.has(d)&&(u.schedule(d),t()),d(a)}const u={schedule:(d,h=!1,p=!1)=>{const b=p&&o?n:s;return h&&i.add(d),b.has(d)||b.add(d),d},cancel:d=>{s.delete(d),i.delete(d)},process:d=>{if(a=d,o){r=!0;return}o=!0,[n,s]=[s,n],n.forEach(l),n.clear(),o=!1,r&&(r=!1,u.process(d))}};return u}const N5=40;function aL(t,e){let n=!1,s=!0;const o={delta:0,timestamp:0,isProcessing:!1},r=()=>n=!0,i=By.reduce((I,k)=>(I[k]=S5(r),I),{}),{setup:a,read:l,resolveKeyframes:u,preUpdate:d,update:h,preRender:p,render:x,postRender:b}=i,w=()=>{const I=_i.useManualTiming?o.timestamp:performance.now();n=!1,_i.useManualTiming||(o.delta=s?1e3/60:Math.max(Math.min(I-o.timestamp,N5),1)),o.timestamp=I,o.isProcessing=!0,a.process(o),l.process(o),u.process(o),d.process(o),h.process(o),p.process(o),x.process(o),b.process(o),o.isProcessing=!1,n&&e&&(s=!1,t(w))},C=()=>{n=!0,s=!0,o.isProcessing||t(w)};return{schedule:By.reduce((I,k)=>{const A=i[k];return I[k]=($,M=!1,O=!1)=>(n||C(),A.schedule($,M,O)),I},{}),cancel:I=>{for(let k=0;k<By.length;k++)i[By[k]].cancel(I)},state:o,steps:i}}const{schedule:nn,cancel:La,state:vs,steps:bC}=aL(typeof requestAnimationFrame<"u"?requestAnimationFrame:er,!0);let d0;function E5(){d0=void 0}const lo={now:()=>(d0===void 0&&lo.set(vs.isProcessing||_i.useManualTiming?vs.timestamp:performance.now()),d0),set:t=>{d0=t,queueMicrotask(E5)}},lL=t=>e=>typeof e=="string"&&e.startsWith(t),rN=lL("--"),I5=lL("var(--"),iN=t=>I5(t)?k5.test(t.split("/*")[0].trim()):!1,k5=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,sd={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},ip={...sd,transform:t=>Di(0,1,t)},Uy={...sd,default:1},Yh=t=>Math.round(t*1e5)/1e5,aN=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function A5(t){return t==null}const R5=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,lN=(t,e)=>n=>!!(typeof n=="string"&&R5.test(n)&&n.startsWith(t)||e&&!A5(n)&&Object.prototype.hasOwnProperty.call(n,e)),uL=(t,e,n)=>s=>{if(typeof s!="string")return s;const[o,r,i,a]=s.match(aN);return{[t]:parseFloat(o),[e]:parseFloat(r),[n]:parseFloat(i),alpha:a!==void 0?parseFloat(a):1}},$5=t=>Di(0,255,t),wC={...sd,transform:t=>Math.round($5(t))},Vl={test:lN("rgb","red"),parse:uL("red","green","blue"),transform:({red:t,green:e,blue:n,alpha:s=1})=>"rgba("+wC.transform(t)+", "+wC.transform(e)+", "+wC.transform(n)+", "+Yh(ip.transform(s))+")"};function D5(t){let e="",n="",s="",o="";return t.length>5?(e=t.substring(1,3),n=t.substring(3,5),s=t.substring(5,7),o=t.substring(7,9)):(e=t.substring(1,2),n=t.substring(2,3),s=t.substring(3,4),o=t.substring(4,5),e+=e,n+=n,s+=s,o+=o),{red:parseInt(e,16),green:parseInt(n,16),blue:parseInt(s,16),alpha:o?parseInt(o,16)/255:1}}const cT={test:lN("#"),parse:D5,transform:Vl.transform},Pp=t=>({test:e=>typeof e=="string"&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),Sa=Pp("deg"),Yr=Pp("%"),Je=Pp("px"),_5=Pp("vh"),M5=Pp("vw"),JD={...Yr,parse:t=>Yr.parse(t)/100,transform:t=>Yr.transform(t*100)},Nc={test:lN("hsl","hue"),parse:uL("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:n,alpha:s=1})=>"hsla("+Math.round(t)+", "+Yr.transform(Yh(e))+", "+Yr.transform(Yh(n))+", "+Yh(ip.transform(s))+")"},_n={test:t=>Vl.test(t)||cT.test(t)||Nc.test(t),parse:t=>Vl.test(t)?Vl.parse(t):Nc.test(t)?Nc.parse(t):cT.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?Vl.transform(t):Nc.transform(t),getAnimatableNone:t=>{const e=_n.parse(t);return e.alpha=0,_n.transform(e)}},F5=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function O5(t){var e,n;return isNaN(t)&&typeof t=="string"&&(((e=t.match(aN))==null?void 0:e.length)||0)+(((n=t.match(F5))==null?void 0:n.length)||0)>0}const cL="number",dL="color",P5="var",L5="var(",jD="${}",V5=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function ap(t){const e=t.toString(),n=[],s={color:[],number:[],var:[]},o=[];let r=0;const a=e.replace(V5,l=>(_n.test(l)?(s.color.push(r),o.push(dL),n.push(_n.parse(l))):l.startsWith(L5)?(s.var.push(r),o.push(P5),n.push(l)):(s.number.push(r),o.push(cL),n.push(parseFloat(l))),++r,jD)).split(jD);return{values:n,split:a,indexes:s,types:o}}function fL(t){return ap(t).values}function hL(t){const{split:e,types:n}=ap(t),s=e.length;return o=>{let r="";for(let i=0;i<s;i++)if(r+=e[i],o[i]!==void 0){const a=n[i];a===cL?r+=Yh(o[i]):a===dL?r+=_n.transform(o[i]):r+=o[i]}return r}}const z5=t=>typeof t=="number"?0:_n.test(t)?_n.getAnimatableNone(t):t;function B5(t){const e=fL(t);return hL(t)(e.map(z5))}const Va={test:O5,parse:fL,createTransformer:hL,getAnimatableNone:B5};function CC(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function U5({hue:t,saturation:e,lightness:n,alpha:s}){t/=360,e/=100,n/=100;let o=0,r=0,i=0;if(!e)o=r=i=n;else{const a=n<.5?n*(1+e):n+e-n*e,l=2*n-a;o=CC(l,a,t+1/3),r=CC(l,a,t),i=CC(l,a,t-1/3)}return{red:Math.round(o*255),green:Math.round(r*255),blue:Math.round(i*255),alpha:s}}function F0(t,e){return n=>n>0?e:t}const cn=(t,e,n)=>t+(e-t)*n,TC=(t,e,n)=>{const s=t*t,o=n*(e*e-s)+s;return o<0?0:Math.sqrt(o)},G5=[cT,Vl,Nc],H5=t=>G5.find(e=>e.test(t));function ZD(t){const e=H5(t);if(!e)return!1;let n=e.parse(t);return e===Nc&&(n=U5(n)),n}const QD=(t,e)=>{const n=ZD(t),s=ZD(e);if(!n||!s)return F0(t,e);const o={...n};return r=>(o.red=TC(n.red,s.red,r),o.green=TC(n.green,s.green,r),o.blue=TC(n.blue,s.blue,r),o.alpha=cn(n.alpha,s.alpha,r),Vl.transform(o))},dT=new Set(["none","hidden"]);function W5(t,e){return dT.has(t)?n=>n<=0?t:e:n=>n>=1?e:t}function q5(t,e){return n=>cn(t,e,n)}function uN(t){return typeof t=="number"?q5:typeof t=="string"?iN(t)?F0:_n.test(t)?QD:Y5:Array.isArray(t)?pL:typeof t=="object"?_n.test(t)?QD:K5:F0}function pL(t,e){const n=[...t],s=n.length,o=t.map((r,i)=>uN(r)(r,e[i]));return r=>{for(let i=0;i<s;i++)n[i]=o[i](r);return n}}function K5(t,e){const n={...t,...e},s={};for(const o in n)t[o]!==void 0&&e[o]!==void 0&&(s[o]=uN(t[o])(t[o],e[o]));return o=>{for(const r in s)n[r]=s[r](o);return n}}function X5(t,e){const n=[],s={color:0,var:0,number:0};for(let o=0;o<e.values.length;o++){const r=e.types[o],i=t.indexes[r][s[r]],a=t.values[i]??0;n[o]=a,s[r]++}return n}const Y5=(t,e)=>{const n=Va.createTransformer(e),s=ap(t),o=ap(e);return s.indexes.var.length===o.indexes.var.length&&s.indexes.color.length===o.indexes.color.length&&s.indexes.number.length>=o.indexes.number.length?dT.has(t)&&!o.values.length||dT.has(e)&&!s.values.length?W5(t,e):Fp(pL(X5(s,o),o.values),n):F0(t,e)};function mL(t,e,n){return typeof t=="number"&&typeof e=="number"&&typeof n=="number"?cn(t,e,n):uN(t)(t,e)}const J5=t=>{const e=({timestamp:n})=>t(n);return{start:(n=!0)=>nn.update(e,n),stop:()=>La(e),now:()=>vs.isProcessing?vs.timestamp:lo.now()}},gL=(t,e,n=10)=>{let s="";const o=Math.max(Math.round(e/n),2);for(let r=0;r<o;r++)s+=Math.round(t(r/(o-1))*1e4)/1e4+", ";return`linear(${s.substring(0,s.length-2)})`},O0=2e4;function cN(t){let e=0;const n=50;let s=t.next(e);for(;!s.done&&e<O0;)e+=n,s=t.next(e);return e>=O0?1/0:e}function j5(t,e=100,n){const s=n({...t,keyframes:[0,e]}),o=Math.min(cN(s),O0);return{type:"keyframes",ease:r=>s.next(o*r).value/e,duration:Xr(o)}}const Z5=5;function yL(t,e,n){const s=Math.max(e-Z5,0);return JP(n-t(s),e-s)}const pn={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},SC=.001;function Q5({duration:t=pn.duration,bounce:e=pn.bounce,velocity:n=pn.velocity,mass:s=pn.mass}){let o,r,i=1-e;i=Di(pn.minDamping,pn.maxDamping,i),t=Di(pn.minDuration,pn.maxDuration,Xr(t)),i<1?(o=u=>{const d=u*i,h=d*t,p=d-n,x=fT(u,i),b=Math.exp(-h);return SC-p/x*b},r=u=>{const h=u*i*t,p=h*n+n,x=Math.pow(i,2)*Math.pow(u,2)*t,b=Math.exp(-h),w=fT(Math.pow(u,2),i);return(-o(u)+SC>0?-1:1)*((p-x)*b)/w}):(o=u=>{const d=Math.exp(-u*t),h=(u-n)*t+1;return-SC+d*h},r=u=>{const d=Math.exp(-u*t),h=(n-u)*(t*t);return d*h});const a=5/t,l=t8(o,r,a);if(t=Kr(t),isNaN(l))return{stiffness:pn.stiffness,damping:pn.damping,duration:t};{const u=Math.pow(l,2)*s;return{stiffness:u,damping:i*2*Math.sqrt(s*u),duration:t}}}const e8=12;function t8(t,e,n){let s=n;for(let o=1;o<e8;o++)s=s-t(s)/e(s);return s}function fT(t,e){return t*Math.sqrt(1-e*e)}const n8=["duration","bounce"],s8=["stiffness","damping","mass"];function e_(t,e){return e.some(n=>t[n]!==void 0)}function o8(t){let e={velocity:pn.velocity,stiffness:pn.stiffness,damping:pn.damping,mass:pn.mass,isResolvedFromDuration:!1,...t};if(!e_(t,s8)&&e_(t,n8))if(t.visualDuration){const n=t.visualDuration,s=2*Math.PI/(n*1.2),o=s*s,r=2*Di(.05,1,1-(t.bounce||0))*Math.sqrt(o);e={...e,mass:pn.mass,stiffness:o,damping:r}}else{const n=Q5(t);e={...e,...n,mass:pn.mass},e.isResolvedFromDuration=!0}return e}function P0(t=pn.visualDuration,e=pn.bounce){const n=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:e}:t;let{restSpeed:s,restDelta:o}=n;const r=n.keyframes[0],i=n.keyframes[n.keyframes.length-1],a={done:!1,value:r},{stiffness:l,damping:u,mass:d,duration:h,velocity:p,isResolvedFromDuration:x}=o8({...n,velocity:-Xr(n.velocity||0)}),b=p||0,w=u/(2*Math.sqrt(l*d)),C=i-r,T=Xr(Math.sqrt(l/d)),N=Math.abs(C)<5;s||(s=N?pn.restSpeed.granular:pn.restSpeed.default),o||(o=N?pn.restDelta.granular:pn.restDelta.default);let I;if(w<1){const A=fT(T,w);I=$=>{const M=Math.exp(-w*T*$);return i-M*((b+w*T*C)/A*Math.sin(A*$)+C*Math.cos(A*$))}}else if(w===1)I=A=>i-Math.exp(-T*A)*(C+(b+T*C)*A);else{const A=T*Math.sqrt(w*w-1);I=$=>{const M=Math.exp(-w*T*$),O=Math.min(A*$,300);return i-M*((b+w*T*C)*Math.sinh(O)+A*C*Math.cosh(O))/A}}const k={calculatedDuration:x&&h||null,next:A=>{const $=I(A);if(x)a.done=A>=h;else{let M=A===0?b:0;w<1&&(M=A===0?Kr(b):yL(I,A,$));const O=Math.abs(M)<=s,F=Math.abs(i-$)<=o;a.done=O&&F}return a.value=a.done?i:$,a},toString:()=>{const A=Math.min(cN(k),O0),$=gL(M=>k.next(A*M).value,A,30);return A+"ms "+$},toTransition:()=>{}};return k}P0.applyToOptions=t=>{const e=j5(t,100,P0);return t.ease=e.ease,t.duration=Kr(e.duration),t.type="keyframes",t};function hT({keyframes:t,velocity:e=0,power:n=.8,timeConstant:s=325,bounceDamping:o=10,bounceStiffness:r=500,modifyTarget:i,min:a,max:l,restDelta:u=.5,restSpeed:d}){const h=t[0],p={done:!1,value:h},x=O=>a!==void 0&&O<a||l!==void 0&&O>l,b=O=>a===void 0?l:l===void 0||Math.abs(a-O)<Math.abs(l-O)?a:l;let w=n*e;const C=h+w,T=i===void 0?C:i(C);T!==C&&(w=T-h);const N=O=>-w*Math.exp(-O/s),I=O=>T+N(O),k=O=>{const F=N(O),P=I(O);p.done=Math.abs(F)<=u,p.value=p.done?T:P};let A,$;const M=O=>{x(p.value)&&(A=O,$=P0({keyframes:[p.value,b(p.value)],velocity:yL(I,O,p.value),damping:o,stiffness:r,restDelta:u,restSpeed:d}))};return M(0),{calculatedDuration:null,next:O=>{let F=!1;return!$&&A===void 0&&(F=!0,k(O),M(O)),A!==void 0&&O>=A?$.next(O-A):(!F&&k(O),p)}}}function r8(t,e,n){const s=[],o=n||_i.mix||mL,r=t.length-1;for(let i=0;i<r;i++){let a=o(t[i],t[i+1]);if(e){const l=Array.isArray(e)?e[i]||er:e;a=Fp(l,a)}s.push(a)}return s}function i8(t,e,{clamp:n=!0,ease:s,mixer:o}={}){const r=t.length;if(eN(r===e.length),r===1)return()=>e[0];if(r===2&&e[0]===e[1])return()=>e[1];const i=t[0]===t[1];t[0]>t[r-1]&&(t=[...t].reverse(),e=[...e].reverse());const a=r8(e,s,o),l=a.length,u=d=>{if(i&&d<t[0])return e[0];let h=0;if(l>1)for(;h<t.length-2&&!(d<t[h+1]);h++);const p=rp(t[h],t[h+1],d);return a[h](p)};return n?d=>u(Di(t[0],t[r-1],d)):u}function a8(t,e){const n=t[t.length-1];for(let s=1;s<=e;s++){const o=rp(0,e,s);t.push(cn(n,1,o))}}function l8(t){const e=[0];return a8(e,t.length-1),e}function u8(t,e){return t.map(n=>n*e)}function c8(t,e){return t.map(()=>e||rL).splice(0,t.length-1)}function Jh({duration:t=300,keyframes:e,times:n,ease:s="easeInOut"}){const o=w5(s)?s.map(YD):YD(s),r={done:!1,value:e[0]},i=u8(n&&n.length===e.length?n:l8(e),t),a=i8(i,e,{ease:Array.isArray(o)?o:c8(e,o)});return{calculatedDuration:t,next:l=>(r.value=a(l),r.done=l>=t,r)}}const d8=t=>t!==null;function dN(t,{repeat:e,repeatType:n="loop"},s,o=1){const r=t.filter(d8),a=o<0||e&&n!=="loop"&&e%2===1?0:r.length-1;return!a||s===void 0?r[a]:s}const f8={decay:hT,inertia:hT,tween:Jh,keyframes:Jh,spring:P0};function xL(t){typeof t.type=="string"&&(t.type=f8[t.type])}class fN{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,n){return this.finished.then(e,n)}}const h8=t=>t/100;class hN extends fN{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var s,o;const{motionValue:n}=this.options;n&&n.updatedAt!==lo.now()&&this.tick(lo.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(o=(s=this.options).onStop)==null||o.call(s))},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;xL(e);const{type:n=Jh,repeat:s=0,repeatDelay:o=0,repeatType:r,velocity:i=0}=e;let{keyframes:a}=e;const l=n||Jh;l!==Jh&&typeof a[0]!="number"&&(this.mixKeyframes=Fp(h8,mL(a[0],a[1])),a=[0,100]);const u=l({...e,keyframes:a});r==="mirror"&&(this.mirroredGenerator=l({...e,keyframes:[...a].reverse(),velocity:-i})),u.calculatedDuration===null&&(u.calculatedDuration=cN(u));const{calculatedDuration:d}=u;this.calculatedDuration=d,this.resolvedDuration=d+o,this.totalDuration=this.resolvedDuration*(s+1)-o,this.generator=u}updateTime(e){const n=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=n}tick(e,n=!1){const{generator:s,totalDuration:o,mixKeyframes:r,mirroredGenerator:i,resolvedDuration:a,calculatedDuration:l}=this;if(this.startTime===null)return s.next(0);const{delay:u=0,keyframes:d,repeat:h,repeatType:p,repeatDelay:x,type:b,onUpdate:w,finalKeyframe:C}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-o/this.speed,this.startTime)),n?this.currentTime=e:this.updateTime(e);const T=this.currentTime-u*(this.playbackSpeed>=0?1:-1),N=this.playbackSpeed>=0?T<0:T>o;this.currentTime=Math.max(T,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=o);let I=this.currentTime,k=s;if(h){const O=Math.min(this.currentTime,o)/a;let F=Math.floor(O),P=O%1;!P&&O>=1&&(P=1),P===1&&F--,F=Math.min(F,h+1),!!(F%2)&&(p==="reverse"?(P=1-P,x&&(P-=x/a)):p==="mirror"&&(k=i)),I=Di(0,1,P)*a}const A=N?{done:!1,value:d[0]}:k.next(I);r&&(A.value=r(A.value));let{done:$}=A;!N&&l!==null&&($=this.playbackSpeed>=0?this.currentTime>=o:this.currentTime<=0);const M=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&$);return M&&b!==hT&&(A.value=dN(d,this.options,C,this.speed)),w&&w(A.value),M&&this.finish(),A}then(e,n){return this.finished.then(e,n)}get duration(){return Xr(this.calculatedDuration)}get time(){return Xr(this.currentTime)}set time(e){var n;e=Kr(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),(n=this.driver)==null||n.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(lo.now());const n=this.playbackSpeed!==e;this.playbackSpeed=e,n&&(this.time=Xr(this.currentTime))}play(){var o,r;if(this.isStopped)return;const{driver:e=J5,startTime:n}=this.options;this.driver||(this.driver=e(i=>this.tick(i))),(r=(o=this.options).onPlay)==null||r.call(o);const s=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=s):this.holdTime!==null?this.startTime=s-this.holdTime:this.startTime||(this.startTime=n??s),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(lo.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var e,n;this.notifyFinished(),this.teardown(),this.state="finished",(n=(e=this.options).onComplete)==null||n.call(e)}cancel(){var e,n;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(n=(e=this.options).onCancel)==null||n.call(e)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){var n;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(n=this.driver)==null||n.stop(),e.observe(this)}}function p8(t){for(let e=1;e<t.length;e++)t[e]??(t[e]=t[e-1])}const zl=t=>t*180/Math.PI,pT=t=>{const e=zl(Math.atan2(t[1],t[0]));return mT(e)},m8={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:t=>(Math.abs(t[0])+Math.abs(t[3]))/2,rotate:pT,rotateZ:pT,skewX:t=>zl(Math.atan(t[1])),skewY:t=>zl(Math.atan(t[2])),skew:t=>(Math.abs(t[1])+Math.abs(t[2]))/2},mT=t=>(t=t%360,t<0&&(t+=360),t),t_=pT,n_=t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),s_=t=>Math.sqrt(t[4]*t[4]+t[5]*t[5]),g8={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:n_,scaleY:s_,scale:t=>(n_(t)+s_(t))/2,rotateX:t=>mT(zl(Math.atan2(t[6],t[5]))),rotateY:t=>mT(zl(Math.atan2(-t[2],t[0]))),rotateZ:t_,rotate:t_,skewX:t=>zl(Math.atan(t[4])),skewY:t=>zl(Math.atan(t[1])),skew:t=>(Math.abs(t[1])+Math.abs(t[4]))/2};function gT(t){return t.includes("scale")?1:0}function yT(t,e){if(!t||t==="none")return gT(e);const n=t.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let s,o;if(n)s=g8,o=n;else{const a=t.match(/^matrix\(([-\d.e\s,]+)\)$/u);s=m8,o=a}if(!o)return gT(e);const r=s[e],i=o[1].split(",").map(x8);return typeof r=="function"?r(i):i[r]}const y8=(t,e)=>{const{transform:n="none"}=getComputedStyle(t);return yT(n,e)};function x8(t){return parseFloat(t.trim())}const od=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],rd=new Set(od),o_=t=>t===sd||t===Je,v8=new Set(["x","y","z"]),b8=od.filter(t=>!v8.has(t));function w8(t){const e=[];return b8.forEach(n=>{const s=t.getValue(n);s!==void 0&&(e.push([n,s.get()]),s.set(n.startsWith("scale")?1:0))}),e}const Gl={width:({x:t},{paddingLeft:e="0",paddingRight:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),height:({y:t},{paddingTop:e="0",paddingBottom:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:(t,{transform:e})=>yT(e,"x"),y:(t,{transform:e})=>yT(e,"y")};Gl.translateX=Gl.x;Gl.translateY=Gl.y;const Hl=new Set;let xT=!1,vT=!1,bT=!1;function vL(){if(vT){const t=Array.from(Hl).filter(s=>s.needsMeasurement),e=new Set(t.map(s=>s.element)),n=new Map;e.forEach(s=>{const o=w8(s);o.length&&(n.set(s,o),s.render())}),t.forEach(s=>s.measureInitialState()),e.forEach(s=>{s.render();const o=n.get(s);o&&o.forEach(([r,i])=>{var a;(a=s.getValue(r))==null||a.set(i)})}),t.forEach(s=>s.measureEndState()),t.forEach(s=>{s.suspendedScrollY!==void 0&&window.scrollTo(0,s.suspendedScrollY)})}vT=!1,xT=!1,Hl.forEach(t=>t.complete(bT)),Hl.clear()}function bL(){Hl.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(vT=!0)})}function C8(){bT=!0,bL(),vL(),bT=!1}class pN{constructor(e,n,s,o,r,i=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=n,this.name=s,this.motionValue=o,this.element=r,this.isAsync=i}scheduleResolve(){this.state="scheduled",this.isAsync?(Hl.add(this),xT||(xT=!0,nn.read(bL),nn.resolveKeyframes(vL))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:n,element:s,motionValue:o}=this;if(e[0]===null){const r=o==null?void 0:o.get(),i=e[e.length-1];if(r!==void 0)e[0]=r;else if(s&&n){const a=s.readValue(n,i);a!=null&&(e[0]=a)}e[0]===void 0&&(e[0]=i),o&&r===void 0&&o.set(e[0])}p8(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),Hl.delete(this)}cancel(){this.state==="scheduled"&&(Hl.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const T8=t=>t.startsWith("--");function S8(t,e,n){T8(e)?t.style.setProperty(e,n):t.style[e]=n}const N8=tN(()=>window.ScrollTimeline!==void 0),E8={};function I8(t,e){const n=tN(t);return()=>E8[e]??n()}const wL=I8(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Vh=([t,e,n,s])=>`cubic-bezier(${t}, ${e}, ${n}, ${s})`,r_={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Vh([0,.65,.55,1]),circOut:Vh([.55,0,1,.45]),backIn:Vh([.31,.01,.66,-.59]),backOut:Vh([.33,1.53,.69,.99])};function CL(t,e){if(t)return typeof t=="function"?wL()?gL(t,e):"ease-out":iL(t)?Vh(t):Array.isArray(t)?t.map(n=>CL(n,e)||r_.easeOut):r_[t]}function k8(t,e,n,{delay:s=0,duration:o=300,repeat:r=0,repeatType:i="loop",ease:a="easeOut",times:l}={},u=void 0){const d={[e]:n};l&&(d.offset=l);const h=CL(a,o);Array.isArray(h)&&(d.easing=h);const p={delay:s,duration:o,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:r+1,direction:i==="reverse"?"alternate":"normal"};return u&&(p.pseudoElement=u),t.animate(d,p)}function TL(t){return typeof t=="function"&&"applyToOptions"in t}function A8({type:t,...e}){return TL(t)&&wL()?t.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class R8 extends fN{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:n,name:s,keyframes:o,pseudoElement:r,allowFlatten:i=!1,finalKeyframe:a,onComplete:l}=e;this.isPseudoElement=!!r,this.allowFlatten=i,this.options=e,eN(typeof e.type!="string");const u=A8(e);this.animation=k8(n,s,o,u,r),u.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!r){const d=dN(o,this.options,a,this.speed);this.updateMotionValue?this.updateMotionValue(d):S8(n,s,d),this.animation.cancel()}l==null||l(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var e,n;(n=(e=this.animation).finish)==null||n.call(e)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var e,n;this.isPseudoElement||(n=(e=this.animation).commitStyles)==null||n.call(e)}get duration(){var n,s;const e=((s=(n=this.animation.effect)==null?void 0:n.getComputedTiming)==null?void 0:s.call(n).duration)||0;return Xr(Number(e))}get time(){return Xr(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=Kr(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:n}){var s;return this.allowFlatten&&((s=this.animation.effect)==null||s.updateTiming({easing:"linear"})),this.animation.onfinish=null,e&&N8()?(this.animation.timeline=e,er):n(this)}}const SL={anticipate:nL,backInOut:tL,circInOut:oL};function $8(t){return t in SL}function D8(t){typeof t.ease=="string"&&$8(t.ease)&&(t.ease=SL[t.ease])}const i_=10;class _8 extends R8{constructor(e){D8(e),xL(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:n,onUpdate:s,onComplete:o,element:r,...i}=this.options;if(!n)return;if(e!==void 0){n.set(e);return}const a=new hN({...i,autoplay:!1}),l=Kr(this.finishedTime??this.time);n.setWithVelocity(a.sample(l-i_).value,a.sample(l).value,i_),a.stop()}}const a_=(t,e)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(Va.test(t)||t==="0")&&!t.startsWith("url("));function M8(t){const e=t[0];if(t.length===1)return!0;for(let n=0;n<t.length;n++)if(t[n]!==e)return!0}function F8(t,e,n,s){const o=t[0];if(o===null)return!1;if(e==="display"||e==="visibility")return!0;const r=t[t.length-1],i=a_(o,e),a=a_(r,e);return!i||!a?!1:M8(t)||(n==="spring"||TL(n))&&s}function wT(t){t.duration=0,t.type}const O8=new Set(["opacity","clipPath","filter","transform"]),P8=tN(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function L8(t){var d;const{motionValue:e,name:n,repeatDelay:s,repeatType:o,damping:r,type:i}=t;if(!(((d=e==null?void 0:e.owner)==null?void 0:d.current)instanceof HTMLElement))return!1;const{onUpdate:l,transformTemplate:u}=e.owner.getProps();return P8()&&n&&O8.has(n)&&(n!=="transform"||!u)&&!l&&!s&&o!=="mirror"&&r!==0&&i!=="inertia"}const V8=40;class z8 extends fN{constructor({autoplay:e=!0,delay:n=0,type:s="keyframes",repeat:o=0,repeatDelay:r=0,repeatType:i="loop",keyframes:a,name:l,motionValue:u,element:d,...h}){var b;super(),this.stop=()=>{var w,C;this._animation&&(this._animation.stop(),(w=this.stopTimeline)==null||w.call(this)),(C=this.keyframeResolver)==null||C.cancel()},this.createdAt=lo.now();const p={autoplay:e,delay:n,type:s,repeat:o,repeatDelay:r,repeatType:i,name:l,motionValue:u,element:d,...h},x=(d==null?void 0:d.KeyframeResolver)||pN;this.keyframeResolver=new x(a,(w,C,T)=>this.onKeyframesResolved(w,C,p,!T),l,u,d),(b=this.keyframeResolver)==null||b.scheduleResolve()}onKeyframesResolved(e,n,s,o){this.keyframeResolver=void 0;const{name:r,type:i,velocity:a,delay:l,isHandoff:u,onUpdate:d}=s;this.resolvedAt=lo.now(),F8(e,r,i,a)||((_i.instantAnimations||!l)&&(d==null||d(dN(e,s,n))),e[0]=e[e.length-1],wT(s),s.repeat=0);const p={startTime:o?this.resolvedAt?this.resolvedAt-this.createdAt>V8?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:n,...s,keyframes:e},x=!u&&L8(p)?new _8({...p,element:p.motionValue.owner.current}):new hN(p);x.finished.then(()=>this.notifyFinished()).catch(er),this.pendingTimeline&&(this.stopTimeline=x.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=x}get finished(){return this._animation?this.animation.finished:this._finished}then(e,n){return this.finished.finally(e).then(()=>{})}get animation(){var e;return this._animation||((e=this.keyframeResolver)==null||e.resume(),C8()),this._animation}get duration(){return this.animation.duration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var e;this._animation&&this.animation.cancel(),(e=this.keyframeResolver)==null||e.cancel()}}const B8=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function U8(t){const e=B8.exec(t);if(!e)return[,];const[,n,s,o]=e;return[`--${n??s}`,o]}function NL(t,e,n=1){const[s,o]=U8(t);if(!s)return;const r=window.getComputedStyle(e).getPropertyValue(s);if(r){const i=r.trim();return KP(i)?parseFloat(i):i}return iN(o)?NL(o,e,n+1):o}function mN(t,e){return(t==null?void 0:t[e])??(t==null?void 0:t.default)??t}const EL=new Set(["width","height","top","left","right","bottom",...od]),G8={test:t=>t==="auto",parse:t=>t},IL=t=>e=>e.test(t),kL=[sd,Je,Yr,Sa,M5,_5,G8],l_=t=>kL.find(IL(t));function H8(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||YP(t):!0}const W8=new Set(["brightness","contrast","saturate","opacity"]);function q8(t){const[e,n]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[s]=n.match(aN)||[];if(!s)return t;const o=n.replace(s,"");let r=W8.has(e)?1:0;return s!==n&&(r*=100),e+"("+r+o+")"}const K8=/\b([a-z-]*)\(.*?\)/gu,CT={...Va,getAnimatableNone:t=>{const e=t.match(K8);return e?e.map(q8).join(" "):t}},u_={...sd,transform:Math.round},X8={rotate:Sa,rotateX:Sa,rotateY:Sa,rotateZ:Sa,scale:Uy,scaleX:Uy,scaleY:Uy,scaleZ:Uy,skew:Sa,skewX:Sa,skewY:Sa,distance:Je,translateX:Je,translateY:Je,translateZ:Je,x:Je,y:Je,z:Je,perspective:Je,transformPerspective:Je,opacity:ip,originX:JD,originY:JD,originZ:Je},gN={borderWidth:Je,borderTopWidth:Je,borderRightWidth:Je,borderBottomWidth:Je,borderLeftWidth:Je,borderRadius:Je,radius:Je,borderTopLeftRadius:Je,borderTopRightRadius:Je,borderBottomRightRadius:Je,borderBottomLeftRadius:Je,width:Je,maxWidth:Je,height:Je,maxHeight:Je,top:Je,right:Je,bottom:Je,left:Je,padding:Je,paddingTop:Je,paddingRight:Je,paddingBottom:Je,paddingLeft:Je,margin:Je,marginTop:Je,marginRight:Je,marginBottom:Je,marginLeft:Je,backgroundPositionX:Je,backgroundPositionY:Je,...X8,zIndex:u_,fillOpacity:ip,strokeOpacity:ip,numOctaves:u_},Y8={...gN,color:_n,backgroundColor:_n,outlineColor:_n,fill:_n,stroke:_n,borderColor:_n,borderTopColor:_n,borderRightColor:_n,borderBottomColor:_n,borderLeftColor:_n,filter:CT,WebkitFilter:CT},AL=t=>Y8[t];function RL(t,e){let n=AL(t);return n!==CT&&(n=Va),n.getAnimatableNone?n.getAnimatableNone(e):void 0}const J8=new Set(["auto","none","0"]);function j8(t,e,n){let s=0,o;for(;s<t.length&&!o;){const r=t[s];typeof r=="string"&&!J8.has(r)&&ap(r).values.length&&(o=t[s]),s++}if(o&&n)for(const r of e)t[r]=RL(n,o)}class Z8 extends pN{constructor(e,n,s,o,r){super(e,n,s,o,r,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:n,name:s}=this;if(!n||!n.current)return;super.readKeyframes();for(let l=0;l<e.length;l++){let u=e[l];if(typeof u=="string"&&(u=u.trim(),iN(u))){const d=NL(u,n.current);d!==void 0&&(e[l]=d),l===e.length-1&&(this.finalKeyframe=u)}}if(this.resolveNoneKeyframes(),!EL.has(s)||e.length!==2)return;const[o,r]=e,i=l_(o),a=l_(r);if(i!==a)if(o_(i)&&o_(a))for(let l=0;l<e.length;l++){const u=e[l];typeof u=="string"&&(e[l]=parseFloat(u))}else Gl[s]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:n}=this,s=[];for(let o=0;o<e.length;o++)(e[o]===null||H8(e[o]))&&s.push(o);s.length&&j8(e,s,n)}measureInitialState(){const{element:e,unresolvedKeyframes:n,name:s}=this;if(!e||!e.current)return;s==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Gl[s](e.measureViewportBox(),window.getComputedStyle(e.current)),n[0]=this.measuredOrigin;const o=n[n.length-1];o!==void 0&&e.getValue(s,o).jump(o,!1)}measureEndState(){var a;const{element:e,name:n,unresolvedKeyframes:s}=this;if(!e||!e.current)return;const o=e.getValue(n);o&&o.jump(this.measuredOrigin,!1);const r=s.length-1,i=s[r];s[r]=Gl[n](e.measureViewportBox(),window.getComputedStyle(e.current)),i!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=i),(a=this.removedTransforms)!=null&&a.length&&this.removedTransforms.forEach(([l,u])=>{e.getValue(l).set(u)}),this.resolveNoneKeyframes()}}function Q8(t,e,n){if(t instanceof EventTarget)return[t];if(typeof t=="string"){let s=document;const o=(n==null?void 0:n[t])??s.querySelectorAll(t);return o?Array.from(o):[]}return Array.from(t)}const $L=(t,e)=>e&&typeof t=="number"?e.transform(t):t;function DL(t){return XP(t)&&"offsetHeight"in t}const c_=30,eK=t=>!isNaN(parseFloat(t));class tK{constructor(e,n={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=s=>{var r;const o=lo.now();if(this.updatedAt!==o&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(s),this.current!==this.prev&&((r=this.events.change)==null||r.notify(this.current),this.dependents))for(const i of this.dependents)i.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=n.owner}setCurrent(e){this.current=e,this.updatedAt=lo.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=eK(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,n){this.events[e]||(this.events[e]=new nN);const s=this.events[e].add(n);return e==="change"?()=>{s(),nn.read(()=>{this.events.change.getSize()||this.stop()})}:s}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,n){this.passiveEffect=e,this.stopPassiveEffect=n}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,n,s){this.set(n),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-s}jump(e,n=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var e;(e=this.events.change)==null||e.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=lo.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>c_)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,c_);return JP(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(e){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=e(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var e,n;(e=this.dependents)==null||e.clear(),(n=this.events.destroy)==null||n.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Vc(t,e){return new tK(t,e)}const{schedule:yN}=aL(queueMicrotask,!1),hr={x:!1,y:!1};function _L(){return hr.x||hr.y}function nK(t){return t==="x"||t==="y"?hr[t]?null:(hr[t]=!0,()=>{hr[t]=!1}):hr.x||hr.y?null:(hr.x=hr.y=!0,()=>{hr.x=hr.y=!1})}function ML(t,e){const n=Q8(t),s=new AbortController,o={passive:!0,...e,signal:s.signal};return[n,o,()=>s.abort()]}function d_(t){return!(t.pointerType==="touch"||_L())}function sK(t,e,n={}){const[s,o,r]=ML(t,n),i=a=>{if(!d_(a))return;const{target:l}=a,u=e(l,a);if(typeof u!="function"||!l)return;const d=h=>{d_(h)&&(u(h),l.removeEventListener("pointerleave",d))};l.addEventListener("pointerleave",d,o)};return s.forEach(a=>{a.addEventListener("pointerenter",i,o)}),r}const FL=(t,e)=>e?t===e?!0:FL(t,e.parentElement):!1,xN=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,oK=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function rK(t){return oK.has(t.tagName)||t.tabIndex!==-1}const f0=new WeakSet;function f_(t){return e=>{e.key==="Enter"&&t(e)}}function NC(t,e){t.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const iK=(t,e)=>{const n=t.currentTarget;if(!n)return;const s=f_(()=>{if(f0.has(n))return;NC(n,"down");const o=f_(()=>{NC(n,"up")}),r=()=>NC(n,"cancel");n.addEventListener("keyup",o,e),n.addEventListener("blur",r,e)});n.addEventListener("keydown",s,e),n.addEventListener("blur",()=>n.removeEventListener("keydown",s),e)};function h_(t){return xN(t)&&!_L()}function aK(t,e,n={}){const[s,o,r]=ML(t,n),i=a=>{const l=a.currentTarget;if(!h_(a))return;f0.add(l);const u=e(l,a),d=(x,b)=>{window.removeEventListener("pointerup",h),window.removeEventListener("pointercancel",p),f0.has(l)&&f0.delete(l),h_(x)&&typeof u=="function"&&u(x,{success:b})},h=x=>{d(x,l===window||l===document||n.useGlobalTarget||FL(l,x.target))},p=x=>{d(x,!1)};window.addEventListener("pointerup",h,o),window.addEventListener("pointercancel",p,o)};return s.forEach(a=>{(n.useGlobalTarget?window:a).addEventListener("pointerdown",i,o),DL(a)&&(a.addEventListener("focus",u=>iK(u,o)),!rK(a)&&!a.hasAttribute("tabindex")&&(a.tabIndex=0))}),r}function OL(t){return XP(t)&&"ownerSVGElement"in t}function lK(t){return OL(t)&&t.tagName==="svg"}const Ds=t=>!!(t&&t.getVelocity),uK=[...kL,_n,Va],cK=t=>uK.find(IL(t)),vN=ce.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});class dK extends ce.Component{getSnapshotBeforeUpdate(e){const n=this.props.childRef.current;if(n&&e.isPresent&&!this.props.isPresent){const s=n.offsetParent,o=DL(s)&&s.offsetWidth||0,r=this.props.sizeRef.current;r.height=n.offsetHeight||0,r.width=n.offsetWidth||0,r.top=n.offsetTop,r.left=n.offsetLeft,r.right=o-r.width-r.left}return null}componentDidUpdate(){}render(){return this.props.children}}function fK({children:t,isPresent:e,anchorX:n,root:s}){const o=ce.useId(),r=ce.useRef(null),i=ce.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:a}=ce.useContext(vN);return ce.useInsertionEffect(()=>{const{width:l,height:u,top:d,left:h,right:p}=i.current;if(e||!r.current||!l||!u)return;const x=n==="left"?`left: ${h}`:`right: ${p}`;r.current.dataset.motionPopId=o;const b=document.createElement("style");a&&(b.nonce=a);const w=s??document.head;return w.appendChild(b),b.sheet&&b.sheet.insertRule(`
          [data-motion-pop-id="${o}"] {
            position: absolute !important;
            width: ${l}px !important;
            height: ${u}px !important;
            ${x}px !important;
            top: ${d}px !important;
          }
        `),()=>{w.contains(b)&&w.removeChild(b)}},[e]),U.jsx(dK,{isPresent:e,childRef:r,sizeRef:i,children:ce.cloneElement(t,{ref:r})})}const hK=({children:t,initial:e,isPresent:n,onExitComplete:s,custom:o,presenceAffectsLayout:r,mode:i,anchorX:a,root:l})=>{const u=JS(pK),d=ce.useId();let h=!0,p=ce.useMemo(()=>(h=!1,{id:d,initial:e,isPresent:n,custom:o,onExitComplete:x=>{u.set(x,!0);for(const b of u.values())if(!b)return;s&&s()},register:x=>(u.set(x,!1),()=>u.delete(x))}),[n,u,s]);return r&&h&&(p={...p}),ce.useMemo(()=>{u.forEach((x,b)=>u.set(b,!1))},[n]),ce.useEffect(()=>{!n&&!u.size&&s&&s()},[n]),i==="popLayout"&&(t=U.jsx(fK,{isPresent:n,anchorX:a,root:l,children:t})),U.jsx(Tx.Provider,{value:p,children:t})};function pK(){return new Map}function PL(t=!0){const e=ce.useContext(Tx);if(e===null)return[!0,null];const{isPresent:n,onExitComplete:s,register:o}=e,r=ce.useId();ce.useEffect(()=>{if(t)return o(r)},[t]);const i=ce.useCallback(()=>t&&s&&s(r),[r,s,t]);return!n&&s?[!1,i]:[!0]}const Gy=t=>t.key||"";function p_(t){const e=[];return ce.Children.forEach(t,n=>{ce.isValidElement(n)&&e.push(n)}),e}const Vr=({children:t,custom:e,initial:n=!0,onExitComplete:s,presenceAffectsLayout:o=!0,mode:r="sync",propagate:i=!1,anchorX:a="left",root:l})=>{const[u,d]=PL(i),h=ce.useMemo(()=>p_(t),[t]),p=i&&!u?[]:h.map(Gy),x=ce.useRef(!0),b=ce.useRef(h),w=JS(()=>new Map),[C,T]=ce.useState(h),[N,I]=ce.useState(h);qP(()=>{x.current=!1,b.current=h;for(let $=0;$<N.length;$++){const M=Gy(N[$]);p.includes(M)?w.delete(M):w.get(M)!==!0&&w.set(M,!1)}},[N,p.length,p.join("-")]);const k=[];if(h!==C){let $=[...h];for(let M=0;M<N.length;M++){const O=N[M],F=Gy(O);p.includes(F)||($.splice(M,0,O),k.push(O))}return r==="wait"&&k.length&&($=k),I(p_($)),T(h),null}const{forceRender:A}=ce.useContext(YS);return U.jsx(U.Fragment,{children:N.map($=>{const M=Gy($),O=i&&!u?!1:h===N||p.includes(M),F=()=>{if(w.has(M))w.set(M,!0);else return;let P=!0;w.forEach(D=>{D||(P=!1)}),P&&(A==null||A(),I(b.current),i&&(d==null||d()),s&&s())};return U.jsx(hK,{isPresent:O,initial:!x.current||n?void 0:!1,custom:e,presenceAffectsLayout:o,mode:r,root:l,onExitComplete:O?void 0:F,anchorX:a,children:$},M)})})},LL=ce.createContext({strict:!1}),m_={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},zc={};for(const t in m_)zc[t]={isEnabled:e=>m_[t].some(n=>!!e[n])};function mK(t){for(const e in t)zc[e]={...zc[e],...t[e]}}const gK=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function L0(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||gK.has(t)}let VL=t=>!L0(t);function yK(t){typeof t=="function"&&(VL=e=>e.startsWith("on")?!L0(e):t(e))}try{yK(require("@emotion/is-prop-valid").default)}catch{}function xK(t,e,n){const s={};for(const o in t)o==="values"&&typeof t.values=="object"||(VL(o)||n===!0&&L0(o)||!e&&!L0(o)||t.draggable&&o.startsWith("onDrag"))&&(s[o]=t[o]);return s}const Sx=ce.createContext({});function Nx(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}function lp(t){return typeof t=="string"||Array.isArray(t)}const bN=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],wN=["initial",...bN];function Ex(t){return Nx(t.animate)||wN.some(e=>lp(t[e]))}function zL(t){return!!(Ex(t)||t.variants)}function vK(t,e){if(Ex(t)){const{initial:n,animate:s}=t;return{initial:n===!1||lp(n)?n:void 0,animate:lp(s)?s:void 0}}return t.inherit!==!1?e:{}}function bK(t){const{initial:e,animate:n}=vK(t,ce.useContext(Sx));return ce.useMemo(()=>({initial:e,animate:n}),[g_(e),g_(n)])}function g_(t){return Array.isArray(t)?t.join(" "):t}const up={};function wK(t){for(const e in t)up[e]=t[e],rN(e)&&(up[e].isCSSVariable=!0)}function BL(t,{layout:e,layoutId:n}){return rd.has(t)||t.startsWith("origin")||(e||n!==void 0)&&(!!up[t]||t==="opacity")}const CK={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},TK=od.length;function SK(t,e,n){let s="",o=!0;for(let r=0;r<TK;r++){const i=od[r],a=t[i];if(a===void 0)continue;let l=!0;if(typeof a=="number"?l=a===(i.startsWith("scale")?1:0):l=parseFloat(a)===0,!l||n){const u=$L(a,gN[i]);if(!l){o=!1;const d=CK[i]||i;s+=`${d}(${u}) `}n&&(e[i]=u)}}return s=s.trim(),n?s=n(e,o?"":s):o&&(s="none"),s}function CN(t,e,n){const{style:s,vars:o,transformOrigin:r}=t;let i=!1,a=!1;for(const l in e){const u=e[l];if(rd.has(l)){i=!0;continue}else if(rN(l)){o[l]=u;continue}else{const d=$L(u,gN[l]);l.startsWith("origin")?(a=!0,r[l]=d):s[l]=d}}if(e.transform||(i||n?s.transform=SK(e,t.transform,n):s.transform&&(s.transform="none")),a){const{originX:l="50%",originY:u="50%",originZ:d=0}=r;s.transformOrigin=`${l} ${u} ${d}`}}const TN=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function UL(t,e,n){for(const s in e)!Ds(e[s])&&!BL(s,n)&&(t[s]=e[s])}function NK({transformTemplate:t},e){return ce.useMemo(()=>{const n=TN();return CN(n,e,t),Object.assign({},n.vars,n.style)},[e])}function EK(t,e){const n=t.style||{},s={};return UL(s,n,t),Object.assign(s,NK(t,e)),s}function IK(t,e){const n={},s=EK(t,e);return t.drag&&t.dragListener!==!1&&(n.draggable=!1,s.userSelect=s.WebkitUserSelect=s.WebkitTouchCallout="none",s.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(n.tabIndex=0),n.style=s,n}const kK={offset:"stroke-dashoffset",array:"stroke-dasharray"},AK={offset:"strokeDashoffset",array:"strokeDasharray"};function RK(t,e,n=1,s=0,o=!0){t.pathLength=1;const r=o?kK:AK;t[r.offset]=Je.transform(-s);const i=Je.transform(e),a=Je.transform(n);t[r.array]=`${i} ${a}`}function GL(t,{attrX:e,attrY:n,attrScale:s,pathLength:o,pathSpacing:r=1,pathOffset:i=0,...a},l,u,d){if(CN(t,a,u),l){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:h,style:p}=t;h.transform&&(p.transform=h.transform,delete h.transform),(p.transform||h.transformOrigin)&&(p.transformOrigin=h.transformOrigin??"50% 50%",delete h.transformOrigin),p.transform&&(p.transformBox=(d==null?void 0:d.transformBox)??"fill-box",delete h.transformBox),e!==void 0&&(h.x=e),n!==void 0&&(h.y=n),s!==void 0&&(h.scale=s),o!==void 0&&RK(h,o,r,i,!1)}const HL=()=>({...TN(),attrs:{}}),WL=t=>typeof t=="string"&&t.toLowerCase()==="svg";function $K(t,e,n,s){const o=ce.useMemo(()=>{const r=HL();return GL(r,e,WL(s),t.transformTemplate,t.style),{...r.attrs,style:{...r.style}}},[e]);if(t.style){const r={};UL(r,t.style,t),o.style={...r,...o.style}}return o}const DK=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function SN(t){return typeof t!="string"||t.includes("-")?!1:!!(DK.indexOf(t)>-1||/[A-Z]/u.test(t))}function _K(t,e,n,{latestValues:s},o,r=!1){const a=(SN(t)?$K:IK)(e,s,o,t),l=xK(e,typeof t=="string",r),u=t!==ce.Fragment?{...l,...a,ref:n}:{},{children:d}=e,h=ce.useMemo(()=>Ds(d)?d.get():d,[d]);return ce.createElement(t,{...u,children:h})}function y_(t){const e=[{},{}];return t==null||t.values.forEach((n,s)=>{e[0][s]=n.get(),e[1][s]=n.getVelocity()}),e}function NN(t,e,n,s){if(typeof e=="function"){const[o,r]=y_(s);e=e(n!==void 0?n:t.custom,o,r)}if(typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"){const[o,r]=y_(s);e=e(n!==void 0?n:t.custom,o,r)}return e}function h0(t){return Ds(t)?t.get():t}function MK({scrapeMotionValuesFromProps:t,createRenderState:e},n,s,o){return{latestValues:FK(n,s,o,t),renderState:e()}}function FK(t,e,n,s){const o={},r=s(t,{});for(const p in r)o[p]=h0(r[p]);let{initial:i,animate:a}=t;const l=Ex(t),u=zL(t);e&&u&&!l&&t.inherit!==!1&&(i===void 0&&(i=e.initial),a===void 0&&(a=e.animate));let d=n?n.initial===!1:!1;d=d||i===!1;const h=d?a:i;if(h&&typeof h!="boolean"&&!Nx(h)){const p=Array.isArray(h)?h:[h];for(let x=0;x<p.length;x++){const b=NN(t,p[x]);if(b){const{transitionEnd:w,transition:C,...T}=b;for(const N in T){let I=T[N];if(Array.isArray(I)){const k=d?I.length-1:0;I=I[k]}I!==null&&(o[N]=I)}for(const N in w)o[N]=w[N]}}}return o}const qL=t=>(e,n)=>{const s=ce.useContext(Sx),o=ce.useContext(Tx),r=()=>MK(t,e,s,o);return n?r():JS(r)};function EN(t,e,n){var r;const{style:s}=t,o={};for(const i in s)(Ds(s[i])||e.style&&Ds(e.style[i])||BL(i,t)||((r=n==null?void 0:n.getValue(i))==null?void 0:r.liveStyle)!==void 0)&&(o[i]=s[i]);return o}const OK=qL({scrapeMotionValuesFromProps:EN,createRenderState:TN});function KL(t,e,n){const s=EN(t,e,n);for(const o in t)if(Ds(t[o])||Ds(e[o])){const r=od.indexOf(o)!==-1?"attr"+o.charAt(0).toUpperCase()+o.substring(1):o;s[r]=t[o]}return s}const PK=qL({scrapeMotionValuesFromProps:KL,createRenderState:HL}),LK=Symbol.for("motionComponentSymbol");function Ec(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function VK(t,e,n){return ce.useCallback(s=>{s&&t.onMount&&t.onMount(s),e&&(s?e.mount(s):e.unmount()),n&&(typeof n=="function"?n(s):Ec(n)&&(n.current=s))},[e])}const IN=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),zK="framerAppearId",XL="data-"+IN(zK),YL=ce.createContext({});function BK(t,e,n,s,o){var w,C;const{visualElement:r}=ce.useContext(Sx),i=ce.useContext(LL),a=ce.useContext(Tx),l=ce.useContext(vN).reducedMotion,u=ce.useRef(null);s=s||i.renderer,!u.current&&s&&(u.current=s(t,{visualState:e,parent:r,props:n,presenceContext:a,blockInitialAnimation:a?a.initial===!1:!1,reducedMotionConfig:l}));const d=u.current,h=ce.useContext(YL);d&&!d.projection&&o&&(d.type==="html"||d.type==="svg")&&UK(u.current,n,o,h);const p=ce.useRef(!1);ce.useInsertionEffect(()=>{d&&p.current&&d.update(n,a)});const x=n[XL],b=ce.useRef(!!x&&!((w=window.MotionHandoffIsComplete)!=null&&w.call(window,x))&&((C=window.MotionHasOptimisedAnimation)==null?void 0:C.call(window,x)));return qP(()=>{d&&(p.current=!0,window.MotionIsMounted=!0,d.updateFeatures(),d.scheduleRenderMicrotask(),b.current&&d.animationState&&d.animationState.animateChanges())}),ce.useEffect(()=>{d&&(!b.current&&d.animationState&&d.animationState.animateChanges(),b.current&&(queueMicrotask(()=>{var T;(T=window.MotionHandoffMarkAsComplete)==null||T.call(window,x)}),b.current=!1),d.enteringChildren=void 0)}),d}function UK(t,e,n,s){const{layoutId:o,layout:r,drag:i,dragConstraints:a,layoutScroll:l,layoutRoot:u,layoutCrossfade:d}=e;t.projection=new n(t.latestValues,e["data-framer-portal-id"]?void 0:JL(t.parent)),t.projection.setOptions({layoutId:o,layout:r,alwaysMeasureLayout:!!i||a&&Ec(a),visualElement:t,animationType:typeof r=="string"?r:"both",initialPromotionConfig:s,crossfade:d,layoutScroll:l,layoutRoot:u})}function JL(t){if(t)return t.options.allowProjection!==!1?t.projection:JL(t.parent)}function EC(t,{forwardMotionProps:e=!1}={},n,s){n&&mK(n);const o=SN(t)?PK:OK;function r(a,l){let u;const d={...ce.useContext(vN),...a,layoutId:GK(a)},{isStatic:h}=d,p=bK(a),x=o(a,h);if(!h&&jS){HK();const b=WK(d);u=b.MeasureLayout,p.visualElement=BK(t,x,d,s,b.ProjectionNode)}return U.jsxs(Sx.Provider,{value:p,children:[u&&p.visualElement?U.jsx(u,{visualElement:p.visualElement,...d}):null,_K(t,a,VK(x,p.visualElement,l),x,h,e)]})}r.displayName=`motion.${typeof t=="string"?t:`create(${t.displayName??t.name??""})`}`;const i=ce.forwardRef(r);return i[LK]=t,i}function GK({layoutId:t}){const e=ce.useContext(YS).id;return e&&t!==void 0?e+"-"+t:t}function HK(t,e){ce.useContext(LL).strict}function WK(t){const{drag:e,layout:n}=zc;if(!e&&!n)return{};const s={...e,...n};return{MeasureLayout:e!=null&&e.isEnabled(t)||n!=null&&n.isEnabled(t)?s.MeasureLayout:void 0,ProjectionNode:s.ProjectionNode}}function qK(t,e){if(typeof Proxy>"u")return EC;const n=new Map,s=(r,i)=>EC(r,i,t,e),o=(r,i)=>s(r,i);return new Proxy(o,{get:(r,i)=>i==="create"?s:(n.has(i)||n.set(i,EC(i,void 0,t,e)),n.get(i))})}function jL({top:t,left:e,right:n,bottom:s}){return{x:{min:e,max:n},y:{min:t,max:s}}}function KK({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function XK(t,e){if(!e)return t;const n=e({x:t.left,y:t.top}),s=e({x:t.right,y:t.bottom});return{top:n.y,left:n.x,bottom:s.y,right:s.x}}function IC(t){return t===void 0||t===1}function TT({scale:t,scaleX:e,scaleY:n}){return!IC(t)||!IC(e)||!IC(n)}function $l(t){return TT(t)||ZL(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function ZL(t){return x_(t.x)||x_(t.y)}function x_(t){return t&&t!=="0%"}function V0(t,e,n){const s=t-n,o=e*s;return n+o}function v_(t,e,n,s,o){return o!==void 0&&(t=V0(t,o,s)),V0(t,n,s)+e}function ST(t,e=0,n=1,s,o){t.min=v_(t.min,e,n,s,o),t.max=v_(t.max,e,n,s,o)}function QL(t,{x:e,y:n}){ST(t.x,e.translate,e.scale,e.originPoint),ST(t.y,n.translate,n.scale,n.originPoint)}const b_=.999999999999,w_=1.0000000000001;function YK(t,e,n,s=!1){const o=n.length;if(!o)return;e.x=e.y=1;let r,i;for(let a=0;a<o;a++){r=n[a],i=r.projectionDelta;const{visualElement:l}=r.options;l&&l.props.style&&l.props.style.display==="contents"||(s&&r.options.layoutScroll&&r.scroll&&r!==r.root&&kc(t,{x:-r.scroll.offset.x,y:-r.scroll.offset.y}),i&&(e.x*=i.x.scale,e.y*=i.y.scale,QL(t,i)),s&&$l(r.latestValues)&&kc(t,r.latestValues))}e.x<w_&&e.x>b_&&(e.x=1),e.y<w_&&e.y>b_&&(e.y=1)}function Ic(t,e){t.min=t.min+e,t.max=t.max+e}function C_(t,e,n,s,o=.5){const r=cn(t.min,t.max,o);ST(t,e,n,r,s)}function kc(t,e){C_(t.x,e.x,e.scaleX,e.scale,e.originX),C_(t.y,e.y,e.scaleY,e.scale,e.originY)}function e3(t,e){return jL(XK(t.getBoundingClientRect(),e))}function JK(t,e,n){const s=e3(t,n),{scroll:o}=e;return o&&(Ic(s.x,o.offset.x),Ic(s.y,o.offset.y)),s}const T_=()=>({translate:0,scale:1,origin:0,originPoint:0}),Ac=()=>({x:T_(),y:T_()}),S_=()=>({min:0,max:0}),Cn=()=>({x:S_(),y:S_()}),NT={current:null},t3={current:!1};function jK(){if(t3.current=!0,!!jS)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>NT.current=t.matches;t.addEventListener("change",e),e()}else NT.current=!1}const ZK=new WeakMap;function QK(t,e,n){for(const s in e){const o=e[s],r=n[s];if(Ds(o))t.addValue(s,o);else if(Ds(r))t.addValue(s,Vc(o,{owner:t}));else if(r!==o)if(t.hasValue(s)){const i=t.getValue(s);i.liveStyle===!0?i.jump(o):i.hasAnimated||i.set(o)}else{const i=t.getStaticValue(s);t.addValue(s,Vc(i!==void 0?i:o,{owner:t}))}}for(const s in n)e[s]===void 0&&t.removeValue(s);return e}const N_=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class eX{scrapeMotionValuesFromProps(e,n,s){return{}}constructor({parent:e,props:n,presenceContext:s,reducedMotionConfig:o,blockInitialAnimation:r,visualState:i},a={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=pN,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const p=lo.now();this.renderScheduledAt<p&&(this.renderScheduledAt=p,nn.render(this.render,!1,!0))};const{latestValues:l,renderState:u}=i;this.latestValues=l,this.baseTarget={...l},this.initialValues=n.initial?{...l}:{},this.renderState=u,this.parent=e,this.props=n,this.presenceContext=s,this.depth=e?e.depth+1:0,this.reducedMotionConfig=o,this.options=a,this.blockInitialAnimation=!!r,this.isControllingVariants=Ex(n),this.isVariantNode=zL(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:d,...h}=this.scrapeMotionValuesFromProps(n,{},this);for(const p in h){const x=h[p];l[p]!==void 0&&Ds(x)&&x.set(l[p])}}mount(e){var n;this.current=e,ZK.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((s,o)=>this.bindToMotionValue(o,s)),t3.current||jK(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:NT.current,(n=this.parent)==null||n.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var e;this.projection&&this.projection.unmount(),La(this.notifyUpdate),La(this.render),this.valueSubscriptions.forEach(n=>n()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(e=this.parent)==null||e.removeChild(this);for(const n in this.events)this.events[n].clear();for(const n in this.features){const s=this.features[n];s&&(s.unmount(),s.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,n){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const s=rd.has(e);s&&this.onBindTransform&&this.onBindTransform();const o=n.on("change",i=>{this.latestValues[e]=i,this.props.onUpdate&&nn.preRender(this.notifyUpdate),s&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let r;window.MotionCheckAppearSync&&(r=window.MotionCheckAppearSync(this,e,n)),this.valueSubscriptions.set(e,()=>{o(),r&&r(),n.owner&&n.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in zc){const n=zc[e];if(!n)continue;const{isEnabled:s,Feature:o}=n;if(!this.features[e]&&o&&s(this.props)&&(this.features[e]=new o(this)),this.features[e]){const r=this.features[e];r.isMounted?r.update():(r.mount(),r.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Cn()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,n){this.latestValues[e]=n}update(e,n){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let s=0;s<N_.length;s++){const o=N_[s];this.propEventSubscriptions[o]&&(this.propEventSubscriptions[o](),delete this.propEventSubscriptions[o]);const r="on"+o,i=e[r];i&&(this.propEventSubscriptions[o]=this.on(o,i))}this.prevMotionValues=QK(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(e),()=>n.variantChildren.delete(e)}addValue(e,n){const s=this.values.get(e);n!==s&&(s&&this.removeValue(e),this.bindToMotionValue(e,n),this.values.set(e,n),this.latestValues[e]=n.get())}removeValue(e){this.values.delete(e);const n=this.valueSubscriptions.get(e);n&&(n(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,n){if(this.props.values&&this.props.values[e])return this.props.values[e];let s=this.values.get(e);return s===void 0&&n!==void 0&&(s=Vc(n===null?void 0:n,{owner:this}),this.addValue(e,s)),s}readValue(e,n){let s=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return s!=null&&(typeof s=="string"&&(KP(s)||YP(s))?s=parseFloat(s):!cK(s)&&Va.test(n)&&(s=RL(e,n)),this.setBaseTarget(e,Ds(s)?s.get():s)),Ds(s)?s.get():s}setBaseTarget(e,n){this.baseTarget[e]=n}getBaseTarget(e){var r;const{initial:n}=this.props;let s;if(typeof n=="string"||typeof n=="object"){const i=NN(this.props,n,(r=this.presenceContext)==null?void 0:r.custom);i&&(s=i[e])}if(n&&s!==void 0)return s;const o=this.getBaseTargetFromProps(this.props,e);return o!==void 0&&!Ds(o)?o:this.initialValues[e]!==void 0&&s===void 0?void 0:this.baseTarget[e]}on(e,n){return this.events[e]||(this.events[e]=new nN),this.events[e].add(n)}notify(e,...n){this.events[e]&&this.events[e].notify(...n)}scheduleRenderMicrotask(){yN.render(this.render)}}class n3 extends eX{constructor(){super(...arguments),this.KeyframeResolver=Z8}sortInstanceNodePosition(e,n){return e.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(e,n){return e.style?e.style[n]:void 0}removeValueFromRenderState(e,{vars:n,style:s}){delete n[e],delete s[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Ds(e)&&(this.childSubscription=e.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}function s3(t,{style:e,vars:n},s,o){const r=t.style;let i;for(i in e)r[i]=e[i];o==null||o.applyProjectionStyles(r,s);for(i in n)r.setProperty(i,n[i])}function tX(t){return window.getComputedStyle(t)}class nX extends n3{constructor(){super(...arguments),this.type="html",this.renderInstance=s3}readValueFromInstance(e,n){var s;if(rd.has(n))return(s=this.projection)!=null&&s.isProjecting?gT(n):y8(e,n);{const o=tX(e),r=(rN(n)?o.getPropertyValue(n):o[n])||0;return typeof r=="string"?r.trim():r}}measureInstanceViewportBox(e,{transformPagePoint:n}){return e3(e,n)}build(e,n,s){CN(e,n,s.transformTemplate)}scrapeMotionValuesFromProps(e,n,s){return EN(e,n,s)}}const o3=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function sX(t,e,n,s){s3(t,e,void 0,s);for(const o in e.attrs)t.setAttribute(o3.has(o)?o:IN(o),e.attrs[o])}class oX extends n3{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Cn}getBaseTargetFromProps(e,n){return e[n]}readValueFromInstance(e,n){if(rd.has(n)){const s=AL(n);return s&&s.default||0}return n=o3.has(n)?n:IN(n),e.getAttribute(n)}scrapeMotionValuesFromProps(e,n,s){return KL(e,n,s)}build(e,n,s){GL(e,n,this.isSVGTag,s.transformTemplate,s.style)}renderInstance(e,n,s,o){sX(e,n,s,o)}mount(e){this.isSVGTag=WL(e.tagName),super.mount(e)}}const rX=(t,e)=>SN(t)?new oX(e):new nX(e,{allowProjection:t!==ce.Fragment});function $c(t,e,n){const s=t.getProps();return NN(s,e,n!==void 0?n:s.custom,t)}const ET=t=>Array.isArray(t);function iX(t,e,n){t.hasValue(e)?t.getValue(e).set(n):t.addValue(e,Vc(n))}function aX(t){return ET(t)?t[t.length-1]||0:t}function lX(t,e){const n=$c(t,e);let{transitionEnd:s={},transition:o={},...r}=n||{};r={...r,...s};for(const i in r){const a=aX(r[i]);iX(t,i,a)}}function uX(t){return!!(Ds(t)&&t.add)}function IT(t,e){const n=t.getValue("willChange");if(uX(n))return n.add(e);if(!n&&_i.WillChange){const s=new _i.WillChange("auto");t.addValue("willChange",s),s.add(e)}}function r3(t){return t.props[XL]}const cX=t=>t!==null;function dX(t,{repeat:e,repeatType:n="loop"},s){const o=t.filter(cX),r=e&&n!=="loop"&&e%2===1?0:o.length-1;return o[r]}const fX={type:"spring",stiffness:500,damping:25,restSpeed:10},hX=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),pX={type:"keyframes",duration:.8},mX={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},gX=(t,{keyframes:e})=>e.length>2?pX:rd.has(t)?t.startsWith("scale")?hX(e[1]):fX:mX;function yX({when:t,delay:e,delayChildren:n,staggerChildren:s,staggerDirection:o,repeat:r,repeatType:i,repeatDelay:a,from:l,elapsed:u,...d}){return!!Object.keys(d).length}const kN=(t,e,n,s={},o,r)=>i=>{const a=mN(s,t)||{},l=a.delay||s.delay||0;let{elapsed:u=0}=s;u=u-Kr(l);const d={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:e.getVelocity(),...a,delay:-u,onUpdate:p=>{e.set(p),a.onUpdate&&a.onUpdate(p)},onComplete:()=>{i(),a.onComplete&&a.onComplete()},name:t,motionValue:e,element:r?void 0:o};yX(a)||Object.assign(d,gX(t,d)),d.duration&&(d.duration=Kr(d.duration)),d.repeatDelay&&(d.repeatDelay=Kr(d.repeatDelay)),d.from!==void 0&&(d.keyframes[0]=d.from);let h=!1;if((d.type===!1||d.duration===0&&!d.repeatDelay)&&(wT(d),d.delay===0&&(h=!0)),(_i.instantAnimations||_i.skipAnimations)&&(h=!0,wT(d),d.delay=0),d.allowFlatten=!a.type&&!a.ease,h&&!r&&e.get()!==void 0){const p=dX(d.keyframes,a);if(p!==void 0){nn.update(()=>{d.onUpdate(p),d.onComplete()});return}}return a.isSync?new hN(d):new z8(d)};function xX({protectedKeys:t,needsAnimating:e},n){const s=t.hasOwnProperty(n)&&e[n]!==!0;return e[n]=!1,s}function i3(t,e,{delay:n=0,transitionOverride:s,type:o}={}){let{transition:r=t.getDefaultTransition(),transitionEnd:i,...a}=e;s&&(r=s);const l=[],u=o&&t.animationState&&t.animationState.getState()[o];for(const d in a){const h=t.getValue(d,t.latestValues[d]??null),p=a[d];if(p===void 0||u&&xX(u,d))continue;const x={delay:n,...mN(r||{},d)},b=h.get();if(b!==void 0&&!h.isAnimating&&!Array.isArray(p)&&p===b&&!x.velocity)continue;let w=!1;if(window.MotionHandoffAnimation){const T=r3(t);if(T){const N=window.MotionHandoffAnimation(T,d,nn);N!==null&&(x.startTime=N,w=!0)}}IT(t,d),h.start(kN(d,h,p,t.shouldReduceMotion&&EL.has(d)?{type:!1}:x,t,w));const C=h.animation;C&&l.push(C)}return i&&Promise.all(l).then(()=>{nn.update(()=>{i&&lX(t,i)})}),l}function a3(t,e,n,s=0,o=1){const r=Array.from(t).sort((u,d)=>u.sortNodePosition(d)).indexOf(e),i=t.size,a=(i-1)*s;return typeof n=="function"?n(r,i):o===1?r*s:a-r*s}function kT(t,e,n={}){var l;const s=$c(t,e,n.type==="exit"?(l=t.presenceContext)==null?void 0:l.custom:void 0);let{transition:o=t.getDefaultTransition()||{}}=s||{};n.transitionOverride&&(o=n.transitionOverride);const r=s?()=>Promise.all(i3(t,s,n)):()=>Promise.resolve(),i=t.variantChildren&&t.variantChildren.size?(u=0)=>{const{delayChildren:d=0,staggerChildren:h,staggerDirection:p}=o;return vX(t,e,u,d,h,p,n)}:()=>Promise.resolve(),{when:a}=o;if(a){const[u,d]=a==="beforeChildren"?[r,i]:[i,r];return u().then(()=>d())}else return Promise.all([r(),i(n.delay)])}function vX(t,e,n=0,s=0,o=0,r=1,i){const a=[];for(const l of t.variantChildren)l.notify("AnimationStart",e),a.push(kT(l,e,{...i,delay:n+(typeof s=="function"?0:s)+a3(t.variantChildren,l,s,o,r)}).then(()=>l.notify("AnimationComplete",e)));return Promise.all(a)}function bX(t,e,n={}){t.notify("AnimationStart",e);let s;if(Array.isArray(e)){const o=e.map(r=>kT(t,r,n));s=Promise.all(o)}else if(typeof e=="string")s=kT(t,e,n);else{const o=typeof e=="function"?$c(t,e,n.custom):e;s=Promise.all(i3(t,o,n))}return s.then(()=>{t.notify("AnimationComplete",e)})}function l3(t,e){if(!Array.isArray(e))return!1;const n=e.length;if(n!==t.length)return!1;for(let s=0;s<n;s++)if(e[s]!==t[s])return!1;return!0}const wX=wN.length;function u3(t){if(!t)return;if(!t.isControllingVariants){const n=t.parent?u3(t.parent)||{}:{};return t.props.initial!==void 0&&(n.initial=t.props.initial),n}const e={};for(let n=0;n<wX;n++){const s=wN[n],o=t.props[s];(lp(o)||o===!1)&&(e[s]=o)}return e}const CX=[...bN].reverse(),TX=bN.length;function SX(t){return e=>Promise.all(e.map(({animation:n,options:s})=>bX(t,n,s)))}function NX(t){let e=SX(t),n=E_(),s=!0;const o=l=>(u,d)=>{var p;const h=$c(t,d,l==="exit"?(p=t.presenceContext)==null?void 0:p.custom:void 0);if(h){const{transition:x,transitionEnd:b,...w}=h;u={...u,...w,...b}}return u};function r(l){e=l(t)}function i(l){const{props:u}=t,d=u3(t.parent)||{},h=[],p=new Set;let x={},b=1/0;for(let C=0;C<TX;C++){const T=CX[C],N=n[T],I=u[T]!==void 0?u[T]:d[T],k=lp(I),A=T===l?N.isActive:null;A===!1&&(b=C);let $=I===d[T]&&I!==u[T]&&k;if($&&s&&t.manuallyAnimateOnMount&&($=!1),N.protectedKeys={...x},!N.isActive&&A===null||!I&&!N.prevProp||Nx(I)||typeof I=="boolean")continue;const M=EX(N.prevProp,I);let O=M||T===l&&N.isActive&&!$&&k||C>b&&k,F=!1;const P=Array.isArray(I)?I:[I];let D=P.reduce(o(T),{});A===!1&&(D={});const{prevResolvedValues:H={}}=N,Z={...H,...D},ne=q=>{O=!0,p.has(q)&&(F=!0,p.delete(q)),N.needsAnimating[q]=!0;const J=t.getValue(q);J&&(J.liveStyle=!1)};for(const q in Z){const J=D[q],oe=H[q];if(x.hasOwnProperty(q))continue;let B=!1;ET(J)&&ET(oe)?B=!l3(J,oe):B=J!==oe,B?J!=null?ne(q):p.add(q):J!==void 0&&p.has(q)?ne(q):N.protectedKeys[q]=!0}N.prevProp=I,N.prevResolvedValues=D,N.isActive&&(x={...x,...D}),s&&t.blockInitialAnimation&&(O=!1);const Q=$&&M;O&&(!Q||F)&&h.push(...P.map(q=>{const J={type:T};if(typeof q=="string"&&s&&!Q&&t.manuallyAnimateOnMount&&t.parent){const{parent:oe}=t,B=$c(oe,q);if(oe.enteringChildren&&B){const{delayChildren:X}=B.transition||{};J.delay=a3(oe.enteringChildren,t,X)}}return{animation:q,options:J}}))}if(p.size){const C={};if(typeof u.initial!="boolean"){const T=$c(t,Array.isArray(u.initial)?u.initial[0]:u.initial);T&&T.transition&&(C.transition=T.transition)}p.forEach(T=>{const N=t.getBaseTarget(T),I=t.getValue(T);I&&(I.liveStyle=!0),C[T]=N??null}),h.push({animation:C})}let w=!!h.length;return s&&(u.initial===!1||u.initial===u.animate)&&!t.manuallyAnimateOnMount&&(w=!1),s=!1,w?e(h):Promise.resolve()}function a(l,u){var h;if(n[l].isActive===u)return Promise.resolve();(h=t.variantChildren)==null||h.forEach(p=>{var x;return(x=p.animationState)==null?void 0:x.setActive(l,u)}),n[l].isActive=u;const d=i(l);for(const p in n)n[p].protectedKeys={};return d}return{animateChanges:i,setActive:a,setAnimateFunction:r,getState:()=>n,reset:()=>{n=E_(),s=!0}}}function EX(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!l3(e,t):!1}function kl(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function E_(){return{animate:kl(!0),whileInView:kl(),whileHover:kl(),whileTap:kl(),whileDrag:kl(),whileFocus:kl(),exit:kl()}}class ja{constructor(e){this.isMounted=!1,this.node=e}update(){}}class IX extends ja{constructor(e){super(e),e.animationState||(e.animationState=NX(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();Nx(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:n}=this.node.prevProps||{};e!==n&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)==null||e.call(this)}}let kX=0;class AX extends ja{constructor(){super(...arguments),this.id=kX++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:n}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===s)return;const o=this.node.animationState.setActive("exit",!e);n&&!e&&o.then(()=>{n(this.id)})}mount(){const{register:e,onExitComplete:n}=this.node.presenceContext||{};n&&n(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const RX={animation:{Feature:IX},exit:{Feature:AX}};function cp(t,e,n,s={passive:!0}){return t.addEventListener(e,n,s),()=>t.removeEventListener(e,n)}function Lp(t){return{point:{x:t.pageX,y:t.pageY}}}const $X=t=>e=>xN(e)&&t(e,Lp(e));function jh(t,e,n,s){return cp(t,e,$X(n),s)}const c3=1e-4,DX=1-c3,_X=1+c3,d3=.01,MX=0-d3,FX=0+d3;function Us(t){return t.max-t.min}function OX(t,e,n){return Math.abs(t-e)<=n}function I_(t,e,n,s=.5){t.origin=s,t.originPoint=cn(e.min,e.max,t.origin),t.scale=Us(n)/Us(e),t.translate=cn(n.min,n.max,t.origin)-t.originPoint,(t.scale>=DX&&t.scale<=_X||isNaN(t.scale))&&(t.scale=1),(t.translate>=MX&&t.translate<=FX||isNaN(t.translate))&&(t.translate=0)}function Zh(t,e,n,s){I_(t.x,e.x,n.x,s?s.originX:void 0),I_(t.y,e.y,n.y,s?s.originY:void 0)}function k_(t,e,n){t.min=n.min+e.min,t.max=t.min+Us(e)}function PX(t,e,n){k_(t.x,e.x,n.x),k_(t.y,e.y,n.y)}function A_(t,e,n){t.min=e.min-n.min,t.max=t.min+Us(e)}function Qh(t,e,n){A_(t.x,e.x,n.x),A_(t.y,e.y,n.y)}function Jo(t){return[t("x"),t("y")]}const f3=({current:t})=>t?t.ownerDocument.defaultView:null,R_=(t,e)=>Math.abs(t-e);function LX(t,e){const n=R_(t.x,e.x),s=R_(t.y,e.y);return Math.sqrt(n**2+s**2)}class h3{constructor(e,n,{transformPagePoint:s,contextWindow:o=window,dragSnapToOrigin:r=!1,distanceThreshold:i=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const p=AC(this.lastMoveEventInfo,this.history),x=this.startEvent!==null,b=LX(p.offset,{x:0,y:0})>=this.distanceThreshold;if(!x&&!b)return;const{point:w}=p,{timestamp:C}=vs;this.history.push({...w,timestamp:C});const{onStart:T,onMove:N}=this.handlers;x||(T&&T(this.lastMoveEvent,p),this.startEvent=this.lastMoveEvent),N&&N(this.lastMoveEvent,p)},this.handlePointerMove=(p,x)=>{this.lastMoveEvent=p,this.lastMoveEventInfo=kC(x,this.transformPagePoint),nn.update(this.updatePoint,!0)},this.handlePointerUp=(p,x)=>{this.end();const{onEnd:b,onSessionEnd:w,resumeAnimation:C}=this.handlers;if(this.dragSnapToOrigin&&C&&C(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const T=AC(p.type==="pointercancel"?this.lastMoveEventInfo:kC(x,this.transformPagePoint),this.history);this.startEvent&&b&&b(p,T),w&&w(p,T)},!xN(e))return;this.dragSnapToOrigin=r,this.handlers=n,this.transformPagePoint=s,this.distanceThreshold=i,this.contextWindow=o||window;const a=Lp(e),l=kC(a,this.transformPagePoint),{point:u}=l,{timestamp:d}=vs;this.history=[{...u,timestamp:d}];const{onSessionStart:h}=n;h&&h(e,AC(l,this.history)),this.removeListeners=Fp(jh(this.contextWindow,"pointermove",this.handlePointerMove),jh(this.contextWindow,"pointerup",this.handlePointerUp),jh(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),La(this.updatePoint)}}function kC(t,e){return e?{point:e(t.point)}:t}function $_(t,e){return{x:t.x-e.x,y:t.y-e.y}}function AC({point:t},e){return{point:t,delta:$_(t,p3(e)),offset:$_(t,VX(e)),velocity:zX(e,.1)}}function VX(t){return t[0]}function p3(t){return t[t.length-1]}function zX(t,e){if(t.length<2)return{x:0,y:0};let n=t.length-1,s=null;const o=p3(t);for(;n>=0&&(s=t[n],!(o.timestamp-s.timestamp>Kr(e)));)n--;if(!s)return{x:0,y:0};const r=Xr(o.timestamp-s.timestamp);if(r===0)return{x:0,y:0};const i={x:(o.x-s.x)/r,y:(o.y-s.y)/r};return i.x===1/0&&(i.x=0),i.y===1/0&&(i.y=0),i}function BX(t,{min:e,max:n},s){return e!==void 0&&t<e?t=s?cn(e,t,s.min):Math.max(t,e):n!==void 0&&t>n&&(t=s?cn(n,t,s.max):Math.min(t,n)),t}function D_(t,e,n){return{min:e!==void 0?t.min+e:void 0,max:n!==void 0?t.max+n-(t.max-t.min):void 0}}function UX(t,{top:e,left:n,bottom:s,right:o}){return{x:D_(t.x,n,o),y:D_(t.y,e,s)}}function __(t,e){let n=e.min-t.min,s=e.max-t.max;return e.max-e.min<t.max-t.min&&([n,s]=[s,n]),{min:n,max:s}}function GX(t,e){return{x:__(t.x,e.x),y:__(t.y,e.y)}}function HX(t,e){let n=.5;const s=Us(t),o=Us(e);return o>s?n=rp(e.min,e.max-s,t.min):s>o&&(n=rp(t.min,t.max-o,e.min)),Di(0,1,n)}function WX(t,e){const n={};return e.min!==void 0&&(n.min=e.min-t.min),e.max!==void 0&&(n.max=e.max-t.min),n}const AT=.35;function qX(t=AT){return t===!1?t=0:t===!0&&(t=AT),{x:M_(t,"left","right"),y:M_(t,"top","bottom")}}function M_(t,e,n){return{min:F_(t,e),max:F_(t,n)}}function F_(t,e){return typeof t=="number"?t:t[e]||0}const KX=new WeakMap;class XX{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Cn(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:n=!1,distanceThreshold:s}={}){const{presenceContext:o}=this.visualElement;if(o&&o.isPresent===!1)return;const r=h=>{const{dragSnapToOrigin:p}=this.getProps();p?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(Lp(h).point)},i=(h,p)=>{const{drag:x,dragPropagation:b,onDragStart:w}=this.getProps();if(x&&!b&&(this.openDragLock&&this.openDragLock(),this.openDragLock=nK(x),!this.openDragLock))return;this.latestPointerEvent=h,this.latestPanInfo=p,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Jo(T=>{let N=this.getAxisMotionValue(T).get()||0;if(Yr.test(N)){const{projection:I}=this.visualElement;if(I&&I.layout){const k=I.layout.layoutBox[T];k&&(N=Us(k)*(parseFloat(N)/100))}}this.originPoint[T]=N}),w&&nn.postRender(()=>w(h,p)),IT(this.visualElement,"transform");const{animationState:C}=this.visualElement;C&&C.setActive("whileDrag",!0)},a=(h,p)=>{this.latestPointerEvent=h,this.latestPanInfo=p;const{dragPropagation:x,dragDirectionLock:b,onDirectionLock:w,onDrag:C}=this.getProps();if(!x&&!this.openDragLock)return;const{offset:T}=p;if(b&&this.currentDirection===null){this.currentDirection=YX(T),this.currentDirection!==null&&w&&w(this.currentDirection);return}this.updateAxis("x",p.point,T),this.updateAxis("y",p.point,T),this.visualElement.render(),C&&C(h,p)},l=(h,p)=>{this.latestPointerEvent=h,this.latestPanInfo=p,this.stop(h,p),this.latestPointerEvent=null,this.latestPanInfo=null},u=()=>Jo(h=>{var p;return this.getAnimationState(h)==="paused"&&((p=this.getAxisMotionValue(h).animation)==null?void 0:p.play())}),{dragSnapToOrigin:d}=this.getProps();this.panSession=new h3(e,{onSessionStart:r,onStart:i,onMove:a,onSessionEnd:l,resumeAnimation:u},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:d,distanceThreshold:s,contextWindow:f3(this.visualElement)})}stop(e,n){const s=e||this.latestPointerEvent,o=n||this.latestPanInfo,r=this.isDragging;if(this.cancel(),!r||!o||!s)return;const{velocity:i}=o;this.startAnimation(i);const{onDragEnd:a}=this.getProps();a&&nn.postRender(()=>a(s,o))}cancel(){this.isDragging=!1;const{projection:e,animationState:n}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:s}=this.getProps();!s&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(e,n,s){const{drag:o}=this.getProps();if(!s||!Hy(e,o,this.currentDirection))return;const r=this.getAxisMotionValue(e);let i=this.originPoint[e]+s[e];this.constraints&&this.constraints[e]&&(i=BX(i,this.constraints[e],this.elastic[e])),r.set(i)}resolveConstraints(){var r;const{dragConstraints:e,dragElastic:n}=this.getProps(),s=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(r=this.visualElement.projection)==null?void 0:r.layout,o=this.constraints;e&&Ec(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&s?this.constraints=UX(s.layoutBox,e):this.constraints=!1,this.elastic=qX(n),o!==this.constraints&&s&&this.constraints&&!this.hasMutatedConstraints&&Jo(i=>{this.constraints!==!1&&this.getAxisMotionValue(i)&&(this.constraints[i]=WX(s.layoutBox[i],this.constraints[i]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:n}=this.getProps();if(!e||!Ec(e))return!1;const s=e.current,{projection:o}=this.visualElement;if(!o||!o.layout)return!1;const r=JK(s,o.root,this.visualElement.getTransformPagePoint());let i=GX(o.layout.layoutBox,r);if(n){const a=n(KK(i));this.hasMutatedConstraints=!!a,a&&(i=jL(a))}return i}startAnimation(e){const{drag:n,dragMomentum:s,dragElastic:o,dragTransition:r,dragSnapToOrigin:i,onDragTransitionEnd:a}=this.getProps(),l=this.constraints||{},u=Jo(d=>{if(!Hy(d,n,this.currentDirection))return;let h=l&&l[d]||{};i&&(h={min:0,max:0});const p=o?200:1e6,x=o?40:1e7,b={type:"inertia",velocity:s?e[d]:0,bounceStiffness:p,bounceDamping:x,timeConstant:750,restDelta:1,restSpeed:10,...r,...h};return this.startAxisValueAnimation(d,b)});return Promise.all(u).then(a)}startAxisValueAnimation(e,n){const s=this.getAxisMotionValue(e);return IT(this.visualElement,e),s.start(kN(e,s,0,n,this.visualElement,!1))}stopAnimation(){Jo(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Jo(e=>{var n;return(n=this.getAxisMotionValue(e).animation)==null?void 0:n.pause()})}getAnimationState(e){var n;return(n=this.getAxisMotionValue(e).animation)==null?void 0:n.state}getAxisMotionValue(e){const n=`_drag${e.toUpperCase()}`,s=this.visualElement.getProps(),o=s[n];return o||this.visualElement.getValue(e,(s.initial?s.initial[e]:void 0)||0)}snapToCursor(e){Jo(n=>{const{drag:s}=this.getProps();if(!Hy(n,s,this.currentDirection))return;const{projection:o}=this.visualElement,r=this.getAxisMotionValue(n);if(o&&o.layout){const{min:i,max:a}=o.layout.layoutBox[n];r.set(e[n]-cn(i,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:n}=this.getProps(),{projection:s}=this.visualElement;if(!Ec(n)||!s||!this.constraints)return;this.stopAnimation();const o={x:0,y:0};Jo(i=>{const a=this.getAxisMotionValue(i);if(a&&this.constraints!==!1){const l=a.get();o[i]=HX({min:l,max:l},this.constraints[i])}});const{transformTemplate:r}=this.visualElement.getProps();this.visualElement.current.style.transform=r?r({},""):"none",s.root&&s.root.updateScroll(),s.updateLayout(),this.resolveConstraints(),Jo(i=>{if(!Hy(i,e,null))return;const a=this.getAxisMotionValue(i),{min:l,max:u}=this.constraints[i];a.set(cn(l,u,o[i]))})}addListeners(){if(!this.visualElement.current)return;KX.set(this.visualElement,this);const e=this.visualElement.current,n=jh(e,"pointerdown",l=>{const{drag:u,dragListener:d=!0}=this.getProps();u&&d&&this.start(l)}),s=()=>{const{dragConstraints:l}=this.getProps();Ec(l)&&l.current&&(this.constraints=this.resolveRefConstraints())},{projection:o}=this.visualElement,r=o.addEventListener("measure",s);o&&!o.layout&&(o.root&&o.root.updateScroll(),o.updateLayout()),nn.read(s);const i=cp(window,"resize",()=>this.scalePositionWithinConstraints()),a=o.addEventListener("didUpdate",(({delta:l,hasLayoutChanged:u})=>{this.isDragging&&u&&(Jo(d=>{const h=this.getAxisMotionValue(d);h&&(this.originPoint[d]+=l[d].translate,h.set(h.get()+l[d].translate))}),this.visualElement.render())}));return()=>{i(),n(),r(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:s=!1,dragPropagation:o=!1,dragConstraints:r=!1,dragElastic:i=AT,dragMomentum:a=!0}=e;return{...e,drag:n,dragDirectionLock:s,dragPropagation:o,dragConstraints:r,dragElastic:i,dragMomentum:a}}}function Hy(t,e,n){return(e===!0||e===t)&&(n===null||n===t)}function YX(t,e=10){let n=null;return Math.abs(t.y)>e?n="y":Math.abs(t.x)>e&&(n="x"),n}class JX extends ja{constructor(e){super(e),this.removeGroupControls=er,this.removeListeners=er,this.controls=new XX(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||er}unmount(){this.removeGroupControls(),this.removeListeners()}}const O_=t=>(e,n)=>{t&&nn.postRender(()=>t(e,n))};class jX extends ja{constructor(){super(...arguments),this.removePointerDownListener=er}onPointerDown(e){this.session=new h3(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:f3(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:n,onPan:s,onPanEnd:o}=this.node.getProps();return{onSessionStart:O_(e),onStart:O_(n),onMove:s,onEnd:(r,i)=>{delete this.session,o&&nn.postRender(()=>o(r,i))}}}mount(){this.removePointerDownListener=jh(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const p0={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function P_(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const Ih={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(Je.test(t))t=parseFloat(t);else return t;const n=P_(t,e.target.x),s=P_(t,e.target.y);return`${n}% ${s}%`}},ZX={correct:(t,{treeScale:e,projectionDelta:n})=>{const s=t,o=Va.parse(t);if(o.length>5)return s;const r=Va.createTransformer(t),i=typeof o[0]!="number"?1:0,a=n.x.scale*e.x,l=n.y.scale*e.y;o[0+i]/=a,o[1+i]/=l;const u=cn(a,l,.5);return typeof o[2+i]=="number"&&(o[2+i]/=u),typeof o[3+i]=="number"&&(o[3+i]/=u),r(o)}};let RC=!1;class QX extends ce.Component{componentDidMount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:s,layoutId:o}=this.props,{projection:r}=e;wK(eY),r&&(n.group&&n.group.add(r),s&&s.register&&o&&s.register(r),RC&&r.root.didUpdate(),r.addEventListener("animationComplete",()=>{this.safeToRemove()}),r.setOptions({...r.options,onExitComplete:()=>this.safeToRemove()})),p0.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:n,visualElement:s,drag:o,isPresent:r}=this.props,{projection:i}=s;return i&&(i.isPresent=r,RC=!0,o||e.layoutDependency!==n||n===void 0||e.isPresent!==r?i.willUpdate():this.safeToRemove(),e.isPresent!==r&&(r?i.promote():i.relegate()||nn.postRender(()=>{const a=i.getStack();(!a||!a.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),yN.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:s}=this.props,{projection:o}=e;RC=!0,o&&(o.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(o),s&&s.deregister&&s.deregister(o))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function m3(t){const[e,n]=PL(),s=ce.useContext(YS);return U.jsx(QX,{...t,layoutGroup:s,switchLayoutGroup:ce.useContext(YL),isPresent:e,safeToRemove:n})}const eY={borderRadius:{...Ih,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Ih,borderTopRightRadius:Ih,borderBottomLeftRadius:Ih,borderBottomRightRadius:Ih,boxShadow:ZX};function tY(t,e,n){const s=Ds(t)?t:Vc(t);return s.start(kN("",s,e,n)),s.animation}const nY=(t,e)=>t.depth-e.depth;class sY{constructor(){this.children=[],this.isDirty=!1}add(e){ZS(this.children,e),this.isDirty=!0}remove(e){QS(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(nY),this.isDirty=!1,this.children.forEach(e)}}function oY(t,e){const n=lo.now(),s=({timestamp:o})=>{const r=o-n;r>=e&&(La(s),t(r-e))};return nn.setup(s,!0),()=>La(s)}const g3=["TopLeft","TopRight","BottomLeft","BottomRight"],rY=g3.length,L_=t=>typeof t=="string"?parseFloat(t):t,V_=t=>typeof t=="number"||Je.test(t);function iY(t,e,n,s,o,r){o?(t.opacity=cn(0,n.opacity??1,aY(s)),t.opacityExit=cn(e.opacity??1,0,lY(s))):r&&(t.opacity=cn(e.opacity??1,n.opacity??1,s));for(let i=0;i<rY;i++){const a=`border${g3[i]}Radius`;let l=z_(e,a),u=z_(n,a);if(l===void 0&&u===void 0)continue;l||(l=0),u||(u=0),l===0||u===0||V_(l)===V_(u)?(t[a]=Math.max(cn(L_(l),L_(u),s),0),(Yr.test(u)||Yr.test(l))&&(t[a]+="%")):t[a]=u}(e.rotate||n.rotate)&&(t.rotate=cn(e.rotate||0,n.rotate||0,s))}function z_(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const aY=y3(0,.5,sL),lY=y3(.5,.95,er);function y3(t,e,n){return s=>s<t?0:s>e?1:n(rp(t,e,s))}function B_(t,e){t.min=e.min,t.max=e.max}function Ko(t,e){B_(t.x,e.x),B_(t.y,e.y)}function U_(t,e){t.translate=e.translate,t.scale=e.scale,t.originPoint=e.originPoint,t.origin=e.origin}function G_(t,e,n,s,o){return t-=e,t=V0(t,1/n,s),o!==void 0&&(t=V0(t,1/o,s)),t}function uY(t,e=0,n=1,s=.5,o,r=t,i=t){if(Yr.test(e)&&(e=parseFloat(e),e=cn(i.min,i.max,e/100)-i.min),typeof e!="number")return;let a=cn(r.min,r.max,s);t===r&&(a-=e),t.min=G_(t.min,e,n,a,o),t.max=G_(t.max,e,n,a,o)}function H_(t,e,[n,s,o],r,i){uY(t,e[n],e[s],e[o],e.scale,r,i)}const cY=["x","scaleX","originX"],dY=["y","scaleY","originY"];function W_(t,e,n,s){H_(t.x,e,cY,n?n.x:void 0,s?s.x:void 0),H_(t.y,e,dY,n?n.y:void 0,s?s.y:void 0)}function q_(t){return t.translate===0&&t.scale===1}function x3(t){return q_(t.x)&&q_(t.y)}function K_(t,e){return t.min===e.min&&t.max===e.max}function fY(t,e){return K_(t.x,e.x)&&K_(t.y,e.y)}function X_(t,e){return Math.round(t.min)===Math.round(e.min)&&Math.round(t.max)===Math.round(e.max)}function v3(t,e){return X_(t.x,e.x)&&X_(t.y,e.y)}function Y_(t){return Us(t.x)/Us(t.y)}function J_(t,e){return t.translate===e.translate&&t.scale===e.scale&&t.originPoint===e.originPoint}class hY{constructor(){this.members=[]}add(e){ZS(this.members,e),e.scheduleRender()}remove(e){if(QS(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(e){const n=this.members.findIndex(o=>e===o);if(n===0)return!1;let s;for(let o=n;o>=0;o--){const r=this.members[o];if(r.isPresent!==!1){s=r;break}}return s?(this.promote(s),!0):!1}promote(e,n){const s=this.lead;if(e!==s&&(this.prevLead=s,this.lead=e,e.show(),s)){s.instance&&s.scheduleRender(),e.scheduleRender(),e.resumeFrom=s,n&&(e.resumeFrom.preserveOpacity=!0),s.snapshot&&(e.snapshot=s.snapshot,e.snapshot.latestValues=s.animationValues||s.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:o}=e.options;o===!1&&s.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:n,resumingFrom:s}=e;n.onExitComplete&&n.onExitComplete(),s&&s.options.onExitComplete&&s.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function pY(t,e,n){let s="";const o=t.x.translate/e.x,r=t.y.translate/e.y,i=(n==null?void 0:n.z)||0;if((o||r||i)&&(s=`translate3d(${o}px, ${r}px, ${i}px) `),(e.x!==1||e.y!==1)&&(s+=`scale(${1/e.x}, ${1/e.y}) `),n){const{transformPerspective:u,rotate:d,rotateX:h,rotateY:p,skewX:x,skewY:b}=n;u&&(s=`perspective(${u}px) ${s}`),d&&(s+=`rotate(${d}deg) `),h&&(s+=`rotateX(${h}deg) `),p&&(s+=`rotateY(${p}deg) `),x&&(s+=`skewX(${x}deg) `),b&&(s+=`skewY(${b}deg) `)}const a=t.x.scale*e.x,l=t.y.scale*e.y;return(a!==1||l!==1)&&(s+=`scale(${a}, ${l})`),s||"none"}const $C=["","X","Y","Z"],mY=1e3;let gY=0;function DC(t,e,n,s){const{latestValues:o}=e;o[t]&&(n[t]=o[t],e.setStaticValue(t,0),s&&(s[t]=0))}function b3(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:e}=t.options;if(!e)return;const n=r3(e);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:o,layoutId:r}=t.options;window.MotionCancelOptimisedAnimation(n,"transform",nn,!(o||r))}const{parent:s}=t;s&&!s.hasCheckedOptimisedAppear&&b3(s)}function w3({attachResizeListener:t,defaultParent:e,measureScroll:n,checkIsScrollRoot:s,resetTransform:o}){return class{constructor(i={},a=e==null?void 0:e()){this.id=gY++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(vY),this.nodes.forEach(TY),this.nodes.forEach(SY),this.nodes.forEach(bY)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=i,this.root=a?a.root||a:this,this.path=a?[...a.path,a]:[],this.parent=a,this.depth=a?a.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new sY)}addEventListener(i,a){return this.eventHandlers.has(i)||this.eventHandlers.set(i,new nN),this.eventHandlers.get(i).add(a)}notifyListeners(i,...a){const l=this.eventHandlers.get(i);l&&l.notify(...a)}hasListeners(i){return this.eventHandlers.has(i)}mount(i){if(this.instance)return;this.isSVG=OL(i)&&!lK(i),this.instance=i;const{layoutId:a,layout:l,visualElement:u}=this.options;if(u&&!u.current&&u.mount(i),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(l||a)&&(this.isLayoutDirty=!0),t){let d,h=0;const p=()=>this.root.updateBlockedByResize=!1;nn.read(()=>{h=window.innerWidth}),t(i,()=>{const x=window.innerWidth;x!==h&&(h=x,this.root.updateBlockedByResize=!0,d&&d(),d=oY(p,250),p0.hasAnimatedSinceResize&&(p0.hasAnimatedSinceResize=!1,this.nodes.forEach(Q_)))})}a&&this.root.registerSharedNode(a,this),this.options.animate!==!1&&u&&(a||l)&&this.addEventListener("didUpdate",({delta:d,hasLayoutChanged:h,hasRelativeLayoutChanged:p,layout:x})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const b=this.options.transition||u.getDefaultTransition()||AY,{onLayoutAnimationStart:w,onLayoutAnimationComplete:C}=u.getProps(),T=!this.targetLayout||!v3(this.targetLayout,x),N=!h&&p;if(this.options.layoutRoot||this.resumeFrom||N||h&&(T||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const I={...mN(b,"layout"),onPlay:w,onComplete:C};(u.shouldReduceMotion||this.options.layoutRoot)&&(I.delay=0,I.type=!1),this.startAnimation(I),this.setAnimationOrigin(d,N)}else h||Q_(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=x})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const i=this.getStack();i&&i.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),La(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(NY),this.animationId++)}getTransformTemplate(){const{visualElement:i}=this.options;return i&&i.getProps().transformTemplate}willUpdate(i=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&b3(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let d=0;d<this.path.length;d++){const h=this.path[d];h.shouldResetTransform=!0,h.updateScroll("snapshot"),h.options.layoutRoot&&h.willUpdate(!1)}const{layoutId:a,layout:l}=this.options;if(a===void 0&&!l)return;const u=this.getTransformTemplate();this.prevTransformTemplateValue=u?u(this.latestValues,""):void 0,this.updateSnapshot(),i&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(j_);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(Z_);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(CY),this.nodes.forEach(yY),this.nodes.forEach(xY)):this.nodes.forEach(Z_),this.clearAllSnapshots();const a=lo.now();vs.delta=Di(0,1e3/60,a-vs.timestamp),vs.timestamp=a,vs.isProcessing=!0,bC.update.process(vs),bC.preRender.process(vs),bC.render.process(vs),vs.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,yN.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(wY),this.sharedNodes.forEach(EY)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,nn.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){nn.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Us(this.snapshot.measuredBox.x)&&!Us(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const i=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Cn(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:a}=this.options;a&&a.notify("LayoutMeasure",this.layout.layoutBox,i?i.layoutBox:void 0)}updateScroll(i="measure"){let a=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===i&&(a=!1),a&&this.instance){const l=s(this.instance);this.scroll={animationId:this.root.animationId,phase:i,isRoot:l,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:l}}}resetTransform(){if(!o)return;const i=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,a=this.projectionDelta&&!x3(this.projectionDelta),l=this.getTransformTemplate(),u=l?l(this.latestValues,""):void 0,d=u!==this.prevTransformTemplateValue;i&&this.instance&&(a||$l(this.latestValues)||d)&&(o(this.instance,u),this.shouldResetTransform=!1,this.scheduleRender())}measure(i=!0){const a=this.measurePageBox();let l=this.removeElementScroll(a);return i&&(l=this.removeTransform(l)),RY(l),{animationId:this.root.animationId,measuredBox:a,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){var u;const{visualElement:i}=this.options;if(!i)return Cn();const a=i.measureViewportBox();if(!(((u=this.scroll)==null?void 0:u.wasRoot)||this.path.some($Y))){const{scroll:d}=this.root;d&&(Ic(a.x,d.offset.x),Ic(a.y,d.offset.y))}return a}removeElementScroll(i){var l;const a=Cn();if(Ko(a,i),(l=this.scroll)!=null&&l.wasRoot)return a;for(let u=0;u<this.path.length;u++){const d=this.path[u],{scroll:h,options:p}=d;d!==this.root&&h&&p.layoutScroll&&(h.wasRoot&&Ko(a,i),Ic(a.x,h.offset.x),Ic(a.y,h.offset.y))}return a}applyTransform(i,a=!1){const l=Cn();Ko(l,i);for(let u=0;u<this.path.length;u++){const d=this.path[u];!a&&d.options.layoutScroll&&d.scroll&&d!==d.root&&kc(l,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),$l(d.latestValues)&&kc(l,d.latestValues)}return $l(this.latestValues)&&kc(l,this.latestValues),l}removeTransform(i){const a=Cn();Ko(a,i);for(let l=0;l<this.path.length;l++){const u=this.path[l];if(!u.instance||!$l(u.latestValues))continue;TT(u.latestValues)&&u.updateSnapshot();const d=Cn(),h=u.measurePageBox();Ko(d,h),W_(a,u.latestValues,u.snapshot?u.snapshot.layoutBox:void 0,d)}return $l(this.latestValues)&&W_(a,this.latestValues),a}setTargetDelta(i){this.targetDelta=i,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(i){this.options={...this.options,...i,crossfade:i.crossfade!==void 0?i.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==vs.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(i=!1){var p;const a=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=a.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=a.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=a.isSharedProjectionDirty);const l=!!this.resumingFrom||this!==a;if(!(i||l&&this.isSharedProjectionDirty||this.isProjectionDirty||(p=this.parent)!=null&&p.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:d,layoutId:h}=this.options;if(!(!this.layout||!(d||h))){if(this.resolvedRelativeTargetAt=vs.timestamp,!this.targetDelta&&!this.relativeTarget){const x=this.getClosestProjectingParent();x&&x.layout&&this.animationProgress!==1?(this.relativeParent=x,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Cn(),this.relativeTargetOrigin=Cn(),Qh(this.relativeTargetOrigin,this.layout.layoutBox,x.layout.layoutBox),Ko(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Cn(),this.targetWithTransforms=Cn()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),PX(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Ko(this.target,this.layout.layoutBox),QL(this.target,this.targetDelta)):Ko(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const x=this.getClosestProjectingParent();x&&!!x.resumingFrom==!!this.resumingFrom&&!x.options.layoutScroll&&x.target&&this.animationProgress!==1?(this.relativeParent=x,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Cn(),this.relativeTargetOrigin=Cn(),Qh(this.relativeTargetOrigin,this.target,x.target),Ko(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||TT(this.parent.latestValues)||ZL(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var b;const i=this.getLead(),a=!!this.resumingFrom||this!==i;let l=!0;if((this.isProjectionDirty||(b=this.parent)!=null&&b.isProjectionDirty)&&(l=!1),a&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(l=!1),this.resolvedRelativeTargetAt===vs.timestamp&&(l=!1),l)return;const{layout:u,layoutId:d}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(u||d))return;Ko(this.layoutCorrected,this.layout.layoutBox);const h=this.treeScale.x,p=this.treeScale.y;YK(this.layoutCorrected,this.treeScale,this.path,a),i.layout&&!i.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(i.target=i.layout.layoutBox,i.targetWithTransforms=Cn());const{target:x}=i;if(!x){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(U_(this.prevProjectionDelta.x,this.projectionDelta.x),U_(this.prevProjectionDelta.y,this.projectionDelta.y)),Zh(this.projectionDelta,this.layoutCorrected,x,this.latestValues),(this.treeScale.x!==h||this.treeScale.y!==p||!J_(this.projectionDelta.x,this.prevProjectionDelta.x)||!J_(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",x))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(i=!0){var a;if((a=this.options.visualElement)==null||a.scheduleRender(),i){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Ac(),this.projectionDelta=Ac(),this.projectionDeltaWithTransform=Ac()}setAnimationOrigin(i,a=!1){const l=this.snapshot,u=l?l.latestValues:{},d={...this.latestValues},h=Ac();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!a;const p=Cn(),x=l?l.source:void 0,b=this.layout?this.layout.source:void 0,w=x!==b,C=this.getStack(),T=!C||C.members.length<=1,N=!!(w&&!T&&this.options.crossfade===!0&&!this.path.some(kY));this.animationProgress=0;let I;this.mixTargetDelta=k=>{const A=k/1e3;eM(h.x,i.x,A),eM(h.y,i.y,A),this.setTargetDelta(h),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Qh(p,this.layout.layoutBox,this.relativeParent.layout.layoutBox),IY(this.relativeTarget,this.relativeTargetOrigin,p,A),I&&fY(this.relativeTarget,I)&&(this.isProjectionDirty=!1),I||(I=Cn()),Ko(I,this.relativeTarget)),w&&(this.animationValues=d,iY(d,u,this.latestValues,A,N,T)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=A},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(i){var a,l,u;this.notifyListeners("animationStart"),(a=this.currentAnimation)==null||a.stop(),(u=(l=this.resumingFrom)==null?void 0:l.currentAnimation)==null||u.stop(),this.pendingAnimation&&(La(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=nn.update(()=>{p0.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=Vc(0)),this.currentAnimation=tY(this.motionValue,[0,1e3],{...i,velocity:0,isSync:!0,onUpdate:d=>{this.mixTargetDelta(d),i.onUpdate&&i.onUpdate(d)},onStop:()=>{},onComplete:()=>{i.onComplete&&i.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const i=this.getStack();i&&i.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(mY),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const i=this.getLead();let{targetWithTransforms:a,target:l,layout:u,latestValues:d}=i;if(!(!a||!l||!u)){if(this!==i&&this.layout&&u&&C3(this.options.animationType,this.layout.layoutBox,u.layoutBox)){l=this.target||Cn();const h=Us(this.layout.layoutBox.x);l.x.min=i.target.x.min,l.x.max=l.x.min+h;const p=Us(this.layout.layoutBox.y);l.y.min=i.target.y.min,l.y.max=l.y.min+p}Ko(a,l),kc(a,d),Zh(this.projectionDeltaWithTransform,this.layoutCorrected,a,d)}}registerSharedNode(i,a){this.sharedNodes.has(i)||this.sharedNodes.set(i,new hY),this.sharedNodes.get(i).add(a);const u=a.options.initialPromotionConfig;a.promote({transition:u?u.transition:void 0,preserveFollowOpacity:u&&u.shouldPreserveFollowOpacity?u.shouldPreserveFollowOpacity(a):void 0})}isLead(){const i=this.getStack();return i?i.lead===this:!0}getLead(){var a;const{layoutId:i}=this.options;return i?((a=this.getStack())==null?void 0:a.lead)||this:this}getPrevLead(){var a;const{layoutId:i}=this.options;return i?(a=this.getStack())==null?void 0:a.prevLead:void 0}getStack(){const{layoutId:i}=this.options;if(i)return this.root.sharedNodes.get(i)}promote({needsReset:i,transition:a,preserveFollowOpacity:l}={}){const u=this.getStack();u&&u.promote(this,l),i&&(this.projectionDelta=void 0,this.needsReset=!0),a&&this.setOptions({transition:a})}relegate(){const i=this.getStack();return i?i.relegate(this):!1}resetSkewAndRotation(){const{visualElement:i}=this.options;if(!i)return;let a=!1;const{latestValues:l}=i;if((l.z||l.rotate||l.rotateX||l.rotateY||l.rotateZ||l.skewX||l.skewY)&&(a=!0),!a)return;const u={};l.z&&DC("z",i,u,this.animationValues);for(let d=0;d<$C.length;d++)DC(`rotate${$C[d]}`,i,u,this.animationValues),DC(`skew${$C[d]}`,i,u,this.animationValues);i.render();for(const d in u)i.setStaticValue(d,u[d]),this.animationValues&&(this.animationValues[d]=u[d]);i.scheduleRender()}applyProjectionStyles(i,a){if(!this.instance||this.isSVG)return;if(!this.isVisible){i.visibility="hidden";return}const l=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,i.visibility="",i.opacity="",i.pointerEvents=h0(a==null?void 0:a.pointerEvents)||"",i.transform=l?l(this.latestValues,""):"none";return}const u=this.getLead();if(!this.projectionDelta||!this.layout||!u.target){this.options.layoutId&&(i.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,i.pointerEvents=h0(a==null?void 0:a.pointerEvents)||""),this.hasProjected&&!$l(this.latestValues)&&(i.transform=l?l({},""):"none",this.hasProjected=!1);return}i.visibility="";const d=u.animationValues||u.latestValues;this.applyTransformsToTarget();let h=pY(this.projectionDeltaWithTransform,this.treeScale,d);l&&(h=l(d,h)),i.transform=h;const{x:p,y:x}=this.projectionDelta;i.transformOrigin=`${p.origin*100}% ${x.origin*100}% 0`,u.animationValues?i.opacity=u===this?d.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:d.opacityExit:i.opacity=u===this?d.opacity!==void 0?d.opacity:"":d.opacityExit!==void 0?d.opacityExit:0;for(const b in up){if(d[b]===void 0)continue;const{correct:w,applyTo:C,isCSSVariable:T}=up[b],N=h==="none"?d[b]:w(d[b],u);if(C){const I=C.length;for(let k=0;k<I;k++)i[C[k]]=N}else T?this.options.visualElement.renderState.vars[b]=N:i[b]=N}this.options.layoutId&&(i.pointerEvents=u===this?h0(a==null?void 0:a.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(i=>{var a;return(a=i.currentAnimation)==null?void 0:a.stop()}),this.root.nodes.forEach(j_),this.root.sharedNodes.clear()}}}function yY(t){t.updateLayout()}function xY(t){var n;const e=((n=t.resumeFrom)==null?void 0:n.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&e&&t.hasListeners("didUpdate")){const{layoutBox:s,measuredBox:o}=t.layout,{animationType:r}=t.options,i=e.source!==t.layout.source;r==="size"?Jo(h=>{const p=i?e.measuredBox[h]:e.layoutBox[h],x=Us(p);p.min=s[h].min,p.max=p.min+x}):C3(r,e.layoutBox,s)&&Jo(h=>{const p=i?e.measuredBox[h]:e.layoutBox[h],x=Us(s[h]);p.max=p.min+x,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[h].max=t.relativeTarget[h].min+x)});const a=Ac();Zh(a,s,e.layoutBox);const l=Ac();i?Zh(l,t.applyTransform(o,!0),e.measuredBox):Zh(l,s,e.layoutBox);const u=!x3(a);let d=!1;if(!t.resumeFrom){const h=t.getClosestProjectingParent();if(h&&!h.resumeFrom){const{snapshot:p,layout:x}=h;if(p&&x){const b=Cn();Qh(b,e.layoutBox,p.layoutBox);const w=Cn();Qh(w,s,x.layoutBox),v3(b,w)||(d=!0),h.options.layoutRoot&&(t.relativeTarget=w,t.relativeTargetOrigin=b,t.relativeParent=h)}}}t.notifyListeners("didUpdate",{layout:s,snapshot:e,delta:l,layoutDelta:a,hasLayoutChanged:u,hasRelativeLayoutChanged:d})}else if(t.isLead()){const{onExitComplete:s}=t.options;s&&s()}t.options.transition=void 0}function vY(t){t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function bY(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function wY(t){t.clearSnapshot()}function j_(t){t.clearMeasurements()}function Z_(t){t.isLayoutDirty=!1}function CY(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function Q_(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function TY(t){t.resolveTargetDelta()}function SY(t){t.calcProjection()}function NY(t){t.resetSkewAndRotation()}function EY(t){t.removeLeadSnapshot()}function eM(t,e,n){t.translate=cn(e.translate,0,n),t.scale=cn(e.scale,1,n),t.origin=e.origin,t.originPoint=e.originPoint}function tM(t,e,n,s){t.min=cn(e.min,n.min,s),t.max=cn(e.max,n.max,s)}function IY(t,e,n,s){tM(t.x,e.x,n.x,s),tM(t.y,e.y,n.y,s)}function kY(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const AY={duration:.45,ease:[.4,0,.1,1]},nM=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),sM=nM("applewebkit/")&&!nM("chrome/")?Math.round:er;function oM(t){t.min=sM(t.min),t.max=sM(t.max)}function RY(t){oM(t.x),oM(t.y)}function C3(t,e,n){return t==="position"||t==="preserve-aspect"&&!OX(Y_(e),Y_(n),.2)}function $Y(t){var e;return t!==t.root&&((e=t.scroll)==null?void 0:e.wasRoot)}const DY=w3({attachResizeListener:(t,e)=>cp(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),_C={current:void 0},T3=w3({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!_C.current){const t=new DY({});t.mount(window),t.setOptions({layoutScroll:!0}),_C.current=t}return _C.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),_Y={pan:{Feature:jX},drag:{Feature:JX,ProjectionNode:T3,MeasureLayout:m3}};function rM(t,e,n){const{props:s}=t;t.animationState&&s.whileHover&&t.animationState.setActive("whileHover",n==="Start");const o="onHover"+n,r=s[o];r&&nn.postRender(()=>r(e,Lp(e)))}class MY extends ja{mount(){const{current:e}=this.node;e&&(this.unmount=sK(e,(n,s)=>(rM(this.node,s,"Start"),o=>rM(this.node,o,"End"))))}unmount(){}}class FY extends ja{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Fp(cp(this.node.current,"focus",()=>this.onFocus()),cp(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function iM(t,e,n){const{props:s}=t;if(t.current instanceof HTMLButtonElement&&t.current.disabled)return;t.animationState&&s.whileTap&&t.animationState.setActive("whileTap",n==="Start");const o="onTap"+(n==="End"?"":n),r=s[o];r&&nn.postRender(()=>r(e,Lp(e)))}class OY extends ja{mount(){const{current:e}=this.node;e&&(this.unmount=aK(e,(n,s)=>(iM(this.node,s,"Start"),(o,{success:r})=>iM(this.node,o,r?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const RT=new WeakMap,MC=new WeakMap,PY=t=>{const e=RT.get(t.target);e&&e(t)},LY=t=>{t.forEach(PY)};function VY({root:t,...e}){const n=t||document;MC.has(n)||MC.set(n,{});const s=MC.get(n),o=JSON.stringify(e);return s[o]||(s[o]=new IntersectionObserver(LY,{root:t,...e})),s[o]}function zY(t,e,n){const s=VY(e);return RT.set(t,n),s.observe(t),()=>{RT.delete(t),s.unobserve(t)}}const BY={some:0,all:1};class UY extends ja{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:n,margin:s,amount:o="some",once:r}=e,i={root:n?n.current:void 0,rootMargin:s,threshold:typeof o=="number"?o:BY[o]},a=l=>{const{isIntersecting:u}=l;if(this.isInView===u||(this.isInView=u,r&&!u&&this.hasEnteredView))return;u&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",u);const{onViewportEnter:d,onViewportLeave:h}=this.node.getProps(),p=u?d:h;p&&p(l)};return zY(this.node.current,i,a)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:n}=this.node;["amount","margin","root"].some(GY(e,n))&&this.startObserver()}unmount(){}}function GY({viewport:t={}},{viewport:e={}}={}){return n=>t[n]!==e[n]}const HY={inView:{Feature:UY},tap:{Feature:OY},focus:{Feature:FY},hover:{Feature:MY}},WY={layout:{ProjectionNode:T3,MeasureLayout:m3}},qY={...RX,...HY,..._Y,...WY},Tn=qK(qY,rX);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let KY,XY;function YY(){return{geminiUrl:KY,vertexUrl:XY}}function JY(t,e,n,s){var o,r;if(!(t!=null&&t.baseUrl)){const i=YY();return e?(o=i.vertexUrl)!==null&&o!==void 0?o:n:(r=i.geminiUrl)!==null&&r!==void 0?r:s}return t.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class gu{}function Me(t,e){const n=/\{([^}]+)\}/g;return t.replace(n,(s,o)=>{if(Object.prototype.hasOwnProperty.call(e,o)){const r=e[o];return r!=null?String(r):""}else throw new Error(`Key '${o}' not found in valueMap.`)})}function y(t,e,n){for(let r=0;r<e.length-1;r++){const i=e[r];if(i.endsWith("[]")){const a=i.slice(0,-2);if(!(a in t))if(Array.isArray(n))t[a]=Array.from({length:n.length},()=>({}));else throw new Error(`Value must be a list given an array path ${i}`);if(Array.isArray(t[a])){const l=t[a];if(Array.isArray(n))for(let u=0;u<l.length;u++){const d=l[u];y(d,e.slice(r+1),n[u])}else for(const u of l)y(u,e.slice(r+1),n)}return}else if(i.endsWith("[0]")){const a=i.slice(0,-3);a in t||(t[a]=[{}]);const l=t[a];y(l[0],e.slice(r+1),n);return}(!t[i]||typeof t[i]!="object")&&(t[i]={}),t=t[i]}const s=e[e.length-1],o=t[s];if(o!==void 0){if(!n||typeof n=="object"&&Object.keys(n).length===0||n===o)return;if(typeof o=="object"&&typeof n=="object"&&o!==null&&n!==null)Object.assign(o,n);else throw new Error(`Cannot set value for an existing key. Key: ${s}`)}else s==="_self"&&typeof n=="object"&&n!==null&&!Array.isArray(n)?Object.assign(t,n):t[s]=n}function g(t,e){try{if(e.length===1&&e[0]==="_self")return t;for(let n=0;n<e.length;n++){if(typeof t!="object"||t===null)return;const s=e[n];if(s.endsWith("[]")){const o=s.slice(0,-2);if(o in t){const r=t[o];return Array.isArray(r)?r.map(i=>g(i,e.slice(n+1))):void 0}else return}else t=t[s]}return t}catch(n){if(n instanceof TypeError)return;throw n}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function AN(t){if(typeof t!="string")throw new Error("fromImageBytes must be a string");return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function jY(t){const e={},n=g(t,["operationName"]);n!=null&&y(e,["_url","operationName"],n);const s=g(t,["config"]);return s!=null&&y(e,["config"],s),e}function ZY(t){const e={},n=g(t,["operationName"]);n!=null&&y(e,["operationName"],n);const s=g(t,["resourceName"]);s!=null&&y(e,["_url","resourceName"],s);const o=g(t,["config"]);return o!=null&&y(e,["config"],o),e}function QY(t){const e={},n=g(t,["operationName"]);n!=null&&y(e,["_url","operationName"],n);const s=g(t,["config"]);return s!=null&&y(e,["config"],s),e}function e7(t){const e={},n=g(t,["video","uri"]);n!=null&&y(e,["uri"],n);const s=g(t,["video","encodedVideo"]);s!=null&&y(e,["videoBytes"],AN(s));const o=g(t,["encoding"]);return o!=null&&y(e,["mimeType"],o),e}function t7(t){const e={},n=g(t,["_self"]);return n!=null&&y(e,["video"],e7(n)),e}function n7(t){const e={},n=g(t,["generatedSamples"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>t7(i))),y(e,["generatedVideos"],r)}const s=g(t,["raiMediaFilteredCount"]);s!=null&&y(e,["raiMediaFilteredCount"],s);const o=g(t,["raiMediaFilteredReasons"]);return o!=null&&y(e,["raiMediaFilteredReasons"],o),e}function s7(t){const e={},n=g(t,["name"]);n!=null&&y(e,["name"],n);const s=g(t,["metadata"]);s!=null&&y(e,["metadata"],s);const o=g(t,["done"]);o!=null&&y(e,["done"],o);const r=g(t,["error"]);r!=null&&y(e,["error"],r);const i=g(t,["response","generateVideoResponse"]);return i!=null&&y(e,["response"],n7(i)),e}function o7(t){const e={},n=g(t,["gcsUri"]);n!=null&&y(e,["uri"],n);const s=g(t,["bytesBase64Encoded"]);s!=null&&y(e,["videoBytes"],AN(s));const o=g(t,["mimeType"]);return o!=null&&y(e,["mimeType"],o),e}function r7(t){const e={},n=g(t,["_self"]);return n!=null&&y(e,["video"],o7(n)),e}function i7(t){const e={},n=g(t,["videos"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>r7(i))),y(e,["generatedVideos"],r)}const s=g(t,["raiMediaFilteredCount"]);s!=null&&y(e,["raiMediaFilteredCount"],s);const o=g(t,["raiMediaFilteredReasons"]);return o!=null&&y(e,["raiMediaFilteredReasons"],o),e}function a7(t){const e={},n=g(t,["name"]);n!=null&&y(e,["name"],n);const s=g(t,["metadata"]);s!=null&&y(e,["metadata"],s);const o=g(t,["done"]);o!=null&&y(e,["done"],o);const r=g(t,["error"]);r!=null&&y(e,["error"],r);const i=g(t,["response"]);return i!=null&&y(e,["response"],i7(i)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var aM;(function(t){t.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",t.OUTCOME_OK="OUTCOME_OK",t.OUTCOME_FAILED="OUTCOME_FAILED",t.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(aM||(aM={}));var lM;(function(t){t.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",t.PYTHON="PYTHON"})(lM||(lM={}));var Gr;(function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.STRING="STRING",t.NUMBER="NUMBER",t.INTEGER="INTEGER",t.BOOLEAN="BOOLEAN",t.ARRAY="ARRAY",t.OBJECT="OBJECT",t.NULL="NULL"})(Gr||(Gr={}));var uM;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",t.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",t.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",t.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",t.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT"})(uM||(uM={}));var cM;(function(t){t.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",t.SEVERITY="SEVERITY",t.PROBABILITY="PROBABILITY"})(cM||(cM={}));var dM;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE",t.OFF="OFF"})(dM||(dM={}));var fM;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(fM||(fM={}));var hM;(function(t){t.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",t.NO_AUTH="NO_AUTH",t.API_KEY_AUTH="API_KEY_AUTH",t.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",t.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",t.OAUTH="OAUTH",t.OIDC_AUTH="OIDC_AUTH"})(hM||(hM={}));var pM;(function(t){t.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",t.SIMPLE_SEARCH="SIMPLE_SEARCH",t.ELASTIC_SEARCH="ELASTIC_SEARCH"})(pM||(pM={}));var mM;(function(t){t.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",t.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",t.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",t.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",t.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(mM||(mM={}));var gM;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.IMAGE_SAFETY="IMAGE_SAFETY",t.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL"})(gM||(gM={}));var yM;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(yM||(yM={}));var xM;(function(t){t.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",t.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",t.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",t.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",t.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(xM||(xM={}));var vM;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.IMAGE_SAFETY="IMAGE_SAFETY"})(vM||(vM={}));var bM;(function(t){t.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",t.ON_DEMAND="ON_DEMAND",t.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(bM||(bM={}));var Bc;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.AUDIO="AUDIO"})(Bc||(Bc={}));var wM;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(wM||(wM={}));var $T;(function(t){t.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",t.JOB_STATE_QUEUED="JOB_STATE_QUEUED",t.JOB_STATE_PENDING="JOB_STATE_PENDING",t.JOB_STATE_RUNNING="JOB_STATE_RUNNING",t.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",t.JOB_STATE_FAILED="JOB_STATE_FAILED",t.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",t.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",t.JOB_STATE_PAUSED="JOB_STATE_PAUSED",t.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",t.JOB_STATE_UPDATING="JOB_STATE_UPDATING",t.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})($T||($T={}));var CM;(function(t){t.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",t.TUNING_MODE_FULL="TUNING_MODE_FULL",t.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(CM||(CM={}));var TM;(function(t){t.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",t.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",t.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",t.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",t.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",t.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",t.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(TM||(TM={}));var SM;(function(t){t.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",t.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",t.BALANCED="BALANCED",t.PRIORITIZE_COST="PRIORITIZE_COST"})(SM||(SM={}));var NM;(function(t){t.UNSPECIFIED="UNSPECIFIED",t.BLOCKING="BLOCKING",t.NON_BLOCKING="NON_BLOCKING"})(NM||(NM={}));var EM;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(EM||(EM={}));var IM;(function(t){t.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",t.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(IM||(IM={}));var kM;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE",t.VALIDATED="VALIDATED"})(kM||(kM={}));var AM;(function(t){t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(AM||(AM={}));var RM;(function(t){t.DONT_ALLOW="DONT_ALLOW",t.ALLOW_ADULT="ALLOW_ADULT",t.ALLOW_ALL="ALLOW_ALL"})(RM||(RM={}));var $M;(function(t){t.auto="auto",t.en="en",t.ja="ja",t.ko="ko",t.hi="hi",t.zh="zh",t.pt="pt",t.es="es"})($M||($M={}));var DM;(function(t){t.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",t.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",t.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",t.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",t.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(DM||(DM={}));var _M;(function(t){t.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",t.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",t.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",t.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(_M||(_M={}));var MM;(function(t){t.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",t.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",t.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",t.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(MM||(MM={}));var FM;(function(t){t.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",t.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",t.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",t.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",t.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",t.EDIT_MODE_STYLE="EDIT_MODE_STYLE",t.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",t.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(FM||(FM={}));var OM;(function(t){t.FOREGROUND="FOREGROUND",t.BACKGROUND="BACKGROUND",t.PROMPT="PROMPT",t.SEMANTIC="SEMANTIC",t.INTERACTIVE="INTERACTIVE"})(OM||(OM={}));var PM;(function(t){t.ASSET="ASSET",t.STYLE="STYLE"})(PM||(PM={}));var LM;(function(t){t.OPTIMIZED="OPTIMIZED",t.LOSSLESS="LOSSLESS"})(LM||(LM={}));var VM;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.PROCESSING="PROCESSING",t.ACTIVE="ACTIVE",t.FAILED="FAILED"})(VM||(VM={}));var zM;(function(t){t.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",t.UPLOADED="UPLOADED",t.GENERATED="GENERATED"})(zM||(zM={}));var BM;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.VIDEO="VIDEO",t.AUDIO="AUDIO",t.DOCUMENT="DOCUMENT"})(BM||(BM={}));var UM;(function(t){t.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",t.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",t.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(UM||(UM={}));var GM;(function(t){t.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",t.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",t.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(GM||(GM={}));var HM;(function(t){t.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",t.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",t.NO_INTERRUPTION="NO_INTERRUPTION"})(HM||(HM={}));var WM;(function(t){t.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",t.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",t.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(WM||(WM={}));var qM;(function(t){t.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",t.SILENT="SILENT",t.WHEN_IDLE="WHEN_IDLE",t.INTERRUPT="INTERRUPT"})(qM||(qM={}));var KM;(function(t){t.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",t.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",t.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",t.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",t.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",t.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",t.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",t.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",t.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",t.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",t.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",t.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",t.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(KM||(KM={}));var XM;(function(t){t.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",t.QUALITY="QUALITY",t.DIVERSITY="DIVERSITY",t.VOCALIZATION="VOCALIZATION"})(XM||(XM={}));var Rc;(function(t){t.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",t.PLAY="PLAY",t.PAUSE="PAUSE",t.STOP="STOP",t.RESET_CONTEXT="RESET_CONTEXT"})(Rc||(Rc={}));class DT{constructor(e){const n={};for(const s of e.headers.entries())n[s[0]]=s[1];this.headers=n,this.responseInternal=e}json(){return this.responseInternal.json()}}class kh{get text(){var e,n,s,o,r,i,a,l;if(((o=(s=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||s===void 0?void 0:s.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let u="",d=!1;const h=[];for(const p of(l=(a=(i=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||i===void 0?void 0:i.content)===null||a===void 0?void 0:a.parts)!==null&&l!==void 0?l:[]){for(const[x,b]of Object.entries(p))x!=="text"&&x!=="thought"&&(b!==null||b!==void 0)&&h.push(x);if(typeof p.text=="string"){if(typeof p.thought=="boolean"&&p.thought)continue;d=!0,u+=p.text}}return h.length>0&&console.warn(`there are non-text parts ${h} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),d?u:void 0}get data(){var e,n,s,o,r,i,a,l;if(((o=(s=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||s===void 0?void 0:s.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let u="";const d=[];for(const h of(l=(a=(i=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||i===void 0?void 0:i.content)===null||a===void 0?void 0:a.parts)!==null&&l!==void 0?l:[]){for(const[p,x]of Object.entries(h))p!=="inlineData"&&(x!==null||x!==void 0)&&d.push(p);h.inlineData&&typeof h.inlineData.data=="string"&&(u+=atob(h.inlineData.data))}return d.length>0&&console.warn(`there are non-data parts ${d} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),u.length>0?btoa(u):void 0}get functionCalls(){var e,n,s,o,r,i,a,l;if(((o=(s=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||s===void 0?void 0:s.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const u=(l=(a=(i=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||i===void 0?void 0:i.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(d=>d.functionCall).map(d=>d.functionCall).filter(d=>d!==void 0);if((u==null?void 0:u.length)!==0)return u}get executableCode(){var e,n,s,o,r,i,a,l,u;if(((o=(s=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||s===void 0?void 0:s.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const d=(l=(a=(i=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||i===void 0?void 0:i.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(h=>h.executableCode).map(h=>h.executableCode).filter(h=>h!==void 0);if((d==null?void 0:d.length)!==0)return(u=d==null?void 0:d[0])===null||u===void 0?void 0:u.code}get codeExecutionResult(){var e,n,s,o,r,i,a,l,u;if(((o=(s=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||s===void 0?void 0:s.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const d=(l=(a=(i=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||i===void 0?void 0:i.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(h=>h.codeExecutionResult).map(h=>h.codeExecutionResult).filter(h=>h!==void 0);if((d==null?void 0:d.length)!==0)return(u=d==null?void 0:d[0])===null||u===void 0?void 0:u.output}}class YM{}class JM{}class l7{}class u7{}class c7{}class d7{}class jM{}class ZM{}class QM{}class f7{}class z0{_fromAPIResponse({apiResponse:e,isVertexAI:n}){const s=new z0;let o;const r=e;return n?o=a7(r):o=s7(r),Object.assign(s,o),s}}class eF{}class tF{}class nF{}class h7{}class p7{}class m7{}class sF{}class g7{get text(){var e,n,s;let o="",r=!1;const i=[];for(const a of(s=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&s!==void 0?s:[]){for(const[l,u]of Object.entries(a))l!=="text"&&l!=="thought"&&u!==null&&i.push(l);if(typeof a.text=="string"){if(typeof a.thought=="boolean"&&a.thought)continue;r=!0,o+=a.text}}return i.length>0&&console.warn(`there are non-text parts ${i} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),r?o:void 0}get data(){var e,n,s;let o="";const r=[];for(const i of(s=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&s!==void 0?s:[]){for(const[a,l]of Object.entries(i))a!=="inlineData"&&l!==null&&r.push(a);i.inlineData&&typeof i.inlineData.data=="string"&&(o+=atob(i.inlineData.data))}return r.length>0&&console.warn(`there are non-data parts ${r} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),o.length>0?btoa(o):void 0}}class y7{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Et(t,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(t.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const n=e.split("/",2);return`publishers/${n[0]}/models/${n[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function S3(t,e){const n=Et(t,e);return n?n.startsWith("publishers/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}`:n.startsWith("models/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/publishers/google/${n}`:n:""}function N3(t){return Array.isArray(t)?t.map(e=>B0(e)):[B0(t)]}function B0(t){if(typeof t=="object"&&t!==null)return t;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof t}`)}function E3(t){const e=B0(t);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function I3(t){const e=B0(t);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function oF(t){if(t==null)throw new Error("PartUnion is required");if(typeof t=="object")return t;if(typeof t=="string")return{text:t};throw new Error(`Unsupported part type: ${typeof t}`)}function k3(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(e=>oF(e)):[oF(t)]}function _T(t){return t!=null&&typeof t=="object"&&"parts"in t&&Array.isArray(t.parts)}function rF(t){return t!=null&&typeof t=="object"&&"functionCall"in t}function iF(t){return t!=null&&typeof t=="object"&&"functionResponse"in t}function _s(t){if(t==null)throw new Error("ContentUnion is required");return _T(t)?t:{role:"user",parts:k3(t)}}function RN(t,e){if(!e)return[];if(t.isVertexAI()&&Array.isArray(e))return e.flatMap(n=>{const s=_s(n);return s.parts&&s.parts.length>0&&s.parts[0].text!==void 0?[s.parts[0].text]:[]});if(t.isVertexAI()){const n=_s(e);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]}return Array.isArray(e)?e.map(n=>_s(n)):[_s(e)]}function tr(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("contents are required");if(!Array.isArray(t)){if(rF(t)||iF(t))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[_s(t)]}const e=[],n=[],s=_T(t[0]);for(const o of t){const r=_T(o);if(r!=s)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(r)e.push(o);else{if(rF(o)||iF(o))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(o)}}return s||e.push({role:"user",parts:k3(n)}),e}function x7(t,e){t.includes("null")&&(e.nullable=!0);const n=t.filter(s=>s!=="null");if(n.length===1)e.type=Object.values(Gr).includes(n[0].toUpperCase())?n[0].toUpperCase():Gr.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const s of n)e.anyOf.push({type:Object.values(Gr).includes(s.toUpperCase())?s.toUpperCase():Gr.TYPE_UNSPECIFIED})}}function Dc(t){const e={},n=["items"],s=["anyOf"],o=["properties"];if(t.type&&t.anyOf)throw new Error("type and anyOf cannot be both populated.");const r=t.anyOf;r!=null&&r.length==2&&(r[0].type==="null"?(e.nullable=!0,t=r[1]):r[1].type==="null"&&(e.nullable=!0,t=r[0])),t.type instanceof Array&&x7(t.type,e);for(const[i,a]of Object.entries(t))if(a!=null)if(i=="type"){if(a==="null")throw new Error("type: null can not be the only possible type for the field.");if(a instanceof Array)continue;e.type=Object.values(Gr).includes(a.toUpperCase())?a.toUpperCase():Gr.TYPE_UNSPECIFIED}else if(n.includes(i))e[i]=Dc(a);else if(s.includes(i)){const l=[];for(const u of a){if(u.type=="null"){e.nullable=!0;continue}l.push(Dc(u))}e[i]=l}else if(o.includes(i)){const l={};for(const[u,d]of Object.entries(a))l[u]=Dc(d);e[i]=l}else{if(i==="additionalProperties")continue;e[i]=a}return e}function $N(t){return Dc(t)}function DN(t){if(typeof t=="object")return t;if(typeof t=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error(`Unsupported speechConfig type: ${typeof t}`)}function _N(t){if("multiSpeakerVoiceConfig"in t)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return t}function id(t){if(t.functionDeclarations)for(const e of t.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=Dc(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=Dc(e.response));return t}function ad(t){if(t==null)throw new Error("tools is required");if(!Array.isArray(t))throw new Error("tools is required and must be an array of Tools");const e=[];for(const n of t)e.push(n);return e}function v7(t,e,n,s=1){const o=!e.startsWith(`${n}/`)&&e.split("/").length===s;return t.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${t.getProject()}/${e}`:e.startsWith(`${n}/`)?`projects/${t.getProject()}/locations/${t.getLocation()}/${e}`:o?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}/${e}`:e:o?`${n}/${e}`:e}function Ui(t,e){if(typeof e!="string")throw new Error("name must be a string");return v7(t,e,"cachedContents")}function A3(t){switch(t){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return t}}function yu(t){return AN(t)}function b7(t){return t!=null&&typeof t=="object"&&"name"in t}function w7(t){return t!=null&&typeof t=="object"&&"video"in t}function C7(t){return t!=null&&typeof t=="object"&&"uri"in t}function R3(t){var e;let n;if(b7(t)&&(n=t.name),!(C7(t)&&(n=t.uri,n===void 0))&&!(w7(t)&&(n=(e=t.video)===null||e===void 0?void 0:e.uri,n===void 0))){if(typeof t=="string"&&(n=t),n===void 0)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){const o=n.split("files/")[1].match(/[a-z0-9]+/);if(o===null)throw new Error(`Could not extract file name from URI ${n}`);n=o[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function $3(t,e){let n;return t.isVertexAI()?n=e?"publishers/google/models":"models":n=e?"models":"tunedModels",n}function D3(t){for(const e of["models","tunedModels","publisherModels"])if(T7(t,e))return t[e];return[]}function T7(t,e){return t!==null&&typeof t=="object"&&e in t}function S7(t,e={}){const n=t,s={name:n.name,description:n.description,parametersJsonSchema:n.inputSchema};return n.outputSchema&&(s.responseJsonSchema=n.outputSchema),e.behavior&&(s.behavior=e.behavior),{functionDeclarations:[s]}}function N7(t,e={}){const n=[],s=new Set;for(const o of t){const r=o.name;if(s.has(r))throw new Error(`Duplicate function name ${r} found in MCP tools. Please ensure function names are unique.`);s.add(r);const i=S7(o,e);i.functionDeclarations&&n.push(...i.functionDeclarations)}return{functionDeclarations:n}}function _3(t,e){let n;if(typeof e=="string")if(t.isVertexAI())if(e.startsWith("gs://"))n={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))n={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))n={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(t.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:e}}else n=e;const s=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,o=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(t.isVertexAI()){if(o>0||s!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(s>0||o!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function E7(t){if(typeof t!="string")return t;const e=t;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function M3(t){if(typeof t!="object"||t===null)return{};const e=t,n=e.inlinedResponses;if(typeof n!="object"||n===null)return t;const o=n.inlinedResponses;if(!Array.isArray(o)||o.length===0)return t;let r=!1;for(const i of o){if(typeof i!="object"||i===null)continue;const l=i.response;if(typeof l!="object"||l===null)continue;if(l.embedding!==void 0){r=!0;break}}return r&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),t}function ld(t,e){const n=e;if(!t.isVertexAI()){if(/batches\/[^/]+$/.test(n))return n.split("/").pop();throw new Error(`Invalid batch job name: ${n}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(n))return n.split("/").pop();if(/^\d+$/.test(n))return n;throw new Error(`Invalid batch job name: ${n}.`)}function F3(t){const e=t;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function I7(t){const e={},n=g(t,["fps"]);n!=null&&y(e,["fps"],n);const s=g(t,["endOffset"]);s!=null&&y(e,["endOffset"],s);const o=g(t,["startOffset"]);return o!=null&&y(e,["startOffset"],o),e}function k7(t){const e={};if(g(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=g(t,["data"]);n!=null&&y(e,["data"],n);const s=g(t,["mimeType"]);return s!=null&&y(e,["mimeType"],s),e}function A7(t){const e={};if(g(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=g(t,["fileUri"]);n!=null&&y(e,["fileUri"],n);const s=g(t,["mimeType"]);return s!=null&&y(e,["mimeType"],s),e}function R7(t){const e={},n=g(t,["id"]);n!=null&&y(e,["id"],n);const s=g(t,["args"]);s!=null&&y(e,["args"],s);const o=g(t,["name"]);return o!=null&&y(e,["name"],o),e}function $7(t){const e={},n=g(t,["videoMetadata"]);n!=null&&y(e,["videoMetadata"],I7(n));const s=g(t,["thought"]);s!=null&&y(e,["thought"],s);const o=g(t,["inlineData"]);o!=null&&y(e,["inlineData"],k7(o));const r=g(t,["fileData"]);r!=null&&y(e,["fileData"],A7(r));const i=g(t,["thoughtSignature"]);i!=null&&y(e,["thoughtSignature"],i);const a=g(t,["functionCall"]);a!=null&&y(e,["functionCall"],R7(a));const l=g(t,["codeExecutionResult"]);l!=null&&y(e,["codeExecutionResult"],l);const u=g(t,["executableCode"]);u!=null&&y(e,["executableCode"],u);const d=g(t,["functionResponse"]);d!=null&&y(e,["functionResponse"],d);const h=g(t,["text"]);return h!=null&&y(e,["text"],h),e}function O3(t){const e={},n=g(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>$7(r))),y(e,["parts"],o)}const s=g(t,["role"]);return s!=null&&y(e,["role"],s),e}function D7(t){const e={},n=g(t,["anyOf"]);n!=null&&y(e,["anyOf"],n);const s=g(t,["default"]);s!=null&&y(e,["default"],s);const o=g(t,["description"]);o!=null&&y(e,["description"],o);const r=g(t,["enum"]);r!=null&&y(e,["enum"],r);const i=g(t,["example"]);i!=null&&y(e,["example"],i);const a=g(t,["format"]);a!=null&&y(e,["format"],a);const l=g(t,["items"]);l!=null&&y(e,["items"],l);const u=g(t,["maxItems"]);u!=null&&y(e,["maxItems"],u);const d=g(t,["maxLength"]);d!=null&&y(e,["maxLength"],d);const h=g(t,["maxProperties"]);h!=null&&y(e,["maxProperties"],h);const p=g(t,["maximum"]);p!=null&&y(e,["maximum"],p);const x=g(t,["minItems"]);x!=null&&y(e,["minItems"],x);const b=g(t,["minLength"]);b!=null&&y(e,["minLength"],b);const w=g(t,["minProperties"]);w!=null&&y(e,["minProperties"],w);const C=g(t,["minimum"]);C!=null&&y(e,["minimum"],C);const T=g(t,["nullable"]);T!=null&&y(e,["nullable"],T);const N=g(t,["pattern"]);N!=null&&y(e,["pattern"],N);const I=g(t,["properties"]);I!=null&&y(e,["properties"],I);const k=g(t,["propertyOrdering"]);k!=null&&y(e,["propertyOrdering"],k);const A=g(t,["required"]);A!=null&&y(e,["required"],A);const $=g(t,["title"]);$!=null&&y(e,["title"],$);const M=g(t,["type"]);return M!=null&&y(e,["type"],M),e}function _7(t){const e={};if(g(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const n=g(t,["category"]);n!=null&&y(e,["category"],n);const s=g(t,["threshold"]);return s!=null&&y(e,["threshold"],s),e}function M7(t){const e={},n=g(t,["behavior"]);n!=null&&y(e,["behavior"],n);const s=g(t,["description"]);s!=null&&y(e,["description"],s);const o=g(t,["name"]);o!=null&&y(e,["name"],o);const r=g(t,["parameters"]);r!=null&&y(e,["parameters"],r);const i=g(t,["parametersJsonSchema"]);i!=null&&y(e,["parametersJsonSchema"],i);const a=g(t,["response"]);a!=null&&y(e,["response"],a);const l=g(t,["responseJsonSchema"]);return l!=null&&y(e,["responseJsonSchema"],l),e}function F7(t){const e={},n=g(t,["startTime"]);n!=null&&y(e,["startTime"],n);const s=g(t,["endTime"]);return s!=null&&y(e,["endTime"],s),e}function O7(t){const e={},n=g(t,["timeRangeFilter"]);if(n!=null&&y(e,["timeRangeFilter"],F7(n)),g(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function P7(t){const e={},n=g(t,["mode"]);n!=null&&y(e,["mode"],n);const s=g(t,["dynamicThreshold"]);return s!=null&&y(e,["dynamicThreshold"],s),e}function L7(t){const e={},n=g(t,["dynamicRetrievalConfig"]);return n!=null&&y(e,["dynamicRetrievalConfig"],P7(n)),e}function V7(){return{}}function z7(t){const e={},n=g(t,["environment"]);return n!=null&&y(e,["environment"],n),e}function B7(t){const e={},n=g(t,["functionDeclarations"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(u=>M7(u))),y(e,["functionDeclarations"],l)}if(g(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=g(t,["googleSearch"]);s!=null&&y(e,["googleSearch"],O7(s));const o=g(t,["googleSearchRetrieval"]);if(o!=null&&y(e,["googleSearchRetrieval"],L7(o)),g(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(g(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");g(t,["urlContext"])!=null&&y(e,["urlContext"],V7());const i=g(t,["computerUse"]);i!=null&&y(e,["computerUse"],z7(i));const a=g(t,["codeExecution"]);return a!=null&&y(e,["codeExecution"],a),e}function U7(t){const e={},n=g(t,["mode"]);n!=null&&y(e,["mode"],n);const s=g(t,["allowedFunctionNames"]);return s!=null&&y(e,["allowedFunctionNames"],s),e}function G7(t){const e={},n=g(t,["latitude"]);n!=null&&y(e,["latitude"],n);const s=g(t,["longitude"]);return s!=null&&y(e,["longitude"],s),e}function H7(t){const e={},n=g(t,["latLng"]);n!=null&&y(e,["latLng"],G7(n));const s=g(t,["languageCode"]);return s!=null&&y(e,["languageCode"],s),e}function W7(t){const e={},n=g(t,["functionCallingConfig"]);n!=null&&y(e,["functionCallingConfig"],U7(n));const s=g(t,["retrievalConfig"]);return s!=null&&y(e,["retrievalConfig"],H7(s)),e}function q7(t){const e={},n=g(t,["voiceName"]);return n!=null&&y(e,["voiceName"],n),e}function P3(t){const e={},n=g(t,["prebuiltVoiceConfig"]);return n!=null&&y(e,["prebuiltVoiceConfig"],q7(n)),e}function K7(t){const e={},n=g(t,["speaker"]);n!=null&&y(e,["speaker"],n);const s=g(t,["voiceConfig"]);return s!=null&&y(e,["voiceConfig"],P3(s)),e}function X7(t){const e={},n=g(t,["speakerVoiceConfigs"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>K7(o))),y(e,["speakerVoiceConfigs"],s)}return e}function Y7(t){const e={},n=g(t,["voiceConfig"]);n!=null&&y(e,["voiceConfig"],P3(n));const s=g(t,["multiSpeakerVoiceConfig"]);s!=null&&y(e,["multiSpeakerVoiceConfig"],X7(s));const o=g(t,["languageCode"]);return o!=null&&y(e,["languageCode"],o),e}function J7(t){const e={},n=g(t,["includeThoughts"]);n!=null&&y(e,["includeThoughts"],n);const s=g(t,["thinkingBudget"]);return s!=null&&y(e,["thinkingBudget"],s),e}function j7(t,e,n){const s={},o=g(e,["systemInstruction"]);n!==void 0&&o!=null&&y(n,["systemInstruction"],O3(_s(o)));const r=g(e,["temperature"]);r!=null&&y(s,["temperature"],r);const i=g(e,["topP"]);i!=null&&y(s,["topP"],i);const a=g(e,["topK"]);a!=null&&y(s,["topK"],a);const l=g(e,["candidateCount"]);l!=null&&y(s,["candidateCount"],l);const u=g(e,["maxOutputTokens"]);u!=null&&y(s,["maxOutputTokens"],u);const d=g(e,["stopSequences"]);d!=null&&y(s,["stopSequences"],d);const h=g(e,["responseLogprobs"]);h!=null&&y(s,["responseLogprobs"],h);const p=g(e,["logprobs"]);p!=null&&y(s,["logprobs"],p);const x=g(e,["presencePenalty"]);x!=null&&y(s,["presencePenalty"],x);const b=g(e,["frequencyPenalty"]);b!=null&&y(s,["frequencyPenalty"],b);const w=g(e,["seed"]);w!=null&&y(s,["seed"],w);const C=g(e,["responseMimeType"]);C!=null&&y(s,["responseMimeType"],C);const T=g(e,["responseSchema"]);T!=null&&y(s,["responseSchema"],D7($N(T)));const N=g(e,["responseJsonSchema"]);if(N!=null&&y(s,["responseJsonSchema"],N),g(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(g(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const I=g(e,["safetySettings"]);if(n!==void 0&&I!=null){let D=I;Array.isArray(D)&&(D=D.map(H=>_7(H))),y(n,["safetySettings"],D)}const k=g(e,["tools"]);if(n!==void 0&&k!=null){let D=ad(k);Array.isArray(D)&&(D=D.map(H=>B7(id(H)))),y(n,["tools"],D)}const A=g(e,["toolConfig"]);if(n!==void 0&&A!=null&&y(n,["toolConfig"],W7(A)),g(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const $=g(e,["cachedContent"]);n!==void 0&&$!=null&&y(n,["cachedContent"],Ui(t,$));const M=g(e,["responseModalities"]);M!=null&&y(s,["responseModalities"],M);const O=g(e,["mediaResolution"]);O!=null&&y(s,["mediaResolution"],O);const F=g(e,["speechConfig"]);if(F!=null&&y(s,["speechConfig"],Y7(DN(F))),g(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const P=g(e,["thinkingConfig"]);return P!=null&&y(s,["thinkingConfig"],J7(P)),s}function Z7(t,e){const n={},s=g(e,["model"]);s!=null&&y(n,["request","model"],Et(t,s));const o=g(e,["contents"]);if(o!=null){let i=tr(o);Array.isArray(i)&&(i=i.map(a=>O3(a))),y(n,["request","contents"],i)}const r=g(e,["config"]);return r!=null&&y(n,["request","generationConfig"],j7(t,r,n)),n}function Q7(t,e){const n={};if(g(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(g(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(g(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const s=g(e,["fileName"]);s!=null&&y(n,["fileName"],s);const o=g(e,["inlinedRequests"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(i=>Z7(t,i))),y(n,["requests","requests"],r)}return n}function e9(t,e){const n={},s=g(t,["displayName"]);if(e!==void 0&&s!=null&&y(e,["batch","displayName"],s),g(t,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return n}function FC(t,e){const n={},s=g(e,["model"]);s!=null&&y(n,["_url","model"],Et(t,s));const o=g(e,["src"]);o!=null&&y(n,["batch","inputConfig"],Q7(t,_3(t,o)));const r=g(e,["config"]);return r!=null&&y(n,["config"],e9(r,n)),n}function t9(t,e){const n={},s=g(t,["taskType"]);e!==void 0&&s!=null&&y(e,["requests[]","taskType"],s);const o=g(t,["title"]);e!==void 0&&o!=null&&y(e,["requests[]","title"],o);const r=g(t,["outputDimensionality"]);if(e!==void 0&&r!=null&&y(e,["requests[]","outputDimensionality"],r),g(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(g(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function n9(t,e){const n={},s=g(e,["contents"]);s!=null&&y(n,["requests[]","request","content"],RN(t,s));const o=g(e,["config"]);return o!=null&&y(n,["config"],t9(o,n)),n}function s9(t,e){const n={},s=g(e,["fileName"]);s!=null&&y(n,["file_name"],s);const o=g(e,["inlinedRequests"]);return o!=null&&y(n,["requests"],n9(t,o)),n}function o9(t,e){const n={},s=g(t,["displayName"]);return e!==void 0&&s!=null&&y(e,["batch","displayName"],s),n}function OC(t,e){const n={},s=g(e,["model"]);s!=null&&y(n,["_url","model"],Et(t,s));const o=g(e,["src"]);o!=null&&y(n,["batch","inputConfig"],s9(t,o));const r=g(e,["config"]);return r!=null&&y(n,["config"],o9(r,n)),n}function r9(t,e){const n={},s=g(e,["name"]);s!=null&&y(n,["_url","name"],ld(t,s));const o=g(e,["config"]);return o!=null&&y(n,["config"],o),n}function i9(t,e){const n={},s=g(e,["name"]);s!=null&&y(n,["_url","name"],ld(t,s));const o=g(e,["config"]);return o!=null&&y(n,["config"],o),n}function a9(t,e){const n={},s=g(t,["pageSize"]);e!==void 0&&s!=null&&y(e,["_query","pageSize"],s);const o=g(t,["pageToken"]);if(e!==void 0&&o!=null&&y(e,["_query","pageToken"],o),g(t,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return n}function l9(t){const e={},n=g(t,["config"]);return n!=null&&y(e,["config"],a9(n,e)),e}function u9(t,e){const n={},s=g(e,["name"]);s!=null&&y(n,["_url","name"],ld(t,s));const o=g(e,["config"]);return o!=null&&y(n,["config"],o),n}function c9(t){const e={},n=g(t,["format"]);n!=null&&y(e,["instancesFormat"],n);const s=g(t,["gcsUri"]);s!=null&&y(e,["gcsSource","uris"],s);const o=g(t,["bigqueryUri"]);if(o!=null&&y(e,["bigquerySource","inputUri"],o),g(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(g(t,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function d9(t){const e={},n=g(t,["format"]);n!=null&&y(e,["predictionsFormat"],n);const s=g(t,["gcsUri"]);s!=null&&y(e,["gcsDestination","outputUriPrefix"],s);const o=g(t,["bigqueryUri"]);if(o!=null&&y(e,["bigqueryDestination","outputUri"],o),g(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(g(t,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(g(t,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function f9(t,e){const n={},s=g(t,["displayName"]);e!==void 0&&s!=null&&y(e,["displayName"],s);const o=g(t,["dest"]);return e!==void 0&&o!=null&&y(e,["outputConfig"],d9(E7(o))),n}function h9(t,e){const n={},s=g(e,["model"]);s!=null&&y(n,["model"],Et(t,s));const o=g(e,["src"]);o!=null&&y(n,["inputConfig"],c9(_3(t,o)));const r=g(e,["config"]);return r!=null&&y(n,["config"],f9(r,n)),n}function p9(t,e){const n={},s=g(e,["name"]);s!=null&&y(n,["_url","name"],ld(t,s));const o=g(e,["config"]);return o!=null&&y(n,["config"],o),n}function m9(t,e){const n={},s=g(e,["name"]);s!=null&&y(n,["_url","name"],ld(t,s));const o=g(e,["config"]);return o!=null&&y(n,["config"],o),n}function g9(t,e){const n={},s=g(t,["pageSize"]);e!==void 0&&s!=null&&y(e,["_query","pageSize"],s);const o=g(t,["pageToken"]);e!==void 0&&o!=null&&y(e,["_query","pageToken"],o);const r=g(t,["filter"]);return e!==void 0&&r!=null&&y(e,["_query","filter"],r),n}function y9(t){const e={},n=g(t,["config"]);return n!=null&&y(e,["config"],g9(n,e)),e}function x9(t,e){const n={},s=g(e,["name"]);s!=null&&y(n,["_url","name"],ld(t,s));const o=g(e,["config"]);return o!=null&&y(n,["config"],o),n}function v9(t){const e={},n=g(t,["fps"]);n!=null&&y(e,["fps"],n);const s=g(t,["endOffset"]);s!=null&&y(e,["endOffset"],s);const o=g(t,["startOffset"]);return o!=null&&y(e,["startOffset"],o),e}function b9(t){const e={},n=g(t,["data"]);n!=null&&y(e,["data"],n);const s=g(t,["mimeType"]);return s!=null&&y(e,["mimeType"],s),e}function w9(t){const e={},n=g(t,["fileUri"]);n!=null&&y(e,["fileUri"],n);const s=g(t,["mimeType"]);return s!=null&&y(e,["mimeType"],s),e}function C9(t){const e={},n=g(t,["id"]);n!=null&&y(e,["id"],n);const s=g(t,["args"]);s!=null&&y(e,["args"],s);const o=g(t,["name"]);return o!=null&&y(e,["name"],o),e}function T9(t){const e={},n=g(t,["videoMetadata"]);n!=null&&y(e,["videoMetadata"],v9(n));const s=g(t,["thought"]);s!=null&&y(e,["thought"],s);const o=g(t,["inlineData"]);o!=null&&y(e,["inlineData"],b9(o));const r=g(t,["fileData"]);r!=null&&y(e,["fileData"],w9(r));const i=g(t,["thoughtSignature"]);i!=null&&y(e,["thoughtSignature"],i);const a=g(t,["functionCall"]);a!=null&&y(e,["functionCall"],C9(a));const l=g(t,["codeExecutionResult"]);l!=null&&y(e,["codeExecutionResult"],l);const u=g(t,["executableCode"]);u!=null&&y(e,["executableCode"],u);const d=g(t,["functionResponse"]);d!=null&&y(e,["functionResponse"],d);const h=g(t,["text"]);return h!=null&&y(e,["text"],h),e}function S9(t){const e={},n=g(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>T9(r))),y(e,["parts"],o)}const s=g(t,["role"]);return s!=null&&y(e,["role"],s),e}function N9(t){const e={},n=g(t,["citationSources"]);return n!=null&&y(e,["citations"],n),e}function E9(t){const e={},n=g(t,["retrievedUrl"]);n!=null&&y(e,["retrievedUrl"],n);const s=g(t,["urlRetrievalStatus"]);return s!=null&&y(e,["urlRetrievalStatus"],s),e}function I9(t){const e={},n=g(t,["urlMetadata"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>E9(o))),y(e,["urlMetadata"],s)}return e}function k9(t){const e={},n=g(t,["content"]);n!=null&&y(e,["content"],S9(n));const s=g(t,["citationMetadata"]);s!=null&&y(e,["citationMetadata"],N9(s));const o=g(t,["tokenCount"]);o!=null&&y(e,["tokenCount"],o);const r=g(t,["finishReason"]);r!=null&&y(e,["finishReason"],r);const i=g(t,["urlContextMetadata"]);i!=null&&y(e,["urlContextMetadata"],I9(i));const a=g(t,["avgLogprobs"]);a!=null&&y(e,["avgLogprobs"],a);const l=g(t,["groundingMetadata"]);l!=null&&y(e,["groundingMetadata"],l);const u=g(t,["index"]);u!=null&&y(e,["index"],u);const d=g(t,["logprobsResult"]);d!=null&&y(e,["logprobsResult"],d);const h=g(t,["safetyRatings"]);return h!=null&&y(e,["safetyRatings"],h),e}function A9(t){const e={},n=g(t,["sdkHttpResponse"]);n!=null&&y(e,["sdkHttpResponse"],n);const s=g(t,["candidates"]);if(s!=null){let l=s;Array.isArray(l)&&(l=l.map(u=>k9(u))),y(e,["candidates"],l)}const o=g(t,["modelVersion"]);o!=null&&y(e,["modelVersion"],o);const r=g(t,["promptFeedback"]);r!=null&&y(e,["promptFeedback"],r);const i=g(t,["responseId"]);i!=null&&y(e,["responseId"],i);const a=g(t,["usageMetadata"]);return a!=null&&y(e,["usageMetadata"],a),e}function MN(t){const e={},n=g(t,["details"]);n!=null&&y(e,["details"],n);const s=g(t,["code"]);s!=null&&y(e,["code"],s);const o=g(t,["message"]);return o!=null&&y(e,["message"],o),e}function R9(t){const e={},n=g(t,["response"]);n!=null&&y(e,["response"],A9(n));const s=g(t,["error"]);return s!=null&&y(e,["error"],MN(s)),e}function $9(t){const e={},n=g(t,["values"]);return n!=null&&y(e,["values"],n),e}function D9(t){const e={},n=g(t,["embedding"]);n!=null&&y(e,["embedding"],$9(n));const s=g(t,["tokenCount"]);return s!=null&&y(e,["tokenCount"],s),e}function _9(t){const e={},n=g(t,["response"]);n!=null&&y(e,["response"],D9(n));const s=g(t,["error"]);return s!=null&&y(e,["error"],MN(s)),e}function M9(t){const e={},n=g(t,["responsesFile"]);n!=null&&y(e,["fileName"],n);const s=g(t,["inlinedResponses","inlinedResponses"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(i=>R9(i))),y(e,["inlinedResponses"],r)}const o=g(t,["inlinedEmbedContentResponses","inlinedResponses"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(i=>_9(i))),y(e,["inlinedEmbedContentResponses"],r)}return e}function Cc(t){const e={},n=g(t,["name"]);n!=null&&y(e,["name"],n);const s=g(t,["metadata","displayName"]);s!=null&&y(e,["displayName"],s);const o=g(t,["metadata","state"]);o!=null&&y(e,["state"],F3(o));const r=g(t,["metadata","createTime"]);r!=null&&y(e,["createTime"],r);const i=g(t,["metadata","endTime"]);i!=null&&y(e,["endTime"],i);const a=g(t,["metadata","updateTime"]);a!=null&&y(e,["updateTime"],a);const l=g(t,["metadata","model"]);l!=null&&y(e,["model"],l);const u=g(t,["metadata","output"]);return u!=null&&y(e,["dest"],M9(M3(u))),e}function F9(t){const e={},n=g(t,["sdkHttpResponse"]);n!=null&&y(e,["sdkHttpResponse"],n);const s=g(t,["nextPageToken"]);s!=null&&y(e,["nextPageToken"],s);const o=g(t,["operations"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(i=>Cc(i))),y(e,["batchJobs"],r)}return e}function O9(t){const e={},n=g(t,["sdkHttpResponse"]);n!=null&&y(e,["sdkHttpResponse"],n);const s=g(t,["name"]);s!=null&&y(e,["name"],s);const o=g(t,["done"]);o!=null&&y(e,["done"],o);const r=g(t,["error"]);return r!=null&&y(e,["error"],MN(r)),e}function L3(t){const e={},n=g(t,["details"]);n!=null&&y(e,["details"],n);const s=g(t,["code"]);s!=null&&y(e,["code"],s);const o=g(t,["message"]);return o!=null&&y(e,["message"],o),e}function P9(t){const e={},n=g(t,["instancesFormat"]);n!=null&&y(e,["format"],n);const s=g(t,["gcsSource","uris"]);s!=null&&y(e,["gcsUri"],s);const o=g(t,["bigquerySource","inputUri"]);return o!=null&&y(e,["bigqueryUri"],o),e}function L9(t){const e={},n=g(t,["predictionsFormat"]);n!=null&&y(e,["format"],n);const s=g(t,["gcsDestination","outputUriPrefix"]);s!=null&&y(e,["gcsUri"],s);const o=g(t,["bigqueryDestination","outputUri"]);return o!=null&&y(e,["bigqueryUri"],o),e}function MT(t){const e={},n=g(t,["name"]);n!=null&&y(e,["name"],n);const s=g(t,["displayName"]);s!=null&&y(e,["displayName"],s);const o=g(t,["state"]);o!=null&&y(e,["state"],F3(o));const r=g(t,["error"]);r!=null&&y(e,["error"],L3(r));const i=g(t,["createTime"]);i!=null&&y(e,["createTime"],i);const a=g(t,["startTime"]);a!=null&&y(e,["startTime"],a);const l=g(t,["endTime"]);l!=null&&y(e,["endTime"],l);const u=g(t,["updateTime"]);u!=null&&y(e,["updateTime"],u);const d=g(t,["model"]);d!=null&&y(e,["model"],d);const h=g(t,["inputConfig"]);h!=null&&y(e,["src"],P9(h));const p=g(t,["outputConfig"]);return p!=null&&y(e,["dest"],L9(M3(p))),e}function V9(t){const e={},n=g(t,["sdkHttpResponse"]);n!=null&&y(e,["sdkHttpResponse"],n);const s=g(t,["nextPageToken"]);s!=null&&y(e,["nextPageToken"],s);const o=g(t,["batchPredictionJobs"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(i=>MT(i))),y(e,["batchJobs"],r)}return e}function z9(t){const e={},n=g(t,["sdkHttpResponse"]);n!=null&&y(e,["sdkHttpResponse"],n);const s=g(t,["name"]);s!=null&&y(e,["name"],s);const o=g(t,["done"]);o!=null&&y(e,["done"],o);const r=g(t,["error"]);return r!=null&&y(e,["error"],L3(r)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var jl;(function(t){t.PAGED_ITEM_BATCH_JOBS="batchJobs",t.PAGED_ITEM_MODELS="models",t.PAGED_ITEM_TUNING_JOBS="tuningJobs",t.PAGED_ITEM_FILES="files",t.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(jl||(jl={}));class Vp{constructor(e,n,s,o){this.pageInternal=[],this.paramsInternal={},this.requestInternal=n,this.init(e,s,o)}init(e,n,s){var o,r;this.nameInternal=e,this.pageInternal=n[this.nameInternal]||[],this.sdkHttpResponseInternal=n==null?void 0:n.sdkHttpResponse,this.idxInternal=0;let i={config:{}};!s||Object.keys(s).length===0?i={config:{}}:typeof s=="object"?i=Object.assign({},s):i=s,i.config&&(i.config.pageToken=n.nextPageToken),this.paramsInternal=i,this.pageInternalSize=(r=(o=i.config)===null||o===void 0?void 0:o.pageSize)!==null&&r!==void 0?r:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class B9 extends gu{constructor(e){super(),this.apiClient=e,this.create=async n=>{var s,o;if(this.apiClient.isVertexAI())return n.config=this.formatDestination(n.src,n.config),this.createInternal(n);const r=n.src;if(!(Array.isArray(n.src)||r.inlinedRequests!==void 0))return this.createInternal(n);const a=this.createInlinedGenerateContentRequest(n),l=a.path,u=a.body,d=FC(this.apiClient,n)._query||{};return this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(s=n.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=n.config)===null||o===void 0?void 0:o.abortSignal}).then(p=>p.json()).then(p=>Cc(p))},this.createEmbeddings=async n=>{var s,o;if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");if(!(n.src.inlinedRequests!==void 0))return this.createEmbeddingsInternal(n);const a=this.createInlinedEmbedContentRequest(n),l=a.path,u=a.body,d=OC(this.apiClient,n)._query||{};return this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(s=n.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=n.config)===null||o===void 0?void 0:o.abortSignal}).then(p=>p.json()).then(p=>Cc(p))},this.list=async(n={})=>new Vp(jl.PAGED_ITEM_BATCH_JOBS,s=>this.listInternal(s),await this.listInternal(n),n)}createInlinedGenerateContentRequest(e){const n=FC(this.apiClient,e),s=n._url,o=Me("{model}:batchGenerateContent",s),a=n.batch.inputConfig.requests,l=a.requests,u=[];for(const d of l){const h=Object.assign({},d);if(h.systemInstruction){const p=h.systemInstruction;delete h.systemInstruction;const x=h.request;x.systemInstruction=p,h.request=x}u.push(h)}return a.requests=u,delete n.config,delete n._url,delete n._query,{path:o,body:n}}createInlinedEmbedContentRequest(e){const n=OC(this.apiClient,e),s=n._url,o=Me("{model}:asyncBatchEmbedContent",s),a=n.batch.inputConfig.requests,l=a.requests,u=[];delete a.config;for(const d of l){const h=Object.assign({},d),p=h.request;for(const x in h)x!=="request"&&(p[x]=h[x],delete h[x]);u.push(h)}return a.requests=u,delete n.config,delete n._url,delete n._query,{path:o,body:n}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,n){const s=n?Object.assign({},n):{},o=Date.now().toString();if(s.displayName||(s.displayName=`genaiBatchJob_${o}`),s.dest===void 0){const r=this.getGcsUri(e),i=this.getBigqueryUri(e);if(r)r.endsWith(".jsonl")?s.dest=`${r.slice(0,-6)}/dest`:s.dest=`${r}_dest_${o}`;else if(i)s.dest=`${i}_dest_${o}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return s}async createInternal(e){var n,s,o,r;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=h9(this.apiClient,e);return a=Me("batchPredictionJobs",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>MT(d))}else{const u=FC(this.apiClient,e);return a=Me("{model}:batchGenerateContent",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),i.then(d=>Cc(d))}}async createEmbeddingsInternal(e){var n,s;let o,r="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=OC(this.apiClient,e);return r=Me("{model}:asyncBatchEmbedContent",a._url),i=a._query,delete a.config,delete a._url,delete a._query,o=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json()),o.then(l=>Cc(l))}}async get(e){var n,s,o,r;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=p9(this.apiClient,e);return a=Me("batchPredictionJobs/{name}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>MT(d))}else{const u=r9(this.apiClient,e);return a=Me("batches/{name}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),i.then(d=>Cc(d))}}async cancel(e){var n,s,o,r;let i="",a={};if(this.apiClient.isVertexAI()){const l=m9(this.apiClient,e);i=Me("batchPredictionJobs/{name}:cancel",l._url),a=l._query,delete l.config,delete l._url,delete l._query,await this.apiClient.request({path:i,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}else{const l=i9(this.apiClient,e);i=Me("batches/{name}:cancel",l._url),a=l._query,delete l.config,delete l._url,delete l._query,await this.apiClient.request({path:i,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var n,s,o,r;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=y9(e);return a=Me("batchPredictionJobs",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json().then(h=>{const p=h;return p.sdkHttpResponse={headers:d.headers},p})),i.then(d=>{const h=V9(d),p=new sF;return Object.assign(p,h),p})}else{const u=l9(e);return a=Me("batches",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{const p=h;return p.sdkHttpResponse={headers:d.headers},p})),i.then(d=>{const h=F9(d),p=new sF;return Object.assign(p,h),p})}}async delete(e){var n,s,o,r;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=x9(this.apiClient,e);return a=Me("batchPredictionJobs/{name}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json().then(h=>{const p=h;return p.sdkHttpResponse={headers:d.headers},p})),i.then(d=>z9(d))}else{const u=u9(this.apiClient,e);return a=Me("batches/{name}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{const p=h;return p.sdkHttpResponse={headers:d.headers},p})),i.then(d=>O9(d))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function U9(t){const e={},n=g(t,["fps"]);n!=null&&y(e,["fps"],n);const s=g(t,["endOffset"]);s!=null&&y(e,["endOffset"],s);const o=g(t,["startOffset"]);return o!=null&&y(e,["startOffset"],o),e}function G9(t){const e={};if(g(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=g(t,["data"]);n!=null&&y(e,["data"],n);const s=g(t,["mimeType"]);return s!=null&&y(e,["mimeType"],s),e}function H9(t){const e={};if(g(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=g(t,["fileUri"]);n!=null&&y(e,["fileUri"],n);const s=g(t,["mimeType"]);return s!=null&&y(e,["mimeType"],s),e}function W9(t){const e={},n=g(t,["id"]);n!=null&&y(e,["id"],n);const s=g(t,["args"]);s!=null&&y(e,["args"],s);const o=g(t,["name"]);return o!=null&&y(e,["name"],o),e}function q9(t){const e={},n=g(t,["videoMetadata"]);n!=null&&y(e,["videoMetadata"],U9(n));const s=g(t,["thought"]);s!=null&&y(e,["thought"],s);const o=g(t,["inlineData"]);o!=null&&y(e,["inlineData"],G9(o));const r=g(t,["fileData"]);r!=null&&y(e,["fileData"],H9(r));const i=g(t,["thoughtSignature"]);i!=null&&y(e,["thoughtSignature"],i);const a=g(t,["functionCall"]);a!=null&&y(e,["functionCall"],W9(a));const l=g(t,["codeExecutionResult"]);l!=null&&y(e,["codeExecutionResult"],l);const u=g(t,["executableCode"]);u!=null&&y(e,["executableCode"],u);const d=g(t,["functionResponse"]);d!=null&&y(e,["functionResponse"],d);const h=g(t,["text"]);return h!=null&&y(e,["text"],h),e}function aF(t){const e={},n=g(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>q9(r))),y(e,["parts"],o)}const s=g(t,["role"]);return s!=null&&y(e,["role"],s),e}function K9(t){const e={},n=g(t,["behavior"]);n!=null&&y(e,["behavior"],n);const s=g(t,["description"]);s!=null&&y(e,["description"],s);const o=g(t,["name"]);o!=null&&y(e,["name"],o);const r=g(t,["parameters"]);r!=null&&y(e,["parameters"],r);const i=g(t,["parametersJsonSchema"]);i!=null&&y(e,["parametersJsonSchema"],i);const a=g(t,["response"]);a!=null&&y(e,["response"],a);const l=g(t,["responseJsonSchema"]);return l!=null&&y(e,["responseJsonSchema"],l),e}function X9(t){const e={},n=g(t,["startTime"]);n!=null&&y(e,["startTime"],n);const s=g(t,["endTime"]);return s!=null&&y(e,["endTime"],s),e}function Y9(t){const e={},n=g(t,["timeRangeFilter"]);if(n!=null&&y(e,["timeRangeFilter"],X9(n)),g(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function J9(t){const e={},n=g(t,["mode"]);n!=null&&y(e,["mode"],n);const s=g(t,["dynamicThreshold"]);return s!=null&&y(e,["dynamicThreshold"],s),e}function j9(t){const e={},n=g(t,["dynamicRetrievalConfig"]);return n!=null&&y(e,["dynamicRetrievalConfig"],J9(n)),e}function Z9(){return{}}function Q9(t){const e={},n=g(t,["environment"]);return n!=null&&y(e,["environment"],n),e}function eJ(t){const e={},n=g(t,["functionDeclarations"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(u=>K9(u))),y(e,["functionDeclarations"],l)}if(g(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=g(t,["googleSearch"]);s!=null&&y(e,["googleSearch"],Y9(s));const o=g(t,["googleSearchRetrieval"]);if(o!=null&&y(e,["googleSearchRetrieval"],j9(o)),g(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(g(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");g(t,["urlContext"])!=null&&y(e,["urlContext"],Z9());const i=g(t,["computerUse"]);i!=null&&y(e,["computerUse"],Q9(i));const a=g(t,["codeExecution"]);return a!=null&&y(e,["codeExecution"],a),e}function tJ(t){const e={},n=g(t,["mode"]);n!=null&&y(e,["mode"],n);const s=g(t,["allowedFunctionNames"]);return s!=null&&y(e,["allowedFunctionNames"],s),e}function nJ(t){const e={},n=g(t,["latitude"]);n!=null&&y(e,["latitude"],n);const s=g(t,["longitude"]);return s!=null&&y(e,["longitude"],s),e}function sJ(t){const e={},n=g(t,["latLng"]);n!=null&&y(e,["latLng"],nJ(n));const s=g(t,["languageCode"]);return s!=null&&y(e,["languageCode"],s),e}function oJ(t){const e={},n=g(t,["functionCallingConfig"]);n!=null&&y(e,["functionCallingConfig"],tJ(n));const s=g(t,["retrievalConfig"]);return s!=null&&y(e,["retrievalConfig"],sJ(s)),e}function rJ(t,e){const n={},s=g(t,["ttl"]);e!==void 0&&s!=null&&y(e,["ttl"],s);const o=g(t,["expireTime"]);e!==void 0&&o!=null&&y(e,["expireTime"],o);const r=g(t,["displayName"]);e!==void 0&&r!=null&&y(e,["displayName"],r);const i=g(t,["contents"]);if(e!==void 0&&i!=null){let d=tr(i);Array.isArray(d)&&(d=d.map(h=>aF(h))),y(e,["contents"],d)}const a=g(t,["systemInstruction"]);e!==void 0&&a!=null&&y(e,["systemInstruction"],aF(_s(a)));const l=g(t,["tools"]);if(e!==void 0&&l!=null){let d=l;Array.isArray(d)&&(d=d.map(h=>eJ(h))),y(e,["tools"],d)}const u=g(t,["toolConfig"]);if(e!==void 0&&u!=null&&y(e,["toolConfig"],oJ(u)),g(t,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return n}function iJ(t,e){const n={},s=g(e,["model"]);s!=null&&y(n,["model"],S3(t,s));const o=g(e,["config"]);return o!=null&&y(n,["config"],rJ(o,n)),n}function aJ(t,e){const n={},s=g(e,["name"]);s!=null&&y(n,["_url","name"],Ui(t,s));const o=g(e,["config"]);return o!=null&&y(n,["config"],o),n}function lJ(t,e){const n={},s=g(e,["name"]);s!=null&&y(n,["_url","name"],Ui(t,s));const o=g(e,["config"]);return o!=null&&y(n,["config"],o),n}function uJ(t,e){const n={},s=g(t,["ttl"]);e!==void 0&&s!=null&&y(e,["ttl"],s);const o=g(t,["expireTime"]);return e!==void 0&&o!=null&&y(e,["expireTime"],o),n}function cJ(t,e){const n={},s=g(e,["name"]);s!=null&&y(n,["_url","name"],Ui(t,s));const o=g(e,["config"]);return o!=null&&y(n,["config"],uJ(o,n)),n}function dJ(t,e){const n={},s=g(t,["pageSize"]);e!==void 0&&s!=null&&y(e,["_query","pageSize"],s);const o=g(t,["pageToken"]);return e!==void 0&&o!=null&&y(e,["_query","pageToken"],o),n}function fJ(t){const e={},n=g(t,["config"]);return n!=null&&y(e,["config"],dJ(n,e)),e}function hJ(t){const e={},n=g(t,["fps"]);n!=null&&y(e,["fps"],n);const s=g(t,["endOffset"]);s!=null&&y(e,["endOffset"],s);const o=g(t,["startOffset"]);return o!=null&&y(e,["startOffset"],o),e}function pJ(t){const e={},n=g(t,["displayName"]);n!=null&&y(e,["displayName"],n);const s=g(t,["data"]);s!=null&&y(e,["data"],s);const o=g(t,["mimeType"]);return o!=null&&y(e,["mimeType"],o),e}function mJ(t){const e={},n=g(t,["displayName"]);n!=null&&y(e,["displayName"],n);const s=g(t,["fileUri"]);s!=null&&y(e,["fileUri"],s);const o=g(t,["mimeType"]);return o!=null&&y(e,["mimeType"],o),e}function gJ(t){const e={},n=g(t,["id"]);n!=null&&y(e,["id"],n);const s=g(t,["args"]);s!=null&&y(e,["args"],s);const o=g(t,["name"]);return o!=null&&y(e,["name"],o),e}function yJ(t){const e={},n=g(t,["videoMetadata"]);n!=null&&y(e,["videoMetadata"],hJ(n));const s=g(t,["thought"]);s!=null&&y(e,["thought"],s);const o=g(t,["inlineData"]);o!=null&&y(e,["inlineData"],pJ(o));const r=g(t,["fileData"]);r!=null&&y(e,["fileData"],mJ(r));const i=g(t,["thoughtSignature"]);i!=null&&y(e,["thoughtSignature"],i);const a=g(t,["functionCall"]);a!=null&&y(e,["functionCall"],gJ(a));const l=g(t,["codeExecutionResult"]);l!=null&&y(e,["codeExecutionResult"],l);const u=g(t,["executableCode"]);u!=null&&y(e,["executableCode"],u);const d=g(t,["functionResponse"]);d!=null&&y(e,["functionResponse"],d);const h=g(t,["text"]);return h!=null&&y(e,["text"],h),e}function lF(t){const e={},n=g(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>yJ(r))),y(e,["parts"],o)}const s=g(t,["role"]);return s!=null&&y(e,["role"],s),e}function xJ(t){const e={};if(g(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=g(t,["description"]);n!=null&&y(e,["description"],n);const s=g(t,["name"]);s!=null&&y(e,["name"],s);const o=g(t,["parameters"]);o!=null&&y(e,["parameters"],o);const r=g(t,["parametersJsonSchema"]);r!=null&&y(e,["parametersJsonSchema"],r);const i=g(t,["response"]);i!=null&&y(e,["response"],i);const a=g(t,["responseJsonSchema"]);return a!=null&&y(e,["responseJsonSchema"],a),e}function vJ(t){const e={},n=g(t,["startTime"]);n!=null&&y(e,["startTime"],n);const s=g(t,["endTime"]);return s!=null&&y(e,["endTime"],s),e}function bJ(t){const e={},n=g(t,["timeRangeFilter"]);n!=null&&y(e,["timeRangeFilter"],vJ(n));const s=g(t,["excludeDomains"]);return s!=null&&y(e,["excludeDomains"],s),e}function wJ(t){const e={},n=g(t,["mode"]);n!=null&&y(e,["mode"],n);const s=g(t,["dynamicThreshold"]);return s!=null&&y(e,["dynamicThreshold"],s),e}function CJ(t){const e={},n=g(t,["dynamicRetrievalConfig"]);return n!=null&&y(e,["dynamicRetrievalConfig"],wJ(n)),e}function TJ(t){const e={},n=g(t,["excludeDomains"]);return n!=null&&y(e,["excludeDomains"],n),e}function SJ(t){const e={},n=g(t,["apiKeyString"]);return n!=null&&y(e,["apiKeyString"],n),e}function NJ(t){const e={},n=g(t,["apiKeyConfig"]);n!=null&&y(e,["apiKeyConfig"],SJ(n));const s=g(t,["authType"]);s!=null&&y(e,["authType"],s);const o=g(t,["googleServiceAccountConfig"]);o!=null&&y(e,["googleServiceAccountConfig"],o);const r=g(t,["httpBasicAuthConfig"]);r!=null&&y(e,["httpBasicAuthConfig"],r);const i=g(t,["oauthConfig"]);i!=null&&y(e,["oauthConfig"],i);const a=g(t,["oidcConfig"]);return a!=null&&y(e,["oidcConfig"],a),e}function EJ(t){const e={},n=g(t,["authConfig"]);return n!=null&&y(e,["authConfig"],NJ(n)),e}function IJ(){return{}}function kJ(t){const e={},n=g(t,["environment"]);return n!=null&&y(e,["environment"],n),e}function AJ(t){const e={},n=g(t,["functionDeclarations"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(p=>xJ(p))),y(e,["functionDeclarations"],h)}const s=g(t,["retrieval"]);s!=null&&y(e,["retrieval"],s);const o=g(t,["googleSearch"]);o!=null&&y(e,["googleSearch"],bJ(o));const r=g(t,["googleSearchRetrieval"]);r!=null&&y(e,["googleSearchRetrieval"],CJ(r));const i=g(t,["enterpriseWebSearch"]);i!=null&&y(e,["enterpriseWebSearch"],TJ(i));const a=g(t,["googleMaps"]);a!=null&&y(e,["googleMaps"],EJ(a)),g(t,["urlContext"])!=null&&y(e,["urlContext"],IJ());const u=g(t,["computerUse"]);u!=null&&y(e,["computerUse"],kJ(u));const d=g(t,["codeExecution"]);return d!=null&&y(e,["codeExecution"],d),e}function RJ(t){const e={},n=g(t,["mode"]);n!=null&&y(e,["mode"],n);const s=g(t,["allowedFunctionNames"]);return s!=null&&y(e,["allowedFunctionNames"],s),e}function $J(t){const e={},n=g(t,["latitude"]);n!=null&&y(e,["latitude"],n);const s=g(t,["longitude"]);return s!=null&&y(e,["longitude"],s),e}function DJ(t){const e={},n=g(t,["latLng"]);n!=null&&y(e,["latLng"],$J(n));const s=g(t,["languageCode"]);return s!=null&&y(e,["languageCode"],s),e}function _J(t){const e={},n=g(t,["functionCallingConfig"]);n!=null&&y(e,["functionCallingConfig"],RJ(n));const s=g(t,["retrievalConfig"]);return s!=null&&y(e,["retrievalConfig"],DJ(s)),e}function MJ(t,e){const n={},s=g(t,["ttl"]);e!==void 0&&s!=null&&y(e,["ttl"],s);const o=g(t,["expireTime"]);e!==void 0&&o!=null&&y(e,["expireTime"],o);const r=g(t,["displayName"]);e!==void 0&&r!=null&&y(e,["displayName"],r);const i=g(t,["contents"]);if(e!==void 0&&i!=null){let h=tr(i);Array.isArray(h)&&(h=h.map(p=>lF(p))),y(e,["contents"],h)}const a=g(t,["systemInstruction"]);e!==void 0&&a!=null&&y(e,["systemInstruction"],lF(_s(a)));const l=g(t,["tools"]);if(e!==void 0&&l!=null){let h=l;Array.isArray(h)&&(h=h.map(p=>AJ(p))),y(e,["tools"],h)}const u=g(t,["toolConfig"]);e!==void 0&&u!=null&&y(e,["toolConfig"],_J(u));const d=g(t,["kmsKeyName"]);return e!==void 0&&d!=null&&y(e,["encryption_spec","kmsKeyName"],d),n}function FJ(t,e){const n={},s=g(e,["model"]);s!=null&&y(n,["model"],S3(t,s));const o=g(e,["config"]);return o!=null&&y(n,["config"],MJ(o,n)),n}function OJ(t,e){const n={},s=g(e,["name"]);s!=null&&y(n,["_url","name"],Ui(t,s));const o=g(e,["config"]);return o!=null&&y(n,["config"],o),n}function PJ(t,e){const n={},s=g(e,["name"]);s!=null&&y(n,["_url","name"],Ui(t,s));const o=g(e,["config"]);return o!=null&&y(n,["config"],o),n}function LJ(t,e){const n={},s=g(t,["ttl"]);e!==void 0&&s!=null&&y(e,["ttl"],s);const o=g(t,["expireTime"]);return e!==void 0&&o!=null&&y(e,["expireTime"],o),n}function VJ(t,e){const n={},s=g(e,["name"]);s!=null&&y(n,["_url","name"],Ui(t,s));const o=g(e,["config"]);return o!=null&&y(n,["config"],LJ(o,n)),n}function zJ(t,e){const n={},s=g(t,["pageSize"]);e!==void 0&&s!=null&&y(e,["_query","pageSize"],s);const o=g(t,["pageToken"]);return e!==void 0&&o!=null&&y(e,["_query","pageToken"],o),n}function BJ(t){const e={},n=g(t,["config"]);return n!=null&&y(e,["config"],zJ(n,e)),e}function m0(t){const e={},n=g(t,["name"]);n!=null&&y(e,["name"],n);const s=g(t,["displayName"]);s!=null&&y(e,["displayName"],s);const o=g(t,["model"]);o!=null&&y(e,["model"],o);const r=g(t,["createTime"]);r!=null&&y(e,["createTime"],r);const i=g(t,["updateTime"]);i!=null&&y(e,["updateTime"],i);const a=g(t,["expireTime"]);a!=null&&y(e,["expireTime"],a);const l=g(t,["usageMetadata"]);return l!=null&&y(e,["usageMetadata"],l),e}function UJ(t){const e={},n=g(t,["sdkHttpResponse"]);return n!=null&&y(e,["sdkHttpResponse"],n),e}function GJ(t){const e={},n=g(t,["sdkHttpResponse"]);n!=null&&y(e,["sdkHttpResponse"],n);const s=g(t,["nextPageToken"]);s!=null&&y(e,["nextPageToken"],s);const o=g(t,["cachedContents"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(i=>m0(i))),y(e,["cachedContents"],r)}return e}function g0(t){const e={},n=g(t,["name"]);n!=null&&y(e,["name"],n);const s=g(t,["displayName"]);s!=null&&y(e,["displayName"],s);const o=g(t,["model"]);o!=null&&y(e,["model"],o);const r=g(t,["createTime"]);r!=null&&y(e,["createTime"],r);const i=g(t,["updateTime"]);i!=null&&y(e,["updateTime"],i);const a=g(t,["expireTime"]);a!=null&&y(e,["expireTime"],a);const l=g(t,["usageMetadata"]);return l!=null&&y(e,["usageMetadata"],l),e}function HJ(t){const e={},n=g(t,["sdkHttpResponse"]);return n!=null&&y(e,["sdkHttpResponse"],n),e}function WJ(t){const e={},n=g(t,["sdkHttpResponse"]);n!=null&&y(e,["sdkHttpResponse"],n);const s=g(t,["nextPageToken"]);s!=null&&y(e,["nextPageToken"],s);const o=g(t,["cachedContents"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(i=>g0(i))),y(e,["cachedContents"],r)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class qJ extends gu{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new Vp(jl.PAGED_ITEM_CACHED_CONTENTS,s=>this.listInternal(s),await this.listInternal(n),n)}async create(e){var n,s,o,r;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=FJ(this.apiClient,e);return a=Me("cachedContents",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>g0(d))}else{const u=iJ(this.apiClient,e);return a=Me("cachedContents",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),i.then(d=>m0(d))}}async get(e){var n,s,o,r;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=OJ(this.apiClient,e);return a=Me("{name}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>g0(d))}else{const u=aJ(this.apiClient,e);return a=Me("{name}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),i.then(d=>m0(d))}}async delete(e){var n,s,o,r;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=PJ(this.apiClient,e);return a=Me("{name}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json().then(h=>{const p=h;return p.sdkHttpResponse={headers:d.headers},p})),i.then(d=>{const h=HJ(d),p=new tF;return Object.assign(p,h),p})}else{const u=lJ(this.apiClient,e);return a=Me("{name}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{const p=h;return p.sdkHttpResponse={headers:d.headers},p})),i.then(d=>{const h=UJ(d),p=new tF;return Object.assign(p,h),p})}}async update(e){var n,s,o,r;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=VJ(this.apiClient,e);return a=Me("{name}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>g0(d))}else{const u=cJ(this.apiClient,e);return a=Me("{name}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),i.then(d=>m0(d))}}async listInternal(e){var n,s,o,r;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=BJ(e);return a=Me("cachedContents",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json().then(h=>{const p=h;return p.sdkHttpResponse={headers:d.headers},p})),i.then(d=>{const h=WJ(d),p=new nF;return Object.assign(p,h),p})}else{const u=fJ(e);return a=Me("cachedContents",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{const p=h;return p.sdkHttpResponse={headers:d.headers},p})),i.then(d=>{const h=GJ(d),p=new nF;return Object.assign(p,h),p})}}}function uF(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],s=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Xt(t){return this instanceof Xt?(this.v=t,this):new Xt(t)}function _c(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=n.apply(t,e||[]),o,r=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",i),o[Symbol.asyncIterator]=function(){return this},o;function i(x){return function(b){return Promise.resolve(b).then(x,h)}}function a(x,b){s[x]&&(o[x]=function(w){return new Promise(function(C,T){r.push([x,w,C,T])>1||l(x,w)})},b&&(o[x]=b(o[x])))}function l(x,b){try{u(s[x](b))}catch(w){p(r[0][3],w)}}function u(x){x.value instanceof Xt?Promise.resolve(x.value.v).then(d,h):p(r[0][2],x)}function d(x){l("next",x)}function h(x){l("throw",x)}function p(x,b){x(b),r.shift(),r.length&&l(r[0][0],r[0][1])}}function ep(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof uF=="function"?uF(t):t[Symbol.iterator](),n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n);function s(r){n[r]=t[r]&&function(i){return new Promise(function(a,l){i=t[r](i),o(a,l,i.done,i.value)})}}function o(r,i,a,l){Promise.resolve(l).then(function(u){r({value:u,done:a})},i)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function KJ(t){var e;if(t.candidates==null||t.candidates.length===0)return!1;const n=(e=t.candidates[0])===null||e===void 0?void 0:e.content;return n===void 0?!1:V3(n)}function V3(t){if(t.parts===void 0||t.parts.length===0)return!1;for(const e of t.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function XJ(t){if(t.length!==0){for(const e of t)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function cF(t){if(t===void 0||t.length===0)return[];const e=[],n=t.length;let s=0;for(;s<n;)if(t[s].role==="user")e.push(t[s]),s++;else{const o=[];let r=!0;for(;s<n&&t[s].role==="model";)o.push(t[s]),r&&!V3(t[s])&&(r=!1),s++;r?e.push(...o):e.pop()}return e}class YJ{constructor(e,n){this.modelsModule=e,this.apiClient=n}create(e){return new JJ(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class JJ{constructor(e,n,s,o={},r=[]){this.apiClient=e,this.modelsModule=n,this.model=s,this.config=o,this.history=r,this.sendPromise=Promise.resolve(),XJ(r)}async sendMessage(e){var n;await this.sendPromise;const s=_s(e.message),o=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(s),config:(n=e.config)!==null&&n!==void 0?n:this.config});return this.sendPromise=(async()=>{var r,i,a;const l=await o,u=(i=(r=l.candidates)===null||r===void 0?void 0:r[0])===null||i===void 0?void 0:i.content,d=l.automaticFunctionCallingHistory,h=this.getHistory(!0).length;let p=[];d!=null&&(p=(a=d.slice(h))!==null&&a!==void 0?a:[]);const x=u?[u]:[];this.recordHistory(s,x,p)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),o}async sendMessageStream(e){var n;await this.sendPromise;const s=_s(e.message),o=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(s),config:(n=e.config)!==null&&n!==void 0?n:this.config});this.sendPromise=o.then(()=>{}).catch(()=>{});const r=await o;return this.processStreamResponse(r,s)}getHistory(e=!1){const n=e?cF(this.history):this.history;return structuredClone(n)}processStreamResponse(e,n){var s,o;return _c(this,arguments,function*(){var i,a,l,u;const d=[];try{for(var h=!0,p=ep(e),x;x=yield Xt(p.next()),i=x.done,!i;h=!0){u=x.value,h=!1;const b=u;if(KJ(b)){const w=(o=(s=b.candidates)===null||s===void 0?void 0:s[0])===null||o===void 0?void 0:o.content;w!==void 0&&d.push(w)}yield yield Xt(b)}}catch(b){a={error:b}}finally{try{!h&&!i&&(l=p.return)&&(yield Xt(l.call(p)))}finally{if(a)throw a.error}}this.recordHistory(n,d)})}recordHistory(e,n,s){let o=[];n.length>0&&n.every(r=>r.role!==void 0)?o=n:o.push({role:"model",parts:[]}),s&&s.length>0?this.history.push(...cF(s)):this.history.push(e),this.history.push(...o)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ix extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,Ix.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function jJ(t,e){const n={},s=g(t,["pageSize"]);e!==void 0&&s!=null&&y(e,["_query","pageSize"],s);const o=g(t,["pageToken"]);return e!==void 0&&o!=null&&y(e,["_query","pageToken"],o),n}function ZJ(t){const e={},n=g(t,["config"]);return n!=null&&y(e,["config"],jJ(n,e)),e}function QJ(t){const e={},n=g(t,["details"]);n!=null&&y(e,["details"],n);const s=g(t,["message"]);s!=null&&y(e,["message"],s);const o=g(t,["code"]);return o!=null&&y(e,["code"],o),e}function ej(t){const e={},n=g(t,["name"]);n!=null&&y(e,["name"],n);const s=g(t,["displayName"]);s!=null&&y(e,["displayName"],s);const o=g(t,["mimeType"]);o!=null&&y(e,["mimeType"],o);const r=g(t,["sizeBytes"]);r!=null&&y(e,["sizeBytes"],r);const i=g(t,["createTime"]);i!=null&&y(e,["createTime"],i);const a=g(t,["expirationTime"]);a!=null&&y(e,["expirationTime"],a);const l=g(t,["updateTime"]);l!=null&&y(e,["updateTime"],l);const u=g(t,["sha256Hash"]);u!=null&&y(e,["sha256Hash"],u);const d=g(t,["uri"]);d!=null&&y(e,["uri"],d);const h=g(t,["downloadUri"]);h!=null&&y(e,["downloadUri"],h);const p=g(t,["state"]);p!=null&&y(e,["state"],p);const x=g(t,["source"]);x!=null&&y(e,["source"],x);const b=g(t,["videoMetadata"]);b!=null&&y(e,["videoMetadata"],b);const w=g(t,["error"]);return w!=null&&y(e,["error"],QJ(w)),e}function tj(t){const e={},n=g(t,["file"]);n!=null&&y(e,["file"],ej(n));const s=g(t,["config"]);return s!=null&&y(e,["config"],s),e}function nj(t){const e={},n=g(t,["name"]);n!=null&&y(e,["_url","file"],R3(n));const s=g(t,["config"]);return s!=null&&y(e,["config"],s),e}function sj(t){const e={},n=g(t,["name"]);n!=null&&y(e,["_url","file"],R3(n));const s=g(t,["config"]);return s!=null&&y(e,["config"],s),e}function oj(t){const e={},n=g(t,["details"]);n!=null&&y(e,["details"],n);const s=g(t,["message"]);s!=null&&y(e,["message"],s);const o=g(t,["code"]);return o!=null&&y(e,["code"],o),e}function FT(t){const e={},n=g(t,["name"]);n!=null&&y(e,["name"],n);const s=g(t,["displayName"]);s!=null&&y(e,["displayName"],s);const o=g(t,["mimeType"]);o!=null&&y(e,["mimeType"],o);const r=g(t,["sizeBytes"]);r!=null&&y(e,["sizeBytes"],r);const i=g(t,["createTime"]);i!=null&&y(e,["createTime"],i);const a=g(t,["expirationTime"]);a!=null&&y(e,["expirationTime"],a);const l=g(t,["updateTime"]);l!=null&&y(e,["updateTime"],l);const u=g(t,["sha256Hash"]);u!=null&&y(e,["sha256Hash"],u);const d=g(t,["uri"]);d!=null&&y(e,["uri"],d);const h=g(t,["downloadUri"]);h!=null&&y(e,["downloadUri"],h);const p=g(t,["state"]);p!=null&&y(e,["state"],p);const x=g(t,["source"]);x!=null&&y(e,["source"],x);const b=g(t,["videoMetadata"]);b!=null&&y(e,["videoMetadata"],b);const w=g(t,["error"]);return w!=null&&y(e,["error"],oj(w)),e}function rj(t){const e={},n=g(t,["sdkHttpResponse"]);n!=null&&y(e,["sdkHttpResponse"],n);const s=g(t,["nextPageToken"]);s!=null&&y(e,["nextPageToken"],s);const o=g(t,["files"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(i=>FT(i))),y(e,["files"],r)}return e}function ij(t){const e={},n=g(t,["sdkHttpResponse"]);return n!=null&&y(e,["sdkHttpResponse"],n),e}function aj(t){const e={},n=g(t,["sdkHttpResponse"]);return n!=null&&y(e,["sdkHttpResponse"],n),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class lj extends gu{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new Vp(jl.PAGED_ITEM_FILES,s=>this.listInternal(s),await this.listInternal(n),n)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(n=>FT(n))}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var n,s;let o,r="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=ZJ(e);return r=Me("files",a._url),i=a._query,delete a.config,delete a._url,delete a._query,o=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json().then(u=>{const d=u;return d.sdkHttpResponse={headers:l.headers},d})),o.then(l=>{const u=rj(l),d=new h7;return Object.assign(d,u),d})}}async createInternal(e){var n,s;let o,r="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=tj(e);return r=Me("upload/v1beta/files",a._url),i=a._query,delete a.config,delete a._url,delete a._query,o=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json()),o.then(l=>{const u=ij(l),d=new p7;return Object.assign(d,u),d})}}async get(e){var n,s;let o,r="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=nj(e);return r=Me("files/{file}",a._url),i=a._query,delete a.config,delete a._url,delete a._query,o=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json()),o.then(l=>FT(l))}}async delete(e){var n,s;let o,r="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=sj(e);return r=Me("files/{file}",a._url),i=a._query,delete a.config,delete a._url,delete a._query,o=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json().then(u=>{const d=u;return d.sdkHttpResponse={headers:l.headers},d})),o.then(l=>{const u=aj(l),d=new m7;return Object.assign(d,u),d})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function uj(t){const e={},n=g(t,["voiceName"]);return n!=null&&y(e,["voiceName"],n),e}function z3(t){const e={},n=g(t,["prebuiltVoiceConfig"]);return n!=null&&y(e,["prebuiltVoiceConfig"],uj(n)),e}function cj(t){const e={},n=g(t,["speaker"]);n!=null&&y(e,["speaker"],n);const s=g(t,["voiceConfig"]);return s!=null&&y(e,["voiceConfig"],z3(s)),e}function dj(t){const e={},n=g(t,["speakerVoiceConfigs"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>cj(o))),y(e,["speakerVoiceConfigs"],s)}return e}function fj(t){const e={},n=g(t,["voiceConfig"]);n!=null&&y(e,["voiceConfig"],z3(n));const s=g(t,["multiSpeakerVoiceConfig"]);s!=null&&y(e,["multiSpeakerVoiceConfig"],dj(s));const o=g(t,["languageCode"]);return o!=null&&y(e,["languageCode"],o),e}function hj(t){const e={},n=g(t,["fps"]);n!=null&&y(e,["fps"],n);const s=g(t,["endOffset"]);s!=null&&y(e,["endOffset"],s);const o=g(t,["startOffset"]);return o!=null&&y(e,["startOffset"],o),e}function pj(t){const e={};if(g(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=g(t,["data"]);n!=null&&y(e,["data"],n);const s=g(t,["mimeType"]);return s!=null&&y(e,["mimeType"],s),e}function mj(t){const e={};if(g(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=g(t,["fileUri"]);n!=null&&y(e,["fileUri"],n);const s=g(t,["mimeType"]);return s!=null&&y(e,["mimeType"],s),e}function gj(t){const e={},n=g(t,["id"]);n!=null&&y(e,["id"],n);const s=g(t,["args"]);s!=null&&y(e,["args"],s);const o=g(t,["name"]);return o!=null&&y(e,["name"],o),e}function yj(t){const e={},n=g(t,["videoMetadata"]);n!=null&&y(e,["videoMetadata"],hj(n));const s=g(t,["thought"]);s!=null&&y(e,["thought"],s);const o=g(t,["inlineData"]);o!=null&&y(e,["inlineData"],pj(o));const r=g(t,["fileData"]);r!=null&&y(e,["fileData"],mj(r));const i=g(t,["thoughtSignature"]);i!=null&&y(e,["thoughtSignature"],i);const a=g(t,["functionCall"]);a!=null&&y(e,["functionCall"],gj(a));const l=g(t,["codeExecutionResult"]);l!=null&&y(e,["codeExecutionResult"],l);const u=g(t,["executableCode"]);u!=null&&y(e,["executableCode"],u);const d=g(t,["functionResponse"]);d!=null&&y(e,["functionResponse"],d);const h=g(t,["text"]);return h!=null&&y(e,["text"],h),e}function xj(t){const e={},n=g(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>yj(r))),y(e,["parts"],o)}const s=g(t,["role"]);return s!=null&&y(e,["role"],s),e}function vj(t){const e={},n=g(t,["behavior"]);n!=null&&y(e,["behavior"],n);const s=g(t,["description"]);s!=null&&y(e,["description"],s);const o=g(t,["name"]);o!=null&&y(e,["name"],o);const r=g(t,["parameters"]);r!=null&&y(e,["parameters"],r);const i=g(t,["parametersJsonSchema"]);i!=null&&y(e,["parametersJsonSchema"],i);const a=g(t,["response"]);a!=null&&y(e,["response"],a);const l=g(t,["responseJsonSchema"]);return l!=null&&y(e,["responseJsonSchema"],l),e}function bj(t){const e={},n=g(t,["startTime"]);n!=null&&y(e,["startTime"],n);const s=g(t,["endTime"]);return s!=null&&y(e,["endTime"],s),e}function wj(t){const e={},n=g(t,["timeRangeFilter"]);if(n!=null&&y(e,["timeRangeFilter"],bj(n)),g(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function Cj(t){const e={},n=g(t,["mode"]);n!=null&&y(e,["mode"],n);const s=g(t,["dynamicThreshold"]);return s!=null&&y(e,["dynamicThreshold"],s),e}function Tj(t){const e={},n=g(t,["dynamicRetrievalConfig"]);return n!=null&&y(e,["dynamicRetrievalConfig"],Cj(n)),e}function Sj(){return{}}function Nj(t){const e={},n=g(t,["environment"]);return n!=null&&y(e,["environment"],n),e}function Ej(t){const e={},n=g(t,["functionDeclarations"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(u=>vj(u))),y(e,["functionDeclarations"],l)}if(g(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=g(t,["googleSearch"]);s!=null&&y(e,["googleSearch"],wj(s));const o=g(t,["googleSearchRetrieval"]);if(o!=null&&y(e,["googleSearchRetrieval"],Tj(o)),g(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(g(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");g(t,["urlContext"])!=null&&y(e,["urlContext"],Sj());const i=g(t,["computerUse"]);i!=null&&y(e,["computerUse"],Nj(i));const a=g(t,["codeExecution"]);return a!=null&&y(e,["codeExecution"],a),e}function Ij(t){const e={},n=g(t,["handle"]);if(n!=null&&y(e,["handle"],n),g(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function dF(){return{}}function kj(t){const e={},n=g(t,["disabled"]);n!=null&&y(e,["disabled"],n);const s=g(t,["startOfSpeechSensitivity"]);s!=null&&y(e,["startOfSpeechSensitivity"],s);const o=g(t,["endOfSpeechSensitivity"]);o!=null&&y(e,["endOfSpeechSensitivity"],o);const r=g(t,["prefixPaddingMs"]);r!=null&&y(e,["prefixPaddingMs"],r);const i=g(t,["silenceDurationMs"]);return i!=null&&y(e,["silenceDurationMs"],i),e}function Aj(t){const e={},n=g(t,["automaticActivityDetection"]);n!=null&&y(e,["automaticActivityDetection"],kj(n));const s=g(t,["activityHandling"]);s!=null&&y(e,["activityHandling"],s);const o=g(t,["turnCoverage"]);return o!=null&&y(e,["turnCoverage"],o),e}function Rj(t){const e={},n=g(t,["targetTokens"]);return n!=null&&y(e,["targetTokens"],n),e}function $j(t){const e={},n=g(t,["triggerTokens"]);n!=null&&y(e,["triggerTokens"],n);const s=g(t,["slidingWindow"]);return s!=null&&y(e,["slidingWindow"],Rj(s)),e}function Dj(t){const e={},n=g(t,["proactiveAudio"]);return n!=null&&y(e,["proactiveAudio"],n),e}function _j(t,e){const n={},s=g(t,["generationConfig"]);e!==void 0&&s!=null&&y(e,["setup","generationConfig"],s);const o=g(t,["responseModalities"]);e!==void 0&&o!=null&&y(e,["setup","generationConfig","responseModalities"],o);const r=g(t,["temperature"]);e!==void 0&&r!=null&&y(e,["setup","generationConfig","temperature"],r);const i=g(t,["topP"]);e!==void 0&&i!=null&&y(e,["setup","generationConfig","topP"],i);const a=g(t,["topK"]);e!==void 0&&a!=null&&y(e,["setup","generationConfig","topK"],a);const l=g(t,["maxOutputTokens"]);e!==void 0&&l!=null&&y(e,["setup","generationConfig","maxOutputTokens"],l);const u=g(t,["mediaResolution"]);e!==void 0&&u!=null&&y(e,["setup","generationConfig","mediaResolution"],u);const d=g(t,["seed"]);e!==void 0&&d!=null&&y(e,["setup","generationConfig","seed"],d);const h=g(t,["speechConfig"]);e!==void 0&&h!=null&&y(e,["setup","generationConfig","speechConfig"],fj(_N(h)));const p=g(t,["enableAffectiveDialog"]);e!==void 0&&p!=null&&y(e,["setup","generationConfig","enableAffectiveDialog"],p);const x=g(t,["systemInstruction"]);e!==void 0&&x!=null&&y(e,["setup","systemInstruction"],xj(_s(x)));const b=g(t,["tools"]);if(e!==void 0&&b!=null){let A=ad(b);Array.isArray(A)&&(A=A.map($=>Ej(id($)))),y(e,["setup","tools"],A)}const w=g(t,["sessionResumption"]);e!==void 0&&w!=null&&y(e,["setup","sessionResumption"],Ij(w));const C=g(t,["inputAudioTranscription"]);e!==void 0&&C!=null&&y(e,["setup","inputAudioTranscription"],dF());const T=g(t,["outputAudioTranscription"]);e!==void 0&&T!=null&&y(e,["setup","outputAudioTranscription"],dF());const N=g(t,["realtimeInputConfig"]);e!==void 0&&N!=null&&y(e,["setup","realtimeInputConfig"],Aj(N));const I=g(t,["contextWindowCompression"]);e!==void 0&&I!=null&&y(e,["setup","contextWindowCompression"],$j(I));const k=g(t,["proactivity"]);return e!==void 0&&k!=null&&y(e,["setup","proactivity"],Dj(k)),n}function Mj(t,e){const n={},s=g(e,["model"]);s!=null&&y(n,["setup","model"],Et(t,s));const o=g(e,["config"]);return o!=null&&y(n,["config"],_j(o,n)),n}function Fj(){return{}}function Oj(){return{}}function Pj(t){const e={},n=g(t,["media"]);n!=null&&y(e,["mediaChunks"],N3(n));const s=g(t,["audio"]);s!=null&&y(e,["audio"],I3(s));const o=g(t,["audioStreamEnd"]);o!=null&&y(e,["audioStreamEnd"],o);const r=g(t,["video"]);r!=null&&y(e,["video"],E3(r));const i=g(t,["text"]);return i!=null&&y(e,["text"],i),g(t,["activityStart"])!=null&&y(e,["activityStart"],Fj()),g(t,["activityEnd"])!=null&&y(e,["activityEnd"],Oj()),e}function B3(t){const e={},n=g(t,["text"]);n!=null&&y(e,["text"],n);const s=g(t,["weight"]);return s!=null&&y(e,["weight"],s),e}function Lj(t){const e={},n=g(t,["weightedPrompts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>B3(o))),y(e,["weightedPrompts"],s)}return e}function U3(t){const e={},n=g(t,["temperature"]);n!=null&&y(e,["temperature"],n);const s=g(t,["topK"]);s!=null&&y(e,["topK"],s);const o=g(t,["seed"]);o!=null&&y(e,["seed"],o);const r=g(t,["guidance"]);r!=null&&y(e,["guidance"],r);const i=g(t,["bpm"]);i!=null&&y(e,["bpm"],i);const a=g(t,["density"]);a!=null&&y(e,["density"],a);const l=g(t,["brightness"]);l!=null&&y(e,["brightness"],l);const u=g(t,["scale"]);u!=null&&y(e,["scale"],u);const d=g(t,["muteBass"]);d!=null&&y(e,["muteBass"],d);const h=g(t,["muteDrums"]);h!=null&&y(e,["muteDrums"],h);const p=g(t,["onlyBassAndDrums"]);p!=null&&y(e,["onlyBassAndDrums"],p);const x=g(t,["musicGenerationMode"]);return x!=null&&y(e,["musicGenerationMode"],x),e}function Vj(t){const e={},n=g(t,["musicGenerationConfig"]);return n!=null&&y(e,["musicGenerationConfig"],U3(n)),e}function G3(t){const e={},n=g(t,["model"]);return n!=null&&y(e,["model"],n),e}function H3(t){const e={},n=g(t,["weightedPrompts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>B3(o))),y(e,["weightedPrompts"],s)}return e}function OT(t){const e={},n=g(t,["setup"]);n!=null&&y(e,["setup"],G3(n));const s=g(t,["clientContent"]);s!=null&&y(e,["clientContent"],H3(s));const o=g(t,["musicGenerationConfig"]);o!=null&&y(e,["musicGenerationConfig"],U3(o));const r=g(t,["playbackControl"]);return r!=null&&y(e,["playbackControl"],r),e}function zj(t){const e={},n=g(t,["voiceName"]);return n!=null&&y(e,["voiceName"],n),e}function Bj(t){const e={},n=g(t,["prebuiltVoiceConfig"]);return n!=null&&y(e,["prebuiltVoiceConfig"],zj(n)),e}function Uj(t){const e={},n=g(t,["voiceConfig"]);if(n!=null&&y(e,["voiceConfig"],Bj(n)),g(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const s=g(t,["languageCode"]);return s!=null&&y(e,["languageCode"],s),e}function Gj(t){const e={},n=g(t,["fps"]);n!=null&&y(e,["fps"],n);const s=g(t,["endOffset"]);s!=null&&y(e,["endOffset"],s);const o=g(t,["startOffset"]);return o!=null&&y(e,["startOffset"],o),e}function Hj(t){const e={},n=g(t,["displayName"]);n!=null&&y(e,["displayName"],n);const s=g(t,["data"]);s!=null&&y(e,["data"],s);const o=g(t,["mimeType"]);return o!=null&&y(e,["mimeType"],o),e}function Wj(t){const e={},n=g(t,["displayName"]);n!=null&&y(e,["displayName"],n);const s=g(t,["fileUri"]);s!=null&&y(e,["fileUri"],s);const o=g(t,["mimeType"]);return o!=null&&y(e,["mimeType"],o),e}function qj(t){const e={},n=g(t,["id"]);n!=null&&y(e,["id"],n);const s=g(t,["args"]);s!=null&&y(e,["args"],s);const o=g(t,["name"]);return o!=null&&y(e,["name"],o),e}function Kj(t){const e={},n=g(t,["videoMetadata"]);n!=null&&y(e,["videoMetadata"],Gj(n));const s=g(t,["thought"]);s!=null&&y(e,["thought"],s);const o=g(t,["inlineData"]);o!=null&&y(e,["inlineData"],Hj(o));const r=g(t,["fileData"]);r!=null&&y(e,["fileData"],Wj(r));const i=g(t,["thoughtSignature"]);i!=null&&y(e,["thoughtSignature"],i);const a=g(t,["functionCall"]);a!=null&&y(e,["functionCall"],qj(a));const l=g(t,["codeExecutionResult"]);l!=null&&y(e,["codeExecutionResult"],l);const u=g(t,["executableCode"]);u!=null&&y(e,["executableCode"],u);const d=g(t,["functionResponse"]);d!=null&&y(e,["functionResponse"],d);const h=g(t,["text"]);return h!=null&&y(e,["text"],h),e}function Xj(t){const e={},n=g(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>Kj(r))),y(e,["parts"],o)}const s=g(t,["role"]);return s!=null&&y(e,["role"],s),e}function Yj(t){const e={};if(g(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=g(t,["description"]);n!=null&&y(e,["description"],n);const s=g(t,["name"]);s!=null&&y(e,["name"],s);const o=g(t,["parameters"]);o!=null&&y(e,["parameters"],o);const r=g(t,["parametersJsonSchema"]);r!=null&&y(e,["parametersJsonSchema"],r);const i=g(t,["response"]);i!=null&&y(e,["response"],i);const a=g(t,["responseJsonSchema"]);return a!=null&&y(e,["responseJsonSchema"],a),e}function Jj(t){const e={},n=g(t,["startTime"]);n!=null&&y(e,["startTime"],n);const s=g(t,["endTime"]);return s!=null&&y(e,["endTime"],s),e}function jj(t){const e={},n=g(t,["timeRangeFilter"]);n!=null&&y(e,["timeRangeFilter"],Jj(n));const s=g(t,["excludeDomains"]);return s!=null&&y(e,["excludeDomains"],s),e}function Zj(t){const e={},n=g(t,["mode"]);n!=null&&y(e,["mode"],n);const s=g(t,["dynamicThreshold"]);return s!=null&&y(e,["dynamicThreshold"],s),e}function Qj(t){const e={},n=g(t,["dynamicRetrievalConfig"]);return n!=null&&y(e,["dynamicRetrievalConfig"],Zj(n)),e}function eZ(t){const e={},n=g(t,["excludeDomains"]);return n!=null&&y(e,["excludeDomains"],n),e}function tZ(t){const e={},n=g(t,["apiKeyString"]);return n!=null&&y(e,["apiKeyString"],n),e}function nZ(t){const e={},n=g(t,["apiKeyConfig"]);n!=null&&y(e,["apiKeyConfig"],tZ(n));const s=g(t,["authType"]);s!=null&&y(e,["authType"],s);const o=g(t,["googleServiceAccountConfig"]);o!=null&&y(e,["googleServiceAccountConfig"],o);const r=g(t,["httpBasicAuthConfig"]);r!=null&&y(e,["httpBasicAuthConfig"],r);const i=g(t,["oauthConfig"]);i!=null&&y(e,["oauthConfig"],i);const a=g(t,["oidcConfig"]);return a!=null&&y(e,["oidcConfig"],a),e}function sZ(t){const e={},n=g(t,["authConfig"]);return n!=null&&y(e,["authConfig"],nZ(n)),e}function oZ(){return{}}function rZ(t){const e={},n=g(t,["environment"]);return n!=null&&y(e,["environment"],n),e}function iZ(t){const e={},n=g(t,["functionDeclarations"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(p=>Yj(p))),y(e,["functionDeclarations"],h)}const s=g(t,["retrieval"]);s!=null&&y(e,["retrieval"],s);const o=g(t,["googleSearch"]);o!=null&&y(e,["googleSearch"],jj(o));const r=g(t,["googleSearchRetrieval"]);r!=null&&y(e,["googleSearchRetrieval"],Qj(r));const i=g(t,["enterpriseWebSearch"]);i!=null&&y(e,["enterpriseWebSearch"],eZ(i));const a=g(t,["googleMaps"]);a!=null&&y(e,["googleMaps"],sZ(a)),g(t,["urlContext"])!=null&&y(e,["urlContext"],oZ());const u=g(t,["computerUse"]);u!=null&&y(e,["computerUse"],rZ(u));const d=g(t,["codeExecution"]);return d!=null&&y(e,["codeExecution"],d),e}function aZ(t){const e={},n=g(t,["handle"]);n!=null&&y(e,["handle"],n);const s=g(t,["transparent"]);return s!=null&&y(e,["transparent"],s),e}function fF(){return{}}function lZ(t){const e={},n=g(t,["disabled"]);n!=null&&y(e,["disabled"],n);const s=g(t,["startOfSpeechSensitivity"]);s!=null&&y(e,["startOfSpeechSensitivity"],s);const o=g(t,["endOfSpeechSensitivity"]);o!=null&&y(e,["endOfSpeechSensitivity"],o);const r=g(t,["prefixPaddingMs"]);r!=null&&y(e,["prefixPaddingMs"],r);const i=g(t,["silenceDurationMs"]);return i!=null&&y(e,["silenceDurationMs"],i),e}function uZ(t){const e={},n=g(t,["automaticActivityDetection"]);n!=null&&y(e,["automaticActivityDetection"],lZ(n));const s=g(t,["activityHandling"]);s!=null&&y(e,["activityHandling"],s);const o=g(t,["turnCoverage"]);return o!=null&&y(e,["turnCoverage"],o),e}function cZ(t){const e={},n=g(t,["targetTokens"]);return n!=null&&y(e,["targetTokens"],n),e}function dZ(t){const e={},n=g(t,["triggerTokens"]);n!=null&&y(e,["triggerTokens"],n);const s=g(t,["slidingWindow"]);return s!=null&&y(e,["slidingWindow"],cZ(s)),e}function fZ(t){const e={},n=g(t,["proactiveAudio"]);return n!=null&&y(e,["proactiveAudio"],n),e}function hZ(t,e){const n={},s=g(t,["generationConfig"]);e!==void 0&&s!=null&&y(e,["setup","generationConfig"],s);const o=g(t,["responseModalities"]);e!==void 0&&o!=null&&y(e,["setup","generationConfig","responseModalities"],o);const r=g(t,["temperature"]);e!==void 0&&r!=null&&y(e,["setup","generationConfig","temperature"],r);const i=g(t,["topP"]);e!==void 0&&i!=null&&y(e,["setup","generationConfig","topP"],i);const a=g(t,["topK"]);e!==void 0&&a!=null&&y(e,["setup","generationConfig","topK"],a);const l=g(t,["maxOutputTokens"]);e!==void 0&&l!=null&&y(e,["setup","generationConfig","maxOutputTokens"],l);const u=g(t,["mediaResolution"]);e!==void 0&&u!=null&&y(e,["setup","generationConfig","mediaResolution"],u);const d=g(t,["seed"]);e!==void 0&&d!=null&&y(e,["setup","generationConfig","seed"],d);const h=g(t,["speechConfig"]);e!==void 0&&h!=null&&y(e,["setup","generationConfig","speechConfig"],Uj(_N(h)));const p=g(t,["enableAffectiveDialog"]);e!==void 0&&p!=null&&y(e,["setup","generationConfig","enableAffectiveDialog"],p);const x=g(t,["systemInstruction"]);e!==void 0&&x!=null&&y(e,["setup","systemInstruction"],Xj(_s(x)));const b=g(t,["tools"]);if(e!==void 0&&b!=null){let A=ad(b);Array.isArray(A)&&(A=A.map($=>iZ(id($)))),y(e,["setup","tools"],A)}const w=g(t,["sessionResumption"]);e!==void 0&&w!=null&&y(e,["setup","sessionResumption"],aZ(w));const C=g(t,["inputAudioTranscription"]);e!==void 0&&C!=null&&y(e,["setup","inputAudioTranscription"],fF());const T=g(t,["outputAudioTranscription"]);e!==void 0&&T!=null&&y(e,["setup","outputAudioTranscription"],fF());const N=g(t,["realtimeInputConfig"]);e!==void 0&&N!=null&&y(e,["setup","realtimeInputConfig"],uZ(N));const I=g(t,["contextWindowCompression"]);e!==void 0&&I!=null&&y(e,["setup","contextWindowCompression"],dZ(I));const k=g(t,["proactivity"]);return e!==void 0&&k!=null&&y(e,["setup","proactivity"],fZ(k)),n}function pZ(t,e){const n={},s=g(e,["model"]);s!=null&&y(n,["setup","model"],Et(t,s));const o=g(e,["config"]);return o!=null&&y(n,["config"],hZ(o,n)),n}function mZ(){return{}}function gZ(){return{}}function yZ(t){const e={},n=g(t,["media"]);n!=null&&y(e,["mediaChunks"],N3(n));const s=g(t,["audio"]);s!=null&&y(e,["audio"],I3(s));const o=g(t,["audioStreamEnd"]);o!=null&&y(e,["audioStreamEnd"],o);const r=g(t,["video"]);r!=null&&y(e,["video"],E3(r));const i=g(t,["text"]);return i!=null&&y(e,["text"],i),g(t,["activityStart"])!=null&&y(e,["activityStart"],mZ()),g(t,["activityEnd"])!=null&&y(e,["activityEnd"],gZ()),e}function xZ(){return{}}function vZ(t){const e={},n=g(t,["fps"]);n!=null&&y(e,["fps"],n);const s=g(t,["endOffset"]);s!=null&&y(e,["endOffset"],s);const o=g(t,["startOffset"]);return o!=null&&y(e,["startOffset"],o),e}function bZ(t){const e={},n=g(t,["data"]);n!=null&&y(e,["data"],n);const s=g(t,["mimeType"]);return s!=null&&y(e,["mimeType"],s),e}function wZ(t){const e={},n=g(t,["fileUri"]);n!=null&&y(e,["fileUri"],n);const s=g(t,["mimeType"]);return s!=null&&y(e,["mimeType"],s),e}function W3(t){const e={},n=g(t,["id"]);n!=null&&y(e,["id"],n);const s=g(t,["args"]);s!=null&&y(e,["args"],s);const o=g(t,["name"]);return o!=null&&y(e,["name"],o),e}function CZ(t){const e={},n=g(t,["videoMetadata"]);n!=null&&y(e,["videoMetadata"],vZ(n));const s=g(t,["thought"]);s!=null&&y(e,["thought"],s);const o=g(t,["inlineData"]);o!=null&&y(e,["inlineData"],bZ(o));const r=g(t,["fileData"]);r!=null&&y(e,["fileData"],wZ(r));const i=g(t,["thoughtSignature"]);i!=null&&y(e,["thoughtSignature"],i);const a=g(t,["functionCall"]);a!=null&&y(e,["functionCall"],W3(a));const l=g(t,["codeExecutionResult"]);l!=null&&y(e,["codeExecutionResult"],l);const u=g(t,["executableCode"]);u!=null&&y(e,["executableCode"],u);const d=g(t,["functionResponse"]);d!=null&&y(e,["functionResponse"],d);const h=g(t,["text"]);return h!=null&&y(e,["text"],h),e}function TZ(t){const e={},n=g(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>CZ(r))),y(e,["parts"],o)}const s=g(t,["role"]);return s!=null&&y(e,["role"],s),e}function hF(t){const e={},n=g(t,["text"]);n!=null&&y(e,["text"],n);const s=g(t,["finished"]);return s!=null&&y(e,["finished"],s),e}function SZ(t){const e={},n=g(t,["retrievedUrl"]);n!=null&&y(e,["retrievedUrl"],n);const s=g(t,["urlRetrievalStatus"]);return s!=null&&y(e,["urlRetrievalStatus"],s),e}function NZ(t){const e={},n=g(t,["urlMetadata"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>SZ(o))),y(e,["urlMetadata"],s)}return e}function EZ(t){const e={},n=g(t,["modelTurn"]);n!=null&&y(e,["modelTurn"],TZ(n));const s=g(t,["turnComplete"]);s!=null&&y(e,["turnComplete"],s);const o=g(t,["interrupted"]);o!=null&&y(e,["interrupted"],o);const r=g(t,["groundingMetadata"]);r!=null&&y(e,["groundingMetadata"],r);const i=g(t,["generationComplete"]);i!=null&&y(e,["generationComplete"],i);const a=g(t,["inputTranscription"]);a!=null&&y(e,["inputTranscription"],hF(a));const l=g(t,["outputTranscription"]);l!=null&&y(e,["outputTranscription"],hF(l));const u=g(t,["urlContextMetadata"]);return u!=null&&y(e,["urlContextMetadata"],NZ(u)),e}function IZ(t){const e={},n=g(t,["functionCalls"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>W3(o))),y(e,["functionCalls"],s)}return e}function kZ(t){const e={},n=g(t,["ids"]);return n!=null&&y(e,["ids"],n),e}function Wy(t){const e={},n=g(t,["modality"]);n!=null&&y(e,["modality"],n);const s=g(t,["tokenCount"]);return s!=null&&y(e,["tokenCount"],s),e}function AZ(t){const e={},n=g(t,["promptTokenCount"]);n!=null&&y(e,["promptTokenCount"],n);const s=g(t,["cachedContentTokenCount"]);s!=null&&y(e,["cachedContentTokenCount"],s);const o=g(t,["responseTokenCount"]);o!=null&&y(e,["responseTokenCount"],o);const r=g(t,["toolUsePromptTokenCount"]);r!=null&&y(e,["toolUsePromptTokenCount"],r);const i=g(t,["thoughtsTokenCount"]);i!=null&&y(e,["thoughtsTokenCount"],i);const a=g(t,["totalTokenCount"]);a!=null&&y(e,["totalTokenCount"],a);const l=g(t,["promptTokensDetails"]);if(l!=null){let p=l;Array.isArray(p)&&(p=p.map(x=>Wy(x))),y(e,["promptTokensDetails"],p)}const u=g(t,["cacheTokensDetails"]);if(u!=null){let p=u;Array.isArray(p)&&(p=p.map(x=>Wy(x))),y(e,["cacheTokensDetails"],p)}const d=g(t,["responseTokensDetails"]);if(d!=null){let p=d;Array.isArray(p)&&(p=p.map(x=>Wy(x))),y(e,["responseTokensDetails"],p)}const h=g(t,["toolUsePromptTokensDetails"]);if(h!=null){let p=h;Array.isArray(p)&&(p=p.map(x=>Wy(x))),y(e,["toolUsePromptTokensDetails"],p)}return e}function RZ(t){const e={},n=g(t,["timeLeft"]);return n!=null&&y(e,["timeLeft"],n),e}function $Z(t){const e={},n=g(t,["newHandle"]);n!=null&&y(e,["newHandle"],n);const s=g(t,["resumable"]);s!=null&&y(e,["resumable"],s);const o=g(t,["lastConsumedClientMessageIndex"]);return o!=null&&y(e,["lastConsumedClientMessageIndex"],o),e}function DZ(t){const e={};g(t,["setupComplete"])!=null&&y(e,["setupComplete"],xZ());const s=g(t,["serverContent"]);s!=null&&y(e,["serverContent"],EZ(s));const o=g(t,["toolCall"]);o!=null&&y(e,["toolCall"],IZ(o));const r=g(t,["toolCallCancellation"]);r!=null&&y(e,["toolCallCancellation"],kZ(r));const i=g(t,["usageMetadata"]);i!=null&&y(e,["usageMetadata"],AZ(i));const a=g(t,["goAway"]);a!=null&&y(e,["goAway"],RZ(a));const l=g(t,["sessionResumptionUpdate"]);return l!=null&&y(e,["sessionResumptionUpdate"],$Z(l)),e}function _Z(){return{}}function MZ(t){const e={},n=g(t,["text"]);n!=null&&y(e,["text"],n);const s=g(t,["weight"]);return s!=null&&y(e,["weight"],s),e}function FZ(t){const e={},n=g(t,["weightedPrompts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>MZ(o))),y(e,["weightedPrompts"],s)}return e}function OZ(t){const e={},n=g(t,["temperature"]);n!=null&&y(e,["temperature"],n);const s=g(t,["topK"]);s!=null&&y(e,["topK"],s);const o=g(t,["seed"]);o!=null&&y(e,["seed"],o);const r=g(t,["guidance"]);r!=null&&y(e,["guidance"],r);const i=g(t,["bpm"]);i!=null&&y(e,["bpm"],i);const a=g(t,["density"]);a!=null&&y(e,["density"],a);const l=g(t,["brightness"]);l!=null&&y(e,["brightness"],l);const u=g(t,["scale"]);u!=null&&y(e,["scale"],u);const d=g(t,["muteBass"]);d!=null&&y(e,["muteBass"],d);const h=g(t,["muteDrums"]);h!=null&&y(e,["muteDrums"],h);const p=g(t,["onlyBassAndDrums"]);p!=null&&y(e,["onlyBassAndDrums"],p);const x=g(t,["musicGenerationMode"]);return x!=null&&y(e,["musicGenerationMode"],x),e}function PZ(t){const e={},n=g(t,["clientContent"]);n!=null&&y(e,["clientContent"],FZ(n));const s=g(t,["musicGenerationConfig"]);return s!=null&&y(e,["musicGenerationConfig"],OZ(s)),e}function LZ(t){const e={},n=g(t,["data"]);n!=null&&y(e,["data"],n);const s=g(t,["mimeType"]);s!=null&&y(e,["mimeType"],s);const o=g(t,["sourceMetadata"]);return o!=null&&y(e,["sourceMetadata"],PZ(o)),e}function VZ(t){const e={},n=g(t,["audioChunks"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>LZ(o))),y(e,["audioChunks"],s)}return e}function zZ(t){const e={},n=g(t,["text"]);n!=null&&y(e,["text"],n);const s=g(t,["filteredReason"]);return s!=null&&y(e,["filteredReason"],s),e}function BZ(t){const e={};g(t,["setupComplete"])!=null&&y(e,["setupComplete"],_Z());const s=g(t,["serverContent"]);s!=null&&y(e,["serverContent"],VZ(s));const o=g(t,["filteredPrompt"]);return o!=null&&y(e,["filteredPrompt"],zZ(o)),e}function UZ(t){const e={},n=g(t,["sessionId"]);return n!=null&&y(e,["sessionId"],n),e}function GZ(t){const e={},n=g(t,["fps"]);n!=null&&y(e,["fps"],n);const s=g(t,["endOffset"]);s!=null&&y(e,["endOffset"],s);const o=g(t,["startOffset"]);return o!=null&&y(e,["startOffset"],o),e}function HZ(t){const e={},n=g(t,["displayName"]);n!=null&&y(e,["displayName"],n);const s=g(t,["data"]);s!=null&&y(e,["data"],s);const o=g(t,["mimeType"]);return o!=null&&y(e,["mimeType"],o),e}function WZ(t){const e={},n=g(t,["displayName"]);n!=null&&y(e,["displayName"],n);const s=g(t,["fileUri"]);s!=null&&y(e,["fileUri"],s);const o=g(t,["mimeType"]);return o!=null&&y(e,["mimeType"],o),e}function q3(t){const e={},n=g(t,["id"]);n!=null&&y(e,["id"],n);const s=g(t,["args"]);s!=null&&y(e,["args"],s);const o=g(t,["name"]);return o!=null&&y(e,["name"],o),e}function qZ(t){const e={},n=g(t,["videoMetadata"]);n!=null&&y(e,["videoMetadata"],GZ(n));const s=g(t,["thought"]);s!=null&&y(e,["thought"],s);const o=g(t,["inlineData"]);o!=null&&y(e,["inlineData"],HZ(o));const r=g(t,["fileData"]);r!=null&&y(e,["fileData"],WZ(r));const i=g(t,["thoughtSignature"]);i!=null&&y(e,["thoughtSignature"],i);const a=g(t,["functionCall"]);a!=null&&y(e,["functionCall"],q3(a));const l=g(t,["codeExecutionResult"]);l!=null&&y(e,["codeExecutionResult"],l);const u=g(t,["executableCode"]);u!=null&&y(e,["executableCode"],u);const d=g(t,["functionResponse"]);d!=null&&y(e,["functionResponse"],d);const h=g(t,["text"]);return h!=null&&y(e,["text"],h),e}function KZ(t){const e={},n=g(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>qZ(r))),y(e,["parts"],o)}const s=g(t,["role"]);return s!=null&&y(e,["role"],s),e}function pF(t){const e={},n=g(t,["text"]);n!=null&&y(e,["text"],n);const s=g(t,["finished"]);return s!=null&&y(e,["finished"],s),e}function XZ(t){const e={},n=g(t,["modelTurn"]);n!=null&&y(e,["modelTurn"],KZ(n));const s=g(t,["turnComplete"]);s!=null&&y(e,["turnComplete"],s);const o=g(t,["interrupted"]);o!=null&&y(e,["interrupted"],o);const r=g(t,["groundingMetadata"]);r!=null&&y(e,["groundingMetadata"],r);const i=g(t,["generationComplete"]);i!=null&&y(e,["generationComplete"],i);const a=g(t,["inputTranscription"]);a!=null&&y(e,["inputTranscription"],pF(a));const l=g(t,["outputTranscription"]);return l!=null&&y(e,["outputTranscription"],pF(l)),e}function YZ(t){const e={},n=g(t,["functionCalls"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>q3(o))),y(e,["functionCalls"],s)}return e}function JZ(t){const e={},n=g(t,["ids"]);return n!=null&&y(e,["ids"],n),e}function qy(t){const e={},n=g(t,["modality"]);n!=null&&y(e,["modality"],n);const s=g(t,["tokenCount"]);return s!=null&&y(e,["tokenCount"],s),e}function jZ(t){const e={},n=g(t,["promptTokenCount"]);n!=null&&y(e,["promptTokenCount"],n);const s=g(t,["cachedContentTokenCount"]);s!=null&&y(e,["cachedContentTokenCount"],s);const o=g(t,["candidatesTokenCount"]);o!=null&&y(e,["responseTokenCount"],o);const r=g(t,["toolUsePromptTokenCount"]);r!=null&&y(e,["toolUsePromptTokenCount"],r);const i=g(t,["thoughtsTokenCount"]);i!=null&&y(e,["thoughtsTokenCount"],i);const a=g(t,["totalTokenCount"]);a!=null&&y(e,["totalTokenCount"],a);const l=g(t,["promptTokensDetails"]);if(l!=null){let x=l;Array.isArray(x)&&(x=x.map(b=>qy(b))),y(e,["promptTokensDetails"],x)}const u=g(t,["cacheTokensDetails"]);if(u!=null){let x=u;Array.isArray(x)&&(x=x.map(b=>qy(b))),y(e,["cacheTokensDetails"],x)}const d=g(t,["candidatesTokensDetails"]);if(d!=null){let x=d;Array.isArray(x)&&(x=x.map(b=>qy(b))),y(e,["responseTokensDetails"],x)}const h=g(t,["toolUsePromptTokensDetails"]);if(h!=null){let x=h;Array.isArray(x)&&(x=x.map(b=>qy(b))),y(e,["toolUsePromptTokensDetails"],x)}const p=g(t,["trafficType"]);return p!=null&&y(e,["trafficType"],p),e}function ZZ(t){const e={},n=g(t,["timeLeft"]);return n!=null&&y(e,["timeLeft"],n),e}function QZ(t){const e={},n=g(t,["newHandle"]);n!=null&&y(e,["newHandle"],n);const s=g(t,["resumable"]);s!=null&&y(e,["resumable"],s);const o=g(t,["lastConsumedClientMessageIndex"]);return o!=null&&y(e,["lastConsumedClientMessageIndex"],o),e}function eQ(t){const e={},n=g(t,["setupComplete"]);n!=null&&y(e,["setupComplete"],UZ(n));const s=g(t,["serverContent"]);s!=null&&y(e,["serverContent"],XZ(s));const o=g(t,["toolCall"]);o!=null&&y(e,["toolCall"],YZ(o));const r=g(t,["toolCallCancellation"]);r!=null&&y(e,["toolCallCancellation"],JZ(r));const i=g(t,["usageMetadata"]);i!=null&&y(e,["usageMetadata"],jZ(i));const a=g(t,["goAway"]);a!=null&&y(e,["goAway"],ZZ(a));const l=g(t,["sessionResumptionUpdate"]);return l!=null&&y(e,["sessionResumptionUpdate"],QZ(l)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function tQ(t){const e={},n=g(t,["fps"]);n!=null&&y(e,["fps"],n);const s=g(t,["endOffset"]);s!=null&&y(e,["endOffset"],s);const o=g(t,["startOffset"]);return o!=null&&y(e,["startOffset"],o),e}function nQ(t){const e={};if(g(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=g(t,["data"]);n!=null&&y(e,["data"],n);const s=g(t,["mimeType"]);return s!=null&&y(e,["mimeType"],s),e}function sQ(t){const e={};if(g(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=g(t,["fileUri"]);n!=null&&y(e,["fileUri"],n);const s=g(t,["mimeType"]);return s!=null&&y(e,["mimeType"],s),e}function oQ(t){const e={},n=g(t,["id"]);n!=null&&y(e,["id"],n);const s=g(t,["args"]);s!=null&&y(e,["args"],s);const o=g(t,["name"]);return o!=null&&y(e,["name"],o),e}function rQ(t){const e={},n=g(t,["videoMetadata"]);n!=null&&y(e,["videoMetadata"],tQ(n));const s=g(t,["thought"]);s!=null&&y(e,["thought"],s);const o=g(t,["inlineData"]);o!=null&&y(e,["inlineData"],nQ(o));const r=g(t,["fileData"]);r!=null&&y(e,["fileData"],sQ(r));const i=g(t,["thoughtSignature"]);i!=null&&y(e,["thoughtSignature"],i);const a=g(t,["functionCall"]);a!=null&&y(e,["functionCall"],oQ(a));const l=g(t,["codeExecutionResult"]);l!=null&&y(e,["codeExecutionResult"],l);const u=g(t,["executableCode"]);u!=null&&y(e,["executableCode"],u);const d=g(t,["functionResponse"]);d!=null&&y(e,["functionResponse"],d);const h=g(t,["text"]);return h!=null&&y(e,["text"],h),e}function kx(t){const e={},n=g(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>rQ(r))),y(e,["parts"],o)}const s=g(t,["role"]);return s!=null&&y(e,["role"],s),e}function iQ(t){const e={},n=g(t,["anyOf"]);n!=null&&y(e,["anyOf"],n);const s=g(t,["default"]);s!=null&&y(e,["default"],s);const o=g(t,["description"]);o!=null&&y(e,["description"],o);const r=g(t,["enum"]);r!=null&&y(e,["enum"],r);const i=g(t,["example"]);i!=null&&y(e,["example"],i);const a=g(t,["format"]);a!=null&&y(e,["format"],a);const l=g(t,["items"]);l!=null&&y(e,["items"],l);const u=g(t,["maxItems"]);u!=null&&y(e,["maxItems"],u);const d=g(t,["maxLength"]);d!=null&&y(e,["maxLength"],d);const h=g(t,["maxProperties"]);h!=null&&y(e,["maxProperties"],h);const p=g(t,["maximum"]);p!=null&&y(e,["maximum"],p);const x=g(t,["minItems"]);x!=null&&y(e,["minItems"],x);const b=g(t,["minLength"]);b!=null&&y(e,["minLength"],b);const w=g(t,["minProperties"]);w!=null&&y(e,["minProperties"],w);const C=g(t,["minimum"]);C!=null&&y(e,["minimum"],C);const T=g(t,["nullable"]);T!=null&&y(e,["nullable"],T);const N=g(t,["pattern"]);N!=null&&y(e,["pattern"],N);const I=g(t,["properties"]);I!=null&&y(e,["properties"],I);const k=g(t,["propertyOrdering"]);k!=null&&y(e,["propertyOrdering"],k);const A=g(t,["required"]);A!=null&&y(e,["required"],A);const $=g(t,["title"]);$!=null&&y(e,["title"],$);const M=g(t,["type"]);return M!=null&&y(e,["type"],M),e}function aQ(t){const e={};if(g(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const n=g(t,["category"]);n!=null&&y(e,["category"],n);const s=g(t,["threshold"]);return s!=null&&y(e,["threshold"],s),e}function lQ(t){const e={},n=g(t,["behavior"]);n!=null&&y(e,["behavior"],n);const s=g(t,["description"]);s!=null&&y(e,["description"],s);const o=g(t,["name"]);o!=null&&y(e,["name"],o);const r=g(t,["parameters"]);r!=null&&y(e,["parameters"],r);const i=g(t,["parametersJsonSchema"]);i!=null&&y(e,["parametersJsonSchema"],i);const a=g(t,["response"]);a!=null&&y(e,["response"],a);const l=g(t,["responseJsonSchema"]);return l!=null&&y(e,["responseJsonSchema"],l),e}function uQ(t){const e={},n=g(t,["startTime"]);n!=null&&y(e,["startTime"],n);const s=g(t,["endTime"]);return s!=null&&y(e,["endTime"],s),e}function cQ(t){const e={},n=g(t,["timeRangeFilter"]);if(n!=null&&y(e,["timeRangeFilter"],uQ(n)),g(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function dQ(t){const e={},n=g(t,["mode"]);n!=null&&y(e,["mode"],n);const s=g(t,["dynamicThreshold"]);return s!=null&&y(e,["dynamicThreshold"],s),e}function fQ(t){const e={},n=g(t,["dynamicRetrievalConfig"]);return n!=null&&y(e,["dynamicRetrievalConfig"],dQ(n)),e}function hQ(){return{}}function pQ(t){const e={},n=g(t,["environment"]);return n!=null&&y(e,["environment"],n),e}function mQ(t){const e={},n=g(t,["functionDeclarations"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(u=>lQ(u))),y(e,["functionDeclarations"],l)}if(g(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=g(t,["googleSearch"]);s!=null&&y(e,["googleSearch"],cQ(s));const o=g(t,["googleSearchRetrieval"]);if(o!=null&&y(e,["googleSearchRetrieval"],fQ(o)),g(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(g(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");g(t,["urlContext"])!=null&&y(e,["urlContext"],hQ());const i=g(t,["computerUse"]);i!=null&&y(e,["computerUse"],pQ(i));const a=g(t,["codeExecution"]);return a!=null&&y(e,["codeExecution"],a),e}function gQ(t){const e={},n=g(t,["mode"]);n!=null&&y(e,["mode"],n);const s=g(t,["allowedFunctionNames"]);return s!=null&&y(e,["allowedFunctionNames"],s),e}function yQ(t){const e={},n=g(t,["latitude"]);n!=null&&y(e,["latitude"],n);const s=g(t,["longitude"]);return s!=null&&y(e,["longitude"],s),e}function xQ(t){const e={},n=g(t,["latLng"]);n!=null&&y(e,["latLng"],yQ(n));const s=g(t,["languageCode"]);return s!=null&&y(e,["languageCode"],s),e}function vQ(t){const e={},n=g(t,["functionCallingConfig"]);n!=null&&y(e,["functionCallingConfig"],gQ(n));const s=g(t,["retrievalConfig"]);return s!=null&&y(e,["retrievalConfig"],xQ(s)),e}function bQ(t){const e={},n=g(t,["voiceName"]);return n!=null&&y(e,["voiceName"],n),e}function K3(t){const e={},n=g(t,["prebuiltVoiceConfig"]);return n!=null&&y(e,["prebuiltVoiceConfig"],bQ(n)),e}function wQ(t){const e={},n=g(t,["speaker"]);n!=null&&y(e,["speaker"],n);const s=g(t,["voiceConfig"]);return s!=null&&y(e,["voiceConfig"],K3(s)),e}function CQ(t){const e={},n=g(t,["speakerVoiceConfigs"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>wQ(o))),y(e,["speakerVoiceConfigs"],s)}return e}function TQ(t){const e={},n=g(t,["voiceConfig"]);n!=null&&y(e,["voiceConfig"],K3(n));const s=g(t,["multiSpeakerVoiceConfig"]);s!=null&&y(e,["multiSpeakerVoiceConfig"],CQ(s));const o=g(t,["languageCode"]);return o!=null&&y(e,["languageCode"],o),e}function SQ(t){const e={},n=g(t,["includeThoughts"]);n!=null&&y(e,["includeThoughts"],n);const s=g(t,["thinkingBudget"]);return s!=null&&y(e,["thinkingBudget"],s),e}function NQ(t,e,n){const s={},o=g(e,["systemInstruction"]);n!==void 0&&o!=null&&y(n,["systemInstruction"],kx(_s(o)));const r=g(e,["temperature"]);r!=null&&y(s,["temperature"],r);const i=g(e,["topP"]);i!=null&&y(s,["topP"],i);const a=g(e,["topK"]);a!=null&&y(s,["topK"],a);const l=g(e,["candidateCount"]);l!=null&&y(s,["candidateCount"],l);const u=g(e,["maxOutputTokens"]);u!=null&&y(s,["maxOutputTokens"],u);const d=g(e,["stopSequences"]);d!=null&&y(s,["stopSequences"],d);const h=g(e,["responseLogprobs"]);h!=null&&y(s,["responseLogprobs"],h);const p=g(e,["logprobs"]);p!=null&&y(s,["logprobs"],p);const x=g(e,["presencePenalty"]);x!=null&&y(s,["presencePenalty"],x);const b=g(e,["frequencyPenalty"]);b!=null&&y(s,["frequencyPenalty"],b);const w=g(e,["seed"]);w!=null&&y(s,["seed"],w);const C=g(e,["responseMimeType"]);C!=null&&y(s,["responseMimeType"],C);const T=g(e,["responseSchema"]);T!=null&&y(s,["responseSchema"],iQ($N(T)));const N=g(e,["responseJsonSchema"]);if(N!=null&&y(s,["responseJsonSchema"],N),g(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(g(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const I=g(e,["safetySettings"]);if(n!==void 0&&I!=null){let D=I;Array.isArray(D)&&(D=D.map(H=>aQ(H))),y(n,["safetySettings"],D)}const k=g(e,["tools"]);if(n!==void 0&&k!=null){let D=ad(k);Array.isArray(D)&&(D=D.map(H=>mQ(id(H)))),y(n,["tools"],D)}const A=g(e,["toolConfig"]);if(n!==void 0&&A!=null&&y(n,["toolConfig"],vQ(A)),g(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const $=g(e,["cachedContent"]);n!==void 0&&$!=null&&y(n,["cachedContent"],Ui(t,$));const M=g(e,["responseModalities"]);M!=null&&y(s,["responseModalities"],M);const O=g(e,["mediaResolution"]);O!=null&&y(s,["mediaResolution"],O);const F=g(e,["speechConfig"]);if(F!=null&&y(s,["speechConfig"],TQ(DN(F))),g(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const P=g(e,["thinkingConfig"]);return P!=null&&y(s,["thinkingConfig"],SQ(P)),s}function mF(t,e){const n={},s=g(e,["model"]);s!=null&&y(n,["_url","model"],Et(t,s));const o=g(e,["contents"]);if(o!=null){let i=tr(o);Array.isArray(i)&&(i=i.map(a=>kx(a))),y(n,["contents"],i)}const r=g(e,["config"]);return r!=null&&y(n,["generationConfig"],NQ(t,r,n)),n}function EQ(t,e){const n={},s=g(t,["taskType"]);e!==void 0&&s!=null&&y(e,["requests[]","taskType"],s);const o=g(t,["title"]);e!==void 0&&o!=null&&y(e,["requests[]","title"],o);const r=g(t,["outputDimensionality"]);if(e!==void 0&&r!=null&&y(e,["requests[]","outputDimensionality"],r),g(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(g(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function IQ(t,e){const n={},s=g(e,["model"]);s!=null&&y(n,["_url","model"],Et(t,s));const o=g(e,["contents"]);o!=null&&y(n,["requests[]","content"],RN(t,o));const r=g(e,["config"]);r!=null&&y(n,["config"],EQ(r,n));const i=g(e,["model"]);return i!==void 0&&y(n,["requests[]","model"],Et(t,i)),n}function kQ(t,e){const n={};if(g(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(g(t,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const s=g(t,["numberOfImages"]);e!==void 0&&s!=null&&y(e,["parameters","sampleCount"],s);const o=g(t,["aspectRatio"]);e!==void 0&&o!=null&&y(e,["parameters","aspectRatio"],o);const r=g(t,["guidanceScale"]);if(e!==void 0&&r!=null&&y(e,["parameters","guidanceScale"],r),g(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const i=g(t,["safetyFilterLevel"]);e!==void 0&&i!=null&&y(e,["parameters","safetySetting"],i);const a=g(t,["personGeneration"]);e!==void 0&&a!=null&&y(e,["parameters","personGeneration"],a);const l=g(t,["includeSafetyAttributes"]);e!==void 0&&l!=null&&y(e,["parameters","includeSafetyAttributes"],l);const u=g(t,["includeRaiReason"]);e!==void 0&&u!=null&&y(e,["parameters","includeRaiReason"],u);const d=g(t,["language"]);e!==void 0&&d!=null&&y(e,["parameters","language"],d);const h=g(t,["outputMimeType"]);e!==void 0&&h!=null&&y(e,["parameters","outputOptions","mimeType"],h);const p=g(t,["outputCompressionQuality"]);if(e!==void 0&&p!=null&&y(e,["parameters","outputOptions","compressionQuality"],p),g(t,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");const x=g(t,["imageSize"]);if(e!==void 0&&x!=null&&y(e,["parameters","sampleImageSize"],x),g(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function AQ(t,e){const n={},s=g(e,["model"]);s!=null&&y(n,["_url","model"],Et(t,s));const o=g(e,["prompt"]);o!=null&&y(n,["instances[0]","prompt"],o);const r=g(e,["config"]);return r!=null&&y(n,["config"],kQ(r,n)),n}function RQ(t,e){const n={},s=g(e,["model"]);s!=null&&y(n,["_url","name"],Et(t,s));const o=g(e,["config"]);return o!=null&&y(n,["config"],o),n}function $Q(t,e,n){const s={},o=g(e,["pageSize"]);n!==void 0&&o!=null&&y(n,["_query","pageSize"],o);const r=g(e,["pageToken"]);n!==void 0&&r!=null&&y(n,["_query","pageToken"],r);const i=g(e,["filter"]);n!==void 0&&i!=null&&y(n,["_query","filter"],i);const a=g(e,["queryBase"]);return n!==void 0&&a!=null&&y(n,["_url","models_url"],$3(t,a)),s}function DQ(t,e){const n={},s=g(e,["config"]);return s!=null&&y(n,["config"],$Q(t,s,n)),n}function _Q(t,e){const n={},s=g(t,["displayName"]);e!==void 0&&s!=null&&y(e,["displayName"],s);const o=g(t,["description"]);e!==void 0&&o!=null&&y(e,["description"],o);const r=g(t,["defaultCheckpointId"]);return e!==void 0&&r!=null&&y(e,["defaultCheckpointId"],r),n}function MQ(t,e){const n={},s=g(e,["model"]);s!=null&&y(n,["_url","name"],Et(t,s));const o=g(e,["config"]);return o!=null&&y(n,["config"],_Q(o,n)),n}function FQ(t,e){const n={},s=g(e,["model"]);s!=null&&y(n,["_url","name"],Et(t,s));const o=g(e,["config"]);return o!=null&&y(n,["config"],o),n}function OQ(t){const e={};if(g(t,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(g(t,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(g(t,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function PQ(t,e){const n={},s=g(e,["model"]);s!=null&&y(n,["_url","model"],Et(t,s));const o=g(e,["contents"]);if(o!=null){let i=tr(o);Array.isArray(i)&&(i=i.map(a=>kx(a))),y(n,["contents"],i)}const r=g(e,["config"]);return r!=null&&y(n,["config"],OQ(r)),n}function X3(t){const e={};if(g(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=g(t,["imageBytes"]);n!=null&&y(e,["bytesBase64Encoded"],yu(n));const s=g(t,["mimeType"]);return s!=null&&y(e,["mimeType"],s),e}function LQ(t,e){const n={},s=g(t,["prompt"]);e!==void 0&&s!=null&&y(e,["instances[0]","prompt"],s);const o=g(t,["image"]);if(e!==void 0&&o!=null&&y(e,["instances[0]","image"],X3(o)),g(t,["video"])!==void 0)throw new Error("video parameter is not supported in Gemini API.");return n}function VQ(t,e){const n={},s=g(t,["numberOfVideos"]);if(e!==void 0&&s!=null&&y(e,["parameters","sampleCount"],s),g(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(g(t,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const o=g(t,["durationSeconds"]);if(e!==void 0&&o!=null&&y(e,["parameters","durationSeconds"],o),g(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const r=g(t,["aspectRatio"]);e!==void 0&&r!=null&&y(e,["parameters","aspectRatio"],r);const i=g(t,["resolution"]);e!==void 0&&i!=null&&y(e,["parameters","resolution"],i);const a=g(t,["personGeneration"]);if(e!==void 0&&a!=null&&y(e,["parameters","personGeneration"],a),g(t,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const l=g(t,["negativePrompt"]);e!==void 0&&l!=null&&y(e,["parameters","negativePrompt"],l);const u=g(t,["enhancePrompt"]);if(e!==void 0&&u!=null&&y(e,["parameters","enhancePrompt"],u),g(t,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");if(g(t,["lastFrame"])!==void 0)throw new Error("lastFrame parameter is not supported in Gemini API.");if(g(t,["referenceImages"])!==void 0)throw new Error("referenceImages parameter is not supported in Gemini API.");if(g(t,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(g(t,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return n}function zQ(t,e){const n={},s=g(e,["model"]);s!=null&&y(n,["_url","model"],Et(t,s));const o=g(e,["prompt"]);o!=null&&y(n,["instances[0]","prompt"],o);const r=g(e,["image"]);if(r!=null&&y(n,["instances[0]","image"],X3(r)),g(e,["video"])!==void 0)throw new Error("video parameter is not supported in Gemini API.");const i=g(e,["source"]);i!=null&&y(n,["config"],LQ(i,n));const a=g(e,["config"]);return a!=null&&y(n,["config"],VQ(a,n)),n}function BQ(t){const e={},n=g(t,["fps"]);n!=null&&y(e,["fps"],n);const s=g(t,["endOffset"]);s!=null&&y(e,["endOffset"],s);const o=g(t,["startOffset"]);return o!=null&&y(e,["startOffset"],o),e}function UQ(t){const e={},n=g(t,["displayName"]);n!=null&&y(e,["displayName"],n);const s=g(t,["data"]);s!=null&&y(e,["data"],s);const o=g(t,["mimeType"]);return o!=null&&y(e,["mimeType"],o),e}function GQ(t){const e={},n=g(t,["displayName"]);n!=null&&y(e,["displayName"],n);const s=g(t,["fileUri"]);s!=null&&y(e,["fileUri"],s);const o=g(t,["mimeType"]);return o!=null&&y(e,["mimeType"],o),e}function HQ(t){const e={},n=g(t,["id"]);n!=null&&y(e,["id"],n);const s=g(t,["args"]);s!=null&&y(e,["args"],s);const o=g(t,["name"]);return o!=null&&y(e,["name"],o),e}function WQ(t){const e={},n=g(t,["videoMetadata"]);n!=null&&y(e,["videoMetadata"],BQ(n));const s=g(t,["thought"]);s!=null&&y(e,["thought"],s);const o=g(t,["inlineData"]);o!=null&&y(e,["inlineData"],UQ(o));const r=g(t,["fileData"]);r!=null&&y(e,["fileData"],GQ(r));const i=g(t,["thoughtSignature"]);i!=null&&y(e,["thoughtSignature"],i);const a=g(t,["functionCall"]);a!=null&&y(e,["functionCall"],HQ(a));const l=g(t,["codeExecutionResult"]);l!=null&&y(e,["codeExecutionResult"],l);const u=g(t,["executableCode"]);u!=null&&y(e,["executableCode"],u);const d=g(t,["functionResponse"]);d!=null&&y(e,["functionResponse"],d);const h=g(t,["text"]);return h!=null&&y(e,["text"],h),e}function ud(t){const e={},n=g(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>WQ(r))),y(e,["parts"],o)}const s=g(t,["role"]);return s!=null&&y(e,["role"],s),e}function qQ(t){const e={},n=g(t,["anyOf"]);n!=null&&y(e,["anyOf"],n);const s=g(t,["default"]);s!=null&&y(e,["default"],s);const o=g(t,["description"]);o!=null&&y(e,["description"],o);const r=g(t,["enum"]);r!=null&&y(e,["enum"],r);const i=g(t,["example"]);i!=null&&y(e,["example"],i);const a=g(t,["format"]);a!=null&&y(e,["format"],a);const l=g(t,["items"]);l!=null&&y(e,["items"],l);const u=g(t,["maxItems"]);u!=null&&y(e,["maxItems"],u);const d=g(t,["maxLength"]);d!=null&&y(e,["maxLength"],d);const h=g(t,["maxProperties"]);h!=null&&y(e,["maxProperties"],h);const p=g(t,["maximum"]);p!=null&&y(e,["maximum"],p);const x=g(t,["minItems"]);x!=null&&y(e,["minItems"],x);const b=g(t,["minLength"]);b!=null&&y(e,["minLength"],b);const w=g(t,["minProperties"]);w!=null&&y(e,["minProperties"],w);const C=g(t,["minimum"]);C!=null&&y(e,["minimum"],C);const T=g(t,["nullable"]);T!=null&&y(e,["nullable"],T);const N=g(t,["pattern"]);N!=null&&y(e,["pattern"],N);const I=g(t,["properties"]);I!=null&&y(e,["properties"],I);const k=g(t,["propertyOrdering"]);k!=null&&y(e,["propertyOrdering"],k);const A=g(t,["required"]);A!=null&&y(e,["required"],A);const $=g(t,["title"]);$!=null&&y(e,["title"],$);const M=g(t,["type"]);return M!=null&&y(e,["type"],M),e}function KQ(t){const e={},n=g(t,["featureSelectionPreference"]);return n!=null&&y(e,["featureSelectionPreference"],n),e}function XQ(t){const e={},n=g(t,["method"]);n!=null&&y(e,["method"],n);const s=g(t,["category"]);s!=null&&y(e,["category"],s);const o=g(t,["threshold"]);return o!=null&&y(e,["threshold"],o),e}function YQ(t){const e={};if(g(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=g(t,["description"]);n!=null&&y(e,["description"],n);const s=g(t,["name"]);s!=null&&y(e,["name"],s);const o=g(t,["parameters"]);o!=null&&y(e,["parameters"],o);const r=g(t,["parametersJsonSchema"]);r!=null&&y(e,["parametersJsonSchema"],r);const i=g(t,["response"]);i!=null&&y(e,["response"],i);const a=g(t,["responseJsonSchema"]);return a!=null&&y(e,["responseJsonSchema"],a),e}function JQ(t){const e={},n=g(t,["startTime"]);n!=null&&y(e,["startTime"],n);const s=g(t,["endTime"]);return s!=null&&y(e,["endTime"],s),e}function jQ(t){const e={},n=g(t,["timeRangeFilter"]);n!=null&&y(e,["timeRangeFilter"],JQ(n));const s=g(t,["excludeDomains"]);return s!=null&&y(e,["excludeDomains"],s),e}function ZQ(t){const e={},n=g(t,["mode"]);n!=null&&y(e,["mode"],n);const s=g(t,["dynamicThreshold"]);return s!=null&&y(e,["dynamicThreshold"],s),e}function QQ(t){const e={},n=g(t,["dynamicRetrievalConfig"]);return n!=null&&y(e,["dynamicRetrievalConfig"],ZQ(n)),e}function eee(t){const e={},n=g(t,["excludeDomains"]);return n!=null&&y(e,["excludeDomains"],n),e}function tee(t){const e={},n=g(t,["apiKeyString"]);return n!=null&&y(e,["apiKeyString"],n),e}function nee(t){const e={},n=g(t,["apiKeyConfig"]);n!=null&&y(e,["apiKeyConfig"],tee(n));const s=g(t,["authType"]);s!=null&&y(e,["authType"],s);const o=g(t,["googleServiceAccountConfig"]);o!=null&&y(e,["googleServiceAccountConfig"],o);const r=g(t,["httpBasicAuthConfig"]);r!=null&&y(e,["httpBasicAuthConfig"],r);const i=g(t,["oauthConfig"]);i!=null&&y(e,["oauthConfig"],i);const a=g(t,["oidcConfig"]);return a!=null&&y(e,["oidcConfig"],a),e}function see(t){const e={},n=g(t,["authConfig"]);return n!=null&&y(e,["authConfig"],nee(n)),e}function oee(){return{}}function ree(t){const e={},n=g(t,["environment"]);return n!=null&&y(e,["environment"],n),e}function Y3(t){const e={},n=g(t,["functionDeclarations"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(p=>YQ(p))),y(e,["functionDeclarations"],h)}const s=g(t,["retrieval"]);s!=null&&y(e,["retrieval"],s);const o=g(t,["googleSearch"]);o!=null&&y(e,["googleSearch"],jQ(o));const r=g(t,["googleSearchRetrieval"]);r!=null&&y(e,["googleSearchRetrieval"],QQ(r));const i=g(t,["enterpriseWebSearch"]);i!=null&&y(e,["enterpriseWebSearch"],eee(i));const a=g(t,["googleMaps"]);a!=null&&y(e,["googleMaps"],see(a)),g(t,["urlContext"])!=null&&y(e,["urlContext"],oee());const u=g(t,["computerUse"]);u!=null&&y(e,["computerUse"],ree(u));const d=g(t,["codeExecution"]);return d!=null&&y(e,["codeExecution"],d),e}function iee(t){const e={},n=g(t,["mode"]);n!=null&&y(e,["mode"],n);const s=g(t,["allowedFunctionNames"]);return s!=null&&y(e,["allowedFunctionNames"],s),e}function aee(t){const e={},n=g(t,["latitude"]);n!=null&&y(e,["latitude"],n);const s=g(t,["longitude"]);return s!=null&&y(e,["longitude"],s),e}function lee(t){const e={},n=g(t,["latLng"]);n!=null&&y(e,["latLng"],aee(n));const s=g(t,["languageCode"]);return s!=null&&y(e,["languageCode"],s),e}function uee(t){const e={},n=g(t,["functionCallingConfig"]);n!=null&&y(e,["functionCallingConfig"],iee(n));const s=g(t,["retrievalConfig"]);return s!=null&&y(e,["retrievalConfig"],lee(s)),e}function cee(t){const e={},n=g(t,["voiceName"]);return n!=null&&y(e,["voiceName"],n),e}function dee(t){const e={},n=g(t,["prebuiltVoiceConfig"]);return n!=null&&y(e,["prebuiltVoiceConfig"],cee(n)),e}function fee(t){const e={},n=g(t,["voiceConfig"]);if(n!=null&&y(e,["voiceConfig"],dee(n)),g(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const s=g(t,["languageCode"]);return s!=null&&y(e,["languageCode"],s),e}function hee(t){const e={},n=g(t,["includeThoughts"]);n!=null&&y(e,["includeThoughts"],n);const s=g(t,["thinkingBudget"]);return s!=null&&y(e,["thinkingBudget"],s),e}function pee(t,e,n){const s={},o=g(e,["systemInstruction"]);n!==void 0&&o!=null&&y(n,["systemInstruction"],ud(_s(o)));const r=g(e,["temperature"]);r!=null&&y(s,["temperature"],r);const i=g(e,["topP"]);i!=null&&y(s,["topP"],i);const a=g(e,["topK"]);a!=null&&y(s,["topK"],a);const l=g(e,["candidateCount"]);l!=null&&y(s,["candidateCount"],l);const u=g(e,["maxOutputTokens"]);u!=null&&y(s,["maxOutputTokens"],u);const d=g(e,["stopSequences"]);d!=null&&y(s,["stopSequences"],d);const h=g(e,["responseLogprobs"]);h!=null&&y(s,["responseLogprobs"],h);const p=g(e,["logprobs"]);p!=null&&y(s,["logprobs"],p);const x=g(e,["presencePenalty"]);x!=null&&y(s,["presencePenalty"],x);const b=g(e,["frequencyPenalty"]);b!=null&&y(s,["frequencyPenalty"],b);const w=g(e,["seed"]);w!=null&&y(s,["seed"],w);const C=g(e,["responseMimeType"]);C!=null&&y(s,["responseMimeType"],C);const T=g(e,["responseSchema"]);T!=null&&y(s,["responseSchema"],qQ($N(T)));const N=g(e,["responseJsonSchema"]);N!=null&&y(s,["responseJsonSchema"],N);const I=g(e,["routingConfig"]);I!=null&&y(s,["routingConfig"],I);const k=g(e,["modelSelectionConfig"]);k!=null&&y(s,["modelConfig"],KQ(k));const A=g(e,["safetySettings"]);if(n!==void 0&&A!=null){let Q=A;Array.isArray(Q)&&(Q=Q.map(G=>XQ(G))),y(n,["safetySettings"],Q)}const $=g(e,["tools"]);if(n!==void 0&&$!=null){let Q=ad($);Array.isArray(Q)&&(Q=Q.map(G=>Y3(id(G)))),y(n,["tools"],Q)}const M=g(e,["toolConfig"]);n!==void 0&&M!=null&&y(n,["toolConfig"],uee(M));const O=g(e,["labels"]);n!==void 0&&O!=null&&y(n,["labels"],O);const F=g(e,["cachedContent"]);n!==void 0&&F!=null&&y(n,["cachedContent"],Ui(t,F));const P=g(e,["responseModalities"]);P!=null&&y(s,["responseModalities"],P);const D=g(e,["mediaResolution"]);D!=null&&y(s,["mediaResolution"],D);const H=g(e,["speechConfig"]);H!=null&&y(s,["speechConfig"],fee(DN(H)));const Z=g(e,["audioTimestamp"]);Z!=null&&y(s,["audioTimestamp"],Z);const ne=g(e,["thinkingConfig"]);return ne!=null&&y(s,["thinkingConfig"],hee(ne)),s}function gF(t,e){const n={},s=g(e,["model"]);s!=null&&y(n,["_url","model"],Et(t,s));const o=g(e,["contents"]);if(o!=null){let i=tr(o);Array.isArray(i)&&(i=i.map(a=>ud(a))),y(n,["contents"],i)}const r=g(e,["config"]);return r!=null&&y(n,["generationConfig"],pee(t,r,n)),n}function mee(t,e){const n={},s=g(t,["taskType"]);e!==void 0&&s!=null&&y(e,["instances[]","task_type"],s);const o=g(t,["title"]);e!==void 0&&o!=null&&y(e,["instances[]","title"],o);const r=g(t,["outputDimensionality"]);e!==void 0&&r!=null&&y(e,["parameters","outputDimensionality"],r);const i=g(t,["mimeType"]);e!==void 0&&i!=null&&y(e,["instances[]","mimeType"],i);const a=g(t,["autoTruncate"]);return e!==void 0&&a!=null&&y(e,["parameters","autoTruncate"],a),n}function gee(t,e){const n={},s=g(e,["model"]);s!=null&&y(n,["_url","model"],Et(t,s));const o=g(e,["contents"]);o!=null&&y(n,["instances[]","content"],RN(t,o));const r=g(e,["config"]);return r!=null&&y(n,["config"],mee(r,n)),n}function yee(t,e){const n={},s=g(t,["outputGcsUri"]);e!==void 0&&s!=null&&y(e,["parameters","storageUri"],s);const o=g(t,["negativePrompt"]);e!==void 0&&o!=null&&y(e,["parameters","negativePrompt"],o);const r=g(t,["numberOfImages"]);e!==void 0&&r!=null&&y(e,["parameters","sampleCount"],r);const i=g(t,["aspectRatio"]);e!==void 0&&i!=null&&y(e,["parameters","aspectRatio"],i);const a=g(t,["guidanceScale"]);e!==void 0&&a!=null&&y(e,["parameters","guidanceScale"],a);const l=g(t,["seed"]);e!==void 0&&l!=null&&y(e,["parameters","seed"],l);const u=g(t,["safetyFilterLevel"]);e!==void 0&&u!=null&&y(e,["parameters","safetySetting"],u);const d=g(t,["personGeneration"]);e!==void 0&&d!=null&&y(e,["parameters","personGeneration"],d);const h=g(t,["includeSafetyAttributes"]);e!==void 0&&h!=null&&y(e,["parameters","includeSafetyAttributes"],h);const p=g(t,["includeRaiReason"]);e!==void 0&&p!=null&&y(e,["parameters","includeRaiReason"],p);const x=g(t,["language"]);e!==void 0&&x!=null&&y(e,["parameters","language"],x);const b=g(t,["outputMimeType"]);e!==void 0&&b!=null&&y(e,["parameters","outputOptions","mimeType"],b);const w=g(t,["outputCompressionQuality"]);e!==void 0&&w!=null&&y(e,["parameters","outputOptions","compressionQuality"],w);const C=g(t,["addWatermark"]);e!==void 0&&C!=null&&y(e,["parameters","addWatermark"],C);const T=g(t,["imageSize"]);e!==void 0&&T!=null&&y(e,["parameters","sampleImageSize"],T);const N=g(t,["enhancePrompt"]);return e!==void 0&&N!=null&&y(e,["parameters","enhancePrompt"],N),n}function xee(t,e){const n={},s=g(e,["model"]);s!=null&&y(n,["_url","model"],Et(t,s));const o=g(e,["prompt"]);o!=null&&y(n,["instances[0]","prompt"],o);const r=g(e,["config"]);return r!=null&&y(n,["config"],yee(r,n)),n}function Ir(t){const e={},n=g(t,["gcsUri"]);n!=null&&y(e,["gcsUri"],n);const s=g(t,["imageBytes"]);s!=null&&y(e,["bytesBase64Encoded"],yu(s));const o=g(t,["mimeType"]);return o!=null&&y(e,["mimeType"],o),e}function vee(t){const e={},n=g(t,["maskMode"]);n!=null&&y(e,["maskMode"],n);const s=g(t,["segmentationClasses"]);s!=null&&y(e,["maskClasses"],s);const o=g(t,["maskDilation"]);return o!=null&&y(e,["dilation"],o),e}function bee(t){const e={},n=g(t,["controlType"]);n!=null&&y(e,["controlType"],n);const s=g(t,["enableControlImageComputation"]);return s!=null&&y(e,["computeControl"],s),e}function wee(t){const e={},n=g(t,["styleDescription"]);return n!=null&&y(e,["styleDescription"],n),e}function Cee(t){const e={},n=g(t,["subjectType"]);n!=null&&y(e,["subjectType"],n);const s=g(t,["subjectDescription"]);return s!=null&&y(e,["subjectDescription"],s),e}function Tee(t){const e={},n=g(t,["referenceImage"]);n!=null&&y(e,["referenceImage"],Ir(n));const s=g(t,["referenceId"]);s!=null&&y(e,["referenceId"],s);const o=g(t,["referenceType"]);o!=null&&y(e,["referenceType"],o);const r=g(t,["maskImageConfig"]);r!=null&&y(e,["maskImageConfig"],vee(r));const i=g(t,["controlImageConfig"]);i!=null&&y(e,["controlImageConfig"],bee(i));const a=g(t,["styleImageConfig"]);a!=null&&y(e,["styleImageConfig"],wee(a));const l=g(t,["subjectImageConfig"]);return l!=null&&y(e,["subjectImageConfig"],Cee(l)),e}function See(t,e){const n={},s=g(t,["outputGcsUri"]);e!==void 0&&s!=null&&y(e,["parameters","storageUri"],s);const o=g(t,["negativePrompt"]);e!==void 0&&o!=null&&y(e,["parameters","negativePrompt"],o);const r=g(t,["numberOfImages"]);e!==void 0&&r!=null&&y(e,["parameters","sampleCount"],r);const i=g(t,["aspectRatio"]);e!==void 0&&i!=null&&y(e,["parameters","aspectRatio"],i);const a=g(t,["guidanceScale"]);e!==void 0&&a!=null&&y(e,["parameters","guidanceScale"],a);const l=g(t,["seed"]);e!==void 0&&l!=null&&y(e,["parameters","seed"],l);const u=g(t,["safetyFilterLevel"]);e!==void 0&&u!=null&&y(e,["parameters","safetySetting"],u);const d=g(t,["personGeneration"]);e!==void 0&&d!=null&&y(e,["parameters","personGeneration"],d);const h=g(t,["includeSafetyAttributes"]);e!==void 0&&h!=null&&y(e,["parameters","includeSafetyAttributes"],h);const p=g(t,["includeRaiReason"]);e!==void 0&&p!=null&&y(e,["parameters","includeRaiReason"],p);const x=g(t,["language"]);e!==void 0&&x!=null&&y(e,["parameters","language"],x);const b=g(t,["outputMimeType"]);e!==void 0&&b!=null&&y(e,["parameters","outputOptions","mimeType"],b);const w=g(t,["outputCompressionQuality"]);e!==void 0&&w!=null&&y(e,["parameters","outputOptions","compressionQuality"],w);const C=g(t,["addWatermark"]);e!==void 0&&C!=null&&y(e,["parameters","addWatermark"],C);const T=g(t,["editMode"]);e!==void 0&&T!=null&&y(e,["parameters","editMode"],T);const N=g(t,["baseSteps"]);return e!==void 0&&N!=null&&y(e,["parameters","editConfig","baseSteps"],N),n}function Nee(t,e){const n={},s=g(e,["model"]);s!=null&&y(n,["_url","model"],Et(t,s));const o=g(e,["prompt"]);o!=null&&y(n,["instances[0]","prompt"],o);const r=g(e,["referenceImages"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(l=>Tee(l))),y(n,["instances[0]","referenceImages"],a)}const i=g(e,["config"]);return i!=null&&y(n,["config"],See(i,n)),n}function Eee(t,e){const n={},s=g(t,["outputGcsUri"]);e!==void 0&&s!=null&&y(e,["parameters","storageUri"],s);const o=g(t,["includeRaiReason"]);e!==void 0&&o!=null&&y(e,["parameters","includeRaiReason"],o);const r=g(t,["outputMimeType"]);e!==void 0&&r!=null&&y(e,["parameters","outputOptions","mimeType"],r);const i=g(t,["outputCompressionQuality"]);e!==void 0&&i!=null&&y(e,["parameters","outputOptions","compressionQuality"],i);const a=g(t,["enhanceInputImage"]);e!==void 0&&a!=null&&y(e,["parameters","upscaleConfig","enhanceInputImage"],a);const l=g(t,["imagePreservationFactor"]);e!==void 0&&l!=null&&y(e,["parameters","upscaleConfig","imagePreservationFactor"],l);const u=g(t,["numberOfImages"]);e!==void 0&&u!=null&&y(e,["parameters","sampleCount"],u);const d=g(t,["mode"]);return e!==void 0&&d!=null&&y(e,["parameters","mode"],d),n}function Iee(t,e){const n={},s=g(e,["model"]);s!=null&&y(n,["_url","model"],Et(t,s));const o=g(e,["image"]);o!=null&&y(n,["instances[0]","image"],Ir(o));const r=g(e,["upscaleFactor"]);r!=null&&y(n,["parameters","upscaleConfig","upscaleFactor"],r);const i=g(e,["config"]);return i!=null&&y(n,["config"],Eee(i,n)),n}function kee(t){const e={},n=g(t,["productImage"]);return n!=null&&y(e,["image"],Ir(n)),e}function Aee(t,e){const n={},s=g(t,["prompt"]);e!==void 0&&s!=null&&y(e,["instances[0]","prompt"],s);const o=g(t,["personImage"]);e!==void 0&&o!=null&&y(e,["instances[0]","personImage","image"],Ir(o));const r=g(t,["productImages"]);if(e!==void 0&&r!=null){let i=r;Array.isArray(i)&&(i=i.map(a=>kee(a))),y(e,["instances[0]","productImages"],i)}return n}function Ree(t,e){const n={},s=g(t,["numberOfImages"]);e!==void 0&&s!=null&&y(e,["parameters","sampleCount"],s);const o=g(t,["baseSteps"]);e!==void 0&&o!=null&&y(e,["parameters","editConfig","baseSteps"],o);const r=g(t,["outputGcsUri"]);e!==void 0&&r!=null&&y(e,["parameters","storageUri"],r);const i=g(t,["seed"]);e!==void 0&&i!=null&&y(e,["parameters","seed"],i);const a=g(t,["safetyFilterLevel"]);e!==void 0&&a!=null&&y(e,["parameters","safetySetting"],a);const l=g(t,["personGeneration"]);e!==void 0&&l!=null&&y(e,["parameters","personGeneration"],l);const u=g(t,["addWatermark"]);e!==void 0&&u!=null&&y(e,["parameters","addWatermark"],u);const d=g(t,["outputMimeType"]);e!==void 0&&d!=null&&y(e,["parameters","outputOptions","mimeType"],d);const h=g(t,["outputCompressionQuality"]);e!==void 0&&h!=null&&y(e,["parameters","outputOptions","compressionQuality"],h);const p=g(t,["enhancePrompt"]);return e!==void 0&&p!=null&&y(e,["parameters","enhancePrompt"],p),n}function $ee(t,e){const n={},s=g(e,["model"]);s!=null&&y(n,["_url","model"],Et(t,s));const o=g(e,["source"]);o!=null&&y(n,["config"],Aee(o,n));const r=g(e,["config"]);return r!=null&&y(n,["config"],Ree(r,n)),n}function Dee(t){const e={},n=g(t,["image"]);return n!=null&&y(e,["image"],Ir(n)),e}function _ee(t,e){const n={},s=g(t,["prompt"]);e!==void 0&&s!=null&&y(e,["instances[0]","prompt"],s);const o=g(t,["image"]);e!==void 0&&o!=null&&y(e,["instances[0]","image"],Ir(o));const r=g(t,["scribbleImage"]);return e!==void 0&&r!=null&&y(e,["instances[0]","scribble"],Dee(r)),n}function Mee(t,e){const n={},s=g(t,["mode"]);e!==void 0&&s!=null&&y(e,["parameters","mode"],s);const o=g(t,["maxPredictions"]);e!==void 0&&o!=null&&y(e,["parameters","maxPredictions"],o);const r=g(t,["confidenceThreshold"]);e!==void 0&&r!=null&&y(e,["parameters","confidenceThreshold"],r);const i=g(t,["maskDilation"]);e!==void 0&&i!=null&&y(e,["parameters","maskDilation"],i);const a=g(t,["binaryColorThreshold"]);return e!==void 0&&a!=null&&y(e,["parameters","binaryColorThreshold"],a),n}function Fee(t,e){const n={},s=g(e,["model"]);s!=null&&y(n,["_url","model"],Et(t,s));const o=g(e,["source"]);o!=null&&y(n,["config"],_ee(o,n));const r=g(e,["config"]);return r!=null&&y(n,["config"],Mee(r,n)),n}function Oee(t,e){const n={},s=g(e,["model"]);s!=null&&y(n,["_url","name"],Et(t,s));const o=g(e,["config"]);return o!=null&&y(n,["config"],o),n}function Pee(t,e,n){const s={},o=g(e,["pageSize"]);n!==void 0&&o!=null&&y(n,["_query","pageSize"],o);const r=g(e,["pageToken"]);n!==void 0&&r!=null&&y(n,["_query","pageToken"],r);const i=g(e,["filter"]);n!==void 0&&i!=null&&y(n,["_query","filter"],i);const a=g(e,["queryBase"]);return n!==void 0&&a!=null&&y(n,["_url","models_url"],$3(t,a)),s}function Lee(t,e){const n={},s=g(e,["config"]);return s!=null&&y(n,["config"],Pee(t,s,n)),n}function Vee(t,e){const n={},s=g(t,["displayName"]);e!==void 0&&s!=null&&y(e,["displayName"],s);const o=g(t,["description"]);e!==void 0&&o!=null&&y(e,["description"],o);const r=g(t,["defaultCheckpointId"]);return e!==void 0&&r!=null&&y(e,["defaultCheckpointId"],r),n}function zee(t,e){const n={},s=g(e,["model"]);s!=null&&y(n,["_url","model"],Et(t,s));const o=g(e,["config"]);return o!=null&&y(n,["config"],Vee(o,n)),n}function Bee(t,e){const n={},s=g(e,["model"]);s!=null&&y(n,["_url","name"],Et(t,s));const o=g(e,["config"]);return o!=null&&y(n,["config"],o),n}function Uee(t,e){const n={},s=g(t,["systemInstruction"]);e!==void 0&&s!=null&&y(e,["systemInstruction"],ud(_s(s)));const o=g(t,["tools"]);if(e!==void 0&&o!=null){let i=o;Array.isArray(i)&&(i=i.map(a=>Y3(a))),y(e,["tools"],i)}const r=g(t,["generationConfig"]);return e!==void 0&&r!=null&&y(e,["generationConfig"],r),n}function Gee(t,e){const n={},s=g(e,["model"]);s!=null&&y(n,["_url","model"],Et(t,s));const o=g(e,["contents"]);if(o!=null){let i=tr(o);Array.isArray(i)&&(i=i.map(a=>ud(a))),y(n,["contents"],i)}const r=g(e,["config"]);return r!=null&&y(n,["config"],Uee(r,n)),n}function Hee(t,e){const n={},s=g(e,["model"]);s!=null&&y(n,["_url","model"],Et(t,s));const o=g(e,["contents"]);if(o!=null){let i=tr(o);Array.isArray(i)&&(i=i.map(a=>ud(a))),y(n,["contents"],i)}const r=g(e,["config"]);return r!=null&&y(n,["config"],r),n}function J3(t){const e={},n=g(t,["uri"]);n!=null&&y(e,["gcsUri"],n);const s=g(t,["videoBytes"]);s!=null&&y(e,["bytesBase64Encoded"],yu(s));const o=g(t,["mimeType"]);return o!=null&&y(e,["mimeType"],o),e}function Wee(t,e){const n={},s=g(t,["prompt"]);e!==void 0&&s!=null&&y(e,["instances[0]","prompt"],s);const o=g(t,["image"]);e!==void 0&&o!=null&&y(e,["instances[0]","image"],Ir(o));const r=g(t,["video"]);return e!==void 0&&r!=null&&y(e,["instances[0]","video"],J3(r)),n}function qee(t){const e={},n=g(t,["image"]);n!=null&&y(e,["image"],Ir(n));const s=g(t,["referenceType"]);return s!=null&&y(e,["referenceType"],s),e}function Kee(t){const e={},n=g(t,["image"]);n!=null&&y(e,["_self"],Ir(n));const s=g(t,["maskMode"]);return s!=null&&y(e,["maskMode"],s),e}function Xee(t,e){const n={},s=g(t,["numberOfVideos"]);e!==void 0&&s!=null&&y(e,["parameters","sampleCount"],s);const o=g(t,["outputGcsUri"]);e!==void 0&&o!=null&&y(e,["parameters","storageUri"],o);const r=g(t,["fps"]);e!==void 0&&r!=null&&y(e,["parameters","fps"],r);const i=g(t,["durationSeconds"]);e!==void 0&&i!=null&&y(e,["parameters","durationSeconds"],i);const a=g(t,["seed"]);e!==void 0&&a!=null&&y(e,["parameters","seed"],a);const l=g(t,["aspectRatio"]);e!==void 0&&l!=null&&y(e,["parameters","aspectRatio"],l);const u=g(t,["resolution"]);e!==void 0&&u!=null&&y(e,["parameters","resolution"],u);const d=g(t,["personGeneration"]);e!==void 0&&d!=null&&y(e,["parameters","personGeneration"],d);const h=g(t,["pubsubTopic"]);e!==void 0&&h!=null&&y(e,["parameters","pubsubTopic"],h);const p=g(t,["negativePrompt"]);e!==void 0&&p!=null&&y(e,["parameters","negativePrompt"],p);const x=g(t,["enhancePrompt"]);e!==void 0&&x!=null&&y(e,["parameters","enhancePrompt"],x);const b=g(t,["generateAudio"]);e!==void 0&&b!=null&&y(e,["parameters","generateAudio"],b);const w=g(t,["lastFrame"]);e!==void 0&&w!=null&&y(e,["instances[0]","lastFrame"],Ir(w));const C=g(t,["referenceImages"]);if(e!==void 0&&C!=null){let I=C;Array.isArray(I)&&(I=I.map(k=>qee(k))),y(e,["instances[0]","referenceImages"],I)}const T=g(t,["mask"]);e!==void 0&&T!=null&&y(e,["instances[0]","mask"],Kee(T));const N=g(t,["compressionQuality"]);return e!==void 0&&N!=null&&y(e,["parameters","compressionQuality"],N),n}function Yee(t,e){const n={},s=g(e,["model"]);s!=null&&y(n,["_url","model"],Et(t,s));const o=g(e,["prompt"]);o!=null&&y(n,["instances[0]","prompt"],o);const r=g(e,["image"]);r!=null&&y(n,["instances[0]","image"],Ir(r));const i=g(e,["video"]);i!=null&&y(n,["instances[0]","video"],J3(i));const a=g(e,["source"]);a!=null&&y(n,["config"],Wee(a,n));const l=g(e,["config"]);return l!=null&&y(n,["config"],Xee(l,n)),n}function Jee(t){const e={},n=g(t,["fps"]);n!=null&&y(e,["fps"],n);const s=g(t,["endOffset"]);s!=null&&y(e,["endOffset"],s);const o=g(t,["startOffset"]);return o!=null&&y(e,["startOffset"],o),e}function jee(t){const e={},n=g(t,["data"]);n!=null&&y(e,["data"],n);const s=g(t,["mimeType"]);return s!=null&&y(e,["mimeType"],s),e}function Zee(t){const e={},n=g(t,["fileUri"]);n!=null&&y(e,["fileUri"],n);const s=g(t,["mimeType"]);return s!=null&&y(e,["mimeType"],s),e}function Qee(t){const e={},n=g(t,["id"]);n!=null&&y(e,["id"],n);const s=g(t,["args"]);s!=null&&y(e,["args"],s);const o=g(t,["name"]);return o!=null&&y(e,["name"],o),e}function ete(t){const e={},n=g(t,["videoMetadata"]);n!=null&&y(e,["videoMetadata"],Jee(n));const s=g(t,["thought"]);s!=null&&y(e,["thought"],s);const o=g(t,["inlineData"]);o!=null&&y(e,["inlineData"],jee(o));const r=g(t,["fileData"]);r!=null&&y(e,["fileData"],Zee(r));const i=g(t,["thoughtSignature"]);i!=null&&y(e,["thoughtSignature"],i);const a=g(t,["functionCall"]);a!=null&&y(e,["functionCall"],Qee(a));const l=g(t,["codeExecutionResult"]);l!=null&&y(e,["codeExecutionResult"],l);const u=g(t,["executableCode"]);u!=null&&y(e,["executableCode"],u);const d=g(t,["functionResponse"]);d!=null&&y(e,["functionResponse"],d);const h=g(t,["text"]);return h!=null&&y(e,["text"],h),e}function tte(t){const e={},n=g(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>ete(r))),y(e,["parts"],o)}const s=g(t,["role"]);return s!=null&&y(e,["role"],s),e}function nte(t){const e={},n=g(t,["citationSources"]);return n!=null&&y(e,["citations"],n),e}function ste(t){const e={},n=g(t,["retrievedUrl"]);n!=null&&y(e,["retrievedUrl"],n);const s=g(t,["urlRetrievalStatus"]);return s!=null&&y(e,["urlRetrievalStatus"],s),e}function ote(t){const e={},n=g(t,["urlMetadata"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>ste(o))),y(e,["urlMetadata"],s)}return e}function rte(t){const e={},n=g(t,["content"]);n!=null&&y(e,["content"],tte(n));const s=g(t,["citationMetadata"]);s!=null&&y(e,["citationMetadata"],nte(s));const o=g(t,["tokenCount"]);o!=null&&y(e,["tokenCount"],o);const r=g(t,["finishReason"]);r!=null&&y(e,["finishReason"],r);const i=g(t,["urlContextMetadata"]);i!=null&&y(e,["urlContextMetadata"],ote(i));const a=g(t,["avgLogprobs"]);a!=null&&y(e,["avgLogprobs"],a);const l=g(t,["groundingMetadata"]);l!=null&&y(e,["groundingMetadata"],l);const u=g(t,["index"]);u!=null&&y(e,["index"],u);const d=g(t,["logprobsResult"]);d!=null&&y(e,["logprobsResult"],d);const h=g(t,["safetyRatings"]);return h!=null&&y(e,["safetyRatings"],h),e}function yF(t){const e={},n=g(t,["sdkHttpResponse"]);n!=null&&y(e,["sdkHttpResponse"],n);const s=g(t,["candidates"]);if(s!=null){let l=s;Array.isArray(l)&&(l=l.map(u=>rte(u))),y(e,["candidates"],l)}const o=g(t,["modelVersion"]);o!=null&&y(e,["modelVersion"],o);const r=g(t,["promptFeedback"]);r!=null&&y(e,["promptFeedback"],r);const i=g(t,["responseId"]);i!=null&&y(e,["responseId"],i);const a=g(t,["usageMetadata"]);return a!=null&&y(e,["usageMetadata"],a),e}function ite(t){const e={},n=g(t,["values"]);return n!=null&&y(e,["values"],n),e}function ate(){return{}}function lte(t){const e={},n=g(t,["sdkHttpResponse"]);n!=null&&y(e,["sdkHttpResponse"],n);const s=g(t,["embeddings"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(i=>ite(i))),y(e,["embeddings"],r)}return g(t,["metadata"])!=null&&y(e,["metadata"],ate()),e}function ute(t){const e={},n=g(t,["bytesBase64Encoded"]);n!=null&&y(e,["imageBytes"],yu(n));const s=g(t,["mimeType"]);return s!=null&&y(e,["mimeType"],s),e}function j3(t){const e={},n=g(t,["safetyAttributes","categories"]);n!=null&&y(e,["categories"],n);const s=g(t,["safetyAttributes","scores"]);s!=null&&y(e,["scores"],s);const o=g(t,["contentType"]);return o!=null&&y(e,["contentType"],o),e}function cte(t){const e={},n=g(t,["_self"]);n!=null&&y(e,["image"],ute(n));const s=g(t,["raiFilteredReason"]);s!=null&&y(e,["raiFilteredReason"],s);const o=g(t,["_self"]);return o!=null&&y(e,["safetyAttributes"],j3(o)),e}function dte(t){const e={},n=g(t,["sdkHttpResponse"]);n!=null&&y(e,["sdkHttpResponse"],n);const s=g(t,["predictions"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(i=>cte(i))),y(e,["generatedImages"],r)}const o=g(t,["positivePromptSafetyAttributes"]);return o!=null&&y(e,["positivePromptSafetyAttributes"],j3(o)),e}function fte(t){const e={},n=g(t,["baseModel"]);n!=null&&y(e,["baseModel"],n);const s=g(t,["createTime"]);s!=null&&y(e,["createTime"],s);const o=g(t,["updateTime"]);return o!=null&&y(e,["updateTime"],o),e}function PT(t){const e={},n=g(t,["name"]);n!=null&&y(e,["name"],n);const s=g(t,["displayName"]);s!=null&&y(e,["displayName"],s);const o=g(t,["description"]);o!=null&&y(e,["description"],o);const r=g(t,["version"]);r!=null&&y(e,["version"],r);const i=g(t,["_self"]);i!=null&&y(e,["tunedModelInfo"],fte(i));const a=g(t,["inputTokenLimit"]);a!=null&&y(e,["inputTokenLimit"],a);const l=g(t,["outputTokenLimit"]);l!=null&&y(e,["outputTokenLimit"],l);const u=g(t,["supportedGenerationMethods"]);return u!=null&&y(e,["supportedActions"],u),e}function hte(t){const e={},n=g(t,["sdkHttpResponse"]);n!=null&&y(e,["sdkHttpResponse"],n);const s=g(t,["nextPageToken"]);s!=null&&y(e,["nextPageToken"],s);const o=g(t,["_self"]);if(o!=null){let r=D3(o);Array.isArray(r)&&(r=r.map(i=>PT(i))),y(e,["models"],r)}return e}function pte(t){const e={},n=g(t,["sdkHttpResponse"]);return n!=null&&y(e,["sdkHttpResponse"],n),e}function mte(t){const e={},n=g(t,["sdkHttpResponse"]);n!=null&&y(e,["sdkHttpResponse"],n);const s=g(t,["totalTokens"]);s!=null&&y(e,["totalTokens"],s);const o=g(t,["cachedContentTokenCount"]);return o!=null&&y(e,["cachedContentTokenCount"],o),e}function gte(t){const e={},n=g(t,["video","uri"]);n!=null&&y(e,["uri"],n);const s=g(t,["video","encodedVideo"]);s!=null&&y(e,["videoBytes"],yu(s));const o=g(t,["encoding"]);return o!=null&&y(e,["mimeType"],o),e}function yte(t){const e={},n=g(t,["_self"]);return n!=null&&y(e,["video"],gte(n)),e}function xte(t){const e={},n=g(t,["generatedSamples"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>yte(i))),y(e,["generatedVideos"],r)}const s=g(t,["raiMediaFilteredCount"]);s!=null&&y(e,["raiMediaFilteredCount"],s);const o=g(t,["raiMediaFilteredReasons"]);return o!=null&&y(e,["raiMediaFilteredReasons"],o),e}function vte(t){const e={},n=g(t,["name"]);n!=null&&y(e,["name"],n);const s=g(t,["metadata"]);s!=null&&y(e,["metadata"],s);const o=g(t,["done"]);o!=null&&y(e,["done"],o);const r=g(t,["error"]);r!=null&&y(e,["error"],r);const i=g(t,["response","generateVideoResponse"]);return i!=null&&y(e,["response"],xte(i)),e}function bte(t){const e={},n=g(t,["fps"]);n!=null&&y(e,["fps"],n);const s=g(t,["endOffset"]);s!=null&&y(e,["endOffset"],s);const o=g(t,["startOffset"]);return o!=null&&y(e,["startOffset"],o),e}function wte(t){const e={},n=g(t,["displayName"]);n!=null&&y(e,["displayName"],n);const s=g(t,["data"]);s!=null&&y(e,["data"],s);const o=g(t,["mimeType"]);return o!=null&&y(e,["mimeType"],o),e}function Cte(t){const e={},n=g(t,["displayName"]);n!=null&&y(e,["displayName"],n);const s=g(t,["fileUri"]);s!=null&&y(e,["fileUri"],s);const o=g(t,["mimeType"]);return o!=null&&y(e,["mimeType"],o),e}function Tte(t){const e={},n=g(t,["id"]);n!=null&&y(e,["id"],n);const s=g(t,["args"]);s!=null&&y(e,["args"],s);const o=g(t,["name"]);return o!=null&&y(e,["name"],o),e}function Ste(t){const e={},n=g(t,["videoMetadata"]);n!=null&&y(e,["videoMetadata"],bte(n));const s=g(t,["thought"]);s!=null&&y(e,["thought"],s);const o=g(t,["inlineData"]);o!=null&&y(e,["inlineData"],wte(o));const r=g(t,["fileData"]);r!=null&&y(e,["fileData"],Cte(r));const i=g(t,["thoughtSignature"]);i!=null&&y(e,["thoughtSignature"],i);const a=g(t,["functionCall"]);a!=null&&y(e,["functionCall"],Tte(a));const l=g(t,["codeExecutionResult"]);l!=null&&y(e,["codeExecutionResult"],l);const u=g(t,["executableCode"]);u!=null&&y(e,["executableCode"],u);const d=g(t,["functionResponse"]);d!=null&&y(e,["functionResponse"],d);const h=g(t,["text"]);return h!=null&&y(e,["text"],h),e}function Nte(t){const e={},n=g(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>Ste(r))),y(e,["parts"],o)}const s=g(t,["role"]);return s!=null&&y(e,["role"],s),e}function Ete(t){const e={},n=g(t,["citations"]);return n!=null&&y(e,["citations"],n),e}function Ite(t){const e={},n=g(t,["retrievedUrl"]);n!=null&&y(e,["retrievedUrl"],n);const s=g(t,["urlRetrievalStatus"]);return s!=null&&y(e,["urlRetrievalStatus"],s),e}function kte(t){const e={},n=g(t,["urlMetadata"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>Ite(o))),y(e,["urlMetadata"],s)}return e}function Ate(t){const e={},n=g(t,["content"]);n!=null&&y(e,["content"],Nte(n));const s=g(t,["citationMetadata"]);s!=null&&y(e,["citationMetadata"],Ete(s));const o=g(t,["finishMessage"]);o!=null&&y(e,["finishMessage"],o);const r=g(t,["finishReason"]);r!=null&&y(e,["finishReason"],r);const i=g(t,["urlContextMetadata"]);i!=null&&y(e,["urlContextMetadata"],kte(i));const a=g(t,["avgLogprobs"]);a!=null&&y(e,["avgLogprobs"],a);const l=g(t,["groundingMetadata"]);l!=null&&y(e,["groundingMetadata"],l);const u=g(t,["index"]);u!=null&&y(e,["index"],u);const d=g(t,["logprobsResult"]);d!=null&&y(e,["logprobsResult"],d);const h=g(t,["safetyRatings"]);return h!=null&&y(e,["safetyRatings"],h),e}function xF(t){const e={},n=g(t,["sdkHttpResponse"]);n!=null&&y(e,["sdkHttpResponse"],n);const s=g(t,["candidates"]);if(s!=null){let u=s;Array.isArray(u)&&(u=u.map(d=>Ate(d))),y(e,["candidates"],u)}const o=g(t,["createTime"]);o!=null&&y(e,["createTime"],o);const r=g(t,["modelVersion"]);r!=null&&y(e,["modelVersion"],r);const i=g(t,["promptFeedback"]);i!=null&&y(e,["promptFeedback"],i);const a=g(t,["responseId"]);a!=null&&y(e,["responseId"],a);const l=g(t,["usageMetadata"]);return l!=null&&y(e,["usageMetadata"],l),e}function Rte(t){const e={},n=g(t,["truncated"]);n!=null&&y(e,["truncated"],n);const s=g(t,["token_count"]);return s!=null&&y(e,["tokenCount"],s),e}function $te(t){const e={},n=g(t,["values"]);n!=null&&y(e,["values"],n);const s=g(t,["statistics"]);return s!=null&&y(e,["statistics"],Rte(s)),e}function Dte(t){const e={},n=g(t,["billableCharacterCount"]);return n!=null&&y(e,["billableCharacterCount"],n),e}function _te(t){const e={},n=g(t,["sdkHttpResponse"]);n!=null&&y(e,["sdkHttpResponse"],n);const s=g(t,["predictions[]","embeddings"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(i=>$te(i))),y(e,["embeddings"],r)}const o=g(t,["metadata"]);return o!=null&&y(e,["metadata"],Dte(o)),e}function Z3(t){const e={},n=g(t,["gcsUri"]);n!=null&&y(e,["gcsUri"],n);const s=g(t,["bytesBase64Encoded"]);s!=null&&y(e,["imageBytes"],yu(s));const o=g(t,["mimeType"]);return o!=null&&y(e,["mimeType"],o),e}function Q3(t){const e={},n=g(t,["safetyAttributes","categories"]);n!=null&&y(e,["categories"],n);const s=g(t,["safetyAttributes","scores"]);s!=null&&y(e,["scores"],s);const o=g(t,["contentType"]);return o!=null&&y(e,["contentType"],o),e}function Ax(t){const e={},n=g(t,["_self"]);n!=null&&y(e,["image"],Z3(n));const s=g(t,["raiFilteredReason"]);s!=null&&y(e,["raiFilteredReason"],s);const o=g(t,["_self"]);o!=null&&y(e,["safetyAttributes"],Q3(o));const r=g(t,["prompt"]);return r!=null&&y(e,["enhancedPrompt"],r),e}function Mte(t){const e={},n=g(t,["sdkHttpResponse"]);n!=null&&y(e,["sdkHttpResponse"],n);const s=g(t,["predictions"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(i=>Ax(i))),y(e,["generatedImages"],r)}const o=g(t,["positivePromptSafetyAttributes"]);return o!=null&&y(e,["positivePromptSafetyAttributes"],Q3(o)),e}function Fte(t){const e={},n=g(t,["sdkHttpResponse"]);n!=null&&y(e,["sdkHttpResponse"],n);const s=g(t,["predictions"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(r=>Ax(r))),y(e,["generatedImages"],o)}return e}function Ote(t){const e={},n=g(t,["sdkHttpResponse"]);n!=null&&y(e,["sdkHttpResponse"],n);const s=g(t,["predictions"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(r=>Ax(r))),y(e,["generatedImages"],o)}return e}function Pte(t){const e={},n=g(t,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>Ax(o))),y(e,["generatedImages"],s)}return e}function Lte(t){const e={},n=g(t,["label"]);n!=null&&y(e,["label"],n);const s=g(t,["score"]);return s!=null&&y(e,["score"],s),e}function Vte(t){const e={},n=g(t,["_self"]);n!=null&&y(e,["mask"],Z3(n));const s=g(t,["labels"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(r=>Lte(r))),y(e,["labels"],o)}return e}function zte(t){const e={},n=g(t,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>Vte(o))),y(e,["generatedMasks"],s)}return e}function Bte(t){const e={},n=g(t,["endpoint"]);n!=null&&y(e,["name"],n);const s=g(t,["deployedModelId"]);return s!=null&&y(e,["deployedModelId"],s),e}function Ute(t){const e={},n=g(t,["labels","google-vertex-llm-tuning-base-model-id"]);n!=null&&y(e,["baseModel"],n);const s=g(t,["createTime"]);s!=null&&y(e,["createTime"],s);const o=g(t,["updateTime"]);return o!=null&&y(e,["updateTime"],o),e}function Gte(t){const e={},n=g(t,["checkpointId"]);n!=null&&y(e,["checkpointId"],n);const s=g(t,["epoch"]);s!=null&&y(e,["epoch"],s);const o=g(t,["step"]);return o!=null&&y(e,["step"],o),e}function LT(t){const e={},n=g(t,["name"]);n!=null&&y(e,["name"],n);const s=g(t,["displayName"]);s!=null&&y(e,["displayName"],s);const o=g(t,["description"]);o!=null&&y(e,["description"],o);const r=g(t,["versionId"]);r!=null&&y(e,["version"],r);const i=g(t,["deployedModels"]);if(i!=null){let h=i;Array.isArray(h)&&(h=h.map(p=>Bte(p))),y(e,["endpoints"],h)}const a=g(t,["labels"]);a!=null&&y(e,["labels"],a);const l=g(t,["_self"]);l!=null&&y(e,["tunedModelInfo"],Ute(l));const u=g(t,["defaultCheckpointId"]);u!=null&&y(e,["defaultCheckpointId"],u);const d=g(t,["checkpoints"]);if(d!=null){let h=d;Array.isArray(h)&&(h=h.map(p=>Gte(p))),y(e,["checkpoints"],h)}return e}function Hte(t){const e={},n=g(t,["sdkHttpResponse"]);n!=null&&y(e,["sdkHttpResponse"],n);const s=g(t,["nextPageToken"]);s!=null&&y(e,["nextPageToken"],s);const o=g(t,["_self"]);if(o!=null){let r=D3(o);Array.isArray(r)&&(r=r.map(i=>LT(i))),y(e,["models"],r)}return e}function Wte(t){const e={},n=g(t,["sdkHttpResponse"]);return n!=null&&y(e,["sdkHttpResponse"],n),e}function qte(t){const e={},n=g(t,["sdkHttpResponse"]);n!=null&&y(e,["sdkHttpResponse"],n);const s=g(t,["totalTokens"]);return s!=null&&y(e,["totalTokens"],s),e}function Kte(t){const e={},n=g(t,["sdkHttpResponse"]);n!=null&&y(e,["sdkHttpResponse"],n);const s=g(t,["tokensInfo"]);return s!=null&&y(e,["tokensInfo"],s),e}function Xte(t){const e={},n=g(t,["gcsUri"]);n!=null&&y(e,["uri"],n);const s=g(t,["bytesBase64Encoded"]);s!=null&&y(e,["videoBytes"],yu(s));const o=g(t,["mimeType"]);return o!=null&&y(e,["mimeType"],o),e}function Yte(t){const e={},n=g(t,["_self"]);return n!=null&&y(e,["video"],Xte(n)),e}function Jte(t){const e={},n=g(t,["videos"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>Yte(i))),y(e,["generatedVideos"],r)}const s=g(t,["raiMediaFilteredCount"]);s!=null&&y(e,["raiMediaFilteredCount"],s);const o=g(t,["raiMediaFilteredReasons"]);return o!=null&&y(e,["raiMediaFilteredReasons"],o),e}function jte(t){const e={},n=g(t,["name"]);n!=null&&y(e,["name"],n);const s=g(t,["metadata"]);s!=null&&y(e,["metadata"],s);const o=g(t,["done"]);o!=null&&y(e,["done"],o);const r=g(t,["error"]);r!=null&&y(e,["error"],r);const i=g(t,["response"]);return i!=null&&y(e,["response"],Jte(i)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Zte="Content-Type",Qte="X-Server-Timeout",ene="User-Agent",VT="x-goog-api-client",tne="1.19.0",nne=`google-genai-sdk/${tne}`,sne="v1beta1",one="v1beta",vF=/^data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class rne{constructor(e){var n,s;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const o={};this.clientOptions.vertexai?(o.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:sne,o.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(o.apiVersion=(s=this.clientOptions.apiVersion)!==null&&s!==void 0?s:one,o.baseUrl="https://generativelanguage.googleapis.com/"),o.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=o,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(o,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const s=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&s.push(e.apiVersion),s.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),n=new URL(e);return n.protocol=n.protocol=="http:"?"ws":"wss",n.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,n,s){const o=[this.getRequestUrlInternal(n)];return s&&o.push(this.getBaseResourcePath()),e!==""&&o.push(e),new URL(`${o.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const s=this.shouldPrependVertexProjectPath(e),o=this.constructUrl(e.path,n,s);if(e.queryParams)for(const[i,a]of Object.entries(e.queryParams))o.searchParams.append(i,String(a));let r={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else r.body=e.body;return r=await this.includeExtraHttpOptionsToRequestInit(r,n,e.abortSignal),this.unaryApiCall(o,r,e.httpMethod)}patchHttpOptions(e,n){const s=JSON.parse(JSON.stringify(e));for(const[o,r]of Object.entries(n))typeof r=="object"?s[o]=Object.assign(Object.assign({},s[o]),r):r!==void 0&&(s[o]=r);return s}async requestStream(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const s=this.shouldPrependVertexProjectPath(e),o=this.constructUrl(e.path,n,s);(!o.searchParams.has("alt")||o.searchParams.get("alt")!=="sse")&&o.searchParams.set("alt","sse");let r={};return r.body=e.body,r=await this.includeExtraHttpOptionsToRequestInit(r,n,e.abortSignal),this.streamApiCall(o,r,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,n,s){if(n&&n.timeout||s){const o=new AbortController,r=o.signal;if(n.timeout&&(n==null?void 0:n.timeout)>0){const i=setTimeout(()=>o.abort(),n.timeout);i&&typeof i.unref=="function"&&i.unref()}s&&s.addEventListener("abort",()=>{o.abort()}),e.signal=r}return n&&n.extraBody!==null&&ine(e,n.extraBody),e.headers=await this.getHeadersInternal(n),e}async unaryApiCall(e,n,s){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:s})).then(async o=>(await bF(o),new DT(o))).catch(o=>{throw o instanceof Error?o:new Error(JSON.stringify(o))})}async streamApiCall(e,n,s){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:s})).then(async o=>(await bF(o),this.processStreamResponse(o))).catch(o=>{throw o instanceof Error?o:new Error(JSON.stringify(o))})}processStreamResponse(e){var n;return _c(this,arguments,function*(){const o=(n=e==null?void 0:e.body)===null||n===void 0?void 0:n.getReader(),r=new TextDecoder("utf-8");if(!o)throw new Error("Response body is empty");try{let i="";for(;;){const{done:a,value:l}=yield Xt(o.read());if(a){if(i.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const u=r.decode(l,{stream:!0});try{const h=JSON.parse(u);if("error"in h){const p=JSON.parse(JSON.stringify(h.error)),x=p.status,b=p.code,w=`got status: ${x}. ${JSON.stringify(h)}`;if(b>=400&&b<600)throw new Ix({message:w,status:b})}}catch(h){if(h.name==="ApiError")throw h}i+=u;let d=i.match(vF);for(;d;){const h=d[1];try{const p=new Response(h,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield Xt(new DT(p)),i=i.slice(d[0].length),d=i.match(vF)}catch(p){throw new Error(`exception parsing stream chunk ${h}. ${p}`)}}}}finally{o.releaseLock()}})}async apiCall(e,n){return fetch(e,n).catch(s=>{throw new Error(`exception ${s} sending request`)})}getDefaultHeaders(){const e={},n=nne+" "+this.clientOptions.userAgentExtra;return e[ene]=n,e[VT]=n,e[Zte]="application/json",e}async getHeadersInternal(e){const n=new Headers;if(e&&e.headers){for(const[s,o]of Object.entries(e.headers))n.append(s,o);e.timeout&&e.timeout>0&&n.append(Qte,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n),n}async uploadFile(e,n){var s;const o={};n!=null&&(o.mimeType=n.mimeType,o.name=n.name,o.displayName=n.displayName),o.name&&!o.name.startsWith("files/")&&(o.name=`files/${o.name}`);const r=this.clientOptions.uploader,i=await r.stat(e);o.sizeBytes=String(i.size);const a=(s=n==null?void 0:n.mimeType)!==null&&s!==void 0?s:i.type;if(a===void 0||a==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");o.mimeType=a;const l=await this.fetchUploadUrl(o,n);return r.upload(e,l,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,n){var s;let o={};n!=null&&n.httpOptions?o=n.httpOptions:o={apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${e.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${e.mimeType}`}};const r={file:e},i=await this.request({path:Me("upload/v1beta/files",r._url),body:JSON.stringify(r),httpMethod:"POST",httpOptions:o});if(!i||!(i!=null&&i.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const a=(s=i==null?void 0:i.headers)===null||s===void 0?void 0:s["x-goog-upload-url"];if(a===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return a}}async function bF(t){var e;if(t===void 0)throw new Error("response is undefined");if(!t.ok){const n=t.status;let s;!((e=t.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?s=await t.json():s={error:{message:await t.text(),code:t.status,status:t.statusText}};const o=JSON.stringify(s);throw n>=400&&n<600?new Ix({message:o,status:n}):new Error(o)}}function ine(t,e){if(!e||Object.keys(e).length===0)return;if(t.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let n={};if(typeof t.body=="string"&&t.body.length>0)try{const r=JSON.parse(t.body);if(typeof r=="object"&&r!==null&&!Array.isArray(r))n=r;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function s(r,i){const a=Object.assign({},r);for(const l in i)if(Object.prototype.hasOwnProperty.call(i,l)){const u=i[l],d=a[l];u&&typeof u=="object"&&!Array.isArray(u)&&d&&typeof d=="object"&&!Array.isArray(d)?a[l]=s(d,u):(d&&u&&typeof d!=typeof u&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${l}". Original type: ${typeof d}, New type: ${typeof u}. Overwriting.`),a[l]=u)}return a}const o=s(n,e);t.body=JSON.stringify(o)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ane="mcp_used/unknown";let lne=!1;function eV(t){for(const e of t)if(une(e)||typeof e=="object"&&"inputSchema"in e)return!0;return lne}function tV(t){var e;const n=(e=t[VT])!==null&&e!==void 0?e:"";t[VT]=(n+` ${ane}`).trimStart()}function une(t){return t!==null&&typeof t=="object"&&t instanceof FN}function cne(t,e=100){return _c(this,arguments,function*(){let s,o=0;for(;o<e;){const r=yield Xt(t.listTools({cursor:s}));for(const i of r.tools)yield yield Xt(i),o++;if(!r.nextCursor)break;s=r.nextCursor}})}class FN{constructor(e=[],n){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=n}static create(e,n){return new FN(e,n)}async initialize(){var e,n,s,o;if(this.mcpTools.length>0)return;const r={},i=[];for(const d of this.mcpClients)try{for(var a=!0,l=(n=void 0,ep(cne(d))),u;u=await l.next(),e=u.done,!e;a=!0){o=u.value,a=!1;const h=o;i.push(h);const p=h.name;if(r[p])throw new Error(`Duplicate function name ${p} found in MCP tools. Please ensure function names are unique.`);r[p]=d}}catch(h){n={error:h}}finally{try{!a&&!e&&(s=l.return)&&await s.call(l)}finally{if(n)throw n.error}}this.mcpTools=i,this.functionNameToMcpClient=r}async tool(){return await this.initialize(),N7(this.mcpTools,this.config)}async callTool(e){await this.initialize();const n=[];for(const s of e)if(s.name in this.functionNameToMcpClient){const o=this.functionNameToMcpClient[s.name];let r;this.config.timeout&&(r={timeout:this.config.timeout});const i=await o.callTool({name:s.name,arguments:s.args},void 0,r);n.push({functionResponse:{name:s.name,response:i.isError?{error:i}:i}})}return n}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function dne(t,e,n){const s=new y7;let o;n.data instanceof Blob?o=JSON.parse(await n.data.text()):o=JSON.parse(n.data);const r=BZ(o);Object.assign(s,r),e(s)}class fne{constructor(e,n,s){this.apiClient=e,this.auth=n,this.webSocketFactory=s}async connect(e){var n,s;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const o=this.apiClient.getWebsocketBaseUrl(),r=this.apiClient.getApiVersion(),i=mne(this.apiClient.getDefaultHeaders()),a=this.apiClient.getApiKey(),l=`${o}/ws/google.ai.generativelanguage.${r}.GenerativeService.BidiGenerateMusic?key=${a}`;let u=()=>{};const d=new Promise(I=>{u=I}),h=e.callbacks,p=function(){u({})},x=this.apiClient,b={onopen:p,onmessage:I=>{dne(x,h.onmessage,I)},onerror:(n=h==null?void 0:h.onerror)!==null&&n!==void 0?n:function(I){},onclose:(s=h==null?void 0:h.onclose)!==null&&s!==void 0?s:function(I){}},w=this.webSocketFactory.create(l,pne(i),b);w.connect(),await d;const C=Et(this.apiClient,e.model),T=G3({model:C}),N=OT({setup:T});return w.send(JSON.stringify(N)),new hne(w,this.apiClient)}}class hne{constructor(e,n){this.conn=e,this.apiClient=n}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const n=Lj(e),s=H3(n);this.conn.send(JSON.stringify({clientContent:s}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const n=Vj(e),s=OT(n);this.conn.send(JSON.stringify(s))}sendPlaybackControl(e){const n=OT({playbackControl:e});this.conn.send(JSON.stringify(n))}play(){this.sendPlaybackControl(Rc.PLAY)}pause(){this.sendPlaybackControl(Rc.PAUSE)}stop(){this.sendPlaybackControl(Rc.STOP)}resetContext(){this.sendPlaybackControl(Rc.RESET_CONTEXT)}close(){this.conn.close()}}function pne(t){const e={};return t.forEach((n,s)=>{e[s]=n}),e}function mne(t){const e=new Headers;for(const[n,s]of Object.entries(t))e.append(n,s);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const gne="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function yne(t,e,n){const s=new g7;let o;n.data instanceof Blob?o=await n.data.text():n.data instanceof ArrayBuffer?o=new TextDecoder().decode(n.data):o=n.data;const r=JSON.parse(o);if(t.isVertexAI()){const i=eQ(r);Object.assign(s,i)}else{const i=DZ(r);Object.assign(s,i)}e(s)}class xne{constructor(e,n,s){this.apiClient=e,this.auth=n,this.webSocketFactory=s,this.music=new fne(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var n,s,o,r,i,a;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const l=this.apiClient.getWebsocketBaseUrl(),u=this.apiClient.getApiVersion();let d;const h=this.apiClient.getHeaders();e.config&&e.config.tools&&eV(e.config.tools)&&tV(h);const p=Cne(h);if(this.apiClient.isVertexAI())d=`${l}/ws/google.cloud.aiplatform.${u}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(p);else{const F=this.apiClient.getApiKey();let P="BidiGenerateContent",D="key";F!=null&&F.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),u!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),P="BidiGenerateContentConstrained",D="access_token"),d=`${l}/ws/google.ai.generativelanguage.${u}.GenerativeService.${P}?${D}=${F}`}let x=()=>{};const b=new Promise(F=>{x=F}),w=e.callbacks,C=function(){var F;(F=w==null?void 0:w.onopen)===null||F===void 0||F.call(w),x({})},T=this.apiClient,N={onopen:C,onmessage:F=>{yne(T,w.onmessage,F)},onerror:(n=w==null?void 0:w.onerror)!==null&&n!==void 0?n:function(F){},onclose:(s=w==null?void 0:w.onclose)!==null&&s!==void 0?s:function(F){}},I=this.webSocketFactory.create(d,wne(p),N);I.connect(),await b;let k=Et(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&k.startsWith("publishers/")){const F=this.apiClient.getProject(),P=this.apiClient.getLocation();k=`projects/${F}/locations/${P}/`+k}let A={};this.apiClient.isVertexAI()&&((o=e.config)===null||o===void 0?void 0:o.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[Bc.AUDIO]}:e.config.responseModalities=[Bc.AUDIO]),!((r=e.config)===null||r===void 0)&&r.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const $=(a=(i=e.config)===null||i===void 0?void 0:i.tools)!==null&&a!==void 0?a:[],M=[];for(const F of $)if(this.isCallableTool(F)){const P=F;M.push(await P.tool())}else M.push(F);M.length>0&&(e.config.tools=M);const O={model:k,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?A=pZ(this.apiClient,O):A=Mj(this.apiClient,O),delete A.config,I.send(JSON.stringify(A)),new bne(I,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const vne={turnComplete:!0};class bne{constructor(e,n){this.conn=e,this.apiClient=n}tLiveClientContent(e,n){if(n.turns!==null&&n.turns!==void 0){let s=[];try{s=tr(n.turns),e.isVertexAI()?s=s.map(o=>ud(o)):s=s.map(o=>kx(o))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof n.turns}'`)}return{clientContent:{turns:s,turnComplete:n.turnComplete}}}return{clientContent:{turnComplete:n.turnComplete}}}tLiveClienttToolResponse(e,n){let s=[];if(n.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(n.functionResponses)?s=n.functionResponses:s=[n.functionResponses],s.length===0)throw new Error("functionResponses is required.");for(const r of s){if(typeof r!="object"||r===null||!("name"in r)||!("response"in r))throw new Error(`Could not parse function response, type '${typeof r}'.`);if(!e.isVertexAI()&&!("id"in r))throw new Error(gne)}return{toolResponse:{functionResponses:s}}}sendClientContent(e){e=Object.assign(Object.assign({},vne),e);const n=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(n))}sendRealtimeInput(e){let n={};this.apiClient.isVertexAI()?n={realtimeInput:yZ(e)}:n={realtimeInput:Pj(e)},this.conn.send(JSON.stringify(n))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const n=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(n))}close(){this.conn.close()}}function wne(t){const e={};return t.forEach((n,s)=>{e[s]=n}),e}function Cne(t){const e=new Headers;for(const[n,s]of Object.entries(t))e.append(n,s);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const wF=10;function CF(t){var e,n,s;if(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let o=!1;for(const i of(n=t==null?void 0:t.tools)!==null&&n!==void 0?n:[])if(Mc(i)){o=!0;break}if(!o)return!0;const r=(s=t==null?void 0:t.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls;return r&&(r<0||!Number.isInteger(r))||r==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",r),!0):!1}function Mc(t){return"callTool"in t&&typeof t.callTool=="function"}function Tne(t){var e,n,s;return(s=(n=(e=t.config)===null||e===void 0?void 0:e.tools)===null||n===void 0?void 0:n.some(o=>Mc(o)))!==null&&s!==void 0?s:!1}function Sne(t){var e,n,s;return(s=(n=(e=t.config)===null||e===void 0?void 0:e.tools)===null||n===void 0?void 0:n.some(o=>!Mc(o)))!==null&&s!==void 0?s:!1}function TF(t){var e;return!(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Nne extends gu{constructor(e){super(),this.apiClient=e,this.generateContent=async n=>{var s,o,r,i,a;const l=await this.processParamsMaybeAddMcpUsage(n);if(this.maybeMoveToResponseJsonSchem(n),!Tne(n)||CF(n.config))return await this.generateContentInternal(l);if(Sne(n))throw new Error("Automatic function calling with CallableTools and Tools is not yet supported.");let u,d;const h=tr(l.contents),p=(r=(o=(s=l.config)===null||s===void 0?void 0:s.automaticFunctionCalling)===null||o===void 0?void 0:o.maximumRemoteCalls)!==null&&r!==void 0?r:wF;let x=0;for(;x<p&&(u=await this.generateContentInternal(l),!(!u.functionCalls||u.functionCalls.length===0));){const b=u.candidates[0].content,w=[];for(const C of(a=(i=n.config)===null||i===void 0?void 0:i.tools)!==null&&a!==void 0?a:[])if(Mc(C)){const N=await C.callTool(u.functionCalls);w.push(...N)}x++,d={role:"user",parts:w},l.contents=tr(l.contents),l.contents.push(b),l.contents.push(d),TF(l.config)&&(h.push(b),h.push(d))}return TF(l.config)&&(u.automaticFunctionCallingHistory=h),u},this.generateContentStream=async n=>{if(this.maybeMoveToResponseJsonSchem(n),CF(n.config)){const s=await this.processParamsMaybeAddMcpUsage(n);return await this.generateContentStreamInternal(s)}else return await this.processAfcStream(n)},this.generateImages=async n=>await this.generateImagesInternal(n).then(s=>{var o;let r;const i=[];if(s!=null&&s.generatedImages)for(const l of s.generatedImages)l&&(l!=null&&l.safetyAttributes)&&((o=l==null?void 0:l.safetyAttributes)===null||o===void 0?void 0:o.contentType)==="Positive Prompt"?r=l==null?void 0:l.safetyAttributes:i.push(l);let a;return r?a={generatedImages:i,positivePromptSafetyAttributes:r,sdkHttpResponse:s.sdkHttpResponse}:a={generatedImages:i,sdkHttpResponse:s.sdkHttpResponse},a}),this.list=async n=>{var s;const i={config:Object.assign(Object.assign({},{queryBase:!0}),n==null?void 0:n.config)};if(this.apiClient.isVertexAI()&&!i.config.queryBase){if(!((s=i.config)===null||s===void 0)&&s.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");i.config.filter="labels.tune-type:*"}return new Vp(jl.PAGED_ITEM_MODELS,a=>this.listInternal(a),await this.listInternal(i),i)},this.editImage=async n=>{const s={model:n.model,prompt:n.prompt,referenceImages:[],config:n.config};return n.referenceImages&&n.referenceImages&&(s.referenceImages=n.referenceImages.map(o=>o.toReferenceImageAPI())),await this.editImageInternal(s)},this.upscaleImage=async n=>{let s={numberOfImages:1,mode:"upscale"};n.config&&(s=Object.assign(Object.assign({},s),n.config));const o={model:n.model,image:n.image,upscaleFactor:n.upscaleFactor,config:s};return await this.upscaleImageInternal(o)},this.generateVideos=async n=>{if((n.prompt||n.image||n.video)&&n.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return await this.generateVideosInternal(n)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var n,s,o;const r=(n=e.config)===null||n===void 0?void 0:n.tools;if(!r)return e;const i=await Promise.all(r.map(async l=>Mc(l)?await l.tool():l)),a={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:i})};if(a.config.tools=i,e.config&&e.config.tools&&eV(e.config.tools)){const l=(o=(s=e.config.httpOptions)===null||s===void 0?void 0:s.headers)!==null&&o!==void 0?o:{};let u=Object.assign({},l);Object.keys(u).length===0&&(u=this.apiClient.getDefaultHeaders()),tV(u),a.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:u})}return a}async initAfcToolsMap(e){var n,s,o;const r=new Map;for(const i of(s=(n=e.config)===null||n===void 0?void 0:n.tools)!==null&&s!==void 0?s:[])if(Mc(i)){const a=i,l=await a.tool();for(const u of(o=l.functionDeclarations)!==null&&o!==void 0?o:[]){if(!u.name)throw new Error("Function declaration name is required.");if(r.has(u.name))throw new Error(`Duplicate tool declaration name: ${u.name}`);r.set(u.name,a)}}return r}async processAfcStream(e){var n,s,o;const r=(o=(s=(n=e.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls)!==null&&o!==void 0?o:wF;let i=!1,a=0;const l=await this.initAfcToolsMap(e);return(function(u,d,h){var p,x;return _c(this,arguments,function*(){for(var b,w,C,T;a<r;){i&&(a++,i=!1);const A=yield Xt(u.processParamsMaybeAddMcpUsage(h)),$=yield Xt(u.generateContentStreamInternal(A)),M=[],O=[];try{for(var N=!0,I=(w=void 0,ep($)),k;k=yield Xt(I.next()),b=k.done,!b;N=!0){T=k.value,N=!1;const F=T;if(yield yield Xt(F),F.candidates&&(!((p=F.candidates[0])===null||p===void 0)&&p.content)){O.push(F.candidates[0].content);for(const P of(x=F.candidates[0].content.parts)!==null&&x!==void 0?x:[])if(a<r&&P.functionCall){if(!P.functionCall.name)throw new Error("Function call name was not returned by the model.");if(d.has(P.functionCall.name)){const D=yield Xt(d.get(P.functionCall.name).callTool([P.functionCall]));M.push(...D)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${d.keys()}, mising tool: ${P.functionCall.name}`)}}}}catch(F){w={error:F}}finally{try{!N&&!b&&(C=I.return)&&(yield Xt(C.call(I)))}finally{if(w)throw w.error}}if(M.length>0){i=!0;const F=new kh;F.candidates=[{content:{role:"user",parts:M}}],yield yield Xt(F);const P=[];P.push(...O),P.push({role:"user",parts:M});const D=tr(h.contents).concat(P);h.contents=D}else break}})})(this,l,e)}async generateContentInternal(e){var n,s,o,r;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=gF(this.apiClient,e);return a=Me("{model}:generateContent",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json().then(h=>{const p=h;return p.sdkHttpResponse={headers:d.headers},p})),i.then(d=>{const h=xF(d),p=new kh;return Object.assign(p,h),p})}else{const u=mF(this.apiClient,e);return a=Me("{model}:generateContent",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{const p=h;return p.sdkHttpResponse={headers:d.headers},p})),i.then(d=>{const h=yF(d),p=new kh;return Object.assign(p,h),p})}}async generateContentStreamInternal(e){var n,s,o,r;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=gF(this.apiClient,e);return a=Me("{model}:streamGenerateContent?alt=sse",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.requestStream({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}),i.then(function(h){return _c(this,arguments,function*(){var p,x,b,w;try{for(var C=!0,T=ep(h),N;N=yield Xt(T.next()),p=N.done,!p;C=!0){w=N.value,C=!1;const I=w,k=xF(yield Xt(I.json()));k.sdkHttpResponse={headers:I.headers};const A=new kh;Object.assign(A,k),yield yield Xt(A)}}catch(I){x={error:I}}finally{try{!C&&!p&&(b=T.return)&&(yield Xt(b.call(T)))}finally{if(x)throw x.error}}})})}else{const u=mF(this.apiClient,e);return a=Me("{model}:streamGenerateContent?alt=sse",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.requestStream({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),i.then(function(h){return _c(this,arguments,function*(){var p,x,b,w;try{for(var C=!0,T=ep(h),N;N=yield Xt(T.next()),p=N.done,!p;C=!0){w=N.value,C=!1;const I=w,k=yF(yield Xt(I.json()));k.sdkHttpResponse={headers:I.headers};const A=new kh;Object.assign(A,k),yield yield Xt(A)}}catch(I){x={error:I}}finally{try{!C&&!p&&(b=T.return)&&(yield Xt(b.call(T)))}finally{if(x)throw x.error}}})})}}async embedContent(e){var n,s,o,r;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=gee(this.apiClient,e);return a=Me("{model}:predict",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json().then(h=>{const p=h;return p.sdkHttpResponse={headers:d.headers},p})),i.then(d=>{const h=_te(d),p=new YM;return Object.assign(p,h),p})}else{const u=IQ(this.apiClient,e);return a=Me("{model}:batchEmbedContents",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{const p=h;return p.sdkHttpResponse={headers:d.headers},p})),i.then(d=>{const h=lte(d),p=new YM;return Object.assign(p,h),p})}}async generateImagesInternal(e){var n,s,o,r;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=xee(this.apiClient,e);return a=Me("{model}:predict",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json().then(h=>{const p=h;return p.sdkHttpResponse={headers:d.headers},p})),i.then(d=>{const h=Mte(d),p=new JM;return Object.assign(p,h),p})}else{const u=AQ(this.apiClient,e);return a=Me("{model}:predict",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{const p=h;return p.sdkHttpResponse={headers:d.headers},p})),i.then(d=>{const h=dte(d),p=new JM;return Object.assign(p,h),p})}}async editImageInternal(e){var n,s;let o,r="",i={};if(this.apiClient.isVertexAI()){const a=Nee(this.apiClient,e);return r=Me("{model}:predict",a._url),i=a._query,delete a.config,delete a._url,delete a._query,o=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json().then(u=>{const d=u;return d.sdkHttpResponse={headers:l.headers},d})),o.then(l=>{const u=Fte(l),d=new l7;return Object.assign(d,u),d})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var n,s;let o,r="",i={};if(this.apiClient.isVertexAI()){const a=Iee(this.apiClient,e);return r=Me("{model}:predict",a._url),i=a._query,delete a.config,delete a._url,delete a._query,o=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json().then(u=>{const d=u;return d.sdkHttpResponse={headers:l.headers},d})),o.then(l=>{const u=Ote(l),d=new u7;return Object.assign(d,u),d})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var n,s;let o,r="",i={};if(this.apiClient.isVertexAI()){const a=$ee(this.apiClient,e);return r=Me("{model}:predict",a._url),i=a._query,delete a.config,delete a._url,delete a._query,o=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json()),o.then(l=>{const u=Pte(l),d=new c7;return Object.assign(d,u),d})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var n,s;let o,r="",i={};if(this.apiClient.isVertexAI()){const a=Fee(this.apiClient,e);return r=Me("{model}:predict",a._url),i=a._query,delete a.config,delete a._url,delete a._query,o=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json()),o.then(l=>{const u=zte(l),d=new d7;return Object.assign(d,u),d})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var n,s,o,r;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=Oee(this.apiClient,e);return a=Me("{name}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>LT(d))}else{const u=RQ(this.apiClient,e);return a=Me("{name}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),i.then(d=>PT(d))}}async listInternal(e){var n,s,o,r;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=Lee(this.apiClient,e);return a=Me("{models_url}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json().then(h=>{const p=h;return p.sdkHttpResponse={headers:d.headers},p})),i.then(d=>{const h=Hte(d),p=new jM;return Object.assign(p,h),p})}else{const u=DQ(this.apiClient,e);return a=Me("{models_url}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{const p=h;return p.sdkHttpResponse={headers:d.headers},p})),i.then(d=>{const h=hte(d),p=new jM;return Object.assign(p,h),p})}}async update(e){var n,s,o,r;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=zee(this.apiClient,e);return a=Me("{model}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>LT(d))}else{const u=MQ(this.apiClient,e);return a=Me("{name}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),i.then(d=>PT(d))}}async delete(e){var n,s,o,r;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=Bee(this.apiClient,e);return a=Me("{name}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json().then(h=>{const p=h;return p.sdkHttpResponse={headers:d.headers},p})),i.then(d=>{const h=Wte(d),p=new ZM;return Object.assign(p,h),p})}else{const u=FQ(this.apiClient,e);return a=Me("{name}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{const p=h;return p.sdkHttpResponse={headers:d.headers},p})),i.then(d=>{const h=pte(d),p=new ZM;return Object.assign(p,h),p})}}async countTokens(e){var n,s,o,r;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=Gee(this.apiClient,e);return a=Me("{model}:countTokens",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json().then(h=>{const p=h;return p.sdkHttpResponse={headers:d.headers},p})),i.then(d=>{const h=qte(d),p=new QM;return Object.assign(p,h),p})}else{const u=PQ(this.apiClient,e);return a=Me("{model}:countTokens",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{const p=h;return p.sdkHttpResponse={headers:d.headers},p})),i.then(d=>{const h=mte(d),p=new QM;return Object.assign(p,h),p})}}async computeTokens(e){var n,s;let o,r="",i={};if(this.apiClient.isVertexAI()){const a=Hee(this.apiClient,e);return r=Me("{model}:computeTokens",a._url),i=a._query,delete a.config,delete a._url,delete a._query,o=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json().then(u=>{const d=u;return d.sdkHttpResponse={headers:l.headers},d})),o.then(l=>{const u=Kte(l),d=new f7;return Object.assign(d,u),d})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var n,s,o,r;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=Yee(this.apiClient,e);return a=Me("{model}:predictLongRunning",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>{const h=jte(d),p=new z0;return Object.assign(p,h),p})}else{const u=zQ(this.apiClient,e);return a=Me("{model}:predictLongRunning",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),i.then(d=>{const h=vte(d),p=new z0;return Object.assign(p,h),p})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ene extends gu{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const n=e.operation,s=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const o=n.name.split("/operations/")[0];let r;s&&"httpOptions"in s&&(r=s.httpOptions);const i=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:o,config:{httpOptions:r}});return n._fromAPIResponse({apiResponse:i,isVertexAI:!0})}else{const o=await this.getVideosOperationInternal({operationName:n.name,config:s});return n._fromAPIResponse({apiResponse:o,isVertexAI:!1})}}async get(e){const n=e.operation,s=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const o=n.name.split("/operations/")[0];let r;s&&"httpOptions"in s&&(r=s.httpOptions);const i=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:o,config:{httpOptions:r}});return n._fromAPIResponse({apiResponse:i,isVertexAI:!0})}else{const o=await this.getVideosOperationInternal({operationName:n.name,config:s});return n._fromAPIResponse({apiResponse:o,isVertexAI:!1})}}async getVideosOperationInternal(e){var n,s,o,r;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=QY(e);return a=Me("{operationName}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i}else{const u=jY(e);return a=Me("{operationName}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),i}}async fetchPredictVideosOperationInternal(e){var n,s;let o,r="",i={};if(this.apiClient.isVertexAI()){const a=ZY(e);return r=Me("{resourceName}:fetchPredictOperation",a._url),i=a._query,delete a.config,delete a._url,delete a._query,o=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json()),o}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ine(t){const e={},n=g(t,["voiceName"]);return n!=null&&y(e,["voiceName"],n),e}function nV(t){const e={},n=g(t,["prebuiltVoiceConfig"]);return n!=null&&y(e,["prebuiltVoiceConfig"],Ine(n)),e}function kne(t){const e={},n=g(t,["speaker"]);n!=null&&y(e,["speaker"],n);const s=g(t,["voiceConfig"]);return s!=null&&y(e,["voiceConfig"],nV(s)),e}function Ane(t){const e={},n=g(t,["speakerVoiceConfigs"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>kne(o))),y(e,["speakerVoiceConfigs"],s)}return e}function Rne(t){const e={},n=g(t,["voiceConfig"]);n!=null&&y(e,["voiceConfig"],nV(n));const s=g(t,["multiSpeakerVoiceConfig"]);s!=null&&y(e,["multiSpeakerVoiceConfig"],Ane(s));const o=g(t,["languageCode"]);return o!=null&&y(e,["languageCode"],o),e}function $ne(t){const e={},n=g(t,["fps"]);n!=null&&y(e,["fps"],n);const s=g(t,["endOffset"]);s!=null&&y(e,["endOffset"],s);const o=g(t,["startOffset"]);return o!=null&&y(e,["startOffset"],o),e}function Dne(t){const e={};if(g(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=g(t,["data"]);n!=null&&y(e,["data"],n);const s=g(t,["mimeType"]);return s!=null&&y(e,["mimeType"],s),e}function _ne(t){const e={};if(g(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=g(t,["fileUri"]);n!=null&&y(e,["fileUri"],n);const s=g(t,["mimeType"]);return s!=null&&y(e,["mimeType"],s),e}function Mne(t){const e={},n=g(t,["id"]);n!=null&&y(e,["id"],n);const s=g(t,["args"]);s!=null&&y(e,["args"],s);const o=g(t,["name"]);return o!=null&&y(e,["name"],o),e}function Fne(t){const e={},n=g(t,["videoMetadata"]);n!=null&&y(e,["videoMetadata"],$ne(n));const s=g(t,["thought"]);s!=null&&y(e,["thought"],s);const o=g(t,["inlineData"]);o!=null&&y(e,["inlineData"],Dne(o));const r=g(t,["fileData"]);r!=null&&y(e,["fileData"],_ne(r));const i=g(t,["thoughtSignature"]);i!=null&&y(e,["thoughtSignature"],i);const a=g(t,["functionCall"]);a!=null&&y(e,["functionCall"],Mne(a));const l=g(t,["codeExecutionResult"]);l!=null&&y(e,["codeExecutionResult"],l);const u=g(t,["executableCode"]);u!=null&&y(e,["executableCode"],u);const d=g(t,["functionResponse"]);d!=null&&y(e,["functionResponse"],d);const h=g(t,["text"]);return h!=null&&y(e,["text"],h),e}function One(t){const e={},n=g(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>Fne(r))),y(e,["parts"],o)}const s=g(t,["role"]);return s!=null&&y(e,["role"],s),e}function Pne(t){const e={},n=g(t,["behavior"]);n!=null&&y(e,["behavior"],n);const s=g(t,["description"]);s!=null&&y(e,["description"],s);const o=g(t,["name"]);o!=null&&y(e,["name"],o);const r=g(t,["parameters"]);r!=null&&y(e,["parameters"],r);const i=g(t,["parametersJsonSchema"]);i!=null&&y(e,["parametersJsonSchema"],i);const a=g(t,["response"]);a!=null&&y(e,["response"],a);const l=g(t,["responseJsonSchema"]);return l!=null&&y(e,["responseJsonSchema"],l),e}function Lne(t){const e={},n=g(t,["startTime"]);n!=null&&y(e,["startTime"],n);const s=g(t,["endTime"]);return s!=null&&y(e,["endTime"],s),e}function Vne(t){const e={},n=g(t,["timeRangeFilter"]);if(n!=null&&y(e,["timeRangeFilter"],Lne(n)),g(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function zne(t){const e={},n=g(t,["mode"]);n!=null&&y(e,["mode"],n);const s=g(t,["dynamicThreshold"]);return s!=null&&y(e,["dynamicThreshold"],s),e}function Bne(t){const e={},n=g(t,["dynamicRetrievalConfig"]);return n!=null&&y(e,["dynamicRetrievalConfig"],zne(n)),e}function Une(){return{}}function Gne(t){const e={},n=g(t,["environment"]);return n!=null&&y(e,["environment"],n),e}function Hne(t){const e={},n=g(t,["functionDeclarations"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(u=>Pne(u))),y(e,["functionDeclarations"],l)}if(g(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=g(t,["googleSearch"]);s!=null&&y(e,["googleSearch"],Vne(s));const o=g(t,["googleSearchRetrieval"]);if(o!=null&&y(e,["googleSearchRetrieval"],Bne(o)),g(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(g(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");g(t,["urlContext"])!=null&&y(e,["urlContext"],Une());const i=g(t,["computerUse"]);i!=null&&y(e,["computerUse"],Gne(i));const a=g(t,["codeExecution"]);return a!=null&&y(e,["codeExecution"],a),e}function Wne(t){const e={},n=g(t,["handle"]);if(n!=null&&y(e,["handle"],n),g(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function SF(){return{}}function qne(t){const e={},n=g(t,["disabled"]);n!=null&&y(e,["disabled"],n);const s=g(t,["startOfSpeechSensitivity"]);s!=null&&y(e,["startOfSpeechSensitivity"],s);const o=g(t,["endOfSpeechSensitivity"]);o!=null&&y(e,["endOfSpeechSensitivity"],o);const r=g(t,["prefixPaddingMs"]);r!=null&&y(e,["prefixPaddingMs"],r);const i=g(t,["silenceDurationMs"]);return i!=null&&y(e,["silenceDurationMs"],i),e}function Kne(t){const e={},n=g(t,["automaticActivityDetection"]);n!=null&&y(e,["automaticActivityDetection"],qne(n));const s=g(t,["activityHandling"]);s!=null&&y(e,["activityHandling"],s);const o=g(t,["turnCoverage"]);return o!=null&&y(e,["turnCoverage"],o),e}function Xne(t){const e={},n=g(t,["targetTokens"]);return n!=null&&y(e,["targetTokens"],n),e}function Yne(t){const e={},n=g(t,["triggerTokens"]);n!=null&&y(e,["triggerTokens"],n);const s=g(t,["slidingWindow"]);return s!=null&&y(e,["slidingWindow"],Xne(s)),e}function Jne(t){const e={},n=g(t,["proactiveAudio"]);return n!=null&&y(e,["proactiveAudio"],n),e}function jne(t,e){const n={},s=g(t,["generationConfig"]);e!==void 0&&s!=null&&y(e,["setup","generationConfig"],s);const o=g(t,["responseModalities"]);e!==void 0&&o!=null&&y(e,["setup","generationConfig","responseModalities"],o);const r=g(t,["temperature"]);e!==void 0&&r!=null&&y(e,["setup","generationConfig","temperature"],r);const i=g(t,["topP"]);e!==void 0&&i!=null&&y(e,["setup","generationConfig","topP"],i);const a=g(t,["topK"]);e!==void 0&&a!=null&&y(e,["setup","generationConfig","topK"],a);const l=g(t,["maxOutputTokens"]);e!==void 0&&l!=null&&y(e,["setup","generationConfig","maxOutputTokens"],l);const u=g(t,["mediaResolution"]);e!==void 0&&u!=null&&y(e,["setup","generationConfig","mediaResolution"],u);const d=g(t,["seed"]);e!==void 0&&d!=null&&y(e,["setup","generationConfig","seed"],d);const h=g(t,["speechConfig"]);e!==void 0&&h!=null&&y(e,["setup","generationConfig","speechConfig"],Rne(_N(h)));const p=g(t,["enableAffectiveDialog"]);e!==void 0&&p!=null&&y(e,["setup","generationConfig","enableAffectiveDialog"],p);const x=g(t,["systemInstruction"]);e!==void 0&&x!=null&&y(e,["setup","systemInstruction"],One(_s(x)));const b=g(t,["tools"]);if(e!==void 0&&b!=null){let A=ad(b);Array.isArray(A)&&(A=A.map($=>Hne(id($)))),y(e,["setup","tools"],A)}const w=g(t,["sessionResumption"]);e!==void 0&&w!=null&&y(e,["setup","sessionResumption"],Wne(w));const C=g(t,["inputAudioTranscription"]);e!==void 0&&C!=null&&y(e,["setup","inputAudioTranscription"],SF());const T=g(t,["outputAudioTranscription"]);e!==void 0&&T!=null&&y(e,["setup","outputAudioTranscription"],SF());const N=g(t,["realtimeInputConfig"]);e!==void 0&&N!=null&&y(e,["setup","realtimeInputConfig"],Kne(N));const I=g(t,["contextWindowCompression"]);e!==void 0&&I!=null&&y(e,["setup","contextWindowCompression"],Yne(I));const k=g(t,["proactivity"]);return e!==void 0&&k!=null&&y(e,["setup","proactivity"],Jne(k)),n}function Zne(t,e){const n={},s=g(e,["model"]);s!=null&&y(n,["setup","model"],Et(t,s));const o=g(e,["config"]);return o!=null&&y(n,["config"],jne(o,n)),n}function Qne(t,e,n){const s={},o=g(e,["expireTime"]);n!==void 0&&o!=null&&y(n,["expireTime"],o);const r=g(e,["newSessionExpireTime"]);n!==void 0&&r!=null&&y(n,["newSessionExpireTime"],r);const i=g(e,["uses"]);n!==void 0&&i!=null&&y(n,["uses"],i);const a=g(e,["liveConnectConstraints"]);n!==void 0&&a!=null&&y(n,["bidiGenerateContentSetup"],Zne(t,a));const l=g(e,["lockAdditionalFields"]);return n!==void 0&&l!=null&&y(n,["fieldMask"],l),s}function ese(t,e){const n={},s=g(e,["config"]);return s!=null&&y(n,["config"],Qne(t,s,n)),n}function tse(t){const e={},n=g(t,["name"]);return n!=null&&y(e,["name"],n),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function nse(t){const e=[];for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const s=t[n];if(typeof s=="object"&&s!=null&&Object.keys(s).length>0){const o=Object.keys(s).map(r=>`${n}.${r}`);e.push(...o)}else e.push(n)}return e.join(",")}function sse(t,e){let n=null;const s=t.bidiGenerateContentSetup;if(typeof s=="object"&&s!==null&&"setup"in s){const r=s.setup;typeof r=="object"&&r!==null?(t.bidiGenerateContentSetup=r,n=r):delete t.bidiGenerateContentSetup}else s!==void 0&&delete t.bidiGenerateContentSetup;const o=t.fieldMask;if(n){const r=nse(n);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)r?t.fieldMask=r:delete t.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&o!==null&&Array.isArray(o)&&o.length>0){const i=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let a=[];o.length>0&&(a=o.map(u=>i.includes(u)?`generationConfig.${u}`:u));const l=[];r&&l.push(r),a.length>0&&l.push(...a),l.length>0?t.fieldMask=l.join(","):delete t.fieldMask}else delete t.fieldMask}else o!==null&&Array.isArray(o)&&o.length>0?t.fieldMask=o.join(","):delete t.fieldMask;return t}class ose extends gu{constructor(e){super(),this.apiClient=e}async create(e){var n,s;let o,r="",i={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const a=ese(this.apiClient,e);r=Me("auth_tokens",a._url),i=a._query,delete a.config,delete a._url,delete a._query;const l=sse(a,e.config);return o=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(u=>u.json()),o.then(u=>tse(u))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function rse(t){const e={},n=g(t,["name"]);n!=null&&y(e,["_url","name"],n);const s=g(t,["config"]);return s!=null&&y(e,["config"],s),e}function ise(t,e){const n={},s=g(t,["pageSize"]);e!==void 0&&s!=null&&y(e,["_query","pageSize"],s);const o=g(t,["pageToken"]);e!==void 0&&o!=null&&y(e,["_query","pageToken"],o);const r=g(t,["filter"]);return e!==void 0&&r!=null&&y(e,["_query","filter"],r),n}function ase(t){const e={},n=g(t,["config"]);return n!=null&&y(e,["config"],ise(n,e)),e}function lse(t){const e={},n=g(t,["name"]);n!=null&&y(e,["_url","name"],n);const s=g(t,["config"]);return s!=null&&y(e,["config"],s),e}function use(t){const e={},n=g(t,["textInput"]);n!=null&&y(e,["textInput"],n);const s=g(t,["output"]);return s!=null&&y(e,["output"],s),e}function cse(t){const e={};if(g(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(g(t,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const n=g(t,["examples"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>use(o))),y(e,["examples","examples"],s)}return e}function dse(t,e){const n={};if(g(t,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const s=g(t,["tunedModelDisplayName"]);if(e!==void 0&&s!=null&&y(e,["displayName"],s),g(t,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const o=g(t,["epochCount"]);e!==void 0&&o!=null&&y(e,["tuningTask","hyperparameters","epochCount"],o);const r=g(t,["learningRateMultiplier"]);if(r!=null&&y(n,["tuningTask","hyperparameters","learningRateMultiplier"],r),g(t,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(g(t,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(g(t,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const i=g(t,["batchSize"]);e!==void 0&&i!=null&&y(e,["tuningTask","hyperparameters","batchSize"],i);const a=g(t,["learningRate"]);if(e!==void 0&&a!=null&&y(e,["tuningTask","hyperparameters","learningRate"],a),g(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");return n}function fse(t){const e={},n=g(t,["baseModel"]);n!=null&&y(e,["baseModel"],n);const s=g(t,["preTunedModel"]);s!=null&&y(e,["preTunedModel"],s);const o=g(t,["trainingDataset"]);o!=null&&y(e,["tuningTask","trainingData"],cse(o));const r=g(t,["config"]);return r!=null&&y(e,["config"],dse(r,e)),e}function hse(t){const e={},n=g(t,["name"]);n!=null&&y(e,["_url","name"],n);const s=g(t,["config"]);return s!=null&&y(e,["config"],s),e}function pse(t,e){const n={},s=g(t,["pageSize"]);e!==void 0&&s!=null&&y(e,["_query","pageSize"],s);const o=g(t,["pageToken"]);e!==void 0&&o!=null&&y(e,["_query","pageToken"],o);const r=g(t,["filter"]);return e!==void 0&&r!=null&&y(e,["_query","filter"],r),n}function mse(t){const e={},n=g(t,["config"]);return n!=null&&y(e,["config"],pse(n,e)),e}function gse(t){const e={},n=g(t,["name"]);n!=null&&y(e,["_url","name"],n);const s=g(t,["config"]);return s!=null&&y(e,["config"],s),e}function yse(t,e){const n={},s=g(t,["gcsUri"]);e!==void 0&&s!=null&&y(e,["supervisedTuningSpec","trainingDatasetUri"],s);const o=g(t,["vertexDatasetResource"]);if(e!==void 0&&o!=null&&y(e,["supervisedTuningSpec","trainingDatasetUri"],o),g(t,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return n}function xse(t,e){const n={},s=g(t,["gcsUri"]);s!=null&&y(n,["validationDatasetUri"],s);const o=g(t,["vertexDatasetResource"]);return e!==void 0&&o!=null&&y(e,["supervisedTuningSpec","trainingDatasetUri"],o),n}function vse(t,e){const n={},s=g(t,["validationDataset"]);e!==void 0&&s!=null&&y(e,["supervisedTuningSpec"],xse(s,n));const o=g(t,["tunedModelDisplayName"]);e!==void 0&&o!=null&&y(e,["tunedModelDisplayName"],o);const r=g(t,["description"]);e!==void 0&&r!=null&&y(e,["description"],r);const i=g(t,["epochCount"]);e!==void 0&&i!=null&&y(e,["supervisedTuningSpec","hyperParameters","epochCount"],i);const a=g(t,["learningRateMultiplier"]);e!==void 0&&a!=null&&y(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],a);const l=g(t,["exportLastCheckpointOnly"]);e!==void 0&&l!=null&&y(e,["supervisedTuningSpec","exportLastCheckpointOnly"],l);const u=g(t,["preTunedModelCheckpointId"]);u!=null&&y(n,["preTunedModel","checkpointId"],u);const d=g(t,["adapterSize"]);if(e!==void 0&&d!=null&&y(e,["supervisedTuningSpec","hyperParameters","adapterSize"],d),g(t,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(g(t,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const h=g(t,["labels"]);return e!==void 0&&h!=null&&y(e,["labels"],h),n}function bse(t){const e={},n=g(t,["baseModel"]);n!=null&&y(e,["baseModel"],n);const s=g(t,["preTunedModel"]);s!=null&&y(e,["preTunedModel"],s);const o=g(t,["trainingDataset"]);o!=null&&y(e,["supervisedTuningSpec","trainingDatasetUri"],yse(o,e));const r=g(t,["config"]);return r!=null&&y(e,["config"],vse(r,e)),e}function wse(t){const e={},n=g(t,["name"]);n!=null&&y(e,["model"],n);const s=g(t,["name"]);return s!=null&&y(e,["endpoint"],s),e}function sV(t){const e={},n=g(t,["sdkHttpResponse"]);n!=null&&y(e,["sdkHttpResponse"],n);const s=g(t,["name"]);s!=null&&y(e,["name"],s);const o=g(t,["state"]);o!=null&&y(e,["state"],A3(o));const r=g(t,["createTime"]);r!=null&&y(e,["createTime"],r);const i=g(t,["tuningTask","startTime"]);i!=null&&y(e,["startTime"],i);const a=g(t,["tuningTask","completeTime"]);a!=null&&y(e,["endTime"],a);const l=g(t,["updateTime"]);l!=null&&y(e,["updateTime"],l);const u=g(t,["description"]);u!=null&&y(e,["description"],u);const d=g(t,["baseModel"]);d!=null&&y(e,["baseModel"],d);const h=g(t,["_self"]);h!=null&&y(e,["tunedModel"],wse(h));const p=g(t,["customBaseModel"]);p!=null&&y(e,["customBaseModel"],p);const x=g(t,["experiment"]);x!=null&&y(e,["experiment"],x);const b=g(t,["labels"]);b!=null&&y(e,["labels"],b);const w=g(t,["outputUri"]);w!=null&&y(e,["outputUri"],w);const C=g(t,["pipelineJob"]);C!=null&&y(e,["pipelineJob"],C);const T=g(t,["serviceAccount"]);T!=null&&y(e,["serviceAccount"],T);const N=g(t,["tunedModelDisplayName"]);return N!=null&&y(e,["tunedModelDisplayName"],N),e}function Cse(t){const e={},n=g(t,["sdkHttpResponse"]);n!=null&&y(e,["sdkHttpResponse"],n);const s=g(t,["nextPageToken"]);s!=null&&y(e,["nextPageToken"],s);const o=g(t,["tunedModels"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(i=>sV(i))),y(e,["tuningJobs"],r)}return e}function Tse(t){const e={},n=g(t,["sdkHttpResponse"]);n!=null&&y(e,["sdkHttpResponse"],n);const s=g(t,["name"]);s!=null&&y(e,["name"],s);const o=g(t,["metadata"]);o!=null&&y(e,["metadata"],o);const r=g(t,["done"]);r!=null&&y(e,["done"],r);const i=g(t,["error"]);return i!=null&&y(e,["error"],i),e}function Sse(t){const e={},n=g(t,["checkpointId"]);n!=null&&y(e,["checkpointId"],n);const s=g(t,["epoch"]);s!=null&&y(e,["epoch"],s);const o=g(t,["step"]);o!=null&&y(e,["step"],o);const r=g(t,["endpoint"]);return r!=null&&y(e,["endpoint"],r),e}function Nse(t){const e={},n=g(t,["model"]);n!=null&&y(e,["model"],n);const s=g(t,["endpoint"]);s!=null&&y(e,["endpoint"],s);const o=g(t,["checkpoints"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(i=>Sse(i))),y(e,["checkpoints"],r)}return e}function zT(t){const e={},n=g(t,["sdkHttpResponse"]);n!=null&&y(e,["sdkHttpResponse"],n);const s=g(t,["name"]);s!=null&&y(e,["name"],s);const o=g(t,["state"]);o!=null&&y(e,["state"],A3(o));const r=g(t,["createTime"]);r!=null&&y(e,["createTime"],r);const i=g(t,["startTime"]);i!=null&&y(e,["startTime"],i);const a=g(t,["endTime"]);a!=null&&y(e,["endTime"],a);const l=g(t,["updateTime"]);l!=null&&y(e,["updateTime"],l);const u=g(t,["error"]);u!=null&&y(e,["error"],u);const d=g(t,["description"]);d!=null&&y(e,["description"],d);const h=g(t,["baseModel"]);h!=null&&y(e,["baseModel"],h);const p=g(t,["tunedModel"]);p!=null&&y(e,["tunedModel"],Nse(p));const x=g(t,["preTunedModel"]);x!=null&&y(e,["preTunedModel"],x);const b=g(t,["supervisedTuningSpec"]);b!=null&&y(e,["supervisedTuningSpec"],b);const w=g(t,["tuningDataStats"]);w!=null&&y(e,["tuningDataStats"],w);const C=g(t,["encryptionSpec"]);C!=null&&y(e,["encryptionSpec"],C);const T=g(t,["partnerModelTuningSpec"]);T!=null&&y(e,["partnerModelTuningSpec"],T);const N=g(t,["customBaseModel"]);N!=null&&y(e,["customBaseModel"],N);const I=g(t,["experiment"]);I!=null&&y(e,["experiment"],I);const k=g(t,["labels"]);k!=null&&y(e,["labels"],k);const A=g(t,["outputUri"]);A!=null&&y(e,["outputUri"],A);const $=g(t,["pipelineJob"]);$!=null&&y(e,["pipelineJob"],$);const M=g(t,["serviceAccount"]);M!=null&&y(e,["serviceAccount"],M);const O=g(t,["tunedModelDisplayName"]);return O!=null&&y(e,["tunedModelDisplayName"],O),e}function Ese(t){const e={},n=g(t,["sdkHttpResponse"]);n!=null&&y(e,["sdkHttpResponse"],n);const s=g(t,["nextPageToken"]);s!=null&&y(e,["nextPageToken"],s);const o=g(t,["tuningJobs"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(i=>zT(i))),y(e,["tuningJobs"],r)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ise extends gu{constructor(e){super(),this.apiClient=e,this.get=async n=>await this.getInternal(n),this.list=async(n={})=>new Vp(jl.PAGED_ITEM_TUNING_JOBS,s=>this.listInternal(s),await this.listInternal(n),n),this.tune=async n=>{if(this.apiClient.isVertexAI())if(n.baseModel.startsWith("projects/")){const s={tunedModelName:n.baseModel},o=Object.assign(Object.assign({},n),{preTunedModel:s});return o.baseModel=void 0,await this.tuneInternal(o)}else{const s=Object.assign({},n);return await this.tuneInternal(s)}else{const s=Object.assign({},n),o=await this.tuneMldevInternal(s);let r="";return o.metadata!==void 0&&o.metadata.tunedModel!==void 0?r=o.metadata.tunedModel:o.name!==void 0&&o.name.includes("/operations/")&&(r=o.name.split("/operations/")[0]),{name:r,state:$T.JOB_STATE_QUEUED}}}}async getInternal(e){var n,s,o,r;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=hse(e);return a=Me("{name}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json().then(h=>{const p=h;return p.sdkHttpResponse={headers:d.headers},p})),i.then(d=>zT(d))}else{const u=rse(e);return a=Me("{name}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{const p=h;return p.sdkHttpResponse={headers:d.headers},p})),i.then(d=>sV(d))}}async listInternal(e){var n,s,o,r;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=mse(e);return a=Me("tuningJobs",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json().then(h=>{const p=h;return p.sdkHttpResponse={headers:d.headers},p})),i.then(d=>{const h=Ese(d),p=new eF;return Object.assign(p,h),p})}else{const u=ase(e);return a=Me("tunedModels",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(h=>{const p=h;return p.sdkHttpResponse={headers:d.headers},p})),i.then(d=>{const h=Cse(d),p=new eF;return Object.assign(p,h),p})}}async cancel(e){var n,s,o,r;let i="",a={};if(this.apiClient.isVertexAI()){const l=gse(e);i=Me("{name}:cancel",l._url),a=l._query,delete l.config,delete l._url,delete l._query,await this.apiClient.request({path:i,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}else{const l=lse(e);i=Me("{name}:cancel",l._url),a=l._query,delete l.config,delete l._url,delete l._query,await this.apiClient.request({path:i,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async tuneInternal(e){var n,s;let o,r="",i={};if(this.apiClient.isVertexAI()){const a=bse(e);return r=Me("tuningJobs",a._url),i=a._query,delete a.config,delete a._url,delete a._query,o=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json().then(u=>{const d=u;return d.sdkHttpResponse={headers:l.headers},d})),o.then(l=>zT(l))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var n,s;let o,r="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=fse(e);return r=Me("tunedModels",a._url),i=a._query,delete a.config,delete a._url,delete a._query,o=this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(l=>l.json().then(u=>{const d=u;return d.sdkHttpResponse={headers:l.headers},d})),o.then(l=>Tse(l))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class kse{async download(e,n){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const Ase=1024*1024*8,Rse=3,$se=1e3,Dse=2,PC="x-goog-upload-status";async function _se(t,e,n){var s,o,r;let i=0,a=0,l=new DT(new Response),u="upload";for(i=t.size;a<i;){const h=Math.min(Ase,i-a),p=t.slice(a,a+h);a+h>=i&&(u+=", finalize");let x=0,b=$se;for(;x<Rse&&(l=await n.request({path:"",body:p,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":u,"X-Goog-Upload-Offset":String(a),"Content-Length":String(h)}}}),!(!((s=l==null?void 0:l.headers)===null||s===void 0)&&s[PC]));)x++,await Fse(b),b=b*Dse;if(a+=h,((o=l==null?void 0:l.headers)===null||o===void 0?void 0:o[PC])!=="active")break;if(i<=a)throw new Error("All content has been uploaded, but the upload status is not finalized.")}const d=await(l==null?void 0:l.json());if(((r=l==null?void 0:l.headers)===null||r===void 0?void 0:r[PC])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return d.file}async function Mse(t){return{size:t.size,type:t.type}}function Fse(t){return new Promise(e=>setTimeout(e,t))}class Ose{async upload(e,n,s){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await _se(e,n,s)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await Mse(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Pse{create(e,n,s){return new Lse(e,n,s)}}class Lse{constructor(e,n,s){this.url=e,this.headers=n,this.callbacks=s}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const NF="x-goog-api-key";class Vse{constructor(e){this.apiKey=e}async addAuthHeaders(e){if(e.get(NF)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(NF,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const zse="gl-node/";class Bse{constructor(e){var n;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(n=e.vertexai)!==null&&n!==void 0?n:!1,this.apiKey=e.apiKey;const s=JY(e.httpOptions,e.vertexai,void 0,void 0);s&&(e.httpOptions?e.httpOptions.baseUrl=s:e.httpOptions={baseUrl:s}),this.apiVersion=e.apiVersion;const o=new Vse(this.apiKey);this.apiClient=new rne({auth:o,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:zse+"web",uploader:new Ose,downloader:new kse}),this.models=new Nne(this.apiClient),this.live=new xne(this.apiClient,o,new Pse),this.batches=new B9(this.apiClient),this.chats=new YJ(this.models,this.apiClient),this.caches=new qJ(this.apiClient),this.files=new lj(this.apiClient),this.operations=new Ene(this.apiClient),this.authTokens=new ose(this.apiClient),this.tunings=new Ise(this.apiClient)}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/function Rx(t){return new Promise((e,n)=>{const s=new Image;s.crossOrigin="anonymous",s.onload=()=>e(s),s.onerror=o=>n(new Error(`Failed to load image: ${t.substring(0,50)}...`)),s.src=t})}async function BT(t){const e=await Rx(t),n=document.createElement("canvas"),s=n.getContext("2d");if(!s)throw new Error("Could not get 2D context for resizing");const o=1024;let{width:r,height:i}=e;return r>i?r>o&&(i=i*(o/r),r=o):i>o&&(r=r*(o/i),i=o),n.width=r,n.height=i,s.drawImage(e,0,0,r,i),n.toDataURL("image/jpeg",.9)}async function Use(t){const e=await Rx(t),{width:n,height:s}=e,o=n/2,r=s/2,i=[{angle:"front",x:0,y:0},{angle:"left",x:o,y:0},{angle:"right",x:0,y:r},{angle:"back",x:o,y:r}],a={};for(const l of i){const u=document.createElement("canvas");u.width=o,u.height=r;const d=u.getContext("2d");if(!d)throw new Error("Could not get 2D context for cropping");d.drawImage(e,l.x,l.y,o,r,0,0,o,r),a[l.angle]=u.toDataURL("image/jpeg",.9)}return a}async function EF(t){const e=document.createElement("canvas"),n=2480,s=3508;e.width=n,e.height=s;const o=e.getContext("2d");if(!o)throw new Error("Could not get 2D canvas context");const r=o.createLinearGradient(0,0,n,s);r.addColorStop(0,"#1e1b4b"),r.addColorStop(1,"#0c0a09"),o.fillStyle=r,o.fillRect(0,0,n,s),o.textAlign="center",o.font="150px 'Permanent Marker', cursive";const i=o.createLinearGradient(0,0,n,0);i.addColorStop(.3,"#f472b6"),i.addColorStop(.7,"#a78bfa"),o.fillStyle=i,o.fillText("Barber Booth Pro",n/2,250),o.font="60px 'Inter', sans-serif",o.fillStyle="#a1a1aa",o.fillText("Your Personal AI Hair Salon",n/2,350);const a=["front","left","right","back"],l=await Promise.all(a.map(w=>Rx(t[w]))),u=a.map((w,C)=>({angle:w,img:l[C]})),d={cols:2,rows:2,padding:120},h=450,p=s-h-d.padding,x=(n-d.padding*(d.cols+1))/d.cols,b=(p-d.padding*(d.rows+1))/d.rows;return u.forEach(({angle:w,img:C},T)=>{const N=Math.floor(T/d.cols),I=T%d.cols,k=d.padding*(I+1)+x*I,A=h+d.padding*(N+1)+b*N,$=40,M=120,O=x,F=b,P=F-M-$;o.save(),o.shadowColor="rgba(0, 0, 0, 0.5)",o.shadowBlur=50,o.shadowOffsetX=10,o.shadowOffsetY=10,o.fillStyle="#f3f4f6",o.fillRect(k,A,O,F),o.restore();const D=C.naturalWidth/C.naturalHeight;let H=O-$*2,Z=H/D;Z>P&&(Z=P,H=Z*D);const ne=k+(O-H)/2,Q=A+$+(P-Z)/2;o.drawImage(C,ne,Q,H,Z),o.fillStyle="#1f2937",o.font="70px 'Permanent Marker', cursive",o.textAlign="center",o.textBaseline="middle";const G=w.charAt(0).toUpperCase()+w.slice(1),q=A+F-M/2;o.fillText(G,k+O/2,q)}),o.font="40px 'Inter', sans-serif",o.fillStyle="#71717a",o.fillText("Developed by Ronnie H. Placo, powered by the Gemini family",n/2,s-80),e.toDataURL("image/jpeg",.9)}async function LC(t){const e=await Rx(t),n=document.createElement("canvas"),s=n.getContext("2d");if(!s)throw new Error("Could not get 2D context for compression");const o=512;let{width:r,height:i}=e;return r>i?r>o&&(i=i*(o/r),r=o):i>o&&(r=r*(o/i),i=o),n.width=r,n.height=i,s.drawImage(e,0,0,r,i),n.toDataURL("image/jpeg",.8)}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/const oV="mock_api_key",U0=new Bse({apiKey:oV});function IF(t){const e=t.match(/^data:(image\/\w+);base64,(.*)$/);if(!e)throw new Error("Invalid data URL format. Expected 'data:image/...;base64,...'");const[,n,s]=e;return{inlineData:{mimeType:n,data:s}}}function Gse(t){var s,o,r,i;const e=(i=(r=(o=(s=t.candidates)==null?void 0:s[0])==null?void 0:o.content)==null?void 0:r.parts)==null?void 0:i.find(a=>a.inlineData);if(e!=null&&e.inlineData){const{mimeType:a,data:l}=e.inlineData;return`data:${a};base64,${l}`}const n=t.text;throw console.error("API did not return an image. Response:",n),new Error(`The AI model responded with text instead of an image: "${n||"No text response received."}"`)}async function Hse(t){var s;for(let o=1;o<=3;o++)try{return await U0.models.generateContent({model:"gemini-2.5-flash-image-preview",contents:{parts:t},config:{responseModalities:[Bc.IMAGE,Bc.TEXT]}})}catch(r){console.error(`Error calling Gemini API (Attempt ${o}/3):`,r),console.error("Gemini API call failed. Request details (sensitive data omitted):");try{const l={model:"gemini-2.5-flash-image-preview",numberOfParts:t.length,partTypes:t.map(u=>"text"in u&&u.text?"text":"inlineData"in u&&u.inlineData?`inlineData (${u.inlineData.mimeType})`:"unknown"),promptTextLength:(s=t.find(u=>"text"in u&&u.text))==null?void 0:s.text.length};console.error(JSON.stringify(l,null,2))}catch{console.error("Could not serialize request details for logging.")}const i=r instanceof Error?r.message:JSON.stringify(r);if((i.includes('"code":500')||i.includes("INTERNAL"))&&o<3){const l=1e3*Math.pow(2,o-1);console.log(`Internal error detected. Retrying in ${l}ms...`),await new Promise(u=>setTimeout(u,l));continue}throw r}throw new Error("Gemini API call failed after all retries.")}async function Wse(t){if(!t.trim())return[];const e=`
You are a creative hair stylist's assistant. Based on the user's input, generate 5 diverse and trending hairstyle suggestions that expand on their idea.
Keep the suggestions concise and inspiring (e.g., "Vintage Hollywood Waves", "Cyberpunk Neon Undercut", "Sun-Kissed Beachy Bob").
Do not repeat the user's exact input.

User's input: "${t}"

Return ONLY a JSON array of 5 string suggestions.
`.trim();try{const s=(await U0.models.generateContent({model:"gemini-2.5-flash",contents:e,config:{responseMimeType:"application/json",responseSchema:{type:Gr.ARRAY,items:{type:Gr.STRING,description:"A hairstyle suggestion"}},temperature:.8}})).text.trim(),o=JSON.parse(s);return Array.isArray(o)&&o.every(r=>typeof r=="string")?o:(console.error("Parsed suggestions are not in the expected format:",o),[])}catch(n){return console.error("Failed to get hairstyle suggestions:",n),[]}}async function qse(t,e){var i,a,l,u;const n=[];let s="";const o=await BT(t.dataUrl);if(n.push(IF(o)),!((i=e.description)!=null&&i.trim())&&!e.referenceImage&&e.hairColor)s=`Dye the person's current hair to this exact color: ${e.hairColor}. The hairstyle, length, and texture MUST NOT be changed. Only change the hair color.`;else{if(e.referenceImage){const d=await BT(e.referenceImage);n.push(IF(d)),s="Apply the hairstyle from the second image provided.",(a=e.referenceDescription)!=null&&a.trim()&&(s+=` It is described as: "${e.referenceDescription.trim()}".`),(l=e.modification)!=null&&l.trim()&&(s+=` Apply this modification: "${e.modification.trim()}".`)}else if((u=e.description)!=null&&u.trim())s=`The hairstyle should be: "${e.description.trim()}".`;else throw new Error("Either a hairstyle description, a reference image, or just a hair color must be provided.");e.hairColor&&(s+=` The final hair color MUST be exactly this hex code: ${e.hairColor}.`)}const r=`
Task: Edit the person in the first provided image to give them a new hairstyle.

Hairstyle Details:
${s}

Output Requirements:
Produce a single, high-quality image that showcases the new hairstyle from four distinct angles, arranged in a 2x2 layout. The background must be a simple, consistent studio setting for all views.

Views to include:
- Top-Left: Front view. The face must be an exact match to the original image.
- Top-Right: Left Side profile (a 90-degree turn from the front).
- Bottom-Left: Right Diagonal profile (a 45-degree turn from the front).
- Bottom-Right: Back view.

Critical Rules:
- Identity Preservation: The person's facial identity must be perfectly preserved in the front view.
- Consistency: The hairstyle, hair color, lighting, and background must be uniform across all four views.
- The final output must be a single image file without any borders, text, or watermarks. Do not include hands or shoulders.
    `.trim();n.push({text:r});try{console.log(`Attempting to generate 4-up grid with prompt length: ${r.length}`);const d=await Hse(n);return Gse(d)}catch(d){const h=d instanceof Error?d.message:JSON.stringify(d);throw console.error("An unrecoverable error occurred during 4-up image generation.",d),new Error(`The AI model failed to generate the 4-up grid. Details: ${h}`)}}const VC=["Briefing the AI stylist on your vision...","Calibrating the virtual camera rig...","Mapping your facial geometry in 3D...","Simulating hair follicles strand by strand...","Rendering the right profile view...","Generating the view from the back...","Painting in the left profile...","Stitching the orbital path together...","Applying cinematic lighting and color grade...","Finalizing the 360 masterpiece..."];async function Kse(t,e,n){var h,p,x,b;const s=`
Create a seamless, photorealistic, 360-degree turntable video of the person in the provided image.

The new hairstyle is: "${e}".

Cost & Quality Optimization:
- Duration: The video must be a quick, smooth rotation, approximately 3-4 seconds long.
- Resolution: Render at a high-quality standard definition (720p) for optimal web playback and cost.

Core Requirements:
- The rotation must start and end at the front-facing view.
- The person's facial identity from the source image must be perfectly preserved.
- The hairstyle must be rendered consistently from all angles.
- The final video must be a square (1:1 aspect ratio) and framed as a "head and shoulders" portrait.
- The background must be a simple, clean, out-of-focus studio setting.
- Do not crop any part of the head or hair.
`.trim(),r=(await BT(t.dataUrl)).match(/^data:(image\/\w+);base64,(.*)$/);if(!r)throw new Error("Invalid hairstyle image data URL format.");const[,i,a]=r;let l;try{n(VC[0]),console.log("Attempting to generate video with prompt:",s),l=await U0.models.generateVideos({model:"veo-2.0-generate-001",prompt:s,image:{imageBytes:a,mimeType:i},config:{numberOfVideos:1}})}catch(w){throw console.error("Failed to start video generation. Prompt used:",s,"Error:",w),new Error("The AI model failed to initialize the video generation process.")}let u=1;for(;!l.done;){n(VC[u%VC.length]),u++,await new Promise(w=>setTimeout(w,1e4));try{l=await U0.operations.getVideosOperation({operation:l})}catch(w){throw console.error("Error while polling for video status:",w),new Error("There was a problem checking the status of your video generation.")}}if(l.error)throw console.error("Video generation operation failed. Prompt used:",s,"Error details:",l.error),new Error(`The video generation failed with code ${l.error.code}: ${l.error.message}`);const d=(b=(x=(p=(h=l.response)==null?void 0:h.generatedVideos)==null?void 0:p[0])==null?void 0:x.video)==null?void 0:b.uri;if(!d)throw console.error("Video generation finished but returned no URL. Prompt used:",s,"Final Operation State:",l),new Error("The AI model finished but did not provide a video URL.");n("Downloading final video...");try{const w=await fetch(`${d}&key=${oV}`);if(!w.ok)throw new Error(`Failed to download video file. Status: ${w.status}`);const C=await w.blob();return URL.createObjectURL(C)}catch(w){throw console.error("Failed to download or process video:",w),new Error("There was an error retrieving the final video file.")}}function rV(t){var e,n,s="";if(typeof t=="string"||typeof t=="number")s+=t;else if(typeof t=="object")if(Array.isArray(t)){var o=t.length;for(e=0;e<o;e++)t[e]&&(n=rV(t[e]))&&(s&&(s+=" "),s+=n)}else for(n in t)t[n]&&(s&&(s+=" "),s+=n);return s}function iV(){for(var t,e,n=0,s="",o=arguments.length;n<o;n++)(t=arguments[n])&&(e=rV(t))&&(s&&(s+=" "),s+=e);return s}const ON="-",Xse=t=>{const e=Jse(t),{conflictingClassGroups:n,conflictingClassGroupModifiers:s}=t;return{getClassGroupId:i=>{const a=i.split(ON);return a[0]===""&&a.length!==1&&a.shift(),aV(a,e)||Yse(i)},getConflictingClassGroupIds:(i,a)=>{const l=n[i]||[];return a&&s[i]?[...l,...s[i]]:l}}},aV=(t,e)=>{var i;if(t.length===0)return e.classGroupId;const n=t[0],s=e.nextPart.get(n),o=s?aV(t.slice(1),s):void 0;if(o)return o;if(e.validators.length===0)return;const r=t.join(ON);return(i=e.validators.find(({validator:a})=>a(r)))==null?void 0:i.classGroupId},kF=/^\[(.+)\]$/,Yse=t=>{if(kF.test(t)){const e=kF.exec(t)[1],n=e==null?void 0:e.substring(0,e.indexOf(":"));if(n)return"arbitrary.."+n}},Jse=t=>{const{theme:e,prefix:n}=t,s={nextPart:new Map,validators:[]};return Zse(Object.entries(t.classGroups),n).forEach(([r,i])=>{UT(i,s,r,e)}),s},UT=(t,e,n,s)=>{t.forEach(o=>{if(typeof o=="string"){const r=o===""?e:AF(e,o);r.classGroupId=n;return}if(typeof o=="function"){if(jse(o)){UT(o(s),e,n,s);return}e.validators.push({validator:o,classGroupId:n});return}Object.entries(o).forEach(([r,i])=>{UT(i,AF(e,r),n,s)})})},AF=(t,e)=>{let n=t;return e.split(ON).forEach(s=>{n.nextPart.has(s)||n.nextPart.set(s,{nextPart:new Map,validators:[]}),n=n.nextPart.get(s)}),n},jse=t=>t.isThemeGetter,Zse=(t,e)=>e?t.map(([n,s])=>{const o=s.map(r=>typeof r=="string"?e+r:typeof r=="object"?Object.fromEntries(Object.entries(r).map(([i,a])=>[e+i,a])):r);return[n,o]}):t,Qse=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,n=new Map,s=new Map;const o=(r,i)=>{n.set(r,i),e++,e>t&&(e=0,s=n,n=new Map)};return{get(r){let i=n.get(r);if(i!==void 0)return i;if((i=s.get(r))!==void 0)return o(r,i),i},set(r,i){n.has(r)?n.set(r,i):o(r,i)}}},lV="!",eoe=t=>{const{separator:e,experimentalParseClassName:n}=t,s=e.length===1,o=e[0],r=e.length,i=a=>{const l=[];let u=0,d=0,h;for(let C=0;C<a.length;C++){let T=a[C];if(u===0){if(T===o&&(s||a.slice(C,C+r)===e)){l.push(a.slice(d,C)),d=C+r;continue}if(T==="/"){h=C;continue}}T==="["?u++:T==="]"&&u--}const p=l.length===0?a:a.substring(d),x=p.startsWith(lV),b=x?p.substring(1):p,w=h&&h>d?h-d:void 0;return{modifiers:l,hasImportantModifier:x,baseClassName:b,maybePostfixModifierPosition:w}};return n?a=>n({className:a,parseClassName:i}):i},toe=t=>{if(t.length<=1)return t;const e=[];let n=[];return t.forEach(s=>{s[0]==="["?(e.push(...n.sort(),s),n=[]):n.push(s)}),e.push(...n.sort()),e},noe=t=>({cache:Qse(t.cacheSize),parseClassName:eoe(t),...Xse(t)}),soe=/\s+/,ooe=(t,e)=>{const{parseClassName:n,getClassGroupId:s,getConflictingClassGroupIds:o}=e,r=[],i=t.trim().split(soe);let a="";for(let l=i.length-1;l>=0;l-=1){const u=i[l],{modifiers:d,hasImportantModifier:h,baseClassName:p,maybePostfixModifierPosition:x}=n(u);let b=!!x,w=s(b?p.substring(0,x):p);if(!w){if(!b){a=u+(a.length>0?" "+a:a);continue}if(w=s(p),!w){a=u+(a.length>0?" "+a:a);continue}b=!1}const C=toe(d).join(":"),T=h?C+lV:C,N=T+w;if(r.includes(N))continue;r.push(N);const I=o(w,b);for(let k=0;k<I.length;++k){const A=I[k];r.push(T+A)}a=u+(a.length>0?" "+a:a)}return a};function roe(){let t=0,e,n,s="";for(;t<arguments.length;)(e=arguments[t++])&&(n=uV(e))&&(s&&(s+=" "),s+=n);return s}const uV=t=>{if(typeof t=="string")return t;let e,n="";for(let s=0;s<t.length;s++)t[s]&&(e=uV(t[s]))&&(n&&(n+=" "),n+=e);return n};function ioe(t,...e){let n,s,o,r=i;function i(l){const u=e.reduce((d,h)=>h(d),t());return n=noe(u),s=n.cache.get,o=n.cache.set,r=a,a(l)}function a(l){const u=s(l);if(u)return u;const d=ooe(l,n);return o(l,d),d}return function(){return r(roe.apply(null,arguments))}}const Kt=t=>{const e=n=>n[t]||[];return e.isThemeGetter=!0,e},cV=/^\[(?:([a-z-]+):)?(.+)\]$/i,aoe=/^\d+\/\d+$/,loe=new Set(["px","full","screen"]),uoe=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,coe=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,doe=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,foe=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,hoe=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Si=t=>Fc(t)||loe.has(t)||aoe.test(t),Ca=t=>cd(t,"length",woe),Fc=t=>!!t&&!Number.isNaN(Number(t)),zC=t=>cd(t,"number",Fc),Ah=t=>!!t&&Number.isInteger(Number(t)),poe=t=>t.endsWith("%")&&Fc(t.slice(0,-1)),nt=t=>cV.test(t),Ta=t=>uoe.test(t),moe=new Set(["length","size","percentage"]),goe=t=>cd(t,moe,dV),yoe=t=>cd(t,"position",dV),xoe=new Set(["image","url"]),voe=t=>cd(t,xoe,Toe),boe=t=>cd(t,"",Coe),Rh=()=>!0,cd=(t,e,n)=>{const s=cV.exec(t);return s?s[1]?typeof e=="string"?s[1]===e:e.has(s[1]):n(s[2]):!1},woe=t=>coe.test(t)&&!doe.test(t),dV=()=>!1,Coe=t=>foe.test(t),Toe=t=>hoe.test(t),Soe=()=>{const t=Kt("colors"),e=Kt("spacing"),n=Kt("blur"),s=Kt("brightness"),o=Kt("borderColor"),r=Kt("borderRadius"),i=Kt("borderSpacing"),a=Kt("borderWidth"),l=Kt("contrast"),u=Kt("grayscale"),d=Kt("hueRotate"),h=Kt("invert"),p=Kt("gap"),x=Kt("gradientColorStops"),b=Kt("gradientColorStopPositions"),w=Kt("inset"),C=Kt("margin"),T=Kt("opacity"),N=Kt("padding"),I=Kt("saturate"),k=Kt("scale"),A=Kt("sepia"),$=Kt("skew"),M=Kt("space"),O=Kt("translate"),F=()=>["auto","contain","none"],P=()=>["auto","hidden","clip","visible","scroll"],D=()=>["auto",nt,e],H=()=>[nt,e],Z=()=>["",Si,Ca],ne=()=>["auto",Fc,nt],Q=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],G=()=>["solid","dashed","dotted","double","none"],q=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],J=()=>["start","end","center","between","around","evenly","stretch"],oe=()=>["","0",nt],B=()=>["auto","avoid","all","avoid-page","page","left","right","column"],X=()=>[Fc,nt];return{cacheSize:500,separator:":",theme:{colors:[Rh],spacing:[Si,Ca],blur:["none","",Ta,nt],brightness:X(),borderColor:[t],borderRadius:["none","","full",Ta,nt],borderSpacing:H(),borderWidth:Z(),contrast:X(),grayscale:oe(),hueRotate:X(),invert:oe(),gap:H(),gradientColorStops:[t],gradientColorStopPositions:[poe,Ca],inset:D(),margin:D(),opacity:X(),padding:H(),saturate:X(),scale:X(),sepia:oe(),skew:X(),space:H(),translate:H()},classGroups:{aspect:[{aspect:["auto","square","video",nt]}],container:["container"],columns:[{columns:[Ta]}],"break-after":[{"break-after":B()}],"break-before":[{"break-before":B()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Q(),nt]}],overflow:[{overflow:P()}],"overflow-x":[{"overflow-x":P()}],"overflow-y":[{"overflow-y":P()}],overscroll:[{overscroll:F()}],"overscroll-x":[{"overscroll-x":F()}],"overscroll-y":[{"overscroll-y":F()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[w]}],"inset-x":[{"inset-x":[w]}],"inset-y":[{"inset-y":[w]}],start:[{start:[w]}],end:[{end:[w]}],top:[{top:[w]}],right:[{right:[w]}],bottom:[{bottom:[w]}],left:[{left:[w]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Ah,nt]}],basis:[{basis:D()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",nt]}],grow:[{grow:oe()}],shrink:[{shrink:oe()}],order:[{order:["first","last","none",Ah,nt]}],"grid-cols":[{"grid-cols":[Rh]}],"col-start-end":[{col:["auto",{span:["full",Ah,nt]},nt]}],"col-start":[{"col-start":ne()}],"col-end":[{"col-end":ne()}],"grid-rows":[{"grid-rows":[Rh]}],"row-start-end":[{row:["auto",{span:[Ah,nt]},nt]}],"row-start":[{"row-start":ne()}],"row-end":[{"row-end":ne()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",nt]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",nt]}],gap:[{gap:[p]}],"gap-x":[{"gap-x":[p]}],"gap-y":[{"gap-y":[p]}],"justify-content":[{justify:["normal",...J()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...J(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...J(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[N]}],px:[{px:[N]}],py:[{py:[N]}],ps:[{ps:[N]}],pe:[{pe:[N]}],pt:[{pt:[N]}],pr:[{pr:[N]}],pb:[{pb:[N]}],pl:[{pl:[N]}],m:[{m:[C]}],mx:[{mx:[C]}],my:[{my:[C]}],ms:[{ms:[C]}],me:[{me:[C]}],mt:[{mt:[C]}],mr:[{mr:[C]}],mb:[{mb:[C]}],ml:[{ml:[C]}],"space-x":[{"space-x":[M]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[M]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",nt,e]}],"min-w":[{"min-w":[nt,e,"min","max","fit"]}],"max-w":[{"max-w":[nt,e,"none","full","min","max","fit","prose",{screen:[Ta]},Ta]}],h:[{h:[nt,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[nt,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[nt,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[nt,e,"auto","min","max","fit"]}],"font-size":[{text:["base",Ta,Ca]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",zC]}],"font-family":[{font:[Rh]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",nt]}],"line-clamp":[{"line-clamp":["none",Fc,zC]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Si,nt]}],"list-image":[{"list-image":["none",nt]}],"list-style-type":[{list:["none","disc","decimal",nt]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[T]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[T]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...G(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Si,Ca]}],"underline-offset":[{"underline-offset":["auto",Si,nt]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:H()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",nt]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",nt]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[T]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Q(),yoe]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",goe]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},voe]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[b]}],"gradient-via-pos":[{via:[b]}],"gradient-to-pos":[{to:[b]}],"gradient-from":[{from:[x]}],"gradient-via":[{via:[x]}],"gradient-to":[{to:[x]}],rounded:[{rounded:[r]}],"rounded-s":[{"rounded-s":[r]}],"rounded-e":[{"rounded-e":[r]}],"rounded-t":[{"rounded-t":[r]}],"rounded-r":[{"rounded-r":[r]}],"rounded-b":[{"rounded-b":[r]}],"rounded-l":[{"rounded-l":[r]}],"rounded-ss":[{"rounded-ss":[r]}],"rounded-se":[{"rounded-se":[r]}],"rounded-ee":[{"rounded-ee":[r]}],"rounded-es":[{"rounded-es":[r]}],"rounded-tl":[{"rounded-tl":[r]}],"rounded-tr":[{"rounded-tr":[r]}],"rounded-br":[{"rounded-br":[r]}],"rounded-bl":[{"rounded-bl":[r]}],"border-w":[{border:[a]}],"border-w-x":[{"border-x":[a]}],"border-w-y":[{"border-y":[a]}],"border-w-s":[{"border-s":[a]}],"border-w-e":[{"border-e":[a]}],"border-w-t":[{"border-t":[a]}],"border-w-r":[{"border-r":[a]}],"border-w-b":[{"border-b":[a]}],"border-w-l":[{"border-l":[a]}],"border-opacity":[{"border-opacity":[T]}],"border-style":[{border:[...G(),"hidden"]}],"divide-x":[{"divide-x":[a]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[a]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[T]}],"divide-style":[{divide:G()}],"border-color":[{border:[o]}],"border-color-x":[{"border-x":[o]}],"border-color-y":[{"border-y":[o]}],"border-color-s":[{"border-s":[o]}],"border-color-e":[{"border-e":[o]}],"border-color-t":[{"border-t":[o]}],"border-color-r":[{"border-r":[o]}],"border-color-b":[{"border-b":[o]}],"border-color-l":[{"border-l":[o]}],"divide-color":[{divide:[o]}],"outline-style":[{outline:["",...G()]}],"outline-offset":[{"outline-offset":[Si,nt]}],"outline-w":[{outline:[Si,Ca]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:Z()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[T]}],"ring-offset-w":[{"ring-offset":[Si,Ca]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",Ta,boe]}],"shadow-color":[{shadow:[Rh]}],opacity:[{opacity:[T]}],"mix-blend":[{"mix-blend":[...q(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":q()}],filter:[{filter:["","none"]}],blur:[{blur:[n]}],brightness:[{brightness:[s]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",Ta,nt]}],grayscale:[{grayscale:[u]}],"hue-rotate":[{"hue-rotate":[d]}],invert:[{invert:[h]}],saturate:[{saturate:[I]}],sepia:[{sepia:[A]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[n]}],"backdrop-brightness":[{"backdrop-brightness":[s]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[u]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[d]}],"backdrop-invert":[{"backdrop-invert":[h]}],"backdrop-opacity":[{"backdrop-opacity":[T]}],"backdrop-saturate":[{"backdrop-saturate":[I]}],"backdrop-sepia":[{"backdrop-sepia":[A]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[i]}],"border-spacing-x":[{"border-spacing-x":[i]}],"border-spacing-y":[{"border-spacing-y":[i]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",nt]}],duration:[{duration:X()}],ease:[{ease:["linear","in","out","in-out",nt]}],delay:[{delay:X()}],animate:[{animate:["none","spin","ping","pulse","bounce",nt]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[k]}],"scale-x":[{"scale-x":[k]}],"scale-y":[{"scale-y":[k]}],rotate:[{rotate:[Ah,nt]}],"translate-x":[{"translate-x":[O]}],"translate-y":[{"translate-y":[O]}],"skew-x":[{"skew-x":[$]}],"skew-y":[{"skew-y":[$]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",nt]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",nt]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":H()}],"scroll-mx":[{"scroll-mx":H()}],"scroll-my":[{"scroll-my":H()}],"scroll-ms":[{"scroll-ms":H()}],"scroll-me":[{"scroll-me":H()}],"scroll-mt":[{"scroll-mt":H()}],"scroll-mr":[{"scroll-mr":H()}],"scroll-mb":[{"scroll-mb":H()}],"scroll-ml":[{"scroll-ml":H()}],"scroll-p":[{"scroll-p":H()}],"scroll-px":[{"scroll-px":H()}],"scroll-py":[{"scroll-py":H()}],"scroll-ps":[{"scroll-ps":H()}],"scroll-pe":[{"scroll-pe":H()}],"scroll-pt":[{"scroll-pt":H()}],"scroll-pr":[{"scroll-pr":H()}],"scroll-pb":[{"scroll-pb":H()}],"scroll-pl":[{"scroll-pl":H()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",nt]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[Si,Ca,zC]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Noe=ioe(Soe);/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/function ls(...t){return Noe(iV(t))}const Uc=Ge.forwardRef(({className:t,...e},n)=>U.jsx("div",{ref:n,className:ls("rounded-xl border border-neutral-800 bg-neutral-900/50 text-neutral-100 shadow-lg relative","before:absolute before:inset-0 before:p-[1px] before:rounded-xl before:bg-gradient-to-br before:from-pink-500/50 before:to-purple-600/50 before:[mask:linear-gradient(black,black)_content-box,linear-gradient(black,black)] before:[mask-composite:exclude] before:pointer-events-none",t),...e}));Uc.displayName="Card";const PN=Ge.forwardRef(({className:t,...e},n)=>U.jsx("div",{ref:n,className:ls("p-6",t),...e}));PN.displayName="CardContent";const Eoe=Ge.forwardRef(({className:t,...e},n)=>U.jsx("div",{ref:n,className:ls("flex flex-col space-y-1.5 p-6",t),...e}));Eoe.displayName="CardHeader";const Ioe=Ge.forwardRef(({className:t,...e},n)=>U.jsx("h3",{ref:n,className:ls("font-semibold leading-none tracking-tight",t),...e}));Ioe.displayName="CardTitle";const koe=Ge.forwardRef(({className:t,...e},n)=>U.jsx("p",{ref:n,className:ls("text-sm text-neutral-400",t),...e}));koe.displayName="CardDescription";const Aoe=Ge.forwardRef(({className:t,...e},n)=>U.jsx("div",{ref:n,className:ls("flex items-center p-6 pt-0",t),...e}));Aoe.displayName="CardFooter";const dp=({className:t,message:e})=>U.jsxs("div",{className:ls("flex flex-col items-center justify-center gap-4 text-center",t),children:[U.jsxs("svg",{className:"animate-spin h-8 w-8 text-neutral-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[U.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),U.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e&&U.jsx("p",{className:"text-neutral-300 text-sm font-medium animate-pulse",children:e})]}),RF=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,$F=iV,Roe=(t,e)=>n=>{var s;if((e==null?void 0:e.variants)==null)return $F(t,n==null?void 0:n.class,n==null?void 0:n.className);const{variants:o,defaultVariants:r}=e,i=Object.keys(o).map(u=>{const d=n==null?void 0:n[u],h=r==null?void 0:r[u];if(d===null)return null;const p=RF(d)||RF(h);return o[u][p]}),a=n&&Object.entries(n).reduce((u,d)=>{let[h,p]=d;return p===void 0||(u[h]=p),u},{}),l=e==null||(s=e.compoundVariants)===null||s===void 0?void 0:s.reduce((u,d)=>{let{class:h,className:p,...x}=d;return Object.entries(x).every(b=>{let[w,C]=b;return Array.isArray(C)?C.includes({...r,...a}[w]):{...r,...a}[w]===C})?[...u,h,p]:u},[]);return $F(t,i,l,n==null?void 0:n.class,n==null?void 0:n.className)},$oe=Roe("inline-flex items-center justify-center rounded-md text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{primary:"bg-gradient-to-r from-pink-500 to-purple-600 text-white shadow-lg hover:from-pink-600 hover:to-purple-700 transform hover:scale-105",secondary:"bg-neutral-800 text-neutral-300 border border-neutral-700 hover:bg-neutral-700 hover:text-white",ghost:"hover:bg-neutral-800 hover:text-neutral-200 text-neutral-400",destructive:"bg-red-900/50 text-red-400 hover:bg-red-900/80 border border-red-500/30"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"primary",size:"default"}}),St=Ge.forwardRef(({className:t,variant:e,size:n,...s},o)=>U.jsx("button",{className:ls($oe({variant:e,size:n,className:t})),ref:o,...s}));St.displayName="Button";/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Doe=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),fV=(...t)=>t.filter((e,n,s)=>!!e&&s.indexOf(e)===n).join(" ");/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var _oe={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Moe=ce.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:n=2,absoluteStrokeWidth:s,className:o="",children:r,iconNode:i,...a},l)=>ce.createElement("svg",{ref:l,..._oe,width:e,height:e,stroke:t,strokeWidth:s?Number(n)*24/Number(e):n,className:fV("lucide",o),...a},[...i.map(([u,d])=>ce.createElement(u,d)),...Array.isArray(r)?r:[r]]));/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const An=(t,e)=>{const n=ce.forwardRef(({className:s,...o},r)=>ce.createElement(Moe,{ref:r,iconNode:e,className:fV(`lucide-${Doe(t)}`,s),...o}));return n.displayName=`${t}`,n};/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DF=An("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Foe=An("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ooe=An("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Poe=An("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zp=An("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Loe=An("Facebook",[["path",{d:"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z",key:"1jg4f8"}]]);/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _F=An("FileImage",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]]);/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Voe=An("GitCompareArrows",[["circle",{cx:"5",cy:"6",r:"3",key:"1qnov2"}],["path",{d:"M12 6h5a2 2 0 0 1 2 2v7",key:"1yj91y"}],["path",{d:"m15 9-3-3 3-3",key:"1lwv8l"}],["circle",{cx:"19",cy:"18",r:"3",key:"1qljk2"}],["path",{d:"M12 18H7a2 2 0 0 1-2-2V9",key:"16sdep"}],["path",{d:"m9 15 3 3-3 3",key:"1m3kbl"}]]);/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zoe=An("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Boe=An("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uoe=An("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Goe=An("Repeat",[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]]);/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BC=An("Replace",[["path",{d:"M14 4c0-1.1.9-2 2-2",key:"1mvvbw"}],["path",{d:"M20 2c1.1 0 2 .9 2 2",key:"1mj6oe"}],["path",{d:"M22 8c0 1.1-.9 2-2 2",key:"v1wql3"}],["path",{d:"M16 10c-1.1 0-2-.9-2-2",key:"821ux0"}],["path",{d:"m3 7 3 3 3-3",key:"x25e72"}],["path",{d:"M6 10V5c0-1.7 1.3-3 3-3h1",key:"13af7h"}],["rect",{width:"8",height:"8",x:"2",y:"14",rx:"2",key:"17ihk4"}]]);/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LN=An("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hoe=An("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Woe=An("SwitchCamera",[["path",{d:"M11 19H4a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h5",key:"mtk2lu"}],["path",{d:"M13 5h7a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-5",key:"120jsl"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"m18 22-3-3 3-3",key:"kgdoj7"}],["path",{d:"m6 2 3 3-3 3",key:"1fnbkv"}]]);/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hV=An("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pV=An("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qoe=An("Twitter",[["path",{d:"M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z",key:"pff0z6"}]]);/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ky=An("WandSparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);/**
 * @license lucide-react v0.418.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dd=An("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Koe={},MF=t=>{let e;const n=new Set,s=(d,h)=>{const p=typeof d=="function"?d(e):d;if(!Object.is(p,e)){const x=e;e=h??(typeof p!="object"||p===null)?p:Object.assign({},e,p),n.forEach(b=>b(e,x))}},o=()=>e,l={setState:s,getState:o,getInitialState:()=>u,subscribe:d=>(n.add(d),()=>n.delete(d)),destroy:()=>{(Koe?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},u=e=t(s,o,l);return l},Xoe=t=>t?MF(t):MF;var UC={exports:{}},GC={},HC={exports:{}},WC={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var FF;function Yoe(){if(FF)return WC;FF=1;var t=Mp();function e(h,p){return h===p&&(h!==0||1/h===1/p)||h!==h&&p!==p}var n=typeof Object.is=="function"?Object.is:e,s=t.useState,o=t.useEffect,r=t.useLayoutEffect,i=t.useDebugValue;function a(h,p){var x=p(),b=s({inst:{value:x,getSnapshot:p}}),w=b[0].inst,C=b[1];return r(function(){w.value=x,w.getSnapshot=p,l(w)&&C({inst:w})},[h,x,p]),o(function(){return l(w)&&C({inst:w}),h(function(){l(w)&&C({inst:w})})},[h]),i(x),x}function l(h){var p=h.getSnapshot;h=h.value;try{var x=p();return!n(h,x)}catch{return!0}}function u(h,p){return p()}var d=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?u:a;return WC.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:d,WC}var OF;function Joe(){return OF||(OF=1,HC.exports=Yoe()),HC.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var PF;function joe(){if(PF)return GC;PF=1;var t=Mp(),e=Joe();function n(u,d){return u===d&&(u!==0||1/u===1/d)||u!==u&&d!==d}var s=typeof Object.is=="function"?Object.is:n,o=e.useSyncExternalStore,r=t.useRef,i=t.useEffect,a=t.useMemo,l=t.useDebugValue;return GC.useSyncExternalStoreWithSelector=function(u,d,h,p,x){var b=r(null);if(b.current===null){var w={hasValue:!1,value:null};b.current=w}else w=b.current;b=a(function(){function T($){if(!N){if(N=!0,I=$,$=p($),x!==void 0&&w.hasValue){var M=w.value;if(x(M,$))return k=M}return k=$}if(M=k,s(I,$))return M;var O=p($);return x!==void 0&&x(M,O)?(I=$,M):(I=$,k=O)}var N=!1,I,k,A=h===void 0?null:h;return[function(){return T(d())},A===null?void 0:function(){return T(A())}]},[d,h,p,x]);var C=o(u,b[0],b[1]);return i(function(){w.hasValue=!0,w.value=C},[C]),l(C),C},GC}var LF;function Zoe(){return LF||(LF=1,UC.exports=joe()),UC.exports}var Qoe=Zoe();const ere=Cx(Qoe),mV={},{useDebugValue:tre}=Ge,{useSyncExternalStoreWithSelector:nre}=ere;let VF=!1;const sre=t=>t;function ore(t,e=sre,n){(mV?"production":void 0)!=="production"&&n&&!VF&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),VF=!0);const s=nre(t.subscribe,t.getState,t.getServerState||t.getInitialState,e,n);return tre(s),s}const rre=t=>{(mV?"production":void 0)!=="production"&&typeof t!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof t=="function"?Xoe(t):t,n=(s,o)=>ore(e,s,o);return Object.assign(n,e),n},ire=t=>rre,are={};function gV(t,e){let n;try{n=t()}catch{return}return{getItem:o=>{var r;const i=l=>l===null?null:JSON.parse(l,void 0),a=(r=n.getItem(o))!=null?r:null;return a instanceof Promise?a.then(i):i(a)},setItem:(o,r)=>n.setItem(o,JSON.stringify(r,void 0)),removeItem:o=>n.removeItem(o)}}const fp=t=>e=>{try{const n=t(e);return n instanceof Promise?n:{then(s){return fp(s)(n)},catch(s){return this}}}catch(n){return{then(s){return this},catch(s){return fp(s)(n)}}}},lre=(t,e)=>(n,s,o)=>{let r={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:C=>C,version:0,merge:(C,T)=>({...T,...C}),...e},i=!1;const a=new Set,l=new Set;let u;try{u=r.getStorage()}catch{}if(!u)return t((...C)=>{console.warn(`[zustand persist middleware] Unable to update item '${r.name}', the given storage is currently unavailable.`),n(...C)},s,o);const d=fp(r.serialize),h=()=>{const C=r.partialize({...s()});let T;const N=d({state:C,version:r.version}).then(I=>u.setItem(r.name,I)).catch(I=>{T=I});if(T)throw T;return N},p=o.setState;o.setState=(C,T)=>{p(C,T),h()};const x=t((...C)=>{n(...C),h()},s,o);let b;const w=()=>{var C;if(!u)return;i=!1,a.forEach(N=>N(s()));const T=((C=r.onRehydrateStorage)==null?void 0:C.call(r,s()))||void 0;return fp(u.getItem.bind(u))(r.name).then(N=>{if(N)return r.deserialize(N)}).then(N=>{if(N)if(typeof N.version=="number"&&N.version!==r.version){if(r.migrate)return r.migrate(N.state,N.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return N.state}).then(N=>{var I;return b=r.merge(N,(I=s())!=null?I:x),n(b,!0),h()}).then(()=>{T==null||T(b,void 0),i=!0,l.forEach(N=>N(b))}).catch(N=>{T==null||T(void 0,N)})};return o.persist={setOptions:C=>{r={...r,...C},C.getStorage&&(u=C.getStorage())},clearStorage:()=>{u==null||u.removeItem(r.name)},getOptions:()=>r,rehydrate:()=>w(),hasHydrated:()=>i,onHydrate:C=>(a.add(C),()=>{a.delete(C)}),onFinishHydration:C=>(l.add(C),()=>{l.delete(C)})},w(),b||x},ure=(t,e)=>(n,s,o)=>{let r={storage:gV(()=>localStorage),partialize:w=>w,version:0,merge:(w,C)=>({...C,...w}),...e},i=!1;const a=new Set,l=new Set;let u=r.storage;if(!u)return t((...w)=>{console.warn(`[zustand persist middleware] Unable to update item '${r.name}', the given storage is currently unavailable.`),n(...w)},s,o);const d=()=>{const w=r.partialize({...s()});return u.setItem(r.name,{state:w,version:r.version})},h=o.setState;o.setState=(w,C)=>{h(w,C),d()};const p=t((...w)=>{n(...w),d()},s,o);o.getInitialState=()=>p;let x;const b=()=>{var w,C;if(!u)return;i=!1,a.forEach(N=>{var I;return N((I=s())!=null?I:p)});const T=((C=r.onRehydrateStorage)==null?void 0:C.call(r,(w=s())!=null?w:p))||void 0;return fp(u.getItem.bind(u))(r.name).then(N=>{if(N)if(typeof N.version=="number"&&N.version!==r.version){if(r.migrate)return[!0,r.migrate(N.state,N.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,N.state];return[!1,void 0]}).then(N=>{var I;const[k,A]=N;if(x=r.merge(A,(I=s())!=null?I:p),n(x,!0),k)return d()}).then(()=>{T==null||T(x,void 0),x=s(),i=!0,l.forEach(N=>N(x))}).catch(N=>{T==null||T(void 0,N)})};return o.persist={setOptions:w=>{r={...r,...w},w.storage&&(u=w.storage)},clearStorage:()=>{u==null||u.removeItem(r.name)},getOptions:()=>r,rehydrate:()=>b(),hasHydrated:()=>i,onHydrate:w=>(a.add(w),()=>{a.delete(w)}),onFinishHydration:w=>(l.add(w),()=>{l.delete(w)})},r.skipHydration||b(),x||p},cre=(t,e)=>"getStorage"in e||"serialize"in e||"deserialize"in e?((are?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),lre(t,e)):ure(t,e),dre=cre;/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/const xr=ire()(dre((t,e)=>({uploadedImage:null,hairstyleDescription:"",hairstyleReferenceImage:null,hairstyleReferenceDescription:"",hairstyleModification:"",useMasking:!0,hairColor:"",inputMode:"text",generatedImages:{},isGenerating:!1,appState:"idle",comparisonSourceImage:null,videoStatus:"idle",videoUrl:null,videoProgress:"",videoError:"",generationHistory:[],isHistoryPanelOpen:!1,isShareMenuOpen:!1,shareContent:null,installPromptEvent:null,setUploadedImage:n=>{e().resetInputs(),t({uploadedImage:n,appState:n?"image-uploaded":"idle",comparisonSourceImage:n})},setHairstyleDescription:n=>t({hairstyleDescription:n}),setHairstyleReferenceImage:n=>t({hairstyleReferenceImage:n}),setHairstyleReferenceDescription:n=>t({hairstyleReferenceDescription:n}),setHairstyleModification:n=>t({hairstyleModification:n}),setUseMasking:n=>t({useMasking:n}),setHairColor:n=>t({hairColor:n}),setInputMode:n=>t({inputMode:n}),resetInputs:()=>t({hairstyleDescription:"",hairstyleReferenceImage:null,hairstyleReferenceDescription:"",hairstyleModification:"",hairColor:"",generatedImages:{},videoStatus:"idle",videoUrl:null,videoError:"",videoProgress:""}),startGeneration:()=>{const n={};["front","left","right","back"].forEach(s=>{n[s]={status:"pending"}}),t({isGenerating:!0,appState:"generating-results",videoStatus:"idle",videoUrl:null,generatedImages:n})},setAngleStatus:(n,s,o,r)=>{t(i=>({generatedImages:{...i.generatedImages,[n]:{status:s,url:o,error:r}}}))},finishGeneration:()=>t({isGenerating:!1}),setComparisonSourceImage:n=>t({comparisonSourceImage:n}),setVideoStatus:n=>t({videoStatus:n}),setVideoUrl:n=>t({videoUrl:n}),setVideoProgress:n=>t({videoProgress:n}),setVideoError:n=>t({videoError:n}),addToHistory:n=>t(s=>({generationHistory:[n,...s.generationHistory].slice(0,50)})),clearHistory:()=>t({generationHistory:[]}),toggleFavorite:n=>t(s=>({generationHistory:s.generationHistory.map(o=>o.id===n?{...o,isFavorite:!o.isFavorite}:o)})),restoreFromHistory:n=>t({...n,appState:"generating-results",isHistoryPanelOpen:!1,videoStatus:n.generatedVideoUrl?"done":"idle",videoUrl:n.generatedVideoUrl||null,inputMode:n.hairstyleReferenceImage?"image":"text",comparisonSourceImage:n.uploadedImage}),setHistory:n=>t({generationHistory:n}),setHistoryPanelOpen:n=>t({isHistoryPanelOpen:n}),openShareMenu:n=>t({isShareMenuOpen:!0,shareContent:n}),closeShareMenu:()=>t({isShareMenuOpen:!1}),setInstallPromptEvent:n=>t({installPromptEvent:n})}),{name:"barber-booth-pro-storage",storage:gV(()=>localStorage),partialize:t=>({generationHistory:t.generationHistory})}));let fre={data:""},hre=t=>typeof window=="object"?((t?t.querySelector("#_goober"):window._goober)||Object.assign((t||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:t||fre,pre=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,mre=/\/\*[^]*?\*\/|  +/g,zF=/\n+/g,Aa=(t,e)=>{let n="",s="",o="";for(let r in t){let i=t[r];r[0]=="@"?r[1]=="i"?n=r+" "+i+";":s+=r[1]=="f"?Aa(i,r):r+"{"+Aa(i,r[1]=="k"?"":e)+"}":typeof i=="object"?s+=Aa(i,e?e.replace(/([^,])+/g,a=>r.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,l=>/&/.test(l)?l.replace(/&/g,a):a?a+" "+l:l)):r):i!=null&&(r=/^--/.test(r)?r:r.replace(/[A-Z]/g,"-$&").toLowerCase(),o+=Aa.p?Aa.p(r,i):r+":"+i+";")}return n+(e&&o?e+"{"+o+"}":o)+s},Ni={},yV=t=>{if(typeof t=="object"){let e="";for(let n in t)e+=n+yV(t[n]);return e}return t},gre=(t,e,n,s,o)=>{let r=yV(t),i=Ni[r]||(Ni[r]=(l=>{let u=0,d=11;for(;u<l.length;)d=101*d+l.charCodeAt(u++)>>>0;return"go"+d})(r));if(!Ni[i]){let l=r!==t?t:(u=>{let d,h,p=[{}];for(;d=pre.exec(u.replace(mre,""));)d[4]?p.shift():d[3]?(h=d[3].replace(zF," ").trim(),p.unshift(p[0][h]=p[0][h]||{})):p[0][d[1]]=d[2].replace(zF," ").trim();return p[0]})(t);Ni[i]=Aa(o?{["@keyframes "+i]:l}:l,n?"":"."+i)}let a=n&&Ni.g?Ni.g:null;return n&&(Ni.g=Ni[i]),((l,u,d,h)=>{h?u.data=u.data.replace(h,l):u.data.indexOf(l)===-1&&(u.data=d?l+u.data:u.data+l)})(Ni[i],e,s,a),i},yre=(t,e,n)=>t.reduce((s,o,r)=>{let i=e[r];if(i&&i.call){let a=i(n),l=a&&a.props&&a.props.className||/^go/.test(a)&&a;i=l?"."+l:a&&typeof a=="object"?a.props?"":Aa(a,""):a===!1?"":a}return s+o+(i??"")},"");function $x(t){let e=this||{},n=t.call?t(e.p):t;return gre(n.unshift?n.raw?yre(n,[].slice.call(arguments,1),e.p):n.reduce((s,o)=>Object.assign(s,o&&o.call?o(e.p):o),{}):n,hre(e.target),e.g,e.o,e.k)}let xV,GT,HT;$x.bind({g:1});let Mi=$x.bind({k:1});function xre(t,e,n,s){Aa.p=e,xV=t,GT=n,HT=s}function Za(t,e){let n=this||{};return function(){let s=arguments;function o(r,i){let a=Object.assign({},r),l=a.className||o.className;n.p=Object.assign({theme:GT&&GT()},a),n.o=/ *go\d+/.test(l),a.className=$x.apply(n,s)+(l?" "+l:"");let u=t;return t[0]&&(u=a.as||t,delete a.as),HT&&u[0]&&HT(a),xV(u,a)}return o}}var vre=t=>typeof t=="function",G0=(t,e)=>vre(t)?t(e):t,bre=(()=>{let t=0;return()=>(++t).toString()})(),vV=(()=>{let t;return()=>{if(t===void 0&&typeof window<"u"){let e=matchMedia("(prefers-reduced-motion: reduce)");t=!e||e.matches}return t}})(),wre=20,VN="default",bV=(t,e)=>{let{toastLimit:n}=t.settings;switch(e.type){case 0:return{...t,toasts:[e.toast,...t.toasts].slice(0,n)};case 1:return{...t,toasts:t.toasts.map(i=>i.id===e.toast.id?{...i,...e.toast}:i)};case 2:let{toast:s}=e;return bV(t,{type:t.toasts.find(i=>i.id===s.id)?1:0,toast:s});case 3:let{toastId:o}=e;return{...t,toasts:t.toasts.map(i=>i.id===o||o===void 0?{...i,dismissed:!0,visible:!1}:i)};case 4:return e.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(i=>i.id!==e.toastId)};case 5:return{...t,pausedAt:e.time};case 6:let r=e.time-(t.pausedAt||0);return{...t,pausedAt:void 0,toasts:t.toasts.map(i=>({...i,pauseDuration:i.pauseDuration+r}))}}},y0=[],wV={toasts:[],pausedAt:void 0,settings:{toastLimit:wre}},Hr={},CV=(t,e=VN)=>{Hr[e]=bV(Hr[e]||wV,t),y0.forEach(([n,s])=>{n===e&&s(Hr[e])})},TV=t=>Object.keys(Hr).forEach(e=>CV(t,e)),Cre=t=>Object.keys(Hr).find(e=>Hr[e].toasts.some(n=>n.id===t)),Dx=(t=VN)=>e=>{CV(e,t)},Tre={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},Sre=(t={},e=VN)=>{let[n,s]=ce.useState(Hr[e]||wV),o=ce.useRef(Hr[e]);ce.useEffect(()=>(o.current!==Hr[e]&&s(Hr[e]),y0.push([e,s]),()=>{let i=y0.findIndex(([a])=>a===e);i>-1&&y0.splice(i,1)}),[e]);let r=n.toasts.map(i=>{var a,l,u;return{...t,...t[i.type],...i,removeDelay:i.removeDelay||((a=t[i.type])==null?void 0:a.removeDelay)||(t==null?void 0:t.removeDelay),duration:i.duration||((l=t[i.type])==null?void 0:l.duration)||(t==null?void 0:t.duration)||Tre[i.type],style:{...t.style,...(u=t[i.type])==null?void 0:u.style,...i.style}}});return{...n,toasts:r}},Nre=(t,e="blank",n)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:e,ariaProps:{role:"status","aria-live":"polite"},message:t,pauseDuration:0,...n,id:(n==null?void 0:n.id)||bre()}),Bp=t=>(e,n)=>{let s=Nre(e,t,n);return Dx(s.toasterId||Cre(s.id))({type:2,toast:s}),s.id},Hn=(t,e)=>Bp("blank")(t,e);Hn.error=Bp("error");Hn.success=Bp("success");Hn.loading=Bp("loading");Hn.custom=Bp("custom");Hn.dismiss=(t,e)=>{let n={type:3,toastId:t};e?Dx(e)(n):TV(n)};Hn.dismissAll=t=>Hn.dismiss(void 0,t);Hn.remove=(t,e)=>{let n={type:4,toastId:t};e?Dx(e)(n):TV(n)};Hn.removeAll=t=>Hn.remove(void 0,t);Hn.promise=(t,e,n)=>{let s=Hn.loading(e.loading,{...n,...n==null?void 0:n.loading});return typeof t=="function"&&(t=t()),t.then(o=>{let r=e.success?G0(e.success,o):void 0;return r?Hn.success(r,{id:s,...n,...n==null?void 0:n.success}):Hn.dismiss(s),o}).catch(o=>{let r=e.error?G0(e.error,o):void 0;r?Hn.error(r,{id:s,...n,...n==null?void 0:n.error}):Hn.dismiss(s)}),t};var Ere=1e3,Ire=(t,e="default")=>{let{toasts:n,pausedAt:s}=Sre(t,e),o=ce.useRef(new Map).current,r=ce.useCallback((h,p=Ere)=>{if(o.has(h))return;let x=setTimeout(()=>{o.delete(h),i({type:4,toastId:h})},p);o.set(h,x)},[]);ce.useEffect(()=>{if(s)return;let h=Date.now(),p=n.map(x=>{if(x.duration===1/0)return;let b=(x.duration||0)+x.pauseDuration-(h-x.createdAt);if(b<0){x.visible&&Hn.dismiss(x.id);return}return setTimeout(()=>Hn.dismiss(x.id,e),b)});return()=>{p.forEach(x=>x&&clearTimeout(x))}},[n,s,e]);let i=ce.useCallback(Dx(e),[e]),a=ce.useCallback(()=>{i({type:5,time:Date.now()})},[i]),l=ce.useCallback((h,p)=>{i({type:1,toast:{id:h,height:p}})},[i]),u=ce.useCallback(()=>{s&&i({type:6,time:Date.now()})},[s,i]),d=ce.useCallback((h,p)=>{let{reverseOrder:x=!1,gutter:b=8,defaultPosition:w}=p||{},C=n.filter(I=>(I.position||w)===(h.position||w)&&I.height),T=C.findIndex(I=>I.id===h.id),N=C.filter((I,k)=>k<T&&I.visible).length;return C.filter(I=>I.visible).slice(...x?[N+1]:[0,N]).reduce((I,k)=>I+(k.height||0)+b,0)},[n]);return ce.useEffect(()=>{n.forEach(h=>{if(h.dismissed)r(h.id,h.removeDelay);else{let p=o.get(h.id);p&&(clearTimeout(p),o.delete(h.id))}})},[n,r]),{toasts:n,handlers:{updateHeight:l,startPause:a,endPause:u,calculateOffset:d}}},kre=Mi`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,Are=Mi`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Rre=Mi`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,$re=Za("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${kre} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${Are} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${t=>t.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${Rre} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,Dre=Mi`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,_re=Za("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${t=>t.secondary||"#e0e0e0"};
  border-right-color: ${t=>t.primary||"#616161"};
  animation: ${Dre} 1s linear infinite;
`,Mre=Mi`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,Fre=Mi`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,Ore=Za("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Mre} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${Fre} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${t=>t.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,Pre=Za("div")`
  position: absolute;
`,Lre=Za("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,Vre=Mi`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,zre=Za("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${Vre} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,Bre=({toast:t})=>{let{icon:e,type:n,iconTheme:s}=t;return e!==void 0?typeof e=="string"?ce.createElement(zre,null,e):e:n==="blank"?null:ce.createElement(Lre,null,ce.createElement(_re,{...s}),n!=="loading"&&ce.createElement(Pre,null,n==="error"?ce.createElement($re,{...s}):ce.createElement(Ore,{...s})))},Ure=t=>`
0% {transform: translate3d(0,${t*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,Gre=t=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${t*-150}%,-1px) scale(.6); opacity:0;}
`,Hre="0%{opacity:0;} 100%{opacity:1;}",Wre="0%{opacity:1;} 100%{opacity:0;}",qre=Za("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,Kre=Za("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,Xre=(t,e)=>{let n=t.includes("top")?1:-1,[s,o]=vV()?[Hre,Wre]:[Ure(n),Gre(n)];return{animation:e?`${Mi(s)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${Mi(o)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},Yre=ce.memo(({toast:t,position:e,style:n,children:s})=>{let o=t.height?Xre(t.position||e||"top-center",t.visible):{opacity:0},r=ce.createElement(Bre,{toast:t}),i=ce.createElement(Kre,{...t.ariaProps},G0(t.message,t));return ce.createElement(qre,{className:t.className,style:{...o,...n,...t.style}},typeof s=="function"?s({icon:r,message:i}):ce.createElement(ce.Fragment,null,r,i))});xre(ce.createElement);var Jre=({id:t,className:e,style:n,onHeightUpdate:s,children:o})=>{let r=ce.useCallback(i=>{if(i){let a=()=>{let l=i.getBoundingClientRect().height;s(t,l)};a(),new MutationObserver(a).observe(i,{subtree:!0,childList:!0,characterData:!0})}},[t,s]);return ce.createElement("div",{ref:r,className:e,style:n},o)},jre=(t,e)=>{let n=t.includes("top"),s=n?{top:0}:{bottom:0},o=t.includes("center")?{justifyContent:"center"}:t.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:vV()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${e*(n?1:-1)}px)`,...s,...o}},Zre=$x`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,Xy=16,Qre=({reverseOrder:t,position:e="top-center",toastOptions:n,gutter:s,children:o,toasterId:r,containerStyle:i,containerClassName:a})=>{let{toasts:l,handlers:u}=Ire(n,r);return ce.createElement("div",{"data-rht-toaster":r||"",style:{position:"fixed",zIndex:9999,top:Xy,left:Xy,right:Xy,bottom:Xy,pointerEvents:"none",...i},className:a,onMouseEnter:u.startPause,onMouseLeave:u.endPause},l.map(d=>{let h=d.position||e,p=u.calculateOffset(d,{reverseOrder:t,gutter:s,defaultPosition:e}),x=jre(h,p);return ce.createElement(Jre,{id:d.id,key:d.id,onHeightUpdate:u.updateHeight,className:d.visible?Zre:"",style:x},d.type==="custom"?G0(d.message,d):o?o(d):ce.createElement(Yre,{toast:d,position:h}))}))},Ft=Hn;/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/async function eie(t,e){try{const s=await(await fetch(t)).blob();return new File([s],e,{type:s.type})}catch(n){return console.error("Error converting data URL to file:",n),null}}async function zN(t,e){const{url:n,title:s,type:o}=t,r=o==="image"?"jpg":"mp4",i=`barber-booth-pro-${s.toLowerCase().replace(/\s/g,"-")}.${r}`,a=`Check out this "${s}" hairstyle I created with Barber Booth Pro!`,l=await eie(n,i);if(!l){Ft.error("Could not prepare file for sharing."),e();return}const u={title:"Barber Booth Pro",text:a,files:[l]};if(navigator.share&&navigator.canShare&&navigator.canShare(u))try{await navigator.share(u)}catch(d){d instanceof Error&&d.name!=="AbortError"&&(console.error("Error using Web Share API:",d),Ft.error("Something went wrong while sharing."),e())}else e()}const tie=({beforeImage:t,afterImage:e,onClose:n})=>{const[s,o]=ce.useState(50),r=ce.useRef(null),i=ce.useRef(!1),a=ce.useCallback(d=>{if(!i.current||!r.current)return;const h=r.current.getBoundingClientRect(),x=(d-h.left)/h.width*100;o(Math.max(0,Math.min(100,x)))},[]),l=d=>{d.cancelable&&d.preventDefault(),i.current=!0,"touches"in d&&a(d.touches[0].clientX)},u=ce.useCallback(()=>{i.current=!1},[]);return ce.useEffect(()=>{const d=p=>a(p.clientX),h=p=>{p.touches[0]&&a(p.touches[0].clientX)};return window.addEventListener("mousemove",d),window.addEventListener("mouseup",u),window.addEventListener("touchmove",h),window.addEventListener("touchend",u),()=>{window.removeEventListener("mousemove",d),window.removeEventListener("mouseup",u),window.removeEventListener("touchmove",h),window.removeEventListener("touchend",u)}},[a,u]),U.jsx(Tn.div,{className:"absolute inset-0 z-30",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:U.jsxs("div",{ref:r,className:"relative w-full h-full overflow-hidden select-none",children:[U.jsx("div",{className:"absolute inset-0 bg-cover bg-center",style:{backgroundImage:`url(${t})`}}),U.jsx("div",{className:"absolute inset-0 bg-cover bg-center",style:{backgroundImage:`url(${e})`,clipPath:`polygon(0 0, ${s}% 0, ${s}% 100%, 0 100%)`}}),U.jsx("button",{onClick:n,className:"absolute top-4 right-4 z-50 flex h-8 w-8 items-center justify-center rounded-full bg-black/60 text-white transition-transform hover:bg-black/80 active:scale-95","aria-label":"Close comparison",children:U.jsx(dd,{className:"h-5 w-5"})}),U.jsx("div",{className:"absolute top-0 bottom-0 w-14 -translate-x-1/2 cursor-ew-resize z-40",style:{left:`${s}%`},onMouseDown:l,onTouchStart:l,children:U.jsxs("div",{className:"relative h-full w-full flex items-center justify-center",children:[U.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-white/80 shadow-lg"}),U.jsx("div",{className:"flex h-14 w-14 items-center justify-center rounded-full border-2 border-white bg-black/50 backdrop-blur-sm text-white shadow-xl",children:U.jsxs("svg",{className:"w-8 h-8",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[U.jsx("polyline",{points:"10 7 6 12 10 17"}),U.jsx("polyline",{points:"14 7 18 12 14 17"})]})})]})})]})})},nie="modulepreload",sie=function(t){return"/"+t},BF={},oie=function(e,n,s){let o=Promise.resolve();if(n&&n.length>0){let i=function(u){return Promise.all(u.map(d=>Promise.resolve(d).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));o=i(n.map(u=>{if(u=sie(u),u in BF)return;BF[u]=!0;const d=u.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${h}`))return;const p=document.createElement("link");if(p.rel=d?"stylesheet":nie,d||(p.as="script"),p.crossOrigin="",p.href=u,l&&p.setAttribute("nonce",l),document.head.appendChild(p),d)return new Promise((x,b)=>{p.addEventListener("load",x),p.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${u}`)))})}))}function r(i){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=i,window.dispatchEvent(a),!a.defaultPrevented)throw i}return o.then(i=>{for(const a of i||[])a.status==="rejected"&&r(a.reason);return e().catch(r)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rie=1e-7,iie=1e-4;class BN{constructor(e,n){this.backend=e,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,n){this.dataIdsCount++,this.data.set(e,n)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class _x{refCount(e){return so("refCount")}incRef(e){return so("incRef")}timerAvailable(){return!0}time(e){return so("time")}read(e){return so("read")}readSync(e){return so("readSync")}readToGPU(e,n){return so("readToGPU")}numDataIds(){return so("numDataIds")}disposeData(e,n){return so("disposeData")}write(e,n,s){return so("write")}move(e,n,s,o,r){return so("move")}createTensorFromGPUData(e,n,s){return so("createTensorFromGPUData")}memory(){return so("memory")}floatPrecision(){return so("floatPrecision")}epsilon(){return this.floatPrecision()===32?rie:iie}dispose(){return so("dispose")}}function so(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UN(t){let e=t.length,n=0;for(;e>0;)n=Math.random()*e|0,e--,Ai(t,e,n)}function aie(t,e){if(t.length!==e.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${t.length}Second array length was ${e.length}`);let n=t.length,s=0;for(;n>0;)s=Math.random()*n|0,n--,Ai(t,n,s),Ai(e,n,s)}function za(t,e,n){return Math.max(t,Math.min(e,n))}function Mx(t){return t%2===0?t:t+1}function Ai(t,e,n){const s=t[e];t[e]=t[n],t[n]=s}function SV(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}function lie(t,e){const n=Math.random();return e*n+(1-n)*t}function uie(t,e){let n=0;for(let s=0;s<t.length;s++){const o=Number(t[s])-Number(e[s]);n+=o*o}return n}function L(t,e){if(!t)throw new Error(typeof e=="string"?e:e())}function ds(t,e,n=""){L(lt(t,e),()=>n+` Shapes ${t} and ${e} must match`)}function xu(t){L(t!=null,()=>"The input to the tensor constructor must be a non-null value.")}function me(t){if(t.length===0)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function cie(t){return t.length===0}function NV(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==null&&e[n]!==null&&t[n]!==e[n])return!1;return!0}function lt(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Zl(t){return t%1===0}function die(t){if(Math.tanh!=null)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;{const e=Math.exp(2*t);return(e-1)/(e+1)}}function H0(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function fie(t){const e=new Uint32Array(t);for(let n=0;n<t;++n)e[n]=n;return UN(e),e}function Wl(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function WT(t,e=o=>0,n,s){return new Promise((o,r)=>{let i=0;const a=()=>{if(t()){o();return}i++;const l=e(i);if(n!=null&&i>=n){r();return}s!=null?s(a,l):setTimeout(a,l)};a()})}function GN(t,e){let n=1,s=-1;for(let r=0;r<t.length;++r)if(t[r]>=0)n*=t[r];else if(t[r]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${r}`);s=r}else if(t[r]<0)throw Error(`Shapes can not be < 0. Found ${t[r]} at dim ${r}`);if(s===-1){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(n===0)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const o=t.slice();return o[s]=e/n,o}function ot(t,e){const n=e.length;return t=t==null?e.map((s,o)=>o):[].concat(t),L(t.every(s=>s>=-n&&s<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`),L(t.every(s=>Zl(s)),()=>`All values in axis param must be integers but got axis ${t}`),t.map(s=>s<0?n+s:s)}function Gi(t,e){const n=[],s=[],o=e!=null&&Array.isArray(e)&&e.length===0,r=e==null||o?null:ot(e,t).sort();let i=0;for(let a=0;a<t.length;++a){if(r!=null){if(r[i]===a&&t[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${t[a]}' is not 1`);(r[i]==null||r[i]>a)&&t[a]===1&&(n.push(t[a]),s.push(a)),r[i]<=a&&i++}t[a]!==1&&(n.push(t[a]),s.push(a))}return{newShape:n,keptDims:s}}function Xn(t,e){return dn(t,e)}function dn(t,e){let n=null;if(t==null||t==="float32")n=new Float32Array(e);else if(t==="int32")n=new Int32Array(e);else if(t==="bool")n=new Uint8Array(e);else if(t==="string")n=new Array(e);else throw new Error(`Unknown data type ${t}`);return n}function EV(t,e){for(let n=0;n<t.length;n++){const s=t[n];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function IV(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function HN(t,e){return!(e==="complex64"||e==="float32"&&t!=="complex64"||e==="int32"&&t!=="float32"&&t!=="complex64"||e==="bool"&&t==="bool")}function hp(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error(`Unknown dtype ${t}`)}function kV(t){if(t==null)return 0;let e=0;return t.forEach(n=>e+=n.length),e}function Wr(t){return typeof t=="string"||t instanceof String}function AV(t){return typeof t=="boolean"}function W0(t){return typeof t=="number"}function vu(t){return Array.isArray(t)?vu(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":W0(t)?"float32":Wr(t)?"string":AV(t)?"bool":"float32"}function Ba(t){return!!(t&&t.constructor&&t.call&&t.apply)}function q0(t,e){for(let n=e;n<t;++n)if(t%n===0)return n;return t}function ze(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let s=e-3;s>=0;--s)n[s]=n[s+1]*t[s+1];return n}function RV(t,e,n,s=!1){const o=new Array;if(e.length===1){const r=e[0]*(s?2:1);for(let i=0;i<r;i++)o[i]=n[t+i]}else{const r=e[0],i=e.slice(1),a=i.reduce((l,u)=>l*u)*(s?2:1);for(let l=0;l<r;l++)o[l]=RV(t+l*a,i,n,s)}return o}function $o(t,e,n=!1){if(t.length===0)return e[0];const s=t.reduce((o,r)=>o*r)*(n?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return RV(0,t,e,n)}function $V(t,e){if(Array.isArray(t))return t;if(e==="float32")return t instanceof Float32Array?t:new Float32Array(t);if(e==="int32")return t instanceof Int32Array?t:new Int32Array(t);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(t));throw new Error(`Unknown dtype ${e}`)}function Fx(t,e){const n=cs(t,e);for(let s=0;s<n.length;s++)n[s]=1;return n}function cs(t,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool")return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function WN(t,e){const n=t.reduce((s,o)=>s*o,1);if(e==null||e==="float32")return $o(t,new Float32Array(n));if(e==="int32")return $o(t,new Int32Array(n));if(e==="bool")return $o(t,new Uint8Array(n));throw new Error(`Unknown data type ${e}`)}function mo(t){t.forEach(e=>{L(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`)})}function vr(t,e,n){if(e===0)return 0;if(e===1)return t[0];let s=t[t.length-1];for(let o=0;o<t.length-1;++o)s+=n[o]*t[o];return s}function bu(t,e,n){if(e===0)return[];if(e===1)return[t];const s=new Array(e);for(let o=0;o<s.length-1;++o)s[o]=Math.floor(t/n[o]),t-=s[o]*n[o];return s[s.length-1]=t,s}function Fi(t){return t&&t.then&&typeof t.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UF="tfjsflags";class DV{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=hie,this.populateURLFlags()}setPlatform(e,n){this.platform!=null&&(ue().getBool("IS_TEST")||ue().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=n}registerFlag(e,n,s){if(this.flagRegistry[e]={evaluationFn:n,setHook:s},this.urlFlags[e]!=null){const o=this.urlFlags[e];ue().getBool("IS_TEST")||ue().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${o}.`),this.set(e,o)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const n=this.evaluateFlag(e);if(Fi(n))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=n,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,n){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=n,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(n)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);UF in e&&e[UF].split(",").forEach(s=>{const[o,r]=s.split(":");this.urlFlags[o]=mie(o,r)})}}function hie(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(n,...s)=>(pie(e,s[0],s[1]),s.join("="))),e}function pie(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}function mie(t,e){const n=e.toLowerCase();return n==="true"||n==="false"?n==="true":`${+n}`===n?+n:e}function ue(){return qN}let qN=null;function gie(t){qN=t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let qC;function _V(){if(qC==null){let t;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else if(typeof self<"u")t=self;else throw new Error("Could not find a global object");qC=t}return qC}function yie(){const t=_V();return t._tfGlobals==null&&(t._tfGlobals=new Map),t._tfGlobals}function KN(t,e){const n=yie();if(n.has(t))return n.get(t);{const s=e();return n.set(t,s),n.get(t)}}const Up="Abs",fd="Acos",hd="Acosh",wu="Add",Gp="AddN",Ox="All",Px="Any",Hp="ArgMax",Wp="ArgMin",pd="Asin",md="Asinh",gd="Atan",yd="Atanh",xd="Atan2",qp="AvgPool",Lx="AvgPoolGrad",Kp="AvgPool3D",Vx="AvgPool3DGrad",Xp="BatchMatMul",Yp="BatchToSpaceND",zx="Bincount",Jp="BitwiseAnd",MV="BroadcastTo",Bx="BroadcastArgs",vd="Cast",bd="Ceil",wd="ClipByValue",Ux="Complex",jp="ComplexAbs",Zp="Concat",Qp="Conv2D",Gx="Conv2DBackpropFilter",em="Conv2DBackpropInput",tm="Conv3D",Hx="Conv3DBackpropFilterV2",Wx="Conv3DBackpropInputV2",Cd="Cos",Td="Cosh",qx="Cumprod",nm="Cumsum",Kx="CropAndResize",Xx="DenseBincount",Yx="DepthToSpace",sm="DepthwiseConv2dNative",Jx="DepthwiseConv2dNativeBackpropFilter",jx="DepthwiseConv2dNativeBackpropInput",Zx="Diag",om="Dilation2D",K0="Dilation2DBackpropInput",X0="Dilation2DBackpropFilter",Qx="Draw",Sd="RealDiv",ev="Einsum",Nd="Elu",tv="EluGrad",Ed="Erf",rm="Equal",Id="Exp",im="ExpandDims",kd="Expm1",nv="FFT",sv="Fill",ov="FlipLeftRight",Ad="Floor",Rd="FloorDiv",am="FusedBatchNorm",lm="GatherV2",rv="GatherNd",um="Greater",$d="GreaterEqual",Dd="Identity",iv="IFFT",av="Imag",_d="IsFinite",Md="IsInf",Fd="IsNan",cm="LeakyRelu",dm="Less",fm="LessEqual",lv="LinSpace",Od="Log",Pd="Log1p",hm="LogicalAnd",pm="LogicalNot",mm="LogicalOr",xie="LogicalXor",FV="LogSoftmax",vie="LowerBound",gm="LRN",uv="LRNGrad",bie="MatrixBandPart",ym="Max",Ld="Maximum",xm="MaxPool",cv="MaxPoolGrad",vm="MaxPool3D",dv="MaxPool3DGrad",fv="MaxPoolWithArgmax",bm="Mean",wm="Min",Vd="Minimum",Cm="MirrorPad",zd="Mod",hv="Multinomial",Bd="Multiply",Tm="Neg",Sm="NotEqual",pv="NonMaxSuppressionV3",mv="NonMaxSuppressionV4",gv="NonMaxSuppressionV5",Nm="OnesLike",Em="OneHot",Im="Pack",km="PadV2",wie="Pool",Ud="Pow",Am="Prelu",Rm="Prod",yv="RaggedGather",xv="RaggedRange",vv="RaggedTensorToTensor",bv="Range",wv="Real",Gd="Reciprocal",Hd="Relu",$m="Reshape",Dm="ResizeNearestNeighbor",Cv="ResizeNearestNeighborGrad",_m="ResizeBilinear",Tv="ResizeBilinearGrad",Wd="Relu6",Mm="Reverse",qd="Round",Kd="Rsqrt",Sv="ScatterNd",Nv="TensorScatterUpdate",Ev="SearchSorted",Fm="Select",Xd="Selu",Om="Slice",Yd="Sin",Jd="Sinh",jd="Sign",Zd="Sigmoid",Qd="Softplus",ef="Sqrt",Pm="Sum",Lm="SpaceToBatchND",Vm="SplitV",zm="Softmax",Iv="SparseFillEmptyRows",kv="SparseReshape",Av="SparseSegmentMean",Rv="SparseSegmentSum",$v="SparseToDense",tf="SquaredDifference",Dv="Square",Bm="StaticRegexReplace",_v="StridedSlice",Mv="StringNGrams",Fv="StringSplit",Ov="StringToHashBucketFast",nf="Sub",sf="Tan",of="Tanh",rf="Tile",Pv="TopK",Lv="Transform",ql="Transpose",Vv="Unique",Um="Unpack",Gm="UnsortedSegmentSum",Cie="UpperBound",Hm="ZerosLike",af="Step",Y0="FromPixels",zv="RotateWithOffset",pp="_FusedMatMul",mp="FusedConv2D",gp="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eo(...t){ue().getBool("IS_TEST")||ue().getBool("PROD")||console.warn(...t)}function Tie(...t){ue().getBool("IS_TEST")||ue().getBool("PROD")||console.log(...t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gc=KN("kernelRegistry",()=>new Map),yp=KN("gradRegistry",()=>new Map);function xp(t,e){const n=XN(t,e);return Gc.get(n)}function qT(t){return yp.get(t)}function J0(t){const e=Gc.entries(),n=[];for(;;){const{done:s,value:o}=e.next();if(s)break;const[r,i]=o,[a]=r.split("_");a===t&&n.push(i)}return n}function Bv(t){const{kernelName:e,backendName:n}=t,s=XN(e,n);Gc.has(s)&&Eo(`The kernel '${e}' for backend '${n}' is already registered`),Gc.set(s,t)}function OV(t){const{kernelName:e}=t;yp.has(e)&&ue().getBool("DEBUG")&&Eo(`Overriding the gradient for '${e}'`),yp.set(e,t)}function Sie(t,e){const n=XN(t,e);if(!Gc.has(n))throw new Error(`The kernel '${t}' for backend '${e}' is not registered`);Gc.delete(n)}function Nie(t){if(!yp.has(t))throw new Error(`The gradient '${t}' for backend is not registered`);yp.delete(t)}function Eie(t,e){J0(t).forEach(s=>{const o=Object.assign({},s,{backendName:e});Bv(o)})}function XN(t,e){return`${e}_${t}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PV(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}var KC,GF;function Iie(){if(GF)return KC;GF=1,KC=e;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function e(P,D,H){this.low=P|0,this.high=D|0,this.unsigned=!!H}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0});function n(P){return(P&&P.__isLong__)===!0}e.isLong=n;var s={},o={};function r(P,D){var H,Z,ne;return D?(P>>>=0,(ne=0<=P&&P<256)&&(Z=o[P],Z)?Z:(H=a(P,(P|0)<0?-1:0,!0),ne&&(o[P]=H),H)):(P|=0,(ne=-128<=P&&P<128)&&(Z=s[P],Z)?Z:(H=a(P,P<0?-1:0,!1),ne&&(s[P]=H),H))}e.fromInt=r;function i(P,D){if(isNaN(P))return D?N:T;if(D){if(P<0)return N;if(P>=b)return M}else{if(P<=-w)return O;if(P+1>=w)return $}return P<0?i(-P,D).neg():a(P%x|0,P/x|0,D)}e.fromNumber=i;function a(P,D,H){return new e(P,D,H)}e.fromBits=a;var l=Math.pow;function u(P,D,H){if(P.length===0)throw Error("empty string");if(P==="NaN"||P==="Infinity"||P==="+Infinity"||P==="-Infinity")return T;if(typeof D=="number"?(H=D,D=!1):D=!!D,H=H||10,H<2||36<H)throw RangeError("radix");var Z;if((Z=P.indexOf("-"))>0)throw Error("interior hyphen");if(Z===0)return u(P.substring(1),D,H).neg();for(var ne=i(l(H,8)),Q=T,G=0;G<P.length;G+=8){var q=Math.min(8,P.length-G),J=parseInt(P.substring(G,G+q),H);if(q<8){var oe=i(l(H,q));Q=Q.mul(oe).add(i(J))}else Q=Q.mul(ne),Q=Q.add(i(J))}return Q.unsigned=D,Q}e.fromString=u;function d(P,D){return typeof P=="number"?i(P,D):typeof P=="string"?u(P,D):a(P.low,P.high,typeof D=="boolean"?D:P.unsigned)}e.fromValue=d;var h=65536,p=1<<24,x=h*h,b=x*x,w=b/2,C=r(p),T=r(0);e.ZERO=T;var N=r(0,!0);e.UZERO=N;var I=r(1);e.ONE=I;var k=r(1,!0);e.UONE=k;var A=r(-1);e.NEG_ONE=A;var $=a(-1,2147483647,!1);e.MAX_VALUE=$;var M=a(-1,-1,!0);e.MAX_UNSIGNED_VALUE=M;var O=a(0,-2147483648,!1);e.MIN_VALUE=O;var F=e.prototype;return F.toInt=function(){return this.unsigned?this.low>>>0:this.low},F.toNumber=function(){return this.unsigned?(this.high>>>0)*x+(this.low>>>0):this.high*x+(this.low>>>0)},F.toString=function(D){if(D=D||10,D<2||36<D)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(O)){var H=i(D),Z=this.div(H),ne=Z.mul(H).sub(this);return Z.toString(D)+ne.toInt().toString(D)}else return"-"+this.neg().toString(D);for(var Q=i(l(D,6),this.unsigned),G=this,q="";;){var J=G.div(Q),oe=G.sub(J.mul(Q)).toInt()>>>0,B=oe.toString(D);if(G=J,G.isZero())return B+q;for(;B.length<6;)B="0"+B;q=""+B+q}},F.getHighBits=function(){return this.high},F.getHighBitsUnsigned=function(){return this.high>>>0},F.getLowBits=function(){return this.low},F.getLowBitsUnsigned=function(){return this.low>>>0},F.getNumBitsAbs=function(){if(this.isNegative())return this.eq(O)?64:this.neg().getNumBitsAbs();for(var D=this.high!=0?this.high:this.low,H=31;H>0&&(D&1<<H)==0;H--);return this.high!=0?H+33:H+1},F.isZero=function(){return this.high===0&&this.low===0},F.eqz=F.isZero,F.isNegative=function(){return!this.unsigned&&this.high<0},F.isPositive=function(){return this.unsigned||this.high>=0},F.isOdd=function(){return(this.low&1)===1},F.isEven=function(){return(this.low&1)===0},F.equals=function(D){return n(D)||(D=d(D)),this.unsigned!==D.unsigned&&this.high>>>31===1&&D.high>>>31===1?!1:this.high===D.high&&this.low===D.low},F.eq=F.equals,F.notEquals=function(D){return!this.eq(D)},F.neq=F.notEquals,F.ne=F.notEquals,F.lessThan=function(D){return this.comp(D)<0},F.lt=F.lessThan,F.lessThanOrEqual=function(D){return this.comp(D)<=0},F.lte=F.lessThanOrEqual,F.le=F.lessThanOrEqual,F.greaterThan=function(D){return this.comp(D)>0},F.gt=F.greaterThan,F.greaterThanOrEqual=function(D){return this.comp(D)>=0},F.gte=F.greaterThanOrEqual,F.ge=F.greaterThanOrEqual,F.compare=function(D){if(n(D)||(D=d(D)),this.eq(D))return 0;var H=this.isNegative(),Z=D.isNegative();return H&&!Z?-1:!H&&Z?1:this.unsigned?D.high>>>0>this.high>>>0||D.high===this.high&&D.low>>>0>this.low>>>0?-1:1:this.sub(D).isNegative()?-1:1},F.comp=F.compare,F.negate=function(){return!this.unsigned&&this.eq(O)?O:this.not().add(I)},F.neg=F.negate,F.add=function(D){n(D)||(D=d(D));var H=this.high>>>16,Z=this.high&65535,ne=this.low>>>16,Q=this.low&65535,G=D.high>>>16,q=D.high&65535,J=D.low>>>16,oe=D.low&65535,B=0,X=0,ie=0,re=0;return re+=Q+oe,ie+=re>>>16,re&=65535,ie+=ne+J,X+=ie>>>16,ie&=65535,X+=Z+q,B+=X>>>16,X&=65535,B+=H+G,B&=65535,a(ie<<16|re,B<<16|X,this.unsigned)},F.subtract=function(D){return n(D)||(D=d(D)),this.add(D.neg())},F.sub=F.subtract,F.multiply=function(D){if(this.isZero())return T;if(n(D)||(D=d(D)),t){var H=t.mul(this.low,this.high,D.low,D.high);return a(H,t.get_high(),this.unsigned)}if(D.isZero())return T;if(this.eq(O))return D.isOdd()?O:T;if(D.eq(O))return this.isOdd()?O:T;if(this.isNegative())return D.isNegative()?this.neg().mul(D.neg()):this.neg().mul(D).neg();if(D.isNegative())return this.mul(D.neg()).neg();if(this.lt(C)&&D.lt(C))return i(this.toNumber()*D.toNumber(),this.unsigned);var Z=this.high>>>16,ne=this.high&65535,Q=this.low>>>16,G=this.low&65535,q=D.high>>>16,J=D.high&65535,oe=D.low>>>16,B=D.low&65535,X=0,ie=0,re=0,ye=0;return ye+=G*B,re+=ye>>>16,ye&=65535,re+=Q*B,ie+=re>>>16,re&=65535,re+=G*oe,ie+=re>>>16,re&=65535,ie+=ne*B,X+=ie>>>16,ie&=65535,ie+=Q*oe,X+=ie>>>16,ie&=65535,ie+=G*J,X+=ie>>>16,ie&=65535,X+=Z*B+ne*oe+Q*J+G*q,X&=65535,a(re<<16|ye,X<<16|ie,this.unsigned)},F.mul=F.multiply,F.divide=function(D){if(n(D)||(D=d(D)),D.isZero())throw Error("division by zero");if(t){if(!this.unsigned&&this.high===-2147483648&&D.low===-1&&D.high===-1)return this;var H=(this.unsigned?t.div_u:t.div_s)(this.low,this.high,D.low,D.high);return a(H,t.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?N:T;var Z,ne,Q;if(this.unsigned){if(D.unsigned||(D=D.toUnsigned()),D.gt(this))return N;if(D.gt(this.shru(1)))return k;Q=N}else{if(this.eq(O)){if(D.eq(I)||D.eq(A))return O;if(D.eq(O))return I;var G=this.shr(1);return Z=G.div(D).shl(1),Z.eq(T)?D.isNegative()?I:A:(ne=this.sub(D.mul(Z)),Q=Z.add(ne.div(D)),Q)}else if(D.eq(O))return this.unsigned?N:T;if(this.isNegative())return D.isNegative()?this.neg().div(D.neg()):this.neg().div(D).neg();if(D.isNegative())return this.div(D.neg()).neg();Q=T}for(ne=this;ne.gte(D);){Z=Math.max(1,Math.floor(ne.toNumber()/D.toNumber()));for(var q=Math.ceil(Math.log(Z)/Math.LN2),J=q<=48?1:l(2,q-48),oe=i(Z),B=oe.mul(D);B.isNegative()||B.gt(ne);)Z-=J,oe=i(Z,this.unsigned),B=oe.mul(D);oe.isZero()&&(oe=I),Q=Q.add(oe),ne=ne.sub(B)}return Q},F.div=F.divide,F.modulo=function(D){if(n(D)||(D=d(D)),t){var H=(this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,D.low,D.high);return a(H,t.get_high(),this.unsigned)}return this.sub(this.div(D).mul(D))},F.mod=F.modulo,F.rem=F.modulo,F.not=function(){return a(~this.low,~this.high,this.unsigned)},F.and=function(D){return n(D)||(D=d(D)),a(this.low&D.low,this.high&D.high,this.unsigned)},F.or=function(D){return n(D)||(D=d(D)),a(this.low|D.low,this.high|D.high,this.unsigned)},F.xor=function(D){return n(D)||(D=d(D)),a(this.low^D.low,this.high^D.high,this.unsigned)},F.shiftLeft=function(D){return n(D)&&(D=D.toInt()),(D&=63)===0?this:D<32?a(this.low<<D,this.high<<D|this.low>>>32-D,this.unsigned):a(0,this.low<<D-32,this.unsigned)},F.shl=F.shiftLeft,F.shiftRight=function(D){return n(D)&&(D=D.toInt()),(D&=63)===0?this:D<32?a(this.low>>>D|this.high<<32-D,this.high>>D,this.unsigned):a(this.high>>D-32,this.high>=0?0:-1,this.unsigned)},F.shr=F.shiftRight,F.shiftRightUnsigned=function(D){if(n(D)&&(D=D.toInt()),D&=63,D===0)return this;var H=this.high;if(D<32){var Z=this.low;return a(Z>>>D|H<<32-D,H>>>D,this.unsigned)}else return D===32?a(H,0,this.unsigned):a(H>>>D-32,0,this.unsigned)},F.shru=F.shiftRightUnsigned,F.shr_u=F.shiftRightUnsigned,F.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},F.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},F.toBytes=function(D){return D?this.toBytesLE():this.toBytesBE()},F.toBytesLE=function(){var D=this.high,H=this.low;return[H&255,H>>>8&255,H>>>16&255,H>>>24,D&255,D>>>8&255,D>>>16&255,D>>>24]},F.toBytesBE=function(){var D=this.high,H=this.low;return[D>>>24,D>>>16&255,D>>>8&255,D&255,H>>>24,H>>>16&255,H>>>8&255,H&255]},e.fromBytes=function(D,H,Z){return Z?e.fromBytesLE(D,H):e.fromBytesBE(D,H)},e.fromBytesLE=function(D,H){return new e(D[0]|D[1]<<8|D[2]<<16|D[3]<<24,D[4]|D[5]<<8|D[6]<<16|D[7]<<24,H)},e.fromBytesBE=function(D,H){return new e(D[4]<<24|D[5]<<16|D[6]<<8|D[7],D[0]<<24|D[1]<<16|D[2]<<8|D[3],H)},KC}var LV=Iie();const VV=Cx(LV),kie=n5({__proto__:null,default:VV},[LV]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ml=VV||kie;function Wm(t){return Ml.fromString(t,!0,16)}const zV=Wm("c3a5c85c97cb3127"),Dl=Wm("b492b66fbe98f273"),As=Wm("9ae16a3b2f90404f");function KT(t){return t.xor(t.shru(47))}function BV(t,e,n){const s=t.slice(e,e+n);return Ml.fromBytes(Array.from(s),!0,!0)}function Gt(t,e){return BV(t,e,8)}function HF(t,e){return BV(t,e,4)}function Wn(t,e){return e===0?t:t.shru(e).or(t.shl(64-e))}function Ma(t,e,n=Wm("9ddfea08eb382d69")){let s=t.xor(e).mul(n);s=s.xor(s.shru(47));let o=e.xor(s).mul(n);return o=o.xor(o.shru(47)),o=o.mul(n),o}function Aie(t,e,n,s,o,r){o=o.add(t),r=Wn(r.add(o).add(s),21);const i=o;return o=o.add(e),o=o.add(n),r=r.add(Wn(o,44)),[o.add(s),r.add(i)]}function Yy(t,e,n,s){return Aie(Gt(t,e),Gt(t,e+8),Gt(t,e+16),Gt(t,e+24),n,s)}function Rie(t,e=t.length){if(e>=8){const n=As.add(e*2),s=Gt(t,0).add(As),o=Gt(t,e-8),r=Wn(o,37).mul(n).add(s),i=Wn(s,25).add(o).mul(n);return Ma(r,i,n)}if(e>=4){const n=As.add(e*2),s=HF(t,0);return Ma(s.shl(3).add(e),HF(t,e-4),n)}if(e>0){const n=t[0],s=t[e>>1],o=t[e-1],r=n+(s<<8),i=e+(o<<2);return KT(As.mul(r).xor(zV.mul(i))).mul(As)}return As}function $ie(t,e=t.length){const n=As.add(e*2),s=Gt(t,0).mul(Dl),o=Gt(t,8),r=Gt(t,e-8).mul(n),i=Gt(t,e-16).mul(As);return Ma(Wn(s.add(o),43).add(Wn(r,30)).add(i),s.add(Wn(o.add(As),18)).add(r),n)}function Die(t,e=t.length){const n=As.add(e*2),s=Gt(t,0).mul(As),o=Gt(t,8),r=Gt(t,e-8).mul(n),i=Gt(t,e-16).mul(As),a=Wn(s.add(o),43).add(Wn(r,30)).add(i),l=Ma(a,s.add(Wn(o.add(As),18)).add(r),n),u=Gt(t,16).mul(n),d=Gt(t,24),h=a.add(Gt(t,e-32)).mul(n),p=l.add(Gt(t,e-24)).mul(n);return Ma(Wn(u.add(d),43).add(Wn(h,30)).add(p),u.add(Wn(d.add(s),18)).add(h),n)}function UV(t,e=t.length){const n=Ml.fromNumber(81,!0);if(e<=32)return e<=16?Rie(t,e):$ie(t,e);if(e<=64)return Die(t,e);let s=n,o=n.mul(Dl).add(113),r=KT(o.mul(As).add(113)).mul(As),i=[Ml.UZERO,Ml.UZERO],a=[Ml.UZERO,Ml.UZERO];s=s.mul(As).add(Gt(t,0));let l=0;const u=(e-1>>6)*64,d=u+(e-1&63)-63;do s=Wn(s.add(o).add(i[0]).add(Gt(t,l+8)),37).mul(Dl),o=Wn(o.add(i[1]).add(Gt(t,l+48)),42).mul(Dl),s=s.xor(a[1]),o=o.add(i[0]).add(Gt(t,l+40)),r=Wn(r.add(a[0]),33).mul(Dl),i=Yy(t,l,i[1].mul(Dl),s.add(a[0])),a=Yy(t,l+32,r.add(a[1]),o.add(Gt(t,l+16))),[r,s]=[s,r],l+=64;while(l!==u);const h=Dl.add(r.and(255).shl(1));return l=d,a[0]=a[0].add(e-1&63),i[0]=i[0].add(a[0]),a[0]=a[0].add(i[0]),s=Wn(s.add(o).add(i[0]).add(Gt(t,l+8)),37).mul(h),o=Wn(o.add(i[1]).add(Gt(t,l+48)),42).mul(h),s=s.xor(a[1].mul(9)),o=o.add(i[0].mul(9).add(Gt(t,l+40))),r=Wn(r.add(a[0]),33).mul(h),i=Yy(t,l,i[1].mul(h),s.add(a[0])),a=Yy(t,l+32,r.add(a[1]),o.add(Gt(t,l+16))),[r,s]=[s,r],Ma(Ma(i[0],a[0],h).add(KT(o).mul(zV)).add(r),Ma(i[1],a[1],h).add(s),h)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hi(t,e){return e==="string"?Jr(t):Qa([t],e)}function _ie(t,e){return t instanceof Float32Array&&e==="float32"||t instanceof Int32Array&&e==="int32"||t instanceof Uint8Array&&e==="bool"}function Qa(t,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=ti(t)),ue().getBool("DEBUG")&&EV(t,e),_ie(t,e))return t;if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool"){const n=new Uint8Array(t.length);for(let s=0;s<n.length;++s)Math.round(t[s])!==0&&(n[s]=1);return n}else throw new Error(`Unknown data type ${e}`)}function os(){return ue().platform.now()}function GV(t,e){return ue().platform.fetch(t,e)}function Jr(t,e="utf-8"){return e=e||"utf-8",ue().platform.encode(t,e)}function Oi(t,e="utf-8"){return e=e||"utf-8",ue().platform.decode(t,e)}function Mn(t){return ue().platform.isTypedArray!=null?ue().platform.isTypedArray(t):PV(t)}function ti(t,e=[],n=!1){if(e==null&&(e=[]),typeof t=="boolean"||typeof t=="number"||typeof t=="string"||Fi(t)||t==null||Mn(t)&&n)e.push(t);else if(Array.isArray(t)||Mn(t))for(let s=0;s<t.length;++s)ti(t[s],e,n);else{let s=-1;for(const o of Object.keys(t))/^([1-9]+[0-9]*|0)$/.test(o)&&(s=Math.max(s,Number(o)));for(let o=0;o<=s;o++)ti(t[o],e,n)}return e}const Mie=Object.freeze(Object.defineProperty({__proto__:null,arraysEqual:lt,arraysEqualWithNull:NV,assert:L,assertNonNegativeIntegerDimensions:mo,assertNonNull:xu,assertShapesMatch:ds,bytesFromStringArray:kV,bytesPerElement:hp,checkConversionForErrors:EV,clamp:za,computeStrides:ze,convertBackendValuesAndArrayBuffer:$V,createScalarValue:Hi,createShuffledIndices:fie,decodeString:Oi,distSquared:uie,encodeString:Jr,fetch:GV,fingerPrint64:UV,flatten:ti,getArrayFromDType:dn,getTypedArrayFromDType:Xn,hasEncodingLoss:HN,hexToLong:Wm,indexToLoc:bu,inferDtype:vu,inferFromImplicitShape:GN,isBoolean:AV,isFunction:Ba,isInt:Zl,isNumber:W0,isPromise:Fi,isScalarShape:cie,isString:Wr,isTypedArray:Mn,isValidDtype:IV,locToIndex:vr,makeOnesTypedArray:Fx,makeZerosNestedTypedArray:WN,makeZerosTypedArray:cs,nearestDivisor:q0,nearestLargerEven:Mx,now:os,parseAxisParam:ot,randUniform:lie,repeatedTry:WT,rightPad:Wl,shuffle:UN,shuffleCombo:aie,sizeFromShape:me,sizeToSquarishShape:H0,squeezeShape:Gi,sum:SV,swap:Ai,tanh:die,toNestedArray:$o,toTypedArray:Qa},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fie{constructor(e,n){this.backendTimer=e,this.logger=n,n==null&&(this.logger=new Pie)}profileKernel(e,n,s){let o;const r=()=>{o=s()};let i;const a=os();if(this.backendTimer.timerAvailable())i=this.backendTimer.time(r);else{r();for(const u of o)u.dataSync();i=Promise.resolve({kernelMs:os()-a})}if(ue().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let u=0;u<o.length;u++){const d=o[u];d.data().then(h=>{Oie(h,d.dtype,e)})}return{kernelName:e,outputs:o,inputs:n,timeMs:i.then(u=>u.kernelMs),extraInfo:i.then(u=>u.getExtraProfileInfo!=null?u.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:n,outputs:s,timeMs:o,inputs:r,extraInfo:i}=e;s.forEach(a=>{Promise.all([a.data(),o,i]).then(l=>{this.logger.logKernelProfile(n,a,l[0],l[1],r,l[2])})})}}function Oie(t,e,n){if(e!=="float32")return!1;for(let s=0;s<t.length;s++){const o=t[s];if(isNaN(o)||!isFinite(o))return console.warn(`Found ${o} in the result of '${n}'`),!0}return!1}class Pie{logKernelProfile(e,n,s,o,r,i){const a=typeof o=="number"?Wl(`${o}ms`,9):o.error,l=Wl(e,25),u=n.rank,d=n.size,h=Wl(n.shape.toString(),14);let p="";for(const x in r){const b=r[x];if(b!=null){const w=b.shape||n.shape,C=w.length;p+=`${x}: ${C}D ${C>0?w:""} `}}console.log(`%c${l}	%c${a}	%c${u}D ${h}	%c${d}	%c${p}	%c${i}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lie(t,e,n){const s={},o={};for(let l=0;l<e.length;l++)s[e[l].id]=!0;for(let l=0;l<t.length;l++){const u=t[l],d=u.inputs;for(const h in d){const p=d[h];let x=!1;for(let b=0;b<e.length;b++)if(s[p.id]){u.outputs.forEach(w=>s[w.id]=!0),x=!0,o[u.id]=!0;break}if(x)break}}const r={};r[n.id]=!0;const i={};for(let l=t.length-1;l>=0;l--){const u=t[l],d=u.inputs;for(let h=0;h<u.outputs.length;h++)if(r[u.outputs[h].id]){for(const p in d)r[d[p].id]=!0,i[u.id]=!0;break}}const a=[];for(let l=0;l<t.length;l++){const u=t[l];if(o[u.id]&&i[u.id]){const d={};for(const p in u.inputs){const x=u.inputs[p];s[x.id]&&(d[p]=x)}const h=Object.assign({},u);h.inputs=d,h.outputs=u.outputs,a.push(h)}}return a}function Vie(t,e,n,s){for(let o=e.length-1;o>=0;o--){const r=e[o],i=[];if(r.outputs.forEach(l=>{const u=t[l.id];u!=null?i.push(u):i.push(null)}),r.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${r.kernelName}.`);const a=r.gradient(i);for(const l in r.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const u=n(()=>a[l]());if(u.dtype!=="float32")throw new Error(`Error in gradient for op ${r.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${u.dtype}'`);const d=r.inputs[l];if(!lt(u.shape,d.shape))throw new Error(`Error in gradient for op ${r.kernelName}. The gradient of input '${l}' has shape '${u.shape}', which does not match the shape of the input '${d.shape}'`);if(t[d.id]==null)t[d.id]=u;else{const h=t[d.id];t[d.id]=s(h,u),h.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WF=20,$h=3,XC=7;function zie(t,e,n,s){const o=ze(e),r=Bie(t,e,n,o),i=e.length,a=x0(t,e,n,o,r),l=["Tensor"];return s&&(l.push(`  dtype: ${n}`),l.push(`  rank: ${i}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(u=>"    "+u).join(`
`)),l.join(`
`)}function Bie(t,e,n,s){const o=me(e),r=s[s.length-1],i=new Array(r).fill(0),a=e.length,l=n==="complex64"?Bh(t):t;if(a>1)for(let u=0;u<o/r;u++){const d=u*r;for(let h=0;h<r;h++)i[h]=Math.max(i[h],zh(l[d+h],0,n).length)}return i}function zh(t,e,n){let s;return Array.isArray(t)?s=`${parseFloat(t[0].toFixed(XC))} + ${parseFloat(t[1].toFixed(XC))}j`:Wr(t)?s=`'${t}'`:n==="bool"?s=HV(t):s=parseFloat(t.toFixed(XC)).toString(),Wl(s,e)}function HV(t){return t===0?"false":"true"}function x0(t,e,n,s,o,r=!0){const i=n==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(n==="complex64"){const w=Bh(t);return[zh(w[0],0,n)]}return n==="bool"?[HV(t[0])]:[t[0].toString()]}if(l===1){if(a>WF){const C=$h*i;let T=Array.from(t.slice(0,C)),N=Array.from(t.slice((a-$h)*i,a*i));return n==="complex64"&&(T=Bh(T),N=Bh(N)),["["+T.map((I,k)=>zh(I,o[k],n)).join(", ")+", ..., "+N.map((I,k)=>zh(I,o[a-$h+k],n)).join(", ")+"]"]}return["["+(n==="complex64"?Bh(t):Array.from(t)).map((C,T)=>zh(C,o[T],n)).join(", ")+"]"]}const u=e.slice(1),d=s.slice(1),h=s[0]*i,p=[];if(a>WF){for(let w=0;w<$h;w++){const C=w*h,T=C+h;p.push(...x0(t.slice(C,T),u,n,d,o,!1))}p.push("...");for(let w=a-$h;w<a;w++){const C=w*h,T=C+h;p.push(...x0(t.slice(C,T),u,n,d,o,w===a-1))}}else for(let w=0;w<a;w++){const C=w*h,T=C+h;p.push(...x0(t.slice(C,T),u,n,d,o,w===a-1))}const x=l===2?",":"";p[0]="["+(a>0?p[0]+x:"");for(let w=1;w<p.length-1;w++)p[w]=" "+p[w]+x;let b=`,
`;for(let w=2;w<l;w++)b+=`
`;return p[p.length-1]=" "+p[p.length-1]+"]"+(r?"":b),p}function Bh(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class In{constructor(e,n,s){if(this.dtype=n,this.shape=e.slice(),this.size=me(e),s!=null){const o=s.length;L(o===this.size,()=>`Length of values '${o}' does not match the size inferred by the shape '${this.size}'.`)}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||dn(n,this.size),this.strides=ze(e)}set(e,...n){n.length===0&&(n=[0]),L(n.length===this.rank,()=>`The number of provided coordinates (${n.length}) must match the rank (${this.rank})`);const s=this.locToIndex(n);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let n=0;for(const o of e){if(o<0||o>=this.shape[n]){const r=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(r)}n++}let s=e[e.length-1];for(let o=0;o<e.length-1;++o)s+=this.strides[o]*e[o];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let n=e[e.length-1];for(let s=0;s<e.length-1;++s)n+=this.strides[s]*e[s];return n}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const n=new Array(this.shape.length);for(let s=0;s<n.length-1;++s)n[s]=Math.floor(e/this.strides[s]),e-=n[s]*this.strides[s];return n[n.length-1]=e,n}get rank(){return this.shape.length}toTensor(){return gr().makeTensor(this.values,this.shape,this.dtype)}}let gr=null,Tc=null;function Uie(t){gr=t}function Gie(t){Tc=t}class yt{constructor(e,n,s,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=n||"float32",this.size=me(e),this.strides=ze(e),this.dataId=s,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Tc.buffer(this.shape,this.dtype,e)}bufferSync(){return Tc.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return $o(this.shape,e,this.dtype==="complex64")}arraySync(){return $o(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=gr().read(this.dataId);if(this.dtype==="string"){const n=await e;try{return n.map(s=>Oi(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),gr().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=gr().readSync(this.dataId);if(this.dtype==="string")try{return e.map(n=>Oi(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await gr().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),gr().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Tc.print(this,e)}clone(){return this.throwIfDisposed(),Tc.clone(this)}toString(e=!1){const n=this.dataSync();return zie(n,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Tc.cast(this,e)}variable(e=!0,n,s){return this.throwIfDisposed(),gr().makeVariable(this,e,n,s)}}Object.defineProperty(yt,Symbol.hasInstance,{value:t=>!!t&&t.data!=null&&t.dataSync!=null&&t.throwIfDisposed!=null});function ge(){return KN("Tensor",()=>yt)}ge();class vp extends yt{constructor(e,n,s,o){super(e.shape,e.dtype,e.dataId,o),this.trainable=n,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!lt(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);gr().disposeTensor(this),this.dataId=e.dataId,gr().incRef(this,null)}dispose(){gr().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(vp,Symbol.hasInstance,{value:t=>t instanceof yt&&t.assign!=null&&t.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var XT;(function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"})(XT||(XT={}));var YT;(function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"})(YT||(YT={}));var JT;(function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"})(JT||(JT={}));var jT;(function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"})(jT||(jT={}));var ZT;(function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"})(ZT||(ZT={}));const Hie={float32:jT,int32:YT,bool:JT,complex64:ZT};function Ws(t,e){if(t==="string"||e==="string"){if(t==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return Hie[t][e]}function Uv(t){return Ws(t,"int32")}function WV(t){return t!=null&&typeof t=="object"&&"texture"in t&&t.texture instanceof WebGLTexture}function qV(t){return typeof GPUBuffer<"u"&&t!=null&&typeof t=="object"&&"buffer"in t&&t.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function on(t,e){if(t.dtype===e.dtype)return[t,e];const n=Ws(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function KV(t,e){L(t.dtype===e.dtype,()=>`The dtypes of the first(${t.dtype}) and second(${e.dtype}) input must match`)}function Gv(t,e){return e.some(n=>n.id===t.id)}function Pi(t){const e=[];return XV(t,e,new Set),e}function XV(t,e,n){if(t==null)return;if(t instanceof yt){e.push(t);return}if(!Wie(t))return;const s=t;for(const o in s){const r=s[o];n.has(r)||(n.add(r),XV(r,e,n))}}function Wie(t){return Array.isArray(t)||typeof t=="object"}const qie=Object.freeze(Object.defineProperty({__proto__:null,assertTypesMatch:KV,getTensorsInContainer:Pi,isTensorInList:Gv,makeTypesMatch:on},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YC(t){return t.kernelName!=null}class qF{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class Hc{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new qF}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const s=e[n];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:n}=this.initializeBackend(e);if(n)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,n,s=1){return e in this.registryFactory?(Eo(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:n,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:n,asyncInit:s}=this.initializeBackend(e);if(!(s?await n:n))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Fie(this.backendInstance),!0}setupRegisteredKernels(){J0(this.backendName).forEach(n=>{n.setupFunc!=null&&n.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){J0(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const n=this.registryFactory[e];if(n==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=n.factory();if(s&&!(s instanceof _x)&&typeof s.then=="function"){const o=++this.pendingBackendInitId,r=s.then(i=>o<this.pendingBackendInitId?!1:(this.registry[e]=i,this.pendingBackendInit=null,!0)).catch(i=>(o<this.pendingBackendInitId||(this.pendingBackendInit=null,Eo(`Initialization of backend ${e} failed`),Eo(i.stack||i.message)),!1));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return Eo(`Initialization of backend ${e} failed`),Eo(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,n)=>this.registryFactory[n].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const s=e[n],{success:o,asyncInit:r}=this.initializeBackend(s);if(r||o)return{name:s,asyncInit:r}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,n){const s=this.state.tensorInfo.get(n),o=s.backend,r=this.readSync(n),i=o.refCount(n);o.disposeData(n,!0),s.backend=e,e.move(n,r,s.shape,s.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,n){let s=null;if(n==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");n=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let o;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(o),()=>(o=n(),o instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),o))}scopedRun(e,n,s){e();try{const o=s();return n(),o}catch(o){throw n(),o}}nextTensorId(){return Hc.nextTensorId++}nextVariableId(){return Hc.nextVariableId++}clone(e){const n=W.runKernel(Dd,{x:e}),s={x:e},o=i=>({x:()=>{const a="float32",l={x:i},u={dtype:a};return W.runKernel(vd,l,u)}}),r=[];return this.addTapeNode(this.state.activeScope.name,s,[n],o,r,{}),n}runKernel(e,n,s){if(this.backendName==null&&this.backend,!(xp(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:n,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,n,s){const o=this.backend.numDataIds();let r=0;s.forEach(l=>{r+=l.dtype==="complex64"?3:1});const i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=o-n-r-i;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let n,s=[];const o=this.isTapeOn(),r=this.state.numBytes,i=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const u=YC(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(YC(e)){const{kernelName:b,inputs:w,attrs:C}=e;this.backendName==null&&this.backend;const T=xp(b,this.backendName);L(T!=null,()=>`Cannot find registered kernel '${b}' for backend '${this.backendName}'`),a=()=>{const N=this.backend.numDataIds();l=T.kernelFunc({inputs:w,attrs:C,backend:this.backend});const I=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(b,N,I);const k=I.map(A=>A.rank!=null?A:this.makeTensorFromTensorInfo(A));if(o){const A=this.getTensorsForGradient(b,w,k);s=this.saveTensorsForBackwardMode(A)}return k}}else{const{forwardFunc:b}=e,w=C=>{o&&(s=C.map(T=>this.keep(this.clone(T))))};a=()=>{const C=this.backend.numDataIds();l=this.tidy(()=>b(this.backend,w));const T=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,C,T),T}}const{inputs:d,attrs:h}=e,p=YC(e)?null:e.backwardsFunc;let x;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?n=a():(x=this.profiler.profileKernel(u,d,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(x),n=x.outputs)}),o&&this.addTapeNode(u,d,n,p,s,h),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-r,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-i,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(d).map(b=>d[b]!=null?d[b].shape:null),outputShapes:n.map(b=>b.shape),kernelTimeMs:x.timeMs,extraInfo:x.extraInfo}),Array.isArray(l)?n:n[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,n,s){const o=qT(e);if(o!=null){const r=o.inputsToSave||[],i=o.outputsToSave||[];let a;o.saveAllInputs?(L(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(n).map(u=>n[u])):a=r.map(u=>n[u]);const l=s.filter((u,d)=>i[d]);return a.concat(l)}return[]}makeTensor(e,n,s,o){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",o=o||this.backend;let r=e;s==="string"&&Wr(e[0])&&(r=e.map(l=>Jr(l)));const i=o.write(r,n,s),a=new yt(n,s,i,this.nextTensorId());if(this.trackTensor(a,o),s==="string"){const l=this.state.tensorInfo.get(i),u=kV(r);this.state.numBytes+=u-l.bytes,l.bytes=u}return a}makeTensorFromDataId(e,n,s,o){s=s||"float32";const r={dataId:e,shape:n,dtype:s};return this.makeTensorFromTensorInfo(r,o)}makeTensorFromTensorInfo(e,n){const{dataId:s,shape:o,dtype:r}=e,i=new yt(o,r,s,this.nextTensorId());return this.trackTensor(i,n),i}makeVariable(e,n=!0,s,o){s=s||this.nextVariableId().toString(),o!=null&&o!==e.dtype&&(e=e.cast(o));const r=new vp(e,n,s,this.nextTensorId());if(this.state.registeredVariables[r.name]!=null)throw new Error(`Variable with name ${r.name} was already registered`);return this.state.registeredVariables[r.name]=r,this.incRef(r,this.backend),r}trackTensor(e,n){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*hp(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:n||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof vp||this.track(e)}incRef(e,n){this.trackTensor(e,n),this.backend.incRef(e.dataId)}removeDataId(e,n){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===n&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const n=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*hp(e.dtype);this.state.numBytes-=s}n.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,n.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const n=this.state.registeredVariables[e];this.disposeVariable(n)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const n=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(o=>o.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const o of this.state.activeProfile.kernels)o.kernelTimeMs=await o.kernelTimeMs,o.extraInfo=await o.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,n,s,o,r,i){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:n,outputs:s,saved:r},l=qT(e);l!=null&&(o=l.gradFunc),o!=null&&(a.gradient=u=>(u=u.map((d,h)=>{if(d==null){const p=s[h],x=cs(p.size,p.dtype);return this.makeTensor(x,p.shape,p.dtype)}return d}),o(u.length>1?u:u[0],r,i))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(n.name=e),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(e){const n=Pi(e),s=new Set(n.map(r=>r.id));for(let r=0;r<this.state.activeScope.track.length;r++){const i=this.state.activeScope.track[r];!i.kept&&!s.has(i.id)&&i.dispose()}const o=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(r=>{!r.kept&&r.scopeId===o.id&&this.track(r)})}gradients(e,n,s,o=!1){if(L(n.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const r=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));L(r instanceof yt,()=>"The result y returned by f() must be a tensor.");const i=Lie(this.state.activeTape,n,r);if(!o&&i.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[r.id]=s??Kie(r.shape),Vie(a,i,u=>this.tidy(u),Xie);const l=n.map(u=>a[u.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(u=>{for(const d of u.saved)d.dispose()}),this.state.activeTape=null),{value:r,grads:l}})}customGrad(e){return L(Ba(e),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{L(n.every(a=>a instanceof yt),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const o={};n.forEach((a,l)=>{o[l]=a});const r=(a,l)=>(s=e(...n,l),L(s.value instanceof yt,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),L(Ba(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),i=(a,l)=>{const u=s.gradFunc(a,l),d=Array.isArray(u)?u:[u];L(d.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),L(d.every(p=>p instanceof yt),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const h={};return d.forEach((p,x)=>{h[x]=()=>p}),h};return this.runKernelFunc({forwardFunc:r,backwardsFunc:i,inputs:o})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,n){return this.state.tensorInfo.get(e).backend.readToGPU(e,n)}async time(e){const n=os(),s=await this.backend.time(e);return s.wallMs=os()-n,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new qF;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}Hc.nextTensorId=0;Hc.nextVariableId=0;function Kie(t){const e=Fx(me(t),"float32");return W.makeTensor(e,t,"float32")}function YV(){const t=_V();if(t._tfengine==null){const e=new DV(t);t._tfengine=new Hc(e)}return gie(t._tfengine.ENV),Uie(()=>t._tfengine),t._tfengine}const W=YV();function Xie(t,e){const n={a:t,b:e};return W.runKernel(wu,n)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yie(){return typeof navigator<"u"&&navigator!=null}let QT;function Jie(t){QT=t}function YN(t){if(QT!==void 0)return QT;if(t||Yie()){if(t||(t=navigator),t.product==="ReactNative")return!0;const e=t.userAgent||t.vendor||(typeof window<"u"?window.opera:"");if(!e){const n=t;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function JN(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}const jie=Object.freeze(Object.defineProperty({__proto__:null,isBrowser:JN,isMobile:YN,mockIsMobile:Jie},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qs=ue();qs.registerFlag("DEBUG",()=>!1,t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});qs.registerFlag("IS_BROWSER",()=>JN());qs.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");qs.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));qs.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));qs.registerFlag("PROD",()=>!1);qs.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>qs.getBool("DEBUG"));qs.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);qs.registerFlag("IS_TEST",()=>!1);qs.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>qs.getBool("DEBUG"));qs.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);qs.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);qs.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ni(t,e){let n=t;if(Mn(t))return e==="string"?[]:[t.length];if(WV(t)){const o=t.channels||"RGBA";return[t.height,t.width*o.length]}else if(qV(t))return[t.buffer.size/(e==null?4:hp(e))];if(!Array.isArray(t))return[];const s=[];for(;Array.isArray(n)||Mn(n)&&e!=="string";)s.push(n.length),n=n[0];return Array.isArray(t)&&ue().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&JV(t,s,[]),s}function JV(t,e,n){if(n=n||[],!Array.isArray(t)&&!Mn(t)){L(e.length===0,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}L(e.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`),L(t.length===e[0],()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`);const s=e.slice(1);for(let o=0;o<t.length;++o)JV(t[o],s,n.concat(o))}function KF(t,e,n,s){if(t!=="string_or_numeric"){if(t==null)throw new Error("Expected dtype cannot be null.");if(t!=="numeric"&&t!==e||t==="numeric"&&e==="string")throw new Error(`Argument '${n}' passed to '${s}' must be ${t} tensor, but got ${e} tensor`)}}function V(t,e,n,s="numeric"){if(t instanceof ge())return KF(s,t.dtype,e,n),t;let o=vu(t);if(o!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(o=s),KF(s,o,e,n),t==null||!Mn(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){const l=t==null?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${l}'`)}const r=ni(t,o);!Mn(t)&&!Array.isArray(t)&&(t=[t]);const a=o!=="string"?Qa(t,o):ti(t,[],!0);return W.makeTensor(a,r,o)}function bp(t,e,n,s="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map((r,i)=>V(r,`${e}[${i}]`,n,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jN="__op";function K(t){const e=Object.keys(t);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const s=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n=n+jN;const o=(...r)=>{W.startScope(n);try{const i=s(...r);return Fi(i)&&console.error("Cannot return a Promise inside of tidy."),W.endScope(i),i}catch(i){throw W.endScope(null),i}};return Object.defineProperty(o,"name",{value:n,configurable:!0}),o}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zie(t,e){const n=V(t,"real","complex"),s=V(e,"imag","complex");ds(n.shape,s.shape,`real and imag shapes, ${n.shape} and ${s.shape}, must match in call to tf.complex().`);const o={real:n,imag:s};return W.runKernel(Ux,o)}const Li=K({complex_:Zie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function el(t,e,n,s){if(s==null)s=vu(t);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(qV(t)||WV(t)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return W.backend.createTensorFromGPUData(t,e||n,s)}if(!Mn(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){mo(e);const o=me(e),r=me(n);L(o===r,()=>`Based on the provided shape, [${e}], the tensor should have ${o} values but has ${r}`);for(let i=0;i<n.length;++i){const a=n[i],l=i===n.length-1?a!==me(e.slice(i)):!0;L(n[i]===e[i]||!l,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `)}}return!Mn(t)&&!Array.isArray(t)&&(t=[t]),e=e||n,t=s!=="string"?Qa(t,s):ti(t,[],!0),W.makeTensor(t,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uo(t,e,n){const s=ni(t,n);return el(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ql={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class kr{static join(e){return new kr(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(s=>Mn(s)?s.buffer:s),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let n=0;for(let s=0;s<e.length;s++){const o=e[s];s!==e.length-1&&o.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const r=n+o.byteLength;this.shards.push({buffer:o,start:n,end:r}),n=r}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,n=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,n=isNaN(Number(n))?0:n,e=Math.max(0,e),n=Math.min(this.byteLength,n),n<=e)return new ArrayBuffer(0);const s=this.findShardForByte(e);if(s===-1)throw new Error(`Could not find start shard for byte ${e}`);const o=n-e,r=new ArrayBuffer(o),i=new Uint8Array(r);let a=0;for(let l=s;l<this.shards.length;l++){const u=this.shards[l],h=e+a-u.start,p=a,b=Math.min(n,u.end)-u.start,w=new Uint8Array(u.buffer,h,b-h);if(i.set(w,p),a+=w.length,n<u.end)break}return r}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function n(o){return e<o.start?-1:e>=o.end?1:0}if(n(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=Qie(this.shards,n);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function Qie(t,e){let n=0,s=t.length;for(;n<=s;){const o=Math.floor((s-n)/2)+n,r=e(t[o]);if(r===0)return o;r<0?s=o:n=o+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eae(){ue().set("PROD",!0)}function tae(){ue().set("DEBUG",!0)}function nae(){ue().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function sae(t){ue().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function oae(){W.disposeVariables()}function mr(){return W}function eS(){return W.memory()}function rae(t){return W.profile(t)}function le(t,e){return W.tidy(t,e)}function je(t){Pi(t).forEach(n=>n.dispose())}function Fn(t){return W.keep(t)}function iae(t){return W.time(t)}function tS(t){return W.setBackend(t)}function nS(){return W.ready()}function jV(){return W.backendName}function aae(t){W.removeBackend(t)}function lae(t){return W.findBackend(t)}function uae(t){return W.findBackendFactory(t)}function ZN(t,e,n=1){return W.registerBackend(t,e,n)}function QN(){return W.backend}function cae(t,e){ue().setPlatform(t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ua=4;async function sS(t,e){const n=[],s=[],o=Array.isArray(t)?t.map(i=>i.name):Object.keys(t);for(let i=0;i<o.length;++i){const a=o[i],l=Array.isArray(t)?t[i].tensor:t[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const u={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const d=new Promise(async h=>{const p=await l.bytes(),x=p.reduce((C,T)=>C+T.length,0)+Ua*p.length,b=new Uint8Array(x);let w=0;for(let C=0;C<p.length;C++){const T=p[C],N=new Uint8Array(new Uint32Array([T.length]).buffer);b.set(N,w),w+=Ua,b.set(T,w),w+=T.length}h(b)});s.push(d)}else s.push(l.data());e!=null&&(u.group=e),n.push(u)}const r=await Promise.all(s);return{data:hae(r),specs:n}}function eE(t,e){const n=new kr(t),s={};let o=0;for(const r of e){const i=dae(r,(a,l)=>n.slice(o+a,o+l));s[r.name]=ZV(r,n.slice(o,o+i)),o+=i}return s}function dae(t,e){const n=me(t.shape);let s;if("quantization"in t){const o=t.quantization;s=Ql[o.dtype]}else if(t.dtype==="string"){let o=0;for(let r=0;r<n;r++)o+=Ua+new Uint32Array(e(o,o+Ua))[0];return o}else s=Ql[t.dtype];return n*s}async function fae(t,e){const n=me(t.shape);let s;if("quantization"in t){const o=t.quantization;s=Ql[o.dtype]}else if(t.dtype==="string"){let o=0;for(let r=0;r<n;r++)o+=Ua+new Uint32Array(await e(o,o+Ua))[0];return o}else s=Ql[t.dtype];return n*s}function ZV(t,e){const n=t.name,s=t.dtype,o=t.shape,r=me(o);let i,a=0;if("quantization"in t){const l=t.quantization;if(l.dtype==="uint8"||l.dtype==="uint16"){if(!("min"in l&&"scale"in l))throw new Error(`Weight ${t.name} with quantization ${l.dtype} doesn't have corresponding metadata min and scale.`)}else if(l.dtype==="float16"){if(s!=="float32")throw new Error(`Weight ${t.name} is quantized with ${l.dtype} which only supports weights of type float32 not ${s}.`)}else throw new Error(`Weight ${t.name} has unknown quantization dtype ${l.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const u=Ql[l.dtype],d=l.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(s==="float32")if(l.dtype==="uint8"||l.dtype==="uint16"){i=new Float32Array(d.length);for(let h=0;h<d.length;h++){const p=d[h];i[h]=p*l.scale+l.min}}else if(l.dtype==="float16")i=vae()(d);else throw new Error(`Unsupported quantization type ${l.dtype} for weight type float32.`);else if(s==="int32"){if(l.dtype!=="uint8"&&l.dtype!=="uint16")throw new Error(`Unsupported quantization type ${l.dtype} for weight type int32.`);i=new Int32Array(d.length);for(let h=0;h<d.length;h++){const p=d[h];i[h]=Math.round(p*l.scale+l.min)}}else throw new Error(`Unsupported dtype in weight '${n}': ${s}`);a+=r*u}else if(s==="string"){const l=me(t.shape);i=[];for(let u=0;u<l;u++){const d=new Uint32Array(e.slice(a,a+Ua))[0];a+=Ua;const h=new Uint8Array(e.slice(a,a+d));i.push(h),a+=d}}else{const l=Ql[s];if(s==="float32")i=new Float32Array(e);else if(s==="int32")i=new Int32Array(e);else if(s==="bool")i=new Uint8Array(e);else if(s==="complex64"){i=new Float32Array(e);const u=new Float32Array(i.length/2),d=new Float32Array(i.length/2);for(let b=0;b<u.length;b++)u[b]=i[b*2],d[b]=i[b*2+1];const h=uo(u,o,"float32"),p=uo(d,o,"float32"),x=Li(h,p);return h.dispose(),p.dispose(),x}else throw new Error(`Unsupported dtype in weight '${n}': ${s}`);a+=r*l}return uo(i,o,s)}async function XF(t,e,n){let s=new Uint8Array(e);for(;s.byteLength<n;){const{done:o,value:r}=await t.read();if(o&&r==null){const a=n-s.byteLength;throw new Error(`Reader is done but ${a} bytes are still expected`)}const i=new Uint8Array(s.length+r.byteLength);i.set(s,0),i.set(new Uint8Array(r),s.length),s=i}return s.buffer}async function QV(t,e){const n={},s=t.getReader();let o=new ArrayBuffer(0);for(const r of e){const i=await fae(r,async(u,d)=>(o=await XF(s,o,d),o.slice(u,d)));o=await XF(s,o,i);const a=o.slice(0,i);o=o.slice(i);const l=ZV(r,a);if(n[r.name]=l,jV()==="webgpu"){const u=QN();"uploadToGPU"in u&&me(l.shape)>=ue().get("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD")&&u.uploadToGPU(l.dataId)}}return n}function hae(t){if(t===null)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0;const n=[];t.forEach(r=>{if(e+=r.byteLength,n.push(r.byteLength===r.buffer.byteLength?r:new r.constructor(r)),!(r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${r.constructor.name}`)});const s=new Uint8Array(e);let o=0;return n.forEach(r=>{s.set(new Uint8Array(r.buffer),o),o+=r.byteLength}),s.buffer}const tE=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function YF(t){return tE?Buffer.byteLength(t,"utf8"):new Blob([t]).size}function pae(t){if(tE)return Buffer.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let s=0,o=e.length;s<o;s++)n+=String.fromCharCode(e[s]);return btoa(n)}function mae(t){if(tE){const s=Buffer.from(t,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let s=0;s<e.length;++s)n.set([e.charCodeAt(s)],s);return n.buffer}function ez(t){return kr.join(t)}function JF(t){for(t=t.trim();t.endsWith("/");)t=t.slice(0,t.length-1);const n=t.split("/");return n[n.length-1]}function tz(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return t.signature!=null&&(n.signature=t.signature),t.userDefinedMetadata!=null&&(n.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(n.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(n.initializerSignature=t.initializerSignature),t.trainingConfig!=null&&(n.trainingConfig=t.trainingConfig),n}function nE(t,e,n){const s={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(t.trainingConfig!=null&&(s.trainingConfig=t.trainingConfig),t.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");s.weightSpecs=e,s.weightData=n}return t.signature!=null&&(s.signature=t.signature),t.userDefinedMetadata!=null&&(s.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(s.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(s.initializerSignature=t.initializerSignature),s}async function sE(t,e){let n,s;return t.weightsManifest!=null&&([n,s]=await e(t.weightsManifest)),nE(t,n,s)}function qm(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:t.modelTopology==null?0:YF(JSON.stringify(t.modelTopology)),weightSpecsBytes:t.weightSpecs==null?0:YF(JSON.stringify(t.weightSpecs)),weightDataBytes:t.weightData==null?0:new kr(t.weightData).byteLength}}function j0(t){const e=[];for(const n of t)e.push(...n.weights);return e}function gae(){const t=n=>{let s=n<<13,o=0;for(;(s&8388608)===0;)o-=8388608,s<<=1;return s&=-8388609,o+=947912704,s|o},e=new Uint32Array(2048);e[0]=0;for(let n=1;n<1024;n++)e[n]=t(n);for(let n=1024;n<2048;n++)e[n]=939524096+(n-1024<<13);return e}function yae(){const t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}function xae(){const t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}function vae(){const t=gae(),e=yae(),n=xae();return s=>{const o=new ArrayBuffer(4*s.length),r=new Uint32Array(o);for(let i=0;i<s.length;i++){const a=s[i],l=t[n[a>>10]+(a&1023)]+e[a>>10];r[i]=l}return new Float32Array(o)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class en{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return en.instance==null&&(en.instance=new en),en.instance}static registerSaveRouter(e){en.getInstance().saveRouters.push(e)}static registerLoadRouter(e){en.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return en.getHandlers(e,"save")}static getLoadHandlers(e,n){return en.getHandlers(e,"load",n)}static getHandlers(e,n,s){const o=[];return(n==="load"?en.getInstance().loadRouters:en.getInstance().saveRouters).forEach(i=>{const a=i(e,s);a!==null&&o.push(a)}),o}}const bae=t=>en.registerSaveRouter(t),wae=t=>en.registerLoadRouter(t),nz=t=>en.getSaveHandlers(t),sz=(t,e)=>en.getLoadHandlers(t,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oS="tensorflowjs",rS=1,Bl="models_store",Ra="model_info_store";function oz(){if(!ue().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t=typeof window>"u"?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function iS(t){const e=t.result;e.createObjectStore(Bl,{keyPath:"modelPath"}),e.createObjectStore(Ra,{keyPath:"modelPath"})}class eu{constructor(e){if(this.indexedDB=oz(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,n){return new Promise((s,o)=>{const r=this.indexedDB.open(oS,rS);r.onupgradeneeded=()=>iS(r),r.onsuccess=()=>{const i=r.result;if(n==null){const a=i.transaction(Bl,"readonly"),u=a.objectStore(Bl).get(this.modelPath);u.onsuccess=()=>{if(u.result==null)return i.close(),o(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(u.result.modelArtifacts)},u.onerror=d=>(i.close(),o(u.error)),a.oncomplete=()=>i.close()}else{n.weightData=kr.join(n.weightData);const a=qm(n),l=i.transaction(Ra,"readwrite");let u=l.objectStore(Ra),d;try{d=u.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(p){return o(p)}let h;d.onsuccess=()=>{h=i.transaction(Bl,"readwrite");const p=h.objectStore(Bl);let x;try{x=p.put({modelPath:this.modelPath,modelArtifacts:n,modelArtifactsInfo:a})}catch(b){return o(b)}x.onsuccess=()=>s({modelArtifactsInfo:a}),x.onerror=b=>{u=l.objectStore(Ra);const w=u.delete(this.modelPath);w.onsuccess=()=>(i.close(),o(x.error)),w.onerror=C=>(i.close(),o(x.error))}},d.onerror=p=>(i.close(),o(d.error)),l.oncomplete=()=>{h==null?i.close():h.oncomplete=()=>i.close()}}},r.onerror=i=>o(r.error)})}}eu.URL_SCHEME="indexeddb://";const rz=t=>ue().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(eu.URL_SCHEME)?Cae(t.slice(eu.URL_SCHEME.length)):null;en.registerSaveRouter(rz);en.registerLoadRouter(rz);function Cae(t){return new eu(t)}function Tae(t){return t.startsWith(eu.URL_SCHEME)?t.slice(eu.URL_SCHEME.length):t}class Sae{constructor(){this.indexedDB=oz()}async listModels(){return new Promise((e,n)=>{const s=this.indexedDB.open(oS,rS);s.onupgradeneeded=()=>iS(s),s.onsuccess=()=>{const o=s.result,r=o.transaction(Ra,"readonly"),a=r.objectStore(Ra).getAll();a.onsuccess=()=>{const l={};for(const u of a.result)l[u.modelPath]=u.modelArtifactsInfo;e(l)},a.onerror=l=>(o.close(),n(a.error)),r.oncomplete=()=>o.close()},s.onerror=o=>n(s.error)})}async removeModel(e){return e=Tae(e),new Promise((n,s)=>{const o=this.indexedDB.open(oS,rS);o.onupgradeneeded=()=>iS(o),o.onsuccess=()=>{const r=o.result,i=r.transaction(Ra,"readwrite"),a=i.objectStore(Ra),l=a.get(e);let u;l.onsuccess=()=>{if(l.result==null)return r.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const d=a.delete(e),h=()=>{u=r.transaction(Bl,"readwrite");const x=u.objectStore(Bl).delete(e);x.onsuccess=()=>n(l.result.modelArtifactsInfo),x.onerror=b=>s(l.error)};d.onsuccess=h,d.onerror=p=>(h(),r.close(),s(l.error))}},l.onerror=d=>(r.close(),s(l.error)),i.oncomplete=()=>{u==null?r.close():u.oncomplete=()=>r.close()}},o.onerror=r=>s(o.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ri="/",Sc="tensorflowjs_models",iz="info",Nae="model_topology",Eae="weight_specs",Iae="weight_data",kae="model_metadata";function az(t){return{info:[Sc,t,iz].join(Ri),topology:[Sc,t,Nae].join(Ri),weightSpecs:[Sc,t,Eae].join(Ri),weightData:[Sc,t,Iae].join(Ri),modelMetadata:[Sc,t,kae].join(Ri)}}function lz(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function Aae(t){const e=t.split(Ri);if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join(Ri)}function Rae(t){return t.startsWith(tu.URL_SCHEME)?t.slice(tu.URL_SCHEME.length):t}class tu{constructor(e){if(!ue().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=az(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),o=qm(e),r=kr.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(o)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,pae(r));const i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:o}}catch{throw lz(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${o.modelTopologyBytes}, weightSpecsBytes=${o.weightSpecsBytes}, weightDataBytes=${o.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const n={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);n.modelTopology=s;const o=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(o==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);n.weightSpecs=o;const r=this.LS.getItem(this.keys.modelMetadata);if(r!=null){const a=JSON.parse(r);n.format=a.format,n.generatedBy=a.generatedBy,n.convertedBy=a.convertedBy,a.signature!=null&&(n.signature=a.signature),a.userDefinedMetadata!=null&&(n.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(n.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(n.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(n.trainingConfig=a.trainingConfig)}const i=this.LS.getItem(this.keys.weightData);if(i==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return n.weightData=mae(i),n}}tu.URL_SCHEME="localstorage://";const uz=t=>ue().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(tu.URL_SCHEME)?$ae(t.slice(tu.URL_SCHEME.length)):null;en.registerSaveRouter(uz);en.registerLoadRouter(uz);function $ae(t){return new tu(t)}class Dae{constructor(){L(ue().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),L(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},n=Sc+Ri,s=Ri+iz;for(let o=0;o<this.LS.length;++o){const r=this.LS.key(o);if(r.startsWith(n)&&r.endsWith(s)){const i=Aae(r);e[i]=JSON.parse(this.LS.getItem(r))}}return e}async removeModel(e){e=Rae(e);const n=az(e);if(this.LS.getItem(n.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(n.info));return lz(n),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oc="://";class ks{constructor(){this.managers={}}static getInstance(){return ks.instance==null&&(ks.instance=new ks),ks.instance}static registerManager(e,n){L(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(Oc)&&(e=e.slice(0,e.indexOf(Oc))),L(e.length>0,()=>"scheme must not be an empty string.");const s=ks.getInstance();L(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=n}static getManager(e){const n=ks.getInstance().managers[e];if(n==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return n}static getSchemes(){return Object.keys(ks.getInstance().managers)}}function v0(t){if(t.indexOf(Oc)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${ks.getSchemes().join(",")}`);return{scheme:t.split(Oc)[0],path:t.split(Oc)[1]}}async function cz(t,e,n=!1){L(t!==e,()=>`Old path and new path are the same: '${t}'`);const s=en.getLoadHandlers(t);L(s.length>0,()=>`Copying failed because no load handler is found for source URL ${t}.`),L(s.length<2,()=>`Copying failed because more than one (${s.length}) load handlers for source URL ${t}.`);const o=s[0],r=en.getSaveHandlers(e);L(r.length>0,()=>`Copying failed because no save handler is found for destination URL ${e}.`),L(r.length<2,()=>`Copying failed because more than one (${s.length}) save handlers for destination URL ${e}.`);const i=r[0],a=v0(t).scheme,l=v0(t).path,u=a===v0(t).scheme,d=await o.load();n&&u&&await ks.getManager(a).removeModel(l);const h=await i.save(d);return n&&!u&&await ks.getManager(a).removeModel(l),h.modelArtifactsInfo}async function _ae(){const t=ks.getSchemes(),e={};for(const n of t){const s=await ks.getManager(n).listModels();for(const o in s){const r=n+Oc+o;e[r]=s[o]}}return e}async function Mae(t){const e=v0(t);return ks.getManager(e.scheme).removeModel(e.path)}async function Fae(t,e){return cz(t,e,!1)}async function Oae(t,e){return cz(t,e,!0)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pae{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,n){return fetch(e,n)}now(){return performance.now()}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${n}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,n){return new TextDecoder(n).decode(e)}setTimeoutCustom(e,n){if(typeof window>"u"||!ue().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,n);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},n),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const o=this.functionRefs[s.data.index];o(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return PV(e)}}if(ue().get("IS_BROWSER")){ue().setPlatform("browser",new Pae);try{ks.registerManager(tu.URL_SCHEME,new Dae)}catch{}try{ks.registerManager(eu.URL_SCHEME,new Sae)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lae={importFetch:()=>require("node-fetch")};let JC;class Vae{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,n){return ue().global.fetch!=null?ue().global.fetch(e,n):(JC==null&&(JC=Lae.importFetch()),JC(e,n))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${n}`);return this.textEncoder.encode(e)}decode(e,n){return e.length===0?"":new this.util.TextDecoder(n).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}ue().get("IS_NODE")&&!ue().get("IS_BROWSER")&&ue().setPlatform("node",new Vae);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function et(t,e="float32",n){return e=e||"float32",mo(t),new In(t,e,n)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zae(t,e){const n=V(t,"x","cast");if(!IV(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&n.dtype!=="string"||e!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:n},o={dtype:e};return W.runKernel(vd,s,o)}const Ne=K({cast_:zae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bae(t){const n={x:V(t,"x","clone","string_or_numeric")};return W.runKernel(Dd,n)}const jr=K({clone_:Bae});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oE(t,e=!1){console.log(t.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */YV();const Uae={buffer:et,cast:Ne,clone:jr,print:oE};Gie(Uae);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gae(t,e){let n=V(t,"a","add"),s=V(e,"b","add");[n,s]=on(n,s);const o={a:n,b:s};return W.runKernel(wu,o)}const Te=K({add_:Gae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hae(t,e){let n=V(t,"a","floorDiv"),s=V(e,"b","floorDiv");[n,s]=on(n,s);const o={a:n,b:s};return W.runKernel(Rd,o)}const Hv=K({floorDiv_:Hae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wae(t,e){let n=V(t,"a","div"),s=V(e,"b","div");if([n,s]=on(n,s),n.dtype==="int32"&&s.dtype==="int32")return Hv(n,s);const o={a:n,b:s},r={};return W.runKernel(Sd,o,r)}const Pe=K({div_:Wae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qae(t,e){let n=V(t,"a","mul"),s=V(e,"b","mul");[n,s]=on(n,s);const o={a:n,b:s};return W.runKernel(Bd,o)}const j=K({mul_:qae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kae(t){const e=V(t,"x","abs");if(e.dtype==="complex64"){const n={x:e};return W.runKernel(jp,n)}else{const n={x:e};return W.runKernel(Up,n)}}const Sn=K({abs_:Kae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xae(t){const n={x:V(t,"x","acos")};return W.runKernel(fd,n)}const rE=K({acos_:Xae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yae(t){const n={x:V(t,"x","acosh")};return W.runKernel(hd,n)}const iE=K({acosh_:Yae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jae(t){L(Array.isArray(t),()=>"The argument passed to tf.addN() must be a list of tensors"),L(t.length>=1,()=>`Must pass at least one tensor to tf.addN(), but got ${t.length}`);const e=t.map((o,r)=>V(o,`tensors${r}`,"addN")),n=e[0];e.forEach(o=>{if(o.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(o=>{if(!lt(o.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});const s=e;return W.runKernel(Gp,s)}const dz=K({addN_:Jae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jae(t,e=null,n=!1){const o={x:V(t,"x","all","bool")},r={axis:e,keepDims:n};return W.runKernel(Ox,o,r)}const Wv=K({all_:jae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zae(t,e=null,n=!1){const o={x:V(t,"x","any","bool")},r={axis:e,keepDims:n};return W.runKernel(Px,o,r)}const wp=K({any_:Zae});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qae(t,e=0){const s={x:V(t,"x","argMax")},o={axis:e};return W.runKernel(Hp,s,o)}const nu=K({argMax_:Qae});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ele(t,e=0){const s={x:V(t,"x","argMin")},o={axis:e};return W.runKernel(Wp,s,o)}const aE=K({argMin_:ele});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tle(t){const n={x:V(t,"x","asin")};return W.runKernel(pd,n)}const lE=K({asin_:tle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nle(t){const n={x:V(t,"x","asinh")};return W.runKernel(md,n)}const uE=K({asinh_:nle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sle(t){const n={x:V(t,"x","atan")};return W.runKernel(gd,n)}const cE=K({atan_:sle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ole(t,e){let n=V(t,"a","atan2"),s=V(e,"b","atan2");[n,s]=on(n,s);const o={a:n,b:s};return W.runKernel(xd,o)}const dE=K({atan2_:ole});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rle(t){const n={x:V(t,"x","atanh")};return W.runKernel(yd,n)}const fE=K({atanh_:rle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Km(t,e,n,s,o="NHWC",r){const i=t[3],a=[...e,i],l=qi(o);return jn(t,a,n,r,s,null,null,l)}function sr(t,e,n,s,o,r,i="channelsLast"){const[a,l]=Cp(e);let u;if(i==="channelsLast")u=[a,l,t[3],t[3]];else if(i==="channelsFirst")u=[a,l,t[1],t[1]];else throw new Error(`Unknown dataFormat ${i}`);return jn(t,u,n,s,o,r,!1,i)}function Wi(t,e,n,s,o,r,i="NDHWC"){const[a,l,u]=aS(e);let d,h;if(i==="NDHWC")h="channelsLast",d=[a,l,u,t[4],t[4]];else if(i==="NCDHW")h="channelsFirst",d=[a,l,u,t[1],t[1]];else throw new Error(`Unknown dataFormat ${i}`);return tl(t,d,n,s,o,!1,h,r)}function jn(t,e,n,s,o,r,i=!1,a="channelsLast"){let[l,u,d,h]=[-1,-1,-1,-1];if(a==="channelsLast")[l,u,d,h]=t;else if(a==="channelsFirst")[l,h,u,d]=t;else throw new Error(`Unknown dataFormat ${a}`);const[p,x,,b]=e,[w,C]=Cp(n),[T,N]=Cp(s),I=Pc(p,T),k=Pc(x,N),{padInfo:A,outHeight:$,outWidth:M}=lle(o,u,d,w,C,I,k,r,a),O=i?b*h:b;let F;return a==="channelsFirst"?F=[l,O,$,M]:a==="channelsLast"&&(F=[l,$,M,O]),{batchSize:l,dataFormat:a,inHeight:u,inWidth:d,inChannels:h,outHeight:$,outWidth:M,outChannels:O,padInfo:A,strideHeight:w,strideWidth:C,filterHeight:p,filterWidth:x,effectiveFilterHeight:I,effectiveFilterWidth:k,dilationHeight:T,dilationWidth:N,inShape:t,outShape:F,filterShape:e}}function tl(t,e,n,s,o,r=!1,i="channelsLast",a){let[l,u,d,h,p]=[-1,-1,-1,-1,-1];if(i==="channelsLast")[l,u,d,h,p]=t;else if(i==="channelsFirst")[l,p,u,d,h]=t;else throw new Error(`Unknown dataFormat ${i}`);const[x,b,w,,C]=e,[T,N,I]=aS(n),[k,A,$]=aS(s),M=Pc(x,k),O=Pc(b,A),F=Pc(w,$),{padInfo:P,outDepth:D,outHeight:H,outWidth:Z}=ule(o,u,d,h,T,N,I,M,O,F,a),ne=r?C*p:C;let Q;return i==="channelsFirst"?Q=[l,ne,D,H,Z]:i==="channelsLast"&&(Q=[l,D,H,Z,ne]),{batchSize:l,dataFormat:i,inDepth:u,inHeight:d,inWidth:h,inChannels:p,outDepth:D,outHeight:H,outWidth:Z,outChannels:ne,padInfo:P,strideDepth:T,strideHeight:N,strideWidth:I,filterDepth:x,filterHeight:b,filterWidth:w,effectiveFilterDepth:M,effectiveFilterHeight:O,effectiveFilterWidth:F,dilationDepth:k,dilationHeight:A,dilationWidth:$,inShape:t,outShape:Q,filterShape:e}}function ile(t,e,n,s,o){s==null&&(s=hE(t,e,n));const r=t[0],i=t[1],a=Tp((r-e+2*s)/n+1,o),l=Tp((i-e+2*s)/n+1,o);return[a,l]}function ale(t,e,n,s,o,r){o==null&&(o=hE(t,e[0],s[0]));const i=[0,0,0,n];for(let a=0;a<3;a++)t[a]+2*o>=e[a]&&(i[a]=Tp((t[a]-e[a]+2*o)/s[a]+1,r));return i}function hE(t,e,n,s=1){const o=Pc(e,s);return Math.floor((t[0]*(n-1)-n+o)/2)}function Cp(t){return typeof t=="number"?[t,t,t]:t.length===2?[t[0],t[1],1]:t}function aS(t){return typeof t=="number"?[t,t,t]:t}function Pc(t,e){return e<=1?t:t+(t-1)*(e-1)}function lle(t,e,n,s,o,r,i,a,l){let u,d,h;if(typeof t=="number"){u={top:t,bottom:t,left:t,right:t,type:t===0?"VALID":"NUMBER"};const x=ile([e,n],r,s,t,a);d=x[0],h=x[1]}else if(t==="same"){d=Math.ceil(e/s),h=Math.ceil(n/o);const p=Math.max(0,(d-1)*s+r-e),x=Math.max(0,(h-1)*o+i-n),b=Math.floor(p/2),w=p-b,C=Math.floor(x/2),T=x-C;u={top:b,bottom:w,left:C,right:T,type:"SAME"}}else if(t==="valid")u={top:0,bottom:0,left:0,right:0,type:"VALID"},d=Math.ceil((e-r+1)/s),h=Math.ceil((n-i+1)/o);else if(typeof t=="object"){const p=l==="channelsLast"?t[1][0]:t[2][0],x=l==="channelsLast"?t[1][1]:t[2][1],b=l==="channelsLast"?t[2][0]:t[3][0],w=l==="channelsLast"?t[2][1]:t[3][1];u={top:p,bottom:x,left:b,right:w,type:p===0&&x===0&&b===0&&w===0?"VALID":"EXPLICIT"},d=Tp((e-r+p+x)/s+1,a),h=Tp((n-i+b+w)/o+1,a)}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:u,outHeight:d,outWidth:h}}function ule(t,e,n,s,o,r,i,a,l,u,d){let h,p,x,b;if(t==="valid"&&(t=0),typeof t=="number"){h={top:t,bottom:t,left:t,right:t,front:t,back:t,type:t===0?"VALID":"NUMBER"};const C=ale([e,n,s,1],[a,l,u],1,[o,r,i],t,d);p=C[0],x=C[1],b=C[2]}else if(t==="same"){p=Math.ceil(e/o),x=Math.ceil(n/r),b=Math.ceil(s/i);const w=(p-1)*o+a-e,C=(x-1)*r+l-n,T=(b-1)*i+u-s,N=Math.floor(w/2),I=w-N,k=Math.floor(C/2),A=C-k,$=Math.floor(T/2),M=T-$;h={top:k,bottom:A,left:$,right:M,front:N,back:I,type:"SAME"}}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:h,outDepth:p,outHeight:x,outWidth:b}}function Tp(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function Ga(t){const[e,n,s]=Cp(t);return e===1&&n===1&&s===1}function fs(t,e){return Ga(t)||Ga(e)}function su(t){return Cp(t).every(e=>e>0)}function qi(t){if(t==="NHWC")return"channelsLast";if(t==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function Os(t,e,n){if(n!=null){if(typeof e=="string")throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if(typeof e=="number")L(Zl(e),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(o=>{L(Zl(o),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${o}.`)})});else throw Error(`Error in ${t}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cle(t,e){const s={x:V(t,"x","reshape","string_or_numeric")},o={shape:e};return W.runKernel($m,s,o)}const ee=K({reshape_:cle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dle(t,e,n,s,o){const r=V(t,"x","avgPool","float32"),i=1;L(fs(n,i),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`);let a=r,l=!1;r.rank===3&&(l=!0,a=ee(r,[1,r.shape[0],r.shape[1],r.shape[2]])),L(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),Os("avgPool",s,o);const u={x:a},d={filterSize:e,strides:n,pad:s,dimRoundingMode:o};let h=W.runKernel(qp,u,d);return h=Ne(h,r.dtype),l?ee(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const Xm=K({avgPool_:dle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fle(t,e,n,s,o,r="NDHWC"){const i=V(t,"x","avgPool3d","float32");let a=i,l=!1;i.rank===4&&(l=!0,a=ee(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),L(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),L(r==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${r}`),L(typeof n=="number"&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${n}'`),Os("avgPool3d",s,o);const u={x:a},d={filterSize:e,strides:n,pad:s,dimRoundingMode:o,dataFormat:r};let h=W.runKernel(Kp,u,d);return h=Ne(h,a.dtype),l?ee(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const pE=K({avgPool3d_:fle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hle(t,e=0){L(t.length>=1,()=>"Pass at least one tensor to concat");const n=bp(t,"tensors","concat","string_or_numeric");if(n[0].dtype==="complex64"&&n.forEach(r=>{if(r.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${r.dtype}. `)}),n.length===1)return jr(n[0]);const s=n,o={axis:e};return W.runKernel(Zp,s,o)}const mn=K({concat_:hle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ple(t,e,n=!1,s=!1){let o=V(t,"a","matMul"),r=V(e,"b","matMul");[o,r]=on(o,r);const i={a:o,b:r},a={transposeA:n,transposeB:s};return W.runKernel(Xp,i,a)}const st=K({matMul_:ple});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mle(t){const n={x:V(t,"x","sigmoid","float32")};return W.runKernel(Zd,n)}const br=K({sigmoid_:mle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gle(t,e,n){const s=V(t,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const o={x:s},r={begin:e,size:n};return W.runKernel(Om,o,r)}const mt=K({slice_:gle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yle(t){const n={x:V(t,"x","tanh","float32")};return W.runKernel(of,n)}const Ha=K({tanh_:yle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xle(t,e,n,s,o,r){const i=V(t,"forgetBias","basicLSTMCell"),a=V(e,"lstmKernel","basicLSTMCell"),l=V(n,"lstmBias","basicLSTMCell"),u=V(s,"data","basicLSTMCell"),d=V(o,"c","basicLSTMCell"),h=V(r,"h","basicLSTMCell"),p=mn([u,h],1),x=st(p,a),b=Te(x,l),w=b.shape[0],C=b.shape[1]/4,T=[w,C],N=mt(b,[0,0],T),I=mt(b,[0,C],T),k=mt(b,[0,C*2],T),A=mt(b,[0,C*3],T),$=Te(j(br(N),Ha(I)),j(d,br(Te(i,k)))),M=j(Ha($),br(A));return[$,M]}const fz=K({basicLSTMCell_:xle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vle(t,e,n){const s=V(t,"x","batchToSpaceND"),o=e.reduce((a,l)=>a*l);L(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),L(n.length===e.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`),L(s.shape[0]%o===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${o}`);const r={x:s},i={blockShape:e,crops:n};return W.runKernel(Yp,r,i)}const Ym=K({batchToSpaceND_:vle});function ble(t){let e;return t.rank===0||t.rank===1?e=ee(t,[1,1,1,t.size]):t.rank===2?e=ee(t,[1,1,t.shape[0],t.shape[1]]):t.rank===3?e=ee(t,[1,t.shape[0],t.shape[1],t.shape[2]]):e=t,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wle(t,e,n,s,o,r){r==null&&(r=.001);const i=V(t,"x","batchNorm"),a=V(e,"mean","batchNorm"),l=V(n,"variance","batchNorm");let u;o!=null&&(u=V(o,"scale","batchNorm"));let d;s!=null&&(d=V(s,"offset","batchNorm")),L(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),L(d==null||a.rank===d.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),L(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const p={x:ble(i),scale:u,offset:d,mean:a,variance:l},x={varianceEpsilon:r},b=W.runKernel(am,p,x);return ee(b,i.shape)}const lf=K({batchNorm_:wle});function Cle(t,e,n,s,o,r){const i=V(t,"x","batchNorm"),a=V(e,"mean","batchNorm"),l=V(n,"variance","batchNorm");let u;o!=null&&(u=V(o,"scale","batchNorm"));let d;return s!=null&&(d=V(s,"offset","batchNorm")),L(i.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${i.rank}.`),L(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),L(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),u!=null&&L(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${u.rank}.`),d!=null&&L(d.rank===2||d.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${d.rank}.`),lf(i,a,l,d,u,r)}const mE=K({batchNorm2d_:Cle});function Tle(t,e,n,s,o,r){const i=V(t,"x","batchNorm"),a=V(e,"mean","batchNorm"),l=V(n,"variance","batchNorm");let u;o!=null&&(u=V(o,"scale","batchNorm"));let d;return s!=null&&(d=V(s,"offset","batchNorm")),L(i.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${i.rank}.`),L(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),L(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),u!=null&&L(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${u.rank}.`),d!=null&&L(d.rank===3||d.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${d.rank}.`),lf(i,a,l,d,u,r)}const gE=K({batchNorm3d_:Tle});function Sle(t,e,n,s,o,r){const i=V(t,"x","batchNorm"),a=V(e,"mean","batchNorm"),l=V(n,"variance","batchNorm");let u;o!=null&&(u=V(o,"scale","batchNorm"));let d;return s!=null&&(d=V(s,"offset","batchNorm")),L(i.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${i.rank}.`),L(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),L(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),u!=null&&L(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${u.rank}.`),d!=null&&L(d.rank===4||d.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${d.rank}.`),lf(i,a,l,d,u,r)}const yE=K({batchNorm4d_:Sle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nle(t,e,n){const s=V(t,"x","bincount"),o=V(e,"weights","bincount");L(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),L(n>=0,()=>`size must be non-negative, but got ${n}.`),L(o.size===s.size||o.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${o.shape}.`);const r={x:s,weights:o},i={size:n};return W.runKernel(zx,r,i)}const xE=K({bincount_:Nle});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ele(t,e){const n=V(t,"x","bitwiseAnd"),s=V(e,"y","bitwiseAnd");if(!lt(n.shape,s.shape))throw new Error(`BitwiseAnd: Tensors must have the same shape. x: ${n.shape}, y: ${s.shape}`);if(n.dtype!=="int32"||s.dtype!=="int32")throw new Error(`BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ${n.dtype} and type of y: ${s.dtype}`);const o={a:n,b:s};return W.runKernel(Jp,o)}const hz=K({bitwiseAnd_:Ele});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ile(t,e){const n=V(t,"s0","broadcastArgs","int32"),s=V(e,"s1","broadcastArgs","int32");if(n.rank!==1)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(s.rank!==1)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${s.rank}`);const o={s0:n,s1:s};return W.runKernel(Bx,o)}const pz=K({broadcastArgs_:Ile});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kle(t,e){let n=V(t,"broadcastTo","x");const s=n.shape;if(mo(e),e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const u=n.shape.slice();for(;u.length<e.length;)u.unshift(1);n=ee(n,u)}const o=n.shape,r=Array.from(e);for(let u=e.length-1;u>=0;u--)if(o[u]===e[u])r[u]=1;else if(n.shape[u]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(r.map((u,d)=>u>1?d:-1).filter(u=>u>=0).length===0)return jr(n);const a={x:n},l={reps:r};return W.runKernel(rf,a,l)}const Kl=K({broadcastTo_:kle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ale(t){const n={x:V(t,"x","ceil","float32")};return W.runKernel(bd,n)}const vE=K({ceil_:Ale});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cu(t,e,n){mo(t),n=n||vu(e);const s={shape:t,value:e,dtype:n};return W.runKernel(sv,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rle(t,e,n){const s=V(t,"x","clipByValue");if(L(e<=n,()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`),e===n)return Cu(s.shape,e,s.dtype);const o={x:s},r={clipValueMin:e,clipValueMax:n};return W.runKernel(wd,o,r)}const Ks=K({clipByValue_:Rle});function $le(t){return mn(t,0)}const bE=K({concat1d_:$le});function Dle(t,e){return mn(t,e)}const wE=K({concat2d_:Dle});function _le(t,e){return mn(t,e)}const CE=K({concat3d_:_le});function Mle(t,e){return mn(t,e)}const TE=K({concat4d_:Mle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fle(t,e,n,s,o="NHWC",r=[1,1],i){const a=V(t,"x","conv2d","float32"),l=V(e,"filter","conv2d","float32");let u=a,d=!1;a.rank===3&&(d=!0,u=ee(a,[1,a.shape[0],a.shape[1],a.shape[2]])),L(u.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${u.rank}.`),L(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),Os("conv2d",s,i);const h=o==="NHWC"?u.shape[3]:u.shape[1];L(h===l.shape[2],()=>`Error in conv2d: depth of input (${h}) must match input depth for filter ${l.shape[2]}.`),L(fs(n,r),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${r}'`),L(su(r),()=>"Error in conv2D: Dilated rates should be larger than 0."),L(su(n),()=>"Error in conv2D: Strides should be larger than 0.");const p={x:u,filter:l},x={strides:n,pad:s,dataFormat:o,dilations:r,dimRoundingMode:i},b=W.runKernel(Qp,p,x);return d?ee(b,[b.shape[1],b.shape[2],b.shape[3]]):b}const Vi=K({conv2d_:Fle});function Ole(t,e,n,s,o="NWC",r=1,i){const a=V(t,"x","conv1d"),l=V(e,"filter","conv1d");let u=a,d=!1;a.rank===2&&(d=!0,u=ee(a,[1,a.shape[0],a.shape[1]])),L(u.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${u.rank}.`),L(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),Os("conv1d",s,i),L(u.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${u.shape[2]}) must match input depth for filter ${l.shape[1]}.`),L(fs(n,r),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${r}'`),L(su(r),()=>"Error in conv1D: Dilated rates should be larger than 0."),L(su(n),()=>"Error in conv1D: Stride should be larger than 0."),L(o==="NWC",()=>`Error in conv1d: got dataFormat of ${o} but only NWC is currently supported.`);const h=ee(l,[1,l.shape[0],l.shape[1],l.shape[2]]),p=ee(u,[u.shape[0],1,u.shape[1],u.shape[2]]),C=Vi(p,h,[1,n],s,"NHWC",[1,r],i);return d?ee(C,[C.shape[2],C.shape[3]]):ee(C,[C.shape[0],C.shape[2],C.shape[3]])}const qv=K({conv1d_:Ole});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ple(t,e,n,s,o,r="NHWC",i){L(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let a=t,l=e,u=!1;e.rank===3&&(u=!0,l=ee(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),L(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),L(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),L(n.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`);const d=r==="NHWC"?a[3]:a[1],h=r==="NHWC"?l.shape[3]:l.shape[1];L(d===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${d}) must match input depth for filter ${n.shape[2]}.`),L(h===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${h}) must match output depth for filter ${n.shape[3]}.`),Os("conv2dDerInput",o,i);const p={dy:l,filter:n},x={strides:s,pad:o,dataFormat:r,dimRoundingMode:i,inputShape:a},b=W.runKernel(em,p,x);return u?ee(b,[b.shape[1],b.shape[2],b.shape[3]]):b}const SE=K({conv2DBackpropInput_:Ple});function Lle(t,e,n,s,o,r){const i=V(t,"x","conv2dTranspose"),a=V(e,"filter","conv2dTranspose");return SE(n,i,a,s,o,"NHWC",r)}const Kv=K({conv2dTranspose_:Lle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vle(t,e,n,s,o="NDHWC",r=[1,1,1]){const i=V(t,"x","conv3d"),a=V(e,"filter","conv3d");let l=i,u=!1;i.rank===4&&(u=!0,l=ee(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),L(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),L(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),L(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),L(fs(n,r),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${r}'`),L(o==="NDHWC",()=>`Error in conv3d: got dataFormat of ${o} but only NDHWC is currently supported.`),L(su(r),()=>"Error in conv3D: Dilated rates should be larger than 0."),L(su(n),()=>"Error in conv3D: Strides should be larger than 0.");const d={x:l,filter:a},h={strides:n,pad:s,dataFormat:o,dilations:r},p=W.runKernel(tm,d,h);return u?ee(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const NE=K({conv3d_:Vle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zle(t,e,n,s,o){L(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let r=t,i=e,a=!1;e.rank===4&&(a=!0,i=ee(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),r=[1,t[0],t[1],t[2],t[3]]);const l=r[4],u=i.shape[4];L(r.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${r.length}.`),L(i.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${i.rank}`),L(n.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`),L(l===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[3]}.`),L(u===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${u}) must match output depth for filter ${n.shape[4]}.`);const d={dy:i,filter:n},h={pad:o,strides:s,inputShape:r},p=W.runKernel(Wx,d,h);return a?ee(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const mz=K({conv3DBackpropInput_:zle});function Ble(t,e,n,s,o){const r=V(t,"x","conv3dTranspose"),i=V(e,"filter","conv3dTranspose");return mz(n,r,i,s,o)}const EE=K({conv3dTranspose_:Ble});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ule(t){const n={x:V(t,"x","cos","float32")};return W.runKernel(Cd,n)}const Jm=K({cos_:Ule});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gle(t){const n={x:V(t,"x","cosh","float32")};return W.runKernel(Td,n)}const Xv=K({cosh_:Gle});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hle(t,e=0,n=!1,s=!1){const r={x:V(t,"x","cumprod")},i={axis:e,exclusive:n,reverse:s};return W.runKernel(qx,r,i)}const Sp=K({cumprod_:Hle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wle(t,e=0,n=!1,s=!1){const r={x:V(t,"x","cumsum")},i={axis:e,exclusive:n,reverse:s};return W.runKernel(nm,r,i)}const Yv=K({cumsum_:Wle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qle(t,e,n,s=!1){const o=V(t,"x","denseBincount"),r=V(e,"weights","denseBincount");L(o.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${o.dtype}`),L(o.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${o.rank}.`),L(n>=0,()=>`size must be non-negative, but got ${n}.`),L(r.size===o.size||r.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${o.shape}, weights shape: ${r.shape}.`);const i={x:o,weights:r},a={size:n,binaryOutput:s};return W.runKernel(Xx,i,a)}const Z0=K({denseBincount_:qle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kle(t,e,n="NHWC"){const s=V(t,"x","depthToSpace","float32"),o=n==="NHWC"?s.shape[1]:s.shape[2],r=n==="NHWC"?s.shape[2]:s.shape[3],i=n==="NHWC"?s.shape[3]:s.shape[1];L(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),L(o*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${e}  for depthToSpace with input shape
    ${s.shape}`),L(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e} for depthToSpace with input shape
        ${s.shape}`),L(i%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${i} for depthToSpace with input shape ${s.shape}`);const a={x:s},l={blockSize:e,dataFormat:n};return W.runKernel(Yx,a,l)}const IE=K({depthToSpace_:Kle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xle(t,e,n,s,o="NHWC",r=[1,1],i){const a=V(t,"x","depthwiseConv2d","float32"),l=V(e,"filter","depthwiseConv2d","float32");let u=a,d=!1;a.rank===3&&(d=!0,u=ee(a,[1,a.shape[0],a.shape[1],a.shape[2]])),L(u.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${u.rank}.`),L(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const h=o==="NHWC"?u.shape[3]:u.shape[1];L(h===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${h}) must match the inChannels dimension in filter ${l.shape[2]}.`),Os("depthwiseConv2d",s,i);const p={x:u,filter:l},x={strides:n,pad:s,dataFormat:o,dilations:r,dimRoundingMode:i},b=W.runKernel(sm,p,x);return d?ee(b,[b.shape[1],b.shape[2],b.shape[3]]):b}const uf=K({depthwiseConv2d_:Xle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yle(t){const n={x:V(t,"x","diag")};return W.runKernel(Zx,n)}const gz=K({diag_:Yle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jle(t,e,n,s,o=[1,1],r="NHWC"){const i=V(t,"x","dilation2d"),a=V(e,"filter","dilation2d");L(i.rank===3||i.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`),L(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),L(r==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${r}`);let l=i,u=!1;i.rank===3&&(l=ee(i,[1,i.shape[0],i.shape[1],i.shape[2]]),u=!0),L(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);const d={x:l,filter:a},h={strides:n,pad:s,dilations:o},p=W.runKernel(om,d,h);return u?ee(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const kE=K({dilation2d_:Jle});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ou(t,e){const n=t.length,s=[];for(let o=0;o<n;o++){const r=n-1-o,i=t[r]||1;(e[e.length-1-o]||1)>1&&i===1&&s.unshift(r)}return s}function kn(t,e){const n=[];for(let s=0;s<e.length;s++){const o=t[t.length-s-1],r=e.length-s-1,i=e[r];(o==null||o===1&&i>1)&&n.unshift(r)}return n}function Ze(t,e){const n=Math.max(t.length,e.length),s=new Array(n);for(let o=0;o<n;o++){let r=t[t.length-o-1];r==null&&(r=1);let i=e[e.length-o-1];if(i==null&&(i=1),r===1)s[n-o-1]=i;else if(i===1)s[n-o-1]=r;else if(r!==i){const a=`Operands could not be broadcast together with shapes ${t} and ${e}.`;throw Error(a)}else s[n-o-1]=r}return s}const jle=Object.freeze(Object.defineProperty({__proto__:null,assertAndGetBroadcastShape:Ze,getBroadcastDims:ou,getReductionAxes:kn},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zle(t,e){let n=V(t,"a","equal","string_or_numeric"),s=V(e,"b","equal","string_or_numeric");[n,s]=on(n,s),Ze(n.shape,s.shape);const o={a:n,b:s};return W.runKernel(rm,o)}const co=K({equal_:Zle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qle(t,e,n){const s=V(e,"a","where"),o=V(n,"b","where"),r=V(t,"condition","where","bool"),i=Ze(Ze(r.shape,s.shape),o.shape),a=Kl(r,i),l=Kl(s,i),u=Kl(o,i),d={condition:a,t:l,e:u};return W.runKernel(Fm,d)}const Kn=K({where_:Qle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eue(t){const n={x:V(t,"x","zerosLike")};return W.runKernel(Hm,n)}const gt=K({zerosLike_:eue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tue(t,e){let n=V(t,"a","div"),s=V(e,"b","div");[n,s]=on(n,s);const o=Pe(n,s),r=gt(o),i=co(s,r);return Kn(i,r,o)}const AE=K({divNoNan_:tue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nue(t,e){const n=V(t,"t1","dot"),s=V(e,"t2","dot");L((n.rank===1||n.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${s.rank}.`);const o=n.rank===1?n.size:n.shape[1],r=s.rank===1?s.size:s.shape[0];if(L(o===r,()=>`Error in dot: inner dimensions of inputs must match, but got ${o} and ${r}.`),n.rank===1&&s.rank===1){const i=ee(n,[1,-1]),a=ee(s,[-1,1]),l=st(i,a);return ee(l,[])}else if(n.rank===1&&s.rank===2){const i=ee(n,[1,-1]),a=ee(s,[s.shape[0],s.shape[1]]),l=st(i,a);return ee(l,[l.size])}else if(n.rank===2&&s.rank===1){const i=ee(s,[-1,1]),a=st(n,i);return ee(a,[a.size])}else{const i=ee(s,[s.shape[0],s.shape[1]]);return st(n,i)}}const RE=K({dot_:nue});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sue(t,...e){const n=e.map((o,r)=>V(o,`tensors${r}`,"einsum")),s={equation:t};return W.runKernel(ev,n,s)}const Fl=K({einsum_:sue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oue(t){const n={x:V(t,"x","elu","float32")};return W.runKernel(Nd,n)}const cf=K({elu_:oue});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rue(t,e){const n=V(t,"x","ensureShape","string_or_numeric");if(!NV(n.shape,e))throw new Error(`EnsureShape: Shape of tensor ${n.shape} is not compatible with expected shape ${e}`);return t}const yz=K({ensureShape_:rue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iue(t){let e=V(t,"x","erf");L(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=Ne(e,"float32"));const n={x:e};return W.runKernel(Ed,n)}const Jv=K({erf_:iue});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $E(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function xz(t,e,n){const s=t.length+e.length,o=[];let r=0,i=0;for(let a=0;a<s;a++)n.indexOf(a)===-1?o.push(t[r++]):o.push(e[i++]);return o}function Zn(t,e){const n=[],s=t.length;for(let r=0;r<s;r++)e.indexOf(r)===-1&&n.push(t[r]);const o=e.map(r=>t[r]);return[n,o]}function gn(t,e){const n=e.map(s=>1);return xz(t,n,e)}function hs(t,e,n){L($E(e,n),()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`)}function rn(t,e){if($E(t,e))return null;const n=[];for(let s=0;s<e;++s)t.indexOf(s)===-1&&n.push(s);return t.forEach(s=>n.push(s)),n}function nl(t){return t.map((e,n)=>[n,e]).sort((e,n)=>e[1]-n[1]).map(e=>e[0])}function yn(t,e){const n=[];for(let s=e-t;s<e;++s)n.push(s);return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aue(t,e=null,n=!1){const o={x:V(t,"x","max")},r={reductionIndices:e,keepDims:n};return W.runKernel(ym,o,r)}const Do=K({max_:aue});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lue(t,e=null,n=!1){const o={x:V(t,"x","min")},r={axis:e,keepDims:n};return W.runKernel(wm,o,r)}const Wc=K({min_:lue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uue(t,e){let n=V(t,"base","pow"),s=V(e,"exp","pow");[n,s]=on(n,s);const o={a:n,b:s};return W.runKernel(Ud,o)}const si=K({pow_:uue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Be(t,e){if((Mn(t)&&e!=="string"||Array.isArray(t))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Mn(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return el(t,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cue(t){const n={x:V(t,"x","sqrt","float32")};return W.runKernel(ef,n)}const Yn=K({sqrt_:cue});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function due(t){const e=V(t,"x","square"),n={};return W.runKernel("Square",{x:e},n)}const Ot=K({square_:due});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fue(t,e=null,n=!1){let s=V(t,"x","sum");s.dtype==="bool"&&(s=Ne(s,"int32"));const o={x:s},r={axis:e,keepDims:n};return W.runKernel(Pm,o,r)}const _e=K({sum_:fue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hue(t,e="euclidean",n=null,s=!1){t=V(t,"x","norm");const o=vz(t,e,n);let r=o.shape;if(s){const i=ot(n,t.shape);r=gn(o.shape,i)}return ee(o,r)}function vz(t,e,n=null){if(t.rank===0)return Sn(t);if(t.rank!==1&&n===null)return vz(ee(t,[-1]),e,n);if(t.rank===1||typeof n=="number"||Array.isArray(n)&&n.length===1){if(e===1)return _e(Sn(t),n);if(e===1/0)return Do(Sn(t),n);if(e===-1/0)return Wc(Sn(t),n);if(e==="euclidean"||e===2)return Yn(_e(si(Sn(t),Be(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&n.length===2){if(e===1)return Do(_e(Sn(t),n[0]),n[1]-1);if(e===1/0)return Do(_e(Sn(t),n[1]),n[0]);if(e===-1/0)return Wc(_e(Sn(t),n[1]),n[0]);if(e==="fro"||e==="euclidean")return Yn(_e(Ot(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const df=K({norm_:hue});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pue(t,e=null,n=!1){return df(t,"euclidean",e,n)}const DE=K({euclideanNorm_:pue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mue(t){const n={x:V(t,"x","exp")};return W.runKernel(Id,n)}const Xs=K({exp_:mue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gue(t,e=0){const n=V(t,"x","expandDims","string_or_numeric");L(e<=n.rank,()=>"Axis must be <= rank of the tensor");const s={input:n},o={dim:e};return W.runKernel(im,s,o)}const rs=K({expandDims_:gue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yue(t){const n={x:V(t,"x","expm1")};return W.runKernel(kd,n)}const _E=K({expm1_:yue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xue(t,e){const n=V(t,"x","tile","string_or_numeric");L(n.rank===e.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`);const s={x:n},o={reps:e};return W.runKernel(rf,s,o)}const ko=K({tile_:xue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vue(t,e,n,s="float32"){e==null&&(e=t);const o=et([t,e],s),r=t<=e?t:e;for(let a=0;a<r;++a)o.set(1,a,a);const i=ee(o.toTensor(),[t,e]);if(n==null)return i;if(n.length===1)return ko(rs(i,0),[n[0],1,1]);if(n.length===2)return ko(rs(rs(i,0),0),[n[0],n[1],1,1]);if(n.length===3)return ko(rs(rs(rs(i,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}const jv=K({eye_:vue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bue(t){const n={x:V(t,"x","floor","float32")};return W.runKernel(Ad,n)}const ff=K({floor_:bue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wue(t,e,n=0,s=0){const o=V(t,"x","gather"),r=V(e,"indices","gather","int32"),i={x:o,indices:r},a={axis:n,batchDims:s};return W.runKernel(lm,i,a)}const hf=K({gather_:wue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cue(t,e){let n=V(t,"a","greater","string_or_numeric"),s=V(e,"b","greater","string_or_numeric");[n,s]=on(n,s),Ze(n.shape,s.shape);const o={a:n,b:s};return W.runKernel(um,o)}const Ps=K({greater_:Cue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tue(t,e){let n=V(t,"a","greaterEqual","string_or_numeric"),s=V(e,"b","greaterEqual","string_or_numeric");[n,s]=on(n,s),Ze(n.shape,s.shape);const o={a:n,b:s};return W.runKernel($d,o)}const Ki=K({greaterEqual_:Tue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sue(t){const n={input:V(t,"input","imag")};return W.runKernel(av,n)}const jm=K({imag_:Sue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nue(t){const n={x:V(t,"x","isFinite")};return W.runKernel(_d,n)}const ME=K({isFinite_:Nue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eue(t){const n={x:V(t,"x","isInf")};return W.runKernel(Md,n)}const FE=K({isInf_:Eue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iue(t){const n={x:V(t,"x","isNaN")};return W.runKernel(Fd,n)}const OE=K({isNaN_:Iue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kue(t,e=.2){const s={x:V(t,"x","leakyRelu")},o={alpha:e};return W.runKernel(cm,s,o)}const Zm=K({leakyRelu_:kue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aue(t,e){let n=V(t,"a","less","string_or_numeric"),s=V(e,"b","less","string_or_numeric");[n,s]=on(n,s),Ze(n.shape,s.shape);const o={a:n,b:s};return W.runKernel(dm,o)}const qc=K({less_:Aue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rue(t,e){let n=V(t,"a","lessEqual","string_or_numeric"),s=V(e,"b","lessEqual","string_or_numeric");[n,s]=on(n,s),Ze(n.shape,s.shape);const o={a:n,b:s};return W.runKernel(fm,o)}const sl=K({lessEqual_:Rue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bz(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");const s={start:t,stop:e,num:n};return W.runKernel(lv,{},s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ue(t,e=5,n=1,s=1,o=.5){const r=V(t,"x","localResponseNormalization");L(r.rank===4||r.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${r.rank}.`),L(Zl(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let i=r,a=!1;r.rank===3&&(a=!0,i=ee(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const l={x:i},u={depthRadius:e,bias:n,alpha:s,beta:o},d=W.runKernel(gm,l,u);return a?ee(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const PE=K({localResponseNormalization_:$ue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Due(t){const n={x:V(t,"x","log","float32")};return W.runKernel(Od,n)}const fo=K({log_:Due});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ue(t){const n={x:V(t,"x","log1p")};return W.runKernel(Pd,n)}const Qm=K({log1p_:_ue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mue(t){return L(Ba(t),()=>"The f passed in grad(f) must be a function"),(e,n)=>{const s=V(e,"x","tf.grad","string_or_numeric"),o=n!=null?V(n,"dy","tf.grad"):null;return W.tidy(()=>{const{value:r,grads:i}=W.gradients(()=>t(s),[s],o);return o!=null&&ds(r.shape,o.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),Zv(i),i[0]})}}function Fue(t){return L(Ba(t),()=>"The f passed in grads(f) must be a function"),(e,n)=>{L(Array.isArray(e),()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s");const s=bp(e,"args","tf.grads","string_or_numeric"),o=n!=null?V(n,"dy","tf.grads"):null;return W.tidy(()=>{const{value:r,grads:i}=W.gradients(()=>t(...s),s,o);return o!=null&&ds(r.shape,o.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Zv(i),i})}}function Oue(t){return L(Ba(t),()=>"The f passed in valueAndGrad(f) must be a function"),(e,n)=>{L(e instanceof yt,()=>"The x passed in valueAndGrad(f)(x) must be a tensor"),L(n==null||n instanceof yt,()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");const{grads:s,value:o}=W.gradients(()=>t(e),[e],n);return Zv(s),{grad:s[0],value:o}}}function Pue(t){return L(Ba(t),()=>"The f passed in valueAndGrads(f) must be a function"),(e,n)=>{L(Array.isArray(e)&&e.every(o=>o instanceof yt),()=>"The args passed in valueAndGrads(f)(args) must be array of tensors"),L(n==null||n instanceof yt,()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");const s=W.gradients(()=>t(...e),e,n);return n!=null&&ds(s.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Zv(s.grads),s}}function wz(t,e){L(Ba(t),()=>"The f passed in variableGrads(f) must be a function"),L(e==null||Array.isArray(e)&&e.every(u=>u instanceof vp),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const n=e!=null;if(!n){e=[];for(const u in W.registeredVariables)e.push(W.registeredVariables[u])}const s=n?e.filter(u=>!u.trainable):null,o=e.length;e=e.filter(u=>u.trainable),L(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${o} variables is trainable.`);const r=!0,{value:i,grads:a}=W.gradients(t,e,null,r);L(a.some(u=>u!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),L(i.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${i.rank} tensor`);const l={};return e.forEach((u,d)=>{a[d]!=null&&(l[u.name]=a[d])}),s!=null&&s.forEach(u=>l[u.name]=null),{value:i,grads:l}}function oi(t){return W.customGrad(t)}function Zv(t){if(t.filter(n=>n==null).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lue(t){const n={x:V(t,"x","neg")};return W.runKernel(Tm,n)}const Ht=K({neg_:Lue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vue(t){const n={x:V(t,"x","softplus")};return W.runKernel(Qd,n)}const Tu=K({softplus_:Vue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zue(t){const e=V(t,"x","logSigmoid");return oi(s=>({value:Ht(Tu(Ht(s))),gradFunc:i=>j(i,br(Ht(s)))}))(e)}const LE=K({logSigmoid_:zue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bue(t,e){let n=V(t,"a","sub"),s=V(e,"b","sub");[n,s]=on(n,s);const o={a:n,b:s};return W.runKernel(nf,o)}const $e=K({sub_:Bue});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uue(t,e=-1){const n=V(t,"logits","logSoftmax");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);return oi((o,r)=>{const a=Do(o,e,!0),l=$e(o,a),u=$e(Ne(l,"float32"),fo(_e(Xs(l),e,!0)));return r([u]),{value:u,gradFunc:(h,p)=>{const[x]=p,b=!0,w=Xs(x);return $e(h,j(_e(h,e,b),w))}}})(n)}const Qv=K({logSoftmax_:Uue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gue(t,e=null,n=!1){const s=V(t,"x","logSumExp"),o=ot(e,s.shape),r=Do(s,o,!0),i=$e(s,r),a=Xs(i),l=_e(a,o),u=fo(l),d=Te(ee(r,u.shape),u);if(n){const h=gn(d.shape,o);return ee(d,h)}return d}const eg=K({logSumExp_:Gue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hue(t,e){const n=V(t,"a","logicalAnd","bool"),s=V(e,"b","logicalAnd","bool");Ze(n.shape,s.shape);const o={a:n,b:s};return W.runKernel(hm,o)}const nr=K({logicalAnd_:Hue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wue(t){const n={x:V(t,"x","logicalNot","bool")};return W.runKernel(pm,n)}const tg=K({logicalNot_:Wue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function que(t,e){const n=V(t,"a","logicalOr","bool"),s=V(e,"b","logicalOr","bool");Ze(n.shape,s.shape);const o={a:n,b:s};return W.runKernel(mm,o)}const eb=K({logicalOr_:que});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kue(t,e){const n=V(t,"a","logicalXor","bool"),s=V(e,"b","logicalXor","bool");return Ze(n.shape,s.shape),nr(eb(t,e),tg(nr(t,e)))}const VE=K({logicalXor_:Kue});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jy=2147483648;function Xue(t,e,n="left"){const s=V(t,"sortedSequence","searchSorted"),o=V(e,"values","searchSorted"),r=s.shape[s.shape.length-1],i=o.shape[o.shape.length-1],a=ee(s,[-1,r]),l=ee(o,[-1,i]);if(a.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(a.shape[0]!==l.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(me(l.shape)>=Jy)throw new Error(`values tensor size must less than ${Jy}`);if(a.shape[1]>=Jy)throw new Error(`trailing dim_size must less than ${Jy} for int32 output type, was ${a.shape[1]}`);const u={sortedSequence:a,values:l},d={side:n};return W.runKernel(Ev,u,d)}const tb=K({searchSorted_:Xue});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cz(t,e){return tb(t,e,"left")}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yue(t,e,n,s,o){const r=V(t,"x","maxPool"),i=1;let a=r,l=!1;r.rank===3&&(l=!0,a=ee(r,[1,r.shape[0],r.shape[1],r.shape[2]])),L(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),L(fs(n,i),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`),Os("maxPool",s,o);const u={x:a},d={filterSize:e,strides:n,pad:s,dimRoundingMode:o},h=W.runKernel(xm,u,d);return l?ee(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const ng=K({maxPool_:Yue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jue(t,e=[1,1,1],n,s,o,r="NDHWC"){const i=V(t,"x","maxPool3d");let a=i,l=!1;i.rank===4&&(l=!0,a=ee(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),L(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),L(r==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${r}`),Os("maxPool3d",s,o);const u={x:a},d={filterSize:e,strides:n,pad:s,dimRoundingMode:o,dataFormat:r},h=W.runKernel(vm,u,d);return l?ee(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const zE=K({maxPool3d_:Jue});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jue(t,e,n,s,o=!1){const i={x:V(t,"x","maxPoolWithArgmax")},a={filterSize:e,strides:n,pad:s,includeBatchInIndex:o},l=W.runKernel(fv,i,a);return{result:l[0],indexes:l[1]}}const Tz=K({maxPoolWithArgmax_:jue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zue(t,e){let n=V(t,"a","maximum"),s=V(e,"b","maximum");[n,s]=on(n,s),n.dtype==="bool"&&(n=Ne(n,"int32"),s=Ne(s,"int32")),Ze(n.shape,s.shape);const o={a:n,b:s};return W.runKernel(Ld,o)}const ii=K({maximum_:Zue});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Que(t,e=null,n=!1){const o={x:V(t,"x","mean")},r={axis:e,keepDims:n};return W.runKernel(bm,o,r)}const tn=K({mean_:Que});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nn(t,e="float32"){if(mo(t),e==="complex64"){const s=Nn(t,"float32"),o=Nn(t,"float32");return Li(s,o)}const n=cs(me(t),e);return W.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gs(t,e="float32"){if(mo(t),e==="complex64"){const s=Gs(t,"float32"),o=Nn(t,"float32");return Li(s,o)}const n=Fx(me(t),e);return W.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sz(t,e,{indexing:n="xy"}={}){if(n!=="xy"&&n!=="ij")throw new TypeError(`${n} is not a valid third argument to meshgrid`);if(t===void 0)return[];let s=V(t,"x","meshgrid",t instanceof yt?t.dtype:"float32");if(e===void 0)return[s];let o=V(e,"y","meshgrid",e instanceof yt?e.dtype:"float32");const r=me(s.shape),i=me(o.shape);return n==="xy"?(s=ee(s,[1,-1]),o=ee(o,[-1,1]),[st(Gs([i,1],s.dtype),s),st(o,Gs([1,r],o.dtype))]):(s=ee(s,[-1,1]),o=ee(o,[1,-1]),[st(s,Gs([1,i],s.dtype)),st(Gs([r,1],o.dtype),o)])}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ece(t,e){let n=V(t,"a","minimum"),s=V(e,"b","minimum");[n,s]=on(n,s),n.dtype==="bool"&&(n=Ne(n,"int32"),s=Ne(s,"int32")),Ze(n.shape,s.shape);const o={a:n,b:s};return W.runKernel(Vd,o)}const Wa=K({minimum_:ece});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tce(t,e,n){L(n==="reflect"||n==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`);const s=V(t,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");L(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const o=n==="reflect"?1:0;for(let a=0;a<s.rank;a++)L(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),L(e[a][0]>=0&&e[a][0]<=s.shape[a]-o&&e[a][1]>=0&&e[a][1]<=s.shape[a]-o,()=>`Padding in dimension ${a} cannot be greater than or equal to ${s.shape[a]-o} or less than 0 for input of shape ${s.shape}`);const r={paddings:e,mode:n},i={x:s};return W.runKernel(Cm,i,r)}const BE=K({mirrorPad_:tce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nce(t,e){let n=V(t,"a","mod"),s=V(e,"b","mod");[n,s]=on(n,s);const o={a:n,b:s};return W.runKernel(zd,o)}const UE=K({mod_:nce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sce(t,e=null,n=!1){t=V(t,"x","moments");const s=ot(e,t.shape),o=tn(t,s,n);let r=o.shape;n||(r=gn(o.shape,s));const i=Ot($e(Ne(t,"float32"),ee(o,r))),a=tn(i,s,n);return{mean:o,variance:a}}const sg=K({moments_:sce});function oce(t,e,n,s){const o=V(e,"data","multiRNNCell"),r=bp(n,"c","multiRNNCell"),i=bp(s,"h","multiRNNCell");let a=o;const l=[];for(let h=0;h<t.length;h++){const p=t[h](a,r[h],i[h]);l.push(p[0]),l.push(p[1]),a=p[1]}const u=[],d=[];for(let h=0;h<l.length;h+=2)u.push(l[h]),d.push(l[h+1]);return[u,d]}const Nz=K({multiRNNCell_:oce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rce(t,e,n,s=!1){const o=V(t,"logits","multinomial"),r=o.size,i=o.rank;if(r<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${r}.`);if(i>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${i}`);n=n||Math.random();const l={logits:i===1?ee(o,[1,-1]):o},u={numSamples:e,seed:n,normalized:s},d=W.runKernel(hv,l,u);return i===1?ee(d,[d.size]):d}const Ez=K({multinomial_:rce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ice(t,e){let n=V(t,"a","notEqual","string_or_numeric"),s=V(e,"b","notEqual","string_or_numeric");[n,s]=on(n,s),Ze(n.shape,s.shape);const o={a:n,b:s};return W.runKernel(Sm,o)}const ru=K({notEqual_:ice});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ace(t,e,n=1,s=0,o="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const i={indices:V(t,"indices","oneHot","int32")},a={dtype:o,depth:e,onValue:n,offValue:s};return W.runKernel(Em,i,a)}const Kc=K({oneHot_:ace});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lce(t){const n={x:V(t,"x","onesLike")};return W.runKernel(Nm,n)}const ho=K({onesLike_:lce});function uce(t,e){const n=V(t,"v1","outerProduct"),s=V(e,"v2","outerProduct");L(n.rank===1&&s.rank===1,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${s.rank}.`);const o=ee(n,[-1,1]),r=ee(s,[1,-1]);return st(o,r)}const Iz=K({outerProduct_:uce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cce(t,e,n=0){const s=V(t,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const o={paddings:e,constantValue:n},r={x:s};return W.runKernel(km,r,o)}const Xi=K({pad_:cce});function dce(t,e,n=0){return L(e.length===2,()=>"Invalid number of paddings. Must be length of 2."),Xi(t,[e],n)}const kz=K({pad1d_:dce});function fce(t,e,n=0){return L(e.length===2&&e[0].length===2&&e[1].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Xi(t,e,n)}const Az=K({pad2d_:fce});function hce(t,e,n=0){return L(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Xi(t,e,n)}const Rz=K({pad3d_:hce});function pce(t,e,n=0){return L(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Xi(t,e,n)}const $z=K({pad4d_:pce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mce(t,e,n){const s=V(t,"x","spaceToBatchND");L(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),L(n.length===e.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`),L(s.shape.reduce((i,a,l)=>l>0&&l<=e.length?i&&(a+n[l-1][0]+n[l-1][1])%e[l-1]===0:i,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`);const o={x:s},r={blockShape:e,paddings:n};return W.runKernel(Lm,o,r)}const og=K({spaceToBatchND_:mce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gce(t,e,n,s,o,r,i){o==null&&(o=[1,1]),r==null&&(r=1),s===0&&(s="valid");const a=V(t,"x","maxPool");let l=a,u=!1;a.rank===3&&(u=!0,l=ee(a,[1,a.shape[0],a.shape[1],a.shape[2]])),L(fs(r,o),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${r} and dilations '${o}'`);const d=sr(l.shape,e,r,o,s),h=[d.dilationHeight,d.dilationWidth];let p;s==="same"?p=xce([d.filterHeight,d.filterWidth],h):p=[[0,0],[0,0]];const x=h[0]===1&&h[1]===1,[b,w]=yce([d.inHeight,d.inWidth],h,p),C=x?s:"valid",T=x?l:og(l,h,b),I=(n==="avg"?()=>Xm(T,e,r,C,i):()=>ng(T,e,r,C,i))(),k=x?I:Ym(I,h,w);return u?ee(k,[k.shape[1],k.shape[2],k.shape[3]]):k}function yce(t,e,n){const s=n.map(d=>d[0]),o=n.map(d=>d[1]),r=t.concat(s,o),i=e.map((d,h)=>(d-r[h]%d)%d),a=o.map((d,h)=>d+i[h]),l=e.map((d,h)=>[s[h],a[h]]),u=e.map((d,h)=>[0,i[h]]);return[l,u]}function xce(t,e){const s=t.map((i,a)=>i+(i-1)*(e[a]-1)).map(i=>i-1),o=s.map(i=>Math.floor(i/2)),r=s.map((i,a)=>i-o[a]);return s.map((i,a)=>[o[a],r[a]])}const GE=K({pool_:gce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vce(t,e){const n=V(t,"x","prelu"),s=V(e,"alpha","prelu"),o={x:n,alpha:s};return W.runKernel(Am,o)}const rg=K({prelu_:vce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bce(t,e=null,n=!1){let s=V(t,"x","prod");s.dtype==="bool"&&(s=Ne(s,"int32"));const o={x:s},r={axis:e,keepDims:n};return W.runKernel(Rm,o,r)}const HE=K({prod_:bce});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wce(t,e,n,s){const o=t.map((d,h)=>V(d,`tensors${h}`,"raggedGather","int32")),r=V(e,"paramsDenseValues","raggedGather"),i=V(n,"indices","raggedGather","int32"),a={paramsNestedSplits:o,paramsDenseValues:r,indices:i},l={outputRaggedRank:s},u=W.runKernel(yv,a,l);return{outputNestedSplits:u.slice(0,u.length-1),outputDenseValues:u[u.length-1]}}const Dz=K({raggedGather_:wce});/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cce(t,e,n){const s=V(t,"starts","raggedRange"),o=V(e,"limits","raggedRange",s.dtype),r=V(n,"deltas","raggedRange",s.dtype),i={starts:s,limits:o,deltas:r},a=W.runKernel(xv,i);return{rtNestedSplits:a[0],rtDenseValues:a[1]}}const _z=K({raggedRange_:Cce});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tce(t,e,n,s,o){const r=V(t,"shape","raggedTensorToTensor","int32"),i=V(e,"values","raggedTensorToTensor"),a=V(n,"defaultValue","raggedTensorToTensor",i.dtype),l=s.map((h,p)=>V(h,`tensors${p}`,"raggedTensorToTensor","int32")),u={shape:r,values:i,defaultValue:a,rowPartitionTensors:l},d={rowPartitionTypes:o};return W.runKernel(vv,u,d)}const Mz=K({raggedTensorToTensor_:Tce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sce(t,e,n){mo(t);const s=me(t);let o=null;if(n==null||n==="float32")o=new Float32Array(s);else if(n==="int32")o=new Int32Array(s);else if(n==="bool")o=new Uint8Array(s);else throw new Error(`Unknown data type ${n}`);for(let r=0;r<s;r++)o[r]=e();return W.makeTensor(o,t,n)}const Fz=K({rand_:Sce});var b0={exports:{}},Nce=b0.exports,jF;function Ece(){return jF||(jF=1,(function(t){(function(e,n,s){function o(l){var u=this,d=a();u.next=function(){var h=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=h-(u.c=h|0)},u.c=1,u.s0=d(" "),u.s1=d(" "),u.s2=d(" "),u.s0-=d(l),u.s0<0&&(u.s0+=1),u.s1-=d(l),u.s1<0&&(u.s1+=1),u.s2-=d(l),u.s2<0&&(u.s2+=1),d=null}function r(l,u){return u.c=l.c,u.s0=l.s0,u.s1=l.s1,u.s2=l.s2,u}function i(l,u){var d=new o(l),h=u&&u.state,p=d.next;return p.int32=function(){return d.next()*4294967296|0},p.double=function(){return p()+(p()*2097152|0)*11102230246251565e-32},p.quick=p,h&&(typeof h=="object"&&r(h,d),p.state=function(){return r(d,{})}),p}function a(){var l=4022871197,u=function(d){d=String(d);for(var h=0;h<d.length;h++){l+=d.charCodeAt(h);var p=.02519603282416938*l;l=p>>>0,p-=l,p*=l,l=p>>>0,p-=l,l+=p*4294967296}return(l>>>0)*23283064365386963e-26};return u}n&&n.exports?n.exports=i:this.alea=i})(Nce,t)})(b0)),b0.exports}var w0={exports:{}},Ice=w0.exports,ZF;function kce(){return ZF||(ZF=1,(function(t){(function(e,n,s){function o(a){var l=this,u="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var h=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^h^h>>>8},a===(a|0)?l.x=a:u+=a;for(var d=0;d<u.length+64;d++)l.x^=u.charCodeAt(d)|0,l.next()}function r(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function i(a,l){var u=new o(a),d=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var p=u.next()>>>11,x=(u.next()>>>0)/4294967296,b=(p+x)/(1<<21);while(b===0);return b},h.int32=u.next,h.quick=h,d&&(typeof d=="object"&&r(d,u),h.state=function(){return r(u,{})}),h}n&&n.exports?n.exports=i:this.xor128=i})(Ice,t)})(w0)),w0.exports}var C0={exports:{}},Ace=C0.exports,QF;function Rce(){return QF||(QF=1,(function(t){(function(e,n,s){function o(a){var l=this,u="";l.next=function(){var h=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(h^h<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:u+=a;for(var d=0;d<u.length+64;d++)l.x^=u.charCodeAt(d)|0,d==u.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function r(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function i(a,l){var u=new o(a),d=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var p=u.next()>>>11,x=(u.next()>>>0)/4294967296,b=(p+x)/(1<<21);while(b===0);return b},h.int32=u.next,h.quick=h,d&&(typeof d=="object"&&r(d,u),h.state=function(){return r(u,{})}),h}n&&n.exports?n.exports=i:this.xorwow=i})(Ace,t)})(C0)),C0.exports}var T0={exports:{}},$ce=T0.exports,eO;function Dce(){return eO||(eO=1,(function(t){(function(e,n,s){function o(a){var l=this;l.next=function(){var d=l.x,h=l.i,p,x;return p=d[h],p^=p>>>7,x=p^p<<24,p=d[h+1&7],x^=p^p>>>10,p=d[h+3&7],x^=p^p>>>3,p=d[h+4&7],x^=p^p<<7,p=d[h+7&7],p=p^p<<13,x^=p^p<<9,d[h]=x,l.i=h+1&7,x};function u(d,h){var p,x=[];if(h===(h|0))x[0]=h;else for(h=""+h,p=0;p<h.length;++p)x[p&7]=x[p&7]<<15^h.charCodeAt(p)+x[p+1&7]<<13;for(;x.length<8;)x.push(0);for(p=0;p<8&&x[p]===0;++p);for(p==8?x[7]=-1:x[p],d.x=x,d.i=0,p=256;p>0;--p)d.next()}u(l,a)}function r(a,l){return l.x=a.x.slice(),l.i=a.i,l}function i(a,l){a==null&&(a=+new Date);var u=new o(a),d=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var p=u.next()>>>11,x=(u.next()>>>0)/4294967296,b=(p+x)/(1<<21);while(b===0);return b},h.int32=u.next,h.quick=h,d&&(d.x&&r(d,u),h.state=function(){return r(u,{})}),h}n&&n.exports?n.exports=i:this.xorshift7=i})($ce,t)})(T0)),T0.exports}var S0={exports:{}},_ce=S0.exports,tO;function Mce(){return tO||(tO=1,(function(t){(function(e,n,s){function o(a){var l=this;l.next=function(){var d=l.w,h=l.X,p=l.i,x,b;return l.w=d=d+1640531527|0,b=h[p+34&127],x=h[p=p+1&127],b^=b<<13,x^=x<<17,b^=b>>>15,x^=x>>>12,b=h[p]=b^x,l.i=p,b+(d^d>>>16)|0};function u(d,h){var p,x,b,w,C,T=[],N=128;for(h===(h|0)?(x=h,h=null):(h=h+"\0",x=0,N=Math.max(N,h.length)),b=0,w=-32;w<N;++w)h&&(x^=h.charCodeAt((w+32)%h.length)),w===0&&(C=x),x^=x<<10,x^=x>>>15,x^=x<<4,x^=x>>>13,w>=0&&(C=C+1640531527|0,p=T[w&127]^=x+C,b=p==0?b+1:0);for(b>=128&&(T[(h&&h.length||0)&127]=-1),b=127,w=512;w>0;--w)x=T[b+34&127],p=T[b=b+1&127],x^=x<<13,p^=p<<17,x^=x>>>15,p^=p>>>12,T[b]=x^p;d.w=C,d.X=T,d.i=b}u(l,a)}function r(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function i(a,l){a==null&&(a=+new Date);var u=new o(a),d=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var p=u.next()>>>11,x=(u.next()>>>0)/4294967296,b=(p+x)/(1<<21);while(b===0);return b},h.int32=u.next,h.quick=h,d&&(d.X&&r(d,u),h.state=function(){return r(u,{})}),h}n&&n.exports?n.exports=i:this.xor4096=i})(_ce,t)})(S0)),S0.exports}var N0={exports:{}},Fce=N0.exports,nO;function Oce(){return nO||(nO=1,(function(t){(function(e,n,s){function o(a){var l=this,u="";l.next=function(){var h=l.b,p=l.c,x=l.d,b=l.a;return h=h<<25^h>>>7^p,p=p-x|0,x=x<<24^x>>>8^b,b=b-h|0,l.b=h=h<<20^h>>>12^p,l.c=p=p-x|0,l.d=x<<16^p>>>16^b,l.a=b-h|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):u+=a;for(var d=0;d<u.length+20;d++)l.b^=u.charCodeAt(d)|0,l.next()}function r(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function i(a,l){var u=new o(a),d=l&&l.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var p=u.next()>>>11,x=(u.next()>>>0)/4294967296,b=(p+x)/(1<<21);while(b===0);return b},h.int32=u.next,h.quick=h,d&&(typeof d=="object"&&r(d,u),h.state=function(){return r(u,{})}),h}n&&n.exports?n.exports=i:this.tychei=i})(Fce,t)})(N0)),N0.exports}var E0={exports:{}};const Pce={},Lce=Object.freeze(Object.defineProperty({__proto__:null,default:Pce},Symbol.toStringTag,{value:"Module"})),Vce=s5(Lce);var zce=E0.exports,sO;function Bce(){return sO||(sO=1,(function(t){(function(e,n,s){var o=256,r=6,i=52,a="random",l=s.pow(o,r),u=s.pow(2,i),d=u*2,h=o-1,p;function x(k,A,$){var M=[];A=A==!0?{entropy:!0}:A||{};var O=T(C(A.entropy?[k,I(n)]:k??N(),3),M),F=new b(M),P=function(){for(var D=F.g(r),H=l,Z=0;D<u;)D=(D+Z)*o,H*=o,Z=F.g(1);for(;D>=d;)D/=2,H/=2,Z>>>=1;return(D+Z)/H};return P.int32=function(){return F.g(4)|0},P.quick=function(){return F.g(4)/4294967296},P.double=P,T(I(F.S),n),(A.pass||$||function(D,H,Z,ne){return ne&&(ne.S&&w(ne,F),D.state=function(){return w(F,{})}),Z?(s[a]=D,H):D})(P,O,"global"in A?A.global:this==s,A.state)}function b(k){var A,$=k.length,M=this,O=0,F=M.i=M.j=0,P=M.S=[];for($||(k=[$++]);O<o;)P[O]=O++;for(O=0;O<o;O++)P[O]=P[F=h&F+k[O%$]+(A=P[O])],P[F]=A;(M.g=function(D){for(var H,Z=0,ne=M.i,Q=M.j,G=M.S;D--;)H=G[ne=h&ne+1],Z=Z*o+G[h&(G[ne]=G[Q=h&Q+H])+(G[Q]=H)];return M.i=ne,M.j=Q,Z})(o)}function w(k,A){return A.i=k.i,A.j=k.j,A.S=k.S.slice(),A}function C(k,A){var $=[],M=typeof k,O;if(A&&M=="object")for(O in k)try{$.push(C(k[O],A-1))}catch{}return $.length?$:M=="string"?k:k+"\0"}function T(k,A){for(var $=k+"",M,O=0;O<$.length;)A[h&O]=h&(M^=A[h&O]*19)+$.charCodeAt(O++);return I(A)}function N(){try{var k;return p&&(k=p.randomBytes)?k=k(o):(k=new Uint8Array(o),(e.crypto||e.msCrypto).getRandomValues(k)),I(k)}catch{var A=e.navigator,$=A&&A.plugins;return[+new Date,e,$,e.screen,I(n)]}}function I(k){return String.fromCharCode.apply(0,k)}if(T(s.random(),n),t.exports){t.exports=x;try{p=Vce}catch{}}else s["seed"+a]=x})(typeof self<"u"?self:zce,[],Math)})(E0)),E0.exports}var jC,oO;function Uce(){if(oO)return jC;oO=1;var t=Ece(),e=kce(),n=Rce(),s=Dce(),o=Mce(),r=Oce(),i=Bce();return i.alea=t,i.xor128=e,i.xorwow=n,i.xorshift7=s,i.xor4096=o,i.tychei=r,jC=i,jC}var pf=Uce();/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gce=.001,Oz=.1;function Hce(t,e,n){return n==null&&(n=WE()),lS(t,e,(s,o)=>qE(s,o,n))}function WE(){return W.backend.floatPrecision()===32?Gce:Oz}function lS(t,e,n){let s=!0;if((Mn(t)||Mn(e))&&(s=!1),Mn(t)&&Mn(e)&&(s=!0),s){const i=t.constructor.name,a=e.constructor.name;if(i!==a)throw new Error(`Arrays are of different type. Actual: ${i}. Expected: ${a}`)}if(Array.isArray(t)&&Array.isArray(e)){const i=ni(t),a=ni(e);if(!lt(i,a))throw new Error(`Arrays have different shapes. Actual: [${i}]. Expected: [${a}]`)}const o=Mn(t)?t:ti(t),r=Mn(e)?e:ti(e);if(o.length!==r.length)throw new Error(`Arrays have different lengths actual: ${o.length} vs expected: ${r.length}.
Actual:   ${o}.
Expected: ${r}.`);for(let i=0;i<r.length;++i){const a=o[i],l=r[i];if(!n(a,l))throw new Error(`Arrays differ: actual[${i}] = ${a}, expected[${i}] = ${l}.
Actual:   ${o}.
Expected: ${r}.`)}typeof expect<"u"&&expect().nothing()}function Wce(t,e){t().then(()=>e.fail(),()=>e()),typeof expect<"u"&&expect().nothing()}function qce(t,e){const n=typeof e=="string"||typeof e=="number"||typeof e=="boolean"?[e]:e;return Wr(t)||Wr(t[0])||Wr(e)||Wr(e[0])?lS(t,n,(s,o)=>s==o):lS(t,e,(s,o)=>qE(s,o,0))}function Kce(t,e,n){if(n==null&&(n=WE()),!qE(t,e,n))throw new Error(`Numbers differ: actual === ${t}, expected === ${e}`);typeof expect<"u"&&expect().nothing()}function qE(t,e,n){return!isFinite(t)&&!isFinite(e)?!0:!(isNaN(t)||isNaN(e)||Math.abs(t-e)>n)}function Xce(t,e,n){for(let s=0;s<t.length;s++)if(t[s]<e||t[s]>n)throw new Error(`Value out of range:${t[s]} low: ${e}, high: ${n}`)}function Yce(t,e){const n=new Float32Array(t),s=new Float32Array(e);if(n.length!==s.length)throw new Error(`Expected ArrayBuffer to be of length ${s.length}, but it was ${n.length}`);for(let o=0;o<s.length;o++)if(n[o]!==s[o])throw new Error(`Expected ArrayBuffer value at ${o} to be ${s[o]} but got ${n[o]} instead`)}function Pz(t){for(let e=0;e<t.length;e++){const n=t[e];Array.isArray(n)?Pz(n):t[e]=Jr(n)}return t}function Jce(t){const e=document.createElement("video");return"playsInline"in e&&(e.playsInline=!0),e.muted=!0,e.loop=!0,e.style.position="fixed",e.style.left="0px",e.style.top="0px",e.preload="auto",e.appendChild(t),new Promise(n=>{e.addEventListener("loadeddata",s=>n(e)),e.load()})}async function jce(t){await t.play(),"requestVideoFrameCallback"in t&&await new Promise(e=>{t.requestVideoFrameCallback(e)})}const Zce=Object.freeze(Object.defineProperty({__proto__:null,TEST_EPSILON_FLOAT16:Oz,createVideoElement:Jce,encodeStrings:Pz,expectArrayBuffersEqual:Yce,expectArraysClose:Hce,expectArraysEqual:qce,expectNumbersClose:Kce,expectPromiseToFail:Wce,expectValuesInRange:Xce,play:jce,testEpsilon:WE},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KE{constructor(e,n,s,o,r){this.mean=e,this.stdDev=n,this.dtype=s,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const i=r||Math.random();this.random=pf.alea(i.toString())}nextValue(){if(!isNaN(this.nextVal)){const o=this.nextVal;return this.nextVal=NaN,o}let e,n,s=!1;for(;!s;){let o,r,i;do o=2*this.random()-1,r=2*this.random()-1,i=o*o+r*r;while(i>=1||i===0);const a=Math.sqrt(-2*Math.log(i)/i);e=this.mean+this.stdDev*o*a,n=this.mean+this.stdDev*r*a,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class Qce{constructor(e,n,s,o){this.alpha=e,this.beta=1/n,this.dtype=s;const r=o||Math.random();this.randu=pf.alea(r.toString()),this.randn=new KE(0,1,s,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let e,n,s,o,r,i;for(;;){do o=this.randn.nextValue(),i=1+this.c*o;while(i<=0);if(i*=i*i,e=o*o,n=1-.331*e*e,s=.5*e+this.d*(1-i+Math.log(i)),r=this.randu(),r<n||Math.log(r)<s)break}return i=1/this.beta*this.d*i,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)}convertValue(e){return this.dtype==="float32"?e:Math.round(e)}}class ede{constructor(e=0,n=1,s,o){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=n-e,this.dtype=s,o==null&&(o=Math.random()),typeof o=="number"&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${n} <= 1 and dtype is not float`);this.random=pf.alea(o)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tde(t,e,n=1,s="float32",o){if(mo(t),n==null&&(n=1),s==null&&(s="float32"),s!=="float32"&&s!=="int32")throw new Error(`Unsupported data type ${s}`);const r=new Qce(e,n,s,o),i=et(t,s);for(let a=0;a<i.values.length;a++)i.values[a]=r.nextValue();return i.toTensor()}const Lz=K({randomGamma_:tde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nde(t,e=0,n=1,s,o){if(mo(t),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const r=new KE(e,n,s,!1,o),i=et(t,s);for(let a=0;a<i.values.length;a++)i.values[a]=r.nextValue();return i.toTensor()}const nb=K({randomNormal_:nde});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sde(t,e,n){if(e!=null&&e==="bool")throw new Error(`Unsupported data type ${e}`);return nb(t,0,1,e,n)}const Vz=K({randomStandardNormal_:sde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ode(t,e=0,n=1,s="float32",o){mo(t);const r=et(t,s),i=new ede(e,n,null,o);for(let a=0;a<r.values.length;a++)r.values[a]=i.nextValue();return r.toTensor()}const ol=K({randomUniform_:ode});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rde(t,e,n,s){return ol(t,e,n,"int32",s)}const zz=K({randomUniformInt_:rde});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iu(t,e,n=1,s="float32"){if(n===0)throw new Error("Cannot have a step of zero");const o={start:t,stop:e,step:n,dtype:s};return W.runKernel(bv,{},o)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ide(t){const n={input:V(t,"input","real")};return W.runKernel(wv,n)}const Xc=K({real_:ide});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ade(t){const n={x:V(t,"x","reciprocal")};return W.runKernel(Gd,n)}const XE=K({reciprocal_:ade});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lde(t){const n={x:V(t,"x","relu")};return W.runKernel(Hd,n)}const Ar=K({relu_:lde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ude(t){const n={x:V(t,"x","relu6")};return W.runKernel(Wd,n)}const sb=K({relu6_:ude});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cde(t,e){const s={x:V(t,"x","reverse")},o={dims:e};return W.runKernel(Mm,s,o)}const _o=K({reverse_:cde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dde(t){const e=V(t,"x","reverse");return L(e.rank===1,()=>`Error in reverse1D: x must be rank 1 but got rank ${e.rank}.`),_o(e,0)}const Bz=K({reverse1d_:dde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fde(t,e){const n=V(t,"x","reverse");return L(n.rank===2,()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`),_o(n,e)}const Uz=K({reverse2d_:fde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hde(t,e){const n=V(t,"x","reverse");return L(n.rank===3,()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`),_o(n,e)}const Gz=K({reverse3d_:hde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pde(t,e){const n=V(t,"x","reverse");return L(n.rank===4,()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`),_o(n,e)}const Hz=K({reverse4d_:pde});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mde(t){const n={x:V(t,"x","round")};return W.runKernel(qd,n)}const ob=K({round_:mde});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gde(t){const n={x:V(t,"x","rsqrt","float32")};return W.runKernel(Kd,n)}const rb=K({rsqrt_:gde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yde(t){const n={x:V(t,"x","selu")};return W.runKernel(Xd,n)}const ib=K({selu_:yde});function xde(t,e,n,s,o,r=[1,1],i="NHWC"){const a=V(t,"x","separableConv2d"),l=V(e,"depthwiseFilter","separableConv2d"),u=V(n,"pointwiseFilter","separableConv2d");let d=a,h=!1;if(a.rank===3&&(h=!0,d=ee(a,[1,a.shape[0],a.shape[1],a.shape[2]])),i==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");L(d.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${d.rank}.`),L(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),L(u.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),L(u.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${u.shape[0]}.`),L(u.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${u.shape[1]}.`);const p=l.shape[2],x=l.shape[3];L(u.shape[2]===p*x,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${p*x}, but got ${u.shape[2]}.`);const b=uf(d,l,s,o,i,r),C=Vi(b,u,1,"valid",i);return h?ee(C,[C.shape[1],C.shape[2],C.shape[3]]):C}const ab=K({separableConv2d_:xde});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function vde(t,e){const n=V(t,"x","setdiff1d"),s=V(e,"y","setdiff1d");L(n.dtype===s.dtype,()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${s.dtype}).`),L(n.rank===1,()=>`x should be 1D tensor, but got x (${n.shape}).`),L(s.rank===1,()=>`y should be 1D tensor, but got y (${s.shape}).`);const o=await n.data(),r=await s.data(),i=new Set(r);let a=0;for(let d=0;d<o.length;d++)i.has(o[d])||a++;const l=new In([a],n.dtype),u=new In([a],"int32");for(let d=0,h=0;d<o.length;d++)i.has(o[d])||(l.values[h]=o[d],u.values[h]=d,h++);return[l.toTensor(),u.toTensor()]}const Wz=vde;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bde(t){const n={x:V(t,"x","sign")};return W.runKernel(jd,n)}const YE=K({sign_:bde});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wde(t){const n={x:V(t,"x","sin","float32")};return W.runKernel(Yd,n)}const lb=K({sin_:wde});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cde(t){const n={x:V(t,"x","sinh")};return W.runKernel(Jd,n)}const ub=K({sinh_:Cde});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tde(t,e,n){const s=V(t,"x","slice1d");return L(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),mt(s,[e],[n])}const ig=K({slice1d_:Tde});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sde(t,e,n){const s=V(t,"x","slice2d");return L(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),mt(s,e,n)}const cb=K({slice2d_:Sde});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nde(t,e,n){const s=V(t,"x","slice3d");return L(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),mt(s,e,n)}const ag=K({slice3d_:Nde});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ede(t,e,n){const s=V(t,"x","slice4d");return L(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),mt(s,e,n)}const Yc=K({slice4d_:Ede});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ide(t,e=-1){const n=V(t,"logits","softmax","float32");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const s={logits:n},o={dim:e};return W.runKernel(zm,s,o)}const lg=K({softmax_:Ide});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kde(t){L(t.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`);const e={input:t};return W.runKernel(nv,e)}const ug=K({fft_:kde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ade(t){L(t.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`);const e={input:t};return W.runKernel(iv,e)}const Jc=K({ifft_:Ade});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rde(t){const e=t.shape[t.shape.length-1],n=t.size/e;let s;if(e<=2){const o=ee(t,[n,e]);s=Jc(o)}else{const o=[n,2*(e-1)],r=ee(Xc(t),[n,e]),i=ee(jm(t),[n,e]),a=_o(mt(r,[0,1],[n,e-2]),1),l=j(_o(mt(i,[0,1],[n,e-2]),1),Be(-1)),u=mn([r,a],1),d=mn([i,l],1),h=ee(Li(u,d),[o[0],o[1]]);s=Jc(h)}if(s=Xc(s),t.rank===3&&t.shape[0]!==0){const o=s,r=t.shape[0];s=ee(s,[r,s.shape[0]/r,s.shape[1]]),o.dispose()}return s}const db=K({irfft_:Rde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $de(t,e,n=0){const o={x:V(t,"x","split")},r={numOrSizeSplits:e,axis:n};return W.runKernel(Vm,o,r)}const Hs=K({split_:$de});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dde(t,e){L(t.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${t.dtype}`);let n=t.shape[t.shape.length-1];const s=t.size/n;let o;if(e!=null&&e<n){const b=t.shape.map(C=>0),w=t.shape.map(C=>C);w[t.shape.length-1]=e,o=mt(t,b,w),n=e}else if(e!=null&&e>n){const b=t.shape.map(w=>w);b[t.shape.length-1]=e-n,o=mn([t,Nn(b)],t.shape.length-1),n=e}else o=t;const r=gt(o),i=ee(Li(o,r),[s,n]),a=ug(i),l=Math.floor(n/2)+1,u=Xc(a),d=jm(a),h=Hs(u,[l,n-l],u.shape.length-1),p=Hs(d,[l,n-l],d.shape.length-1),x=o.shape.slice();return x[o.shape.length-1]=l,ee(Li(h[0],p[0]),x)}const cg=K({rfft_:Dde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _de(t,e){let n=V(t,"a","squaredDifference"),s=V(e,"b","squaredDifference");[n,s]=on(n,s),Ze(n.shape,s.shape);const o={a:n,b:s},r={};return W.runKernel(tf,o,r)}const fb=K({squaredDifference_:_de});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mde(t,e){const n=V(t,"x","squeeze","string_or_numeric");return ee(n,Gi(n.shape,e).newShape)}const rl=K({squeeze_:Mde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fde(t,e=0){const n=bp(t,"tensors","stack","string_or_numeric");L(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&L(e<=n[0].rank,()=>"Axis must be <= rank of the tensor");const s=n,o={axis:e};return W.runKernel(Im,s,o)}const Ms=K({stack_:Fde});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ode(t,e=0){const s={x:V(t,"x","step")},o={alpha:e};return W.runKernel(af,s,o)}const Su=K({step_:Ode});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pde(t,e,n,s,o=0,r=0,i=0,a=0,l=0){const d={x:V(t,"x","stridedSlice","string_or_numeric")},h={begin:e,end:n,strides:s,beginMask:o,endMask:r,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:l};return W.runKernel(_v,d,h)}const JE=K({stridedSlice_:Pde});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lde(t){const n={x:V(t,"x","tan","float32")};return W.runKernel(sf,n)}const jE=K({tan_:Lde});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function us(t,e){xu(t);const n=ni(t,e);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return el(t,null,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fa(t,e,n){if(xu(t),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=ni(t,n);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return el(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZE(t,e,n){if(xu(t),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");const s=ni(t,n);if(s.length!==3&&s.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return el(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qz(t,e,n){if(xu(t),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");const s=ni(t,n);if(s.length!==4&&s.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return el(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kz(t,e,n){if(xu(t),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");const s=ni(t,n);if(s.length!==5&&s.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return el(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xz(t,e,n){if(xu(t),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");const s=ni(t,n);if(s.length!==6&&s.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||s,el(t,e,s,n)}function QE(t,e,n){const s=e.rank>1?e.shape[e.rank-1]:1,o=e.rank>1?e.rank-1:1,r=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${s}, and batchDim: ${o}.`;if(n.rank<o)throw new Error(r+` update.rank < ${o}. `);if(t.length<s+(n.rank-o))throw new Error(r+` Output shape length < ${s+(n.rank-o)}`);if(n.rank!==o+t.length-s)throw new Error(r+` update.rank != ${o+t.length-s}`);for(let i=0;i<o;++i)if(n.shape[i]!==e.shape[i])throw new Error(r+` updates.shape[${i}] (${n.shape[i]}) != indices.shape[${i}] (${e.shape[i]}).`);for(let i=0;i<n.rank-o;++i)if(n.shape[i+o]!==t[i+s])throw new Error(r+` updates.shape[${i+o}] (${n.shape[i+o]}) != shape[${i+o}] (${t[i+o]})`)}function hb(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(n.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(t.size===0)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}QE(n,e,t)}function il(t,e,n){const s=e.shape.length,o=s>1?e.shape[s-1]:1,r=n.length;let i=1;for(let h=o;h<r;++h)i*=n[h];const a=o<1?1:o,l=me(e.shape)/a,u=[...ze(n.slice(0,o)),1],d=me(n);return{sliceRank:o,numUpdates:l,sliceSize:i,strides:u,outputSize:d}}const Vde=Object.freeze(Object.defineProperty({__proto__:null,calculateShapes:il,validateInput:hb,validateUpdateShape:QE},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zde(t,e,n){const s=V(t,"tensor","tensorScatterupdate"),o=V(e,"indices","tensorScatterupdate","int32"),r=V(n,"updates","tensorScatterupdate");if(hb(r,o,s.shape),s.dtype!==r.dtype)throw new Error(`tensor and updates must have the same dtype, instead they are ${s.dtype} and ${r.dtype}.`);const i={tensor:s,indices:o,updates:r},a={};return W.runKernel(Nv,i,a)}const Yz=K({tensorScatterUpdate_:zde});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bde(t,e=1,n=!0){const s=V(t,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const o=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>o)throw new Error(`'k' passed to topk() must be <= the last dimension (${o}) but got ${e}`);const r={x:s},i={k:e,sorted:n},[a,l]=W.runKernel(Pv,r,i);return{values:a,indices:l}}const eI=K({topk_:Bde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ude(t,e=0,n=1,s,o){if(mo(t),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const r=new KE(e,n,s,!0,o),i=et(t,s);for(let a=0;a<i.values.length;a++)i.values[a]=r.nextValue();return i.toTensor()}const pb=K({truncatedNormal_:Ude});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gde(t,e=0){const n=V(t,"x","unique","string_or_numeric");L(n.rank>0,()=>"The input tensor must be at least 1D");const s={x:n},o={axis:e},[r,i]=W.runKernel(Vv,s,o);return{values:r,indices:i}}const tI=K({unique_:Gde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hde(t,e,n){const s=V(t,"x","unsortedSegmentSum"),o=V(e,"segmentIds","unsortedSegmentSum","int32");L(Zl(n),()=>"numSegments must be of dtype int");const r={x:s,segmentIds:o},i={numSegments:n};return W.runKernel(Gm,r,i)}const mb=K({unsortedSegmentSum_:Hde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wde(t,e=0){const n=V(t,"x","unstack","string_or_numeric");L(e>=-n.shape.length&&e<n.shape.length,()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`);const s={value:n},o={axis:e};return W.runKernel(Um,s,o)}const Mo=K({unstack_:Wde});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jz(t,e){return tb(t,e,"right")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nI(t,e=!0,n,s){return W.makeVariable(t,e,n,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gb(t,e){const n=[];for(let r=0;r<e.length;r++)e[r]&&n.push(r);const s=et(t,"int32"),o=et([n.length,t.length],"int32");for(let r=0;r<n.length;r++){const i=s.indexToLoc(n[r]),a=r*t.length;o.values.set(i,a)}return o.toTensor()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function qde(t){const e=V(t,"condition","whereAsync","bool"),n=await e.data(),s=gb(e.shape,n);return t!==e&&e.dispose(),s}const sI=qde;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Kde(t,e,n){const s=V(t,"tensor","boolMask"),o=V(e,"mask","boolMask","bool"),r=n??0,i=o.rank,a=s.shape;L(i>0,()=>"mask cannot be scalar"),ds(a.slice(r,r+i),o.shape,"mask's shape must match the first K dimensions of tensor's shape,");let l=1;for(let w=r;w<r+i;w++)l*=a[w];const u=a.slice(0,r).concat([l],a.slice(r+i)),d=ee(s,u),h=ee(o,[-1]),p=await sI(h),x=rl(p,[1]),b=hf(d,x,r);return t!==s&&s.dispose(),e!==o&&o.dispose(),x.dispose(),d.dispose(),h.dispose(),p.dispose(),b}const jz=Kde;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xde(t,e,n){const s=V(t,"x","transpose");if(e==null&&(e=s.shape.map((i,a)=>a).reverse()),L(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(i=>{L(i>=0&&i<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const o={x:s},r={perm:e};return s.dtype==="complex64"?le(()=>{let i=Xc(s),a=jm(s);return i=W.runKernel(ql,{x:i},r),a=W.runKernel(ql,{x:a},r),n&&(a=Ht(a)),Li(i,a)}):W.runKernel(ql,o,r)}const ct=K({transpose_:Xde});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yde(t,e,n,s,o=!0){const r=V(t,"v","movingAverage"),i=V(e,"x","movingAverage"),a=V(n,"decay","movingAverage");KV(r,i),L(lt(r.shape,i.shape),()=>"Shape mismatch in v and x");const l=Be(1),u=$e(l,a);let d=j($e(i,r),u);if(o){L(s!=null,()=>"When using zeroDebias: true, step is required.");const h=V(s,"step","movingAverage");d=Pe(d,$e(l,si(a,h)))}return Te(r,d)}const Zz=K({movingAverage_:Yde});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jde(t,e,n){mo(n);const s=V(t,"indices","scatterND","int32"),o=V(e,"updates","scatterND");hb(o,s,n);const r={indices:s,updates:o},i={shape:n};return W.runKernel(Sv,r,i)}const Qz=K({scatterND_:Jde});function jde(t,e,n,s){if(t.dtype!=="int32")throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${t.shape}.`);const o=t.rank>0?t.shape[0]:1,r=t.rank>1?t.shape[1]:1;if(n.length!==r)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${r}.`);const i=e.size;if(!(e.rank===0||e.rank===1&&i===o))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${o}]`);if(e.dtype!==s.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zde(t,e,n,s=0){mo(n);const o=V(t,"sparseIndices","sparseToDense","int32"),r=V(e,"sparseValues","sparseToDense","string_or_numeric"),i=V(s,"defaultValue","sparseToDense",r.dtype);jde(o,r,n,i);const a={sparseIndices:o,sparseValues:r,defaultValue:i},l={outputShape:n};return W.runKernel($v,a,l)}const eB=K({sparseToDense_:Zde});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qde(t,e){const n=V(e,"indices","gatherND","int32"),o={params:V(t,"x","gatherND","string_or_numeric"),indices:n};return W.runKernel(rv,o)}const tB=K({gatherND_:Qde});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function efe(t,e){if(e==null)return t.shape.slice();if(lt(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let s=0;s<t.shape.length;s++)e[s]==null&&t.shape[s]!=null?n.push(t.shape[s]):n.push(e[s]);return n}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tfe(t,e,n,s){const o=V(t,"x","dropout");if(L(o.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${o.dtype} tensor instead.`),L(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return t instanceof yt?o.clone():o;const r=efe(o,n),i=1-e,a=Pe(ff(Te(ol(r,0,1,"float32",s),i)),i);return j(o,a)}const oI=K({dropout_:tfe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rI(t){return Math.floor(Math.pow(2,Math.ceil(Math.log(t)/Math.log(2))))}function yb(t,e,n){const s=1-t%2,o=new Float32Array(t);for(let r=0;r<t;++r){const i=2*Math.PI*r/(t+s-1);o[r]=e-n*Math.cos(i)}return us(o,"float32")}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function nfe(t,e,n=1){const s=V(t,"predictions","inTopK"),o=V(e,"targets","inTopK");L(s.rank>1,()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${s.rank}`),L(s.rank-1===o.rank,()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${s.rank} and targets rank ${o.rank}`),ds(s.shape.slice(0,s.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const r=s.shape[s.shape.length-1];L(n>0&&n<=r,()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${r}), but got ${n}`);const i=await s.data(),a=await o.data(),[l,u]=[i.length/r,r],d=Xn("bool",l);for(let h=0;h<l;h++){const p=h*u,x=i.subarray(p,p+u),b=[];for(let w=0;w<x.length;w++)b.push({value:x[w],index:w});b.sort((w,C)=>C.value-w.value),d[h]=0;for(let w=0;w<n;w++)if(b[w].index===a[h]){d[h]=1;break}}return t!==s&&s.dispose(),e!==o&&o.dispose(),uo(d,o.shape,"bool")}const nB=nfe;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sfe(t,e,n,s,o,r="NHWC",i){let a=t;t.rank===3&&(a=ee(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=ee(e,[1,e.shape[0],e.shape[1],e.shape[2]])),L(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),L(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),L(n.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`);const u=r==="NHWC"?a.shape[3]:a.shape[1],d=r==="NHWC"?l.shape[3]:l.shape[1];L(u===n[2],()=>`Error in conv2dDerFilter: depth of input ${u}) must match input depth in filter (${n[2]}.`),L(d===n[3],()=>`Error in conv2dDerFilter: depth of dy (${d}) must match output depth for filter (${n[3]}).`),Os("conv2dDerFilter",o,i);const h={x:a,dy:l},p={strides:s,pad:o,dataFormat:r,dimRoundingMode:i,filterShape:n};return W.runKernel(Gx,h,p)}const iI=K({conv2DBackpropFilter_:sfe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xb(t,e,n){if(n==null||n==="linear")return t;if(n==="relu")return j(t,Su(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function vb(t,e){let n=e;const s=kn(t.shape,e.shape);return s.length>0&&(n=_e(n,s)),ee(n,t.shape)}function bb(t,e,n,s){if(e==="linear")return t;if(e==="relu")return Ar(t);if(e==="elu")return cf(t);if(e==="relu6")return sb(t);if(e==="prelu")return rg(t,n);if(e==="leakyrelu")return Zm(t,s);if(e==="sigmoid")return br(t);throw new Error(`Unknown fused activation ${e}.`)}const wb=(t,e)=>!(t>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ofe({x:t,filter:e,strides:n,pad:s,dataFormat:o="NHWC",dilations:r=[1,1],dimRoundingMode:i,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:d}){if(l=l||"linear",wb(W.state.gradientDepth,l)===!1){L(o==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${o} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let $=Vi(t,e,n,s,o,r,i);return a!=null&&($=Te($,a)),bb($,l,u,d)}const h=V(t,"x","conv2d","float32"),p=V(e,"filter","conv2d","float32");let x=h,b=!1;h.rank===3&&(b=!0,x=ee(h,[1,h.shape[0],h.shape[1],h.shape[2]])),L(x.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${x.rank}.`),L(p.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${p.rank}.`),Os("fused conv2d",s,i);const w=o==="NHWC"?x.shape[3]:x.shape[1];L(p.shape[2]===w,()=>`Error in conv2d: depth of input (${w}) must match input depth for filter ${p.shape[2]}.`),L(fs(n,r),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${r}'`);const C=jn(x.shape,p.shape,n,r,s,i);let T;a!=null&&(T=V(a,"bias","fused conv2d"),[T]=on(T,h),o==="NHWC"?Ze(C.outShape,T.shape):(L(T.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${T.shape.length}.`),L(T.shape.length===0||T.shape[0]===C.outChannels||T.shape[0]===1,()=>`Error in fused conv2d: bias shape (${T.shape}) is not compatible with the number of output channels (${C.outChannels})`)));let N;if(u!=null){const $=u.shape;if(L($.length<=1||$.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${$.length}.`),$.length===1)L($[0]===1||$[0]===C.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${$}) is not compatible with the number of output channels (${C.outChannels}).`);else if($.length===3)try{Ze($,C.outShape)}catch{const O=`Error in fused conv2d: PReLU activation weights (${$}) is not compatible with the output shape of the conv2d (${C.outShape}).`;throw Error(O)}N=V(u,"prelu weights","fused conv2d")}const I=($,M)=>{L(o==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${o} but only NHWC is currently supported.`);const[O,F,P,D]=M,H=xb($,P,l);L(Ga(r),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);const Z=SE(F.shape,H,O,n,s),ne=iI(F,H,O.shape,n,s),Q=[Z,ne];if(D!=null){const G=vb(D,H);Q.push(G)}return Q},k={x,filter:p,bias:T,preluActivationWeights:N},A={strides:n,pad:s,dataFormat:o,dilations:r,dimRoundingMode:i,activation:l,leakyreluAlpha:d};return a==null?oi((M,O,F)=>{let P=W.runKernel(mp,k,A);return F([O,M,P]),b&&(P=ee(P,[P.shape[1],P.shape[2],P.shape[3]])),{value:P,gradFunc:I}})(x,p):oi((M,O,F,P)=>{let D=W.runKernel(mp,k,A);return P([O,M,D,F]),b&&(D=ee(D,[D.shape[1],D.shape[2],D.shape[3]])),{value:D,gradFunc:I}})(x,p,T)}const sB=K({fusedConv2d_:ofe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rfe(t,e,n,s,o,r=[1,1],i){let a=t;t.rank===3&&(a=ee(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=ee(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={x:a,dy:l},d={strides:s,pad:o,dimRoundingMode:i,dilations:r,filterShape:n};return W.runKernel(Jx,u,d)}const oB=K({depthwiseConv2dNativeBackpropFilter_:rfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ife(t,e,n,s,o,r=[1,1],i){let a=e,l=!1;e.rank===3&&(l=!0,a=ee(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={dy:a,filter:n},d={strides:s,pad:o,dimRoundingMode:i,dilations:r,inputShape:t},h=W.runKernel(jx,u,d);return l?ee(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const rB=K({depthwiseConv2dNativeBackpropInput_:ife});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function afe({x:t,filter:e,strides:n,pad:s,dataFormat:o="NHWC",dilations:r=[1,1],dimRoundingMode:i,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:d}){if(wb(W.state.gradientDepth,l)===!1){let A=uf(t,e,n,s,o,r,i);return a!=null&&(A=Te(A,a)),bb(A,l,u,d)}const h=V(t,"x","depthwiseConv2d","float32"),p=V(e,"filter","depthwiseConv2d","float32");let x=h,b=!1;h.rank===3&&(b=!0,x=ee(h,[1,h.shape[0],h.shape[1],h.shape[2]])),L(x.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${x.rank}.`),L(p.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${p.rank}.`),L(x.shape[3]===p.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${x.shape[3]}) must match the inChannels dimension in filter ${p.shape[2]}.`),r==null&&(r=[1,1]),L(fs(n,r),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${r}'`),Os("fused depthwiseConv2d",s,i);const w=jn(x.shape,p.shape,n,r,s,i,!0);let C;a!=null&&(C=V(a,"bias","fused conv2d"),[C]=on(C,h),Ze(w.outShape,C.shape));let T;u!=null&&(T=V(u,"prelu weights","fused depthwiseConv2d"));const N=(A,$)=>{L(Ga(r),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${r}'`);const[M,O,F,P]=$,D=xb(A,F,l),H=rB(O.shape,D,M,n,s,r,i),Z=oB(O,D,M.shape,n,s,r,i);if(P!=null){const ne=vb(C,D);return[H,Z,ne]}return[H,Z]},I={x,filter:p,bias:C,preluActivationWeights:T},k={strides:n,pad:s,dataFormat:o,dilations:r,dimRoundingMode:i,activation:l,leakyreluAlpha:d};return a==null?oi(($,M,O)=>{let F=W.runKernel(gp,I,k);return O([M,$,F]),b&&(F=ee(F,[F.shape[1],F.shape[2],F.shape[3]])),{value:F,gradFunc:N}})(x,p):oi(($,M,O,F)=>{let P=W.runKernel(gp,I,k);return F([M,$,P,O]),b&&(P=ee(P,[P.shape[1],P.shape[2],P.shape[3]])),{value:P,gradFunc:N}})(x,p,C)}const lfe=K({fusedDepthwiseConv2d_:afe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ufe({a:t,b:e,transposeA:n=!1,transposeB:s=!1,bias:o,activation:r="linear",preluActivationWeights:i,leakyreluAlpha:a=.2}){if(wb(W.state.gradientDepth,r)===!1){let D=st(t,e,n,s);return o!=null&&(D=Te(D,o)),bb(D,r,i,a)}let l=V(t,"a","fused matMul"),u=V(e,"b","fused matMul");[l,u]=on(l,u);const d=n?l.shape[l.rank-2]:l.shape[l.rank-1],h=s?u.shape[u.rank-1]:u.shape[u.rank-2],p=n?l.shape[l.rank-1]:l.shape[l.rank-2],x=s?u.shape[u.rank-2]:u.shape[u.rank-1],b=l.shape.slice(0,-2),w=u.shape.slice(0,-2),C=me(b),T=me(w);L(d===h,()=>`Error in fused matMul: inner shapes (${d}) and (${h}) of Tensors with shapes ${l.shape} and ${u.shape} and transposeA=${n} and transposeB=${s} must match.`);const I=Ze(l.shape.slice(0,-2),u.shape.slice(0,-2)).concat([p,x]),k=n?ee(l,[C,d,p]):ee(l,[C,p,d]),A=s?ee(u,[T,x,h]):ee(u,[T,h,x]);let $;o!=null&&($=V(o,"bias","fused matMul"),[$]=on($,l),Ze(I,$.shape));let M;i!=null&&(M=V(i,"prelu weights","fused matMul"));const O=(D,H)=>{const[Z,ne,Q,G]=H,q=xb(ee(D,Q.shape),Q,r);let J,oe;if(!n&&!s?(J=st(q,ne,!1,!0),oe=st(Z,q,!0,!1)):!n&&s?(J=st(q,ne,!1,!1),oe=st(q,Z,!0,!1)):n&&!s?(J=st(ne,q,!1,!0),oe=st(Z,q,!1,!1)):(J=st(ne,q,!0,!0),oe=st(q,Z,!0,!0)),o!=null){const B=vb(G,q);return[J,oe,B]}else return[J,oe]},F={a:k,b:A,bias:$,preluActivationWeights:M},P={transposeA:n,transposeB:s,activation:r,leakyreluAlpha:a};return o==null?oi((H,Z,ne)=>{const Q=W.runKernel(pp,F,P);return ne([H,Z,Q]),{value:ee(Q,I),gradFunc:O}})(k,A):oi((H,Z,ne,Q)=>{const G=W.runKernel(pp,F,P);return Q([H,Z,G,ne]),{value:ee(G,I),gradFunc:O}})(k,A,$)}const uS=K({fusedMatMul_:ufe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iB=Object.freeze(Object.defineProperty({__proto__:null,conv2d:sB,depthwiseConv2d:lfe,matMul:uS},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cfe(t){return yb(t,.54,.46)}const dfe=K({hammingWindow_:cfe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ffe(t){return yb(t,.5,.5)}const aB=K({hannWindow_:ffe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hfe(t,e,n,s=!1,o=0){let r=0;const i=[];for(;r+e<=t.size;)i.push(mt(t,r,e)),r+=n;if(s)for(;r<t.size;){const a=r+e-t.size,l=mn([mt(t,r,e-a),Cu([a],o)]);i.push(l),r+=n}return i.length===0?Fa([],[0,e]):ee(mn(i),[i.length,e])}const lB=K({frame_:hfe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pfe(t,e,n,s,o=aB){s==null&&(s=rI(e));const r=lB(t,e,n),i=j(r,o(e));return cg(i,s)}const mfe=K({stft_:pfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gfe(t,e,n,s,o="bilinear",r=0){const i=V(t,"image","cropAndResize"),a=V(e,"boxes","cropAndResize","float32"),l=V(n,"boxInd","cropAndResize","int32"),u=a.shape[0];L(i.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`),L(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${u},4] but had shape ${a.shape}.`),L(l.rank===1&&l.shape[0]===u,()=>`Error in cropAndResize: boxInd must be have size [${u}] but had shape ${a.shape}.`),L(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),L(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),L(o==="bilinear"||o==="nearest",()=>`method must be bilinear or nearest, but was ${o}`);const d={image:i,boxes:a,boxInd:l},h={method:o,extrapolationValue:r,cropSize:s};return W.runKernel(Kx,d,h)}const yfe=K({cropAndResize_:gfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xfe(t){const e=V(t,"image","flipLeftRight","float32");L(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const n={image:e};return W.runKernel(ov,n,{})}const vfe=K({flipLeftRight_:xfe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bfe(t){const e=V(t,"image","grayscaleToRGB"),n=e.rank-1,s=e.shape[n];L(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),L(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const o=new Array(e.rank);return o.fill(1,0,n),o[n]=3,ko(e,o)}const wfe=K({grayscaleToRGB_:bfe});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cfe(t){const e=V(t,"image","RGBToGrayscale"),n=e.rank-1,s=e.shape[n];L(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),L(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const o=e.dtype,r=Ne(e,"float32"),i=us([.2989,.587,.114]);let a;switch(e.rank){case 2:a=Fl("ij,j->i",r,i);break;case 3:a=Fl("ijk,k->ij",r,i);break;case 4:a=Fl("ijkl,l->ijk",r,i);break;case 5:a=Fl("ijklm,m->ijkl",r,i);break;case 6:a=Fl("ijklmn,n->ijklm",r,i);break;default:throw new Error("Not a valid tensor rank.")}return a=rs(a,-1),Ne(a,o)}const Tfe=K({rgbToGrayscale_:Cfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sfe(t,e,n=0,s=.5){const o=V(t,"image","rotateWithOffset","float32");L(o.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${o.rank}.`);const r={image:o},i={radians:e,fillValue:n,center:s};return W.runKernel(zv,r,i)}const Nfe=K({rotateWithOffset_:Sfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mf(t,e,n,s,o,r){s==null&&(s=.5),o==null&&(o=Number.NEGATIVE_INFINITY),r==null&&(r=0);const i=t.shape[0];return n=Math.min(n,i),L(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),L(t.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`),L(t.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`),L(e.rank===1,()=>"scores must be a 1D tensor"),L(e.shape[0]===i,()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${e.shape[0]}`),L(0<=r&&r<=1,()=>`softNmsSigma must be in [0, 1], but was '${r}'`),{maxOutputSize:n,iouThreshold:s,scoreThreshold:o,softNmsSigma:r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Efe(t,e,n,s=.5,o=Number.NEGATIVE_INFINITY){const r=V(t,"boxes","nonMaxSuppression","float32"),i=V(e,"scores","nonMaxSuppression","float32"),a=mf(r,i,n,s,o);n=a.maxOutputSize,s=a.iouThreshold,o=a.scoreThreshold;const l={maxOutputSize:n,iouThreshold:s,scoreThreshold:o};return W.runKernel(pv,{boxes:r,scores:i},l)}const Ife=K({nonMaxSuppression_:Efe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kfe(t,e,n){const s=Afe(t,e,n),o=s<0?-(s+1):s;t.splice(o,0,e)}function Afe(t,e,n){return $fe(t,e,n||Rfe)}function Rfe(t,e){return t>e?1:t<e?-1:0}function $fe(t,e,n){let s=0,o=t.length,r=0,i=!1;for(;s<o;){r=s+(o-s>>>1);const a=n(e,t[r]);a>0?s=r+1:(o=r,i=!a)}return i?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cb(t,e,n,s,o){return aI(t,e,n,s,o,0)}function Tb(t,e,n,s,o,r){return aI(t,e,n,s,o,0,!1,r,!0)}function Sb(t,e,n,s,o,r){return aI(t,e,n,s,o,r,!0)}function aI(t,e,n,s,o,r,i=!1,a=!1,l=!1){const u=[];for(let C=0;C<e.length;C++)e[C]>o&&u.push({score:e[C],boxIndex:C,suppressBeginIndex:0});u.sort(rO);const d=r>0?-.5/r:0,h=[],p=[];for(;h.length<n&&u.length>0;){const C=u.pop(),{score:T,boxIndex:N,suppressBeginIndex:I}=C;if(T<o)break;let k=!1;for(let A=h.length-1;A>=I;--A){const $=Dfe(t,N,h[A]);if($>=s){k=!0;break}if(C.score=C.score*_fe(s,d,$),C.score<=o)break}C.suppressBeginIndex=h.length,k||(C.score===T?(h.push(N),p.push(C.score)):C.score>o&&kfe(u,C,rO))}const x=h.length,b=n-x;a&&b>0&&(h.push(...new Array(b).fill(0)),p.push(...new Array(b).fill(0)));const w={selectedIndices:h};return i&&(w.selectedScores=p),l&&(w.validOutputs=x),w}function Dfe(t,e,n){const s=t.subarray(e*4,e*4+4),o=t.subarray(n*4,n*4+4),r=Math.min(s[0],s[2]),i=Math.min(s[1],s[3]),a=Math.max(s[0],s[2]),l=Math.max(s[1],s[3]),u=Math.min(o[0],o[2]),d=Math.min(o[1],o[3]),h=Math.max(o[0],o[2]),p=Math.max(o[1],o[3]),x=(a-r)*(l-i),b=(h-u)*(p-d);if(x<=0||b<=0)return 0;const w=Math.max(r,u),C=Math.max(i,d),T=Math.min(a,h),N=Math.min(l,p),I=Math.max(T-w,0)*Math.max(N-C,0);return I/(x+b-I)}function _fe(t,e,n){const s=Math.exp(e*n*n);return n<=t?s:0}function rO(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Mfe(t,e,n,s=.5,o=Number.NEGATIVE_INFINITY){const r=V(t,"boxes","nonMaxSuppressionAsync"),i=V(e,"scores","nonMaxSuppressionAsync"),a=mf(r,i,n,s,o);n=a.maxOutputSize,s=a.iouThreshold,o=a.scoreThreshold;const l=await Promise.all([r.data(),i.data()]),u=l[0],d=l[1],{selectedIndices:h}=Cb(u,d,n,s,o);return r!==t&&r.dispose(),i!==e&&i.dispose(),us(h,"int32")}const Ffe=Mfe;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ofe(t,e,n,s=.5,o=Number.NEGATIVE_INFINITY,r=0){const i=V(t,"boxes","nonMaxSuppression"),a=V(e,"scores","nonMaxSuppression"),l=mf(i,a,n,s,o,r);n=l.maxOutputSize,s=l.iouThreshold,o=l.scoreThreshold,r=l.softNmsSigma;const u={boxes:i,scores:a},d={maxOutputSize:n,iouThreshold:s,scoreThreshold:o,softNmsSigma:r},h=W.runKernel(gv,u,d);return{selectedIndices:h[0],selectedScores:h[1]}}const Pfe=K({nonMaxSuppressionWithScore_:Ofe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Lfe(t,e,n,s=.5,o=Number.NEGATIVE_INFINITY,r=0){const i=V(t,"boxes","nonMaxSuppressionAsync"),a=V(e,"scores","nonMaxSuppressionAsync"),l=mf(i,a,n,s,o,r);n=l.maxOutputSize,s=l.iouThreshold,o=l.scoreThreshold,r=l.softNmsSigma;const u=await Promise.all([i.data(),a.data()]),d=u[0],h=u[1],{selectedIndices:p,selectedScores:x}=Sb(d,h,n,s,o,r);return i!==t&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:us(p,"int32"),selectedScores:us(x)}}const Vfe=Lfe;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zfe(t,e,n,s=.5,o=Number.NEGATIVE_INFINITY,r=!1){const i=V(t,"boxes","nonMaxSuppression"),a=V(e,"scores","nonMaxSuppression"),l=mf(i,a,n,s,o,null),u=l.maxOutputSize,d=l.iouThreshold,h=l.scoreThreshold,p={boxes:i,scores:a},x={maxOutputSize:u,iouThreshold:d,scoreThreshold:h,padToMaxOutputSize:r},b=W.runKernel(mv,p,x);return{selectedIndices:b[0],validOutputs:b[1]}}const Bfe=K({nonMaxSuppressionPadded_:zfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Ufe(t,e,n,s=.5,o=Number.NEGATIVE_INFINITY,r=!1){const i=V(t,"boxes","nonMaxSuppressionAsync"),a=V(e,"scores","nonMaxSuppressionAsync"),l=mf(i,a,n,s,o,null),u=l.maxOutputSize,d=l.iouThreshold,h=l.scoreThreshold,[p,x]=await Promise.all([i.data(),a.data()]),{selectedIndices:b,validOutputs:w}=Tb(p,x,u,d,h,r);return i!==t&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:us(b,"int32"),validOutputs:Be(w,"int32")}}const Gfe=Ufe;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hfe(t,e,n=!1,s=!1){const o=V(t,"images","resizeBilinear");L(o.rank===3||o.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${o.rank}.`),L(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),L(s===!1||n===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let r=o,i=!1;o.rank===3&&(i=!0,r=ee(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const a={images:r},l={alignCorners:n,halfPixelCenters:s,size:e},u=W.runKernel(_m,a,l);return i?ee(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const uB=K({resizeBilinear_:Hfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wfe(t,e,n=!1,s=!1){const o=V(t,"images","resizeNearestNeighbor");L(o.rank===3||o.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${o.rank}.`),L(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),L(o.dtype==="float32"||o.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),L(s===!1||n===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let r=o,i=!1;o.rank===3&&(i=!0,r=ee(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const a={images:r},l={alignCorners:n,halfPixelCenters:s,size:e},u=W.runKernel(Dm,a,l);return i?ee(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const cB=K({resizeNearestNeighbor_:Wfe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qfe(t,e="binary",n=!1,s=.5){const o=V(t,"image","threshold"),r=.2989,i=.587,a=.114,l=o.shape[0]*o.shape[1];let u=j(us([s]),255),d,h,p,x;if(L(o.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${o.rank}.`),L(o.shape[2]===3||o.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${o.shape[2]}.`),L(o.dtype==="int32"||o.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${o.dtype}.`),L(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),o.shape[2]===3){[d,h,p]=Hs(o,[1,1,1],-1);const C=j(d,r),T=j(h,i),N=j(p,a);x=Te(Te(C,T),N)}else x=t;if(e==="otsu"){const C=xE(Ne(ob(x),"int32"),uo([]),256);u=Kfe(C,l)}const b=n?sl(x,u):Ps(x,u);return Ne(j(b,255),"int32")}function Kfe(t,e){let n=us([-1]),s=us([0]),o=us([0]),r,i,a,l,u,d;for(let h=0;h<t.size-1;h++){r=mt(t,0,h+1),i=mt(t,h+1),u=Pe(_e(r),e),d=Pe(_e(i),e);const p=_e(j(r,iu(0,r.size)));a=Pe(p,_e(r));const x=Cu(i.shape,r.size),b=Te(iu(0,i.size),x),w=j(i,b);l=Pe(_e(w),_e(i));const C=$e(a,l),T=$e(a,l),N=j(u,d);o=j(j(N,C),T);const I=Ps(o,s);s=Kn(I,o,s),n=Kn(I,us([h]),n)}return n}const Xfe=K({threshold_:qfe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yfe(t,e,n="nearest",s="constant",o=0,r){const i=V(t,"image","transform","float32"),a=V(e,"transforms","transform","float32");L(i.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${i.rank}.`),L(a.rank===2&&(a.shape[0]===i.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),L(r==null||r.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${r}.`);const l={image:i,transforms:a},u={interpolation:n,fillMode:s,fillValue:o,outputShape:r};return W.runKernel(Lv,l,u)}const Jfe=K({transform_:Yfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jfe(t,e,n){const s=V(t,"a","bandPart");L(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const o=s.shape,[r,i]=s.shape.slice(-2);let a,l;typeof e=="number"?(L(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),L(e<=r,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${r}).`),a=V(e<0?r:e,"numLower","bandPart")):(L(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=Kn(qc(e,0),r,Wa(e,r))),typeof n=="number"?(L(n%1===0,()=>`bandPart(): numUpper must be an integer, got ${n}.`),L(n<=i,()=>`bandPart(): numUpper (${n}) must not be greater than the number of columns (${i}).`),l=V(n<0?i:n,"numUpper","bandPart")):(L(n.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=Kn(qc(n,0),i,Wa(n,i)));const u=ee(iu(0,r,1,"int32"),[-1,1]),d=iu(0,i,1,"int32"),h=$e(u,d),p=nr(sl(h,a),Ki(h,Ht(l))),x=Nn([r,i],s.dtype);return ee(Ms(Mo(ee(s,[-1,r,i])).map(b=>Kn(p,b,x))),o)}const Zfe=K({bandPart_:jfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qfe(t){let e;if(Array.isArray(t)){e=!1,L(t!=null&&t.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const o=t[0].shape[0];for(let r=1;r<t.length;++r)L(t[r].shape[0]===o,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[r].shape[0]} vs. ${o})`)}else e=!0,t=Hs(t,t.shape[0],0).map(o=>rl(o,[0]));L(t.length<=t[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`);const n=[],s=t;for(let o=0;o<t.length;++o)n.push(W.tidy(()=>{let r=s[o];if(o>0)for(let i=0;i<o;++i){const a=j(_e(j(n[i],r)),n[i]);r=$e(r,a)}return Pe(r,df(r,"euclidean"))}));return e?Ms(n,0):n}const ehe=K({gramSchmidt_:Qfe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function the(t,e=!1){if(L(t.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`),t.rank===2)return iO(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce((l,u)=>l*u),s=Mo(ee(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),o=[],r=[];s.forEach(l=>{const[u,d]=iO(l,e);o.push(u),r.push(d)});const i=ee(Ms(o,0),t.shape),a=ee(Ms(r,0),t.shape);return[i,a]}}function iO(t,e=!1){return W.tidy(()=>{L(t.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`);const n=t.shape[0],s=t.shape[1];let o=jv(n),r=jr(t);const i=Fa([[1]],[1,1]);let a=jr(i);const l=n>=s?s:n;for(let u=0;u<l;++u){const d=r,h=a,p=o;[a,r,o]=W.tidy(()=>{const x=mt(r,[u,u],[n-u,1]),b=df(x),w=mt(r,[u,u],[1,1]),C=Kn(Ps(w,0),Fa([[-1]]),Fa([[1]])),T=$e(w,j(C,b)),N=Pe(x,T);N.shape[0]===1?a=jr(i):a=mn([i,mt(N,[1,0],[N.shape[0]-1,N.shape[1]])],0);const I=Ht(Pe(st(C,T),b)),k=mt(r,[u,0],[n-u,s]),A=j(I,a),$=ct(a);if(u===0)r=$e(k,st(A,st($,k)));else{const F=$e(k,st(A,st($,k)));r=mn([mt(r,[0,0],[u,s]),F],0)}const M=ct(A),O=mt(o,[0,u],[n,o.shape[1]-u]);if(u===0)o=$e(O,st(st(O,a),M));else{const F=$e(O,st(st(O,a),M));o=mn([mt(o,[0,0],[n,u]),F],1)}return[a,r,o]}),je([d,h,p])}return!e&&n>s&&(o=mt(o,[0,0],[n,s]),r=mt(r,[0,0],[s,s])),[o,r]})}const nhe=K({qr_:the});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Rs;(function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Rs||(Rs={}));function she(t,e,n=Rs.SUM_BY_NONZERO_WEIGHTS){const s=V(t,"losses","computeWeightedLoss");let o=null;e!=null&&(o=V(e,"weights","computeWeightedLoss"));const r=o==null?s:j(s,o);if(n===Rs.NONE)return r;if(n===Rs.SUM)return _e(r);if(n===Rs.MEAN){if(o==null)return tn(r);{const i=s.size/o.size,a=Pe(_e(r),_e(o));return i>1?Pe(a,Be(i)):a}}if(n===Rs.SUM_BY_NONZERO_WEIGHTS){if(o==null)return Pe(_e(r),Be(s.size));{const i=j(o,Gs(s.shape)),a=Ne(_e(ru(i,Be(0))),"float32");return Pe(_e(r),a)}}throw Error(`Unknown reduction: ${n}`)}const Yi=K({computeWeightedLoss_:she});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ohe(t,e,n,s=Rs.SUM_BY_NONZERO_WEIGHTS){const o=V(t,"labels","absoluteDifference"),r=V(e,"predictions","absoluteDifference");let i=null;n!=null&&(i=V(n,"weights","absoluteDifference")),ds(o.shape,r.shape,"Error in absoluteDifference: ");const a=Sn($e(o,r));return Yi(a,i,s)}const rhe=K({absoluteDifference_:ohe});function ihe(t,e,n,s,o=Rs.SUM_BY_NONZERO_WEIGHTS){const r=V(t,"labels","cosineDistance"),i=V(e,"predictions","cosineDistance");let a=null;s!=null&&(a=V(s,"weights","cosineDistance")),ds(r.shape,i.shape,"Error in cosineDistance: ");const l=Be(1),u=$e(l,_e(j(r,i),n,!0));return Yi(u,a,o)}const ahe=K({cosineDistance_:ihe});function lhe(t,e,n,s=Rs.SUM_BY_NONZERO_WEIGHTS){let o=V(t,"labels","hingeLoss");const r=V(e,"predictions","hingeLoss");let i=null;n!=null&&(i=V(n,"weights","hingeLoss")),ds(o.shape,r.shape,"Error in hingeLoss: ");const a=Be(1);o=$e(j(Be(2),o),a);const l=Ar($e(a,j(o,r)));return Yi(l,i,s)}const uhe=K({hingeLoss_:lhe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function che(t,e,n,s=1,o=Rs.SUM_BY_NONZERO_WEIGHTS){const r=V(t,"labels","huberLoss"),i=V(e,"predictions","huberLoss");let a=null;n!=null&&(a=V(n,"weights","huberLoss")),ds(r.shape,i.shape,"Error in huberLoss: ");const l=Be(s),u=Sn($e(i,r)),d=Wa(u,l),h=$e(u,d),p=Te(j(Be(.5),Ot(d)),j(l,h));return Yi(p,a,o)}const dhe=K({huberLoss_:che});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fhe(t,e,n,s=1e-7,o=Rs.SUM_BY_NONZERO_WEIGHTS){const r=V(t,"labels","logLoss"),i=V(e,"predictions","logLoss");let a=null;n!=null&&(a=V(n,"weights","logLoss")),ds(r.shape,i.shape,"Error in logLoss: ");const l=Be(1),u=Be(s),d=Ht(j(r,fo(Te(i,u)))),h=j($e(l,r),fo(Te($e(l,i),u))),p=$e(d,h);return Yi(p,a,o)}const hhe=K({logLoss_:fhe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function phe(t,e,n,s=Rs.SUM_BY_NONZERO_WEIGHTS){const o=V(t,"labels","meanSquaredError"),r=V(e,"predictions","meanSquaredError");let i=null;n!=null&&(i=V(n,"weights","meanSquaredError")),ds(o.shape,r.shape,"Error in meanSquaredError: ");const a=fb(o,r);return Yi(a,i,s)}const mhe=K({meanSquaredError_:phe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ghe(t,e){const n=V(t,"labels","sigmoidCrossEntropyWithLogits"),s=V(e,"logits","sigmoidCrossEntropyWithLogits");ds(n.shape,s.shape,"Error in sigmoidCrossEntropyWithLogits: ");const o=Ar(s),r=j(s,n),i=Qm(Xs(Ht(Sn(s))));return Te($e(o,r),i)}function yhe(t,e,n,s=0,o=Rs.SUM_BY_NONZERO_WEIGHTS){let r=V(t,"multiClassLabels","sigmoidCrossEntropy");const i=V(e,"logits","sigmoidCrossEntropy");let a=null;if(n!=null&&(a=V(n,"weights","sigmoidCrossEntropy")),ds(r.shape,i.shape,"Error in sigmoidCrossEntropy: "),s>0){const u=Be(s),d=Be(1),h=Be(.5);r=Te(j(r,$e(d,u)),j(h,u))}const l=ghe(r,i);return Yi(l,a,o)}const xhe=K({sigmoidCrossEntropy_:yhe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vhe(t,e,n=-1){if(n===-1&&(n=e.rank-1),n!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${n}`);return oi((o,r,i)=>{const l=eg(r,[n],!0),u=$e(Ne(r,"float32"),l);i([o,u]);const d=Ht(j(u,o));return{value:_e(d,[n]),gradFunc:(x,b)=>{const[w,C]=b,T=gn(x.shape,[n]);return[j(ee(x,T),$e(Ne(w,"float32"),Xs(C))),j(ee(x,T),$e(Xs(C),Ne(w,"float32")))]}}})(t,e)}function bhe(t,e,n,s=0,o=Rs.SUM_BY_NONZERO_WEIGHTS){let r=V(t,"onehotLabels","softmaxCrossEntropy");const i=V(e,"logits","softmaxCrossEntropy");let a=null;if(n!=null&&(a=V(n,"weights","softmaxCrossEntropy")),ds(r.shape,i.shape,"Error in softmaxCrossEntropy: "),s>0){const u=Be(s),d=Be(1),h=Be(r.shape[1]);r=Te(j(r,$e(d,u)),Pe(u,h))}const l=vhe(r,i);return Yi(l,a,o)}const whe=K({softmaxCrossEntropy_:bhe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Che(t,e,n,s){const o=V(t,"indices","sparseFillEmptyRows","int32"),r=V(e,"values","sparseFillEmptyRows"),i=V(n,"denseShape","sparseFillEmptyRows","int32"),a=V(s,"defaultValue","sparseFillEmptyRows",r.dtype);if(o.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        ${o.shape}`);if(r.rank!==1)throw new Error(`Values should be Tensor1D but received shape ${r.shape}`);if(i.rank!==1)throw new Error(`Dense shape should be Tensor1D but received shape ${i.shape}`);if(a.rank!==0)throw new Error(`Default value should be a scalar but received shape ${a.shape}`);const l={indices:o,values:r,denseShape:i,defaultValue:a},u=W.runKernel(Iv,l);return{outputIndices:u[0],outputValues:u[1],emptyRowIndicator:u[2],reverseIndexMap:u[3]}}const The=K({sparseFillEmptyRows_:Che});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function She(t,e,n){const s=V(t,"inputIndices","sparseReshape","int32"),o=V(e,"inputShape","sparseReshape","int32"),r=V(n,"newShape","sparseReshape","int32");if(s.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        ${s.shape}`);if(o.rank!==1)throw new Error(`Input shape should be Tensor1D but received shape ${o.shape}`);if(r.rank!==1)throw new Error(`New shape should be Tensor1D but received shape ${r.shape}`);const i={inputIndices:s,inputShape:o,newShape:r},a=W.runKernel(kv,i);return{outputIndices:a[0],outputShape:a[1]}}const Nhe=K({sparseReshape_:She});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ehe(t,e,n){const s=V(t,"data","sparseSegmentMean"),o=V(e,"indices","sparseSegmentMean","int32"),r=V(n,"segmentIds","sparseSegmentMean","int32");if(s.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          ${o.shape}`);if(r.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          ${r.shape}`);const i={data:s,indices:o,segmentIds:r};return W.runKernel(Av,i)}const Ihe=K({sparseSegmentMean_:Ehe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function khe(t,e,n){const s=V(t,"data","sparseSegmentSum"),o=V(e,"indices","sparseSegmentSum","int32"),r=V(n,"segmentIds","sparseSegmentSum","int32");if(s.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         ${o.shape}`);if(r.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         ${r.shape}`);const i={data:s,indices:o,segmentIds:r};return W.runKernel(Rv,i)}const Ahe=K({sparseSegmentSum_:khe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rhe(t,e,n,s,o,r,i,a){const l=V(t,"data","stringNGrams","string");if(l.dtype!=="string")throw new Error("Data must be of datatype string");if(l.shape.length!==1)throw new Error(`Data must be a vector, saw: ${l.shape}`);const u=V(e,"dataSplits","stringNGrams");if(u.dtype!=="int32")throw new Error("Data splits must be of datatype int32");const d={separator:n,nGramWidths:s,leftPad:o,rightPad:r,padWidth:i,preserveShortSequences:a},h={data:l,dataSplits:u},p=W.runKernel(Mv,h,d);return{nGrams:p[0],nGramsSplits:p[1]}}const $he=K({stringNGrams_:Rhe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dhe(t,e,n=!0){const s=V(t,"input","stringSplit","string"),o=V(e,"delimiter","stringSplit","string");if(s.rank!==1)throw new Error(`Input should be Tensor1D but received shape ${s.shape}`);if(o.rank!==0)throw new Error(`Delimiter should be a scalar but received shape ${o.shape}`);const r={skipEmpty:n},i={input:s,delimiter:o},a=W.runKernel(Fv,i,r);return{indices:a[0],values:a[1],shape:a[2]}}const _he=K({stringSplit_:Dhe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mhe(t,e){const n=V(t,"input","stringToHashBucketFast","string"),s={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");const o={input:n};return W.runKernel(Ov,o,s)}const Fhe=K({stringToHashBucketFast_:Mhe});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ohe(t,e,n,s=!0){const o=V(t,"input","staticRegexReplace","string"),r={pattern:e,rewrite:n,replaceGlobal:s};return W.runKernel(Bm,{x:o},r)}const Phe=K({staticRegexReplace_:Ohe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dB={fft:ug,ifft:Jc,rfft:cg,irfft:db},fB={hammingWindow:dfe,hannWindow:aB,frame:lB,stft:mfe},Zo={flipLeftRight:vfe,grayscaleToRGB:wfe,resizeNearestNeighbor:cB,resizeBilinear:uB,rgbToGrayscale:Tfe,rotateWithOffset:Nfe,cropAndResize:yfe,nonMaxSuppression:Ife,nonMaxSuppressionAsync:Ffe,nonMaxSuppressionWithScore:Pfe,nonMaxSuppressionWithScoreAsync:Vfe,nonMaxSuppressionPadded:Bfe,nonMaxSuppressionPaddedAsync:Gfe,threshold:Xfe,transform:Jfe},lI={bandPart:Zfe,gramSchmidt:ehe,qr:nhe},hB={absoluteDifference:rhe,computeWeightedLoss:Yi,cosineDistance:ahe,hingeLoss:uhe,huberLoss:dhe,logLoss:hhe,meanSquaredError:mhe,sigmoidCrossEntropy:xhe,softmaxCrossEntropy:whe},pB={sparseFillEmptyRows:The,sparseReshape:Nhe,sparseSegmentMean:Ihe,sparseSegmentSum:Ahe},mB={stringNGrams:$he,stringSplit:_he,stringToHashBucketFast:Fhe,staticRegexReplace:Phe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lhe=new Map,cS=new Map;class Nu{getClassName(){return this.constructor.className}static fromConfig(e,n){return new e(n)}}class Io{constructor(){this.classNameMap={}}static getMap(){return Io.instance==null&&(Io.instance=new Io),Io.instance}static register(e){Io.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function Se(t,e,n){L(t.className!=null,()=>"Class being registered does not have the static className property defined."),L(typeof t.className=="string",()=>"className is required to be a string, but got type "+typeof t.className),L(t.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof n>"u"&&(n=t.className);const s=n,o=e+">"+s;return Io.register(t),Lhe.set(o,t),cS.set(t,o),t}function Vhe(t){return cS.has(t)?cS.get(t):t.className}const zhe=Object.freeze(Object.defineProperty({__proto__:null,Serializable:Nu,SerializationMap:Io,getRegisteredName:Vhe,registerClass:Se},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ji extends Nu{minimize(e,n=!1,s){const{value:o,grads:r}=this.computeGradients(e,s);if(s!=null){const i=s.map(a=>({name:a.name,tensor:r[a.name]}));this.applyGradients(i)}else this.applyGradients(r);return je(r),n?o:(o.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,n){return wz(e,n)}dispose(){this.iterations_!=null&&je(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Be(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(Ji,Symbol.hasInstance,{value:t=>t.minimize!=null&&t.computeGradients!=null&&t.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uI extends Ji{static get className(){return"Adadelta"}constructor(e,n,s=null){super(),this.learningRate=e,this.rho=n,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=W.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,o)=>{const r=W.registeredVariables[s],i=!1;this.accumulatedGrads[o]==null&&(this.accumulatedGrads[o]={originalName:`${s}/accum_grad`,variable:le(()=>gt(r).variable(i))}),this.accumulatedUpdates[o]==null&&(this.accumulatedUpdates[o]={originalName:`${s}/accum_var`,variable:le(()=>gt(r).variable(i))});const a=Array.isArray(e)?e[o].tensor:e[s];if(a==null)return;const l=this.accumulatedGrads[o].variable,u=this.accumulatedUpdates[o].variable;le(()=>{const d=Te(j(l,this.rho),j(Ot(a),1-this.rho)),h=j(Pe(Yn(Te(u,this.epsilon)),Yn(Te(l,this.epsilon))),a),p=Te(j(u,this.rho),j(Ot(h),1-this.rho));l.assign(d),u.assign(p);const x=Te(j(h,-this.learningRate),r);r.assign(x)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(je(this.accumulatedGrads.map(e=>e.variable)),je(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,n).map(o=>({originalName:o.name,variable:o.tensor.variable(s)})),this.accumulatedUpdates=e.slice(n,n*2).map(o=>({originalName:o.name,variable:o.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.rho,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cI extends Ji{static get className(){return"Adagrad"}constructor(e,n=.1){super(),this.learningRate=e,this.initialAccumulatorValue=n,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,o)=>{const r=W.registeredVariables[s];this.accumulatedGrads[o]==null&&(this.accumulatedGrads[o]={originalName:`${s}/accumulator`,variable:le(()=>Cu(r.shape,this.initialAccumulatorValue).variable(!1))});const i=Array.isArray(e)?e[o].tensor:e[s];if(i==null)return;const a=this.accumulatedGrads[o].variable;le(()=>{const l=Te(a,Ot(i));a.assign(l);const u=Te(j(Pe(i,Yn(Te(l,W.backend.epsilon()))),-this.learningRate),r);r.assign(u)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&je(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,n){return new e(n.learningRate,n.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dI extends Ji{static get className(){return"Adam"}constructor(e,n,s,o=null){super(),this.learningRate=e,this.beta1=n,this.beta2=s,this.epsilon=o,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],le(()=>{this.accBeta1=Be(n).variable(),this.accBeta2=Be(s).variable()}),o==null&&(this.epsilon=W.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);le(()=>{const s=$e(1,this.accBeta1),o=$e(1,this.accBeta2);n.forEach((r,i)=>{const a=W.registeredVariables[r],l=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${r}/m`,variable:le(()=>gt(a).variable(l))}),this.accumulatedSecondMoment[i]==null&&(this.accumulatedSecondMoment[i]={originalName:`${r}/v`,variable:le(()=>gt(a).variable(l))});const u=Array.isArray(e)?e[i].tensor:e[r];if(u==null)return;const d=this.accumulatedFirstMoment[i].variable,h=this.accumulatedSecondMoment[i].variable,p=Te(j(d,this.beta1),j(u,1-this.beta1)),x=Te(j(h,this.beta2),j(Ot(u),1-this.beta2)),b=Pe(p,s),w=Pe(x,o);d.assign(p),h.assign(x);const C=Te(j(Pe(b,Te(Yn(w),this.epsilon)),-this.learningRate),a);a.assign(C)}),this.accBeta1.assign(j(this.accBeta1,this.beta1)),this.accBeta2.assign(j(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&je(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&je(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e),le(()=>{this.accBeta1.assign(si(this.beta1,this.iterations_+1)),this.accBeta2.assign(si(this.beta2,this.iterations_+1))});const n=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,n).map(o=>({originalName:o.name,variable:o.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(n,n*2).map(o=>({originalName:o.name,variable:o.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fI extends Ji{static get className(){return"Adamax"}constructor(e,n,s,o=null,r=0){super(),this.learningRate=e,this.beta1=n,this.beta2=s,this.epsilon=o,this.decay=r,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],le(()=>{this.iteration=Be(0).variable(),this.accBeta1=Be(n).variable()}),o==null&&(this.epsilon=W.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);le(()=>{const s=$e(1,this.accBeta1),o=Pe(-this.learningRate,Te(j(this.iteration,this.decay),1));n.forEach((r,i)=>{const a=W.registeredVariables[r],l=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${r}/m`,variable:gt(a).variable(l)}),this.accumulatedWeightedInfNorm[i]==null&&(this.accumulatedWeightedInfNorm[i]={originalName:`${r}/v`,variable:gt(a).variable(l)});const u=Array.isArray(e)?e[i].tensor:e[r];if(u==null)return;const d=this.accumulatedFirstMoment[i].variable,h=this.accumulatedWeightedInfNorm[i].variable,p=Te(j(d,this.beta1),j(u,1-this.beta1)),x=j(h,this.beta2),b=Sn(u),w=ii(x,b);d.assign(p),h.assign(w);const C=Te(j(Pe(o,s),Pe(p,Te(w,this.epsilon))),a);a.assign(C)}),this.iteration.assign(Te(this.iteration,1)),this.accBeta1.assign(j(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&je(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&je(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nb extends Ji{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,o)=>{const r=Array.isArray(e)?e[o].tensor:e[s];if(r==null)return;const i=W.registeredVariables[s];le(()=>{const a=Te(j(this.c,r),i);i.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Fn(Be(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,n){return new e(n.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hI extends Nb{static get className(){return"Momentum"}constructor(e,n,s=!1){super(e),this.learningRate=e,this.momentum=n,this.useNesterov=s,this.accumulations=[],this.m=Be(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,o)=>{const r=W.registeredVariables[s];this.accumulations[o]==null&&(this.accumulations[o]={originalName:`${s}/momentum`,variable:le(()=>gt(r).variable(!1))});const i=this.accumulations[o].variable,a=Array.isArray(e)?e[o].tensor:e[s];a!=null&&le(()=>{let l;const u=Te(j(this.m,i),a);this.useNesterov?l=Te(j(this.c,Te(a,j(u,this.m))),r):l=Te(j(this.c,u),r),i.assign(u),r.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&je(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,n){return new e(n.learningRate,n.momentum,n.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pI extends Ji{static get className(){return"RMSProp"}constructor(e,n=.9,s=0,o=null,r=!1){if(super(),this.learningRate=e,this.decay=n,this.momentum=s,this.epsilon=o,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=r,o==null&&(this.epsilon=W.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,o)=>{const r=W.registeredVariables[s],i=!1;this.accumulatedMeanSquares[o]==null&&(this.accumulatedMeanSquares[o]={originalName:`${s}/rms`,variable:le(()=>gt(r).variable(i))}),this.accumulatedMoments[o]==null&&(this.accumulatedMoments[o]={originalName:`${s}/momentum`,variable:le(()=>gt(r).variable(i))}),this.accumulatedMeanGrads[o]==null&&this.centered&&(this.accumulatedMeanGrads[o]={originalName:`${s}/mg`,variable:le(()=>gt(r).variable(i))});const a=Array.isArray(e)?e[o].tensor:e[s];if(a==null)return;const l=this.accumulatedMeanSquares[o].variable,u=this.accumulatedMoments[o].variable;le(()=>{const d=Te(j(l,this.decay),j(Ot(a),1-this.decay));if(this.centered){const h=this.accumulatedMeanGrads[o].variable,p=Te(j(h,this.decay),j(a,1-this.decay)),x=Pe(j(a,this.learningRate),Yn($e(d,Te(Ot(p),this.epsilon)))),b=Te(j(u,this.momentum),x);l.assign(d),h.assign(p),u.assign(b);const w=$e(r,b);r.assign(w)}else{const h=Te(j(l,this.decay),j(Ot(a),1-this.decay)),p=Te(j(u,this.momentum),Pe(j(a,this.learningRate),Yn(Te(h,this.epsilon))));l.assign(h),u.assign(p);const x=$e(r,p);r.assign(x)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&je(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&je(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&je(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,n).map(o=>({originalName:o.name,variable:o.tensor.variable(s)})),this.accumulatedMoments=e.slice(n,n*2).map(o=>({originalName:o.name,variable:o.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(n*2,n*3).map(o=>({originalName:o.name,variable:o.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,n){return new e(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bhe=[uI,cI,dI,fI,hI,pI,Nb];function Uhe(){for(const t of Bhe)Se(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ghe="model",Hhe=".json",Whe=".weights.bin";function aO(t){return new Promise(e=>setTimeout(e)).then(t)}class au{constructor(e){if(!ue().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(au.URL_SCHEME)&&(e=e.slice(au.URL_SCHEME.length)),(e==null||e.length===0)&&(e=Ghe),this.modelJsonFileName=e+Hhe,this.weightDataFileName=e+Whe}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");const n=kr.join(e.weightData),s=window.URL.createObjectURL(new Blob([n],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const o=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],r=tz(e,o),i=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),a=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(a.download=this.modelJsonFileName,a.href=i,await aO(()=>a.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){const l=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;l.download=this.weightDataFileName,l.href=s,await aO(()=>l.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:qm(e)}}}}au.URL_SCHEME="downloads://";class qhe{constructor(e){if(e==null||e.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${e}`);this.jsonFile=e[0],this.weightsFiles=e.slice(1)}async load(){return new Promise((e,n)=>{const s=new FileReader;s.onload=o=>{const r=JSON.parse(o.target.result),i=r.modelTopology;if(i==null){n(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));return}if(r.weightsManifest==null){n(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));return}if(this.weightsFiles.length===0){e({modelTopology:i});return}const l=sE(r,u=>this.loadWeights(u));e(l)},s.onerror=o=>n(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),s.readAsText(this.jsonFile)})}loadWeights(e){const n=[],s=[];for(const i of e)n.push(...i.weights),s.push(...i.paths);const o=this.checkManifestAndWeightFiles(e),r=s.map(i=>this.loadWeightsFile(i,o[i]));return Promise.all(r).then(i=>[n,i])}loadWeightsFile(e,n){return new Promise((s,o)=>{const r=new FileReader;r.onload=i=>{const a=i.target.result;s(a)},r.onerror=i=>o(`Failed to weights data from file of path '${e}'.`),r.readAsArrayBuffer(n)})}checkManifestAndWeightFiles(e){const n=[],s=this.weightsFiles.map(r=>JF(r.name)),o={};for(const r of e)r.paths.forEach(i=>{const a=JF(i);if(n.indexOf(a)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${a}'`);if(n.push(a),s.indexOf(a)===-1)throw new Error(`Weight file with basename '${a}' is not provided.`);o[i]=this.weightsFiles[s.indexOf(a)]});if(n.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${n.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return o}}const Khe=t=>ue().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(au.URL_SCHEME)?Xhe(t.slice(au.URL_SCHEME.length)):null;en.registerSaveRouter(Khe);function Xhe(t="model"){return new au(t)}function Yhe(t){return new qhe(t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lO(t,e,n,s){i(t),n=n??0,s=s??1,a(n,s);let o=0;const r=l=>(l.then(u=>{const d=n+ ++o/t.length*(s-n);return e(d),u}),l);function i(l){L(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,u){L(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),L(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${u}`),L(u>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${u}`)}return Promise.all(t.map(r))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function gB(t,e){e==null&&(e={});const n=e.fetchFunc==null?ue().platform.fetch:e.fetchFunc,s=t.map(h=>n(h,e.requestInit,{isBinary:!0})),a=(e.onProgress==null?await Promise.all(s):await lO(s,e.onProgress,0,.5)).map(h=>h.arrayBuffer());return e.onProgress==null?await Promise.all(a):await lO(a,e.onProgress,.5,1)}function Jhe(t,e){var n;const s=e.fetchFunc==null?ue().platform.fetch:e.fetchFunc;let o=0,r;return(n=e.onProgress)===null||n===void 0||n.call(e,0),new ReadableStream({pull:async i=>{for(var a;o<t.length;){r||(r=(await s(t[o],e.requestInit,{isBinary:!0})).body.getReader());const{done:l,value:u}=await r.read();if(l){o++,r=void 0,(a=e.onProgress)===null||a===void 0||a.call(e,o/t.length);continue}i.enqueue(u);return}i.close()}})}async function yB(t,e="",n,s){return xB(i=>gB(i,{requestInit:s}))(t,e,n)}function xB(t){return async(e,n="",s)=>{const o=e.map(()=>!1),r={},i=s!=null?s.map(()=>!1):[],a=[];if(e.forEach((x,b)=>{let w=0;x.weights.forEach(C=>{const T="quantization"in C?C.quantization.dtype:C.dtype,N=Ql[T]*me(C.shape),I=()=>{o[b]=!0,r[b]==null&&(r[b]=[]),r[b].push({manifestEntry:C,groupOffset:w,sizeBytes:N})};s!=null?s.forEach((k,A)=>{k===C.name&&(I(),i[A]=!0)}):I(),a.push(C.name),w+=N})}),!i.every(x=>x)){const x=s.filter((b,w)=>!i[w]);throw new Error(`Could not find weights in manifest with names: ${x.join(", ")}.
Manifest JSON has weights with names: ${a.join(", ")}.`)}const l=o.reduce((x,b,w)=>(b&&x.push(w),x),[]),u=[];l.forEach(x=>{e[x].paths.forEach(b=>{const w=n+(n.endsWith("/")?"":"/")+b;u.push(w)})});const d=await t(u),h={};let p=0;return l.forEach(x=>{const b=e[x].paths.length,w=new kr(d.slice(p,p+b));r[x].forEach(T=>{const N=w.slice(T.groupOffset,T.groupOffset+T.sizeBytes),I=eE(N,[T.manifestEntry]);for(const k in I)h[k]=I[k]}),p+=b}),h}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jhe="application/octet-stream",Zhe="application/json";class mI{constructor(e,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.weightUrlConverter=n.weightUrlConverter,n.fetchFunc!=null?(L(typeof n.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=n.fetchFunc):this.fetch=ue().platform.fetch,L(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&L(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{},this.loadOptions=n}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);n.body=new FormData;const s=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],o=tz(e,s);if(n.body.append("model.json",new Blob([JSON.stringify(o)],{type:Zhe}),"model.json"),e.weightData!=null){const i=kr.join(e.weightData);n.body.append("model.weights.bin",new Blob([i],{type:jhe}),"model.weights.bin")}const r=await this.fetch(this.path,n);if(r.ok)return{modelArtifactsInfo:qm(e),responses:[r]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${r.status}.`)}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let n;try{n=await e.json()}catch{let i=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?i+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":i+=" Please make sure the server is serving valid JSON for this request.",new Error(i)}const s=n.modelTopology,o=n.weightsManifest;if(s==null&&o==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return n}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const e=await this.loadModelJSON();return sE(e,n=>this.loadWeights(n))}async loadStream(){const e=await this.loadModelJSON(),n=await this.getWeightUrls(e.weightsManifest),s=j0(e.weightsManifest),o=()=>Jhe(n,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:s,getWeightStream:o})}async getWeightUrls(e){const n=Array.isArray(this.path)?this.path[1]:this.path,[s,o]=Qhe(n),r=this.weightPathPrefix||s,i=[],a=[];for(const l of e)for(const u of l.paths)this.weightUrlConverter!=null?a.push(this.weightUrlConverter(u)):i.push(r+u+o);return this.weightUrlConverter&&i.push(...await Promise.all(a)),i}async loadWeights(e){const n=await this.getWeightUrls(e),s=j0(e),o=await gB(n,this.loadOptions);return[s,o]}}mI.URL_SCHEME_REGEX=/^https?:\/\//;function Qhe(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),s=t.substring(0,e),o=n>e?t.substring(n):"";return[s+"/",o]}function dS(t){return t.match(mI.URL_SCHEME_REGEX)!=null}const vB=(t,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let n=!0;if(Array.isArray(t)?n=t.every(s=>dS(s)):n=dS(t),n)return gI(t,e)}return null};en.registerSaveRouter(vB);en.registerLoadRouter(vB);function gI(t,e){return new mI(t,e)}function bB(t,e){return gI(t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZC{constructor(e){this.modelArtifacts=e}load(){return this.modelArtifacts}}class wB{constructor(e){this.saveHandler=e}save(e){return this.saveHandler(e)}}class epe{constructor(e){e.load&&(this.load=()=>Promise.resolve(e.load())),e.save&&(this.save=n=>Promise.resolve(e.save(n)))}}function tpe(t,e,n,s){const o=arguments;return new epe(Q0(...o))}function Q0(t,e,n,s){return arguments.length===1?t.modelTopology!=null||t.weightSpecs!=null?new ZC(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new ZC({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new ZC({modelTopology:t,weightSpecs:e,weightData:n,trainingConfig:s}))}function npe(t){return new wB(t)}function spe(t){return new wB(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yI=Object.freeze(Object.defineProperty({__proto__:null,CompositeArrayBuffer:kr,browserFiles:Yhe,browserHTTPRequest:bB,concatenateArrayBuffers:ez,copyModel:Fae,decodeWeights:eE,decodeWeightsStream:QV,encodeWeights:sS,fromMemory:tpe,fromMemorySync:Q0,getLoadHandlers:sz,getModelArtifactsForJSON:sE,getModelArtifactsForJSONSync:nE,getModelArtifactsInfoForJSON:qm,getSaveHandlers:nz,getWeightSpecs:j0,http:gI,isHTTPScheme:dS,listModels:_ae,loadWeights:yB,moveModel:Oae,registerLoadRouter:wae,registerSaveRouter:bae,removeModel:Mae,weightsLoaderFactory:xB,withSaveHandler:npe,withSaveHandlerSync:spe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ope(t,e,n){const s=V(t,"labels","confusionMatrix"),o=V(e,"predictions","confusionMatrix");L(n==null||n>0&&Number.isInteger(n),()=>`If provided, numClasses must be a positive integer, but got ${n}`),L(s.rank===1,()=>`Expected the rank of labels to be 1, but got ${s.rank}`),L(o.rank===1,()=>`Expected the rank of predictions to be 1, but got ${o.rank}`),L(s.shape[0]===o.shape[0],()=>`Mismatch in the number of examples: ${s.shape[0]} vs. ${o.shape[0]}. Labels and predictions should have the same number of elements.`),L(n>0&&Number.isInteger(n),()=>`numClasses is required to be a positive integer, but got ${n}`);const r=Kc(Ne(s,"int32"),n),i=Kc(Ne(o,"int32"),n),a=ct(r),l=st(a,i);return Ne(l,"int32")}const rpe=K({confusionMatrix_:ope});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ipe=Object.freeze(Object.defineProperty({__proto__:null,confusionMatrix:rpe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Al,uO=!1;function CB(t,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(t==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,s=!1,o=!1,r=!1,i=!1,a=!1;if(t.data instanceof Uint8Array)n=!0;else if(typeof ImageData<"u"&&t instanceof ImageData)s=!0;else if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)o=!0;else if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)r=!0;else if(t.getContext!=null)i=!0;else if(typeof ImageBitmap<"u"&&t instanceof ImageBitmap)a=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${t.constructor.name}`);if(xp(Y0,W.backendName)!=null){const b={pixels:t},w={numChannels:e};return W.runKernel(Y0,b,w)}const[u,d]=o?[t.videoWidth,t.videoHeight]:[t.width,t.height];let h;if(i)h=t.getContext("2d").getImageData(0,0,u,d).data;else if(s||n)h=t.data;else if(r||o||a){if(Al==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")Al=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else Al=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});Al.canvas.width=u,Al.canvas.height=d,Al.drawImage(t,0,0,u,d),h=Al.getImageData(0,0,u,d).data}let p;if(e===4)p=new Int32Array(h);else{const b=u*d;p=new Int32Array(b*e);for(let w=0;w<b;w++)for(let C=0;C<e;++C)p[w*e+C]=h[w*4+C]}return ZE(p,[d,u,e],"int32")}function ape(t){return t!=null&&t.data instanceof Uint8Array}function lpe(){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")}function upe(t){return t!=null&&t.width!==0&&t.height!==0}function cpe(t){return lpe()&&!(t instanceof ImageBitmap)&&upe(t)&&!ape(t)}async function TB(t,e=3){let n=null;if(ue().getBool("WRAP_TO_IMAGEBITMAP")&&cpe(t)){let s;try{s=await createImageBitmap(t,{premultiplyAlpha:"none"})}catch{s=null}s!=null&&s.width===t.width&&s.height===t.height?n=s:n=t}else n=t;return CB(n,e)}function SB(t){if(t.rank!==2&&t.rank!==3)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${t.rank}.`);const e=t.rank===2?1:t.shape[2];if(e>4||e===2)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${e}`);if(t.dtype!=="float32"&&t.dtype!=="int32")throw new Error(`Unsupported type for toPixels: ${t.dtype}. Please use float32 or int32 tensors.`)}function dpe(t){const e=(t==null?void 0:t.alpha)||1;if(e>1||e<0)throw new Error(`Alpha value ${e} is suppoed to be in range [0 - 1].`)}async function fpe(t,e){let n=V(t,"img","toPixels");if(!(t instanceof yt)){const u=n;n=Ne(u,"int32"),u.dispose()}SB(n);const[s,o]=n.shape.slice(0,2),r=n.rank===2?1:n.shape[2],i=await n.data(),a=n.dtype==="float32"?255:1,l=new Uint8ClampedArray(o*s*4);for(let u=0;u<s*o;++u){const d=[0,0,0,255];for(let p=0;p<r;p++){const x=i[u*r+p];if(n.dtype==="float32"){if(x<0||x>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${x}.`)}else if(n.dtype==="int32"&&(x<0||x>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${x}.`);r===1?(d[0]=x*a,d[1]=x*a,d[2]=x*a):d[p]=x*a}const h=u*4;l[h+0]=Math.round(d[0]),l[h+1]=Math.round(d[1]),l[h+2]=Math.round(d[2]),l[h+3]=Math.round(d[3])}if(e!=null){uO||xp(Qx,W.backendName)!=null&&(console.warn("tf.browser.toPixels is not efficient to draw tensor on canvas. Please try tf.browser.draw instead."),uO=!0),e.width=o,e.height=s;const u=e.getContext("2d"),d=new ImageData(l,o,s);u.putImageData(d,0,0)}return n!==t&&n.dispose(),l}function hpe(t,e,n){let s=V(t,"img","draw");if(!(t instanceof yt)){const i=s;s=Ne(i,"int32"),i.dispose()}SB(s),dpe(n==null?void 0:n.imageOptions);const o={image:s},r={canvas:e,options:n};W.runKernel(Qx,o,r)}const NB=K({fromPixels_:CB}),ppe=Object.freeze(Object.defineProperty({__proto__:null,draw:hpe,fromPixels:NB,fromPixelsAsync:TB,toPixels:fpe},Symbol.toStringTag,{value:"Module"}));function Eb(t,e){const n=t.shape.length,s=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${n}`);if(me(t.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const o=e.shape,r=o[o.length-1];let i=1;for(let h=0;h<o.length-1;++h)i*=o[h];const a=t.shape,l=o.slice();l.pop();let u=1;for(let h=r;h<n;++h)u*=a[h],l.push(a[h]);const d=[...ze(t.shape).map(h=>h/u),1].slice(0,r);return[l,i,u,d]}const mpe=Object.freeze(Object.defineProperty({__proto__:null,prepareAndValidate:Eb},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fS=-2,gpe=-1;function xI(t,e,n){const s=t.shape.length;L(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),L(s===n.length,()=>`Error in slice${s}D: Length of size ${n} must match the rank of the array (${s}).`);for(let o=0;o<s;++o)L(e[o]+n[o]<=t.shape[o],()=>`Error in slice${s}D: begin[${o}] + size[${o}] (${e[o]+n[o]}) would overflow input.shape[${o}] (${t.shape[o]})`)}function ype(t){const e=[];let n=0;for(;t>0;)t&1&&e.push(n),t/=2,n++;return e}function vI(t,e,n){const s=[];for(let o=0;o<t.length;o++)s[o]=Math.ceil((e[o]-t[o])/n[o]);return s}function EB(t,e,n,s){const o=[...t];for(let r=o.length;r<s.length;r++)o.push(1);for(let r=0;r<n;r++)r===0?o[e]=1:(o.splice(e,0,1),o.pop());return o}function IB(t,e,n){return n<=t?n:n-(e-1)}function kB(t,e){const n=[];for(let s=0;s<t;s++)n.push(e+s);return n}function xpe(t,e,n,s,o,r,i,a,l){const u=t.length;let d=new Array(u),h=new Array(u),p=new Array(u);if(e.length&&n>0){const x=e[0],b=n+1;d=AB(i,x,b,s,t),h=RB(a,x,b,o,t),p=EB(r,x,b,t)}else for(let x=0;x<u;x++)d[x]=DB(i,s,r,t,x,l),h[x]=_B(a,o,r,t,x,l),p[x]=$B(r,x,l);return{begin:d,end:h,strides:p}}function AB(t,e,n,s,o){const r=[...o],i=kB(n,e);for(let a=0;a<r.length;a++)if(i.indexOf(a)>-1)r[a]=0;else{const l=IB(e,n,a);let u=s[l];t&1<<l&&(u=0),r[a]=u}return r}function RB(t,e,n,s,o){const r=[...o],i=kB(n,e);for(let a=0;a<r.length;a++)if(i.indexOf(a)>-1)r[a]=Number.MAX_SAFE_INTEGER;else{const l=IB(e,n,a);let u=s[l];t&1<<l&&(u=Number.MAX_SAFE_INTEGER),r[a]=u}for(let a=0;a<r.length;a++){const l=o[a];r[a]<0&&(r[a]+=l),r[a]=za(0,r[a],o[a])}return r}function $B(t,e,n){let s=t[e];return(n&1<<e||s==null)&&(s=1),s}function DB(t,e,n,s,o,r){let i=e[o];const a=n[o]||1;(t&1<<o||r&1<<o||i==null)&&(a>0?i=Number.MIN_SAFE_INTEGER:i=Number.MAX_SAFE_INTEGER);const l=s[o];return i<0&&(i+=l),i=za(0,i,l-1),i}function _B(t,e,n,s,o,r){let i=e[o];const a=n[o]||1;(t&1<<o||r&1<<o||i==null)&&(a>0?i=Number.MAX_SAFE_INTEGER:i=Number.MIN_SAFE_INTEGER);const l=s[o];return i<0&&(i+=l),a>0?i=za(0,i,l):i=za(-1,i,l-1),i}function bI(t,e,n){let s=n.length;for(let o=0;o<n.length;o++)if(n[o]>1){s=o;break}for(let o=s+1;o<n.length;o++)if(e[o]>0||n[o]!==t[o])return!1;return!0}function wI(t,e){let n=t.length>0?t[t.length-1]:1;for(let s=0;s<t.length-1;s++)n+=t[s]*e[s];return n}function Ib(t,e,n){let s;const o=t.shape.length;typeof e=="number"?s=[e,...new Array(o-1).fill(0)]:e.length<o?s=e.concat(new Array(o-e.length).fill(0)):s=e.slice(),s.forEach(i=>{L(i!==-1,()=>"slice() does not support negative begin indexing.")});let r;return n==null?r=new Array(o).fill(-1):typeof n=="number"?r=[n,...new Array(o-1).fill(-1)]:n.length<o?r=n.concat(new Array(o-n.length).fill(-1)):r=n,r=r.map((i,a)=>i>=0?i:(L(i===-1,()=>`Negative size values should be exactly -1 but got ${i} for the slice() size at index ${a}.`),t.shape[a]-s[a])),[s,r]}function CI(t,e,n,s,o,r,i,a,l){let u;if(s==null?(u=new Array(e.length),u.fill(1)):u=s,i!=null&&(i&i-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");let d=!1;const h={dims:u.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:n.slice(),strides:u.slice(),beginMask:o,endMask:r,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:l};for(let I=0;I<h.dims;I++)d&&(1<<I&a)!==0&&h.numAddAxisAfterEllipsis++,1<<I&i&&(d=!0);d||(h.ellipsisMask|=1<<h.dims,h.dims++);const p={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};vpe(h,p);let x=!0,b=!0,w=!0;const C=[],T=[];for(let I=0;I<t.length;++I){if(p.strides[I]===0)throw Error(`strides[${I}] must be non-zero`);const k=!!(p.shrinkAxisMask&1<<I),A=t[I];if(A===-1){C.push(k?1:-1);continue}const $=[p.beginMask&1<<I,p.endMask&1<<I],M=[p.strides[I]>0?0:-1,p.strides[I]>0?A:A-1];if(k&&p.strides[I]<=0)throw Error("only stride 1 allowed on non-range indexing.");w=w&&p.strides[I]===1;const O=!!(p.beginMask&1<<I&&p.endMask&1<<I);if(p.beginValid&&p.endValid){if(k){const H=p.begin[I]<0?A+p.begin[I]:p.begin[I];if(p.begin[I]=H,p.end[I]=p.begin[I]+1,H<0||H>=A)throw Error(`slice index ${p.begin[I]} of dimension ${I} out of bounds.`)}else p.begin[I]=cO(p.begin[I],0,p.strides[I],A,$,M),p.end[I]=cO(p.end[I],1,p.strides[I],A,$,M);const D=p.strides[I]===1&&p.begin[I]===0&&p.end[I]===A;x=x&&D,b=b&&(I===0&&p.strides[I]===1||D)}else x=x&&p.strides[I]===1&&O,b=b&&(I===0&&p.strides[I]===1||O);let F,P=!1;if(p.beginValid&&p.endValid?(F=p.end[I]-p.begin[I],P=!0):k?(F=1,P=!0):O&&A>=0&&(p.strides[I]<0?F=-A:F=A,P=!0),P){let D;F===0||F<0!=p.strides[I]<0?D=0:D=Math.trunc(F/p.strides[I])+(F%p.strides[I]!==0?1:0),C.push(D)}else C.push(-1)}for(let I=0;I<p.finalShapeGatherIndices.length;++I){const k=p.finalShapeGatherIndices[I];k>=0?T.push(C[k]):k===fS&&T.push(1)}return{finalShapeSparse:T.filter((I,k)=>p.finalShapeGatherIndices[k]!==fS),finalShape:T,isIdentity:x,sliceDim0:b,isSimpleSlice:w,begin:p.begin,end:p.end,strides:p.strides}}function vpe(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let n=0;e.beginValid=t.begin!=null,e.endValid=t.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<t.dims;s++)if(1<<s&t.ellipsisMask){const o=Math.min(e.dims-(t.dims-s)+1+t.numAddAxisAfterEllipsis,e.dims);for(;n<o;n++)e.begin[n]=0,e.end[n]=0,e.strides[n]=1,e.beginMask|=1<<n,e.endMask|=1<<n,e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[n]=s}else if(1<<s&t.newAxisMask)e.finalShapeGatherIndices.push(fS),e.finalShapeGatherIndicesSparse.push(-1);else{if(n===e.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${e.dims} dims, ${e.begin.length}.`);t.begin!=null&&(e.begin[n]=t.begin[s]),t.end!=null&&(e.end[n]=t.end[s]),e.strides[n]=t.strides[s],t.beginMask&1<<s&&(e.beginMask|=1<<n),t.endMask&1<<s&&(e.endMask|=1<<n),t.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(gpe),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<n):(e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[n]=s,n++}}function cO(t,e,n,s,o,r){if(o[e])return n>0?r[e]:r[e+1&1];{const i=t<0?s+t:t;return i<r[0]?r[0]:i>r[1]?r[1]:i}}const MB=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:xI,computeFlatOffset:wI,computeOutShape:vI,getNormalizedAxes:xpe,isSliceContinous:bI,maskToAxes:ype,parseSliceParams:Ib,sliceInfo:CI,startForAxis:DB,startIndicesWithElidedDims:AB,stopForAxis:_B,stopIndicesWithElidedDims:RB,stridesForAxis:$B,stridesWithElidedDims:EB},Symbol.toStringTag,{value:"Module"}));/** @license See the LICENSE file. */const FB="4.20.0";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class OB{static sgd(e){return new Nb(e)}static momentum(e,n,s=!1){return new hI(e,n,s)}static rmsprop(e,n=.9,s=0,o=null,r=!1){return new pI(e,n,s,o,r)}static adam(e=.001,n=.9,s=.999,o=null){return new dI(e,n,s,o)}static adadelta(e=.001,n=.95,s=null){return new uI(e,n,s)}static adamax(e=.002,n=.9,s=.999,o=null,r=0){return new fI(e,n,s,o,r)}static adagrad(e,n=.1){return new cI(e,n)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _l=OB;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bpe=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:t=>t();function TI(){return new Promise(t=>bpe(()=>t()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SI(t,e){const n=t[0].length;t.forEach((o,r)=>{L(o.length===n,()=>`Error in concat${n}D: rank of tensors[${r}] must be the same as the rank of the rest (${n})`)}),L(e>=0&&e<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);const s=t[0];t.forEach((o,r)=>{for(let i=0;i<n;i++)L(i===e||o[i]===s[i],()=>`Error in concat${n}D: Shape of tensors[${r}] (${o}) does not match the shape of the rest (${s}) along the non-concatenated axis ${r}.`)})}function Zr(t,e){const n=t[0].slice();for(let s=1;s<t.length;s++)n[e]+=t[s][e];return n}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var yr;(function(t){t[t.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",t[t.VALUE_ROWIDS=1]="VALUE_ROWIDS",t[t.ROW_LENGTHS=2]="ROW_LENGTHS",t[t.ROW_SPLITS=3]="ROW_SPLITS",t[t.ROW_LIMITS=4]="ROW_LIMITS",t[t.ROW_STARTS=5]="ROW_STARTS"})(yr||(yr={}));function PB(t,e,n){let s=new Array;if(n==null&&e==null)return s;if(e==null)for(;s.length<t+n.length;)s.push(-1);else s=e.slice();if(n==null)return s;if(t+n.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${t+n.length}, but shape.rank = ${s.length}`);for(let o=1;o<n.length;++o){const r=n[o],i=s[s.length-n.length+o],a=s[i];if(r>=0)if(a>=0){if(a!==r)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${o+t}] = ${r} but shape[${o+t}] = ${a}`)}else s[i]=r}return s}function LB(t){const e={FIRST_DIM_SIZE:yr.FIRST_DIM_SIZE,VALUE_ROWIDS:yr.VALUE_ROWIDS,ROW_LENGTHS:yr.ROW_LENGTHS,ROW_SPLITS:yr.ROW_SPLITS,ROW_LIMITS:yr.ROW_LIMITS,ROW_STARTS:yr.ROW_STARTS},n=[];for(const s of t)if(s in e)n.push(e[s]);else break;return n}function VB(t){return t.length===0?0:t[0]===yr.FIRST_DIM_SIZE?t.length-1:t.length}function zB(t,e){if(t==null||e==null)return;const n=t.length,s=e.length;if(n>=s)throw new Error(`defaultValue.shape=${t} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${s})`);for(let o=0;o<Math.min(n,s-1);++o){const r=t[o],i=e[o+1];if(r>=0&&i>=0&&r!==1&&r!==i)throw new Error(`defaultValue.shape=${t}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${o-t.length}] = ${r} but ragged tensor input.flatValues.shape[${o-t.length}] = ${i}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NI=30;function kb(t){return t<=NI?t:q0(t,Math.floor(Math.sqrt(t)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EI(t,e,n){const s=n*(typeof t=="number"?t:t[0]),o=e*(typeof t=="number"?t:t[1]);return[s,o]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dg(t,e,n,s=!0){let o=[];if(s)o=o.concat(e.slice(0)),o.push(t[0]/n),o=o.concat(t.slice(1));else{o=o.concat(t[0]);const r=e.length;for(let i=0;i<r;++i)o=o.concat([t[i+1]/e[i],e[i]]);o=o.concat(t.slice(r+1))}return o}function fg(t,e,n=!0){const s=[];if(n){s.push(e);for(let o=e+1;o<t;++o)o<=2*e?(s.push(o),s.push(o-(e+1))):s.push(o)}else{const o=[],r=[];for(let i=1;i<t;++i)i>=e*2+1||i%2===1?r.push(i):o.push(i);s.push(...o),s.push(0),s.push(...r)}return s}function hg(t,e,n,s=!0){const o=[];s?o.push(t[0]/n):o.push(t[0]*n);for(let r=1;r<t.length;++r)r<=e.length?s?o.push(e[r-1]*t[r]):o.push(t[r]/e[r-1]):o.push(t[r]);return o}function II(t,e){const n=[0];for(let s=0;s<e;++s)n.push(t[s][0]);return n}function kI(t,e,n){const s=t.slice(0,1);for(let o=0;o<n;++o)s.push(t[o+1]-e[o][0]-e[o][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ab=1.7580993408473768,Rb=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AI=.3275911,RI=.254829592,$I=-.284496736,DI=1.421413741,_I=-1.453152027,MI=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zi(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(t.length*2);for(let s=0;s<n.length;s+=2)n[s]=t[s/2],n[s+1]=e[s/2];return n}function BB(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let s=0;s<t.length;s+=2)e[s/2]=t[s],n[s/2]=t[s+1];return{real:e,imag:n}}function UB(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),s=new Float32Array(e);for(let o=0;o<t.length;o+=4)n[Math.floor(o/4)]=t[o],s[Math.floor(o/4)]=t[o+1];return{real:n,imag:s}}function GB(t){const e=Math.floor(t.length/4),n=new Float32Array(e),s=new Float32Array(e);for(let o=2;o<t.length;o+=4)n[Math.floor(o/4)]=t[o],s[Math.floor(o/4)]=t[o+1];return{real:n,imag:s}}function FI(t,e){const n=t[e*2],s=t[e*2+1];return{real:n,imag:s}}function HB(t,e,n,s){t[s*2]=e,t[s*2+1]=n}function WB(t,e){const n=new Float32Array(t/2),s=new Float32Array(t/2);for(let o=0;o<Math.ceil(t/2);o++){const r=(e?2:-2)*Math.PI*(o/t);n[o]=Math.cos(r),s[o]=Math.sin(r)}return{real:n,imag:s}}function qB(t,e,n){const s=(n?2:-2)*Math.PI*(t/e),o=Math.cos(s),r=Math.sin(s);return{real:o,imag:r}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QC="->",wpe=/->/g,dO=",",fO="...";function OI(t,e){t=t.replace(/\s/g,"");const n=(t.length-t.replace(wpe,"").length)/QC.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error(`Equation must contain exactly one arrow ("${QC}").`);const[s,o]=t.split(QC);L(s.indexOf(fO)===-1,()=>`The ellipsis notation ("${fO}") is not supported yet.`);const r=s.split(dO),i=r.length;if(e!==i)throw new Error(`Expected ${i} input tensors, received ${e}`);if(i>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let p=0;p<o.length;++p){const x=o[p];if(!r.some(b=>b.indexOf(x)!==-1))throw new Error(`Output subscripts contain the label ${x} not present in the input subscripts.`);a.indexOf(x)===-1&&a.push(x)}for(let p=0;p<s.length;++p){const x=s[p];a.indexOf(x)===-1&&x!==dO&&a.push(x)}const l=new Array(r.length);for(let p=0;p<i;++p){if(new Set(r[p].split("")).size!==r[p].length)throw new Error(`Found duplicate axes in input component ${r[p]}. Support for duplicate axes in input is not implemented yet.`);l[p]=[];for(let x=0;x<r[p].length;++x)l[p].push(a.indexOf(r[p][x]))}const u=a.length,d=o.length,h=[];for(let p=d;p<u;++p)h.push(p);return{allDims:a,summedDims:h,idDims:l}}function PI(t,e){let n=new Array(t);n.fill(-1);for(let o=0;o<e.length;++o)n[e[o]]=o;const s=[];for(let o=0;o<t;++o)n[o]===-1&&s.push(o);return n=n.filter(o=>o!==-1),{permutationIndices:n,expandDims:s}}function LI(t,e,n){const s=new Array(t);for(let o=0;o<n.length;++o){const r=n[o].shape;for(let i=0;i<e[o].length;++i)s[e[o][i]]===void 0?s[e[o][i]]=r[i]:L(s[e[o][i]]===r[i],()=>`Expected dimension ${s[e[o][i]]} at axis ${i} of input shaped ${JSON.stringify(r)}, but got dimension ${r[i]}`)}}function VI(t,e){const n=t,s=[];let o=0;t.length===0&&n.push(-1),o=t.length+1;for(let i=0;i<o;++i)s.push([]);const r=[];for(let i=0;i<n.length;++i){const a=n[i],l=Cpe(e,a);for(const u of l)r.indexOf(u)===-1&&(s[i].push(u),r.push(u))}return{path:n,steps:s}}function zI(t){return t.every((e,n)=>e===n)}function Cpe(t,e){const n=[];for(let s=0;s<t.length;++s)(t[s].length===0||t[s].indexOf(e)!==-1||e===-1)&&n.push(s);return n}function BI(t,e,n=0){let s=[];if(typeof e=="number")L(t.shape[n]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(t.shape[n]/e);else{const o=e.reduce((i,a)=>(a===-1&&(i+=1),i),0);L(o<=1,()=>"There should be only one negative value in split array.");const r=e.indexOf(-1);if(r!==-1){const i=e.reduce((a,l)=>l>0?a+l:a);e[r]=t.shape[n]-i}L(t.shape[n]===e.reduce((i,a)=>i+a),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KB(t){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${t}`}function XB(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`}function YB(t,e,n){return`indices(${t}, 0) is invalid: ${e} >= ${n}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JB(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`}function jB(t,e){return`size ${t} must be non-negative, not ${e}`}function ZB(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function QB(t,e){const n=me(t),s=me(e);return`Input to reshape is a SparseTensor with ${n}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${t} outputShape= ${e}`}function eU(t,e){const n=me(t),s=me(e);return`Input to reshape is a tensor with ${n} dense values, but the requested shape has ${s}. inputShape=${t} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hS(){return"segment ids must be >= 0"}function tU(){return"segment ids are not increasing"}function nU(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function sU(t,e,n){return`Bad: indices[${t}] == ${e} out of range [0, ${n})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oU(t,e){let n=!1,s;for(t<=NI?(s=t,n=!0):s=q0(t,Math.floor(Math.sqrt(t)));!n;)s>e||s===t?n=!0:s=q0(t,s+1);return s}function rU(t,e,n){const s=[],o=t.length;for(let r=0;r<o;r++)r!==e?s.push(t[r]):s.push(n);return s}function UI(t,e,n,s){const o=e.shape.length,r=t.shape.length;if(s!==0&&(s<-o||s>o))throw new Error(`Expect batchDims in the range of [-${o}, ${o}], but got ${s}`);if(s<0&&(s+=o),s>r)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${r}).`);if(n<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${n}).`);for(let h=0;h<s;++h)if(t.shape[h]!==e.shape[h])throw new Error(`x.shape[${h}]: ${t.shape[h]} should be equal to indices.shape[${h}]: ${e.shape[h]}.`);const i=t.shape[n],a=[];let l=1,u=1,d=1;for(let h=0;h<s;++h)a.push(t.shape[h]),l*=t.shape[h];for(let h=s;h<n;h++)a.push(t.shape[h]),u*=t.shape[h];for(let h=s;h<o;h++)a.push(e.shape[h]);for(let h=n+1;h<r;h++)a.push(t.shape[h]),d*=t.shape[h];return{batchSize:l,sliceSize:d,outerSize:u,dimSize:i,outputShape:a}}const Tpe=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:UI,computeOutShape:rU,segOpComputeOptimalWindowSize:oU},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bi(t){try{return t.map(e=>Oi(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function iU(t){return t.map(e=>Jr(e))}const aU=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:RI,ERF_A2:$I,ERF_A3:DI,ERF_A4:_I,ERF_A5:MI,ERF_P:AI,PARALLELIZE_THRESHOLD:NI,get RowPartitionType(){return yr},SELU_SCALE:Rb,SELU_SCALEALPHA:Ab,applyActivation:bb,assertAndGetBroadcastShape:Ze,assertAxesAreInnerMostDims:hs,assertParamsConsistent:SI,assignToTypedArray:HB,axesAreInnerMostDims:$E,calculateShapes:il,checkEinsumDimSizes:LI,checkPadOnDimRoundingMode:Os,combineLocations:xz,combineRaggedTensorToTensorShapes:PB,complexWithEvenIndex:UB,complexWithOddIndex:GB,computeConv2DInfo:jn,computeConv3DInfo:tl,computeDefaultPad:hE,computeDilation2DInfo:Km,computeOptimalWindowSize:kb,computeOutAndReduceShapes:Zn,computeOutShape:Zr,computePool2DInfo:sr,computePool3DInfo:Wi,convertConv2DDataFormat:qi,decodeEinsumEquation:OI,eitherStridesOrDilationsAreOne:fs,expandShapeToKeepDim:gn,exponent:qB,exponents:WB,fromStringArrayToUint8:iU,fromUint8ToStringArray:Bi,getAxesPermutation:rn,getBroadcastDims:ou,getComplexWithIndex:FI,getEinsumComputePath:VI,getEinsumPermutation:PI,getFusedBiasGradient:vb,getFusedDyActivation:xb,getImageCenter:EI,getInnerMostAxes:yn,getPermuted:fg,getRaggedRank:VB,getReductionAxes:kn,getReshaped:dg,getReshapedPermuted:hg,getRowPartitionTypesHelper:LB,getSliceBeginCoords:II,getSliceSize:kI,getSparseFillEmptyRowsIndicesDenseShapeMismatch:KB,getSparseFillEmptyRowsNegativeIndexErrorMessage:XB,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:YB,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:ZB,getSparseReshapeInputOutputMismatchErrorMessage:eU,getSparseReshapeInputOutputMultipleErrorMessage:QB,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:JB,getSparseReshapeNegativeOutputDimErrorMessage:jB,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:sU,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:hS,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:tU,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:nU,getUndoAxesPermutation:nl,isIdentityPermutation:zI,log:Tie,mergeRealAndImagArrays:zi,prepareAndValidate:Eb,prepareSplitSize:BI,segment_util:Tpe,shouldFuse:wb,slice_util:MB,splitRealAndImagArrays:BB,stridesOrDilationsArePositive:su,tupleValuesAreOne:Ga,upcastType:Ws,validateDefaultValueShape:zB,validateInput:hb,validateUpdateShape:QE,warn:Eo},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Spe=Object.freeze(Object.defineProperty({__proto__:null,nonMaxSuppressionV3Impl:Cb,nonMaxSuppressionV4Impl:Tb,nonMaxSuppressionV5Impl:Sb,whereImpl:gb},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Uhe();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lU={kernelName:Up,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>j(t,Su(Ne(n,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Npe={kernelName:fd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=Ot(Ne(n,"float32")),o=Yn($e(Be(1),s));return Ht(Pe(t,o))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Epe={kernelName:hd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=Yn($e(Ot(Ne(n,"float32")),1));return Pe(t,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ipe={kernelName:wu,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,o=Ze(n.shape,s.shape);return{a:()=>{let a=t;const l=kn(n.shape,o);return l.length>0&&(a=_e(a,l)),ee(a,n.shape)},b:()=>{let a=t;const l=kn(s.shape,o);return l.length>0&&(a=_e(a,l)),ee(a,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kpe={kernelName:Gp,saveAllInputs:!0,gradFunc:(t,e)=>{const n={};return e.forEach((s,o)=>{n[o]=()=>t.clone()}),n}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ape={kernelName:Hp,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>gt(n)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rpe={kernelName:Wp,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>gt(n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $pe={kernelName:pd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Pe(t,Yn($e(Be(1),Ot(Ne(n,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dpe={kernelName:md,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=Yn(Te(Be(1),Ot(Ne(n,"float32"))));return Pe(t,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _pe={kernelName:xd,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,o=Ze(n.shape,s.shape);return{a:()=>{const a=Te(Ot(n),Ot(s));let l=j(t,Pe(s,a));const u=kn(n.shape,o);return u.length>0&&(l=_e(l,u)),ee(l,n.shape)},b:()=>{const a=Te(Ot(n),Ot(s));let l=Ht(j(t,Pe(n,a)));const u=kn(s.shape,o);return u.length>0&&(l=_e(l,u)),ee(l,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mpe={kernelName:gd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Pe(t,Te(Ot(Ne(n,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fpe={kernelName:yd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Pe(t,$e(Be(1),Ot(Ne(n,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ope(t,e,n,s,o,r){const i=V(t,"dy","avgPool3dGrad"),a=V(e,"input","avgPool3dGrad");let l=i,u=a,d=!1;a.rank===4&&(d=!0,l=ee(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]]),u=ee(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),L(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),L(u.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${u.rank}.`),Os("avgPool3dGrad",o,r);const h={dy:l,input:u},p={filterSize:n,strides:s,pad:o,dimRoundingMode:r},x=W.runKernel(Vx,h,p);return d?ee(x,[x.shape[1],x.shape[2],x.shape[3],x.shape[4]]):x}const Ppe=K({avgPool3dGrad_:Ope});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lpe={kernelName:Kp,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{filterSize:o,strides:r,pad:i,dimRoundingMode:a}=n;return{x:()=>Ppe(t,s,o,r,i,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vpe(t,e,n,s,o){const r=V(t,"dy","avgPoolGrad"),i=V(e,"input","avgPoolGrad");L(i.rank===r.rank,()=>`Rank of input (${i.rank}) does not match rank of dy (${r.rank})`);let a=i,l=r,u=!1;i.rank===3&&(u=!0,a=ee(i,[1,i.shape[0],i.shape[1],i.shape[2]]),l=ee(r,[1,r.shape[0],r.shape[1],r.shape[2]])),L(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),L(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const d={dy:l,input:a},h={filterSize:n,strides:s,pad:o},p=W.runKernel(Lx,d,h);return u?ee(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const zpe=K({avgPoolGrad_:Vpe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bpe={kernelName:qp,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{filterSize:o,strides:r,pad:i}=n;return{x:()=>zpe(t,s,o,r,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Upe={kernelName:Xp,inputsToSave:["a","b"],gradFunc:(t,e,n)=>{const[s,o]=e,{transposeA:r,transposeB:i}=n;return!r&&!i?{a:()=>st(t,o,!1,!0),b:()=>st(s,t,!0,!1)}:!r&&i?{a:()=>st(t,o,!1,!1),b:()=>st(t,s,!0,!1)}:r&&!i?{a:()=>st(o,t,!1,!0),b:()=>st(s,t,!1,!1)}:{a:()=>st(o,t,!0,!0),b:()=>st(t,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gpe={kernelName:Yp,gradFunc:(t,e,n)=>{const{blockShape:s,crops:o}=n;return{x:()=>og(t,s,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hpe={kernelName:MV,gradFunc:(t,e,n)=>{const s=n,o=s.inputShape,r=s.shape,i=Array.from(r);for(let l=o.length-1;l>=0;l--)if(o[l]===r[l])i[l]=1;else if(o[l]!==1)throw new Error(`broadcastTo(): [${o}] cannot be broadcast to [${r}].`);const a=[];for(let l=0;l<i.length;l++)i[l]>1&&a.push(l);return{x:()=>_e(t,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wpe={kernelName:vd,gradFunc:t=>({x:()=>t.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qpe={kernelName:bd,gradFunc:t=>({x:()=>gt(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kpe={kernelName:wd,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{clipValueMin:o,clipValueMax:r}=n;return{x:()=>Kn(nr(Ki(s,o),sl(s,r)),t,gt(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xpe={kernelName:jp,inputsToSave:["x"],gradFunc:lU.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ype={kernelName:Zp,saveAllInputs:!0,gradFunc:(t,e,n)=>{const s=e.map(l=>l.shape),{axis:o}=n,r=ot(o,e[0].shape)[0],i=s.map(l=>l[r]);return Hs(t,i,r).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jpe={kernelName:Qp,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[s,o]=e,{dilations:r,strides:i,pad:a,dataFormat:l}=n;return L(Ga(r),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`),{x:()=>SE(s.shape,t,o,i,a,l),filter:()=>iI(s,t,o.shape,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jpe={kernelName:em,inputsToSave:["dy","filter"],gradFunc:(t,e,n)=>{const[s,o]=e,{strides:r,pad:i,dataFormat:a,dimRoundingMode:l}=n;return{dy:()=>Vi(t,o,r,i,a,1,l),filter:()=>iI(t,s,o.shape,r,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zpe(t,e,n,s,o){let r=t;t.rank===4&&(r=ee(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));let i=e;i.rank===4&&(i=ee(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),L(r.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${r.shape}.`),L(i.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${i.shape}.`),L(n.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`),L(r.shape[4]===n[3],()=>`Error in conv3dDerFilter: depth of input ${r.shape[4]}) must match input depth in filter (${n[3]}.`),L(i.shape[4]===n[4],()=>`Error in conv3dDerFilter: depth of dy (${i.shape[4]}) must match output depth for filter (${n[4]}).`);const a={x:r,dy:i},l={strides:s,pad:o,filterShape:n};return W.runKernel(Hx,a,l)}const Qpe=K({conv3DBackpropFilter_:Zpe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eme={kernelName:tm,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:s,strides:o,pad:r}=n;L(Ga(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[i,a]=e;return{x:()=>mz(i.shape,t,a,o,r),filter:()=>Qpe(i,t,a.shape,o,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tme={kernelName:Cd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>j(Ht(lb(Ne(n,"float32"))),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nme={kernelName:Td,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>j(ub(Ne(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sme={kernelName:nm,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:o,exclusive:r,reverse:i}=n;return{x:()=>{const a=rn([o],s.rank);let l=Yv(t,o,r,!i);return a!=null&&(l=ct(l,a)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ome={kernelName:sm,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:s,strides:o,pad:r,dimRoundingMode:i}=n,a=s??[1,1];L(Ga(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[l,u]=e;return L(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),L(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${u.rank}.`),L(l.shape[3]===u.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`),L(fs(o,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${o} and dilations '${a}'.`),Os("depthwiseConv2d",r,i),{x:()=>rB(l.shape,t,u,o,r,a,i),filter:()=>oB(l,t,u.shape,o,r,a,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rme={kernelName:om,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[s,o]=e,r={x:s,filter:o,dy:t},i={x:s,filter:o,dy:t};return{x:()=>W.runKernel(K0,r,n),filter:()=>W.runKernel(X0,i,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ime={kernelName:Nd,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e,s={dy:t,y:n};return{x:()=>W.runKernel(tv,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ame={kernelName:Ed,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,s=j(Xs(Ht(Ot(n))),2/Math.sqrt(Math.PI));return{x:()=>j(t,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lme={kernelName:Id,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>j(t,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ume={kernelName:im,inputsToSave:["input"],gradFunc:(t,e)=>{const[n]=e;return{input:()=>ee(t,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cme={kernelName:kd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>j(t,Xs(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dme={kernelName:Ad,gradFunc:t=>({x:()=>gt(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fme={kernelName:Rd,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,o=Ze(n.shape,s.shape);return{a:()=>{const a=Pe(t,Ne(s,"float32")),l=kn(n.shape,o);return l.length>0?ee(_e(a,l),n.shape):a},b:()=>{let a=j(t,Ne(n,"float32"));const l=kn(s.shape,o);l.length>0&&(a=ee(_e(a,l),s.shape));const u=Ot(s);return Ht(Pe(a,Ne(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hme={kernelName:am,inputsToSave:["x","mean","variance","scale"],gradFunc:(t,e,n)=>{const{varianceEpsilon:s}=n,[o,r,i,a]=e,l=a??Be(1),u=kn(r.shape,o.shape),d=[];if(r.rank===1){for(let k=0;k<o.shape.length-1;++k)d.push(o.shape[k]);d.push(1)}const h=$e(o,r),p=j(t,l),x=rb(Te(i,Be(s))),b=j(j(j(x,x),x),Be(-.5));return{x:()=>r.rank===1?ee(j(j(t,ko(ee(x,[1,1,1,r.shape[0]]),d)),l),o.shape):ee(j(j(t,x),l),o.shape),mean:()=>{let k=j(j(x,Be(-1)),p);return r.rank===1&&(k=_e(k,u)),ee(k,r.shape)},variance:()=>{let k=j(j(b,h),p);return r.rank===1&&(k=_e(k,u)),ee(k,r.shape)},scale:()=>{const k=j(h,x);let A=j(t,k);return r.rank===1&&(A=_e(A,u)),ee(A,r.shape)},offset:()=>{let k=t;return r.rank===1&&(k=_e(k,u)),ee(k,r.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pme={kernelName:lm,inputsToSave:["x","indices"],gradFunc:(t,e,n)=>{const[s,o]=e,{axis:r,batchDims:i}=n,a=ot(r,s.shape)[0],l=(u,d,h)=>()=>{const p=u.shape,x=d.size,b=p.slice(0,a),w=b.length,C=p.slice(r,p.length).slice(1),T=C.length,N=hO(0,w),I=hO(w+1,w+1+T),k=pO([b,[x],C]),A=ee(h,k),$=ee(d,[x]),M=pO([[w],N,I]),O=ct(A,M);let F=mb(O,$,u.shape[a]);const P=nl(M);return F=ct(F,P),F};if(i===1){const u=s.shape[0],d=s.split(u,0);return{x:()=>Ms(d.map((x,b)=>l(x,o.slice(b,1),t.slice(b,1))())).reshape(s.shape),indices:()=>o}}else return{x:l(s,o,t),indices:()=>o}}};function hO(t,e){const n=[];for(let s=t;s<e;++s)n.push(s);return n}function pO(t){const e=[];for(let n=0;n<t.length;++n)for(let s=0;s<t[n].length;++s)e.push(t[n][s]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mme={kernelName:$d,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>gt(n),b:()=>gt(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gme={kernelName:Dd,gradFunc:t=>({x:()=>Ne(t,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yme={kernelName:_d,gradFunc:t=>({x:()=>gt(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xme={kernelName:Md,gradFunc:t=>({x:()=>gt(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vme={kernelName:Fd,gradFunc:t=>({x:()=>gt(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bme={kernelName:cm,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{alpha:o}=n,r=Ps(s,0);return{x:()=>Kn(r,t,j(t,o))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wme={kernelName:Pd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Pe(t,Te(n,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cme={kernelName:Od,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Pe(t,Ne(n,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tme={kernelName:FV,inputsToSave:[],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s]=e,{axis:o}=n;return{logits:()=>{const i=Xs(s);return $e(t,j(_e(t,o,!0),i))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sme(t,e,n,s=5,o=1,r=1,i=.5){const a={x:t,y:e,dy:n},l={depthRadius:s,bias:o,alpha:r,beta:i};return W.runKernel(uv,a,l)}const Nme=K({localResponseNormalizationBackprop_:Sme});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eme={kernelName:gm,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,o]=e,{depthRadius:r,bias:i,alpha:a,beta:l}=n;return{x:()=>Nme(s,o,t,r,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uU(t,e,n,s){return e.rank<n.rank&&(e=ee(e,gn(e.shape,s))),t.rank<n.rank&&(t=ee(t,gn(t.shape,s))),{x:()=>j(t,Ne(co(n,e),t.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mO={kernelName:ym,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const s=n,{reductionIndices:o}=s,r=e[0],i=e[1],a=ot(o,r.shape),l=uU(t,i,r,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ime={kernelName:Ld,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>j(t,Ne(Ki(n,s),"float32")),b:()=>j(t,Ne(qc(n,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kme(t,e,n,s,o,r,i){const a=V(t,"dy","maxPool3dGrad"),l=V(e,"input","maxPool3dGrad"),u=V(n,"output","maxPool3dGrad");let d=a,h=l,p=u,x=!1;l.rank===4&&(x=!0,d=ee(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),h=ee(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),p=ee(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),L(d.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${d.rank}.`),L(h.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${h.rank}.`),L(p.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${p.rank}.`),Os("maxPool3dGrad",r,i);const b={dy:d,input:h,output:p},w={filterSize:s,strides:o,pad:r,dimRoundingMode:i},C=W.runKernel(dv,b,w);return x?ee(C,[C.shape[1],C.shape[2],C.shape[3],C.shape[4]]):C}const Ame=K({maxPool3dGrad_:kme});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rme={kernelName:vm,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,o]=e,{filterSize:r,strides:i,pad:a,dimRoundingMode:l}=n;return{x:()=>Ame(t,s,o,r,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $me(t,e,n,s,o,r,i){const a=V(t,"dy","maxPoolGrad"),l=V(e,"input","maxPoolGrad"),u=V(n,"output","maxPoolGrad");L(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),L(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),L(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),Os("maxPoolGrad",r,i);const d={dy:a,input:l,output:u},h={filterSize:s,strides:o,pad:r,dimRoundingMode:i};return W.runKernel(cv,d,h)}const Dme=K({maxPoolGrad_:$me});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _me={kernelName:xm,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,o]=e,{filterSize:r,strides:i,pad:a}=n;return{x:()=>Dme(t,s,o,r,i,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mme={kernelName:bm,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:o}=n,r=ot(o,s.shape),a=Zn(s.shape,r)[1],l=me(a);return{x:()=>{const d=s.shape.slice();r.forEach(x=>{d[x]=1});const h=ee(t,d);return Pe(j(h,Gs(s.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fme={kernelName:wm,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const s=n,{axis:o}=s,[r,i]=e,a=ot(o,r.shape),l=uU(t,i,r,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ome={kernelName:Vd,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>j(t,Ne(sl(n,s),"float32")),b:()=>j(t,Ne(Ps(n,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pme={kernelName:Cm,inputsToSave:["x"],gradFunc:(t,e,n)=>{const s=e[0],{paddings:o}=n,r=o.map(i=>i[0]);return{x:()=>mt(t,r,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lme={kernelName:zd,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,o=Ze(n.shape,s.shape);return{a:()=>{const a=kn(n.shape,o);return a.length>0?ee(_e(t,a),n.shape):t},b:()=>{const a=j(t,Ht(ff(Pe(n,s)))),l=kn(s.shape,o);return l.length>0?ee(_e(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vme={kernelName:Bd,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,o=Ze(n.shape,s.shape);return{a:()=>{const a=j(t,Ne(s,"float32")),l=kn(n.shape,o);return l.length>0?ee(_e(a,l),n.shape):a},b:()=>{const a=j(t,Ne(n,"float32")),l=kn(s.shape,o);return l.length>0?ee(_e(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zme={kernelName:Tm,gradFunc:t=>({x:()=>Ht(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bme={kernelName:Em,inputsToSave:["indices"],gradFunc:(t,e)=>{const n=e[0];return{indices:()=>Nn(n.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ume={kernelName:Nm,gradFunc:t=>({x:()=>gt(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gme={kernelName:Im,saveAllInputs:!0,gradFunc:(t,e,n)=>{const{axis:s}=n;return Mo(t,s).map(r=>()=>r)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gO={kernelName:km,inputsToSave:["x"],gradFunc:(t,e,n)=>{const s=e[0],{paddings:o}=n,r=o.map(i=>i[0]);return{x:()=>mt(t,r,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hme={kernelName:Ud,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(t,e)=>{const[n,s,o]=e,r=n,i=s,a=Ze(r.shape,i.shape);return{a:()=>{const d=Ne(i,"float32");let h=j(t,j(d,si(r,$e(d,Be(1)))));const p=kn(r.shape,a);return p.length>0&&(h=_e(h,p)),ee(h,r.shape)},b:()=>{const d=Ps(r,0),h=Kn(d,fo(r),gt(r));let p=j(t,j(o,h));const x=kn(i.shape,a);return x.length>0&&(p=_e(p,x)),ee(p,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wme={kernelName:Am,inputsToSave:["x","alpha"],gradFunc:(t,e)=>{const[n,s]=e,o=Ps(n,0);return{x:()=>Kn(o,t,j(t,s)),alpha:()=>{let r=Kn(o,gt(t),j(t,n));const i=kn(s.shape,t.shape);return i.length>0&&(r=_e(r,i)),ee(r,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qme(t,e,n){const s=t.shape.slice();s[n]=1;const o=ee(e,s),r=Sp(t,n,!0,!1),i=Sp(t,n,!0,!0),a=j(r,i);return j(o,a)}function Kme(t,e,n){const s=t.shape.length,o=s-n.length,r=rn(n,s);let i=t;r!=null&&(i=ct(t,r));const a=i.shape.slice(),u=a.splice(s-n.length,n.length).reduce((p,x)=>p*x,1);a.push(u);const d=i.reshape(a);let h=qme(d,e,o);if(h=h.reshape(i.shape),r!=null){const p=nl(r);h=ct(h,p)}return h}const Xme={kernelName:Rm,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:o}=n;let r=[];return o==null?r=s.shape.map((i,a)=>a):typeof o=="number"?r=[o]:r=o,{x:()=>Kme(s,t,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yme={kernelName:Sd,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,o=Ze(n.shape,s.shape);return{a:()=>{const a=Pe(t,Ne(s,"float32")),l=kn(n.shape,o);return l.length>0?ee(_e(a,l),n.shape):a},b:()=>{let a=j(t,Ne(n,"float32"));const l=kn(s.shape,o);l.length>0&&(a=ee(_e(a,l),s.shape));const u=Ot(s);return Ht(Pe(a,Ne(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jme={kernelName:Gd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Pe(t,Ht(Ot(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jme={kernelName:Wd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,s=j(sl(n,6),Su(n));return{x:()=>j(t,Ne(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zme={kernelName:Hd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>j(t,Ne(Su(n),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qme={kernelName:$m,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>ee(t,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ege={kernelName:_m,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[s]=e,o={dy:t,images:s};return{images:()=>W.runKernel(Tv,o,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tge={kernelName:Dm,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[s]=e,o={dy:t,images:s};return{images:()=>W.runKernel(Cv,o,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nge={kernelName:Mm,gradFunc:(t,e,n)=>{const{dims:s}=n,o=ot(s,t.shape);return{x:()=>_o(t,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sge={kernelName:qd,gradFunc:t=>({x:()=>gt(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oge={kernelName:Kd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ht(Pe(t,j(si(n,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rge={kernelName:Fm,inputsToSave:["condition"],gradFunc:(t,e)=>{const[n]=e;return{condition:()=>Ne(gt(n),"float32"),t:()=>j(t,Ne(n,t.dtype)),e:()=>j(t,Ne(tg(n),t.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ige={kernelName:Xd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=Ps(n,Be(0)),o=Be(Ab),r=Be(Rb),i=j(t,r),a=j(j(t,o),Xs(Ne(n,"float32")));return Kn(s,i,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const age={kernelName:Zd,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>j(t,j(n,$e(Be(1),n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lge={kernelName:jd,gradFunc:t=>({x:()=>gt(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uge={kernelName:Yd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>j(Jm(Ne(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cge={kernelName:Jd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>j(Xv(Ne(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dge={kernelName:Om,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{begin:o,size:r}=n,i=s.shape,[a,l]=Ib(s,o,r),u=[];for(let d=0;d<t.rank;d++)u.push([a[d],i[d]-a[d]-l[d]]);return{x:()=>Xi(t,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fge={kernelName:zm,outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s]=e,{dim:o}=n,r=!0,i=j(t,s);return{logits:()=>$e(i,j(_e(i,[o],r),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hge={kernelName:Qd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>j(t,br(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yO={kernelName:Lm,gradFunc:(t,e,n)=>{const{blockShape:s,paddings:o}=n;return{x:()=>Ym(t,s,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xO={kernelName:Vm,gradFunc:(t,e,n)=>{const{axis:s}=n;return{x:()=>mn(t,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pge={kernelName:ef,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Pe(t,j(Yn(Ne(n,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mge={kernelName:Dv,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>j(t,j(Ne(n,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gge={kernelName:tf,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,o=Be(2);return{a:()=>j(t,j(o,$e(n,s))),b:()=>j(t,j(o,$e(s,n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yge={kernelName:af,gradFunc:t=>({x:()=>gt(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xge={kernelName:nf,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,o=Ze(n.shape,s.shape);return{a:()=>{let a=t;const l=kn(n.shape,o);return l.length>0&&(a=_e(a,l)),ee(a,n.shape)},b:()=>{let a=t;const l=kn(s.shape,o);return l.length>0&&(a=_e(a,l)),ee(Ht(a),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vge={kernelName:Pm,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,o=s.shape.slice(),{axis:r}=n;ot(r,s.shape).forEach(u=>{o[u]=1});const a=ee(t,o),l=j(a,Gs(s.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bge={kernelName:sf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Pe(t,Ot(Jm(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wge={kernelName:of,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>j($e(Be(1),Ot(n)),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cge={kernelName:rf,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{reps:o}=n;return{x:()=>{let i=gt(s);if(s.rank===1)for(let a=0;a<o[0];++a)i=Te(i,mt(t,[a*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)i=Te(i,mt(t,[a*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)for(let u=0;u<o[2];++u)i=Te(i,mt(t,[a*s.shape[0],l*s.shape[1],u*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)for(let u=0;u<o[2];++u)for(let d=0;d<o[3];++d)i=Te(i,mt(t,[a*s.shape[0],l*s.shape[1],u*s.shape[2],d*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return i}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tge={kernelName:ql,gradFunc:(t,e,n)=>{const s=n,{perm:o}=s,r=nl(o);return{x:()=>ct(t,r)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sge={kernelName:Um,gradFunc:(t,e,n)=>{const s=n,{axis:o}=s;return{value:()=>Ms(t,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nge={kernelName:Gm,inputsToSave:["segmentIds"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ege(t,n)}}};function Ege(t,e){const n=ii(e,gt(e)),s=hf(t,n);let o=Ki(e,Be(0,"int32"));const r=s.rank-o.rank;for(let a=0;a<r;++a)o=rs(o,a+1);o=nr(o,Gs(s.shape,"bool"));const i=gt(s);return Kn(o,s,i)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ige={kernelName:Hm,gradFunc:t=>({x:()=>gt(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kge=[lU,Npe,Epe,Ipe,kpe,Ape,Rpe,$pe,Dpe,_pe,Mpe,Fpe,Lpe,Bpe,Upe,Gpe,Hpe,Wpe,qpe,Kpe,Xpe,Ype,jpe,Jpe,eme,tme,nme,sme,ome,rme,Yme,ime,ame,lme,ume,cme,fme,dme,hme,pme,mme,gme,yme,xme,vme,bme,wme,Cme,Tme,Eme,mO,mO,Ime,Rme,_me,Mme,Fme,Ome,Pme,Lme,Vme,zme,Bme,Ume,Gme,gO,gO,Hme,Wme,Xme,Jme,jme,Zme,Qme,ege,tge,nge,sge,oge,rge,ige,age,lge,uge,cge,dge,fge,hge,yO,yO,xO,xO,pge,gge,mge,yge,xge,vge,bge,wge,Cge,Tge,Sge,Nge,Ige];for(const t of kge)OV(t);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.abs=function(){return this.throwIfDisposed(),Sn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.acos=function(){return this.throwIfDisposed(),rE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.acosh=function(){return this.throwIfDisposed(),iE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.add=function(t){return this.throwIfDisposed(),Te(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.all=function(t,e){return this.throwIfDisposed(),Wv(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.any=function(t,e){return this.throwIfDisposed(),wp(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.argMax=function(t){return this.throwIfDisposed(),nu(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.argMin=function(t){return this.throwIfDisposed(),aE(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.asScalar=function(){return this.throwIfDisposed(),L(this.size===1,()=>"The array must have only 1 element."),ee(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.asType=function(t){return this.throwIfDisposed(),Ne(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.as1D=function(){return this.throwIfDisposed(),ee(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.as2D=function(t,e){return this.throwIfDisposed(),ee(this,[t,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.as3D=function(t,e,n){return this.throwIfDisposed(),ee(this,[t,e,n])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.as4D=function(t,e,n,s){return this.throwIfDisposed(),ee(this,[t,e,n,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.as5D=function(t,e,n,s,o){return this.throwIfDisposed(),ee(this,[t,e,n,s,o])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.asin=function(){return this.throwIfDisposed(),lE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.asinh=function(){return this.throwIfDisposed(),uE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.atan=function(){return this.throwIfDisposed(),cE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.atan2=function(t){return this.throwIfDisposed(),dE(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.atanh=function(){return this.throwIfDisposed(),fE(this)};ge().prototype.avgPool=function(t,e,n,s){return this.throwIfDisposed(),Xm(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),Ym(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.batchNorm=function(t,e,n,s,o){return this.throwIfDisposed(),lf(this,t,e,n,s,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.broadcastTo=function(t){return this.throwIfDisposed(),Kl(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.cast=function(t){return this.throwIfDisposed(),Ne(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.ceil=function(){return this.throwIfDisposed(),vE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.clipByValue=function(t,e){return this.throwIfDisposed(),Ks(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.concat=function(t,e){return this.throwIfDisposed(),t instanceof yt&&(t=[t]),mn([this,...t],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.conv1d=function(t,e,n,s,o,r){return this.throwIfDisposed(),qv(this,t,e,n,s,o,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.conv2dTranspose=function(t,e,n,s,o){return this.throwIfDisposed(),Kv(this,t,e,n,s,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.conv2d=function(t,e,n,s,o,r){return this.throwIfDisposed(),Vi(this,t,e,n,s,o,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.cos=function(){return this.throwIfDisposed(),Jm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.cosh=function(){return this.throwIfDisposed(),Xv(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.cumprod=function(t,e,n){return this.throwIfDisposed(),Sp(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.cumsum=function(t,e,n){return this.throwIfDisposed(),Yv(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),IE(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.depthwiseConv2d=function(t,e,n,s,o,r){return this.throwIfDisposed(),uf(this,t,e,n,s,o,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.dilation2d=function(t,e,n,s,o){return this.throwIfDisposed(),kE(this,t,e,n,s,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.divNoNan=function(t){return this.throwIfDisposed(),AE(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.div=function(t){return this.throwIfDisposed(),Pe(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.dot=function(t){return this.throwIfDisposed(),RE(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.elu=function(){return this.throwIfDisposed(),cf(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.equal=function(t){return this.throwIfDisposed(),co(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.erf=function(){return this.throwIfDisposed(),Jv(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.euclideanNorm=function(t,e){return this.throwIfDisposed(),DE(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.exp=function(){return this.throwIfDisposed(),Xs(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.expandDims=function(t){return this.throwIfDisposed(),rs(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.expm1=function(){return this.throwIfDisposed(),_E(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.fft=function(){return this.throwIfDisposed(),ug(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.flatten=function(){return this.throwIfDisposed(),ee(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.floor=function(){return this.throwIfDisposed(),ff(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.floorDiv=function(t){return this.throwIfDisposed(),Hv(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.gather=function(t,e,n){return this.throwIfDisposed(),hf(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.greaterEqual=function(t){return this.throwIfDisposed(),Ki(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.greater=function(t){return this.throwIfDisposed(),Ps(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.ifft=function(){return this.throwIfDisposed(),Jc(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.irfft=function(){return this.throwIfDisposed(),db(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.isFinite=function(){return this.throwIfDisposed(),ME(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.isInf=function(){return this.throwIfDisposed(),FE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.isNaN=function(){return this.throwIfDisposed(),OE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.leakyRelu=function(t){return this.throwIfDisposed(),Zm(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.lessEqual=function(t){return this.throwIfDisposed(),sl(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.less=function(t){return this.throwIfDisposed(),qc(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.localResponseNormalization=function(t,e,n,s){return this.throwIfDisposed(),PE(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.logSigmoid=function(){return this.throwIfDisposed(),LE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.logSoftmax=function(t){return this.throwIfDisposed(),Qv(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.logSumExp=function(t,e){return this.throwIfDisposed(),eg(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.log=function(){return this.throwIfDisposed(),fo(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.log1p=function(){return this.throwIfDisposed(),Qm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.logicalAnd=function(t){return this.throwIfDisposed(),nr(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.logicalNot=function(){return this.throwIfDisposed(),tg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.logicalOr=function(t){return this.throwIfDisposed(),eb(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.logicalXor=function(t){return this.throwIfDisposed(),VE(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.matMul=function(t,e,n){return this.throwIfDisposed(),st(this,t,e,n)};ge().prototype.maxPool=function(t,e,n,s){return this.throwIfDisposed(),ng(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.max=function(t,e){return this.throwIfDisposed(),Do(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.maximum=function(t){return this.throwIfDisposed(),ii(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.mean=function(t,e){return this.throwIfDisposed(),tn(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.min=function(t,e){return this.throwIfDisposed(),Wc(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.minimum=function(t){return this.throwIfDisposed(),Wa(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.mirrorPad=function(t,e){return this.throwIfDisposed(),BE(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.mod=function(t){return this.throwIfDisposed(),UE(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.mul=function(t){return this.throwIfDisposed(),j(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.neg=function(){return this.throwIfDisposed(),Ht(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.norm=function(t,e,n){return this.throwIfDisposed(),df(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.notEqual=function(t){return this.throwIfDisposed(),ru(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.oneHot=function(t,e=1,n=0){return this.throwIfDisposed(),Kc(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.onesLike=function(){return this.throwIfDisposed(),ho(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.pad=function(t,e){return this.throwIfDisposed(),Xi(this,t,e)};ge().prototype.pool=function(t,e,n,s,o,r){return this.throwIfDisposed(),GE(this,t,e,n,s,o,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.pow=function(t){return this.throwIfDisposed(),si(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.prelu=function(t){return this.throwIfDisposed(),rg(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.prod=function(t,e){return this.throwIfDisposed(),HE(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.reciprocal=function(){return this.throwIfDisposed(),XE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.relu=function(){return this.throwIfDisposed(),Ar(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.relu6=function(){return this.throwIfDisposed(),sb(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.reshapeAs=function(t){return this.throwIfDisposed(),ee(this,t.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.reshape=function(t){return this.throwIfDisposed(),ee(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.resizeBilinear=function(t,e,n){return this.throwIfDisposed(),uB(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.resizeNearestNeighbor=function(t,e,n){return this.throwIfDisposed(),cB(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.reverse=function(t){return this.throwIfDisposed(),_o(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.rfft=function(){return this.throwIfDisposed(),cg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.round=function(){return this.throwIfDisposed(),ob(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.rsqrt=function(){return this.throwIfDisposed(),rb(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.selu=function(){return this.throwIfDisposed(),ib(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.separableConv2d=function(t,e,n,s,o,r){return this.throwIfDisposed(),ab(this,t,e,n,s,o,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.sigmoid=function(){return this.throwIfDisposed(),br(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.sign=function(){return this.throwIfDisposed(),YE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.sin=function(){return this.throwIfDisposed(),lb(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.sinh=function(){return this.throwIfDisposed(),ub(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.slice=function(t,e){return this.throwIfDisposed(),mt(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.softmax=function(t){return this.throwIfDisposed(),lg(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.softplus=function(){return this.throwIfDisposed(),Tu(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),og(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.split=function(t,e){return this.throwIfDisposed(),Hs(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.sqrt=function(){return this.throwIfDisposed(),Yn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.square=function(){return this.throwIfDisposed(),Ot(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.squaredDifference=function(t){return this.throwIfDisposed(),fb(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.squeeze=function(t){return this.throwIfDisposed(),rl(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.stack=function(t,e){this.throwIfDisposed();const n=t instanceof yt?[this,t]:[this,...t];return Ms(n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.step=function(t){return this.throwIfDisposed(),Su(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.stridedSlice=function(t,e,n,s,o,r,i,a){return this.throwIfDisposed(),JE(this,t,e,n,s,o,r,i,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.sub=function(t){return this.throwIfDisposed(),$e(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.sum=function(t,e){return this.throwIfDisposed(),_e(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.tan=function(){return this.throwIfDisposed(),jE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.tanh=function(){return this.throwIfDisposed(),Ha(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.tile=function(t){return this.throwIfDisposed(),ko(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.toBool=function(){return this.throwIfDisposed(),Ne(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.toFloat=function(){return this.throwIfDisposed(),Ne(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.toInt=function(){return this.throwIfDisposed(),Ne(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.topk=function(t,e){return this.throwIfDisposed(),eI(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.transpose=function(t){return this.throwIfDisposed(),ct(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.unique=function(t){return this.throwIfDisposed(),tI(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),mb(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.unstack=function(t){return this.throwIfDisposed(),Mo(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.where=function(t,e){return this.throwIfDisposed(),Kn(t,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ge().prototype.zerosLike=function(){return this.throwIfDisposed(),gt(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class zr extends Error{constructor(e){super(e),Object.setPrototypeOf(this,zr.prototype)}}class Qo extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Qo.prototype)}}class te extends Error{constructor(e){super(e),Object.setPrototypeOf(this,te.prototype)}}class Qe extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Qe.prototype)}}class GI extends Error{constructor(e){super(e),Object.setPrototypeOf(this,GI.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class cU{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let n;return this.cache.has(e)&&(n=this.cache.get(e),this.cache.delete(e),this.cache.set(e,n)),n}put(e,n){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(e,n)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let n=0;n<this.maxEntries-e;n++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function lu(t,e){if(Array.isArray(t)){let n=[];for(let s=0;s<e;s++)n=n.concat(t);return n}else{const n=new Array(e);return n.fill(t),n}}function Br(t,e){if(!t)throw new GI(e)}function vO(t,e){let n=0;for(const s of t)s===e&&n++;return n}function Bs(t){return t.length===1?t[0]:t}function At(t){return Array.isArray(t)?t:[t]}function Ei(t){const n=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return n[0]!=="_"?n:"private"+n}function Ol(t){return t.length<=1||t.indexOf("_")===-1?t:t.replace(/[_]+(\w|$)/g,(e,n)=>n.toUpperCase())}let Xo={};function HI(t){if(t==null)return null;const e={};return e.className=t.getClassName(),e.config=t.getConfig(),e}function pS(t){if(!(t==null||typeof t!="object"))if(Array.isArray(t))t.forEach(e=>pS(e));else{const e=Object.keys(t);for(const n of e){const s=t[n];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?t[n]=s.value:pS(s))}}}function pg(t,e={},n={},s="object",o=!1){if(typeof t=="string"){const r=t;let i;if(r in n)i=n[r];else if(r in Xo)i=Xo[r];else if(i=e[r],i==null)throw new te(`Unknown ${s}: ${t}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return i}else{const r=t;if(r.className==null||r.config==null)throw new te(`${s}: Improper config format: ${JSON.stringify(r)}.
'className' and 'config' must set.`);const i=r.className;let a,l;if(i in n?[a,l]=n[i]:i in Xo?[a,l]=Xo.className:i in e&&([a,l]=e[i]),a==null)throw new te(`Unknown ${s}: ${i}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const u={};for(const x of Object.keys(Xo))u[x]=Xo[x];for(const x of Object.keys(n))u[x]=n[x];const d=r.config;d.customObjects=u;const h=Object.assign({},Xo);for(const x of Object.keys(n))Xo[x]=n[x];pS(r.config);const p=l(a,r.config,n,o);return Xo=Object.assign({},h),p}else{const u=Object.assign({},Xo);for(const h of Object.keys(n))Xo[h]=n[h];const d=new a(r.config);return Xo=Object.assign({},u),d}}}function Age(t,e){return t<e?-1:t>e?1:0}function jy(t,e){return-1*Age(t,e)}function Oa(t){if(t==null)return t;const e=[];for(const n of t)e.indexOf(n)===-1&&e.push(n);return e}function Rge(t){if(t==null)throw new te(`Invalid value in obj: ${JSON.stringify(t)}`);for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}function Eu(t,e,n){if(n!=null&&t.indexOf(n)<0)throw new te(`${n} is not a valid ${e}.  Valid values are ${t} or null/undefined.`)}function WI(t,e,n=0,s=1/0){return Br(n>=0),Br(s>=n),Array.isArray(t)&&t.length>=n&&t.length<=s&&t.every(o=>typeof o===e)}function qn(t,e){Array.isArray(t)?(L(t.length>0,()=>`${e} is unexpectedly an empty array.`),t.forEach((n,s)=>qn(n,`element ${s+1} of ${e}`))):L(Number.isInteger(t)&&t>0,()=>`Expected ${e} to be a positive integer, but got ${dU(t)}.`)}function dU(t){return t===null?"null":Array.isArray(t)?"["+t.map(e=>dU(e)).join(",")+"]":typeof t=="string"?`"${t}"`:`${t}`}function $ge(t,e,n){let s=n!=null?n():os(),o;return(...i)=>{const a=n!=null?n():os();return a-s<e||(s=a,o=t(...i)),o}}function fU(t){return t==="relu"?"relu":t==="linear"?"linear":t==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Dge=0;function hU(){return Dge++}const Zy={};function $b(t=""){return t in Zy||(Zy[t]=0),Zy[t]+=1,t+Zy[t].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const _ge=["channelsFirst","channelsLast"],Mge=["nearest","bilinear"],Fge=["valid","same","causal"],Oge=["max","avg"],Pge=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const xc=new Map;function xn(t){Eu(_ge,"DataFormat",t)}function Lge(t){Eu(Mge,"InterpolationFormat",t)}function Fo(t){Eu(Fge,"PaddingMode",t)}function pU(t){Eu(Oge,"PoolMode",t)}const tp=[],bO="/";function Xl(t,e){tp.push(t);try{const n=e();return tp.pop(),n}catch(n){throw tp.pop(),n}}function Vge(){return tp.length===0?"":tp.join(bO)+bO}function mU(t){if(!yU(t))throw new Error("Not a valid tensor name: '"+t+"'");return Vge()+t}function gU(t){if(!yU(t))throw new Error("Not a valid tensor name: '"+t+"'");xc.has(t)||xc.set(t,0);const e=xc.get(t);if(xc.set(t,xc.get(t)+1),e>0){const n=`${t}_${e}`;return xc.set(n,1),n}else return t}const zge=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function yU(t){return!!t.match(zge)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Bge(t){return t===parseInt(t.toString(),10)}function Pa(t,e,n){e==null&&(e=0),n==null&&(n=t.length);let s=1;for(let o=e;o<n;++o)s*=t[o];return s}function jc(t){if(t.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let n=0;n<t.length;n++){const s=t[n];s<e&&(e=s)}return e}function qa(t){if(t.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let n=0;n<t.length;n++){const s=t[n];s>e&&(e=s)}return e}function Tr(t,e){if(e<t)throw new te(`end (${e}) < begin (${t}) is forbidden.`);const n=[];for(let s=t;s<e;++s)n.push(s);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let eT;function On(){return eT==null&&(eT=QN().epsilon()),eT}function Sr(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Qr(t,e){return Ne(t,e)}function mg(t,e=-1){const n=t.shape.slice();return e<0&&(e=n.length+e+1),n.splice(e,0,1),ee(t,n)}function Uge(t,e){return le(()=>{if(t.shape.length!==2)throw new te(`repeat() expects a rank-2 tensor, but received a rank-${t.shape.length} tensor.`);const n=mg(t,1);return mS(n,[1,e,1])})}function Gge(t){const e=[Pa(t.shape)];return ee(t,e)}function Hge(t){if(t.rank<=1)throw new te(`batchFlatten requires a minimum rank of 2. Got rank: ${t.rank}.`);const e=[t.shape[0],Pa(t.shape,1)];return ee(t,e)}function Yl(t,e,n){return le(()=>{switch(t.rank){case 1:return ig(t,e,n);case 2:return cb(t,[e,0],[n,t.shape[1]]);case 3:return ag(t,[e,0,0],[n,t.shape[1],t.shape[2]]);case 4:return Yc(t,[e,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3]]);case 5:return mt(t,[e,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return mt(t,[e,0,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new te(`sliceAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}})}function tT(t,e,n){return le(()=>{switch(t.rank){case 1:return ig(t,e,n);case 2:return cb(t,[0,e],[t.shape[0],n]);case 3:return ag(t,[0,0,e],[t.shape[0],t.shape[1],n]);case 4:return Yc(t,[0,0,0,e],[t.shape[0],t.shape[1],t.shape[2],n]);default:throw new te(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function Qy(t,e,n,s){return le(()=>{switch(t.rank){case 1:return ig(t,e,n);case 2:switch(s){case 1:return Yl(t,e,n);case 2:return tT(t,e,n);default:throw new te(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return Yl(t,e,n);case 2:return ag(t,[0,e,0],[t.shape[0],n,t.shape[2]]);case 3:return tT(t,e,n);default:throw new te(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return Yl(t,e,n);case 2:return Yc(t,[0,e,0,0],[t.shape[0],n,t.shape[2],t.shape[3]]);case 3:return Yc(t,[0,0,e,0],[t.shape[0],t.shape[1],n,t.shape[3]]);case 4:return tT(t,e,n);default:throw new te(`The axis is not within the rank of the tensor ${s}`)}default:throw new te(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function qI(t,e=-1){let n;return e<0&&(n=t[0].rank,n!==0?e=n:e=0),e===t[0].rank&&(e=-1),mn(t,e)}function wO(t,e){switch(t.rank){case 1:return bE([t,e]);case 2:return wE([t,e],0);case 3:return CE([t,e],0);case 4:return TE([t,e],0);default:throw new te(`concatAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}function mS(t,e){if(Array.isArray(e)||(e=[e]),t.rank!==e.length)throw new te(`The length of input n (${e.length}) does not match the number of dimensions in input x (${t.rank})`);return ko(t,e)}function Db(t,e=0,n=1,s,o){return nb(t,e,n,s,o)}function ei(t,e,n,s){if(t.rank<2||e.rank<2)throw new Qe(`dot requires both inputs to be rank >= 2 but got x shape = ${t.shape} and y shape = ${e.shape}`);if(e.rank>=3){const o=t.shape.slice(-1)[0],r=e.shape.slice(-2)[0];if(o!==r)throw new Qe(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${t.shape} and  y shape = ${e.shape}`)}if(t.rank===2&&e.rank===2)return uS({a:t,b:e,transposeA:!1,transposeB:!1,bias:s?gS(t.rank,s,Sr()):null,activation:n});{const o=t.shape.slice(),r=o.pop();t=ee(t,[-1,r]);const i=e.shape.slice(),a=i.pop(),l=i.pop(),u=[...i,a],d=Array.from({length:e.rank},(b,w)=>w===0?e.rank-2:w<=e.rank-2?w-1:w);e=ee(ct(e,d),[l,-1]);const h=[...o,...u];return ee(uS({a:t,b:e,transposeA:!1,transposeB:!1,bias:s?gS(t.rank,s,Sr()):null,activation:n}),h)}}function xU(t,e,n){return le(()=>(Array.isArray(e)?e=us(e,"int32"):e=Ne(e,"int32"),hf(t,e,n)))}function gg(t){return j(t,t)}function gS(t,e,n){const s=e.shape;if(e.rank!==1&&e.rank!==t)throw new te(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${t}`);if(t===5){if(n==="channelsFirst")return s.length===1?ee(e,[1,s[0],1,1,1]):ee(e,[1,s[3],s[0],s[1],s[2]]);if(n==="channelsLast")return s.length===1?ee(e,[1,1,1,1,s[0]]):ee(e,[1].concat(s))}else if(t===4){if(n==="channelsFirst")return s.length===1?ee(e,[1,s[0],1,1]):ee(e,[1,s[2],s[0],s[1]]);if(n==="channelsLast")return s.length===1?ee(e,[1,1,1,s[0]]):ee(e,[1].concat(s))}else if(t===3){if(n==="channelsFirst")return s.length===1?ee(e,[1,s[0],1]):ee(e,[1,s[1],s[0]]);if(n==="channelsLast")return s.length===1?ee(e,[1,1,s[0]]):ee(e,[1].concat(s))}else if(t<3)return e;throw new te(`Unsupported input rank by biasAdd: ${e.rank}`)}function Rr(t,e,n){return le(()=>(n==null&&(n=Sr()),xn(n),Te(t,gS(t.rank,e,n))))}function Wge(t,e=1){if(e!==1)throw new Qe(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return cf(t)}function qge(t){return le(()=>Pe(t,Te(Sn(t),1)))}function vU(t,e,n,s){return le(()=>oI(t,e,n,s))}function Kge(t){return le(()=>{const e=Te(.5,j(.2,t));return Ks(e,0,1)})}function yg(t,e,n=!1){return n?t():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Xge=["fanIn","fanOut","fanAvg"],Yge=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Jge(t){Eu(Xge,"FanMode",t)}function jge(t){Eu(Yge,"Distribution",t)}class or extends Nu{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class KI extends or{apply(e,n){return Nn(e,n)}}KI.className="Zeros";Se(KI);class _b extends or{apply(e,n){return Gs(e,n)}}_b.className="Ones";Se(_b);class XI extends or{constructor(e){if(super(),typeof e!="object")throw new te(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new te(`config must have value set but got ${e}`);this.value=e.value}apply(e,n){return le(()=>j(Be(this.value),Gs(e,n)))}getConfig(){return{value:this.value}}}XI.className="Constant";Se(XI);class YI extends or{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,n){return ol(e,this.minval,this.maxval,n,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}YI.className="RandomUniform";Se(YI);class JI extends or{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new Qe(`randomNormal does not support dType ${n}.`);return Db(e,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}JI.className="RandomNormal";Se(JI);class jI extends or{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new Qe(`truncatedNormal does not support dType ${n}.`);return pb(e,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}jI.className="TruncatedNormal";Se(jI);class ZI extends or{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,n){return le(()=>{if(e.length!==2||e[0]!==e[1])throw new te("Identity matrix initializer can only be used for 2D square matrices.");return j(this.gain,jv(e[0]))})}getConfig(){return{gain:this.gain}}}ZI.className="Identity";Se(ZI);function Zge(t,e="channelsLast"){let n,s;if(xn(e),t.length===2)n=t[0],s=t[1];else if([3,4,5].indexOf(t.length)!==-1){if(e==="channelsFirst"){const o=Pa(t,2);n=t[1]*o,s=t[0]*o}else if(e==="channelsLast"){const o=Pa(t,0,t.length-2);n=t[t.length-2]*o,s=t[t.length-1]*o}}else{const o=Pa(t);n=Math.sqrt(o),s=Math.sqrt(o)}return[n,s]}class Ys extends or{constructor(e){if(super(),e.scale<0)throw new te(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,Jge(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,jge(this.distribution),this.seed=e.seed}apply(e,n){const s=Zge(e),o=s[0],r=s[1];let i=this.scale;if(this.mode==="fanIn"?i/=Math.max(1,o):this.mode==="fanOut"?i/=Math.max(1,r):i/=Math.max(1,(o+r)/2),this.distribution==="normal"){const a=Math.sqrt(i);if(n=n||"float32",n!=="float32"&&n!=="int32")throw new Qe(`${this.getClassName()} does not support dType ${n}.`);return pb(e,0,a,n,this.seed)}else{const a=Math.sqrt(3*i);return ol(e,-a,a,n,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Ys.className="VarianceScaling";Se(Ys);class Mb extends Ys{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ys.className}}Mb.className="GlorotUniform";Se(Mb);class Fb extends Ys{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ys.className}}Fb.className="GlorotNormal";Se(Fb);class Ob extends Ys{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ys.className}}Ob.className="HeNormal";Se(Ob);class Pb extends Ys{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ys.className}}Pb.className="HeUniform";Se(Pb);class Lb extends Ys{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ys.className}}Lb.className="LeCunNormal";Se(Lb);class Vb extends Ys{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ys.className}}Vb.className="LeCunUniform";Se(Vb);class QI extends or{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,n){return le(()=>{if(e.length<2)throw new Qe("Shape must be at least 2D.");if(n!=="int32"&&n!=="float32"&&n!==void 0)throw new TypeError(`Unsupported data type ${n}.`);n=n;const s=me(e.slice(0,-1)),o=e[e.length-1],r=s*o;r>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${r}) elements: Slowness may result.`);const i=[Math.max(o,s),Math.min(o,s)],a=Db(i,0,1,n,this.seed),l=lI.qr(a,!1);let u=l[0];const h=l[1].flatten().stridedSlice([0],[Math.min(o,s)*Math.min(o,s)],[Math.min(o,s)+1]);return u=j(u,h.sign()),s<o&&(u=u.transpose()),j(Be(this.gain),u.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}QI.className="Orthogonal";Se(QI);const CO={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function TO(t,e={}){return pg(t,Io.getMap().classNameMap,e,"initializer")}function sn(t){return HI(t)}function Yt(t){if(typeof t=="string"){const e=t in CO?CO[t]:t;if(e==="GlorotNormal")return new Fb;if(e==="GlorotUniform")return new Mb;if(e==="HeNormal")return new Ob;if(e==="HeUniform")return new Pb;if(e==="LeCunNormal")return new Lb;if(e==="LeCunUniform")return new Vb;{const n={};return n.className=e,n.config={},TO(n)}}else return t instanceof or?t:TO(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function yS(t){return Array.isArray(t)&&Array.isArray(t[0])}function ex(t){return t.length===0?[]:Array.isArray(t[0])?t:[t]}function qe(t){let e;if(Array.isArray(t)){if(t.length!==1)throw new te(`Expected Tensor length to be 1; got ${t.length}`);e=t[0]}else e=t;return e}function bt(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(t.length===1)return t=t,t[0];throw new te(`Expected exactly 1 Shape; got ${t.length}`)}else return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function tx(t){let e=0;for(const n of t)n.shape.length===0?e+=1:e+=n.shape.reduce((s,o)=>s*o);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const SO="Variable";class bU{constructor(e,n="float32",s=SO,o=!0,r=null){this.dtype=n??"float32",this.shape=e.shape,this.id=hU(),s=s??SO,this.originalName=mU(s),this.name=gU(this.originalName),this.trainable_=o,this.constraint=r,this.val=nI(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),Qge(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function Qge(t,e){if(t.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(e.shape))}function xS(t){return t.map(e=>e.read())}function ek(t){t.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class En{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class Nr{constructor(e,n,s,o,r,i,a){this.dtype=e,this.shape=n,this.sourceLayer=s,this.inputs=o,this.callArgs=r,this.outputTensorIndex=a,this.id=hU(),i!=null&&(this.originalName=mU(i),this.name=gU(this.originalName)),this.rank=n.length}}let eye=0;class zb{constructor(e,n){this.callArgs=n,this.id=eye++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const s of e.inboundLayers)s!=null&&s.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const n of this.inboundLayers)n!=null?e.push(n.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let tye=0;class rt extends Nu{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=tye++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let n=e.name;if(!n){const s=this.getClassName();n=Ei(s)+"_"+$b(s)}if(this.name=n,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let s;if(e.batchInputShape!=null)s=e.batchInputShape;else if(e.inputShape!=null){let r=null;e.batchSize!=null&&(r=e.batchSize),s=[r].concat(e.inputShape)}this.batchInputShape=s;let o=e.dtype;o==null&&(o=e.inputDType),o==null&&(o="float32"),this.dtype=o}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,n){return e.name+"_ib-"+n.toString()}getNodeAtIndex(e,n){if(this.inboundNodes.length===0)throw new Qo(`The layer has never been called and thus has no defined ${n}.`);if(this.inboundNodes.length<=e)throw new te(`Asked to get ${n} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return Bs(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return Bs(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new zr(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new zr(`Layer ${this.name} is not connected, no input to return.`);return Bs(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new zr(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new zr(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Bs(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(n=>n.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const n=At(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=At(this.inputSpec);if(n.length!==s.length)throw new te(`Layer ${this.name} expects ${s.length} inputs, but it received ${n.length} input tensors. Input received: ${e}`);for(let o=0;o<n.length;o++){const r=n[o],i=s[o];if(i==null)continue;const a=r.rank;if(i.ndim!=null&&a!==i.ndim)throw new te(`Input ${o} is incompatible with layer ${this.name}: expected ndim=${i.ndim}, found ndim=${a}`);if(i.maxNDim!=null&&a>i.maxNDim)throw new te(`Input ${o} is incompatible with layer ${this.name}: expected max_ndim=${i.maxNDim}, found ndim=${a}`);if(i.minNDim!=null&&a<i.minNDim)throw new te(`Input ${o} is incompatible with layer ${this.name}: expected min_ndim=${i.minNDim}, found ndim=${a}.`);if(i.dtype!=null&&r.dtype!==i.dtype)throw new te(`Input ${o} is incompatible with layer ${this.name} : expected dtype=${i.dtype}, found dtype=${r.dtype}.`);if(i.axes){const l=r.shape;for(const u in i.axes){const d=Number(u),h=i.axes[u],p=d>=0?l[d]:l[l.length+d];if(h!=null&&[h,null].indexOf(p)===-1)throw new te(`Input ${o} is incompatible with layer ${this.name}: expected axis ${d} of input shape to have value ${h} but got shape ${l}.`)}}if(i.shape!=null)for(let l=0;l<i.shape.length;++l){const u=i.shape[l],d=r.shape[l];if(u!=null&&d!=null&&u!==d)throw new te(`Input ${o} is incompatible with layer ${this.name}: expected shape=${i.shape}, found shape=${r.shape}.`)}}}call(e,n){return e}invokeCallHook(e,n){this._callHook!=null&&this._callHook(e,n)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,n){n=n||{},this.assertNotDisposed();const s=At(e),o=oye(e),r=rye(e);if(o===r)throw new te("Arguments to apply() must be all SymbolicTensors or all Tensors");return Xl(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const i=[];for(const a of At(e))i.push(a.shape);this.build(Bs(i)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&r&&(this._refCount=1)}if(this.assertInputCompatibility(e),r){let i=this.call(e,n);this.supportsMasking&&this.setMaskMetadata(e,i);const a=At(i),l=[];for(let u of a)s.indexOf(u)!==-1&&(u=u.clone()),l.push(u);if(i=Bs(l),this.activityRegularizer!=null)throw new Qe("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}else{const i=nye(e),a=this.computeOutputShape(i);let l;const u=sye(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?i[0]:i),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((d,h)=>new Nr(u,d,this,At(e),n,this.name,h)):l=new Nr(u,a,this,At(e),n,this.name),this.addInboundNode(e,l,null,null,i,a,n),this._refCount++,this.activityRegularizer!=null)throw new Qe("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let n=!1;this.batchInputShape.forEach((s,o)=>{s!=null&&e[o]!=null&&e[o]!==s&&(n=!0)}),n&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new zr(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const n of this.inboundNodes){const s=JSON.stringify(n.outputShapes);e.indexOf(s)===-1&&e.push(s)}if(e.length===1){const n=this.inboundNodes[0].outputShapes;return Array.isArray(n)&&Array.isArray(n[0])&&n.length===1?n[0]:n}else throw new zr(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Qo(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return tx(this.weights)}build(e){this.built=!0}getWeights(e=!1){return xS(e?this.trainableWeights:this.weights)}setWeights(e){le(()=>{const n=this.weights;if(n.length!==e.length)throw new te(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${n.length} weights. Provided weights: ${e}...`);if(n.length===0)return;const s=[],o=xS(n);for(let r=0;r<o.length;++r){const i=o[r],a=n[r],l=e[r];if(!lt(i.shape,l.shape))throw new te(`Layer weight shape ${i.shape} not compatible with provided weight shape ${l.shape}`);s.push([a,l])}ek(s)})}addWeight(e,n,s,o,r,i,a,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new te(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(o=l!=null?l():Yt("zeros"));const u=o.apply(n,s),d=new bU(u,s,e,i,a);return u.dispose(),r!=null&&this.addLoss(()=>r.apply(d.read())),i==null&&(i=!0),i?this._trainableWeights.push(d):this._nonTrainableWeights.push(d),d}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=At(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,n){if(!this.supportsMasking){if(n!=null)if(Array.isArray(n))n.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return n}setMaskMetadata(e,n,s){if(!this.supportsMasking)return;const o=this.computeMask(e,s),r=At(n),i=At(o);if(r.length!==i.length)throw new Error(`${this.name} outputs ${r.length} tensors but ${r.length} masks for those tensors`);for(let a=0;a<r.length;a++)r[a].kerasMask=i[a]}addInboundNode(e,n,s,o,r,i,a=null){const l=At(e);n=At(n),s=At(s),o=At(o),r=ex(r),i=ex(i);const u=[],d=[],h=[];for(const p of l)u.push(p.sourceLayer),d.push(p.nodeIndex),h.push(p.tensorIndex);new zb({outboundLayer:this,inboundLayers:u,nodeIndices:d,tensorIndices:h,inputTensors:l,outputTensors:n,inputMasks:s,outputMasks:o,inputShapes:r,outputShapes:i},a);for(let p=0;p<n.length;p++)n[p].sourceLayer=this,n[p].nodeIndex=this.inboundNodes.length-1,n[p].tensorIndex=p}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function nye(t){t=At(t);const e=[];for(const n of t)e.push(n.shape);return Bs(e)}function sye(t){return"float32"}function wU(t,e,n){if((e==null||n!=null&&n>0)&&(e=t.sourceLayer,n=t.nodeIndex),e.inboundNodes.length===0)return[t];{const s=e.inboundNodes[n];if(s.inboundLayers.length===0)return s.inputTensors;{const o=[];for(let r=0;r<s.inboundLayers.length;r++){const i=s.inputTensors[r],a=s.inboundLayers[r],l=s.nodeIndices[r],u=wU(i,a,l);for(const d of u)o.indexOf(d)===-1&&o.push(d)}return o}}}function oye(t){let e=!0;for(const n of At(t))if(!(n instanceof Nr)){e=!1;break}return e}function rye(t){let e=!0;for(const n of At(t))if(n instanceof Nr){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class gf extends rt{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:$b("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new te("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let n=e.batchInputShape;if(n==null){if(e.inputShape==null)throw new te("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");n=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new te("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=e.dtype||"float32";this.batchInputShape=n,this.dtype=s,this.inputSpec=[{shape:n}];const o=new Nr(this.dtype,this.batchInputShape,this,[],{},this.name);o.nodeIndex=0,o.tensorIndex=0,new zb({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[n],outputShapes:[n]})}apply(e,n){throw new te(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}gf.className="InputLayer";Se(gf);function CU(t){if(t.batchShape==null&&t.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(t.batchShape!=null&&t.shape!=null)throw new te("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=t.batchShape;t.shape!=null&&e==null&&(e=[null].concat(t.shape));let n=t.dtype;return n==null&&(n="float32"),new gf({batchInputShape:e,name:t.name,dtype:n,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function iye(t,e){if(t.dtype==null||t.dtype===e.dtype)return e;try{return Ne(e,t.dtype)}catch{throw new te(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${t.name}' (${t.dtype}).`)}}class $a{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof $a)for(const n in e.id2Value)this.id2Value[n]=e.id2Value[n],n in e.id2Mask&&(this.id2Mask[n]=e.id2Mask[n]);else{if(e==null)return;for(const n of e)this.add(n.key,n.value)}}add(e,n,s){if(this.id2Value[e.id]==null)this.id2Value[e.id]=iye(e,n),this.name2Id[e.name]=e.id,s!=null&&(this.id2Mask[e.id]=s);else throw new te(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof Nr){if(this.id2Value[e.id]==null)throw new te(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const n=this.name2Id[e];if(n==null)throw new te(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[n]}}getMask(e){if(e instanceof Nr){if(this.id2Value[e.id]==null)throw new te(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const n=this.name2Id[e];if(n==null)throw new te(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[n]}}disposeMasks(){this.id2Mask!=null&&je(this.id2Mask)}}const nx=new cU,sx=new cU;function aye(t){nx!=null&&nx.setMaxEntries(t),sx!=null&&sx.setMaxEntries(t)}function Uh(t,e,n,s){const o=n==null?!1:n.training,r=Array.isArray(t),i=r?t:[t],a=i.map(b=>b.name),l=[],u=e.names();for(const b of a)u.indexOf(b)!==-1?l.push(e.getValue(b)):l.push(null);const d=a.join(",")+"|"+e.names().sort().join(",");let h=nx.get(d),p;if(h==null){const b=lye(i,e);h=b.sorted,p=b.recipientCounts,nx.put(d,h),sx.put(d,p)}p={},o||Object.assign(p,sx.get(d));const x=new $a(e);for(let b=0;b<h.length;++b){const w=h[b],C=w.sourceLayer;if(C instanceof gf)continue;const T=[],N=[],I=[];let k=!1;for(const F of w.inputs){const P=x.getValue(F),D=x.getMask(F);T.push(P),N.push(D),D!=null&&(k=!0),o||(p[F.name]--,p[F.name]===0&&!e.hasKey(F)&&a.indexOf(F.name)===-1&&!P.isDisposed&&F.sourceLayer.stateful!==!0&&I.push(P))}k&&(n=n||{},n.mask=N[0]);const A=At(C.apply(T,n));let $=null;C.supportsMasking&&($=C.computeMask(T,N));const M=cye(w),O=Array.isArray(M)?M:[M];for(let F=0;F<O.length;++F){x.hasKey(O[F])||x.add(O[F],A[F],Array.isArray($)?$[0]:$);const P=a.indexOf(O[F].name);P!==-1&&(l[P]=A[F])}o||je(I)}return x.disposeMasks(),r?l:l[0]}function lye(t,e){L(t!=null&&t.length>0,()=>"Expected at least one fetch, got none");let n=[],s={};if(t.length===1){const o=NO(t[0],e);n=o.sorted,s=o.recipientMap}else{const o=new Set;for(const r of t){const{sorted:i,recipientMap:a}=NO(r,e);for(const l of i)o.has(l.name)||(n.push(l),o.add(l.name));for(const l in a)s[l]==null&&(s[l]=new Set),a[l].forEach(u=>s[l].add(u))}}return{sorted:n,recipientCounts:uye(s)}}function uye(t){const e={};for(const n in t)e[n]=t[n].size;return e}function NO(t,e){const n=new Set,s=[],o={};for(const a of e.names())n.add(a);const r=[],i=[];for(r.push(t);r.length>0;){const a=r[r.length-1];if(n.has(a.name)){r.pop();continue}const l=i[i.length-1]===r.length-1;if(a.inputs.length===0||l)r.pop(),s.push(a),n.add(a.name),l&&i.pop();else{i.push(r.length-1);for(const u of a.inputs)o[u.name]==null&&(o[u.name]=new Set),o[u.name].add(a.name),!n.has(u.name)&&r.push(u)}}return{sorted:s,recipientMap:o}}function cye(t){let e;if(t.sourceLayer.inboundNodes.length===1)e=t.sourceLayer.output;else{let n=null;for(let s=0;s<t.sourceLayer.inboundNodes.length;++s)for(const o of t.sourceLayer.inboundNodes[s].outputTensors)if(o.id===t.id){n=s;break}e=t.sourceLayer.getOutputAt(n)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dye=ue();dye.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,aye);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function tk(t,e){return le(()=>Yn(_e(j(t,t),e,!0)))}class xg extends Nu{getConfig(){return{}}}class nk extends xg{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return le(()=>{const n=tk(e,this.axis),s=Ks(n,0,this.maxValue);return j(e,Pe(s,Te(On(),n)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}nk.className="MaxNorm";Se(nk);class sk extends xg{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return le(()=>Pe(e,Te(On(),tk(e,this.axis))))}getConfig(){return{axis:this.axis}}}sk.className="UnitNorm";Se(sk);class ok extends xg{apply(e){return Ar(e)}}ok.className="NonNeg";Se(ok);class rk extends xg{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return le(()=>{const n=tk(e,this.axis),s=Te(j(this.rate,Ks(n,this.minValue,this.maxValue)),j(1-this.rate,n));return j(e,Pe(s,Te(On(),n)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}rk.className="MinMaxNorm";Se(rk);const EO={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Pn(t){return HI(t)}function IO(t,e={}){return pg(t,Io.getMap().classNameMap,e,"constraint")}function Ln(t){if(t==null)return null;if(typeof t=="string"){const n={className:t in EO?EO[t]:t,config:{}};return IO(n)}else return t instanceof xg?t:IO(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function fye(t){return new nk(t)}function hye(t){return new sk(t)}function pye(){return new ok}function mye(t){return new rk(t)}const gye=Object.freeze(Object.defineProperty({__proto__:null,maxNorm:fye,minMaxNorm:mye,nonNeg:pye,unitNorm:hye},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function yye(){return new KI}function xye(){return new _b}function vye(t){return new XI(t)}function bye(t){return new YI(t)}function wye(t){return new JI(t)}function Cye(t){return new jI(t)}function Tye(t){return new ZI(t)}function Sye(t){return new Ys(t)}function Nye(t){return new Mb(t)}function Eye(t){return new Fb(t)}function Iye(t){return new Ob(t)}function kye(t){return new Pb(t)}function Aye(t){return new Lb(t)}function Rye(t){return new Vb(t)}function $ye(t){return new QI(t)}const Dye=Object.freeze(Object.defineProperty({__proto__:null,constant:vye,glorotNormal:Eye,glorotUniform:Nye,heNormal:Iye,heUniform:kye,identity:Tye,leCunNormal:Aye,leCunUniform:Rye,ones:xye,orthogonal:$ye,randomNormal:wye,randomUniform:bye,truncatedNormal:Cye,varianceScaling:Sye,zeros:yye},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function Na(t){if(t==null)return;const e=[],n=[],s=[];for(const o in t){const r=t[o];if(typeof r!="number"){const i=r;e.push(i.data()),n.push(o),s.push(i)}}if(e.length>0){const o=await Promise.all(e);for(let r=0;r<o.length;++r)t[n[r]]=o[r][0];je(s)}}function TU(t){if(t!=null)for(const e in t){const n=t[e];typeof n!="number"&&n.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var kO;(function(t){t[t.SILENT=0]="SILENT",t[t.VERBOSE=1]="VERBOSE"})(kO||(kO={}));const _ye=125;class Zc{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,n){}async onEpochEnd(e,n){}async onBatchBegin(e,n){}async onBatchEnd(e,n){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class SU{constructor(e,n=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=n}append(e){this.callbacks.push(e)}setParams(e){for(const n of this.callbacks)n.setParams(e)}setModel(e){for(const n of this.callbacks)n.setModel(e)}async onEpochBegin(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onEpochBegin(e,n)}async onEpochEnd(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onEpochEnd(e,n)}async onBatchBegin(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onBatchBegin(e,n)}async onBatchEnd(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onBatchEnd(e,n)}async onTrainBegin(e){e==null&&(e={});for(const n of this.callbacks)await n.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const n of this.callbacks)await n.onTrainEnd(e)}}class Mye extends Zc{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,n){n==null&&(n={});const s=n.size==null?0:n.size;this.seen+=s;for(const o in n){const r=n[o];if(typeof r=="number")this.totals.hasOwnProperty(o)||(this.totals[o]=0),this.totals[o]=this.totals[o]+r*s;else{let i;o in this.totals?i=this.totals[o]:this.totals[o]=0;const a=le(()=>Te(this.totals[o],j(r,s)));this.totals[o]=a,i!=null&&i.dispose()}}}async onEpochEnd(e,n){if(n!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?n[s]=this.totals[s]/this.seen:le(()=>{const o=j(Pe(1,this.seen),this.totals[s]);n[s]=o,this.totals[s].dispose(),Fn(n[s])}))}}class NU extends Zc{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,n){n==null&&(n={}),this.epoch.push(e);for(const s in n)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(n[s])}async syncData(){const e=[],n=[],s=[];for(const r in this.history){const i=this.history[r];for(let a=0;a<i.length;++a)if(typeof i[a]!="number"){const l=i[a];e.push(l.data()),n.push(r),s.push(a)}}const o=await Promise.all(e);for(let r=0;r<o.length;++r)this.history[n[r]][s[r]].dispose(),this.history[n[r]][s[r]]=o[r][0]}}class EU extends Zc{constructor(e,n){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||TI,this.yieldEvery=n||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=_ye),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");W0(this.yieldEvery)&&(this.maybeWait=$ge(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,n,s){const o=[];this.yield!=null&&(await Na(s),o.push(this.yield(e,n,s))),o.push(this.nextFrameFunc()),await Promise.all(o)}async onEpochBegin(e,n){this.currentEpoch=e,this.epochBegin!=null&&(await Na(n),await this.epochBegin(e,n))}async onEpochEnd(e,n){const s=[];this.epochEnd!=null&&(await Na(n),s.push(this.epochEnd(e,n))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(e,n){this.batchBegin!=null&&(await Na(n),await this.batchBegin(e,n))}async onBatchEnd(e,n){const s=[];this.batchEnd!=null&&(await Na(n),s.push(this.batchEnd(e,n))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):W0(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,e,n)),await Promise.all(s)}async onTrainBegin(e){this.trainBegin!=null&&(await Na(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await Na(e),await this.trainEnd(e))}}function IU(t,e){return t==null&&(t={}),t instanceof Zc?[t]:Array.isArray(t)&&t[0]instanceof Zc?t:At(t).map(s=>new EU(s,e))}class No{constructor(){}static registerCallbackConstructor(e,n){L(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),No.checkForDuplicate(n),No.constructors[e]==null&&(No.constructors[e]=[]),No.constructors[e].push(n)}static checkForDuplicate(e){for(const n in No.constructors)No.constructors[+n].forEach(o=>{if(o===e)throw new te("Duplicate callback constructor.")})}static clear(){No.constructors={}}static createCallbacks(e){const n=[];for(const s in No.constructors){const o=+s;e>=o&&n.push(...No.constructors[o])}return n.map(s=>new s)}}No.constructors={};function kU(t,e,n,s,o,r,i,a,l){const u=new NU,d=[new Mye,...No.createCallbacks(e)];t!=null&&d.push(...t),d.push(u);const h=new SU(d);return h.setParams({epochs:n,initialEpoch:s,samples:o,steps:r,batchSize:i,verbose:e,doValidation:a,metrics:l}),{callbackList:h,history:u}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function wr(t,e={},n=!1){return pg(t,Io.getMap().classNameMap,e,"layer",n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ox(t,e){return le(()=>{t.dtype!=="float32"&&(t=Ne(t,"float32"));const n=_e(gg(t),e,!0),s=Cu(n.shape,On()),o=Yn(ii(n,s));return Pe(t,o)})}function Iu(t,e){return le(()=>tn(gg($e(e,t)),-1))}function Bb(t,e){return le(()=>tn(Sn($e(e,t)),-1))}function yf(t,e){return le(()=>{const n=$e(t,e),s=Ks(Sn(t),On(),Number.MAX_VALUE),o=Sn(Pe(n,s));return j(100,tn(o,-1))})}function Fye(t,e){return le(()=>{const n=Ks(e,On(),Number.MAX_VALUE),s=fo(Te(1,n)),o=Ks(t,On(),Number.MAX_VALUE),r=fo(Te(1,o));return tn(gg($e(s,r)),-1)})}function Oye(t,e){return le(()=>{const n=ii(0,$e(1,j(t,e)));return tn(gg(n),-1)})}function Pye(t,e){return le(()=>{const n=ii(0,$e(1,j(t,e)));return tn(n,-1)})}function Lye(t,e){return le(()=>{const n=_e(j(t,e),-1),s=Do(j($e(1,t),e),-1);return ii(0,Te(1,$e(s,n)))})}function Vye(t,e){return le(()=>{const n=Math.log(2),s=$e(e,t),o=$e(Te(s,Tu(j(-2,s))),n);return tn(o,-1)})}function Np(t,e,n=!1){return le(()=>{if(n)e=lg(e);else{const s=_e(e,e.shape.length-1,!0);e=Pe(e,s)}return e=Ks(e,On(),1-On()),Ht(_e(j(Ne(t,"float32"),fo(e)),e.shape.length-1))})}function rx(t,e,n=!1){return le(()=>{const s=Ne(ff(Gge(t)),"int32");e=Ks(e,On(),1-On());const o=e.shape,r=ee(Kc(s,o[o.length-1]),o);return Np(r,e,n)})}function zye(t,e){if(!lt(t.shape,e.shape))throw new te(`logits and labels must have the same shape, but got shapes ${JSON.stringify(t.shape)} and ${JSON.stringify(e.shape)}`);return le(()=>{const n=Ar(e),s=Ht(Sn(e));return Te($e(n,j(e,t)),Qm(Xs(s)))})}function Ub(t,e){return le(()=>{let n;return n=Ks(e,On(),1-On()),n=fo(Pe(n,$e(1,n))),tn(zye(t,n),-1)})}function Bye(t,e){return le(()=>{const n=Ks(t,On(),1),s=Ks(e,On(),1);return _e(j(t,fo(Pe(n,s))),-1)})}function Uye(t,e){return le(()=>{const n=fo(Te(On(),e));return tn($e(e,j(t,n)),-1)})}function ik(t,e){return le(()=>{const n=ox(t,-1),s=ox(e,-1),o=j(n,s);return Ht(_e(o,-1))})}const ix={meanSquaredError:Iu,meanAbsoluteError:Bb,meanAbsolutePercentageError:yf,meanSquaredLogarithmicError:Fye,squaredHinge:Oye,hinge:Pye,categoricalHinge:Lye,logcosh:Vye,categoricalCrossentropy:Np,sparseCategoricalCrossentropy:rx,binaryCrossentropy:Ub,kullbackLeiblerDivergence:Bye,poisson:Uye,cosineProximity:ik};function nT(t){if(typeof t=="string"){if(t in ix)return ix[t];let e=`Unknown loss ${t}`;throw t.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${t}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new te(e)}else return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ak(t,e){return le(()=>{const n=j(.5,ho(e)),s=Qr(Ps(e,n),t.dtype);return tn(co(t,s),-1)})}function lk(t,e){return le(()=>Qr(co(nu(t,-1),nu(e,-1)),"float32"))}function AU(t,e){return le(()=>Ne(_e(nr(co(t,1),co(e,1))),"float32"))}function Gye(t,e){return le(()=>Ne(_e(nr(co(t,1),co(e,0))),"float32"))}function Hye(t,e){return le(()=>Ne(_e(nr(co(t,0),co(e,1))),"float32"))}function RU(t,e){return le(()=>{const n=AU(t,e),s=Hye(t,e),o=Te(n,s);return Ne(Kn(Ps(o,0),Pe(n,o),0),"float32")})}function Wye(t,e){return le(()=>{const n=AU(t,e),s=Gye(t,e),o=Te(n,s);return Ne(Kn(Ps(o,0),Pe(n,o),0),"float32")})}function $U(t,e){return Ub(t,e)}function DU(t,e){return t.rank===e.rank&&(t=rl(t,[t.rank-1])),e=nu(e,-1),e.dtype!==t.dtype&&(e=Ne(e,t.dtype)),Ne(co(t,e),"float32")}const qye=Iu,Kye=Iu,Xye=Bb,Yye=Bb,Jye=yf,jye=yf,uk=Np,Zye=ik,_U=rx,ax={binaryAccuracy:ak,categoricalAccuracy:lk,precision:RU,categoricalCrossentropy:uk,sparseCategoricalCrossentropy:_U,mse:qye,MSE:Kye,mae:Xye,MAE:Yye,mape:Jye,MAPE:jye,cosine:Zye};function Qye(t){if(typeof t=="string"&&t in ax)return ax[t];if(typeof t!="string"&&t!=null)return t;throw new te(`Unknown metric ${t}`)}function e0(t){if(Br(t!==null,`Unknown LossOrMetricFn ${t}`),typeof t=="string")return t;{let e;for(const n of Object.keys(ix))if(ix[n]===t){e=n;break}if(e!==void 0)return e;for(const n of Object.keys(ax))if(ax[n]===t){e=n;break}return e!==void 0?e:t.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function e0e(t){const e={Adagrad:()=>_l.adagrad(.01),Adadelta:()=>_l.adadelta(1,.95,On()),Adam:()=>_l.adam(.001,.9,.999,On()),Adamax:()=>_l.adamax(.002,.9,.999,On(),0),RMSProp:()=>_l.rmsprop(.001,.9,0,On()),SGD:()=>_l.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,t in e)return e[t]();throw new te(`Unknown Optimizer ${t}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const AO=1*1024*1024;function RO(t,e,n=!1){if(t==null||typeof t!="object"||Object.getPrototypeOf(t)!==Object.prototype||!vS(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const s=JSON.stringify(t);s.length>AO&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${AO}.`)}}function vS(t){if(t===null)return!0;if(typeof t=="object")if(Object.getPrototypeOf(t)===Object.prototype){const e=Object.keys(t);for(const n of e)if(typeof n!="string"||!vS(t[n]))return!1;return!0}else if(Array.isArray(t)){for(const e of t)if(!vS(e))return!1;return!0}else return!1;else{const e=typeof t;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function t0e(t,e,n,s=console.log){const o=s0e(t),r=["Layer (type)","Input Shape","Output shape","Param #"];o?(e=e||90,n=n||[.32,.61,.89,1]):(e=e||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map(d=>Math.floor(e*d)));let i;if(!o){r.push("Receives inputs"),i=[];for(const d in t.nodesByDepth)i.push(...t.nodesByDepth[d])}s("_".repeat(e)),lx(r,n,s),s("=".repeat(e));const a=t.layers;for(let d=0;d<a.length;++d)o?o0e(a[d],n,s):r0e(a[d],n,i,s),s((d===a.length-1?"=":"_").repeat(e));t.checkTrainableWeightsConsistency();const l=n0e(t),u=tx(t.nonTrainableWeights);s(`Total params: ${l+u}`),s(`Trainable params: ${l}`),s(`Non-trainable params: ${u}`),s("_".repeat(e))}function n0e(t){let e;return t.collectedTrainableWeights!=null?e=tx(t.collectedTrainableWeights):e=tx(t.trainableWeights),e}function s0e(t){let e=!0;const n=[],s=[];for(const o in t.nodesByDepth)n.push(t.nodesByDepth[o]);for(const o of n){if(o.length>1||o.length===1&&o[0].inboundLayers.length>1){e=!1;break}s.push(...o)}if(e)for(const o of t.layers){let r=!1;for(const i of o.inboundNodes)if(s.indexOf(i)!==-1)if(r){e=!1;break}else r=!0;if(!e)break}return e}function lx(t,e,n=console.log){let s="";for(let o=0;o<t.length;++o)o>0&&(s=s.slice(0,s.length-1)+" "),s+=t[o],s=s.slice(0,e[o]),s+=" ".repeat(e[o]-s.length);n(s)}function o0e(t,e,n){let s,o;try{o=t.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{o="multiple"}try{s=JSON.stringify(t.outputShape)}catch{s="multiple"}const r=t.name,i=t.getClassName(),a=[`${r} (${i})`,o,s,t.countParams().toString()];lx(a,e,n)}function r0e(t,e,n,s){let o,r;try{r=t.inboundNodes.map(h=>JSON.stringify(h.inputShapes)).join(",")}catch{r="multiple"}try{o=JSON.stringify(t.outputShape)}catch{o="multiple"}const i=[];for(const h of t.inboundNodes)if(!(n!=null&&n.length>0&&n.indexOf(h)===-1))for(let p=0;p<h.inboundLayers.length;++p){const x=h.inboundLayers[p].name,b=h.nodeIndices[p],w=h.tensorIndices[p];i.push(`${x}[${b}][${w}]`)}const a=t.name,l=t.getClassName(),u=i.length===0?"":i[0],d=[`${a} (${l})`,r,o,t.countParams().toString(),u];lx(d,e,s);for(let h=1;h<i.length;++h)lx(["","","","",i[h]],e,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function MU(t,e,n){return(t==="inboundNodes"||t==="outputLayers"||t==="inputLayers")&&e===0&&typeof n=="string"}function Ep(t,e){if(t===null)return null;if(typeof t=="string")return Ol(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){const n=[],s=t.length;for(let o=0;o<s;++o){const r=t[o];MU(e,o,r)?n.push(r):n.push(Ep(r,e))}return n}else{const n={};for(const s of Object.keys(t)){const o=t[s];if(s==="name"&&typeof o=="string")n[s]=o;else{const r=Ol(s);n[r]=Ep(o,r)}}return n}}function bS(t,e){if(t==null)return null;if(typeof t=="string")return Ei(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){const n=[],s=t.length;for(let o=0;o<s;++o){const r=t[o];MU(e,o,r)?n.push(r):n.push(bS(r,e))}return n}else{const n={};for(const s of Object.keys(t)){const o=t[s],r=Ei(s);(s==="name"||s==="className")&&typeof o=="string"?n[r]=o:n[r]=bS(o,s)}return n}}/** @license See the LICENSE file. */const Gb="4.20.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const i0e=t=>{const e=Object.keys(t);if(e.length===0)return!1;const n=e[0].split("/");return!isNaN(parseInt(n[n.length-1],10))};class pr extends rt{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const N=this.getClassName().toLowerCase();this.name=$b(N)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],Oa(this.inputs).length!==this.inputs.length)throw new te(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(N=>N.name)}`);Oa(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(N=>N.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const N of this.outputs){const I=N.sourceLayer,k=N.nodeIndex,A=N.tensorIndex;this.outputLayers.push(I),this.outputLayersNodeIndices.push(k),this.outputLayersTensorIndices.push(A)}for(const N of this.inputs){const I=N.sourceLayer,k=N.nodeIndex,A=N.tensorIndex;Br(k===0,"input layer has >1 nodes"),Br(A===0,"input layer has >1 tensors"),this.inputLayers.push(I),this.inputLayersNodeIndices.push(k),this.inputLayersTensorIndices.push(A)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let N=0;N<this.inputLayers.length;N++){const I=this.inputLayers[N];if(!(I instanceof gf))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${N} (0-based) originates from layer type ${I.getClassName()}.`);this.inputNames.push(I.name),this.feedInputShapes.push(I.batchInputShape),this.feedInputNames.push(I.name)}for(const N of this.outputLayers)this.outputNames.push(N.name);this.internalInputShapes=this.inputs.map(N=>N.shape),this.internalOutputShapes=this.outputs.map(N=>N.shape);const n={},s={},o={},r={},i={},a=[],l=(N,I,k,A,$,M)=>{(A==null||$==null||M==null)&&(A=N.sourceLayer,$=N.nodeIndex,M=N.tensorIndex);const O=A.inboundNodes[$];if(k.indexOf(O)!==-1)throw new Qo(`The tensor ${N.name} at layer "${A.name}" is part of a cycle.`);if(I.indexOf(O)!==-1)return;this.containerNodes.add(pr.nodeKey(A,$)),A.id in i||(i[A.id]=Object.keys(i).length),k.indexOf(O)===-1&&k.push(O);const F=O.inboundLayers.length;for(let P=0;P<F;P++){const D=O.inputTensors[P],H=O.inboundLayers[P],Z=O.nodeIndices[P],ne=O.tensorIndices[P];l(D,I,k,H,Z,ne)}for(I.push(O);k.indexOf(O)>=0;)k.splice(k.indexOf(O),1);a.push(O)},u=[],d=[];for(const N of this.outputs)l(N,u,d);const h=a.slice().reverse();for(const N of h){s[N.id]=N,N.id in n||(n[N.id]=0);let I=n[N.id];const k=o[N.outboundLayer.id]==null?0:o[N.outboundLayer.id];I=Math.max(I,k),o[N.outboundLayer.id]=I,r[N.outboundLayer.id]=N.outboundLayer,n[N.id]=I;for(let A=0;A<N.inboundLayers.length;A++){const $=N.inboundLayers[A],M=N.nodeIndices[A],O=$.inboundNodes[M],F=n[O.id]==null?0:n[O.id];n[O.id]=Math.max(I+1,F),s[O.id]=O}}const p={};for(const N in n){const I=n[N];I in p||(p[I]=[]),p[I].push(s[N])}const x={};for(const N in o){const I=o[N];I in x||(x[I]=[]),x[I].push(r[N])}let b=Object.keys(x).map(N=>parseInt(N,10)).sort(jy);this.layers=[];for(const N of b){const I=x[N];I.sort((k,A)=>{const $=i[k.id],M=i[A.id];return $<M?-1:$>M?1:0});for(const k of I)k instanceof pr&&this.internalContainerRefs.push(k),this.layers.push(k)}this.layersByDepth=x,b=Object.keys(p).map(N=>parseInt(N,10)).sort(jy);const w=this.inputs.slice(),C=[];for(const N of b)for(const I of p[N]){const k=I.outboundLayer;if(k!=null){for(const A of I.inputTensors)if(w.indexOf(A)===-1)throw new Qo(`Graph disconnected: cannot obtain value for tensor ${A} at layer "${k.name}". The following previous layers were accessed without issue: ${C}`);for(const A of I.outputTensors)w.push(A);C.push(k.name)}}this.nodesByDepth=p;const T=this.layers.map(N=>N.name);for(const N of T){const I=T.filter(k=>k===N).length;if(I!==1)throw new Qo(`The name "${N}" is used ${I} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(T))}this.outboundNodes=[],this.inboundNodes=[],new zb({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(N=>null),outputMasks:this.outputs.map(N=>null),inputShapes:this.inputs.map(N=>N.shape),outputShapes:this.outputs.map(N=>N.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const n of this.layers)e.numDisposedVariables+=n.dispose().numDisposedVariables;for(const n of this.internalContainerRefs)e.numDisposedVariables+=n.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(n=>{n._trainableWeights.forEach(s=>s.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new te("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const n of this.layers)e=e.concat(n.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const n of this.layers)e.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const s of this.layers)n.push(...s.trainableWeights);return n.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,n=!0){const s={};let o=0;const r=i0e(e);r&&this.parseWeights(e);for(const a of this.layers)for(const[l,u]of a.weights.entries()){const d=r?`${u.name.split("/").slice(0,-1).join("/")+"/"}${l}`:u.originalName;if(s[d]!=null)throw new te(`Duplicate weight name: ${d}`);s[d]=u,o++}const i=[];for(const a in e){let l=a;if(s[a]==null){const u=a.split("/");l=u.slice(0,-2).concat([u[u.length-1]]).join("/")}if(s[l]!=null)i.push([s[l],e[a]]);else if(n)throw new te(`Provided weight data has no target variable: ${a}`);delete s[l]}if(n){const a=[];for(const l in s)a.push(l);if(a.length>0)throw new te(`${a.length} of ${o} weights are not set: ${a}`)}ek(i)}parseWeights(e){for(const n in Object.keys(e)){const s=n.split("/"),o=["vars","layer_checkpoint_dependencies"],r=s.map(i=>i.startsWith("_")?i.slice(1):i).filter(i=>!o.includes(i)).join("/");r!==n&&(e[r]=e[n],delete e[n])}}updatedConfig(){const e=this.getConfig(),n={};return n.className=this.getClassName(),n.config=e,n.kerasVersion=`tfjs-layers ${Gb}`,n.backend="TensorFlow.js",n}toJSON(e,n=!0){const s=bS(this.updatedConfig());return n?JSON.stringify(s):s}call(e,n){return le(()=>{e=At(e);const s=new $a;for(let o=0;o<this.inputs.length;++o)s.add(this.inputs[o],e[o]);return Uh(this.outputs,s,n)})}computeMask(e,n){return le(()=>{e=At(e);let s;return n==null?s=lu(null,e.length):s=At(n),this.runInternalGraph(e,s)[1]})}computeOutputShape(e){const n=ex(e);if(n.length!==this.inputLayers.length)throw new te(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let a=0;a<n.length;a++){const l=this.inputLayers[a],u=n[a],d=l.name+"_0_0";s[d]=u}const o=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(jy);if(o.length>1)for(const a of o){const l=this.nodesByDepth[a];for(const u of l){const d=u.outboundLayer;if(this.inputLayers.map(w=>w.id).indexOf(d.id)!==-1)continue;const h=[];for(let w=0;w<u.inboundLayers.length;w++){const C=u.inboundLayers[w],T=u.nodeIndices[w],N=u.tensorIndices[w],I=`${C.name}_${T}_${N}`,k=s[I];h.push(k)}const p=d.computeOutputShape(Bs(h)),x=ex(p),b=d.inboundNodes.indexOf(u);for(let w=0;w<x.length;w++){const C=`${d.name}_${b}_${w}`;s[C]=x[w]}}}const r=[],i=[];for(let a=0;a<this.outputLayers.length;a++){const l=this.outputLayers[a],u=this.outputLayersNodeIndices[a],d=this.outputLayersTensorIndices[a],h=`${l.name}_${u}_${d}`;i.push(h)}for(let a=0;a<i.length;a++){const l=i[a];Br(l in s),r.push(s[l])}return Bs(r)}runInternalGraph(e,n){n==null&&(n=lu(null,e.length));const s={};for(let l=0;l<this.inputs.length;++l){const u=this.inputs[l],d=e[l],h=n[l];s[u.id]=[d,h]}const o=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(jy);for(const l of o){const u=this.nodesByDepth[l];for(const d of u){const h=d.outboundLayer,p=d.inputTensors,x=d.outputTensors,b=new Array;for(const w of p)w.id in s&&b.push(s[w.id]);if(b.length===p.length){let w={},C,T,N,I;if(d.callArgs!=null&&(w=d.callArgs),b.length===1){const[k,A]=b[0];w.mask==null&&(w.mask=A),N=At(h.call(k,w)),I=At(h.computeMask(k,A)),C=[k],T=[A]}else C=b.map(k=>k[0]),T=b.map(k=>k[1]),w.mask==null&&(w.mask=T),N=At(h.call(C,w)),I=At(h.computeMask(C,T));if(h.activityRegularizer)throw new Qe("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let k=0;k<x.length;++k){const A=x[k],$=N[k],M=I[k];s[A.id]=[$,M]}}}}const r=[],i=[],a=[];for(const l of this.outputs){Br(l.id in s,`Could not compute output ${l.name} : ${l.id}`);const[u,d]=s[l.id];a.push(u.shape),r.push(u),i.push(d)}return[r,i,a]}buildNodeConversionMap(e){const n={};let s;for(const o of this.layers){s=o instanceof pr?1:0;for(let r=0;r<o.inboundNodes.length;r++){const i=pr.nodeKey(o,r);this.containerNodes.has(i)&&(n[i]=s,s+=1)}}return n}getLayer(e,n){if(n!=null)return this.findLayer(n);if(e==null)throw new te("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const s of this.layers)if(s.name===e)return s;throw new te(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new te(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return le(()=>{const e=[];for(const n of this.layers)for(let s=0;s<n.inboundNodes.length;++s){const o=pr.nodeKey(n,s);this.containerNodes.has(o)&&e.push(...n.calculateLosses())}return e})}getConfig(){const e={name:this.name},n=this.buildNodeConversionMap(this.layers),s=[];for(const i of this.layers){const a=i.getClassName(),l=i.getConfig(),u=[];for(let h=0;h<i.inboundNodes.length;h++){const p=i.inboundNodes[h],x=pr.nodeKey(i,h);let b={};if(this.containerNodes.has(x)){if(p.callArgs)try{JSON.stringify(p.callArgs),b=p.callArgs}catch{console.warn(`Layer ${i.name} was passed non-serializable keyword arguments: ${p.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),b={}}if(p.inboundLayers.length>0){const w=[];for(let C=0;C<p.inboundLayers.length;C++){const T=p.inboundLayers[C],N=p.nodeIndices[C],I=p.tensorIndices[C],k=pr.nodeKey(T,N);let A=n[k];A==null&&(A=0),w.push([T.name,A,I,b])}u.push(w)}}}const d={};d.name=i.name,d.className=a,d.config=l,d.inboundNodes=u,s.push(d)}e.layers=s;const o=[];for(let i=0;i<this.inputLayers.length;i++){const a=this.inputLayers[i],l=this.inputLayersNodeIndices[i],u=pr.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let d=n[u];d==null&&(d=0);const h=this.inputLayersTensorIndices[i];o.push([a.name,d,h])}e.inputLayers=o;const r=[];for(let i=0;i<this.outputLayers.length;i++){const a=this.outputLayers[i],l=this.outputLayersNodeIndices[i],u=pr.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let d=n[u];d==null&&(d=0);const h=this.outputLayersTensorIndices[i];r.push([a.name,d,h])}return e.outputLayers=r,e}static fromConfig(e,n,s={},o=!1){const r={},i={};function a(C,T){C.name in i?i[C.name].push(T):i[C.name]=[T]}function l(C,T){const N=[];let I;for(const k of T){const A=k[0],$=k[1],M=k[2];if(I=k[3]==null?{}:k[3],!(A in r)){a(C,T);return}const O=r[A];if(O.inboundNodes.length<=$){a(C,T);return}const F=O.inboundNodes[$];N.push(F.outputTensors[M])}N.length>0&&C.apply(Bs(N),I)}function u(C){const T=C.name,N=wr(C,n.customObjects!=null?n.customObjects:{});N.setFastWeightInitDuringBuild(o),r[T]=N,C.inboundNodes.forEach(k=>{if(!(k instanceof Array))throw new te(`Corrupted configuration, expected array for nodeData: ${k}`);a(N,k)})}const d=n.name,h=n.layers;for(const C of h)u(C);for(;!Rge(i);)for(const C of h){const T=r[C.name];if(T.name in i){const N=i[T.name];delete i[T.name];for(const I of N)l(T,I)}}const p=[],x=[],b=n.inputLayers;for(const C of b){const T=C[0],N=C[1],I=C[2];Br(T in r);const A=r[T].inboundNodes[N].outputTensors;p.push(A[I])}const w=n.outputLayers;for(const C of w){const T=C[0],N=C[1],I=C[2];Br(T in r);const A=r[T].inboundNodes[N].outputTensors;x.push(A[I])}return new e({inputs:p,outputs:x,name:d})}get stateful(){if(this._stateful)throw new te("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){le(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function a0e(t,e,n){const s=e.length;if(t==null||Array.isArray(t)&&t.length===0)return e.map(o=>null);if(s===1)return Array.isArray(t)&&t.length===1?t:typeof t=="object"&&e[0]in t?[t[e[0]]]:[t];if(Array.isArray(t)){if(t.length!==s)throw new Error(`Provided ${n} is an array of ${t.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return t}else if(typeof t=="object"&&Object.keys(t).length>0&&typeof t[Object.keys(t)[0]]=="object"){const o=[];return e.forEach(r=>{r in t?o.push(t[r]):o.push(null)}),o}else throw new Error(`The model has multiple (${s}) outputs, so ${n} must be either an array with ${s} elements or an object with ${e} keys. Provided ${n} not understood: ${JSON.stringify(t)}`)}function FU(t,e){return a0e(t,e,"classWeight")}async function OU(t,e,n,s){if(n!=null){const o=le(()=>{if(t.shape.length===1)return jr(t);if(t.shape.length===2){if(t.shape[1]>1)return nu(t,1);if(t.shape[1]===1)return ee(t,[t.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${t.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${t.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),r=Array.from(await o.data());je(o);const i=[];return r.forEach(a=>{if(n[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);i.push(n[a])}),us(i,"float32")}else return null}function l0e(t,e){return j(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const u0e=32;function PU(t,e){let n,s;const o=e;n=o.xs,s=o.ys,L(n!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const r=$O("input",t.inputNames,n),i=$O("output",t.outputNames,s),a=r[0].shape[0];L(r.length===t.inputs.length,()=>`LayersModel has ${t.inputs.length} inputs, but the dataset provides ${r.length} inputs.  (Expected input keys: ${JSON.stringify(t.inputNames)})`),L(i.length===t.outputs.length,()=>`LayersModel has ${t.outputs.length} outputs, but the dataset provides ${i.length} outputs.  (Expected output keys: ${JSON.stringify(t.outputNames)})`);for(let l=0;l<r.length;l++)L(r[l].shape[0]===a,()=>`Batch size mismatch: input ${t.inputNames[l]} has ${r[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);for(let l=0;l<i.length;l++)L(i[l].shape[0]===a,()=>`Batch size mismatch: output ${t.outputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);return{xs:r,ys:i}}function $O(t,e,n){if(n instanceof yt)return[n];if(Array.isArray(n))return L(n.length===e.length,()=>`Received an array of ${n.length} Tensors, but expected ${e.length} to match the ${t} keys ${e}.`),n;{const s=[];for(const o of e){if(n[o]==null)throw new te(`The feature data generated by the dataset lacks the required ${t} key '${o}'.`);s.push(n[o])}return s}}function c0e(t){if(t.length===3)throw new Qe("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}async function d0e(t,e,n){const s=n.batchesPerEpoch!=null;if(L(t.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),L(n!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),L(n.epochs!=null&&n.epochs>0&&Number.isInteger(n.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`),L(!s||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`),L(n.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;try{const o=n.validationData!=null;let r,i;if(o)if(DO(n.validationData))L(n.validationBatches==null||n.validationBatches>0&&Number.isInteger(n.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`);else{const C=c0e(n.validationData);r=C.xs,i=C.ys}const a=t.makeTrainFunction(),l=t.getDedupedMetricsNames();let u;o?u=l.slice().concat(l.map(C=>"val_"+C)):u=l.slice();const d=IU(n.callbacks,n.yieldEvery),h=n.verbose==null?1:n.verbose,{callbackList:p,history:x}=kU(d,h,n.epochs,null,null,f0e(e,n),null,o,u);p.setModel(t),t.history=x,await p.onTrainBegin(),t.stopTraining_=!1;let b=n.initialEpoch==null?0:n.initialEpoch,w=await e.iterator();for(;b<n.epochs;){const C={};await p.onEpochBegin(b);let T=0,N=0;for(s||(w=await e.iterator());!s||T<n.batchesPerEpoch;){const I=await w.next();if(s&&I.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${T} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${n.batchesPerEpoch*n.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(I.value!=null){const{xs:k,ys:A}=PU(t,I.value),$={};$.batch=N,$.size=k[0].shape[0],await p.onBatchBegin(N,$);const M=[];if(n.classWeight!=null){const P=FU(n.classWeight,t.outputNames);for(let D=0;D<P.length;++D)M.push(await OU(A[D],null,P[D]))}const O=k.concat(A).concat(M),F=a(O);je(O);for(let P=0;P<l.length;++P){const D=l[P],H=F[P];$[D]=H,Fn(H)}await p.onBatchEnd(N,$),TU($),N++,T++}if(s?T>=n.batchesPerEpoch:I.done){if(o){let k;DO(n.validationData)?k=At(await t.evaluateDataset(n.validationData,{batches:n.validationBatches})):k=At(t.evaluate(r,i,{batchSize:n.validationBatchSize==null?u0e:n.validationBatchSize,verbose:0}));for(let A=0;A<t.metricsNames.length;++A)C[`val_${t.metricsNames[A]}`]=k[A]}break}if(t.stopTraining_)break}if(await p.onEpochEnd(b,C),b++,t.stopTraining_)break}return await p.onTrainEnd(),await t.history.syncData(),t.history}finally{t.isTraining=!1}}function f0e(t,e){let n=null;return e.batchesPerEpoch!=null?n=e.batchesPerEpoch:Number.isFinite(t.size)&&(n=t.size),n}function DO(t){return typeof t.iterator=="function"}function h0e(t){return typeof t.next=="function"}async function p0e(t,e,n){n=n||{};const s=n.batches!=null,o=t.testFunction;let r=[];if(n.verbose>0)throw new Qe("Verbose mode is not implemented yet.");L(!s||n.batches>0&&Number.isInteger(n.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`);const i=h0e(e)?e:await e.iterator();let a=0,l=0;for(;!s||l<n.batches;){const u=await i.next();if(r=le(()=>{if(u.value){const{xs:d,ys:h}=PU(t,u.value),p=d.concat(h),x=le(()=>o(p));if(je(p),l===0)for(let w=0;w<x.length;++w)r.push(Be(0));const b=p[0].shape[0];for(let w=0;w<x.length;++w){const C=x[w],T=r[w];r[w]=le(()=>Te(r[w],j(b,C))),l>0&&je(T)}je(x),a+=b,++l}return r}),u.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let u=0;u<r.length;++u){const d=r[u];r[u]=Pe(r[u],a),je(d)}return Bs(r)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function sT(t){L(t>0&&Number.isInteger(t),()=>`batchSize is required to be a positive integer, but got ${t}`)}function Dh(t,e,n){return t==null?[null]:Array.isArray(t)?t.map(s=>Yl(s,e,n-e)):Yl(t,e,n-e)}function wS(t,e){return le(()=>t==null?null:Array.isArray(t)?t.map(n=>wS(n,e)):xU(t,e.dtype==="int32"?e:Ne(e,"int32")))}function oT(t,e){const n=[];let s=0,o=null;for(;s<t;)o=s+e,o>=t&&(o=t),n.push([s,o]),s=o;return n}function LU(t){const e=[];t instanceof yt&&(t=[t]);for(let n=0;n<t.length;++n){const s=t[n];if(s.rank===1)e.push(mg(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(s)}}return e}function dr(t,e){if(t==null)return;const n=[];if(e instanceof yt)n.push(e.id);else if(Array.isArray(e))e.forEach(o=>n.push(o.id));else if(e!=null)for(const o in e){const r=e[o];n.push(r.id)}const s=[];if(t instanceof yt)n.indexOf(t.id)===-1&&s.push(t);else if(Array.isArray(t))t.forEach(o=>{n.indexOf(o.id)===-1&&s.push(o)});else if(t!=null)for(const o in t){const r=t[o];n.indexOf(r.id)===-1&&s.push(r)}s.forEach(o=>{o.isDisposed||o.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function m0e(t){return t instanceof yt}function CS(t){return Array.isArray(t)}function _O(t){return!m0e(t)&&!CS(t)}function MO(t,e,n,s=!0,o=""){if(e==null||e.length===0){if(t!=null){let i=!1;if(CS(t)&&t.length>0)i=!0;else if(_O(t)){for(const a in t)if(t.hasOwnProperty(a)){i=!0;break}}else i=!0;if(i)throw new te(`Error when checking model ${o} expected no data, but got ${t}`)}return[]}if(t==null)return e.map(i=>null);let r;if(_O(t)){t=t,r=[];for(const i of e){if(t[i]==null)throw new te(`No data provided for "${i}". Need data for each key in: ${e}`);r.push(t[i])}}else if(CS(t)){if(t=t,t.length!==e.length)throw new te(`Error when checking model ${o}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${t}`);r=t}else{if(t=t,e.length>1)throw new te(`The model ${o} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${t.shape}`);r=[t]}if(r=LU(r),n!=null)for(let i=0;i<e.length;++i){if(n[i]==null)continue;const a=r[i];if(a.shape.length!==n[i].length)throw new te(`Error when checking ${o}: expected ${e[i]} to have ${n[i].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<n[i].length;++l){if(l===0&&!s)continue;const u=a.shape[l],d=n[i][l];if(d!=null&&d>=0&&u!==d)throw new te(`${o} expected a batch of elements where each example has shape [${n[i].slice(1,n[i].length)}] (i.e.,tensor shape [*,${n[i].slice(1,n[i].length)}]) but the ${o} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return r}function g0e(t,e,n){const s=Oa(t.map(r=>r.shape[0]));s.sort();const o=Oa(e.map(r=>r.shape[0]));if(o.sort(),s.length>1)throw new te(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(r=>r.shape))}`);if(o.length>1)throw new te(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(r=>r.shape))}`);if(s.length>0&&o.length>0&&!lt(s,o))throw new te(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${o[0]} target sample(s).`)}function y0e(t,e,n){const s=[Iu,Ub,Np];for(let o=0;o<t.length;++o){const r=t[o],i=e[o],a=n[o];if(i!=null){if(i===Np&&r.shape[r.shape.length-1]===1)throw new te(`You are passing a target array of shape ${r.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(i)!==-1){const l=r.shape.slice(1),u=a.slice(1);for(let d=0;d<l.length;++d){const h=l[d],p=u[d];if(p!=null&&h!==p)throw new te(`A target Tensor with shape ${r.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function FO(t,e,n,s=!0,o=""){let r;if(Array.isArray(t)){if(t.length!==e.length)throw new te(`Error when checking model ${o}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${t.length} Tensors(s).`);r=t}else{if(e.length>1)throw new te(`The model expects ${e.length} ${o} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(t.shape)}.`);r=[t]}if(n!=null)for(let i=0;i<e.length;++i){if(n[i]==null)continue;const a=r[i];if(a.shape.length!==n[i].length)throw new te(`Error when checking ${o}: expected ${e[i]} to have ${n[i].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<n[i].length;++l){if(l===0&&!s)continue;const u=a.shape[l],d=n[i][l];if(d!=null&&d!==u)throw new te(`Error when checking ${o}: expected ${e[i]} to have shape ${JSON.stringify(n[i])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function x0e(t,e){if(t==null||Array.isArray(t)&&t.length===0)return e.map(s=>[]);let n;if(typeof t=="string"||typeof t=="function")n=[t];else if(Array.isArray(t)||typeof t=="object")n=t;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${t}`);if(Array.isArray(n))return e.map(s=>n);{const s=[];for(const o of e){let r=n.hasOwnProperty(o)?n[o]:[];Array.isArray(r)||(r=[r]),s.push(r)}return s}}const v0e="layers-model";class $i extends pr{constructor(e){super(e),this.isTraining=!1}summary(e,n,s=console.log){if(!this.built)throw new te("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");t0e(this,e,n,s)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=e0e(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Ji))throw new te("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let n=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const i in e.loss)if(this.outputNames.indexOf(i)===-1)throw new te(`Unknown entry in loss dictionary: "${i}". Only expected the following keys: ${this.outputNames}`);for(const i of this.outputNames)e.loss[i]==null&&console.warn(`Output "${i}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${i} during training`),n.push(nT(e.loss[i]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new te(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);n=e.loss.map(a=>nT(a))}else{const i=nT(e.loss);this.outputs.forEach(a=>{n.push(i)})}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let i=0;i<this.outputs.length;++i){const a=this.internalOutputShapes[i],l=this.outputNames[i];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[i])}const s=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Xl("loss",()=>{for(let i=0;i<this.outputs.length;++i){if(s.indexOf(i)!==-1)continue;const a=this.lossFunctions[i];this.outputs.length>1&&(this.metricsTensors.push([a,i]),this.metricsNames.push(this.outputNames[i]+"_loss"))}});const o=x0e(e.metrics,this.outputNames),r=(i,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[i]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,i])};Xl("metric",()=>{for(let i=0;i<this.outputs.length;++i){if(s.indexOf(i)!==-1)continue;const a=o[i];(u=>{let h,p,x;for(const b of u){if(typeof b=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(b)!==-1){const C=this.internalOutputShapes[i];C[C.length-1]===1||this.lossFunctions[i]===Ub?["accuracy","acc"].indexOf(b)!==-1?p=ak:["crossentropy","ce"].indexOf(b)!==-1&&(p=$U):this.lossFunctions[i]===rx?["accuracy","acc"].indexOf(b)!==-1?p=DU:["crossentropy","ce"].indexOf(b)!==-1&&(p=_U):["accuracy","acc"].indexOf(b)!==-1?p=lk:["crossentropy","ce"].indexOf(b)!==-1&&(p=uk);let T;["accuracy","acc"].indexOf(b)!==-1?T="acc":["crossentropy","ce"].indexOf(b)!==-1&&(T="ce"),x=p,h=""+T}else x=Qye(b),h=""+e0(b);let w;Xl(h,()=>{w=x}),r(i,h,w)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,n,s={}){const o=s.batchSize==null?32:s.batchSize;sT(o);const i=this.standardizeUserDataXY(e,n,!0,o);try{const a=i[0].concat(i[1]);this.makeTestFunction();const l=this.testFunction,u=this.testLoop(l,a,o,s.verbose,s.steps);return Bs(u)}finally{dr(i[0],e),dr(i[1],n)}}async evaluateDataset(e,n){return this.makeTestFunction(),p0e(this,e,n)}checkNumSamples(e,n,s,o="steps"){let r;if(s!=null){if(r=null,n!=null)throw new te(`If ${o} is set, batchSize must be null or undefined.Got batchSize = ${n}`)}else if(e!=null)Array.isArray(e)?r=e[0].shape[0]:r=e.shape[0];else throw new te(`Either the input data should have a defined shape, or ${o} shoud be specified.`);return r}execute(e,n){if(Array.isArray(n)&&n.length===0)throw new te("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(n),o=s?n:[n],r=this.retrieveSymbolicTensors(o),i=new $a;if(e instanceof yt&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new te(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)i.add(this.inputs[l],e[l])}else for(const l of this.inputs){const u=e[l.name];if(u==null)throw new te(`No value is provided for the model's input ${l.name}`);i.add(l,u)}const a=Uh(r,i);return s?a:a[0]}retrieveSymbolicTensors(e){const n=lu(null,e.length);let s=e.length;for(const o of this.layers){const r=Array.isArray(o.output)?o.output:[o.output],i=r.map(a=>a.name);for(let a=0;a<e.length;++a){const l=i.indexOf(e[a]);if(l!==-1&&(n[a]=r[l],s--),s===0)break}if(s===0)break}if(s>0){const o=[];throw n.forEach((r,i)=>{r==null&&o.push(e[i])}),new te(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(o)}`)}return n}predictLoop(e,n=32,s=!1){return le(()=>{const o=this.checkNumSamples(e);if(s)throw new Qe("Verbose predictLoop() is not implemented yet.");const r=oT(o,n),i=this.outputs.map(a=>[]);for(let a=0;a<r.length;++a)le(()=>{const u=r[a][0],d=r[a][1],h=Dh(e,u,d),p=[];if(Array.isArray(h))for(let b=0;b<h.length;++b)p.push({key:this.inputs[b],value:h[b]});else p.push({key:this.inputs[0],value:h});const x=new $a(p);return Uh(this.outputs,x)}).forEach((u,d)=>i[d].push(u));return Bs(i.map(a=>mn(a,0)))})}predict(e,n={}){const s=LU(e);FO(s,this.inputNames,this.feedInputShapes,!1);try{const o=n.batchSize==null?32:n.batchSize;return sT(o),this.predictLoop(s,o)}finally{dr(s,e)}}predictOnBatch(e){FO(e,this.inputNames,this.feedInputShapes,!0);const n=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,n)}standardizeUserDataXY(e,n,s=!0,o){if(this.optimizer_==null)throw new Qo("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const r=[];for(let i=0;i<this.feedOutputShapes.length;++i){const a=this.feedOutputShapes[i];this.feedLossFns[i]===rx?r.push(a.slice(0,a.length-1).concat([1])):r.push(a)}if(e=MO(e,this.feedInputNames,this.feedInputShapes,!1,"input"),n=MO(n,this.feedOutputNames,r,!1,"target"),g0e(e,n),y0e(n,this.feedLossFns,this.feedOutputShapes),this.stateful&&o!=null&&o>0&&e[0].shape[0]%o!==0)throw new te(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${o}. Found: ${e[0].shape[0]} sample(s).`);return[e,n]}async standardizeUserData(e,n,s,o,r=!0,i){const[a,l]=this.standardizeUserDataXY(e,n,r,i);if(s!=null)throw new Error("sample weight is not supported yet.");let u=null;if(o!=null){const d=FU(o,this.outputNames);u=[];for(let h=0;h<d.length;++h)u.push(await OU(l[h],null,d[h]))}return[a,l,u]}testLoop(e,n,s,o=0,r){return le(()=>{const i=this.checkNumSamples(n,s,r,"steps"),a=[];if(o>0)throw new Qe("Verbose mode is not implemented yet.");if(r!=null)throw new Qe("steps mode in testLoop() is not implemented yet");{const l=oT(i,s),u=us(Tr(0,i));for(let d=0;d<l.length;++d){const h=l[d][0],p=l[d][1],x=Yl(u,h,p-h),b=wS(n,x),w=e(b);if(d===0)for(let C=0;C<w.length;++C)a.push(Be(0));for(let C=0;C<w.length;++C){const T=w[C];a[C]=Te(a[C],j(p-h,T))}}for(let d=0;d<a.length;++d)a[d]=Pe(a[d],i)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,n=[];for(let s=0;s<e.length;++s){const o=e[s];let r=o;if(vO(e,o)>1){const i=vO(e.slice(0,s),o);r+=`_${i}`}n.push(r)}return n}makeTrainFunction(){return e=>{const n=[],s=e.slice(0,this.inputs.length),o=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),r=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),i=[],a=()=>{const h=[];for(let w=0;w<this.inputs.length;++w)h.push({key:this.inputs[w],value:s[w]});const p=new $a(h),x=Uh(this.outputs,p,{training:!0});let b;for(let w=0;w<this.lossFunctions.length;++w){const C=this.lossFunctions[w];let T=C(o[w],x[w]);r[w]!=null&&(T=l0e(T,r[w]));const N=tn(T);n.push(N),w===0?b=T:b=Te(b,T)}for(let w=0;w<this.metricsTensors.length;++w){let C;if(this.outputs.length>1&&w<this.outputs.length)C=n[w];else{const T=this.metricsTensors[w][0],N=this.metricsTensors[w][1];C=tn(T(o[N],x[N]))}Fn(C),i.push(C)}return b=tn(b),this.calculateLosses().forEach(w=>{b=Te(b,w)}),b},l=this.collectedTrainableWeights.map(h=>h.read());return[this.optimizer_.minimize(a,!0,l)].concat(i)}}makeTestFunction(){this.testFunction=e=>le(()=>{const n=[];let s;const o=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=[];for(let u=0;u<this.inputs.length;++u)i.push({key:this.inputs[u],value:o[u]});const a=new $a(i),l=Uh(this.outputs,a);for(let u=0;u<this.lossFunctions.length;++u){const d=this.lossFunctions[u],h=tn(d(r[u],l[u]));u===0?s=h:s=Te(s,h),n.push(s)}for(let u=0;u<this.metricsTensors.length;++u){const d=this.metricsTensors[u][0],h=this.metricsTensors[u][1],p=tn(d(r[h],l[h]));n.push(p)}return n})}async fit(e,n,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let o,r,i,a,l,u,d,h,p;try{const x=s.batchSize==null?32:s.batchSize;sT(x);const w=await this.standardizeUserData(e,n,s.sampleWeight,s.classWeight,!1,x);o=w[0],r=w[1],p=w[2];let C=!1,T;if(s.validationData!=null&&s.validationData.length>0){if(C=!0,s.validationData.length===2)l=s.validationData[0],u=s.validationData[1];else throw s.validationData.length===3?new Qe("validationData including sample weights is not supported yet."):new te(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const P=await this.standardizeUserData(l,u,null,null,!0,x);d=P[0],h=P[1],T=d.concat(h)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){C=!0;const F=Math.floor(o[0].shape[0]*(1-s.validationSplit)),P=o[0].shape[0];d=Dh(o,F,P),i=o,o=Dh(o,0,F),h=Dh(r,F,P),a=r,r=Dh(r,0,F),T=d.concat(h)}else s.validationSteps!=null&&(C=!0);const N=o.concat(r).concat(p);this.checkTrainableWeightsConsistency();const I=this.makeTrainFunction(),k=this.getDedupedMetricsNames();let A,$;C?(this.makeTestFunction(),A=this.testFunction,$=k.slice().concat(k.map(F=>"val_"+F))):(A=null,T=[],$=k.slice());const M=IU(s.callbacks,s.yieldEvery);return await this.fitLoop(I,N,k,x,s.epochs,s.verbose,M,A,T,s.shuffle,$,s.initialEpoch,null,null)}finally{this.isTraining=!1,dr(o,e),dr(r,n),dr(i,e),dr(a,n),dr(d,l),dr(h,u),p!=null&&je(p)}}async fitLoop(e,n,s,o,r,i,a,l,u,d,h,p,x,b){o==null&&(o=32),r==null&&(r=1),d==null&&(d=!0),p==null&&(p=0);let w=!1;if(l!=null&&u!=null&&(w=!0),b!=null&&(w=!0,x==null))throw new te("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const C=this.checkNumSamples(n,o,x,"steps_per_epoch");let T;C!=null&&(T=Tr(0,C)),i==null&&(i=1);const{callbackList:N,history:I}=kU(a,i,r,p,C,x,o,w,h);N.setModel(this),this.history=I,await N.onTrainBegin(),this.stopTraining_=!1;for(let k=p;k<r;++k){await N.onEpochBegin(k);const A={};if(x!=null)throw new Qe("stepsPerEpoch mode is not implemented yet.");{if(d==="batch")throw new Qe("batch shuffling is not implemneted yet");d&&UN(T);const $=us(T),M=oT(C,o);for(let O=0;O<M.length;++O){const F={};if(await N.onBatchBegin(O,F),le(()=>{const P=M[O][0],D=M[O][1],H=Yl($,P,D-P);F.batch=O,F.size=D-P;const Z=wS(n,H),ne=e(Z);for(let Q=0;Q<s.length;++Q){const G=s[Q],q=ne[Q];F[G]=q,Fn(q)}if(O===M.length-1&&w){const Q=this.testLoop(l,u,o);for(let G=0;G<s.length;++G){const q=s[G],J=Q[G];Fn(J),A["val_"+q]=J}}}),await N.onBatchEnd(O,F),TU(F),this.stopTraining_)break}$.dispose()}if(await N.onEpochEnd(k,A),this.stopTraining_)break}return await N.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,n){return d0e(this,e,n)}async trainOnBatch(e,n){const s=await this.standardizeUserData(e,n),o=s[0],r=s[1],a=this.makeTrainFunction()(o.concat(r)),l=[];for(const u of a){const d=await u.data();l.push(d[0])}return je(a),dr(s[0],e),dr(s[1],n),Bs(l)}getNamedWeights(e){const n=[],s=e!=null&&e.trainableOnly,o=s?this.trainableWeights:this.weights,r=this.getWeights(s);for(let i=0;i<o.length;++i)s&&!o[i].trainable||n.push({name:o[i].originalName,tensor:r[i]});return n}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const n=eS().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=n-eS().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=Ei(this.loss);else if(Array.isArray(this.loss)){for(const n of this.loss)if(typeof n!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(n=>Ei(n))}else{const n=Object.keys(this.loss);e={};const s=this.loss;for(const o of n)if(typeof s[o]=="string")e[o]=Ei(s[o]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Ei(e0(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>Ei(e0(e)));{const e={};for(const n in this.metrics)e[n]=Ei(e0(this.metrics[n]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const n=Ep(e.optimizer_config),s=wr(n);let o;if(typeof e.loss=="string")o=Ol(e.loss);else if(Array.isArray(e.loss))o=e.loss.map(i=>Ol(i));else if(e.loss!=null){o={};for(const i in e.loss)o[i]=Ol(e.loss[i])}let r;if(Array.isArray(e.metrics))r=e.metrics.map(i=>Ol(i));else if(e.metrics!=null){r={};for(const i in e.metrics)r[i]=Ol(e.metrics[i])}this.compile({loss:o,metrics:r,optimizer:s})}async save(e,n){if(typeof e=="string"){const u=nz(e);if(u.length===0)throw new te(`Cannot find any save handlers for URL '${e}'`);if(u.length>1)throw new te(`Found more than one (${u.length}) save handlers for URL '${e}'`);e=u[0]}if(e.save==null)throw new te("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await sS(this.getNamedWeights(n)),a={modelTopology:this.toJSON(null,!1),format:v0e,generatedBy:`TensorFlow.js tfjs-layers v${Gb}`,convertedBy:null};if((n==null?!1:n.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const u="optimizer",{data:d,specs:h}=await sS(await this.optimizer.getWeights(),u);s.specs.push(...h),s.data=ez([s.data,d])}return this.userDefinedMetadata!=null&&(RO(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=s.data,a.weightSpecs=s.specs,e.save(a)}setUserDefinedMetadata(e){RO(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}$i.className="Model";Se($i);class VU extends $i{}VU.className="Functional";Se(VU);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function b0e(t,e){"modelTopology"in t||(t={modelTopology:t}),t=t;let n=t.modelTopology;n.model_config!=null&&(n=n.model_config);const s=Ep(n),o=wr(s,e);if(t.weightsManifest!=null){const r=await yB(t.weightsManifest,t.pathPrefix,o.weights.map(a=>a.originalName)),i={};for(const a of o.weights)i[a.originalName]=r[a.originalName];o.loadWeights(i),je(r)}return o}async function w0e(t,e){if(e==null&&(e={}),typeof t=="string"){const n=sz(t,e);if(n.length===0)n.push(bB(t,e));else if(n.length>1)throw new te(`Found more than one (${n.length}) load handlers for URL '${t}'`);t=n[0]}return C0e(t,void 0,e)}async function C0e(t,e,n){if(n==null&&(n={}),t.load==null)throw new te("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const s=await t.load();let o=s.modelTopology;o.model_config!=null&&(o=o.model_config);const r=n.strict==null?!0:n.strict,i=s.weightData!=null&&s.weightSpecs!=null&&r,a=wr(Ep(o),e,i),l=s.trainingConfig;if(l!=null&&a.loadTrainingConfig(l),s.userDefinedMetadata!=null&&a.setUserDefinedMetadata(s.userDefinedMetadata),s.weightData!=null){if(s.weightSpecs==null)throw new te("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:u,optimizerWeights:d}=T0e(s.weightData,s.weightSpecs);a.loadWeights(u,r),a.optimizer!=null&&d.length>0&&await a.optimizer.setWeights(d),je(u),je(d.map(h=>h.tensor))}return a}function T0e(t,e){const n=eE(t,e),s={},o=[];return e.forEach(r=>{r.group==="optimizer"?o.push({name:r.name,tensor:n[r.name]}):s[r.name]=n[r.name]}),{modelWeights:s,optimizerWeights:o}}class uu extends $i{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:$b("sequential_"),e.layers!=null)for(const n of e.layers)this.add(n)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new te(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const n=e instanceof uu||e instanceof $i;let s;if(n){if(s=e,s.outputs.length!==1)throw new te("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new te("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new te("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const o=CU({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(o)}if(n)this.outputs=s.outputs,this.inputs=s.inputs;else{if(e.inboundNodes.length!==1)throw new te(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new te("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=wU(this.outputs[0])}this.inboundNodes=[],new zb({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:lu(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(o=>o.shape),outputShapes:this.outputs[0].shape})}else{const o=e.apply(this.outputs[0]);if(Array.isArray(o))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[o],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,n){return this.model==null&&this.build(),this.model.call(e,n)}build(e){if(bt(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new $i({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,n,s=console.log){this.built||this.build(),super.summary(e,n,s)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,n,s={}){if(!this.built)throw new Qo("The model needs to be compiled before being used.");return this.model.evaluate(e,n,s)}async evaluateDataset(e,n){if(!this.built)throw new Qo("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,n)}predict(e,n={}){return this.model==null&&this.build(),this.model.predict(e,n)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,n,s={}){if(!this.built)throw new Qo("The model needs to be compiled before being used.");return this.model.fit(e,n,s)}async fitDataset(e,n){if(!this.built)throw new Qo("The model needs to be compiled before being used.");return this.model.fitDataset(e,n)}async trainOnBatch(e,n){return this.model.trainOnBatch(e,n)}static fromConfig(e,n,s={},o=!1){let r,i={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new te("Legacy serialization format not supported yet.");r=n}else L(n.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),r=n.layers,delete n.layers,i=n;const a=new e(i);if(!(a instanceof uu))throw new Qe(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const l of r){const d=wr(l,void 0,o);o&&d.setFastWeightInitDuringBuild(!0),a.add(d)}return a}set stopTraining(e){if(this.model==null)throw new te("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new te("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const n of this.layers){const s={};s.className=n.getClassName(),s.config=n.getConfig(),e.push(s)}return{name:this.name,layers:e}}}uu.className="Sequential";Se(uu);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function S0e(t){return new $i(t)}function N0e(t){return new uu(t)}function zU(t){return CU(t)}function E0e(t,e){No.registerCallbackConstructor(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let ws=class extends Nu{getConfig(){return{}}};class BU extends ws{apply(e,n=1){return Wge(e,n)}}BU.className="elu";Se(BU);class UU extends ws{apply(e){return ib(e)}}UU.className="selu";Se(UU);class GU extends ws{apply(e){return Ar(e)}}GU.className="relu";Se(GU);class HU extends ws{apply(e){return le(()=>Wa(6,Ar(e)))}}HU.className="relu6";Se(HU);class WU extends ws{apply(e){return e}}WU.className="linear";Se(WU);class qU extends ws{apply(e){return br(e)}}qU.className="sigmoid";Se(qU);class KU extends ws{apply(e){return Kge(e)}}KU.className="hardSigmoid";Se(KU);class XU extends ws{apply(e){return Tu(e)}}XU.className="softplus";Se(XU);class YU extends ws{apply(e){return qge(e)}}YU.className="softsign";Se(YU);class JU extends ws{apply(e){return Ha(e)}}JU.className="tanh";Se(JU);let ck=class extends ws{apply(e,n=-1){return lg(e,n)}};ck.className="softmax";Se(ck);class jU extends ws{apply(e,n=-1){return Qv(e,n)}}jU.className="logSoftmax";Se(jU);class ZU extends ws{apply(e){return le(()=>le(()=>{const n=Math.sqrt(2),s=j(.5,Te(1,Jv(Pe(e,n))));return j(e,s)}))}}ZU.className="gelu";Se(ZU);class QU extends ws{apply(e){return le(()=>j(.5,j(e,Te(1,Ha(j(Yn(Pe(2,Math.PI)),Te(e,j(.044715,si(e,3)))))))))}}QU.className="gelu_new";Se(QU);class e4 extends ws{apply(e){return le(()=>j(e,Ha(Tu(e))))}}e4.className="mish";Se(e4);class t4 extends ws{apply(e,n=1){return le(()=>j(br(j(e,n)),e))}}t4.className="swish";Se(t4);function Ka(t){return t.getClassName()}function rT(t,e={}){return pg(t,Io.getMap().classNameMap,e,"activation")}function Xa(t){if(t==null){const e={};return e.className="linear",e.config={},rT(e)}if(typeof t=="string"){const e={};return e.className=t,e.config={},rT(e)}else return t instanceof ws?t:rT(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function dk(t){if(t!=null&&typeof t!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${t}`)}class n4 extends Nu{}class vg extends n4{constructor(e){super(),dk(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return le(()=>{let n=Nn([1]);return this.hasL1&&(n=Te(n,_e(j(this.l1,Sn(e))))),this.hasL2&&(n=Te(n,_e(j(this.l2,gg(e))))),ee(n,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,n){return new e({l1:n.l1,l2:n.l2})}}vg.className="L1L2";Se(vg);function I0e(t){return dk(t),new vg({l1:t!=null?t.l1:null,l2:0})}function k0e(t){return dk(t),new vg({l2:t!=null?t.l2:null,l1:0})}const OO={l1l2:"L1L2"};function Bt(t){return HI(t)}function PO(t,e={}){return pg(t,Io.getMap().classNameMap,e,"regularizer")}function Jt(t){if(t==null)return null;if(typeof t=="string"){const n={className:t in OO?OO[t]:t,config:{}};return PO(n)}else return t instanceof n4?t:PO(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class fk extends rt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,n){e=qe(e);let s=Ar(e);return this.maxValue!=null&&(s=Ks(s,0,this.maxValue)),s}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},n=super.getConfig();return Object.assign(e,n),e}}fk.className="ReLU";Se(fk);class hk extends rt{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,n){const s=qe(e);return Zm(s,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},n=super.getConfig();return Object.assign(e,n),e}}hk.className="LeakyReLU";Se(hk);class pk extends rt{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=Yt(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Jt(e.alphaRegularizer),this.alphaConstraint=Ln(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new te(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=bt(e);const n=e.slice(1);if(this.sharedAxes!=null)for(const o of this.sharedAxes)n[o-1]=1;this.alpha=this.addWeight("alpha",n,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let o=1;o<e.length;++o)s[o]=e[o];this.inputSpec=[new En({ndim:e.length,axes:s})],this.built=!0}call(e,n){return e=qe(e),rg(e,this.alpha.read())}getConfig(){const e={alphaInitializer:sn(this.alphaInitializer),alphaRegularizer:Bt(this.alphaRegularizer),alphaConstraint:Pn(this.alphaConstraint),sharedAxes:this.sharedAxes},n=super.getConfig();return Object.assign(e,n),e}}pk.className="PReLU";Se(pk);let mk=class extends rt{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new Qe(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,n){const s=qe(e);return cf(s)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},n=super.getConfig();return Object.assign(e,n),e}};mk.className="ELU";Se(mk);class gk extends rt{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,n){const s=qe(e);return j(s,Ne(Ps(s,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},n=super.getConfig();return Object.assign(e,n),e}}gk.className="ThresholdedReLU";Se(gk);class yk extends rt{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new ck().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,n){return le(()=>{let s=qe(e);const o=n.mask;if(o!=null){const r=j($e(Gs(s.shape),Ne(o,s.dtype)),Be(-1e9));s=Te(s,r)}return this.axis instanceof Array?this.axis.length>1?Xs($e(s,eg(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},n=super.getConfig();return Object.assign(e,n),e}}yk.className="Softmax";Se(yk);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Lc(t,e,n){if(typeof t=="number")return lu(t,e);if(t.length!==e)throw new te(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${t.length} elements.`);for(let s=0;s<e;++s){const o=t[s];if(!Bge(o))throw new te(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(t)} including a non-integer number ${o}`)}return t}function Cr(t,e,n,s,o=1){if(t==null)return t;const r=e+(e-1)*(o-1);let i;return n==="same"?i=t:i=t-r+1,Math.floor((i+s-1)/s)}function Ur(t,e,n,s){if(t==null)return null;if(s==="valid")t=t*e+qa([n-e,0]);else if(s==="same")t=t*e;else throw new te(`Unsupport padding mode: ${s}.`);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function xk(t,e){return le(()=>(xn(e),e==="channelsFirst"?ct(t,[0,2,3,1]):t))}function s4(t,e){return le(()=>(xn(e),e==="channelsFirst"?ct(t,[0,2,3,4,1]):t))}function A0e(t,e,n,s=1,o="valid",r,i=1){return le(()=>{if(r==null&&(r=Sr()),xn(r),t.shape.length!==3)throw new te(`The input of a conv1dWithBias operation should be 3, but is ${t.shape.length} instead.`);if(e.shape.length!==3)throw new te(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(n!=null&&n.shape.length!==1)throw new te(`The bias for a conv1dWithBias operation should be 1, but is ${n.shape.length} instead`);if(r==="channelsFirst"&&(t=ct(t,[0,2,1])),o==="causal")throw new Qe("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=qv(t,e,s,o==="same"?"same":"valid","NWC",i);return n!=null&&(a=Rr(a,n)),a})}function LO(t,e,n,s=[1,1],o="valid",r,i,a=null){return le(()=>{if(r==null&&(r=Sr()),xn(r),t.rank!==3&&t.rank!==4)throw new te(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${t.rank}.`);if(e.rank!==3&&e.rank!==4)throw new te(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${t.rank}.`);let l=xk(t,r);if(o==="causal")throw new Qe("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=sB({x:l,filter:e,strides:s,pad:o==="same"?"same":"valid",dilations:i,dataFormat:"NHWC",bias:n,activation:a}),r==="channelsFirst"&&(l=ct(l,[0,3,1,2])),l})}function R0e(t,e,n,s=[1,1,1],o="valid",r,i){return le(()=>{if(r==null&&(r=Sr()),xn(r),t.rank!==4&&t.rank!==5)throw new te(`conv3dWithBias expects input to be of rank 4 or 5, but received ${t.rank}.`);if(e.rank!==4&&e.rank!==5)throw new te(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${t.rank}.`);let a=s4(t,r);if(o==="causal")throw new Qe("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=NE(a,e,s,o==="same"?"same":"valid","NDHWC",i),n!=null&&(a=Rr(a,n)),r==="channelsFirst"&&(a=ct(a,[0,4,1,2,3])),a})}class Hb extends rt{constructor(e,n){if(super(n),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",Hb.verifyArgs(n),this.rank=e,qn(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new Qe(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Lc(n.kernelSize,e,"kernelSize"),this.strides=Lc(n.strides==null?1:n.strides,e,"strides"),this.padding=n.padding==null?"valid":n.padding,Fo(this.padding),this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,xn(this.dataFormat),this.activation=Xa(n.activation),this.useBias=n.useBias==null?!0:n.useBias,this.biasInitializer=Yt(n.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Ln(n.biasConstraint),this.biasRegularizer=Jt(n.biasRegularizer),this.activityRegularizer=Jt(n.activityRegularizer),this.dilationRate=Lc(n.dilationRate==null?1:n.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new te(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new te(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new te(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(Br("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!WI(e.kernelSize,"number",1,3))throw new te(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Ka(this.activation),useBias:this.useBias,biasInitializer:sn(this.biasInitializer),biasRegularizer:Bt(this.biasRegularizer),activityRegularizer:Bt(this.activityRegularizer),biasConstraint:Pn(this.biasConstraint)},n=super.getConfig();return Object.assign(e,n),e}}class xf extends Hb{constructor(e,n){super(e,n),this.kernel=null,xf.verifyArgs(n),this.filters=n.filters,qn(this.filters,"filters"),this.kernelInitializer=Yt(n.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Ln(n.kernelConstraint),this.kernelRegularizer=Jt(n.kernelRegularizer)}build(e){e=bt(e);const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new te(`The channel dimension of the input should be defined. Found ${e[n]}`);const s=e[n],o=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[n]:s}}],this.built=!0}call(e,n){return le(()=>{e=qe(e);let s;const o=this.bias==null?null:this.bias.read(),r=fU(this.activation.getClassName());if(r!=null&&this.rank===2)s=LO(e,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate,r);else{if(this.rank===1)s=A0e(e,this.kernel.read(),o,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=LO(e,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=R0e(e,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new Qe("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(e){e=bt(e);const n=[],s=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let r=0;r<s.length;++r){const i=Cr(s[r],this.kernelSize[r],this.padding,this.strides[r],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[r]);n.push(i)}let o=[e[0]];return this.dataFormat==="channelsLast"?(o=o.concat(n),o.push(this.filters)):(o.push(this.filters),o=o.concat(n)),o}getConfig(){const e={filters:this.filters,kernelInitializer:sn(this.kernelInitializer),kernelRegularizer:Bt(this.kernelRegularizer),kernelConstraint:Pn(this.kernelConstraint)},n=super.getConfig();return Object.assign(e,n),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new te(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class vf extends xf{constructor(e){super(2,e),vf.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!WI(e.kernelSize,"number",1,2))throw new te(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}vf.className="Conv2D";Se(vf);class bf extends xf{constructor(e){super(3,e),bf.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new te(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}bf.className="Conv3D";Se(bf);class vk extends vf{constructor(e){if(super(e),this.inputSpec=[new En({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new te(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=bt(e),e.length!==4)throw new te("Input should have rank 4; Received input shape: "+JSON.stringify(e));const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new te("The channel dimension of the inputs should be defined. Found `None`.");const s=e[n],o=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new En({ndim:4,axes:{[n]:s}})],this.built=!0}call(e,n){return le(()=>{let s=qe(e);if(s.shape.length!==4)throw new te(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const o=s.shape,r=o[0];let i,a;this.dataFormat==="channelsFirst"?(i=2,a=3):(i=1,a=2);const l=o[i],u=o[a],d=this.kernelSize[0],h=this.kernelSize[1],p=this.strides[0],x=this.strides[1],b=Ur(l,p,d,this.padding),w=Ur(u,x,h,this.padding),C=[r,b,w,this.filters];this.dataFormat!=="channelsLast"&&(s=ct(s,[0,2,3,1]));let T=Kv(s,this.kernel.read(),C,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(T=ct(T,[0,3,1,2])),this.bias!=null&&(T=Rr(T,this.bias.read(),this.dataFormat)),this.activation!=null&&(T=this.activation.apply(T)),T})}computeOutputShape(e){e=bt(e);const n=e.slice();let s,o,r;this.dataFormat==="channelsFirst"?(s=1,o=2,r=3):(s=3,o=1,r=2);const i=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],u=this.strides[1];return n[s]=this.filters,n[o]=Ur(n[o],l,i,this.padding),n[r]=Ur(n[r],u,a,this.padding),n}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}vk.className="Conv2DTranspose";Se(vk);class bk extends bf{constructor(e){if(super(e),this.inputSpec=[new En({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new te(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=bt(e),e.length!==5)throw new te("Input should have rank 5; Received input shape: "+JSON.stringify(e));const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new te("The channel dimension of the inputs should be defined. Found `None`.");const s=e[n],o=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new En({ndim:5,axes:{[n]:s}})],this.built=!0}call(e,n){return le(()=>{let s=qe(e);if(s.shape.length!==5)throw new te(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const o=s.shape,r=o[0];let i,a,l;this.dataFormat==="channelsFirst"?(l=2,i=3,a=4):(l=1,i=2,a=3);const u=o[l],d=o[i],h=o[a],p=this.kernelSize[0],x=this.kernelSize[1],b=this.kernelSize[2],w=this.strides[0],C=this.strides[1],T=this.strides[2],N=Ur(u,w,p,this.padding),I=Ur(d,C,x,this.padding),k=Ur(h,T,b,this.padding),A=[r,N,I,k,this.filters];this.dataFormat!=="channelsLast"&&(s=ct(s,[0,2,3,4,1]));let $=EE(s,this.kernel.read(),A,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&($=ct($,[0,4,1,2,3])),this.bias!==null&&($=Rr($,this.bias.read(),this.dataFormat)),this.activation!==null&&($=this.activation.apply($)),$})}computeOutputShape(e){e=bt(e);const n=e.slice();let s,o,r,i;this.dataFormat==="channelsFirst"?(s=1,o=2,r=3,i=4):(s=4,o=1,r=2,i=3);const a=this.kernelSize[0],l=this.kernelSize[1],u=this.kernelSize[2],d=this.strides[0],h=this.strides[1],p=this.strides[2];return n[s]=this.filters,n[o]=Ur(n[o],d,a,this.padding),n[r]=Ur(n[r],h,l,this.padding),n[i]=Ur(n[i],p,u,this.padding),n}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}bk.className="Conv3DTranspose";Se(bk);class o4 extends xf{constructor(e,n){if(super(e,n),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,n.filters==null)throw new te("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(n.kernelInitializer!=null||n.kernelRegularizer!=null||n.kernelConstraint!=null)throw new te("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(n.padding!=null&&n.padding!=="same"&&n.padding!=="valid")throw new te(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(n.padding)}`);this.depthMultiplier=n.depthMultiplier==null?1:n.depthMultiplier,this.depthwiseInitializer=Yt(n.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Jt(n.depthwiseRegularizer),this.depthwiseConstraint=Ln(n.depthwiseConstraint),this.pointwiseInitializer=Yt(n.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Jt(n.pointwiseRegularizer),this.pointwiseConstraint=Ln(n.pointwiseConstraint)}build(e){if(e=bt(e),e.length<this.rank+2)throw new te(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null||e[n]<0)throw new te(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[n])}`);const s=e[n],o=this.kernelSize.concat([s,this.depthMultiplier]),r=[];for(let a=0;a<this.rank;++a)r.push(1);r.push(s*this.depthMultiplier,this.filters);const i=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",o,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,i,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",r,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,i,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,i,this.biasConstraint):this.bias=null,this.inputSpec=[new En({ndim:this.rank+2,axes:{[n]:s}})],this.built=!0}call(e,n){return le(()=>{e=qe(e);let s;if(this.rank===1)throw new Qe("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=ct(e,[0,2,3,1])),s=ab(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=Rr(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=ct(s,[0,3,1,2])),s})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=sn(this.depthwiseInitializer),e.pointwiseInitializer=sn(this.pointwiseInitializer),e.depthwiseRegularizer=Bt(this.depthwiseRegularizer),e.pointwiseRegularizer=Bt(this.pointwiseRegularizer),e.depthwiseConstraint=Pn(this.depthwiseConstraint),e.pointwiseConstraint=Pn(this.pointwiseConstraint),e}}o4.className="SeparableConv";class wk extends o4{constructor(e){super(2,e)}}wk.className="SeparableConv2D";Se(wk);class bg extends xf{constructor(e){super(1,e),bg.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!WI(e.kernelSize,"number",1,1))throw new te(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}bg.className="Conv1D";Se(bg);class Ck extends rt{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,n){return le(()=>{if(e=qe(e),this.dataFormat==="channelsLast"){const s=Qy(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Qy(s,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=Qy(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Qy(s,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}Ck.className="Cropping2D";Se(Ck);class Tk extends rt{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,xn(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,Lge(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const n=e[2]==null?null:this.size[0]*e[2],s=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],n,s]}else{const n=e[1]==null?null:this.size[0]*e[1],s=e[2]==null?null:this.size[1]*e[2];return[e[0],n,s,e[3]]}}call(e,n){return le(()=>{let s=qe(e);const o=s.shape;if(this.dataFormat==="channelsFirst"){s=ct(s,[0,2,3,1]);const r=this.size[0]*o[2],i=this.size[1]*o[3],a=this.interpolation==="nearest"?Zo.resizeNearestNeighbor(s,[r,i]):Zo.resizeBilinear(s,[r,i]);return ct(a,[0,3,1,2])}else{const r=this.size[0]*o[1],i=this.size[1]*o[2];return this.interpolation==="nearest"?Zo.resizeNearestNeighbor(s,[r,i]):Zo.resizeBilinear(s,[r,i])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},n=super.getConfig();return Object.assign(e,n),e}}Tk.className="UpSampling2D";Se(Tk);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function $0e(t,e,n=[1,1],s="valid",o,r){return le(()=>{o==null&&(o=Sr()),xn(o);let i=xk(t,o);if(t.rank!==4)throw new te(`Input for depthwiseConv2d is required to be 4-D, but is instead ${t.rank}-D`);if(e.rank!==4)throw new te(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return i=uf(i,e,n,s==="same"?"same":"valid","NHWC",r),o==="channelsFirst"&&(i=ct(i,[0,3,1,2])),i})}class Sk extends Hb{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=Yt(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Ln(e.depthwiseConstraint),this.depthwiseRegularizer=Jt(e.depthwiseRegularizer)}build(e){if(e=bt(e),e.length<4)throw new te(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const n=this.dataFormat==="channelsFirst"?1:3;if(e[n]==null||e[n]<0)throw new te(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[n]}).`);const s=e[n],o=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",o,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return le(()=>{e=qe(e);let s=$0e(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=Rr(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(e){e=bt(e);const n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],o=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,r=Cr(n,this.kernelSize[0],this.padding,this.strides[0]),i=Cr(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],o,r,i]:[e[0],r,i,o]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=sn(this.depthwiseInitializer),e.depthwiseRegularizer=Bt(this.depthwiseRegularizer),e.depthwiseConstraint=Pn(this.depthwiseRegularizer),e}}Sk.className="DepthwiseConv2D";Se(Sk);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function r4(t,e,n,s){if(Array.isArray(t)){if(e!=null||n!=null)throw new te("When inputs is an array, neither initialState or constants should be provided");s!=null&&(n=t.slice(t.length-s,t.length),t=t.slice(0,t.length-s)),t.length>1&&(e=t.slice(1,t.length)),t=t[0]}function o(r){return r==null||Array.isArray(r)?r:[r]}return e=o(e),n=o(n),{inputs:t,initialState:e,constants:n}}function i4(t,e,n,s=!1,o,r,i=!1,a=!1){return le(()=>{const l=e.shape.length;if(l<3)throw new te(`Input should be at least 3D, but is ${l}D.`);const u=[1,0].concat(Tr(2,l));e=ct(e,u),i&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),o!=null&&(o=Ne(Ne(o,"bool"),"float32"),o.rank===l-1&&(o=rs(o,-1)),o=ct(o,u)),s&&(e=_o(e,0),o!=null&&(o=_o(o,0)));const d=[];let h,p=n;const x=e.shape[0],b=Mo(e);let w;o!=null&&(w=Mo(o));for(let T=0;T<x;++T){const N=b[T],I=le(()=>t(N,p));if(o==null)h=I[0],p=I[1];else{const k=le(()=>{const A=w[T],$=$e(ho(A),A),M=Te(j(I[0],A),j(p[0],$)),O=p.map((F,P)=>Te(j(I[1][P],A),j(F,$)));return{output:M,newStates:O}});h=k.output,p=k.newStates}a&&d.push(h)}let C;return a&&(C=Ms(d,1)),[h,C,p]})}class $r extends rt{constructor(e){super(e);let n;if(e.cell==null)throw new te("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?n=new Kb({cells:e.cell}):n=e.cell,n.stateSize==null)throw new te("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=n,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new En({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Tr(0,e).map(n=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){yS(e)&&(e=e[0]),e=e;let n=this.cell.stateSize;Array.isArray(n)||(n=[n]);const s=n[0];let o;if(this.returnSequences?o=[e[0],e[1],s]:o=[e[0],s],this.returnState){const r=[];for(const i of n)r.push([e[0],i]);return[o].concat(r)}else return o}computeMask(e,n){return le(()=>{Array.isArray(n)&&(n=n[0]);const s=this.returnSequences?n:null;if(this.returnState){const o=this.states.map(r=>null);return[s].concat(o)}else return s})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[];for(let s=0;s<e;++s)n.push(null);return n}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new Qe("Constants support is not implemented in RNN yet.");yS(e)&&(e=e[0]),e=e;const n=this.stateful?e[0]:null,s=e.slice(2);this.inputSpec[0]=new En({shape:[n,null,...s]});const o=[e[0]].concat(e.slice(2));this.cell.build(o);let r;if(Array.isArray(this.cell.stateSize)?r=this.cell.stateSize:r=[this.cell.stateSize],this.stateSpec!=null){if(!lt(this.stateSpec.map(i=>i.shape[i.shape.length-1]),r))throw new te(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=r.map(i=>new En({shape:[null,i]}));this.stateful&&this.resetStates()}resetStates(e,n=!1){le(()=>{if(!this.stateful)throw new zr("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new te("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(o=>Nn([s,o])):this.states_=[Nn([s,this.cell.stateSize])];else if(e==null)je(this.states_),this.keptStates!=null&&(je(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(o=>Nn([s,o])):this.states_[0]=Nn([s,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new te(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);n===!0?this.keptStates.push(this.states_.slice()):je(this.states_);for(let o=0;o<this.states_.length;++o){const r=e[o],i=Array.isArray(this.cell.stateSize)?this.cell.stateSize[o]:this.cell.stateSize,a=[s,i];if(!lt(r.shape,a))throw new te(`State ${o} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${r.shape}`);this.states_[o]=r}}this.states_=this.states_.map(o=>Fn(o.clone()))})}apply(e,n){let s=n==null?null:n.initialState,o=n==null?null:n.constants;n==null&&(n={});const r=r4(e,s,o,this.numConstants);e=r.inputs,s=r.initialState,o=r.constants;let i=[],a=[];if(s!=null){n.initialState=s,i=i.concat(s),this.stateSpec=[];for(const u of s)this.stateSpec.push(new En({shape:u.shape}));a=a.concat(this.stateSpec)}if(o!=null&&(n.constants=o,i=i.concat(o),this.numConstants=o.length),i[0]instanceof Nr){const u=[e].concat(i),d=this.inputSpec.concat(a),h=this.inputSpec;this.inputSpec=d;const p=super.apply(u,n);return this.inputSpec=h,p}else return super.apply(e,n)}call(e,n){return le(()=>{const s=n==null?null:n.mask,o=n==null?null:n.training;let r=n==null?null:n.initialState;e=qe(e),r==null&&(this.stateful?r=this.states_:r=this.getInitialState(e));const i=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(r.length!==i)throw new te(`RNN Layer has ${i} state(s) but was passed ${r.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:o},u=i4((b,w)=>{const C=this.cell.call([b].concat(w),a);return[C[0],C.slice(1)]},e,r,this.goBackwards,s,null,this.unroll,this.returnSequences),d=u[0],h=u[1],p=u[2];this.stateful&&this.resetStates(p,o);const x=this.returnSequences?h:d;return this.returnState?[x].concat(p):x})}getInitialState(e){return le(()=>{let n=Nn(e.shape);return n=_e(n,[1,2]),n=mg(n),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?mS(n,[1,s]):n):this.cell.stateSize>1?[mS(n,[1,this.cell.stateSize])]:[n]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),n={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(n.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===$r.className&&(n.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),e),n)}static fromConfig(e,n,s={}){const o=n.cell,r=wr(o,s);return new e(Object.assign(n,{cell:r}))}}$r.className="RNN";Se($r);class wg extends rt{}class Wb extends wg{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,qn(this.units,"units"),this.activation=Xa(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Yt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Yt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Yt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Jt(e.kernelRegularizer),this.recurrentRegularizer=Jt(e.recurrentRegularizer),this.biasRegularizer=Jt(e.biasRegularizer),this.kernelConstraint=Ln(e.kernelConstraint),this.recurrentConstraint=Ln(e.recurrentConstraint),this.biasConstraint=Ln(e.biasConstraint),this.dropout=jc([1,qa([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=jc([1,qa([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=bt(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return le(()=>{if(e=e,e.length!==2)throw new te(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let s=e[1];e=e[0];const o=n.training==null?!1:n.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ya({ones:()=>ho(e),rate:this.dropout,training:o,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ya({ones:()=>ho(s),rate:this.recurrentDropout,training:o,dropoutFunc:this.dropoutFunc}));let r;const i=this.dropoutMask,a=this.recurrentDropoutMask;i!=null?r=ei(j(e,i),this.kernel.read()):r=ei(e,this.kernel.read()),this.bias!=null&&(r=Rr(r,this.bias.read())),a!=null&&(s=j(s,a));let l=Te(r,ei(s,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:Ka(this.activation),useBias:this.useBias,kernelInitializer:sn(this.kernelInitializer),recurrentInitializer:sn(this.recurrentInitializer),biasInitializer:sn(this.biasInitializer),kernelRegularizer:Bt(this.kernelRegularizer),recurrentRegularizer:Bt(this.recurrentRegularizer),biasRegularizer:Bt(this.biasRegularizer),activityRegularizer:Bt(this.activityRegularizer),kernelConstraint:Pn(this.kernelConstraint),recurrentConstraint:Pn(this.recurrentConstraint),biasConstraint:Pn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),n)}}Wb.className="SimpleRNNCell";Se(Wb);class Nk extends $r{constructor(e){e.cell=new Wb(e),super(e)}call(e,n){return le(()=>{this.cell.dropoutMask!=null&&(je(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(je(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,o=n==null?null:n.training,r=n==null?null:n.initialState;return super.call(e,{mask:s,training:o,initialState:r})})}static fromConfig(e,n){return new e(n)}}Nk.className="SimpleRNN";Se(Nk);class qb extends wg{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new te("GRUCell does not support reset_after parameter set to true.");this.units=e.units,qn(this.units,"units"),this.activation=Xa(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Xa(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Yt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Yt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Yt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Jt(e.kernelRegularizer),this.recurrentRegularizer=Jt(e.recurrentRegularizer),this.biasRegularizer=Jt(e.biasRegularizer),this.kernelConstraint=Ln(e.kernelConstraint),this.recurrentConstraint=Ln(e.recurrentConstraint),this.biasConstraint=Ln(e.biasConstraint),this.dropout=jc([1,qa([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=jc([1,qa([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=bt(e);const n=e[e.length-1];this.kernel=this.addWeight("kernel",[n,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return le(()=>{if(e=e,e.length!==2)throw new te(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const s=n.training==null?!1:n.training;let o=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ya({ones:()=>ho(e),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ya({ones:()=>ho(o),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const r=this.dropoutMask,i=this.recurrentDropoutMask;let a,l,u;0<this.dropout&&this.dropout<1&&(e=j(e,r[0]));let d=ei(e,this.kernel.read());this.useBias&&(d=Rr(d,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(o=j(o,i[0]));const h=this.recurrentKernel.read(),[p,x]=Hs(h,[2*this.units,this.units],h.rank-1),b=ei(o,p),[w,C,T]=Hs(d,3,d.rank-1),[N,I]=Hs(b,2,b.rank-1);a=this.recurrentActivation.apply(Te(w,N)),l=this.recurrentActivation.apply(Te(C,I));const k=ei(j(l,o),x);u=this.activation.apply(Te(T,k));const A=Te(j(a,o),j(Te(1,Ht(a)),u));return[A,A]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:Ka(this.activation),recurrentActivation:Ka(this.recurrentActivation),useBias:this.useBias,kernelInitializer:sn(this.kernelInitializer),recurrentInitializer:sn(this.recurrentInitializer),biasInitializer:sn(this.biasInitializer),kernelRegularizer:Bt(this.kernelRegularizer),recurrentRegularizer:Bt(this.recurrentRegularizer),biasRegularizer:Bt(this.biasRegularizer),activityRegularizer:Bt(this.activityRegularizer),kernelConstraint:Pn(this.kernelConstraint),recurrentConstraint:Pn(this.recurrentConstraint),biasConstraint:Pn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),n)}}qb.className="GRUCell";Se(qb);class Ek extends $r{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new qb(e),super(e)}call(e,n){return le(()=>{this.cell.dropoutMask!=null&&(je(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(je(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,o=n==null?null:n.training,r=n==null?null:n.initialState;return super.call(e,{mask:s,training:o,initialState:r})})}static fromConfig(e,n){return n.implmentation===0&&(n.implementation=1),new e(n)}}Ek.className="GRU";Se(Ek);class Cg extends wg{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,qn(this.units,"units"),this.activation=Xa(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Xa(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Yt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Yt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Yt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=Jt(e.kernelRegularizer),this.recurrentRegularizer=Jt(e.recurrentRegularizer),this.biasRegularizer=Jt(e.biasRegularizer),this.kernelConstraint=Ln(e.kernelConstraint),this.recurrentConstraint=Ln(e.recurrentConstraint),this.biasConstraint=Ln(e.biasConstraint),this.dropout=jc([1,qa([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=jc([1,qa([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var n;e=bt(e);const s=e[e.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let o;if(this.useBias){if(this.unitForgetBias){const r=this.biasInitializer,i=this.units;o=new(n=class extends or{apply(l,u){const d=r.apply([i]),h=new _b().apply([i]),p=r.apply([i*2]);return wO(wO(d,h),p)}},n.className="CustomInit",n)}else o=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,o,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,n){return le(()=>{const s=n.training==null?!1:n.training;if(e=e,e.length!==3)throw new te(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let o=e[1];const r=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ya({ones:()=>ho(e),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ya({ones:()=>ho(o),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,a=this.recurrentDropoutMask;let l,u,d,h;0<this.dropout&&this.dropout<1&&(e=j(e,i[0]));let p=ei(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(o=j(o,a[0])),p=Te(p,ei(o,this.recurrentKernel.read())),this.useBias&&(p=Rr(p,this.bias.read()));const[x,b,w,C]=Hs(p,4,p.rank-1);l=this.recurrentActivation.apply(x),u=this.recurrentActivation.apply(b),d=Te(j(u,r),j(l,this.activation.apply(w))),h=this.recurrentActivation.apply(C);const T=j(h,this.activation.apply(d));return[T,T,d]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:Ka(this.activation),recurrentActivation:Ka(this.recurrentActivation),useBias:this.useBias,kernelInitializer:sn(this.kernelInitializer),recurrentInitializer:sn(this.recurrentInitializer),biasInitializer:sn(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Bt(this.kernelRegularizer),recurrentRegularizer:Bt(this.recurrentRegularizer),biasRegularizer:Bt(this.biasRegularizer),activityRegularizer:Bt(this.activityRegularizer),kernelConstraint:Pn(this.kernelConstraint),recurrentConstraint:Pn(this.recurrentConstraint),biasConstraint:Pn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),n)}}Cg.className="LSTMCell";Se(Cg);class Ik extends $r{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Cg(e),super(e)}call(e,n){return le(()=>{this.cell.dropoutMask!=null&&(je(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(je(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,o=n==null?null:n.training,r=n==null?null:n.initialState;return super.call(e,{mask:s,training:o,initialState:r})})}static fromConfig(e,n){return n.implmentation===0&&(n.implementation=1),new e(n)}}Ik.className="LSTM";Se(Ik);class Kb extends wg{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const n of this.cells.slice().reverse())Array.isArray(n.stateSize)?e.push(...n.stateSize):e.push(n.stateSize);return e}call(e,n){return le(()=>{e=e;let s=e.slice(1);const o=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?o.push(s.splice(0,a.stateSize.length)):o.push(s.splice(0,1));o.reverse();const r=[];let i;for(let a=0;a<this.cells.length;++a){const l=this.cells[a];s=o[a],a===0?i=[e[0]].concat(s):i=[i[0]].concat(s),i=l.call(i,n),r.push(i.slice(1))}s=[];for(const a of r.slice().reverse())s.push(...a);return[i[0]].concat(s)})}build(e){yS(e)&&(e=e[0]),e=e;let n;this.cells.forEach((s,o)=>{Xl(`RNNCell_${o}`,()=>{s.build(e),Array.isArray(s.stateSize)?n=s.stateSize[0]:n=s.stateSize,e=[e[0],n]})}),this.built=!0}getConfig(){const e=super.getConfig(),n=r=>({className:r.getClassName(),config:r.getConfig()}),o={cells:this.cells.map(n)};return Object.assign(Object.assign({},e),o)}static fromConfig(e,n,s={}){const o=[];for(const r of n.cells)o.push(wr(r,s));return new e({cells:o})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const n of this.cells)e.push(...n.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const n of this.cells)e.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const s of this.cells)n.push(...s.trainableWeights);return n.concat(e)}return e}getWeights(){const e=[];for(const n of this.cells)e.push(...n.weights);return xS(e)}setWeights(e){const n=[];for(const s of this.cells){const o=s.weights.length,r=e.splice(o);for(let i=0;i<s.weights.length;++i)n.push([s.weights[i],r[i]])}ek(n)}}Kb.className="StackedRNNCells";Se(Kb);function Ya(t){const{ones:e,rate:n,training:s=!1,count:o=1,dropoutFunc:r}=t,i=()=>r!=null?r(e(),n):vU(e(),n),a=()=>yg(i,e,s);return!o||o<=1?Fn(a().clone()):Array(o).fill(void 0).map(a).map(u=>Fn(u.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var D0e=function(t,e){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,s=Object.getOwnPropertySymbols(t);o<s.length;o++)e.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(t,s[o])&&(n[s[o]]=t[s[o]]);return n};class a4 extends $r{constructor(e){if(e.unroll)throw new Qe("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new Qe("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new En({ndim:5})]}call(e,n){return le(()=>{if(this.cell.dropoutMask!=null&&(je(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(je(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),n&&n.constants)throw new te("ConvRNN2D cell does not support constants");const s=n==null?null:n.mask,o=n==null?null:n.training,r=n==null?null:n.initialState;return super.call(e,{mask:s,training:o,initialState:r})})}computeOutputShape(e){let n=this.computeSingleOutputShape(e);return this.returnSequences||(n=[n[0],...n.slice(2)]),this.returnState&&(n=[n,...Array(2).fill([e[0],...n.slice(-3)])]),n}getInitialState(e){return le(()=>{const{stateSize:n}=this.cell,s=e.shape,o=this.computeSingleOutputShape(s),r=[o[0],...o.slice(2)],i=Nn(r);return Array.isArray(n)?Array(n.length).fill(i):[i]})}resetStates(e,n=!1){le(()=>{if(!this.stateful)throw new zr("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,o=this.computeSingleOutputShape(s),r=[o[0],...o.slice(2)];if(s[0]==null)throw new te("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Nn(r)):this.states_=[Nn(r)];else if(e==null)je(this.states_),this.keptStates!=null&&(je(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Nn(r)):this.states_[0]=Nn(r);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new te(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);n?this.keptStates.push(this.states_.slice()):je(this.states_);for(let a=0;a<this.states_.length;++a){const l=e[a],u=r;if(!lt(l.shape,u))throw new te(`State ${a} is incompatible with layer ${this.name}: expected shape=${u}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>Fn(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:n,filters:s,kernelSize:o,padding:r,strides:i,dilationRate:a}=this.cell,l=n==="channelsFirst",u=e[l?3:2],d=e[l?4:3],h=Cr(u,o[0],r,i[0],a[0]),p=Cr(d,o[1],r,i[1],a[1]);return[...e.slice(0,2),...l?[s,h,p]:[h,p,s]]}}a4.className="ConvRNN2D";class Xb extends Cg{constructor(e){const{filters:n,kernelSize:s,strides:o,padding:r,dataFormat:i,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:n})),this.filters=n,qn(this.filters,"filters"),this.kernelSize=Lc(s,2,"kernelSize"),this.kernelSize.forEach(l=>qn(l,"kernelSize")),this.strides=Lc(o||1,2,"strides"),this.strides.forEach(l=>qn(l,"strides")),this.padding=r||"valid",Fo(this.padding),this.dataFormat=i||"channelsLast",xn(this.dataFormat),this.dilationRate=Lc(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>qn(l,"dilationRate"))}build(e){var n;e=bt(e);const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new te(`The channel dimension of the input should be defined. Found ${e[s]}`);const o=e[s],r=4,i=this.kernelSize.concat([o,this.filters*r]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*r]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const u=this.biasInitializer,d=this.filters;l=new(n=class extends or{apply(p,x){const b=u.apply([d]),w=Gs([d]),C=u.apply([d*2]);return qI([b,w,C])}},n.className="CustomInit",n)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*r],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,n){return le(()=>{if(e.length!==3)throw new te(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const s=n.training||!1,o=e[0],r=e[1],i=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ya({ones:()=>ho(o),rate:this.dropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,u=(B,X,ie)=>!X||!X[ie]?B:j(X[ie],B);let d=u(o,l,0),h=u(o,l,1),p=u(o,l,2),x=u(o,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ya({ones:()=>ho(r),rate:this.recurrentDropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const b=this.recurrentDropoutMask;let w=u(r,b,0),C=u(r,b,1),T=u(r,b,2),N=u(r,b,3);const I=3,[k,A,$,M]=Hs(this.kernel.read(),a,I),[O,F,P,D]=this.useBias?Hs(this.bias.read(),a):[null,null,null,null];d=this.inputConv(d,k,O,this.padding),h=this.inputConv(h,A,F,this.padding),p=this.inputConv(p,$,P,this.padding),x=this.inputConv(x,M,D,this.padding);const[H,Z,ne,Q]=Hs(this.recurrentKernel.read(),a,I);w=this.recurrentConv(w,H),C=this.recurrentConv(C,Z),T=this.recurrentConv(T,ne),N=this.recurrentConv(N,Q);const G=this.recurrentActivation.apply(Te(d,w)),q=this.recurrentActivation.apply(Te(h,C)),J=Te(j(q,i),j(G,this.activation.apply(Te(p,T)))),oe=j(this.recurrentActivation.apply(Te(x,N)),this.activation.apply(J));return[oe,oe,J]})}getConfig(){const e=super.getConfig(),{units:n}=e,s=D0e(e,["units"]),o={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},s),o)}inputConv(e,n,s,o){const r=Vi(e,n,this.strides,o||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?Rr(r,s,this.dataFormat):r}recurrentConv(e,n){return Vi(e,n,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}Xb.className="ConvLSTM2DCell";Se(Xb);class kk extends a4{constructor(e){const n=new Xb(e);super(Object.assign(Object.assign({},e),{cell:n}))}static fromConfig(e,n){return new e(n)}}kk.className="ConvLSTM2D";Se(kk);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Yb extends rt{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const n=e.shape,s=[];for(let o=0;o<this.noiseShape.length;++o)s.push(this.noiseShape[o]==null?n[o]:this.noiseShape[o]);return s}call(e,n){return le(()=>{this.invokeCallHook(e,n);const s=qe(e);if(0<this.rate&&this.rate<1){const o=n.training==null?!1:n.training,r=this.getNoiseShape(s);return yg(()=>vU(s,this.rate,r,this.seed),()=>s,o)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=super.getConfig();return Object.assign(e,n),e}dispose(){return super.dispose()}}Yb.className="Dropout";Se(Yb);class Ak extends Yb{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const n=e.shape;return[n[0],1,n[2]]}}Ak.className="SpatialDropout1D";Se(Ak);class Rk extends rt{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let n=null;e.batchSize!=null&&(n=e.batchSize),this.batchInputShape=[n,e.inputDim]}this.units=e.units,qn(this.units,"units"),this.activation=Xa(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=Yt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=Yt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Ln(e.kernelConstraint),this.biasConstraint=Ln(e.biasConstraint),this.kernelRegularizer=Jt(e.kernelRegularizer),this.biasRegularizer=Jt(e.biasRegularizer),this.activityRegularizer=Jt(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=bt(e);const n=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:n}}],this.built=!0}computeOutputShape(e){e=bt(e);const n=e.slice();return n[n.length-1]=this.units,n}call(e,n){return le(()=>{this.invokeCallHook(e,n);const s=qe(e),o=fU(this.activation.getClassName());let r;return o!=null?r=ei(s,this.kernel.read(),o,this.bias?this.bias.read():null):(r=ei(s,this.kernel.read()),this.bias!=null&&(r=Rr(r,this.bias.read())),this.activation!=null&&(r=this.activation.apply(r))),r})}getConfig(){const e={units:this.units,activation:Ka(this.activation),useBias:this.useBias,kernelInitializer:sn(this.kernelInitializer),biasInitializer:sn(this.biasInitializer),kernelRegularizer:Bt(this.kernelRegularizer),biasRegularizer:Bt(this.biasRegularizer),activityRegularizer:Bt(this.activityRegularizer),kernelConstraint:Pn(this.kernelConstraint),biasConstraint:Pn(this.biasConstraint)},n=super.getConfig();return Object.assign(e,n),e}}Rk.className="Dense";Se(Rk);class $k extends rt{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=bt(e);for(const n of e.slice(1))if(n==null)throw new te(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],Pa(e,1)]}call(e,n){return le(()=>{this.invokeCallHook(e,n);let s=qe(e);if(this.dataFormat==="channelsFirst"&&s.rank>1){const o=[0];for(let r=2;r<s.rank;++r)o.push(r);o.push(1),s=ct(s,o)}return Hge(s)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const n=super.getConfig();return Object.assign(e,n),e}}$k.className="Flatten";Se($k);class Dk extends rt{constructor(e){super(e),this.supportsMasking=!0,this.activation=Xa(e.activation)}call(e,n){return le(()=>{this.invokeCallHook(e,n);const s=qe(e);return this.activation.apply(s)})}getConfig(){const e={activation:Ka(this.activation)},n=super.getConfig();return Object.assign(e,n),e}}Dk.className="Activation";Se(Dk);class _k extends rt{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,n){return le(()=>(e=qe(e),Uge(e,this.n)))}getConfig(){const e={n:this.n},n=super.getConfig();return Object.assign(e,n),e}}_k.className="RepeatVector";Se(_k);class Mk extends rt{constructor(e){super(e),this.targetShape=e.targetShape;for(let n=0;n<this.targetShape.length;++n)this.isUnknown(this.targetShape[n])&&(this.targetShape[n]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,n){const s="Total size of new array must be unchanged.",o=n.slice();let r=1,i=null;for(let l=0;l<o.length;++l){const u=o[l];if(this.isUnknown(u))if(i===null)i=l;else throw new te("Can only specifiy one unknown dimension.");else r*=u}const a=Pa(e);if(i!==null){if(r===0||a%r!==0)throw new te(s);o[i]=a/r}else if(a!==r)throw new te(s);return o}computeOutputShape(e){let n=!1;for(let s=0;s<e.length;++s)if(this.isUnknown(e[s])){n=!0;break}return n?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,n){return le(()=>{this.invokeCallHook(e,n);const s=qe(e),o=s.shape,r=o.slice(0,1).concat(this.fixUnknownDimension(o.slice(1),this.targetShape));return ee(s,r)})}getConfig(){const e={targetShape:this.targetShape},n=super.getConfig();return Object.assign(e,n),e}}Mk.className="Reshape";Se(Mk);class Fk extends rt{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const n=Tr(1,e.dims.length+1);if(!lt(e.dims.slice().sort(),n))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new En({ndim:this.dims.length+1})]}computeOutputShape(e){e=bt(e);const n=e.slice();return this.dims.forEach((s,o)=>{n[o+1]=e[s]}),n}call(e,n){return ct(qe(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},n=super.getConfig();return Object.assign(e,n),e}}Fk.className="Permute";Se(Fk);class Ok extends rt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={maskValue:this.maskValue};return Object.assign(n,e),n}computeMask(e,n){const s=qe(e);return wp(ru(s,this.maskValue),-1)}call(e,n){return le(()=>{this.invokeCallHook(e,n);const s=qe(e),i=wp(ru(s,this.maskValue),-1,!0);return j(s,Ne(i,s.dtype))})}}Ok.className="Masking";Se(Ok);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Pk extends rt{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let n=null;e.batchSize!=null&&(n=e.batchSize),e.inputLength==null?this.batchInputShape=[n,null]:this.batchInputShape=[n].concat(At(e.inputLength))}this.inputDim=e.inputDim,qn(this.inputDim,"inputDim"),this.outputDim=e.outputDim,qn(this.outputDim,"outputDim"),this.embeddingsInitializer=Yt(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Jt(e.embeddingsRegularizer),this.activityRegularizer=Jt(e.activityRegularizer),this.embeddingsConstraint=Ln(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,n){return le(()=>this.maskZero?(e=qe(e),ru(e,gt(e))):null)}computeOutputShape(e){if(e=bt(e),this.inputLength==null)return[...e,this.outputDim];const n=At(this.inputLength);if(n.length!==e.length-1)throw new te(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let s=0;for(let o=0;o<n.length;++o){const r=n[o],i=e[o+1];if(r!=null&&i!=null&&r!==i)throw new te(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);r==null&&(n[s]=i),s++}}return[e[0],...n,this.outputDim]}call(e,n){return le(()=>{this.invokeCallHook(e,n);let s=qe(e);s.dtype!=="int32"&&(s=Qr(s,"int32"));const o=xU(this.embeddings.read(),ee(s,[s.size]));return ee(o,bt(this.computeOutputShape(s.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:sn(this.embeddingsInitializer),embeddingsRegularizer:Bt(this.embeddingsRegularizer),activityRegularizer:Bt(this.activityRegularizer),embeddingsConstraint:Pn(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=super.getConfig();return Object.assign(e,n),e}}Pk.className="Embedding";Se(Pk);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class ku extends rt{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new Qe}computeElementwiseOpOutputShape(e,n){if(e==null||n==null)return null;if(e.length<n.length)return this.computeElementwiseOpOutputShape(n,e);if(n.length===0)return e;const s=e.slice(0,e.length-n.length);for(let o=0;o<n.length;++o){const r=e[e.length-n.length+o],i=n[o];if(r==null||i==null||r<0||i<0)s.push(null);else if(r===1)s.push(i);else if(i===1)s.push(r);else{if(r!==i)throw new te("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(n));s.push(r)}}return s}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[bt(e)]),e=e,e.length<2)throw new te(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let n=[];for(const r of e)r!=null&&r[0]!==null&&n.push(r[0]);if(n=Oa(n),n.length>1)throw new te(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let s=e[0]==null?null:e[0].slice(1);for(let r=1;r<e.length;++r){const i=e[r]==null?null:e[r].slice(1);s=this.computeElementwiseOpOutputShape(s,i)}const o=e.map(r=>r.length);e.indexOf(null)===-1&&Oa(o).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,n){return le(()=>{if(e=e,this.reshapeRequired){const s=[],o=e.map(r=>r.rank);if(o.indexOf(null)===-1){const r=qa(o);for(let i of e){const a=i.rank;for(let l=0;l<r-a;++l)i=mg(i,1);s.push(i)}return this.mergeFunction(s)}else{let r=!1;for(const l of e){const u=l.rank;if(u==null){const d=l.shape,h=d[0],p=d.slice(1).concat([h]);let x=ee(l,[h].concat(Pa(d.slice(1))));x=ct(x,[1,0]),x=ee(x,p),s.push(x),r=!0}else if(u>1){const d=Tr(1,u).concat([0]);s.push(ct(l,d)),r=!0}else s.push(l)}let i=this.mergeFunction(s);const a=i.rank;if(r){if(a==null){const l=i.shape,u=l.length,d=l[u-1],h=[d].concat(l.slice(0,l.length-1));i=ee(ct(ee(i,[-1,d]),[1,0]),h)}else if(a>1){const l=[a-1].concat(Tr(0,a-1));i=ct(i,l)}}return i}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let n;e[0]==null?n=null:n=e[0].slice(1);for(let o=1;o<e.length;++o){const r=e[o]==null?null:e[o].slice(1);n=this.computeElementwiseOpOutputShape(n,r)}let s=[];for(const o of e)o!=null&&o[0]!==null&&s.push(o[0]);return s=Oa(s),s.length===1?n=s.concat(n):n=[null].concat(n),n}computeMask(e,n){return le(()=>{if(n==null)return null;if(!Array.isArray(n))throw new te("`mask` should be an Array");if(!Array.isArray(e))throw new te("`inputs` should be an Array");if(n.length!==e.length)throw new te(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${n.length})`);if(n.every(o=>o==null))return null;n=n.map(o=>o==null?o:rs(o,0));let s=n[0];for(let o=1;o<n.length-1;++o)s=nr(s,n[o]);return s})}}class Lk extends ku{constructor(e){super(e)}mergeFunction(e){return le(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=Te(n,e[s]);return n})}}Lk.className="Add";Se(Lk);class Vk extends ku{constructor(e){super(e)}mergeFunction(e){return le(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=j(n,e[s]);return n})}}Vk.className="Multiply";Se(Vk);class zk extends ku{constructor(e){super(e)}mergeFunction(e){return le(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=Te(n,e[s]);return j(1/e.length,n)})}}zk.className="Average";Se(zk);class Bk extends ku{constructor(e){super(e)}mergeFunction(e){return le(()=>{let n=e[0];for(let s=1;s<e.length;++s)n=ii(n,e[s]);return n})}}Bk.className="Maximum";Se(Bk);class Uk extends ku{constructor(e){super(e)}mergeFunction(e){return le(()=>{let n=e[0];for(let s=1;s<e.length;++s)n=Wa(n,e[s]);return n})}}Uk.className="Minimum";Se(Uk);class Gk extends ku{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new te("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let n=!0;for(const o of e)if(o!=null){n=!1;break}if(n)return;const s=[];for(let o=0;o<e.length;++o){const r=e[o].slice();r.splice(this.axis,1);let i=!1;for(const a of s)if(lt(a,r)){i=!0;break}i||s.push(r)}if(s.length>1)throw new te("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return le(()=>qI(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new te("A `Concatenate` layer should be called on a list of inputs.");const n=e,s=n[0].slice(),o=this.axis<0?s.length+this.axis:this.axis;for(const r of n.slice(1)){if(s[o]==null||r[o]==null){s[o]=null;break}s[o]+=r[o]}return s}computeMask(e,n){if(n==null)return null;if(!Array.isArray(n))throw new te("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new te("`inputs` should be an array for Concatenate");if(n.length!==e.length)throw new te(`Mismatch in the length of mask (${n.length}) and the legnth of inputs (${e.length})`);return le(()=>{let s=!0;if(n.forEach(i=>{if(i!=null){s=!1;return}}),s)return null;const o=[];for(let i=0;i<e.length;++i)n[i]==null?o.push(Ne(ho(e[i]),"bool")):n[i].rank<e[i].rank?o.push(rs(n[i],-1)):o.push(n[i]);const r=mn(o,this.axis);return Wv(r,-1,!1)})}getConfig(){const e={axis:this.axis},n=super.getConfig();return Object.assign(e,n),e}}Gk.className="Concatenate";Se(Gk);function _h(t,e){for(;t<0;)t+=e;return t}function _0e(t,e,n){if(t.shape.length>3||e.shape.length>3)throw new Qe("batchDot is not implemented for tensors of 4D or higher rank yet");if(L(t.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${t.shape.length}`),L(t.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof n=="number"&&(n=[n,n]),t.dtype==="complex64"||e.dtype==="complex64")throw new Qe("batchDot is not implemented for complex64-type Tensors yet.");const s=t.shape.length,o=e.shape.length;n==null&&(n=[s-1,o-2]);const r=n;return le(()=>{let i;if(s>o){i=s-o;const l=[];for(let u=0;u<i;++u)l.push(1);e=ee(e,e.shape.concat(l))}else if(o>s){i=o-s;const l=[];for(let u=0;u<i;++u)l.push(1);t=ee(t,t.shape.concat(l))}else i=0;let a;if(t.shape.length===2&&e.shape.length===2)r[0]===r[1]?a=_e(j(t,e),r[0]):a=_e(j(ct(t,[1,0]),e),r[1]);else{const l=r[0]!==t.shape.length-1,u=r[1]===e.shape.length-1;a=st(t,e,l,u)}if(i>0){let l;s>o?l=s+o-3:l=s-1;const u=[];for(let d=l;d<l+i;++d)u.push(d);a=rl(a,u)}return a.shape.length===1&&(a=rs(a,1)),a})}class Hk extends ku{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){L(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=e[0],s=e[1];if(n.length>3||s.length>3)throw new Qe("Dot layer does not support tensors of 4D or higher rank yet.");const o=this.interpretAxes(n,s);if(n[o[0]]!==s[o[1]])throw new te(`Dimension incompatibility: ${n[o[0]]} !== ${s[o[1]]}`)}mergeFunction(e){if(e.length!==2)throw new te(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let n=e[0],s=e[1],o;return Array.isArray(this.axes)?o=this.axes.map((r,i)=>_h(r,e[i].shape.length)):o=[_h(this.axes,n.shape.length),_h(this.axes,s.shape.length)],this.normalize&&(n=ox(n,o[0]),s=ox(s,o[1])),_0e(n,s,o)}interpretAxes(e,n){let s;return Array.isArray(this.axes)?s=this.axes:s=[_h(this.axes,e.length),_h(this.axes,n.length)],s}computeOutputShape(e){L(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=e[0].slice(),s=e[1].slice();if(n.length>3||s.length>3)throw new Qe("Dot layer does not support tensors of 4D or higher rank yet.");const o=this.interpretAxes(n,s);n.splice(o[0],1),s.splice(o[1],1),s.splice(0,1);const r=n.concat(s);return r.length===1&&r.push(1),r}computeMask(e,n){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},n=super.getConfig();return Object.assign(e,n),e}}Hk.className="Dot";Se(Hk);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Wk extends rt{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={stddev:this.stddev};return Object.assign(n,e),n}call(e,n){return le(()=>{this.invokeCallHook(e,n);const s=qe(e);return yg(()=>Te(Db(s.shape,0,this.stddev),s),()=>s,n.training||!1)})}}Wk.className="GaussianNoise";Se(Wk);class qk extends rt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={rate:this.rate};return Object.assign(n,e),n}call(e,n){return le(()=>{this.invokeCallHook(e,n);const s=qe(e);return this.rate>0&&this.rate<1?yg(()=>{const r=Math.sqrt(this.rate/(1-this.rate));return j(s,Db(s.shape,1,r))},()=>s,n.training||!1):s})}}qk.className="GaussianDropout";Se(qk);class Kk extends rt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||qe(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={rate:this.rate};return Object.assign(n,e),n}call(e,n){return le(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(e);return yg(()=>{const r=qe(e),a=-1.6732632423543772*1.0507009873554805;let l=Ki(ol(s),this.rate);l=Qr(l,"float32");const u=((1-this.rate)*(1+this.rate*a**2))**-.5,d=-u*a*this.rate,h=Te(j(r,l),j(Te(l,-1),a));return Te(j(h,u),d)},()=>qe(e),n.training||!1)}return e})}}Kk.className="AlphaDropout";Se(Kk);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ip(t,e,n,s,o,r=.001){let i;if(t.rank===2)i=mE(t,e,n,s,o,r);else if(t.rank===3)i=gE(t,e,n,s,o,r);else if(t.rank===4)i=yE(t,e,n,s,o,r);else throw new Qe(`batchNormalization is not implemented for array of rank ${t.rank} yet`);return i}function M0e(t,e,n,s,o=.001){return le(()=>{const r=sg(t,s),i=r.mean,a=r.variance;return[Ip(t,i,a,n,e,o),i,a]})}function F0e(t,e,n,s,o=.001){return le(()=>{const r=sg(t,s),i=r.mean,a=r.variance,l=[];for(const b of Tr(0,t.rank))s.indexOf(b)!==-1?l.push(1):l.push(t.shape[b]);const u=ee(i,l),d=ee(a,l),h=e==null?null:ee(e,l),p=n==null?null:ee(n,l);return[Ip(t,u,d,p,h,o),i,a]})}function O0e(t,e,n,s,o=.001){return lt(s.slice().sort(),Tr(0,t.rank-1))?M0e(t,e,n,s,o):F0e(t,e,n,s,o)}class Xk extends rt{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Yt(e.betaInitializer||"zeros"),this.gammaInitializer=Yt(e.gammaInitializer||"ones"),this.movingMeanInitializer=Yt(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=Yt(e.movingVarianceInitializer||"ones"),this.betaConstraint=Ln(e.betaConstraint),this.gammaConstraint=Ln(e.gammaConstraint),this.betaRegularizer=Jt(e.betaRegularizer),this.gammaRegularizer=Jt(e.gammaRegularizer)}build(e){e=bt(e);const n=this.axis>=0?this.axis:this.axis+e.length,s=e[n];if(s==null)throw new te(`Axis ${n} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new En({ndim:e.length,axes:{[n]:s}})];const o=[s];this.scale&&(this.gamma=this.addWeight("gamma",o,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",o,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",o,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",o,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,n){return le(()=>{const s=n.training==null?!1:n.training,o=qe(e),r=o.shape,i=r.length,a=Tr(0,i),l=this.axis>=0?this.axis:this.axis+i;a.splice(l,1);const u=lu(1,i);u[l]=r[l];const d=a.slice();d.sort();const h=!lt(d,Tr(0,i).slice(0,i-1)),p=()=>{if(h){const N=ee(this.movingMean.read(),u),I=ee(this.movingVariance.read(),u),k=this.center?ee(this.beta.read(),u):null,A=this.scale?ee(this.gamma.read(),u):null;return Ip(o,N,I,k,A,this.epsilon)}else return Ip(o,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return p();const[x,b,w]=O0e(o,this.gamma.read(),this.beta.read(),a,this.epsilon),C=(N,I,k)=>{le(()=>{const A=1-k,$=N.read(),M=j($e($,I),A);N.write($e($,M))})};return(()=>{C(this.movingMean,b,this.momentum),C(this.movingVariance,w,this.momentum)})(),x})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:sn(this.betaInitializer),gammaInitializer:sn(this.gammaInitializer),movingMeanInitializer:sn(this.movingMeanInitializer),movingVarianceInitializer:sn(this.movingVarianceInitializer),betaRegularizer:Bt(this.betaRegularizer),gammaRegularizer:Bt(this.gammaRegularizer),betaConstraint:Pn(this.betaConstraint),gammaConstraint:Pn(this.gammaConstraint)},n=super.getConfig();return Object.assign(e,n),e}}Xk.className="BatchNormalization";Se(Xk);class Yk extends rt{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const n of this.axis)if(!Number.isInteger(n))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Yt(e.betaInitializer||"zeros"),this.gammaInitializer=Yt(e.gammaInitializer||"ones"),this.betaRegularizer=Jt(e.betaRegularizer),this.gammaRegularizer=Jt(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=bt(e);const n=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let r=0;r<this.axis.length;++r)this.axis[r]<0&&(this.axis[r]+=n);for(const r of this.axis)if(r<0||r>=n)throw new Error(`Invalid axis: ${r}`);if(this.axis.length!==Oa(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(r=>e[r]),o=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,o):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,o):this.beta=null,this.built=!0}call(e,n){const s=qe(e),o=s.shape,r=o.length;return le(()=>{let{mean:a,variance:l}=sg(s,this.axis,!0);const u=lu(1,r);for(const w of this.axis)u[w]=o[w];const d=w=>w!=null&&w.shape.length!==r?ee(w,u):w;let h=this.scale?d(this.gamma.read()):null,p=this.center?d(this.beta.read()):null;const x=[],b=[];for(let w=0;w<r;++w)this.axis.indexOf(w)!==-1?(x.push(o[w]),b.push(1)):(x.push(1),b.push(o[w]));return a=ko(a,x),l=ko(l,x),h!=null&&(h=ko(h,b)),p!=null&&(p=ko(p,b)),Ip(s,a,l,p,h,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:sn(this.betaInitializer),gammaInitializer:sn(this.gammaInitializer),betaRegularizer:Bt(this.betaRegularizer),gammaRegularizer:Bt(this.gammaRegularizer)},n=super.getConfig();return Object.assign(e,n),e}}Yk.className="LayerNormalization";Se(Yk);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function P0e(t,e,n){return le(()=>{if(t.rank!==4)throw new te(`temporalPadding expects input tensor to be 4-D, but received a ${t.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new te("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(n==null&&(n=Sr()),n!=="channelsLast"&&n!=="channelsFirst")throw new te(`Unknown data format: ${n}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return n==="channelsFirst"?s=[[0,0],[0,0],e[0],e[1]]:s=[[0,0],e[0],e[1],[0,0]],Xi(t,s)})}class Jk extends rt{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?Sr():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new te(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let n,s;if(typeof e.padding[0]=="number")n=[e.padding[0],e.padding[0]],s=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new te(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(n=e.padding[0],e.padding[1].length!==2)throw new te(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);s=e.padding[1]}this.padding=[n,s]}this.inputSpec=[new En({ndim:4})]}computeOutputShape(e){e=bt(e);let n,s;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?n=e[2]+this.padding[0][0]+this.padding[0][1]:n=null,e[3]!=null&&e[3]>=0?s=e[3]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],e[1],n,s]):(e[1]!=null&&e[1]>=0?n=e[1]+this.padding[0][0]+this.padding[0][1]:n=null,e[2]!=null&&e[2]>=0?s=e[2]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],n,s,e[3]])}call(e,n){return le(()=>P0e(qe(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}Jk.className="ZeroPadding2D";Se(Jk);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Jb(t,e,n,s,o,r){return le(()=>{xn(o),pU(r),Fo(s),n==null&&(n=[1,1]),s==null&&(s="valid"),o==null&&(o=Sr()),r==null&&(r="max"),t=xk(t,o);let i;const a=s==="same"?"same":"valid";return r==="max"?i=ng(t,e,n,a):i=Xm(t,e,n,a),o==="channelsFirst"&&(i=ct(i,[0,3,1,2])),i})}function l4(t,e,n,s,o,r){return le(()=>{xn(o),pU(r),Fo(s),n==null&&(n=[1,1,1]),s==null&&(s="valid"),o==null&&(o=Sr()),r==null&&(r="max"),t=s4(t,o);let i;const a=s==="same"?"same":"valid";return r==="max"?i=zE(t,e,n,a):i=pE(t,e,n,a),o==="channelsFirst"&&(i=ct(i,[0,4,1,2,3])),i})}class u4 extends rt{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new te(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(qn(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new te(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);qn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,Fo(this.padding),this.inputSpec=[new En({ndim:3})]}computeOutputShape(e){e=bt(e);const n=Cr(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],n,e[2]]}call(e,n){return le(()=>{this.invokeCallHook(e,n),e=mg(qe(e),2);const s=this.poolingFunction(qe(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return rl(s,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=super.getConfig();return Object.assign(e,n),e}}class jk extends u4{constructor(e){super(e)}poolingFunction(e,n,s,o,r){return xn(r),Fo(o),Jb(e,n,s,o,r,"max")}}jk.className="MaxPooling1D";Se(jk);class Zk extends u4{constructor(e){super(e)}poolingFunction(e,n,s,o,r){return xn(r),Fo(o),Jb(e,n,s,o,r,"avg")}}Zk.className="AveragePooling1D";Se(Zk);class c4 extends rt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new te(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];qn(this.poolSize,"poolSize"),qn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,xn(this.dataFormat),Fo(this.padding),this.inputSpec=[new En({ndim:4})]}computeOutputShape(e){e=bt(e);let n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2];return n=Cr(n,this.poolSize[0],this.padding,this.strides[0]),s=Cr(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],n,s]:[e[0],n,s,e[3]]}call(e,n){return le(()=>(this.invokeCallHook(e,n),this.poolingFunction(qe(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class Qk extends c4{constructor(e){super(e)}poolingFunction(e,n,s,o,r){return xn(r),Fo(o),Jb(e,n,s,o,r,"max")}}Qk.className="MaxPooling2D";Se(Qk);class eA extends c4{constructor(e){super(e)}poolingFunction(e,n,s,o,r){return xn(r),Fo(o),Jb(e,n,s,o,r,"avg")}}eA.className="AveragePooling2D";Se(eA);class d4 extends rt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new te(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];qn(this.poolSize,"poolSize"),qn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,xn(this.dataFormat),Fo(this.padding),this.inputSpec=[new En({ndim:5})]}computeOutputShape(e){e=bt(e);let n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],o=this.dataFormat==="channelsFirst"?e[4]:e[3];return n=Cr(n,this.poolSize[0],this.padding,this.strides[0]),s=Cr(s,this.poolSize[1],this.padding,this.strides[1]),o=Cr(o,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],n,s,o]:[e[0],n,s,o,e[4]]}call(e,n){return le(()=>(this.invokeCallHook(e,n),this.poolingFunction(qe(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class tA extends d4{constructor(e){super(e)}poolingFunction(e,n,s,o,r){return xn(r),Fo(o),l4(e,n,s,o,r,"max")}}tA.className="MaxPooling3D";Se(tA);class nA extends d4{constructor(e){super(e)}poolingFunction(e,n,s,o,r){return xn(r),Fo(o),l4(e,n,s,o,r,"avg")}}nA.className="AveragePooling3D";Se(nA);class f4 extends rt{constructor(e){super(e),this.inputSpec=[new En({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,n){throw new Qe}}class sA extends f4{constructor(e){super(e||{})}call(e,n){return le(()=>{const s=qe(e);return tn(s,1)})}}sA.className="GlobalAveragePooling1D";Se(sA);class oA extends f4{constructor(e){super(e||{})}call(e,n){return le(()=>{const s=qe(e);return Do(s,1)})}}oA.className="GlobalMaxPooling1D";Se(oA);class h4 extends rt{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,xn(this.dataFormat),this.inputSpec=[new En({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,n){throw new Qe}getConfig(){const e={dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class rA extends h4{call(e,n){return le(()=>{const s=qe(e);return this.dataFormat==="channelsLast"?tn(s,[1,2]):tn(s,[2,3])})}}rA.className="GlobalAveragePooling2D";Se(rA);class iA extends h4{call(e,n){return le(()=>{const s=qe(e);return this.dataFormat==="channelsLast"?Do(s,[1,2]):Do(s,[2,3])})}}iA.className="GlobalMaxPooling2D";Se(iA);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class p4 extends rt{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=super.getConfig();return Object.assign(e,n),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,n,s={}){const o=n.layer,r=wr(o,s);delete n.layer;const i={layer:r};return Object.assign(i,n),new e(i)}}class aA extends p4{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=bt(e),e.length<3)throw new te(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const n=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=bt(e);const n=[e[0]].concat(e.slice(2)),s=this.layer.computeOutputShape(n),o=e[1];return[s[0],o].concat(s.slice(1))}call(e,n){return le(()=>(e=qe(e),i4((i,a)=>[qe(this.layer.call(i,n)),[]],e,[],!1,null,null,!1,!0)[1]))}}aA.className="TimeDistributed";Se(aA);function L0e(t){Eu(Pge,"BidirectionalMergeMode",t)}const V0e="concat";class lA extends p4{constructor(e){super(e);const n=e.layer.getConfig(),s={};s.className=e.layer.getClassName(),s.config=n,this.forwardLayer=wr(s),n.goBackwards=n.goBackwards!==!0;const o={};if(o.className=e.layer.getClassName(),o.config=n,this.backwardLayer=wr(o),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?V0e:e.mergeMode,L0e(this.mergeMode),e.weights)throw new Qe("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const n=e.length,s=Math.floor(n/2);this.forwardLayer.setWeights(e.slice(0,s)),this.backwardLayer.setWeights(e.slice(s))}computeOutputShape(e){let n=this.forwardLayer.computeOutputShape(e);Array.isArray(n)&&Array.isArray(n[0])||(n=[n]),n=n;let s,o,r;return this.returnState&&(r=n.slice(1)),s=n[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,o=[s]):this.mergeMode==null?o=[s,s.slice()]:o=[s],this.returnState?this.mergeMode==null?o.concat(r).concat(r.slice()):[s].concat(r).concat(r.slice()):Bs(o)}apply(e,n){let s=n==null?null:n.initialState,o=n==null?null:n.constants;n==null&&(n={});const r=r4(e,s,o,this.numConstants);if(e=r.inputs,s=r.initialState,o=r.constants,Array.isArray(e)&&(s=e.slice(1),e=e[0]),(s==null||s.length===0)&&o==null)return super.apply(e,n);const i=[],a=[];if(s!=null){const u=s.length;if(u%2>0)throw new te("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=s,i.push(...s);const d=s.map(h=>new En({shape:h.shape}));this.forwardLayer.stateSpec=d.slice(0,u/2),this.backwardLayer.stateSpec=d.slice(u/2),a.push(...d)}if(o!=null)throw new Qe("Support for constants in Bidirectional layers is not implemented yet.");const l=i[0]instanceof Nr;for(const u of i)if(u instanceof Nr!==l)throw new te("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const u=[e].concat(i),d=this.inputSpec.concat(a),h=this.inputSpec;this.inputSpec=d;const p=super.apply(u,n);return this.inputSpec=h,p}else return super.apply(e,n)}call(e,n){return le(()=>{const s=n.initialState;let o,r;if(s==null)o=this.forwardLayer.call(e,n),r=this.backwardLayer.call(e,n);else{const l=s.slice(0,s.length/2),u=s.slice(s.length/2);o=this.forwardLayer.call(e,Object.assign(n,{initialState:l})),r=this.backwardLayer.call(e,Object.assign(n,{initialState:u}))}let i;this.returnState&&(Array.isArray(o)&&(i=o.slice(1).concat(r.slice(1))),o=o[0],r=r[0]),this.returnSequences&&(r=_o(r,1));let a;return this.mergeMode==="concat"?a=qI([o,r]):this.mergeMode==="sum"?a=Te(o,r):this.mergeMode==="ave"?a=j(.5,Te(o,r)):this.mergeMode==="mul"?a=j(o,r):this.mergeMode==null&&(a=[o,r]),this.returnState?this.mergeMode==null?a.concat(i):[a].concat(i):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){Xl(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),Xl(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,n){Array.isArray(n)&&(n=n[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[n,n]:s=n:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const r=this.forwardLayer.states.map(i=>null);return Array.isArray(s)?s.concat(r).concat(r):[s].concat(r).concat(r)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},n=super.getConfig();return Object.assign(e,n),e}static fromConfig(e,n){const s=wr(n.layer);if(delete n.layer,n.numConstants!=null)throw new Qe("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const o=n;return o.layer=s,new e(o)}}lA.className="Bidirectional";Se(lA);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class uA extends rt{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},n=super.getConfig();return Object.assign(e,n),e}call(e,n){return le(()=>(e=qe(e),e.dtype!=="float32"&&(e=Qr(e,"float32")),Te(j(e,this.scale),this.offset)))}}uA.className="Rescaling";Se(uA);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:z0e,cropAndResize:B0e}=Zo;class cA extends rt{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,n,s,o,r,i,a,l){return le(()=>{let u,d=!1;const h=n/i,p=s/a,x=(o+n)/i,b=(r+s)/a,w=[h,p,x,b],C=[];e.rank===3?(d=!0,u=Ms([e])):u=e;for(let A=0;A<u.shape[0];A++)C.push(w);const T=uo(C,[C.length,4]),N=iu(0,C.length,1,"int32"),k=B0e(u,T,N,[o,r],"nearest");return Qr(d?qe(Mo(k)):k,l)})}upsize(e,n,s,o){return le(()=>{const r=z0e(e,[n,s]);return Qr(r,o)})}call(e,n){return le(()=>{const s=qe(e),o=s.dtype,r=s.shape,i=r[r.length-3],a=r[r.length-2];let l=0;i!==this.height&&(l=Math.floor((i-this.height)/2));let u=0;return a!==this.width&&(u=Math.floor((a-this.width)/2),u===0&&(u=1)),l>=0&&u>=0?this.centerCrop(s,l,u,this.height,this.width,i,a,o):this.upsize(e,this.height,this.width,o)})}getConfig(){const e={height:this.height,width:this.width},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){e=bt(e);const n=e.length-3,s=e.length-2;return e[n]=this.height,e[s]=this.width,e}}cA.className="CenterCrop";Se(cA);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function U0e(t,e,n,s){let o=qe(t);if(o.dtype!=="int32"&&(o=Qr(o,"int32")),e==="int")return o;const r=o.shape;if(o.rank===0&&(o=rs(o,-1)),e==="oneHot"&&o.shape[o.shape.length-1]!==1&&(o=rs(o,-1)),o.rank>2)throw new te(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${r} which would result in output rank ${o.rank}.`);const i=["multiHot","oneHot"].includes(e),a=o;let l;if(typeof s<"u"&&e==="count"?l=Z0(a,s,n,i):l=Z0(a,[],n,i),e!=="tfIdf")return l;if(s)return j(l,s);throw new te("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class dA extends rt{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){return e=bt(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,n){return le(()=>{e=qe(e),e.dtype!=="int32"&&(e=Qr(e,"int32"));let s;if(typeof n.countWeights<"u"){if(this.outputMode!=="count")throw new te(`countWeights is not used when outputMode !== count.
              Received countWeights=${n.countWeights}`);s=qe(n.countWeights)}const o=Do(e),r=Wc(e),i=Ps(this.numTokens,o).bufferSync().get(0),a=Ki(r,0).bufferSync().get(0);if(!(i&&a))throw new te(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return U0e(e,this.outputMode,this.numTokens,s)})}}dA.className="CategoryEncoding";Se(dA);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const G0e=["bilinear","nearest"],VO=new Set(G0e);class fA extends rt{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(VO.has(e.interpolation))this.interpolation=e.interpolation;else throw new te(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=bt(e);const n=e[2];return[this.height,this.width,n]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},n=super.getConfig();return Object.assign(e,n),e}call(e,n){return le(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return Zo.resizeBilinear(e,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Zo.resizeNearestNeighbor(e,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...VO]} are supported`)})}}fA.className="Resizing";Se(fA);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class m4{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}m4.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class g4 extends rt{constructor(e){super(e),this.randomGenerator=new m4(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},n=super.getConfig();return Object.assign(e,n),e}}g4.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const H0e=["bilinear","nearest"],zO=new Set(H0e);class hA extends g4{constructor(e){super(e);const{factor:n,interpolation:s="bilinear"}=e;if(this.factor=n,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new te(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new te(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new te(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(zO.has(s))this.interpolation=s;else throw new te(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){e=bt(e);const n=e[2];return[this.imgHeight,-1,n]}call(e,n){return le(()=>{const s=qe(e);this.imgHeight=s.shape[s.shape.length-3];const o=s.shape[s.shape.length-2];this.widthFactor=ol([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let r=this.widthFactor.dataSync()[0]*o;r=Math.round(r);const i=[this.imgHeight,r];switch(this.interpolation){case"bilinear":return Zo.resizeBilinear(e,i);case"nearest":return Zo.resizeNearestNeighbor(e,i);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...zO]} are supported`)}})}}hA.className="RandomWidth";Se(hA);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function W0e(t){return new gf(t)}function q0e(t){return new mk(t)}function K0e(t){return new fk(t)}function X0e(t){return new hk(t)}function Y0e(t){return new pk(t)}function J0e(t){return new yk(t)}function j0e(t){return new gk(t)}function Z0e(t){return new bg(t)}function Q0e(t){return new vf(t)}function exe(t){return new vk(t)}function txe(t){return new bf(t)}function nxe(t){return new bk(t)}function sxe(t){return new wk(t)}function oxe(t){return new Ck(t)}function rxe(t){return new Tk(t)}function ixe(t){return new Sk(t)}function axe(t){return new Dk(t)}function lxe(t){return new Rk(t)}function uxe(t){return new Yb(t)}function cxe(t){return new Ak(t)}function dxe(t){return new $k(t)}function fxe(t){return new _k(t)}function hxe(t){return new Mk(t)}function pxe(t){return new Fk(t)}function mxe(t){return new Pk(t)}function gxe(t){return new Lk(t)}function yxe(t){return new zk(t)}function xxe(t){return new Gk(t)}function vxe(t){return new Bk(t)}function bxe(t){return new Uk(t)}function wxe(t){return new Vk(t)}function Cxe(t){return new Hk(t)}function Txe(t){return new Xk(t)}function Sxe(t){return new Yk(t)}function Nxe(t){return new Jk(t)}function pA(t){return new Zk(t)}function Exe(t){return pA(t)}function Ixe(t){return pA(t)}function mA(t){return new eA(t)}function kxe(t){return mA(t)}function Axe(t){return mA(t)}function gA(t){return new nA(t)}function Rxe(t){return gA(t)}function $xe(t){return gA(t)}function Dxe(t){return new sA(t)}function _xe(t){return new rA(t)}function y4(t){return new oA(t)}function x4(t){return new iA(t)}function v4(t){return new jk(t)}function b4(t){return new Qk(t)}function Mxe(t){return new tA(t)}function Fxe(t){return new Ek(t)}function Oxe(t){return new qb(t)}function Pxe(t){return new Ik(t)}function Lxe(t){return new Cg(t)}function Vxe(t){return new Nk(t)}function zxe(t){return new Wb(t)}function Bxe(t){return new kk(t)}function Uxe(t){return new Xb(t)}function Gxe(t){return new $r(t)}function Hxe(t){return new Kb(t)}function Wxe(t){return new lA(t)}function qxe(t){return new aA(t)}const Kxe=y4,Xxe=x4,Yxe=v4,Jxe=b4;function jxe(t){return new Wk(t)}function Zxe(t){return new qk(t)}function Qxe(t){return new Kk(t)}function eve(t){return new Ok(t)}function tve(t){return new uA(t)}function nve(t){return new cA(t)}function sve(t){return new fA(t)}function ove(t){return new dA(t)}function rve(t){return new hA(t)}const ive=Object.freeze(Object.defineProperty({__proto__:null,Layer:rt,RNN:$r,RNNCell:wg,activation:axe,add:gxe,alphaDropout:Qxe,average:yxe,averagePooling1d:pA,averagePooling2d:mA,averagePooling3d:gA,avgPool1d:Exe,avgPool2d:kxe,avgPool3d:Rxe,avgPooling1d:Ixe,avgPooling2d:Axe,avgPooling3d:$xe,batchNormalization:Txe,bidirectional:Wxe,categoryEncoding:ove,centerCrop:nve,concatenate:xxe,conv1d:Z0e,conv2d:Q0e,conv2dTranspose:exe,conv3d:txe,conv3dTranspose:nxe,convLstm2d:Bxe,convLstm2dCell:Uxe,cropping2D:oxe,dense:lxe,depthwiseConv2d:ixe,dot:Cxe,dropout:uxe,elu:q0e,embedding:mxe,flatten:dxe,gaussianDropout:Zxe,gaussianNoise:jxe,globalAveragePooling1d:Dxe,globalAveragePooling2d:_xe,globalMaxPool1d:Kxe,globalMaxPool2d:Xxe,globalMaxPooling1d:y4,globalMaxPooling2d:x4,gru:Fxe,gruCell:Oxe,input:zU,inputLayer:W0e,layerNormalization:Sxe,leakyReLU:X0e,lstm:Pxe,lstmCell:Lxe,masking:eve,maxPool1d:Yxe,maxPool2d:Jxe,maxPooling1d:v4,maxPooling2d:b4,maxPooling3d:Mxe,maximum:vxe,minimum:bxe,multiply:wxe,permute:pxe,prelu:Y0e,randomWidth:rve,reLU:K0e,repeatVector:fxe,rescaling:tve,reshape:hxe,resizing:sve,rnn:Gxe,separableConv2d:sxe,simpleRNN:Vxe,simpleRNNCell:zxe,softmax:J0e,spatialDropout1d:cxe,stackedRNNCells:Hxe,thresholdedReLU:j0e,timeDistributed:qxe,upSampling2d:rxe,zeroPadding2d:Nxe},Symbol.toStringTag,{value:"Module"}));function ave(t,e){return ak(t,e)}function lve(t,e){return $U(t,e)}function uve(t,e){return DU(t,e)}function cve(t,e){return lk(t,e)}function dve(t,e){return uk(t,e)}function fve(t,e){return RU(t,e)}function hve(t,e){return Wye(t,e)}function pve(t,e){return ik(t,e)}function mve(t,e){return Bb(t,e)}function gve(t,e){return yf(t,e)}function yve(t,e){return yf(t,e)}function xve(t,e){return yf(t,e)}function vve(t,e){return Iu(t,e)}function bve(t,e){return Iu(t,e)}function wve(t,e){return Iu(t,e)}const Cve=Object.freeze(Object.defineProperty({__proto__:null,MAPE:yve,MSE:bve,binaryAccuracy:ave,binaryCrossentropy:lve,categoricalAccuracy:cve,categoricalCrossentropy:dve,cosineProximity:pve,mape:xve,meanAbsoluteError:mve,meanAbsolutePercentageError:gve,meanSquaredError:vve,mse:wve,precision:fve,recall:hve,sparseCategoricalAccuracy:uve},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Tve=Object.freeze(Object.defineProperty({__proto__:null,modelFromJSON:b0e},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Sve(t){return new vg(t)}function Nve(t){return I0e(t)}function Eve(t){return k0e(t)}const Ive=Object.freeze(Object.defineProperty({__proto__:null,l1:Nve,l1l2:Sve,l2:Eve},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class w4 extends Zc{constructor(){super(...arguments),this.model=null}setModel(e){if(!(e instanceof $i))throw new Error("model must be a LayersModel, not some other Container");this.model=e}}function t0(t,e){return t<e}function BO(t,e){return t>e}class C4 extends w4{constructor(e){if(super(),e==null&&(e={}),e.restoreBestWeights)throw new Qe("restoreBestWeights = True is not implemented in EarlyStopping yet.");this.monitor=e.monitor||"val_loss",this.minDelta=Math.abs(e.minDelta||0),this.patience=e.patience||0,this.verbose=e.verbose||0,this.mode=e.mode||"auto",this.baseline=e.baseline,["auto","min","max"].indexOf(this.mode)===-1&&(console.warn(`EarlyStopping mode '${this.mode}' is invalid. Falling back to mode 'auto'.`),this.mode="auto"),this.mode==="min"?this.monitorFunc=t0:this.mode==="max"?this.monitorFunc=BO:this.monitor.indexOf("acc")!==-1?this.monitorFunc=BO:this.monitorFunc=t0,this.monitorFunc===t0&&(this.minDelta*=-1)}async onTrainBegin(e){this.wait=0,this.stoppedEpoch=0,this.baseline!=null?this.best=this.baseline:this.best=this.monitorFunc===t0?1/0:-1/0}async onEpochEnd(e,n){await Na(n);const s=this.getMonitorValue(n);s!=null&&(this.monitorFunc(s-this.minDelta,this.best)?(this.best=s,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=e,this.model.stopTraining=!0)))}async onTrainEnd(e){this.stoppedEpoch>0&&this.verbose&&console.log(`Epoch ${this.stoppedEpoch}: early stopping.`)}getMonitorValue(e){e==null&&(e={});const n=e[this.monitor];return n==null&&console.warn(`Metric for EarlyStopping ${this.monitor} is not available. Available metrics are: ${Object.keys(e)}`),n}}function kve(t){return new C4(t)}const Ave={earlyStopping:kve};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rve=ue();Rve.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var oo;(function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"})(oo||(oo={}));var UO;(function(t){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))})(UO||(UO={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yA={};function $ve(t,e){const n={tfOpName:t,category:"custom",inputs:[],attrs:[],customExecutor:e};yA[t]=n}function T4(t){return yA[t]}function Dve(t){delete yA[t]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R(t,e,n,s,o){const r=e.inputParams[t];if(r&&r.inputIndexStart!==void 0){const a=r.inputIndexStart,l=r.inputIndexEnd===0?void 0:r.inputIndexEnd===void 0?a+1:r.inputIndexEnd,u=a<0?e.inputNames.length+a:a;if(r.type==="tensor")return is(e.inputNames[u],n,s,o);if(r.type==="tensors"){const p=e.inputs.slice(a,l);return e.inputNames.slice(a,l).filter((b,w)=>{var C;return((C=p[w])===null||C===void 0?void 0:C.op)!=="NoOp"}).map(b=>is(b,n,s,o))}const d=is(e.inputNames[u],n,s,o),h=d.dataSync();return r.type==="number"?h[0]:$o(d.shape,h)}const i=e.attrParams[t];return i&&i.value}function is(t,e,n,s){const[o,r]=io(t,n);if(s!=null){const a=s.getHashTableHandleByName(o);if(a!=null)return a}const i=n.currentContextIds.find(a=>!!e[ux(o,a)]);return i!==void 0?e[ux(o,i)][r]:void 0}function GO(t,e,n){return e[ux(t,n.currentContextId)]}function Ii(t,e){const[n,s,o]=io(t,e);return[ux(n,e&&e.currentContextId),s,o]}function ux(t,e){return e?`${t}-${e}`:t}function io(t,e){if(t==="")return["",0,void 0];const n=e!=null&&e.parseNodeNameCache!=null;if(n){const r=e.parseNodeNameCache.get(t);if(r!=null)return r}const s=t.split(":");let o;if(s.length===1)o=[t,0,void 0];else{const r=s[0],i=s.length===3?s[1]:void 0,a=Number(s[s.length-1]);o=[r,a,i]}return n&&e.parseNodeNameCache.set(t,o),o}function I0(t,e,n){let s=R("pad",t,e,n);if(s==="explicit"){s=R("explicitPaddings",t,e,n);const o=[[0,0],[0,0],[0,0],[0,0]];for(let r=0;r<4;r++)o[r][0]=s[r*2],o[r][1]=s[r*2+1];return o}return s}function ki(t){return t.kept?t:jr(t)}/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ve=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Mve=Object.freeze(Object.defineProperty({__proto__:null,json:_ve},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fve=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsFinite",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsInf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Ove=Object.freeze(Object.defineProperty({__proto__:null,json:Fve},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pve=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],Lve=Object.freeze(Object.defineProperty({__proto__:null,json:Pve},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vve=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],zve=Object.freeze(Object.defineProperty({__proto__:null,json:Vve},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bve=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniformInt",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number"},{tfName:"maxval",name:"maxval",type:"number"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],Uve=Object.freeze(Object.defineProperty({__proto__:null,json:Bve},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gve=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Hve=Object.freeze(Object.defineProperty({__proto__:null,json:Gve},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wve=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],qve=Object.freeze(Object.defineProperty({__proto__:null,json:Wve},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kve=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],Xve=Object.freeze(Object.defineProperty({__proto__:null,json:Kve},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yve=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],Jve=Object.freeze(Object.defineProperty({__proto__:null,json:Yve},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jve=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],Zve=Object.freeze(Object.defineProperty({__proto__:null,json:jve},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qve=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BitwiseAnd",category:"logical",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}]}],ebe=Object.freeze(Object.defineProperty({__proto__:null,json:Qve},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tbe=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"MatrixBandPart",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"numLower",type:"tensor"},{start:1,name:"numUpper",type:"tensor"}]}],nbe=Object.freeze(Object.defineProperty({__proto__:null,json:tbe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sbe=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]}],obe=Object.freeze(Object.defineProperty({__proto__:null,json:sbe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rbe=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],ibe=Object.freeze(Object.defineProperty({__proto__:null,json:rbe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const abe=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]},{tfOpName:"TensorScatterUpdate",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],lbe=Object.freeze(Object.defineProperty({__proto__:null,json:abe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ube=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],cbe=Object.freeze(Object.defineProperty({__proto__:null,json:ube},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dbe=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],fbe=Object.freeze(Object.defineProperty({__proto__:null,json:dbe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hbe=[{tfOpName:"StaticRegexReplace",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"pattern",name:"pattern",type:"string"},{tfName:"rewrite",name:"rewrite",type:"string"},{tfName:"replace_global",name:"replaceGlobal",type:"bool"}]},{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],pbe=Object.freeze(Object.defineProperty({__proto__:null,json:hbe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mbe=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"EnsureShape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],gbe=Object.freeze(Object.defineProperty({__proto__:null,json:mbe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HO{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const e=[Mve,Ove,Lve,zve,Uve,Hve,qve,Xve,Jve,Zve,ebe,nbe,obe,ibe,lbe,cbe,fbe,pbe,gbe],n=[].concat(...e.map(s=>s.json));this.opMappers=n.reduce((s,o)=>(s[o.tfOpName]=o,s),{})}transformGraph(e,n={}){const s=e.node,o=[],r=[],i=[],a=s.reduce((w,C)=>(w[C.name]=this.mapNode(C),C.op.startsWith("Placeholder")?o.push(w[C.name]):C.op==="Const"?r.push(w[C.name]):(C.input==null||C.input.length===0)&&i.push(w[C.name]),w),{});let l=[];const u=[];let d={},h={};n!=null&&(d=this.mapSignatureEntries(n.inputs),h=this.mapSignatureEntries(n.outputs));const p=Object.keys(a);p.forEach(w=>{const C=a[w];C.inputNames.forEach((T,N)=>{const[I,,k]=Ii(T),A=a[I];if(A.outputs!=null){const $=A.outputs.indexOf(k);if($!==-1){const M=`${I}:${$}`;C.inputNames[N]=M}}C.inputs.push(A),A.children.push(C)})}),Object.keys(h).length===0?p.forEach(w=>{const C=a[w];C.children.length===0&&u.push(C)}):Object.keys(h).forEach(w=>{const[C]=Ii(w),T=a[C];T!=null&&(T.signatureKey=h[w],u.push(T))}),Object.keys(d).length>0?Object.keys(d).forEach(w=>{const[C]=Ii(w),T=a[C];T&&(T.signatureKey=d[w],l.push(T))}):l=o;let x={};e.library!=null&&e.library.function!=null&&(x=e.library.function.reduce((w,C)=>(w[C.signature.name]=this.mapFunction(C),w),{}));const b={nodes:a,inputs:l,outputs:u,weights:r,placeholders:o,signature:n,functions:x};return i.length>0&&(b.initNodes=i),b}mapSignatureEntries(e){return Object.keys(e||{}).reduce((n,s)=>(n[e[s].name]=s,n),{})}mapNode(e){const n=T4(e.op)||this.opMappers[e.op]||{};e.attr==null&&(e.attr={});const s={name:e.name,op:e.op,category:n.category,inputNames:(e.input||[]).map(o=>o.startsWith("^")?o.slice(1):o),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:n.outputs};return n.inputs!=null&&(s.inputParams=n.inputs.reduce((o,r)=>(o[r.name]={type:r.type,inputIndexStart:r.start,inputIndexEnd:r.end},o),{})),n.attrs!=null&&(s.attrParams=n.attrs.reduce((o,r)=>{const i=r.type;let a;switch(r.type){case"string":a=TS(e.attr,r.tfName,r.defaultValue),a===void 0&&r.tfDeprecatedName&&(a=TS(e.attr,r.tfDeprecatedName,r.defaultValue));break;case"string[]":a=RS(e.attr,r.tfName,r.defaultValue),a===void 0&&r.tfDeprecatedName&&(a=RS(e.attr,r.tfDeprecatedName,r.defaultValue));break;case"number":a=NS(e.attr,r.tfName,r.defaultValue||0),a===void 0&&r.tfDeprecatedName&&(a=NS(e.attr,r.tfDeprecatedName,r.defaultValue));break;case"number[]":a=AS(e.attr,r.tfName,r.defaultValue),a===void 0&&r.tfDeprecatedName&&(a=AS(e.attr,r.tfDeprecatedName,r.defaultValue));break;case"bool":a=SS(e.attr,r.tfName,r.defaultValue),a===void 0&&r.tfDeprecatedName&&(a=SS(e.attr,r.tfDeprecatedName,r.defaultValue));break;case"bool[]":a=DS(e.attr,r.tfName,r.defaultValue),a===void 0&&r.tfDeprecatedName&&(a=DS(e.attr,r.tfDeprecatedName,r.defaultValue));break;case"shape":a=kS(e.attr,r.tfName,r.defaultValue),a===void 0&&r.tfDeprecatedName&&(a=kS(e.attr,r.tfDeprecatedName,r.defaultValue));break;case"shape[]":a=$S(e.attr,r.tfName,r.defaultValue),a===void 0&&r.tfDeprecatedName&&(a=$S(e.attr,r.tfDeprecatedName,r.defaultValue));break;case"dtype":a=ES(e.attr,r.tfName,r.defaultValue),a===void 0&&r.tfDeprecatedName&&(a=ES(e.attr,r.tfDeprecatedName,r.defaultValue));break;case"dtype[]":a=IS(e.attr,r.tfName,r.defaultValue),a===void 0&&r.tfDeprecatedName&&(a=IS(e.attr,r.tfDeprecatedName,r.defaultValue));break;case"func":a=WO(e.attr,r.tfName,r.defaultValue),a===void 0&&r.tfDeprecatedName&&(a=WO(e.attr,r.tfDeprecatedName,r.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${r.type} for op: ${e.op}`)}return o[r.name]={value:a,type:i},o},{})),s}mapFunction(e){const n=e.nodeDef,s=[],o=[];let r={};n!=null&&(r=n.reduce((h,p)=>(h[p.name]=this.mapNode(p),p.op==="Const"&&o.push(h[p.name]),h),{}));const i=[],a=[];e.signature.inputArg.forEach(h=>{const[p]=Ii(h.name),x={name:p,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:xA(h.type),type:"dtype"}},children:[]};x.signatureKey=h.name,i.push(x),r[p]=x}),Object.keys(r).forEach(h=>{const p=r[h];p.inputNames.forEach((x,b)=>{const[w,,C]=Ii(x),T=r[w];if(T.outputs!=null){const N=T.outputs.indexOf(C);if(N!==-1){const I=`${w}:${N}`;p.inputNames[b]=I}}p.inputs.push(T),T.children.push(p)})});const u=e.ret;e.signature.outputArg.forEach(h=>{const[p,x]=Ii(u[h.name]),b=r[p];b!=null&&(b.defaultOutput=x,a.push(b))});const d=this.mapArgsToSignature(e);return{nodes:r,inputs:i,outputs:a,weights:o,placeholders:s,signature:d}}mapArgsToSignature(e){return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((n,s)=>(n[s.name]=this.mapArgToTensorInfo(s),n),{}),outputs:e.signature.outputArg.reduce((n,s)=>(n[s.name]=this.mapArgToTensorInfo(s,e.ret),n),{})}}mapArgToTensorInfo(e,n){let s=e.name;return n!=null&&(s=n[s]),{name:s,dtype:e.type}}}function ybe(t){const e=ue().global;if(typeof e.atob<"u")return e.atob(t);if(typeof Buffer<"u")return new Buffer(t,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function S4(t,e){const n=Array.isArray(t)?String.fromCharCode.apply(null,t):ybe(t);return e?n:n.toLowerCase()}function TS(t,e,n,s=!1){const o=t[e];return o!=null?S4(o.s,s):n}function SS(t,e,n){const s=t[e];return s?s.b:n}function NS(t,e,n){const s=t[e]||{},o=s.i!=null?s.i:s.f!=null?s.f:n;return typeof o=="number"?o:parseInt(o,10)}function xA(t){switch(typeof t=="string"&&(t=oo[t]),t){case oo.DT_FLOAT:case oo.DT_HALF:return"float32";case oo.DT_INT32:case oo.DT_INT64:case oo.DT_INT8:case oo.DT_UINT8:return"int32";case oo.DT_BOOL:return"bool";case oo.DT_DOUBLE:return"float32";case oo.DT_STRING:return"string";case oo.DT_COMPLEX64:case oo.DT_COMPLEX128:return"complex64";default:return null}}function WO(t,e,n){const s=t[e];return s&&s.func?s.func.name:n}function ES(t,e,n){const s=t[e];return s&&s.type?xA(s.type):n}function IS(t,e,n){const s=t[e];return s&&s.list&&s.list.type?s.list.type.map(o=>xA(o)):n}function N4(t){if(!t.unknownRank)return t.dim!=null?t.dim.map(e=>typeof e.size=="number"?e.size:parseInt(e.size,10)):[]}function kS(t,e,n){const s=t[e];return s&&s.shape?N4(s.shape):n}function AS(t,e,n){const s=t[e];return s?((s.list.f&&s.list.f.length?s.list.f:s.list.i)||[]).map(o=>typeof o=="number"?o:parseInt(o,10)):n}function RS(t,e,n,s=!1){const o=t[e];return o&&o.list&&o.list.s?o.list.s.map(r=>S4(r,s)):n}function $S(t,e,n){const s=t[e];return s&&s.list&&s.list.shape?s.list.shape.map(o=>N4(o)):n}function DS(t,e,n){const s=t[e];return s&&s.list&&s.list.b?s.list.b:n}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xbe{constructor(e,n,s){this.node=e,this.tensorMap=n,this.context=s,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(o=>this.getInput(o)),e.rawAttrs!=null&&(this.attrs=Object.keys(e.rawAttrs).reduce((o,r)=>(o[r]=this.getAttr(r),o),{}))}getInput(e){return is(e,this.tensorMap,this.context)}getAttr(e,n){const s=this.node.rawAttrs[e];if(s.tensor!=null)return is(e,this.tensorMap,this.context);if(s.i!=null||s.f!=null)return NS(this.node.rawAttrs,e,n);if(s.s!=null)return TS(this.node.rawAttrs,e,n);if(s.b!=null)return SS(this.node.rawAttrs,e,n);if(s.shape!=null)return kS(this.node.rawAttrs,e,n);if(s.type!=null)return ES(this.node.rawAttrs,e,n);if(s.list!=null){if(s.list.i!=null||s.list.f!=null)return AS(this.node.rawAttrs,e,n);if(s.list.s!=null)return RS(this.node.rawAttrs,e,n);if(s.list.shape!=null)return $S(this.node.rawAttrs,e,n);if(s.list.b!=null)return DS(this.node.rawAttrs,e,n);if(s.list.type!=null)return IS(this.node.rawAttrs,e,n)}return n}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ps=Object.freeze(Object.defineProperty({__proto__:null,OP_SCOPE_SUFFIX:jN,abs:Sn,acos:rE,acosh:iE,add:Te,addN:dz,all:Wv,any:wp,argMax:nu,argMin:aE,asin:lE,asinh:uE,atan:cE,atan2:dE,atanh:fE,avgPool:Xm,avgPool3d:pE,basicLSTMCell:fz,batchNorm:lf,batchNorm2d:mE,batchNorm3d:gE,batchNorm4d:yE,batchToSpaceND:Ym,bincount:xE,bitwiseAnd:hz,booleanMaskAsync:jz,broadcastArgs:pz,broadcastTo:Kl,buffer:et,cast:Ne,ceil:vE,clipByValue:Ks,clone:jr,complex:Li,concat:mn,concat1d:bE,concat2d:wE,concat3d:CE,concat4d:TE,conv1d:qv,conv2d:Vi,conv2dTranspose:Kv,conv3d:NE,conv3dTranspose:EE,cos:Jm,cosh:Xv,cosineWindow:yb,cumprod:Sp,cumsum:Yv,denseBincount:Z0,depthToSpace:IE,depthwiseConv2d:uf,diag:gz,dilation2d:kE,div:Pe,divNoNan:AE,dot:RE,dropout:oI,einsum:Fl,elu:cf,enclosingPowerOfTwo:rI,ensureShape:yz,equal:co,erf:Jv,euclideanNorm:DE,exp:Xs,expandDims:rs,expm1:_E,eye:jv,fft:ug,fill:Cu,floor:ff,floorDiv:Hv,fused:iB,gather:hf,gatherND:tB,greater:Ps,greaterEqual:Ki,ifft:Jc,imag:jm,image:Zo,inTopKAsync:nB,irfft:db,isFinite:ME,isInf:FE,isNaN:OE,leakyRelu:Zm,less:qc,lessEqual:sl,linalg:lI,linspace:bz,localResponseNormalization:PE,log:fo,log1p:Qm,logSigmoid:LE,logSoftmax:Qv,logSumExp:eg,logicalAnd:nr,logicalNot:tg,logicalOr:eb,logicalXor:VE,losses:hB,lowerBound:Cz,matMul:st,max:Do,maxPool:ng,maxPool3d:zE,maxPoolWithArgmax:Tz,maximum:ii,mean:tn,meshgrid:Sz,min:Wc,minimum:Wa,mirrorPad:BE,mod:UE,moments:sg,movingAverage:Zz,mul:j,multiRNNCell:Nz,multinomial:Ez,neg:Ht,norm:df,notEqual:ru,oneHot:Kc,ones:Gs,onesLike:ho,op:K,outerProduct:Iz,pad:Xi,pad1d:kz,pad2d:Az,pad3d:Rz,pad4d:$z,pool:GE,pow:si,prelu:rg,print:oE,prod:HE,raggedGather:Dz,raggedRange:_z,raggedTensorToTensor:Mz,rand:Fz,randomGamma:Lz,randomNormal:nb,randomStandardNormal:Vz,randomUniform:ol,randomUniformInt:zz,range:iu,real:Xc,reciprocal:XE,relu:Ar,relu6:sb,reshape:ee,reverse:_o,reverse1d:Bz,reverse2d:Uz,reverse3d:Gz,reverse4d:Hz,rfft:cg,round:ob,rsqrt:rb,scalar:Be,scatterND:Qz,searchSorted:tb,selu:ib,separableConv2d:ab,setdiff1dAsync:Wz,sigmoid:br,sign:YE,signal:fB,sin:lb,sinh:ub,slice:mt,slice1d:ig,slice2d:cb,slice3d:ag,slice4d:Yc,softmax:lg,softplus:Tu,spaceToBatchND:og,sparse:pB,sparseToDense:eB,spectral:dB,split:Hs,sqrt:Yn,square:Ot,squaredDifference:fb,squeeze:rl,stack:Ms,step:Su,stridedSlice:JE,string:mB,sub:$e,sum:_e,tan:jE,tanh:Ha,tensor:uo,tensor1d:us,tensor2d:Fa,tensor3d:ZE,tensor4d:qz,tensor5d:Kz,tensor6d:Xz,tensorScatterUpdate:Yz,tile:ko,topk:eI,transpose:ct,truncatedNormal:pb,unique:tI,unsortedSegmentSum:mb,unstack:Mo,upperBound:Jz,variable:nI,where:Kn,whereAsync:sI,zeros:Nn,zerosLike:gt},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vbe=(t,e,n,s=ps)=>{switch(t.op){case"BiasAdd":case"AddV2":case"Add":return[s.add(R("a",t,e,n),R("b",t,e,n))];case"AddN":return[s.addN(R("tensors",t,e,n))];case"FloorMod":case"Mod":return[s.mod(R("a",t,e,n),R("b",t,e,n))];case"Mul":return[s.mul(R("a",t,e,n),R("b",t,e,n))];case"RealDiv":case"Div":return[s.div(R("a",t,e,n),R("b",t,e,n))];case"DivNoNan":return[s.divNoNan(R("a",t,e,n),R("b",t,e,n))];case"FloorDiv":return[s.floorDiv(R("a",t,e,n),R("b",t,e,n))];case"Sub":return[s.sub(R("a",t,e,n),R("b",t,e,n))];case"Minimum":return[s.minimum(R("a",t,e,n),R("b",t,e,n))];case"Maximum":return[s.maximum(R("a",t,e,n),R("b",t,e,n))];case"Pow":return[s.pow(R("a",t,e,n),R("b",t,e,n))];case"SquaredDifference":return[s.squaredDifference(R("a",t,e,n),R("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bbe=(t,e,n,s=ps)=>{switch(t.op){case"Abs":case"ComplexAbs":return[s.abs(R("x",t,e,n))];case"Acos":return[s.acos(R("x",t,e,n))];case"Acosh":return[s.acosh(R("x",t,e,n))];case"Asin":return[s.asin(R("x",t,e,n))];case"Asinh":return[s.asinh(R("x",t,e,n))];case"Atan":return[s.atan(R("x",t,e,n))];case"Atan2":return[s.atan2(R("x",t,e,n),R("y",t,e,n))];case"Atanh":return[s.atanh(R("x",t,e,n))];case"Ceil":return[s.ceil(R("x",t,e,n))];case"Complex":return[s.complex(R("real",t,e,n),R("imag",t,e,n))];case"Cos":return[s.cos(R("x",t,e,n))];case"Cosh":return[s.cosh(R("x",t,e,n))];case"Elu":return[s.elu(R("x",t,e,n))];case"Erf":return[s.erf(R("x",t,e,n))];case"Exp":return[s.exp(R("x",t,e,n))];case"Expm1":return[s.expm1(R("x",t,e,n))];case"Floor":return[s.floor(R("x",t,e,n))];case"Log":return[s.log(R("x",t,e,n))];case"Log1p":return[s.log1p(R("x",t,e,n))];case"Imag":return[s.imag(R("x",t,e,n))];case"Neg":return[s.neg(R("x",t,e,n))];case"Reciprocal":return[s.reciprocal(R("x",t,e,n))];case"Real":return[s.real(R("x",t,e,n))];case"Relu":return[s.relu(R("x",t,e,n))];case"Round":return[s.round(R("x",t,e,n))];case"Selu":return[s.selu(R("x",t,e,n))];case"Sigmoid":return[s.sigmoid(R("x",t,e,n))];case"Sin":return[s.sin(R("x",t,e,n))];case"Sign":return[s.sign(R("x",t,e,n))];case"Sinh":return[s.sinh(R("x",t,e,n))];case"Softplus":return[s.softplus(R("x",t,e,n))];case"Sqrt":return[s.sqrt(R("x",t,e,n))];case"Square":return[s.square(R("x",t,e,n))];case"Tanh":return[s.tanh(R("x",t,e,n))];case"Tan":return[s.tan(R("x",t,e,n))];case"ClipByValue":return[s.clipByValue(R("x",t,e,n),R("clipValueMin",t,e,n),R("clipValueMax",t,e,n))];case"Relu6":return[s.relu6(R("x",t,e,n))];case"Rsqrt":return[s.rsqrt(is(t.inputNames[0],e,n))];case"LeakyRelu":return[s.leakyRelu(R("x",t,e,n),R("alpha",t,e,n))];case"Prelu":return[s.prelu(R("x",t,e,n),R("alpha",t,e,n))];case"IsNan":return[s.isNaN(is(t.inputNames[0],e,n))];case"IsInf":return[s.isInf(is(t.inputNames[0],e,n))];case"IsFinite":return[s.isFinite(is(t.inputNames[0],e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jo(t,e,n=""){if(!(typeof t=="number"||typeof e=="number")){L(t.length===e.length,()=>n+` Shapes ${t} and ${e} must match`);for(let s=0;s<t.length;s++){const o=t[s],r=e[s];L(o<0||r<0||o===r,()=>n+` Shapes ${t} and ${e} must match`)}}}function qO(t){return!(typeof t=="number"||t.some(e=>e<0))}function Mh(t,e,n){let s=_S(t,n);const o=!qO(s);if(o&&e.length===0)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${s}`);if(o&&e.forEach(r=>{s=_S(r.shape,s)}),!qO(s))throw new Error(`Non-fully-defined elementShape: ${s}`);return s}function _S(t,e){if(typeof t=="number")return e;if(typeof e=="number")return t;if(t.length!==e.length)throw new Error(`Incompatible ranks during merge: ${t} vs. ${e}`);const n=[];for(let s=0;s<t.length;++s){const o=t[s],r=e[s];if(o>=0&&r>=0&&o!==r)throw new Error(`Incompatible shape during merge: ${t} vs. ${e}`);n[s]=o>=0?o:r}return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wbe{constructor(e,n,s,o,r,i,a){this.name=e,this.dtype=n,this.maxSize=s,this.elementShape=o,this.identicalElementShapes=r,this.dynamicSize=i,this.clearAfterRead=a,this.tensors=[],this.closed_=!1,this.idTensor=Be(0),Fn(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(e){this.tensors.forEach(n=>{(e==null||!e.has(n.tensor.id))&&n.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||e>=this.size())throw new Error(`Tried to read from index ${e}, but array size is: ${this.size()}`);const n=this.tensors[e];if(n.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${e} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(n.cleared=!0),n.read=!0,n.tensor}readMany(e){return e.map(n=>this.read(n))}write(e,n){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error(`Tried to write to index ${e}, but array is not resizeable and size is: ${this.maxSize}`);const s=this.tensors[e]||{};if(n.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e},
          because the value dtype is ${n.dtype}, but TensorArray dtype is ${this.dtype}.`);if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=n.shape),jo(this.elementShape,n.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${e}.`),s.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been read.`);if(s.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been written.`);s.tensor=n,Fn(n),s.written=!0,this.tensors[e]=s}writeMany(e,n){if(e.length!==n.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${e.length} is not the same as tensors size: ${n.length}.`);e.forEach((s,o)=>this.write(s,n[o]))}gather(e,n){if(n&&n!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${n}`);if(e)e=e.slice(0,this.size());else{e=[];for(let o=0;o<this.size();o++)e.push(o)}if(e.length===0)return uo([],[0].concat(this.elementShape));const s=this.readMany(e);return jo(this.elementShape,s[0].shape,"TensorArray shape mismatch: "),Ms(s,0)}concat(e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${e}`);if(this.size()===0)return uo([],[0].concat(this.elementShape));const n=[];for(let o=0;o<this.size();o++)n.push(o);const s=this.readMany(n);return jo(this.elementShape,s[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${s[0].shape})`),mn(s,0)}scatter(e,n){if(n.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${n.dtype}`);if(e.length!==n.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${n.shape[0]}`);const s=Math.max(...e);if(!this.dynamicSize&&s>=this.maxSize)throw new Error(`Max index must be < array size (${s}  vs. ${this.maxSize})`);this.writeMany(e,Mo(n,0))}split(e,n){if(n.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${n.dtype}`);let s=0;const o=e.map(l=>(s+=l,s));if(s!==n.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${s}, and tensor's shape is: ${n.shape}`);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${e.length}), and the TensorArray is not marked as dynamically resizeable`);const r=s===0?0:n.size/s,i=[];le(()=>{n=ee(n,[1,s,r]);for(let l=0;l<e.length;++l){const d=[0,l===0?0:o[l-1],0],h=[1,e[l],r];i[l]=ee(mt(n,d,h),this.elementShape)}return i});const a=[];for(let l=0;l<e.length;l++)a[l]=l;this.writeMany(a,i)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cu{get id(){return this.idTensor.id}constructor(e,n,s,o=-1){this.tensors=e,this.elementShape=n,this.elementDtype=s,e!=null&&e.forEach(r=>{if(s!==r.dtype)throw new Error(`Invalid data types; op elements ${s}, but list elements ${r.dtype}`);jo(n,r.shape,"TensorList shape mismatch: "),Fn(r)}),this.idTensor=Be(0),this.maxNumElements=o,Fn(this.idTensor)}copy(){return new cu([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(e){this.tensors.forEach(n=>{(e==null||!e.has(n.id))&&n.dispose()}),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(e,n,s=-1){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(s!==-1&&this.tensors.length!==s)throw new Error(`Operation expected a list with ${s} elements but got a list with ${this.tensors.length} elements.`);jo(e,this.elementShape,"TensorList shape mismatch: ");const o=Mh(this.elementShape,this.tensors,e);return le(()=>{const r=this.tensors.map(i=>ee(i,o));return Ms(r,0)})}popBack(e,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(this.size()===0)throw new Error("Trying to pop from an empty list.");const s=Mh(this.elementShape,this.tensors,e),o=this.tensors.pop();return o.kept=!1,jo(o.shape,e,"TensorList shape mismatch: "),ee(o,s)}pushBack(e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(jo(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Fn(e),this.tensors.push(e)}resize(e){if(e<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${e}`);if(this.maxNumElements!==-1&&e>this.maxNumElements)throw new Error(`TensorListResize input size ${e} is greater maxNumElement ${this.maxNumElements}.`);const n=new cu([],this.elementShape,this.elementDtype,this.maxNumElements);n.tensors.length=e;for(let s=0;s<Math.min(this.tensors.length,e);++s)n.tensors[s]=this.tensors[s];return n}getItem(e,n,s){if(s!==this.elementDtype)throw new Error(`Invalid data types; op elements ${s}, but list elements ${this.elementDtype}`);if(e<0||e>this.tensors.length)throw new Error(`Trying to access element ${e} in a list with ${this.tensors.length} elements.`);if(this.tensors[e]==null)throw new Error(`element at index ${e} is null.`);jo(this.tensors[e].shape,n,"TensorList shape mismatch: ");const o=Mh(this.elementShape,this.tensors,n);return ee(this.tensors[e],o)}setItem(e,n){if(n.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n.dtype}, but list elements ${this.elementDtype}`);if(e<0||this.maxNumElements!==-1&&e>=this.maxNumElements)throw new Error(`Trying to set element ${e} in a list with max ${this.maxNumElements} elements.`);jo(this.elementShape,n.shape,"TensorList shape mismatch: "),Fn(n),this.tensors[e]!=null&&(this.tensors[e].kept=!1),this.tensors[e]=n}gather(e,n,s){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);jo(this.elementShape,s,"TensorList shape mismatch: "),e=e.slice(0,this.size());const o=Mh(this.elementShape,this.tensors,s);return e.length===0?uo([],[0].concat(o)):le(()=>{const r=e.map(i=>ee(this.tensors[i],o));return Ms(r,0)})}concat(e,n){if(e&&e!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${e}`);jo(this.elementShape,n,"TensorList shape mismatch: ");const s=Mh(this.elementShape,this.tensors,n);return this.size()===0?uo([],[0].concat(s)):le(()=>{const o=this.tensors.map(r=>ee(r,s));return mn(o,0)})}}function Cbe(t,e,n){const s=t.dtype;if(t.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${t.shape}`);if(t.dtype!==n)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${n}`);const o=t.shape.slice(1);jo(o,e,"TensorList shape mismatch: ");const r=Mo(t);return new cu(r,e,s)}function Tbe(t,e,n,s){return new cu([],t,e,s)}function Sbe(t,e,n,s){if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);const o=Math.max(...e);if(s!=null&&s!==-1&&o>=s)throw new Error(`Max index must be < array size (${o}  vs. ${s})`);const r=new cu([],n,t.dtype,s),i=Mo(t,0);return e.forEach((a,l)=>{r.setItem(a,i[l])}),r}function Nbe(t,e,n){let s=0;const o=e.map(d=>(s+=d,s));if(s!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${s}, and tensor's shape is: ${t.shape}`);const r=t.shape.slice(1),i=_S(r,n),a=s===0?0:t.size/s,l=le(()=>{const d=[];t=ee(t,[1,s,a]);for(let h=0;h<e.length;++h){const x=[0,h===0?0:o[h-1],0],b=[1,e[h],a];d[h]=ee(mt(t,x,b),i)}return t.dispose(),d}),u=new cu([],n,t.dtype,e.length);for(let d=0;d<l.length;d++)u.setItem(d,l[d]);return u}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ebe=async(t,e,n)=>{switch(t.op){case"If":case"StatelessIf":{const s=R("thenBranch",t,e,n),o=R("elseBranch",t,e,n),r=R("cond",t,e,n),i=R("args",t,e,n);return(await r.data())[0]?n.functionMap[s].executeFunctionAsync(i,n.tensorArrayMap,n.tensorListMap):n.functionMap[o].executeFunctionAsync(i,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{const s=R("body",t,e,n),o=R("cond",t,e,n),r=R("args",t,e,n),i=await n.functionMap[o].executeFunctionAsync(r,n.tensorArrayMap,n.tensorListMap),a=r.map(d=>d.id);let l=await i[0].data();i.forEach(d=>{!d.kept&&a.indexOf(d.id)===-1&&d.dispose()});let u=r;for(;l[0];){const d=u;u=await n.functionMap[s].executeFunctionAsync(u,n.tensorArrayMap,n.tensorListMap);const h=u.map(x=>x.id);d.forEach(x=>{!x.kept&&a.indexOf(x.id)===-1&&h.indexOf(x.id)===-1&&x.dispose()});const p=await n.functionMap[o].executeFunctionAsync(u,n.tensorArrayMap,n.tensorListMap);l=await p[0].data(),p.forEach(x=>{!x.kept&&a.indexOf(x.id)===-1&&h.indexOf(x.id)===-1&&x.dispose()})}return u}case"LoopCond":{const s=R("pred",t,e,n);return[ki(s)]}case"Switch":{const s=R("pred",t,e,n);let o=R("data",t,e,n);return o.kept||(o=ki(o)),(await s.data())[0]?[void 0,o]:[o,void 0]}case"Merge":{const s=t.inputNames.find(o=>is(o,e,n)!==void 0);if(s){const o=is(s,e,n);return[ki(o)]}return}case"Enter":{const s=R("frameName",t,e,n),o=R("tensor",t,e,n);return n.enterFrame(s),[ki(o)]}case"Exit":{const s=R("tensor",t,e,n);return n.exitFrame(),[ki(s)]}case"NextIteration":{const s=R("tensor",t,e,n);return n.nextIteration(),[ki(s)]}case"TensorArrayV3":{const s=R("size",t,e,n),o=R("dtype",t,e,n),r=R("elementShape",t,e,n),i=R("dynamicSize",t,e,n),a=R("clearAfterRead",t,e,n),l=R("identicalElementShapes",t,e,n),u=R("name",t,e,n),d=new wbe(u,o,s,r,l,i,a);return n.addTensorArray(d),[d.idTensor,Be(1)]}case"TensorArrayWriteV3":{const s=R("tensorArrayId",t,e,n),o=R("index",t,e,n),r=R("tensor",t,e,n),i=n.getTensorArray(s.id);return i.write(o,r),[i.idTensor]}case"TensorArrayReadV3":{const s=R("tensorArrayId",t,e,n),o=R("index",t,e,n);return[n.getTensorArray(s.id).read(o)]}case"TensorArrayGatherV3":{const s=R("tensorArrayId",t,e,n),o=R("indices",t,e,n),r=R("dtype",t,e,n);return[n.getTensorArray(s.id).gather(o,r)]}case"TensorArrayScatterV3":{const s=R("tensorArrayId",t,e,n),o=R("indices",t,e,n),r=R("tensor",t,e,n),i=n.getTensorArray(s.id);return i.scatter(o,r),[i.idTensor]}case"TensorArrayConcatV3":{const s=R("tensorArrayId",t,e,n),o=n.getTensorArray(s.id),r=R("dtype",t,e,n);return[o.concat(r)]}case"TensorArraySplitV3":{const s=R("tensorArrayId",t,e,n),o=R("tensor",t,e,n),r=R("lengths",t,e,n),i=n.getTensorArray(s.id);return i.split(r,o),[i.idTensor]}case"TensorArraySizeV3":{const s=R("tensorArrayId",t,e,n),o=n.getTensorArray(s.id);return[Be(o.size(),"int32")]}case"TensorArrayCloseV3":{const s=R("tensorArrayId",t,e,n),o=n.getTensorArray(s.id);return o.clearAndClose(),[o.idTensor]}case"TensorListSetItem":{const s=R("tensorListId",t,e,n),o=R("index",t,e,n),r=R("tensor",t,e,n),i=n.getTensorList(s.id);return i.setItem(o,r),[i.idTensor]}case"TensorListGetItem":{const s=R("tensorListId",t,e,n),o=R("index",t,e,n),r=R("elementShape",t,e,n),i=R("elementDType",t,e,n);return[n.getTensorList(s.id).getItem(o,r,i)]}case"TensorListScatterV2":case"TensorListScatter":{const s=R("indices",t,e,n),o=R("tensor",t,e,n),r=R("elementShape",t,e,n),i=R("numElements",t,e,n),a=Sbe(o,s,r,i);return n.addTensorList(a),[a.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const s=R("elementShape",t,e,n),o=R("elementDType",t,e,n);let r;t.op==="TensorListReserve"?r="numElements":r="maxNumElements";const i=R(r,t,e,n),a=t.op==="TensorListReserve"?-1:i,l=Tbe(s,o,i,a);return n.addTensorList(l),[l.idTensor]}case"TensorListGather":{const s=R("tensorListId",t,e,n),o=R("indices",t,e,n),r=R("elementShape",t,e,n),i=R("elementDType",t,e,n);return[n.getTensorList(s.id).gather(o,i,r)]}case"TensorListStack":{const s=R("tensorListId",t,e,n),o=R("elementShape",t,e,n),r=R("elementDType",t,e,n),i=R("numElements",t,e,n);return[n.getTensorList(s.id).stack(o,r,i)]}case"TensorListFromTensor":{const s=R("tensor",t,e,n),o=R("elementShape",t,e,n),r=R("elementDType",t,e,n),i=Cbe(s,o,r);return n.addTensorList(i),[i.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const s=R("tensorListId",t,e,n),o=n.getTensorList(s.id),r=R("dtype",t,e,n),i=R("elementShape",t,e,n);return[o.concat(r,i)]}case"TensorListPushBack":{const s=R("tensorListId",t,e,n),o=R("tensor",t,e,n),r=n.getTensorList(s.id);return r.pushBack(o),[r.idTensor]}case"TensorListPopBack":{const s=R("tensorListId",t,e,n),o=R("elementShape",t,e,n),r=R("elementDType",t,e,n);return[n.getTensorList(s.id).popBack(o,r)]}case"TensorListSplit":{const s=R("tensor",t,e,n),o=R("elementShape",t,e,n),r=R("lengths",t,e,n),i=Nbe(s,r,o);return n.addTensorList(i),[i.idTensor]}case"TensorListLength":{const s=R("tensorListId",t,e,n),o=n.getTensorList(s.id);return[Be(o.size(),"int32")]}case"TensorListResize":{const s=R("tensorListId",t,e,n),o=R("size",t,e,n),i=n.getTensorList(s.id).resize(o);return n.addTensorList(i),[i.idTensor]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KO(t,e,n){const[s,o]=R("fusedOps",t,e,n),r=s==="biasadd",i=!r,a=o==="prelu",l=s==="fusedbatchnorm",u=R("numArgs",t,e,n);if(r){if(a&&u!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&r&&u!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(l)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const d=R("strides",t,e,n),h=I0(t,e,n),p=R("dataFormat",t,e,n).toUpperCase(),x=R("dilations",t,e,n);let[b,w]=R("args",t,e,n);i&&(w=b,b=void 0);const C=R("leakyreluAlpha",t,e,n);return{stride:d,pad:h,dataFormat:p,dilations:x,biasArg:b,preluArg:w,activationFunc:o,leakyreluAlpha:C}}const Ibe=(t,e,n,s=ps)=>{switch(t.op){case"Conv1D":{const o=R("stride",t,e,n),r=R("pad",t,e,n),i=R("dataFormat",t,e,n).toUpperCase(),a=R("dilation",t,e,n);return[s.conv1d(R("x",t,e,n),R("filter",t,e,n),o,r,i,a)]}case"Conv2D":{const o=R("strides",t,e,n),r=I0(t,e,n),i=R("dataFormat",t,e,n).toUpperCase(),a=R("dilations",t,e,n);return[s.conv2d(R("x",t,e,n),R("filter",t,e,n),[o[1],o[2]],r,i,[a[1],a[2]])]}case"_FusedConv2D":{const{stride:o,pad:r,dataFormat:i,dilations:a,biasArg:l,preluArg:u,activationFunc:d,leakyreluAlpha:h}=KO(t,e,n);return[s.fused.conv2d({x:R("x",t,e,n),filter:R("filter",t,e,n),strides:[o[1],o[2]],pad:r,dataFormat:i,dilations:[a[1],a[2]],bias:l,activation:d,preluActivationWeights:u,leakyreluAlpha:h})]}case"FusedDepthwiseConv2dNative":{const{stride:o,pad:r,dataFormat:i,dilations:a,biasArg:l,preluArg:u,activationFunc:d,leakyreluAlpha:h}=KO(t,e,n);return[s.fused.depthwiseConv2d({x:R("x",t,e,n),filter:R("filter",t,e,n),strides:[o[1],o[2]],pad:r,dataFormat:i,dilations:[a[1],a[2]],bias:l,activation:d,preluActivationWeights:u,leakyreluAlpha:h})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const o=R("outputShape",t,e,n),r=R("strides",t,e,n),i=I0(t,e,n);return[s.conv2dTranspose(R("x",t,e,n),R("filter",t,e,n),o,[r[1],r[2]],i)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const o=R("strides",t,e,n),r=I0(t,e,n),i=R("dilations",t,e,n),a=R("dataFormat",t,e,n).toUpperCase();return[s.depthwiseConv2d(R("input",t,e,n),R("filter",t,e,n),[o[1],o[2]],r,a,[i[1],i[2]])]}case"Conv3D":{const o=R("strides",t,e,n),r=R("pad",t,e,n),i=R("dataFormat",t,e,n).toUpperCase(),a=R("dilations",t,e,n);return[s.conv3d(R("x",t,e,n),R("filter",t,e,n),[o[1],o[2],o[3]],r,i,[a[1],a[2],a[3]])]}case"AvgPool":{const o=R("strides",t,e,n),r=R("pad",t,e,n),i=R("kernelSize",t,e,n);return[s.avgPool(R("x",t,e,n),[i[1],i[2]],[o[1],o[2]],r)]}case"MaxPool":{const o=R("strides",t,e,n),r=R("pad",t,e,n),i=R("kernelSize",t,e,n);return[s.maxPool(R("x",t,e,n),[i[1],i[2]],[o[1],o[2]],r)]}case"MaxPoolWithArgmax":{const o=R("strides",t,e,n),r=R("pad",t,e,n),i=R("kernelSize",t,e,n),a=R("includeBatchInIndex",t,e,n),{result:l,indexes:u}=s.maxPoolWithArgmax(R("x",t,e,n),[i[1],i[2]],[o[1],o[2]],r,a);return[l,u]}case"AvgPool3D":{const o=R("strides",t,e,n),r=R("pad",t,e,n),i=R("kernelSize",t,e,n);return[s.avgPool3d(R("x",t,e,n),[i[1],i[2],i[3]],[o[1],o[2],o[3]],r)]}case"MaxPool3D":{const o=R("strides",t,e,n),r=R("pad",t,e,n),i=R("kernelSize",t,e,n);return[s.maxPool3d(R("x",t,e,n),[i[1],i[2],i[3]],[o[1],o[2],o[3]],r)]}case"Dilation2D":{const o=R("strides",t,e,n),r=R("pad",t,e,n),i=R("dilations",t,e,n),a=o[1],l=o[2],u=i[1],d=i[2];return[s.dilation2d(R("x",t,e,n),R("filter",t,e,n),[a,l],r,[u,d],"NHWC")]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kbe=(t,e,n,s=ps)=>{switch(t.op){case"Fill":{const o=R("shape",t,e,n),r=R("dtype",t,e,n),i=R("value",t,e,n);return[s.fill(o,i,r)]}case"LinSpace":{const o=R("start",t,e,n),r=R("stop",t,e,n),i=R("num",t,e,n);return[s.linspace(o,r,i)]}case"Multinomial":{const o=R("logits",t,e,n),r=R("numSamples",t,e,n),i=R("seed",t,e,n);return[s.multinomial(o,r,i)]}case"OneHot":{const o=R("indices",t,e,n),r=R("depth",t,e,n),i=R("onValue",t,e,n),a=R("offValue",t,e,n),l=R("dtype",t,e,n);return[s.oneHot(o,r,i,a,l)]}case"Ones":return[s.ones(R("shape",t,e,n),R("dtype",t,e,n))];case"OnesLike":return[s.onesLike(R("x",t,e,n))];case"RandomStandardNormal":return[s.randomStandardNormal(R("shape",t,e,n),R("dtype",t,e,n),R("seed",t,e,n))];case"RandomUniform":return[s.randomUniform(R("shape",t,e,n),R("minval",t,e,n),R("maxval",t,e,n),R("dtype",t,e,n))];case"RandomUniformInt":return[s.randomUniformInt(R("shape",t,e,n),R("minval",t,e,n),R("maxval",t,e,n),R("seed",t,e,n))];case"Range":{const o=R("start",t,e,n),r=R("stop",t,e,n),i=R("step",t,e,n);return[s.range(o,r,i,R("dtype",t,e,n))]}case"TruncatedNormal":{const o=R("shape",t,e,n),r=R("mean",t,e,n),i=R("stdDev",t,e,n),a=R("seed",t,e,n);return[s.truncatedNormal(o,r,i,R("dtype",t,e,n),a)]}case"Zeros":return[s.zeros(R("shape",t,e,n),R("dtype",t,e,n))];case"ZerosLike":return[s.zerosLike(R("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iT(t,e,n){const s=R("boxes",t,e,n),o=R("scores",t,e,n),r=R("maxOutputSize",t,e,n),i=R("iouThreshold",t,e,n),a=R("scoreThreshold",t,e,n),l=R("softNmsSigma",t,e,n);return{boxes:s,scores:o,maxOutputSize:r,iouThreshold:i,scoreThreshold:a,softNmsSigma:l}}const Abe=async(t,e,n,s,o=ps)=>{switch(t.op){case"NonMaxSuppressionV5":{const{boxes:r,scores:i,maxOutputSize:a,iouThreshold:l,scoreThreshold:u,softNmsSigma:d}=iT(t,e,n),h=await o.image.nonMaxSuppressionWithScoreAsync(r,i,a,l,u,d);return[h.selectedIndices,h.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:r,scores:i,maxOutputSize:a,iouThreshold:l,scoreThreshold:u}=iT(t,e,n),d=R("padToMaxOutputSize",t,e,n),h=await o.image.nonMaxSuppressionPaddedAsync(r,i,a,l,u,d);return[h.selectedIndices,h.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:r,scores:i,maxOutputSize:a,iouThreshold:l,scoreThreshold:u}=iT(t,e,n);return[await o.image.nonMaxSuppressionAsync(r,i,a,l,u)]}case"Where":{const r=o.cast(R("condition",t,e,n),"bool"),i=[await o.whereAsync(r)];return r.dispose(),i}case"ListDiff":return o.setdiff1dAsync(R("x",t,e,n),R("y",t,e,n));default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rbe=(t,e,n,s=ps)=>{switch(t.op){case"LowerBound":{const o=R("sortedSequence",t,e,n),r=R("values",t,e,n);return[s.lowerBound(o,r)]}case"TopKV2":{const o=R("x",t,e,n),r=R("k",t,e,n),i=R("sorted",t,e,n),a=s.topk(o,r,i);return[a.values,a.indices]}case"UpperBound":{const o=R("sortedSequence",t,e,n),r=R("values",t,e,n);return[s.upperBound(o,r)]}case"Unique":{const o=R("x",t,e,n),r=s.unique(o);return[r.values,r.indices]}case"UniqueV2":{const o=R("x",t,e,n),r=R("axis",t,e,n),i=s.unique(o,r);return[i.values,i.indices]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $be=(t,e,n,s=ps)=>{switch(t.op){case"Const":return e[t.name];case"PlaceholderWithDefault":const o=R("default",t,e,n);return[is(t.name,e,n)||o];case"Placeholder":return[is(t.name,e,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{const d=R("x",t,e,n);return[ki(d)]}case"IdentityN":return R("x",t,e,n).map(d=>ki(d));case"Snapshot":const r=R("x",t,e,n);return[ki(r)];case"Shape":return[s.tensor1d(R("x",t,e,n).shape,"int32")];case"ShapeN":return R("x",t,e,n).map(d=>s.tensor1d(d.shape));case"Size":return[s.scalar(R("x",t,e,n).size,"int32")];case"Rank":return[s.scalar(R("x",t,e,n).rank,"int32")];case"NoOp":return[s.scalar(1)];case"Print":const i=R("x",t,e,n),a=R("data",t,e,n),l=R("message",t,e,n),u=R("summarize",t,e,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(l);for(let d=0;d<a.length;d++)console.log(Array.prototype.slice.call(a[d].dataSync()).slice(0,u));return[i];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dbe{get id(){return this.handle.id}constructor(e,n){this.keyDType=e,this.valueDType=n,this.handle=Be(0),this.tensorMap=new Map,Fn(this.handle)}clearAndClose(){this.tensorMap.forEach(e=>e.dispose()),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return Be(this.size(),"int32")}async import(e,n){this.checkKeyAndValueTensor(e,n);const s=await e.data();return this.tensorMap.forEach(o=>o.dispose()),this.tensorMap.clear(),le(()=>{const o=Mo(n),r=s.length,i=o.length;L(r===i,()=>`The number of elements doesn't match, keys has ${r} elements, the values has ${i} elements.`);for(let a=0;a<r;a++){const l=s[a],u=o[a];Fn(u),this.tensorMap.set(l,u)}return this.handle})}async find(e,n){this.checkKeyAndValueTensor(e,n);const s=await e.data();return le(()=>{const o=[];for(let r=0;r<s.length;r++){const i=s[r],a=this.findWithDefault(i,n);o.push(a)}return Ms(o)})}findWithDefault(e,n){const s=this.tensorMap.get(e);return s??n}checkKeyAndValueTensor(e,n){if(e.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${e.dtype}`);if(n.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${n.dtype}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _be=async(t,e,n,s)=>{switch(t.op){case"HashTable":case"HashTableV2":{const o=s.getHashTableHandleByName(t.name);if(o!=null)return[o];{const r=R("keyDType",t,e,n),i=R("valueDType",t,e,n),a=new Dbe(r,i);return s.addHashTable(t.name,a),[a.handle]}}case"InitializeTable":case"InitializeTableV2":case"LookupTableImport":case"LookupTableImportV2":{const o=R("tableHandle",t,e,n,s),r=R("keys",t,e,n),i=R("values",t,e,n);return[await s.getHashTableById(o.id).import(r,i)]}case"LookupTableFind":case"LookupTableFindV2":{const o=R("tableHandle",t,e,n,s),r=R("keys",t,e,n),i=R("defaultValue",t,e,n);return[await s.getHashTableById(o.id).find(r,i)]}case"LookupTableSize":case"LookupTableSizeV2":{const o=R("tableHandle",t,e,n,s);return[s.getHashTableById(o.id).tensorSize()]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mbe=(t,e,n,s=ps)=>{switch(t.op){case"ResizeBilinear":{const o=R("images",t,e,n),r=R("size",t,e,n),i=R("alignCorners",t,e,n),a=R("halfPixelCenters",t,e,n);return[s.image.resizeBilinear(o,[r[0],r[1]],i,a)]}case"ResizeNearestNeighbor":{const o=R("images",t,e,n),r=R("size",t,e,n),i=R("alignCorners",t,e,n),a=R("halfPixelCenters",t,e,n);return[s.image.resizeNearestNeighbor(o,[r[0],r[1]],i,a)]}case"CropAndResize":{const o=R("image",t,e,n),r=R("boxes",t,e,n),i=R("boxInd",t,e,n),a=R("cropSize",t,e,n),l=R("method",t,e,n),u=R("extrapolationValue",t,e,n);return[s.image.cropAndResize(o,r,i,a,l,u)]}case"ImageProjectiveTransformV3":{const o=R("images",t,e,n),r=R("transforms",t,e,n),i=R("outputShape",t,e,n),a=R("fillValue",t,e,n),l=R("interpolation",t,e,n),u=R("fillMode",t,e,n);return[s.image.transform(o,r,l.toLowerCase(),u.toLowerCase(),a,i)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fbe=(t,e,n,s=ps)=>{switch(t.op){case"Equal":return[s.equal(R("a",t,e,n),R("b",t,e,n))];case"NotEqual":return[s.notEqual(R("a",t,e,n),R("b",t,e,n))];case"Greater":return[s.greater(R("a",t,e,n),R("b",t,e,n))];case"GreaterEqual":return[s.greaterEqual(R("a",t,e,n),R("b",t,e,n))];case"Less":return[s.less(R("a",t,e,n),R("b",t,e,n))];case"LessEqual":return[s.lessEqual(R("a",t,e,n),R("b",t,e,n))];case"LogicalAnd":return[s.logicalAnd(R("a",t,e,n),R("b",t,e,n))];case"LogicalNot":return[s.logicalNot(R("a",t,e,n))];case"LogicalOr":return[s.logicalOr(R("a",t,e,n),R("b",t,e,n))];case"Select":case"SelectV2":return[s.where(R("condition",t,e,n),R("a",t,e,n),R("b",t,e,n))];case"BitwiseAnd":return[s.bitwiseAnd(R("a",t,e,n),R("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Obe=(t,e,n,s=ps)=>{switch(t.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[s.matMul(R("a",t,e,n),R("b",t,e,n),R("transposeA",t,e,n),R("transposeB",t,e,n))];case"Einsum":return[s.einsum(R("equation",t,e,n),...R("tensors",t,e,n))];case"Transpose":return[s.transpose(R("x",t,e,n),R("perm",t,e,n))];case"_FusedMatMul":const[o,r]=R("fusedOps",t,e,n),i=o==="biasadd",a=r==="prelu",l=R("numArgs",t,e,n),u=R("leakyreluAlpha",t,e,n);if(i){if(a&&l!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&l!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[d,h]=R("args",t,e,n);return[s.fused.matMul({a:R("a",t,e,n),b:R("b",t,e,n),transposeA:R("transposeA",t,e,n),transposeB:R("transposeB",t,e,n),bias:d,activation:r,preluActivationWeights:h,leakyreluAlpha:u})];case"MatrixBandPart":return[s.linalg.bandPart(R("a",t,e,n),R("numLower",t,e,n),R("numUpper",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pbe=(t,e,n,s=ps)=>{switch(t.op){case"EuclideanNorm":return[s.euclideanNorm(R("x",t,e,n),R("axis",t,e,n),R("keepDims",t,e,n))];case"FusedBatchNorm":case"FusedBatchNormV2":return[s.batchNorm(R("x",t,e,n),R("mean",t,e,n),R("variance",t,e,n),R("offset",t,e,n),R("scale",t,e,n),R("epsilon",t,e,n))];case"FusedBatchNormV3":return[s.batchNorm(R("x",t,e,n),R("mean",t,e,n),R("variance",t,e,n),R("offset",t,e,n),R("scale",t,e,n),R("epsilon",t,e,n))];case"LRN":return[s.localResponseNormalization(R("x",t,e,n),R("radius",t,e,n),R("bias",t,e,n),R("alpha",t,e,n),R("beta",t,e,n))];case"Softmax":return[s.softmax(R("x",t,e,n))];case"LogSoftmax":return[s.logSoftmax(R("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lbe=(t,e,n,s=ps)=>{switch(t.op){case"RaggedGather":{const{outputNestedSplits:o,outputDenseValues:r}=s.raggedGather(R("paramsNestedSplits",t,e,n),R("paramsDenseValues",t,e,n),R("indices",t,e,n),R("outputRaggedRank",t,e,n));return o.concat(r)}case"RaggedRange":{const{rtNestedSplits:o,rtDenseValues:r}=s.raggedRange(R("starts",t,e,n),R("limits",t,e,n),R("splits",t,e,n));return[o,r]}case"RaggedTensorToTensor":return[s.raggedTensorToTensor(R("shape",t,e,n),R("values",t,e,n),R("defaultValue",t,e,n),R("rowPartitionTensors",t,e,n),R("rowPartitionTypes",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vbe=(t,e,n,s=ps)=>{switch(t.op){case"Max":{const a=R("axis",t,e,n),l=R("keepDims",t,e,n);return[s.max(R("x",t,e,n),a,l)]}case"Mean":{const a=R("axis",t,e,n),l=R("keepDims",t,e,n);return[s.mean(R("x",t,e,n),a,l)]}case"Min":{const a=R("axis",t,e,n),l=R("keepDims",t,e,n);return[s.min(R("x",t,e,n),a,l)]}case"Sum":{const a=R("axis",t,e,n),l=R("keepDims",t,e,n);return[s.sum(R("x",t,e,n),a,l)]}case"All":{const a=R("axis",t,e,n),l=R("keepDims",t,e,n);return[s.all(R("x",t,e,n),a,l)]}case"Any":{const a=R("axis",t,e,n),l=R("keepDims",t,e,n);return[s.any(R("x",t,e,n),a,l)]}case"ArgMax":{const a=R("axis",t,e,n);return[s.argMax(R("x",t,e,n),a)]}case"ArgMin":{const a=R("axis",t,e,n);return[s.argMin(R("x",t,e,n),a)]}case"Prod":{const a=R("axis",t,e,n),l=R("keepDims",t,e,n);return[s.prod(R("x",t,e,n),a,l)]}case"Cumprod":{const a=R("axis",t,e,n),l=R("exclusive",t,e,n),u=R("reverse",t,e,n);return[s.cumprod(R("x",t,e,n),a,l,u)]}case"Cumsum":{const a=R("axis",t,e,n),l=R("exclusive",t,e,n),u=R("reverse",t,e,n);return[s.cumsum(R("x",t,e,n),a,l,u)]}case"Bincount":const o=R("x",t,e,n),r=R("weights",t,e,n),i=R("size",t,e,n);return[s.bincount(o,r,i)];case"DenseBincount":{const a=R("x",t,e,n),l=R("weights",t,e,n),u=R("size",t,e,n),d=R("binaryOutput",t,e,n);return[s.denseBincount(a,l,u,d)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zbe=(t,e,n,s=ps)=>{switch(t.op){case"ConcatV2":case"Concat":{const o=R("n",t,e,n),r=R("axis",t,e,n);let i=R("tensors",t,e,n);return i=i.slice(0,o),[s.concat(i,r)]}case"Gather":{const o=R("x",t,e,n),r=R("indices",t,e,n);return[s.gather(o,s.cast(r,"int32"),0)]}case"GatherV2":{const o=R("axis",t,e,n),r=R("batchDims",t,e,n),i=R("x",t,e,n),a=R("indices",t,e,n);return[s.gather(i,s.cast(a,"int32"),o,r)]}case"Reverse":{const o=R("dims",t,e,n),r=[];for(let a=0;a<o.length;a++)o[a]&&r.push(a);const i=R("x",t,e,n);return[s.reverse(i,r)]}case"ReverseV2":{const o=R("axis",t,e,n),r=R("x",t,e,n);return[s.reverse(r,o)]}case"Slice":{const o=R("begin",t,e,n),r=R("size",t,e,n);return[s.slice(R("x",t,e,n),o,r)]}case"StridedSlice":{const o=R("begin",t,e,n),r=R("end",t,e,n),i=R("strides",t,e,n),a=R("beginMask",t,e,n),l=R("endMask",t,e,n),u=R("ellipsisMask",t,e,n),d=R("newAxisMask",t,e,n),h=R("shrinkAxisMask",t,e,n),p=R("x",t,e,n);return[s.stridedSlice(p,o,r,i,a,l,u,d,h)]}case"Pack":return le(()=>{const o=R("axis",t,e,n),r=R("tensors",t,e,n),i=r[0].shape,a=s.squeeze(r[0]).shape,l=r.map(u=>{const d=lt(u.shape,i);if(!d&&!lt(s.squeeze(u).shape,a))throw new Error("the input tensors shape does not match");return d?u:s.reshape(u,i)});return[s.stack(l,o)]});case"Unpack":{const o=R("axis",t,e,n),r=R("tensor",t,e,n);return s.unstack(r,o)}case"Tile":{const o=R("reps",t,e,n);return[s.tile(R("x",t,e,n),o)]}case"Split":case"SplitV":{const o=R("axis",t,e,n),r=R("numOrSizeSplits",t,e,n),i=R("x",t,e,n);return s.split(i,r,o)}case"ScatterNd":{const o=R("indices",t,e,n),r=R("values",t,e,n),i=R("shape",t,e,n);return[s.scatterND(o,r,i)]}case"GatherNd":{const o=R("x",t,e,n),r=R("indices",t,e,n);return[s.gatherND(o,r)]}case"SparseToDense":{const o=R("sparseIndices",t,e,n),r=R("outputShape",t,e,n),i=R("sparseValues",t,e,n),a=R("defaultValue",t,e,n);return[s.sparseToDense(o,i,r,i.dtype===a.dtype?a:s.cast(a,i.dtype))]}case"TensorScatterUpdate":{const o=R("indices",t,e,n),r=R("values",t,e,n),i=R("tensor",t,e,n);return[s.tensorScatterUpdate(i,o,r)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bbe=(t,e,n,s=ps)=>{switch(t.op){case"SparseFillEmptyRows":{const{outputIndices:o,outputValues:r,emptyRowIndicator:i,reverseIndexMap:a}=s.sparse.sparseFillEmptyRows(R("indices",t,e,n),R("values",t,e,n),R("denseShape",t,e,n),R("defaultValue",t,e,n));return[o,r,i,a]}case"SparseReshape":{const{outputIndices:o,outputShape:r}=s.sparse.sparseReshape(R("inputIndices",t,e,n),R("inputShape",t,e,n),R("newShape",t,e,n));return[o,r]}case"SparseSegmentMean":return[s.sparse.sparseSegmentMean(R("data",t,e,n),R("indices",t,e,n),R("segmentIds",t,e,n))];case"SparseSegmentSum":return[s.sparse.sparseSegmentSum(R("data",t,e,n),R("indices",t,e,n),R("segmentIds",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ube=(t,e,n,s=ps)=>{switch(t.op){case"FFT":return[s.fft(R("x",t,e,n))];case"IFFT":return[s.ifft(R("x",t,e,n))];case"RFFT":return[s.rfft(R("x",t,e,n))];case"IRFFT":return[s.irfft(R("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gbe=(t,e,n,s=ps)=>{switch(t.op){case"StaticRegexReplace":return[s.string.staticRegexReplace(R("input",t,e,n),R("pattern",t,e,n),R("rewrite",t,e,n),R("replaceGlobal",t,e,n))];case"StringNGrams":{const{nGrams:o,nGramsSplits:r}=s.string.stringNGrams(R("data",t,e,n),R("dataSplits",t,e,n),R("separator",t,e,n),R("nGramWidths",t,e,n),R("leftPad",t,e,n),R("rightPad",t,e,n),R("padWidth",t,e,n),R("preserveShortSequences",t,e,n));return[o,r]}case"StringSplit":{const{indices:o,values:r,shape:i}=s.string.stringSplit(R("input",t,e,n),R("delimiter",t,e,n),R("skipEmpty",t,e,n));return[o,r,i]}case"StringToHashBucketFast":return[s.string.stringToHashBucketFast(R("input",t,e,n),R("numBuckets",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hbe=(t,e,n,s=ps)=>{switch(t.op){case"Cast":return[s.cast(R("x",t,e,n),R("dtype",t,e,n))];case"ExpandDims":{const o=R("axis",t,e,n);return[s.expandDims(R("x",t,e,n),o)]}case"Squeeze":{const o=R("axis",t,e,n);return[s.squeeze(R("x",t,e,n),o)]}case"Reshape":return[s.reshape(R("x",t,e,n),R("shape",t,e,n))];case"EnsureShape":return[s.ensureShape(R("x",t,e,n),R("shape",t,e,n))];case"MirrorPad":return[s.mirrorPad(R("x",t,e,n),R("padding",t,e,n),R("mode",t,e,n))];case"PadV2":case"Pad":return[s.pad(R("x",t,e,n),R("padding",t,e,n),R("constantValue",t,e,n))];case"SpaceToBatchND":{const o=R("blockShape",t,e,n),r=R("paddings",t,e,n);return[s.spaceToBatchND(R("x",t,e,n),o,r)]}case"BatchToSpaceND":{const o=R("blockShape",t,e,n),r=R("crops",t,e,n);return[s.batchToSpaceND(R("x",t,e,n),o,r)]}case"DepthToSpace":{const o=R("blockSize",t,e,n),r=R("dataFormat",t,e,n).toUpperCase();return[s.depthToSpace(R("x",t,e,n),o,r)]}case"BroadcastTo":return[s.broadcastTo(R("x",t,e,n),R("shape",t,e,n))];case"BroadcastArgs":return[s.broadcastArgs(R("s0",t,e,n),R("s1",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XO(t,e,n,s,o=le){const r=((i,a,l)=>{switch(i.category){case"arithmetic":return o(()=>vbe(i,a,l));case"basic_math":return o(()=>bbe(i,a,l));case"control":return Ebe(i,a,l);case"convolution":return o(()=>Ibe(i,a,l));case"creation":return o(()=>kbe(i,a,l));case"dynamic":return Abe(i,a,l);case"evaluation":return o(()=>Rbe(i,a,l));case"image":return o(()=>Mbe(i,a,l));case"graph":return o(()=>$be(i,a,l));case"logical":return o(()=>Fbe(i,a,l));case"matrices":return o(()=>Obe(i,a,l));case"normalization":return o(()=>Pbe(i,a,l));case"ragged":return o(()=>Lbe(i,a,l));case"reduction":return o(()=>Vbe(i,a,l));case"slice_join":return o(()=>zbe(i,a,l));case"sparse":return o(()=>Bbe(i,a,l));case"spectral":return o(()=>Ube(i,a,l));case"string":return o(()=>Gbe(i,a,l));case"transformation":return o(()=>Hbe(i,a,l));case"hash_table":return _be(i,a,l,s);case"custom":const u=T4(i.op);if(u&&u.customExecutor)return u.customExecutor(new xbe(i,a,l));throw TypeError(`Custom op ${i.op} is not registered.`);default:throw TypeError(`Unknown op '${i.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(t,e,n);return Fi(r)?r.then(i=>[].concat(i)):[].concat(r)}class YO{constructor(e={},n={},s={},o={},r){this.weightMap=e,this.tensorArrayMap=n,this.tensorListMap=s,this.functionMap=o,this.parseNodeNameCache=r,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(e,n){return{id:e,frameName:n,iterationId:0}}set currentContext(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const e=[];for(let n=0;n<this.contexts.length-1;n++){const s=this.contexts.slice(0,this.contexts.length-n);e.push(this.contextIdforContexts(s))}e.push(""),this._currentContextIds=e}contextIdforContexts(e){return e?e.map(n=>n.id===0&&n.iterationId===0?"":`${n.frameName}-${n.iterationId}`).join("/"):""}enterFrame(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")}nextIteration(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;const e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")}getWeight(e){return this.weightMap[e]}addTensorArray(e){this.tensorArrayMap[e.id]=e}getTensorArray(e){return this.tensorArrayMap[e]}addTensorList(e){this.tensorListMap[e.id]=e}getTensorList(e){return this.tensorListMap[e]}dispose(e){for(const n in this.tensorArrayMap)this.tensorArrayMap[n].clearAndClose(e);for(const n in this.tensorListMap)this.tensorListMap[n].clearAndClose(e)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JO(t,e,n,s){const o=new Set,r=[];let i=null,a=null;const l=new Set,u=new Set(Object.keys(t).map(p=>io(p)[0]));s=s||[];const d=new Set(s.map(p=>io(p.name)[0])),h=[...e];for(;h.length>0;){const p=h.pop();if((Pl(p)||Zbe(p)||Qbe(p))&&i==null&&(i=p,a=i.children.map(x=>x.name).filter(x=>o.has(x))),o.add(p.name),n[p.name]==null&&!u.has(p.name)&&!d.has(p.name)){if(p.inputs.length===0){r.push(p.name);continue}p.inputs.forEach(x=>{l.has(x.name)||(l.add(x.name),h.push(x))})}}return{inputs:t,outputs:e,usedNodes:o,missingInputs:r,dynamicNode:i,syncInputs:a}}function Wbe(t,e){const{usedNodes:n,inputs:s}=e,o=Object.keys(s).map(C=>io(C)[0]).map(C=>t.nodes[C]),r=t.initNodes||[],i=C=>n.has(typeof C=="string"?C:C.name);function a(C){return[...new Map(C.map(T=>[T.name,T])).values()]}const l=a([...o,...t.weights,...r]).filter(i),u=a([...l,...Object.values(t.nodes)]).filter(i),d=new Map(u.map(C=>[C.name,C])),h={};for(const C of u){h[C.name]=h[C.name]||0;for(const T of C.children)i(T)||(h[T.name]=Number.POSITIVE_INFINITY),h[T.name]=(h[T.name]||0)+1}const p=Object.entries(h).filter(([,C])=>C===0).map(([C])=>C),x=[...p];for(;p.length>0;){const C=p.pop(),T=d.get(C);for(const N of T.children.filter(i))--h[N.name]===0&&(x.push(N.name),p.push(N.name))}const b=x.map(C=>d.get(C)),w=qbe(b,l);return Kbe(w,l),w}function qbe(t,e){const n=new Map(t.map(i=>[i.name,i])),s=e.map(i=>i.name),o=new Set(s);for(;s.length>0;){const i=s.pop(),a=n.get(i);for(const l of a.children)!n.has(l.name)||o.has(l.name)||(o.add(l.name),s.push(l.name))}return t.filter(i=>o.has(i.name))}class n0 extends Error{constructor(e){super(`NodesExecutionOrderError: ${e}`)}}function Kbe(t,e){const n=new Map(t.map((a,l)=>[a.name,l])),s=new Set(e.map(a=>a.name)),o=a=>s.has(typeof a=="string"?a:a.name),r=new Set(t.map(a=>a.name)),i=a=>r.has(typeof a=="string"?a:a.name);for(const a of t){for(const l of a.children.filter(i)){if(!n.has(l.name))throw new n0(`Child ${l.name} of node ${a.name} is unreachable.`);if(n.get(a.name)>n.get(l.name))throw new n0(`Node ${a.name} is scheduled to run after its child ${l.name}.`)}if(!o(a))for(const l of a.inputs){if(!n.has(l.name))throw new n0(`Input ${l.name} of node ${a.name} is unreachable.`);if(n.get(l.name)>n.get(a.name))throw new n0(`Node ${a.name} is scheduled to run before its input ${l.name}.`)}}}function Xbe(t){const e=new Map(t.map((a,l)=>[a.name,l])),n=Number.MAX_SAFE_INTEGER,s=t.map((a,l)=>Pl(a)?n:l),o=a=>{const l=s[e.get(a.name)];return l??-1},r=t.map((a,l)=>a.children.map(o).reduce((u,d)=>Math.max(u,d),s[l])),i=new Map;for(let a=0;a<t.length;++a){const l=r[a];if(l===n)continue;const u=t[a],d=t[l];i.has(d.name)||i.set(d.name,[]),i.get(d.name).push(u)}return i}const Ybe=new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),Jbe=new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),jbe=new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function Pl(t){return Ybe.has(t.op)}function Zbe(t){return Jbe.has(t.op)}function Qbe(t){return jbe.has(t.op)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cx{get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(e){const n=Object.keys(e).map(s=>e[s].map(o=>o.id));this._weightIds=[].concat(...n),this._weightMap=e}set resourceManager(e){this._resourceManager=e}get inputs(){return this._inputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get outputs(){return this._outputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get inputNodes(){return this._inputs.map(e=>e.signatureKey||e.name)}get outputNodes(){return this._outputs.map(e=>{const n=e.signatureKey||e.name;return e.defaultOutput?`${n}:${e.defaultOutput}`:n})}get functions(){return Object.keys(this._functions).reduce((e,n)=>(e[n]=this._functions[n].signature,e),{})}constructor(e,n){this.graph=e,this.parent=n,this.compiledMap=new Map,this.parseNodeNameCache=new Map,this._weightMap={},this.SEPARATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,e.functions!=null&&Object.keys(e.functions).forEach(s=>{this._functionExecutorMap[s]=new cx(e.functions[s],this)})}getCompilationKey(e,n){const s=e.map(r=>r.name).sort(),o=n.map(r=>r.name).sort();return s.join(this.SEPARATOR)+"--"+o.join(this.SEPARATOR)}compile(e,n){const s=JO(e,n,this.weightMap,this._initNodes),{missingInputs:o,dynamicNode:r,syncInputs:i}=s;if(r!=null)throw new Error(`This execution contains the node '${r.name}', which has the dynamic op '${r.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${i}]`);if(o.length>0){const u=n.map(h=>h.name),d=Object.keys(e);throw new Error(`Cannot compute the outputs [${u}] from the provided inputs [${d}]. Missing the following inputs: [${o}]`)}const a=Wbe(this.graph,s),l=Xbe(a);return{orderedNodes:a,nodeLiveUntilMap:l}}cloneAndKeepTensor(e){if(e==null)return null;const n=e.clone();return Fn(n),n}cloneTensorList(e){return e?e.map(s=>this.cloneAndKeepTensor(s)):null}cloneTensorMap(e){return Object.fromEntries(Object.entries(e).map(([n,s])=>[n,this.cloneTensorList(s)]))}execute(e,n){this.disposeIntermediateTensors(),e=this.mapInputs(e);const s=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),n=this.mapOutputs(n),this.checkOutputs(n);const o=s.map(p=>this.graph.nodes[io(p)[0]]),r=n.map(p=>io(p)[0]),i=new Set(r);let a=r.map(p=>this.graph.nodes[p]);a.length===0&&(a=this._outputs);const l=this.getCompilationKey(o,a);let u=this.compiledMap.get(l);u==null&&(u=this.compile(e,a),this.compiledMap.set(l,u));try{this.keepIntermediateTensors=ue().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(p){this.keepIntermediateTensors=!1,console.warn(p.message)}const d={},h={};return le(()=>{const p=new YO(this.weightMap,d,h,this.functionExecutorMap,this.parseNodeNameCache),x=Object.assign({},this.weightMap);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),Object.keys(e).forEach(T=>{const[N,I]=io(T,p),k=[];k[I]=e[T],x[N]=k,this.keepIntermediateTensors&&(this.clonedTensorsMap[N]=this.cloneTensorList(k))});const b=this.getFrozenTensorIds(x),{orderedNodes:w,nodeLiveUntilMap:C}=u;for(const T of w){if(x[T.name])continue;const N=XO(T,x,p,this._resourceManager);if(Fi(N))throw new Error(`The execution of the op '${T.op}' returned a promise. Please use model.executeAsync() instead.`);x[T.name]=N,this.keepIntermediateTensors&&(this.clonedTensorsMap[T.name]=this.cloneTensorList(N)),this.checkTensorForDisposalWithNodeLiveUntilInfo(T,x,p,b,i,C.get(T.name))}return this.parent==null&&p.dispose(b),n.map(T=>is(T,x,p))})}getFrozenTensorIds(e){const n=[].concat.apply([],Object.keys(e).map(s=>e[s]).map(s=>s.map(o=>o.id)));return new Set(n)}checkTensorForDisposal(e,n,s,o,r,i,a){if(!(Pl(n)||i.has(e))){for(const l of s[e])l!=null&&(a[l.id]=(a[l.id]||0)+n.children.length);for(const l of n.inputs){if(Pl(l))continue;const u=GO(l.name,s,o);if(u!=null)for(const d of u){if(!d||d.kept||r.has(d.id))continue;const h=a[d.id];h===1?(d.dispose(),delete a[d.id]):h!=null&&a[d.id]--}}}}checkTensorForDisposalWithNodeLiveUntilInfo(e,n,s,o,r,i){function a(l){return Pl(l)||r.has(l.name)}if(!(Pl(e)||i==null))for(const l of i){if(a(l))continue;const u=GO(l.name,n,s);for(const d of u)!d||d.kept||o.has(d.id)||d.dispose()}}async executeAsync(e,n){return this._executeAsync(e,n)}disposeIntermediateTensors(){this.clonedTensorsMap&&(Object.values(this.clonedTensorsMap).forEach(e=>{for(const n of e)n&&!n.isDisposed&&n.dispose()}),this.clonedTensorsMap=null)}getIntermediateTensors(){return this.clonedTensorsMap}async _executeAsync(e,n,s=!1,o={},r={}){this.disposeIntermediateTensors(),s||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),n=this.mapOutputs(n),this.checkOutputs(n));try{this.keepIntermediateTensors=ue().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(p){this.keepIntermediateTensors=!1,console.warn(p.message)}const i=new YO(this.weightMap,o,r,this.functionExecutorMap,this.parseNodeNameCache);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap));const a=await this.executeWithControlFlow(e,i,n,s),l=n.map(p=>is(p,a,i)),u=l.map(p=>p.id),d=Object.keys(e).map(p=>e[p].id),h=new Set([...u,...d,...this.weightIds]);return Object.values(a).forEach(p=>{p.forEach(x=>{x&&!x.isDisposed&&!h.has(x.id)&&x.dispose()})}),this.parent==null&&i.dispose(h),l}async executeFunctionAsync(e,n,s){const o=e.reduce((r,i,a)=>(r[this.inputs[a].name]=i,r),{});return this._executeAsync(o,this.outputNodes,!0,n,s)}async executeWithControlFlow(e,n,s,o){const r=Object.keys(e),i=r.map(k=>this.graph.nodes[io(k)[0]]),a=s.map(k=>io(k)[0]),l=new Set(a);let u=a.map(k=>this.graph.nodes[k]);u.length===0&&(u=this._outputs);const{usedNodes:d,missingInputs:h,dynamicNode:p,syncInputs:x}=JO(e,u,this.weightMap,this._initNodes),b=[...i,...this.graph.weights,...this._initNodes||[]].map(k=>({node:k,contexts:n.currentContext})),w=Object.assign({},this.weightMap);Object.keys(e).forEach(k=>{const[A,$]=io(k),M=[];M[$]=e[k],w[A]=M});const C={},T=this.getFrozenTensorIds(w),N={};for(;b.length>0;){const k=this.processStack(i,b,n,w,N,T,l,C,d);await Promise.all(k)}p==null&&!o&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const I=u.filter(k=>!Pl(k)&&!is(k.name,w,n)).map(k=>k.name);if(I.length>0){let k="";throw p!=null&&(k=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${x}]`),new Error(`Cannot compute the outputs [${I}] from the provided inputs [${r}]. Consider providing the following inputs: [${h}]. ${k}`)}return w}processStack(e,n,s,o,r,i,a,l,u){const d=[];for(;n.length>0;){const h=n.pop();s.currentContext=h.contexts;let p="";if(h.node.op==="Enter"&&R("isConstant",h.node,o,s)&&([p]=Ii(h.node.name,s)),o[h.node.name]==null){const x=XO(h.node,o,s,this._resourceManager);p||([p]=Ii(h.node.name,s));const b=s.currentContext;Fi(x)?d.push(x.then(w=>(o[p]=w,this.keepIntermediateTensors&&(this.clonedTensorsMap[p]=this.cloneTensorList(w)),s.currentContext=b,this.checkTensorForDisposal(p,h.node,o,s,i,a,l),this.processChildNodes(h.node,n,s,o,r,u),w))):(o[p]=x,this.keepIntermediateTensors&&(this.clonedTensorsMap[p]=this.cloneTensorList(x)),this.checkTensorForDisposal(p,h.node,o,s,i,a,l),this.processChildNodes(h.node,n,s,o,r,u))}else this.processChildNodes(h.node,n,s,o,r,u)}return d}processChildNodes(e,n,s,o,r,i){e.children.forEach(a=>{const[l]=Ii(a.name,s);r[l]||!i.has(a.name)||(a.op==="Merge"?a.inputNames.some(u=>!!is(u,o,s))&&(r[l]=!0,n.push({contexts:s.currentContext,node:a})):a.inputNames.every(u=>!!is(u,o,s))&&(r[l]=!0,n.push({contexts:s.currentContext,node:a})))})}dispose(){Object.keys(this.weightMap).forEach(e=>this.weightMap[e].forEach(n=>n.dispose()))}checkInputShapeAndType(e){Object.keys(e).forEach(n=>{const s=e[n],[o]=io(n),r=this.graph.nodes[o];if(r.attrParams.shape&&r.attrParams.shape.value){const i=r.attrParams.shape.value,a=i.length===s.shape.length&&s.shape.every((l,u)=>i[u]===-1||i[u]===l);L(a,()=>`The shape of dict['${r.name}'] provided in model.execute(dict) must be [${i}], but was [${s.shape}]`)}r.attrParams.dtype&&r.attrParams.dtype.value&&L(s.dtype===r.attrParams.dtype.value,()=>`The dtype of dict['${r.name}'] provided in model.execute(dict) must be ${r.attrParams.dtype.value}, but was ${s.dtype}`)})}mapInputs(e){var n,s;const o={};for(const r in e){const i=(s=(n=this._signature)===null||n===void 0?void 0:n.inputs)===null||s===void 0?void 0:s[r];i!=null?o[i.name]=e[r]:o[r]=e[r]}return o}checkInputs(e){const n=Object.keys(e).filter(s=>{const[o]=io(s);return this.graph.nodes[o]==null});if(n.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${n}] that are not part of graph`)}mapOutputs(e){return e.map(n=>{var s,o;const r=(o=(s=this._signature)===null||s===void 0?void 0:s.outputs)===null||o===void 0?void 0:o[n];return r!=null?r.name:n},{})}checkOutputs(e){e.forEach(n=>{const[s]=io(n);if(!this.graph.nodes[s])throw new Error(`The output '${n}' is not found in the graph`)})}}class ewe{constructor(e={},n={}){this.hashTableNameToHandle=e,this.hashTableMap=n}addHashTable(e,n){this.hashTableNameToHandle[e]=n.handle,this.hashTableMap[n.id]=n}getHashTableHandleByName(e){return this.hashTableNameToHandle[e]}getHashTableById(e){return this.hashTableMap[e]}dispose(){for(const e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(const e in this.hashTableNameToHandle)this.hashTableNameToHandle[e].dispose(),delete this.hashTableNameToHandle[e]}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const twe="?tfjs-format=file",nwe="model.json";class vA{get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}get modelStructuredOutputKeys(){return this.structuredOutputKeys}constructor(e,n={},s=yI){this.modelUrl=e,this.loadOptions=n,this.version="n/a",this.io=s,n==null&&(this.loadOptions={}),this.resourceManager=new ewe}findIOHandler(){const e=this.modelUrl;if(e.load!=null)this.handler=e;else if(this.loadOptions.requestInit!=null)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{const n=this.io.getLoadHandlers(e,this.loadOptions);if(n.length===0)n.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(n.length>1)throw new Error(`Found more than one (${n.length}) load handlers for URL '${[e]}'`);this.handler=n[0]}}load(){if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const e=this.handler.load();return Fi(e)?e.then(n=>n.getWeightStream==null?this.loadSync(n):this.loadStreaming(n)):this.loadSync(e)}loadSync(e){const n=this.io.decodeWeights(e.weightData,e.weightSpecs);return this.loadWithWeightMap(e,n)}async loadStreaming(e){if(e.getWeightStream==null)throw new Error("Model artifacts missing streamWeights function");const n=await QV(e.getWeightStream(),e.weightSpecs);return this.loadWithWeightMap(e,n)}loadWithWeightMap(e,n){this.artifacts=e;const s=this.artifacts.modelTopology;let o=this.artifacts.signature;if(this.artifacts.userDefinedMetadata!=null){const r=this.artifacts.userDefinedMetadata;r.signature!=null&&(o=r.signature),r.structuredOutputKeys!=null&&(this.structuredOutputKeys=r.structuredOutputKeys)}if(this.signature=o,this.version=`${s.versions.producer}.${s.versions.minConsumer}`,this.executor=new cx(HO.Instance.transformGraph(s,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(n),this.executor.resourceManager=this.resourceManager,e.modelInitializer!=null&&e.modelInitializer.node!=null){const r=HO.Instance.transformGraph(e.modelInitializer);this.initializer=new cx(r),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0}async save(e,n){if(typeof e=="string"){const s=this.io.getSaveHandlers(e);if(s.length===0)throw new Error(`Cannot find any save handlers for URL '${e}'`);if(s.length>1)throw new Error(`Found more than one (${s.length}) save handlers for URL '${e}'`);e=s[0]}if(e.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return e.save(this.artifacts)}addStructuredOutputNames(e){if(this.structuredOutputKeys){const n=e instanceof yt?[e]:e,s={};return n.forEach((o,r)=>s[this.structuredOutputKeys[r]]=o),s}return e}predict(e,n){const s=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(s)}async predictAsync(e,n){const s=await this.executeAsync(e,this.outputNodes);return this.addStructuredOutputNames(s)}normalizeInputs(e){var n;if(!(e instanceof yt)&&!Array.isArray(e)){const r=(n=this.signature)===null||n===void 0?void 0:n.inputs;if(r!=null)for(const i in r){const a=r[i];a.resourceId!=null&&(e[i]=this.resourceIdToCapturedInput[a.resourceId])}return e}e=Array.isArray(e)?e:[e];const s=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+s!==this.inputNodes.length)throw new Error(`Input tensor count mismatch, the graph model has ${this.inputNodes.length-s} non-resource placeholders, while there are ${e.length} input tensors provided.`);let o=0;return this.inputNodes.reduce((r,i)=>{var a,l,u;const d=(u=(l=(a=this.signature)===null||a===void 0?void 0:a.inputs)===null||l===void 0?void 0:l[i])===null||u===void 0?void 0:u.resourceId;return d!=null?r[i]=this.resourceIdToCapturedInput[d]:r[i]=e[o++],r},{})}normalizeOutputs(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}executeInitializerGraph(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))}async executeInitializerGraphAsync(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.executeAsync({},[]):this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs))}setResourceIdToCapturedInput(e){if(this.resourceIdToCapturedInput={},this.initializerSignature){const n=this.initializerSignature.outputs,s=Object.keys(n);for(let o=0;o<s.length;o++){const r=s[o],i=n[r];this.resourceIdToCapturedInput[i.resourceId]=e[o]}}}execute(e,n){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),n=this.normalizeOutputs(n);const s=this.executor.execute(e,n);return s.length>1?s:s[0]}async executeAsync(e,n){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(await this.executeInitializerGraphAsync()),e=this.normalizeInputs(e),n=this.normalizeOutputs(n);const s=await this.executor.executeAsync(e,n);return s.length>1?s:s[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(e){return Object.keys(e).reduce((n,s)=>(n[s]=[e[s]],n),{})}dispose(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&je(this.resourceIdToCapturedInput)),this.resourceManager.dispose()}}async function swe(t,e={},n=yI){if(t==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");e==null&&(e={}),e.fromTFHub&&typeof t=="string"&&(t=rwe(t));const s=new vA(t,e,n);return await s.load(),s}function owe(t){if(t==null)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide model artifacts or an IOHandler that loads the model");let e;if(t instanceof Array){const[s,o]=t;if(!s)throw new Error("modelJSON must be the first element of the array");if(!o||!(o instanceof ArrayBuffer))throw new Error("An ArrayBuffer of weights must be the second element of the array");if(!("modelTopology"in s))throw new Error("Model JSON is missing 'modelTopology'");if(!("weightsManifest"in s))throw new Error("Model JSON is missing 'weightsManifest'");const r=j0(s.weightsManifest),i=nE(s,r,o);e=Q0(i)}else if("load"in t)e=t;else if("modelTopology"in t&&"weightSpecs"in t&&"weightData"in t)e=Q0(t);else throw new Error("Unknown model format");const n=new vA(e);return n.load(),n}function rwe(t){return t.endsWith("/")||(t=t+"/"),`${t}${nwe}${twe}`}/** @license See the LICENSE file. */const E4="4.20.0";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */function iwe(t,e){return dx(t,e)}function dx(t,e,n=new Map,s=new Set){if(t==null)return null;if(typeof Blob=="function"&&t instanceof Blob)return t.slice();if(s.has(t))throw new Error("Circular references are not supported.");if(n.has(t))return n.get(t);const o=e(t);if(o.recurse&&o.value!==null)throw new Error("A deep map function may not return both a value and recurse=true.");if(o.recurse)if(Qc(t)){const r=Array.isArray(t)?[]:{};s.add(t);for(const i in t){const a=t[i],l=dx(a,e,n,s);r[i]=l}return s.delete(t),t.__proto__&&(r.__proto__=t.__proto__),r}else throw new Error(`Can't recurse into non-iterable type: ${t}`);else return n.set(t,o.value),o.value}function awe(t,e=k4){return I4(t,e)}function I4(t,e,n=new Set){const s=t[0];if(n.has(s))throw new Error("Circular references are not supported.");const o=e(t);if(o.recurse&&o.value!==null)throw new Error("A deep zip function may not return both a value and recurse=true.");if(o.recurse)if(Qc(s)){const r=Array.isArray(s)?[]:{};n.add(s);for(const i in s){const a=t.map(u=>u[i]),l=I4(a,e,n);r[i]=l}return n.delete(s),r}else throw new Error(`Can't recurse into non-iterable type: ${s}`);else return o.value}function k4(t){return t===null?null:Qc(t[0])?{value:null,recurse:!0}:{value:t,recurse:!1}}async function A4(t,e){const n=new Map;dx(t,e,n);for(const o of Array.from(n.keys())){const r=n.get(o);if(Fi(r)){const i=await r;n.set(o,i)}}return dx(t,e,n)}function Qc(t){let e=!1;if(ue().get("IS_BROWSER"))e=t instanceof TextDecoder;else{const{StringDecoder:n}=require("string_decoder");e=t instanceof n}return t!=null&&!ArrayBuffer.isView(t)&&(Array.isArray(t)||typeof t=="object"&&!(t instanceof yt)&&!(t instanceof Promise)&&!e)}function lwe(t){return t==null||uwe(t)||Array.isArray(t)||typeof t=="object"&&t instanceof yt||Mn(t)}function uwe(t){return t===null||typeof t!="object"&&typeof t!="function"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */function cwe(t){return iwe(t,dwe)}function dwe(t){return t instanceof yt?{value:t.clone(),recurse:!1}:Qc(t)?{value:null,recurse:!0}:{value:t,recurse:!1}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class R4{constructor(e){if(this.capacity=e,this.begin=0,this.end=0,e==null)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}wrap(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}get(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}set(e,n){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=n}length(){let e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}isFull(){return this.length()===this.capacity}isEmpty(){return this.length()===0}push(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}pushAll(e){for(const n of e)this.push(n)}pop(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);const e=this.get(this.end);return this.set(this.end,void 0),e}unshift(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}shift(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}shuffleExcise(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const n=this.wrap(this.begin+e),s=this.get(n);return this.set(n,this.pop()),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class jb extends R4{constructor(){super(jb.INITIAL_CAPACITY)}isFull(){return!1}push(e){super.isFull()&&this.expand(),super.push(e)}unshift(e){super.isFull()&&this.expand(),super.unshift(e)}expand(){const e=this.capacity*2,n=new Array(e),s=this.length();for(let o=0;o<s;o++)n[o]=this.get(this.wrap(this.begin+o));this.data=n,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=s}}jb.INITIAL_CAPACITY=32;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */function $4(t){return new pwe(t)}function bA(t){return new mwe(t)}function fwe(t,e){return new D4(t,e)}function hwe(t,e=Da.FAIL){return new Swe(t,e)}class Jn{async toArray(){const e=[];let n=await this.next();for(;!n.done;)e.push(n.value),n=await this.next();return e}async toArrayForTest(){const e=this.prefetch(100),n=[];let s=await e.next();for(;!s.done;)n.push(s.value),s=await e.next();return n}async resolveFully(){let e=await this.next();for(;!e.done;)e=await this.next()}async resolveWhile(e){let n=await this.next(),s=e(n.value);for(;!n.done&&s;)n=await this.next(),s=e(n.value)}handleErrors(e){return new Cwe(this,e)}filter(e){return new bwe(this,e)}map(e){return new wwe(this,e)}mapAsync(e){return new jO(this,e)}serialMapAsync(e){return new jO(this,e).serial()}flatmap(e){return new Twe(this,e)}async forEachAsync(e){return this.map(e).resolveFully()}async serialForEach(e){return this.serialMapAsync(e).resolveWhile(n=>n===!0)}rowMajorBatch(e,n=!0){return new vwe(this,e,n)}columnMajorBatch(e,n=!0,s=k4){return this.rowMajorBatch(e,n).map(r=>awe(r,s))}concatenate(e,n){return new D4($4([this,e]),n)}take(e){return e<0||e==null?this:new xwe(this,e)}skip(e){return e<0||e==null?this:new ywe(this,e)}prefetch(e){return new _4(this,e)}shuffle(e,n){return new Nwe(this,e,n)}serial(){return new gwe(this)}}class pwe extends Jn{constructor(e){super(),this.items=e,this.trav=0}summary(){return`Array of ${this.items.length} items`}async next(){if(this.trav>=this.items.length)return{value:null,done:!0};const e=this.items[this.trav];return this.trav++,{value:cwe(e),done:!1}}}class mwe extends Jn{constructor(e){super(),this.nextFn=e}summary(){return"Function call"}async next(){try{return this.nextFn()}catch(e){throw e.message=`Error thrown while iterating through a dataset: ${e.message}`,e}}}class gwe extends Jn{constructor(e){super(),this.upstream=e,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Serial`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){return this.upstream.next()}}class ywe extends Jn{constructor(e,n){super(),this.upstream=e,this.maxCount=n,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Skip`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.count++<this.maxCount;){const e=await this.upstream.next();if(e.done)return e;je(e.value)}return this.upstream.next()}}class xwe extends Jn{constructor(e,n){super(),this.upstream=e,this.maxCount=n,this.count=0}summary(){return`${this.upstream.summary()} -> Take`}async next(){return this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next()}}class vwe extends Jn{constructor(e,n,s=!0){super(),this.upstream=e,this.batchSize=n,this.enableSmallLastBatch=s,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> RowMajorBatch`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){const e=[];for(;e.length<this.batchSize;){const n=await this.upstream.next();if(n.done)return this.enableSmallLastBatch&&e.length>0?{value:e,done:!1}:{value:null,done:!0};e.push(n.value)}return{value:e,done:!1}}}class bwe extends Jn{constructor(e,n){super(),this.upstream=e,this.predicate=n,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Filter`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;){const e=await this.upstream.next();if(e.done||this.predicate(e.value))return e;je(e.value)}}}class wwe extends Jn{constructor(e,n){super(),this.upstream=e,this.transform=n}summary(){return`${this.upstream.summary()} -> Map`}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const n=Pi(e.value),s=this.transform(e.value),o=Pi(s);for(const r of n)Gv(r,o)||r.dispose();return{value:s,done:!1}}}class Cwe extends Jn{constructor(e,n){super(),this.upstream=e,this.handler=n,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> handleErrors`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;)try{return await this.upstream.next()}catch(e){if(!this.handler(e))return{value:null,done:!0}}}}class jO extends Jn{constructor(e,n){super(),this.upstream=e,this.transform=n}summary(){return`${this.upstream.summary()} -> AsyncMap`}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const n=Pi(e.value),s=await this.transform(e.value),o=Pi(s);for(const r of n)Gv(r,o)||r.dispose();return{value:s,done:!1}}}class wA extends Jn{constructor(){super(),this.outputQueue=new jb,this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.outputQueue.length()===0;)if(!await this.pump())return{value:null,done:!0};return{value:this.outputQueue.shift(),done:!1}}}class Twe extends wA{constructor(e,n){super(),this.upstream=e,this.transform=n}summary(){return`${this.upstream.summary()} -> Flatmap`}async pump(){const e=await this.upstream.next();if(e.done)return!1;const n=Pi(e.value),s=this.transform(e.value),o=Pi(s);this.outputQueue.pushAll(s);for(const r of n)Gv(r,o)||r.dispose();return!0}}class D4 extends Jn{constructor(e,n){super(),this.baseErrorHandler=n,this.lastRead=null,this.iterator=null,this.moreIterators=e}summary(){return"TODO: fill in upstream of chained summaries -> Chained"}async next(){return this.lastRead=this.readFromChain(this.lastRead),this.lastRead}async readFromChain(e){if(await e,this.iterator==null){const s=await this.moreIterators.next();if(s.done)return{value:null,done:!0};this.iterator=s.value,this.baseErrorHandler!=null&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler))}const n=await this.iterator.next();return n.done?(this.iterator=null,this.readFromChain(e)):n}}var Da;(function(t){t[t.FAIL=0]="FAIL",t[t.SHORTEST=1]="SHORTEST",t[t.LONGEST=2]="LONGEST"})(Da||(Da={}));class Swe extends Jn{constructor(e,n=Da.FAIL){super(),this.iterators=e,this.mismatchMode=n,this.count=0,this.currentPromise=null}summary(){return"{TODO: fill in upstream of zip summaries} -> Zip"}async nextState(e){await e;let n=0,s=0;function o(i){return i instanceof Jn?{value:i.next().then(l=>(n++,l.done&&s++,l.value)),recurse:!1}:{value:null,recurse:!0}}const r=await A4(this.iterators,o);if(n===s)return{value:null,done:!0};if(s>0)switch(this.mismatchMode){case Da.FAIL:throw new Error(`Zipped streams should have the same length. Mismatched at element ${this.count}.`);case Da.SHORTEST:return{value:null,done:!0};case Da.LONGEST:}return this.count++,{value:r,done:!1}}async next(){return this.currentPromise=this.nextState(this.currentPromise),this.currentPromise}}class _4 extends Jn{constructor(e,n){super(),this.upstream=e,this.bufferSize=n,this.buffer=new R4(n)}summary(){return`${this.upstream.summary()} -> Prefetch`}refill(){for(;!this.buffer.isFull();){const e=this.upstream.next();this.buffer.push(e)}}next(){return this.refill(),this.buffer.shift()}}class Nwe extends _4{constructor(e,n,s){super(e,n),this.upstream=e,this.windowSize=n,this.upstreamExhausted=!1,this.random=pf.alea(s||os().toString()),this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}randomInt(e){return Math.floor(this.random()*e)}chooseIndex(){return this.randomInt(this.buffer.length())}async serialNext(){for(this.upstreamExhausted||this.refill();!this.buffer.isEmpty();){const e=this.chooseIndex(),n=await this.buffer.shuffleExcise(e);if(n.done)this.upstreamExhausted=!0;else return this.refill(),n}return{value:null,done:!0}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class wf{constructor(){this.size=null}batch(e,n=!0){const s=this;L(e>0,()=>`batchSize needs to be positive, but it is
      ${e}`);let o;return this.size===1/0||this.size==null?o=this.size:n?o=Math.ceil(this.size/e):o=Math.floor(this.size/e),ro(async()=>(await s.iterator()).columnMajorBatch(e,n,kwe),o)}concatenate(e){const n=this;let s;return this.size===1/0||e.size===1/0?s=1/0:this.size!=null&&e.size!=null?s=this.size+e.size:s=null,ro(async()=>(await n.iterator()).concatenate(await e.iterator()),s)}filter(e){const n=this;let s;return this.size===1/0?s=1/0:s=null,ro(async()=>(await n.iterator()).filter(o=>le(()=>e(o))),s)}async forEachAsync(e){return(await this.iterator()).forEachAsync(e)}map(e){const n=this;return ro(async()=>(await n.iterator()).map(s=>le(()=>e(s))),this.size)}mapAsync(e){const n=this;return ro(async()=>(await n.iterator()).mapAsync(e),this.size)}prefetch(e){if(e==null)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");const n=this;return ro(async()=>(await n.iterator()).prefetch(e),this.size)}repeat(e){const n=this;let s;return this.size!=null&&e>0?s=this.size*e:e===0?s=0:this.size!=null&&(e===void 0||e<0)?s=1/0:s=null,ro(async()=>{const o=bA(async()=>({value:await n.iterator(),done:!1}));return fwe(o.take(e))},s)}skip(e){const n=this;let s;return this.size!=null&&e>=0&&this.size>=e?s=this.size-e:this.size!=null&&(this.size<e||e===void 0||e<0)?s=0:s=null,ro(async()=>(await n.iterator()).skip(e),s)}shuffle(e,n,s=!0){if(e==null||e<0)throw this.size==null?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError(`\`Dataset.shuffle()\` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for \`tf.Tensor\`s), consider setting bufferSize to the dataset size (${this.size} elements)`);const o=this,r=pf.alea(n||os().toString());return ro(async()=>{let i=r.int32();return s&&(i+=r.int32()),(await o.iterator()).shuffle(e,i.toString())},this.size)}take(e){const n=this;let s;return this.size!=null&&this.size>e?s=e:this.size!=null&&this.size<=e?s=this.size:s=null,ro(async()=>(await n.iterator()).take(e),s)}async toArray(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArray()}async toArrayForTest(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArrayForTest()}}wf.MAX_BUFFER_SIZE=1e4;function ro(t,e=null){return new class extends wf{constructor(){super(...arguments),this.size=e}async iterator(){return t()}}}function Ewe(t){return ro(async()=>$4(t),t.length)}function Iwe(t){if(!Qc(t))throw new Error("The argument to zip() must be an object or array.");let e;if(Array.isArray(t))for(let n=0;n<t.length;n++)e=e==null?t[n].size:Math.min(e,t[n].size);else if(t instanceof Object)for(const n in t)e=e==null?t[n].size:Math.min(e,t[n].size);return ro(async()=>{const n=await A4(t,s=>{if(s instanceof wf)return{value:s.iterator(),recurse:!1};if(Qc(s))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")});return hwe(n,Da.SHORTEST)},e)}function kwe(t){if(t===null)return null;const e=t[0];return lwe(e)?{value:Awe(t),recurse:!1}:{value:null,recurse:!0}}function Awe(t){if(t.length===0)throw new Error("Can't make a batch of zero elements.");return t[0]instanceof yt?Ms(t):uo(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class M4 extends wf{constructor(e){super(),this.input=e}async iterator(){return(await this.input.iterator()).decodeUTF8().split(`
`).map(o=>(o.endsWith("\r")&&(o=o.slice(0,-1)),o))}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */const s0='"',Fh=Symbol("out"),ZO=Symbol("field"),o0=Symbol("quote"),aT=Symbol("quoteafterquote"),QO=Symbol("quoteinquote");class F4 extends wf{async columnNames(){return this.columnNamesValidated||await this.setColumnNames(),this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames}async setColumnNames(){const e=await this.maybeReadHeaderLine();if(!this.fullColumnNames&&!e)throw new Error("Column names must be provided if there is no header line.");this.fullColumnNames&&e&&L(e.length===this.fullColumnNames.length,()=>"The length of provided columnNames ("+this.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+e.length.toString()+")."),this.fullColumnNames||(this.fullColumnNames=e);const n=this.fullColumnNames.reduce((o,r)=>(o[r]=o[r]+1||1,o),{}),s=Object.keys(n).filter(o=>n[o]>1);if(L(s.length===0,()=>"Duplicate column names found: "+s.toString()),this.columnConfigs){for(const o of Object.keys(this.columnConfigs))if(this.fullColumnNames.indexOf(o)===-1)throw new Error('The key "'+o+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").")}this.columnNamesValidated=!0}async maybeReadHeaderLine(){if(this.hasHeader){const n=await(await this.base.iterator()).next();if(n.done)throw new Error("No data was found for CSV parsing.");const s=n.value;return this.parseRow(s,!1)}else return null}constructor(e,n){super(),this.input=e,this.hasHeader=!0,this.fullColumnNames=null,this.columnNamesValidated=!1,this.columnConfigs=null,this.configuredColumnsOnly=!1,this.delimiter=",",this.delimWhitespace=!1,this.base=new M4(e),n||(n={}),this.hasHeader=n.hasHeader!==!1,this.fullColumnNames=n.columnNames,this.columnConfigs=n.columnConfigs,this.configuredColumnsOnly=n.configuredColumnsOnly,n.delimWhitespace?(L(n.delimiter==null,()=>"Delimiter should not be provided when delimWhitespace is true."),this.delimWhitespace=!0,this.delimiter=" "):this.delimiter=n.delimiter?n.delimiter:","}async iterator(){this.columnNamesValidated||await this.setColumnNames();let e=await this.base.iterator();return this.hasHeader&&(e=e.skip(1)),e.map(n=>this.makeDataElement(n))}makeDataElement(e){const n=this.parseRow(e),s={},o={};for(let r=0;r<this.fullColumnNames.length;r++){const i=this.fullColumnNames[r],a=this.columnConfigs?this.columnConfigs[i]:null;if(!(this.configuredColumnsOnly&&!a)){const l=n[r];let u=null;if(l==="")if(a&&a.default!==void 0)u=a.default;else{if(a&&(a.required||a.isLabel))throw new Error(`Required column ${i} is empty in this line: ${e}`);u=void 0}else{const d=Number(l);if(isNaN(d))a&&a.dtype==="bool"?u=this.getBoolean(l):u=l;else if(!a||!a.dtype)u=d;else switch(a.dtype){case"float32":u=d;break;case"int32":u=Math.floor(d);break;case"bool":u=this.getBoolean(l);break;default:u=d}}a&&a.isLabel?o[i]=u:s[i]=u}}return Object.keys(o).length===0?s:{xs:s,ys:o}}getBoolean(e){return e==="1"||e.toLowerCase()==="true"?1:0}parseRow(e,n=!0){const s=[];let o=0;const r=e.length;let i=Fh;for(let a=0;a<r;a++)switch(i){case Fh:switch(e.charAt(a)){case s0:o=a+1,i=o0;break;case this.delimiter:if(o=a+1,this.delimiter===" "&&this.delimWhitespace)break;s.push(""),i=Fh;break;default:i=ZO,o=a;break}break;case ZO:switch(e.charAt(a)){case this.delimiter:s.push(e.substring(o,a)),i=Fh,o=a+1;break}break;case o0:switch(e.charAt(a)){case s0:i=aT;break}break;case aT:switch(e.charAt(a)){case this.delimiter:s.push(e.substring(o,a-1)),i=Fh,o=a+1;break;case s0:i=o0;break;default:i=QO;break}break;case QO:switch(e.charAt(a)){case s0:i=o0;break}break}if(i===aT?s.push(e.substring(o,r-1)):s.push(e.substring(o)),n&&s.length!==this.fullColumnNames.length)throw new Error(`Invalid row in csv file. Should have ${this.fullColumnNames.length} elements in a row, but got ${s}`);return s}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class CA extends Jn{constructor(e){super(),this.microphoneConfig=e,this.isClosed=!1,this.fftSize=e.fftSize||1024;const n=Math.log2(this.fftSize);if(this.fftSize<0||n<4||n>14||!Number.isInteger(n))throw new Error(`Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got ${this.fftSize}`);if(this.numFrames=e.numFramesPerSpectrogram||43,this.sampleRateHz=e.sampleRateHz,this.columnTruncateLength=e.columnTruncateLength||this.fftSize,this.audioTrackConstraints=e.audioTrackConstraints,this.smoothingTimeConstant=e.smoothingTimeConstant||0,this.includeSpectrogram=e.includeSpectrogram!==!1,this.includeWaveform=e.includeWaveform===!0,!this.includeSpectrogram&&!this.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.")}summary(){return"microphone"}static async create(e={}){if(!ue().get("IS_BROWSER"))throw new Error("microphone API is only supported in browser environment.");const n=new CA(e);return await n.start(),n}async start(){try{this.stream=await navigator.mediaDevices.getUserMedia({audio:this.audioTrackConstraints==null?!0:this.audioTrackConstraints,video:!1})}catch(s){throw new Error(`Error thrown while initializing video stream: ${s.message}`)}if(!this.stream)throw new Error("Could not obtain audio from microphone.");const e=window.AudioContext||window.webkitAudioContext;if(this.audioContext=new e,!this.sampleRateHz)this.sampleRateHz=this.audioContext.sampleRate;else if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error(`Mismatch in sampling rate: Expected: ${this.sampleRateHz}; Actual: ${this.audioContext.sampleRate}`);const n=this.audioContext.createMediaStreamSource(this.stream);this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=this.fftSize*2,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,n.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize)}async next(){if(this.isClosed)return{value:null,done:!0};let e,n;const s=await this.getAudioData();if(this.includeSpectrogram){const o=this.flattenQueue(s.freqDataQueue);e=this.getTensorFromAudioDataArray(o,[this.numFrames,this.columnTruncateLength,1])}if(this.includeWaveform){const o=this.flattenQueue(s.timeDataQueue);n=this.getTensorFromAudioDataArray(o,[this.numFrames*this.fftSize,1])}return{value:{spectrogram:e,waveform:n},done:!1}}async capture(){return(await this.next()).value}async getAudioData(){const e=[],n=[];let s=0;return new Promise(o=>{const r=setInterval(()=>{this.includeSpectrogram&&(this.analyser.getFloatFrequencyData(this.freqData),this.freqData[0]===-1/0&&o({freqDataQueue:e,timeDataQueue:n}),e.push(this.freqData.slice(0,this.columnTruncateLength))),this.includeWaveform&&(this.analyser.getFloatTimeDomainData(this.timeData),n.push(this.timeData.slice())),++s===this.numFrames&&(clearInterval(r),o({freqDataQueue:e,timeDataQueue:n}))},this.fftSize/this.sampleRateHz*1e3)})}stop(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),this.stream!=null&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())}toArray(){throw new Error("Can not convert infinite audio stream to array.")}getSampleRate(){return this.sampleRateHz}flattenQueue(e){const n=e[0].length,s=new Float32Array(e.length*n);return e.forEach((o,r)=>s.set(o,r*n)),s}getTensorFromAudioDataArray(e,n){const s=new Float32Array(me(n));return s.set(e,s.length-e.length),uo(s,n)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class TA extends Jn{constructor(e,n){if(super(),this.webcamVideoElement=e,this.webcamConfig=n,this.isClosed=!0,this.resize=!1,this.needToResize())if(this.resize=!0,this.cropSize=[this.webcamConfig.resizeHeight,this.webcamConfig.resizeWidth],this.cropBoxInd=us([0],"int32"),this.webcamConfig.centerCrop){const s=this.webcamConfig.resizeWidth*1/this.webcamVideoElement.width,o=this.webcamConfig.resizeHeight*1/this.webcamVideoElement.height,r=(1-s)/2,i=(1-o)/2,a=r+s,l=o+i;this.cropBox=Fa([i,r,l,a],[1,4])}else this.cropBox=Fa([0,0,1,1],[1,4])}summary(){return"webcam"}static async create(e,n={}){if(!ue().get("IS_BROWSER"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!e){if(e=document.createElement("video"),!n.resizeWidth||!n.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");e.width=n.resizeWidth,e.height=n.resizeHeight}const s=new TA(e,n);return await s.start(),s}async start(){this.webcamConfig.facingMode&&L(this.webcamConfig.facingMode==="user"||this.webcamConfig.facingMode==="environment",()=>`Invalid webcam facing mode: ${this.webcamConfig.facingMode}. Please provide 'user' or 'environment'`);try{this.stream=await navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})}catch(e){throw e.message=`Error thrown while initializing video stream: ${e.message}`,e}if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(e){console.log(e),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,new Promise(e=>{this.webcamVideoElement.onloadedmetadata=()=>{e()}})}async next(){if(this.isClosed)return{value:null,done:!0};let e;try{e=NB(this.webcamVideoElement)}catch(n){throw new Error(`Error thrown converting video to pixels: ${JSON.stringify(n)}`)}if(this.resize)try{return{value:this.cropAndResizeFrame(e),done:!1}}catch(n){throw new Error(`Error thrown cropping the video: ${n.message}`)}finally{e.dispose()}else return{value:e,done:!1}}needToResize(){return!!(this.webcamConfig.resizeWidth&&this.webcamConfig.resizeHeight&&(this.webcamVideoElement.width!==this.webcamConfig.resizeWidth||this.webcamVideoElement.height!==this.webcamConfig.resizeHeight))}cropAndResizeFrame(e){return le(()=>{const n=rs(Ne(e,"float32"),0);let s;s=Zo.cropAndResize(n,this.cropBox,this.cropBoxInd,this.cropSize,"bilinear");const o=s.shape;return ee(s,o.slice(1))})}async capture(){return(await this.next()).value}stop(){this.stream.getTracks().forEach(n=>n.stop());try{this.webcamVideoElement.srcObject=null}catch(n){console.log(n),this.webcamVideoElement.src=null}this.isClosed=!0}toArray(){throw new Error("Can not convert infinite video stream to array.")}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class O4{}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class P4 extends Jn{split(e){return new Rwe(this,e)}}class Rwe extends P4{constructor(e,n){super(),this.upstream=e,this.impl=new $we(e,n)}summary(){return this.impl.summary()}async next(){return this.impl.next()}}class $we extends wA{constructor(e,n){super(),this.upstream=e,this.separator=n,this.carryover=""}summary(){return`${this.upstream.summary()} -> Split('${this.separator}')`}async pump(){const e=await this.upstream.next();if(e.done)return this.carryover===""?!1:(this.outputQueue.push(this.carryover),this.carryover="",!0);const n=e.value.split(this.separator);n[0]=this.carryover+n[0];for(const s of n.slice(0,-1))this.outputQueue.push(s);return this.carryover=n[n.length-1],!0}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class Dwe extends Jn{decodeUTF8(){return new _we(this)}}class _we extends P4{constructor(e){super(),this.upstream=e,this.impl=new Mwe(e)}summary(){return this.impl.summary()}async next(){return this.impl.next()}}class Mwe extends wA{constructor(e){if(super(),this.upstream=e,ue().get("IS_BROWSER"))this.decoder=new TextDecoder("utf-8");else{const{StringDecoder:n}=require("string_decoder");this.decoder=new n("utf8")}}summary(){return`${this.upstream.summary()} -> Utf8`}async pump(){const e=await this.upstream.next();let n;if(e.done)return!1;n=e.value;let s;return ue().get("IS_BROWSER")?s=this.decoder.decode(n,{stream:!0}):s=this.decoder.write(Buffer.from(n.buffer)),this.outputQueue.push(s),!0}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class L4 extends Dwe{constructor(e,n={}){super(),this.file=e,this.options=n,L(e instanceof Uint8Array||(ue().get("IS_BROWSER")?e instanceof File||e instanceof Blob:!1),()=>"FileChunkIterator only supports File, Blob and Uint8Array right now."),this.offset=n.offset||0,this.chunkSize=n.chunkSize||1024*1024}summary(){return`FileChunks ${this.file}`}async next(){return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?{value:null,done:!0}:{value:await new Promise((n,s)=>{const o=this.offset+this.chunkSize;if(this.file instanceof Uint8Array)n(new Uint8Array(this.file.slice(this.offset,o)));else{const r=new FileReader;r.onload=a=>{let l=r.result;if(l instanceof ArrayBuffer&&(l=new Uint8Array(l)),!(l instanceof Uint8Array))return s(new TypeError("FileReader returned unknown type."));n(l)},r.onabort=a=>s(new Error("Aborted")),r.onerror=a=>s(new Error(a.type));const i=this.file.slice(this.offset,o);r.readAsArrayBuffer(i)}this.offset=o}),done:!1}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */async function Fwe(t,e={},n){let s,o;typeof t=="string"?s=t:(s=t.url,o=Owe(t));const r=await GV(s,o);if(r.ok){const i=new Uint8Array(await r.arrayBuffer());return new L4(i,e)}else throw new Error(r.statusText)}const Owe=t=>({method:t.method,headers:t.headers,body:t.body,mode:t.mode,credentials:t.credentials,cache:t.cache,redirect:t.redirect,referrer:t.referrer,integrity:t.integrity});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */function V4(t){return typeof t=="string"&&t.slice(0,7)==="file://"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class z4 extends O4{constructor(e,n={}){super(),this.input=e,this.options=n}async iterator(){if(V4(this.input)&&ue().get("IS_NODE")){const e=require("fs");this.input=e.readFileSync(this.input.slice(7))}return new L4(this.input,this.options)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */class B4 extends O4{constructor(e,n={}){super(),this.url=e,this.fileOptions=n}async iterator(){return V4(this.url)?new z4(this.url,this.fileOptions).iterator():Fwe(this.url,this.fileOptions)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */function Pwe(t,e={}){return new F4(new B4(t),e)}function Lwe(t){const e=bA(t);return ro(async()=>e)}function Vwe(t){return ro(async()=>{const e=await t();return bA(()=>e.next())})}async function zwe(t,e){return TA.create(t,e)}async function Bwe(t){return CA.create(t)}/** @license See the LICENSE file. */const U4="4.20.0";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uwe=Object.freeze(Object.defineProperty({__proto__:null,CSVDataset:F4,Dataset:wf,FileDataSource:z4,TextLineDataset:M4,URLDataSource:B4,array:Ewe,csv:Pwe,func:Lwe,generator:Vwe,microphone:Bwe,version_data:U4,webcam:zwe,zip:Iwe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fe(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&L(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gwe=gb;class Tg extends _x{nextDataId(){return Tg.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new BN(this,mr())}write(e,n,s){this.firstUse&&(this.firstUse=!1,ue().get("IS_NODE")&&Eo(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details.
============================`));const o={id:this.nextDataId()};return this.data.set(o,{values:e,dtype:s,refCount:1}),o}makeTensorInfo(e,n,s){let o;if(n==="string"&&s!=null&&s.length>0&&Wr(s[0])){const r=s.map(i=>Jr(i));o=this.write(r,e,n)}else o=this.write(s,e,n);return{dataId:o,shape:e,dtype:n}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const n=this.data.get(e);n.refCount++}decRef(e){if(this.data.has(e)){const n=this.data.get(e);n.refCount--}}move(e,n,s,o,r){this.data.set(e,{values:n,dtype:o,refCount:r})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:n,complexTensorInfos:s}=this.data.get(e);if(n==="complex64"){const o=this.readSync(s.real.dataId),r=this.readSync(s.imag.dataId);return zi(o,r)}return $V(this.data.get(e).values,n)}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const s=n.map(o=>Oi(o));return et(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return et(e.shape,e.dtype,n)}makeOutput(e,n,s){return mr().makeTensorFromTensorInfo(this.makeTensorInfo(n,s,e),this)}disposeData(e,n=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!n&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(e);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const n=os();return e(),{kernelMs:os()-n}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){Fe([e],"where");const n=this.readSync(e.dataId);return Gwe(e.shape,n)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}Tg.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G4(t){const e=new Float32Array(t.length);for(let n=0;n<t.length;++n)e[n]=Math.abs(t[n]);return e}const Hwe=t=>{const{x:e}=t.inputs,n=t.backend;Fe(e,"abs");let s=new Float32Array(me(e.shape));const o=n.data.get(e.dataId).values;return s=G4(o),n.makeOutput(s,e.shape,e.dtype)},Wwe={kernelName:Up,backendName:"cpu",kernelFunc:Hwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vn(t){return(e,n,s,o,r)=>{const i=Ze(e,n),a=i.length,l=ze(i),u=me(i),d=Xn(r,u),h=e.length,p=n.length,x=ze(e),b=ze(n),w=ou(e,i),C=ou(n,i);if(w.length+C.length===0)for(let T=0;T<d.length;++T)d[T]=t(s[T%s.length],o[T%o.length]);else for(let T=0;T<d.length;++T){const N=bu(T,a,l),I=N.slice(-h);w.forEach(M=>I[M]=0);const k=vr(I,h,x),A=N.slice(-p);C.forEach(M=>A[M]=0);const $=vr(A,p,b);d[T]=t(s[k],o[$])}return[d,i]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ao(t){const{inputs:e,backend:n}=t,{real:s,imag:o}=e,r=n.data.get(s.dataId).values,i=n.data.get(o.dataId).values,a=n.makeTensorInfo(s.shape,"complex64"),l=n.data.get(a.dataId);return l.complexTensorInfos={real:n.makeTensorInfo(s.shape,"float32",r),imag:n.makeTensorInfo(o.shape,"float32",i)},a}const qwe={kernelName:Ux,backendName:"cpu",kernelFunc:ao};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fx(t,e,n="float32"){if(n==="complex64"){const o=fx(t,e,"float32"),r=fx(t,e,"float32");return ao({inputs:{real:o,imag:r},backend:t})}const s=cs(me(e),n);return t.makeTensorInfo(e,n,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ri(t){const{inputs:e,backend:n}=t,{x:s}=e;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const Kwe={kernelName:Dd,backendName:"cpu",kernelFunc:ri};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function du(t){const{inputs:e,backend:n}=t,{input:s}=e,o=n.data.get(s.dataId).complexTensorInfos.real,r=n.data.get(o.dataId).values;return n.makeTensorInfo(o.shape,o.dtype,r)}const Xwe={kernelName:wv,backendName:"cpu",kernelFunc:du};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H4(t,e,n,s){if(s==="int32"){const o=Int32Array.from(t);return[e,"int32",o]}if(s==="bool"){const o=Qa([0],n),[r,i]=vn((a,l)=>a!==l?1:0)(e,[],t,o,"bool");return[i,"bool",r]}throw new Error(`Error in Cast: failed to cast ${n} to ${s}`)}function Ja(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{dtype:r}=s;if(r==="complex64"){if(o.dtype==="complex64")return ri({inputs:{x:o},backend:n});const d=fx(n,o.shape,o.dtype),h=Ja({inputs:{x:o},backend:n,attrs:{dtype:"float32"}}),p=ao({inputs:{real:h,imag:d},backend:n});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),p}if(o.dtype==="complex64"){const d=du({inputs:{input:o},backend:n}),h=Ja({inputs:{x:d},backend:n,attrs:{dtype:r}});return n.disposeIntermediateTensorInfo(d),h}if(!HN(o.dtype,r)){const d=ri({inputs:{x:o},backend:n});return{dataId:d.dataId,shape:d.shape,dtype:r}}const i=n.data.get(o.dataId).values,[a,l,u]=H4(i,o.shape,o.dtype,r);return n.makeTensorInfo(a,l,u)}const Ywe={kernelName:vd,backendName:"cpu",kernelFunc:Ja};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vn(t,e,n,s){return n==null?({inputs:o,backend:r})=>{const{a:i,b:a}=o,l=r;Fe([i,a],t);const u=l.data.get(i.dataId).values,d=l.data.get(a.dataId).values,h=i.dtype==="string"?Bi(u):u,p=i.dtype==="string"?Bi(d):d,x=s||i.dtype,[b,w]=e(i.shape,a.shape,h,p,x);return l.makeTensorInfo(w,x,b)}:({inputs:o,backend:r})=>{const{a:i,b:a}=o,l=r;if(i.dtype==="complex64"||a.dtype==="complex64"){const u=Ja({inputs:{x:i},backend:l,attrs:{dtype:"complex64"}}),d=l.data.get(u.dataId),h=d.complexTensorInfos.real,p=d.complexTensorInfos.imag,x=l.data.get(h.dataId).values,b=l.data.get(p.dataId).values,w=Ja({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),C=l.data.get(w.dataId),T=C.complexTensorInfos.real,N=C.complexTensorInfos.imag,I=l.data.get(T.dataId).values,k=l.data.get(N.dataId).values,[A,$,M]=n(i.shape,a.shape,x,b,I,k),O=l.makeTensorInfo(M,"float32",A),F=l.makeTensorInfo(M,"float32",$),P=ao({inputs:{real:O,imag:F},backend:l});return l.disposeIntermediateTensorInfo(u),l.disposeIntermediateTensorInfo(w),l.disposeIntermediateTensorInfo(O),l.disposeIntermediateTensorInfo(F),P}else{const u=l.data.get(i.dataId).values,d=l.data.get(a.dataId).values,h=s||i.dtype,[p,x]=e(i.shape,a.shape,u,d,h);return l.makeTensorInfo(x,h,p)}}}function SA(t){return(e,n,s,o,r,i)=>{const a=Ze(e,n),l=me(a),u=a.length,d=ze(a),h=Xn("float32",l),p=Xn("float32",l),x=ou(e,a),b=ou(n,a),w=zi(s,o),C=zi(r,i),T=e.length,N=ze(e),I=n.length,k=ze(n);if(x.length+b.length===0)for(let A=0;A<h.length;A++){const $=A%w.length,M=A%C.length,O=t(w[$*2],w[$*2+1],C[M*2],C[M*2+1]);h[A]=O.real,p[A]=O.imag}else for(let A=0;A<h.length;A++){const $=bu(A,u,d),M=$.slice(-T);x.forEach(H=>M[H]=0);const O=vr(M,T,N),F=$.slice(-I);b.forEach(H=>F[H]=0);const P=vr(F,I,k),D=t(w[O*2],w[O*2+1],C[P*2],C[P*2+1]);h[A]=D.real,p[A]=D.imag}return[h,p,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W4=vn(((t,e)=>t+e)),Jwe=SA(((t,e,n,s)=>({real:t+n,imag:e+s}))),ed=Vn(wu,W4,Jwe),jwe={kernelName:wu,backendName:"cpu",kernelFunc:ed};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NA(t,e,n,s,o){const r=me(s),i=cs(o,n);for(let a=0;a<t.length;a++){const l=t[a];if(l<0)throw new Error("Input x must be non-negative!");l>=o||(r>0?i[l]+=e[a]:i[l]+=1)}return i}function q4(t,e,n,s=!1){const o=t.shape[0],r=t.shape[1],i=et([o,n],e.dtype);for(let a=0;a<o;a++)for(let l=0;l<r;l++){const u=t.get(a,l);if(u<0)throw new Error("Input x must be non-negative!");u>=n||(s?i.set(1,a,u):e.size>0?i.set(i.get(a,u)+e.get(a,l),a,u):i.set(i.get(a,u)+1,a,u))}return i}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K4=vn(((t,e)=>t&e)),Zwe=Vn(Jp,K4),Qwe={kernelName:Jp,backendName:"cpu",kernelFunc:Zwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ai(t){return(e,n,s)=>{const o=dn(n,e.length);for(let r=0;r<e.length;++r)o[r]=t(e[r],s);return o}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rt(t,e,n){const s=ai(e);return al(t,s,n)}function al(t,e,n){return({inputs:s,attrs:o,backend:r})=>{const{x:i}=s;Fe(i,t);const a=r,l=a.data.get(i.dataId).values;let u;if(i.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");u=Bi(l)}else u=l;const d=n||i.dtype,h=e(u,d,o);return a.makeTensorInfo(i.shape,d,h)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X4=ai(t=>Math.ceil(t)),e1e=al(bd,X4),t1e={kernelName:bd,backendName:"cpu",kernelFunc:e1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y4(t,e,n,s){const o=dn(n,me(e));if(s&&n!=="string"){let r=0;t.forEach(i=>{const a=me(i.shape);o.set(i.vals,r),r+=a})}else{let r=0;t.forEach(i=>{const a=n==="string"?Bi(i.vals):i.vals;let l=0;for(let u=0;u<i.shape[0];++u){const d=u*e[1]+r;for(let h=0;h<i.shape[1];++h)o[d+h]=a[l++]}r+=i.shape[1]})}return o}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J4=vn((t,e)=>t===e?1:0),j4=Vn(rm,J4,null,"bool"),n1e={kernelName:rm,backendName:"cpu",kernelFunc:j4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z4=ai(t=>Math.exp(t)),Q4=al(Id,Z4,"float32"),s1e={kernelName:Id,backendName:"cpu",kernelFunc:Q4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eG=ai(t=>Math.expm1(t)),o1e=al(kd,eG),r1e={kernelName:kd,backendName:"cpu",kernelFunc:o1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tG=ai(t=>Math.floor(t)),i1e=al(Ad,tG),a1e={kernelName:Ad,backendName:"cpu",kernelFunc:i1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nG=vn((t,e)=>Math.floor(t/e)),l1e=Vn(Rd,nG,null,"int32"),u1e={kernelName:Rd,backendName:"cpu",kernelFunc:l1e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sG(t,e,n,s,o,r,i,a,l){const u=et([s,r],n);for(let d=0;d<s;d++){const h=[];let p=0;for(let x=0;x<o;x++){const b=t[d*o+x];p+=b*i[x],h.push(b)}if(p<0||p>=l/r)throw new Error(`Invalid indices: ${h} does not index into ${a}`);for(let x=0;x<r;x++)u.values[d*r+x]=e.get(...e.indexToLoc(p*r+x))}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oG(t,e,n){const s=et(n,t.dtype);for(let o=0;o<s.size;++o){const i=s.indexToLoc(o).slice(),a=i[0],l=i[2],u=e.locToIndex([a,l]);i[2]=e.values[u];const d=t.locToIndex(i);0<=d&&d<t.values.length&&(s.values[o]=t.values[d])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rG=vn((t,e)=>t>e?1:0),c1e=Vn(um,rG,null,"bool"),d1e={kernelName:um,backendName:"cpu",kernelFunc:c1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iG=vn((t,e)=>t>=e?1:0),f1e=Vn($d,iG,null,"bool"),h1e={kernelName:$d,backendName:"cpu",kernelFunc:f1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aG=vn((t,e)=>t<e?1:0),p1e=Vn(dm,aG,null,"bool"),m1e={kernelName:dm,backendName:"cpu",kernelFunc:p1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lG=vn((t,e)=>t<=e?1:0),g1e=Vn(fm,lG,null,"bool"),y1e={kernelName:fm,backendName:"cpu",kernelFunc:g1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uG(t,e,n){const s=(e-t)/(n-1),o=cs(n,"float32");o[0]=t;for(let r=1;r<o.length;r++)o[r]=o[r-1]+s;return o}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cG=ai(t=>Math.log(t)),x1e=al(Od,cG),v1e={kernelName:Od,backendName:"cpu",kernelFunc:x1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dG(t,e,n,s){const o=Xn(s,me(n));for(let r=0;r<o.length;++r){const i=r*e;let a=t[i];for(let l=0;l<e;++l){const u=t[i+l];(Number.isNaN(u)||u>a)&&(a=u)}o[r]=a}return o}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fG=vn(((t,e)=>Math.max(t,e))),b1e=Vn(Ld,fG),w1e={kernelName:Ld,backendName:"cpu",kernelFunc:b1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hG=vn(((t,e)=>Math.min(t,e))),C1e=Vn(Vd,hG),T1e={kernelName:Vd,backendName:"cpu",kernelFunc:C1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EA=vn(((t,e)=>t*e)),S1e=SA(((t,e,n,s)=>({real:t*n-e*s,imag:t*s+e*n}))),Zb=Vn(Bd,EA,S1e),N1e={kernelName:Bd,backendName:"cpu",kernelFunc:Zb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pG(t,e,n){const s=Hi(-1,n);return EA([],e,s,t,n)}function E1e(t){const{inputs:e,backend:n}=t,{x:s}=e;Fe(s,"neg");const o=n.data.get(s.dataId).values,[r,i]=pG(o,s.shape,s.dtype);return n.makeTensorInfo(i,s.dtype,r)}const I1e={kernelName:Tm,backendName:"cpu",kernelFunc:E1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mG=vn(((t,e)=>t!==e?1:0)),k1e=Vn(Sm,mG,null,"bool"),A1e={kernelName:Sm,backendName:"cpu",kernelFunc:k1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IA(t,e,n,s,o){const r=e.length,i=me(e),a=ze(e),l=ze(o),u=Xn(n,me(o));for(let d=0;d<i;++d){const h=bu(d,r,a),p=new Array(h.length);for(let b=0;b<p.length;b++)p[b]=h[s[b]];const x=vr(p,r,l);u[x]=t[d]}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Js(t){const{inputs:e,attrs:n,backend:s}=t,{x:o}=e,{perm:r}=n;Fe(o,"transpose");const i=o.shape.length,a=new Array(i);for(let h=0;h<a.length;h++)a[h]=o.shape[r[h]];const l=s.data.get(o.dataId).values,u=IA(l,o.shape,o.dtype,r,a);return{dataId:s.write(u,a,o.dtype),shape:a,dtype:o.dtype}}const R1e={kernelName:ql,backendName:"cpu",kernelFunc:Js};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gG(t,e,n,s){const[o,r]=Zn(t,s),i=Ws(e,"int32"),a=cs(me(o),i),l=me(r);for(let u=0;u<a.length;++u){const d=u*l;let h=1;for(let p=0;p<l;++p)h*=n[d+p];a[u]=h}return{outVals:a,outShape:o,outDtype:i}}function $1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r,keepDims:i}=s;Fe(o,"prod");const a=o.shape.length,l=ot(r,o.shape),u=rn(l,a);let d=l,h=o;const p=[];u!=null&&(h=Js({inputs:{x:o},backend:n,attrs:{perm:u}}),p.push(h),d=yn(d.length,a));const x=n.data.get(h.dataId).values,{outVals:b,outShape:w,outDtype:C}=gG(h.shape,h.dtype,x,d);let T=w;return i&&(T=gn(w,l)),p.forEach(N=>n.disposeIntermediateTensorInfo(N)),n.makeTensorInfo(T,C,b)}const D1e={kernelName:Rm,backendName:"cpu",kernelFunc:$1e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _1e(t,e,n){t.forEach((s,o)=>{if(s<0||s>=n){const r=bu(o,e.length,ze(e)).join(",");throw new Error(`indices[${r}] = ${s} is not in [0, ${n})`)}})}function M1e(t,e){for(let n=0;n<t.length;++n){const s=t[n],o=n===t.length-1?e:t[n+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>o)throw new Error("Ragged splits must not point past values");for(let r=1;r<s.length;++r)if(s[r-1]>s[r])throw new Error("Ragged splits must be sorted in ascending order")}}function F1e(t,e,n,s){const o=[];let r=0;const i=e.length-1+n.length,a=new Array(i).fill(null).map(()=>[0]);M1e(n,s);let l=1;for(let u=0;u<e.length-1;++u){l*=e[u];const d=e[u+1];for(let h=1;h<l+1;++h)a[u].push(h*d)}for(let u=0;u<t.length;++u){let d=t[u],h=t[u]+1;for(let p=0;p<n.length;++p){const x=n[p],b=p+e.length-1;if(b>=0){const w=a[b],C=w[w.length-1]-x[d];for(let T=d;T<h;++T)a[b].push(x[T+1]+C)}d=x[d],h=x[h]}h!==d&&(o.push([d,h]),r+=h-d)}return{outSplits:a,valueSlices:o,numValues:r}}function O1e(t){const e=[];for(let n=0;n<t.length;++n){const s=t[n].length,o=dn("int32",s);e.push(o),t[n].forEach((r,i)=>o[i]=r)}return e}function eP(t,e){const n=t.slice(0,e);for(;n.length<e;)n.push(1);for(let s=e;s<t.length;s++)n[e-1]*=t[s];return n}function P1e(t,e,n,s,o,r){const i=eP(e,2)[1],a=eP(r,2)[1];let l=0;for(const u of n)for(let d=u[0];d<u[1];++d){for(let h=0;h<s;++h)o[l*a+h]=t[d*i+h];++l}}function L1e(t,e,n,s,o){const r=e.slice();r[0]=o;const i=dn(n,me(r)),a=t.length,l=a===0?0:a/e[0];return P1e(t,e,s,l,i,r),[i,r]}function yG(t,e,n,s,o,r,i,a){if(t.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if(_1e(r,i,l),s.length===0)throw new Error("params.rank must be nonzero");const u=s[0],{outSplits:d,valueSlices:h,numValues:p}=F1e(r,i,t,u),x=O1e(d),b=L1e(n,s,o,h,p);return[x,b[0],b[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tP=2147483647;function xG(t,e,n,s,o,r,i){if(e.length>1)throw new Error("starts must be a scalar or vector");if(o.length>1)throw new Error("limits must be a scalar or vector");if(i.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,l=o.length===0,u=i.length===0,d=[];a||d.push(e[0]),l||d.push(o[0]),u||d.push(i[0]);for(let C=1;C<d.length;++C)if(d[C]!==d[C-1])throw new Error("starts, limits, and deltas must have the same shape");const h=d.length===0?1:d[0],p=dn("int32",h+1);p[0]=0;for(let C=0;C<h;++C){const T=a?t[0]:t[C],N=l?s[0]:s[C],I=u?r[0]:r[C];if(I===0)throw new Error("Requires delta != 0");let k;if(I>0&&N<T||I<0&&N>T)k=0;else if(k=Math.ceil(Math.abs((N-T)/I)),k>tP)throw new Error(`Requires ((limit - start) / delta) <= ${tP}`);p[C+1]=p[C]+k}const x=p[h],b=dn(n,x);let w=0;for(let C=0;C<h;++C){const T=p[C+1]-p[C];let N=a?t[0]:t[C];const I=u?r[0]:r[C];for(let k=0;k<T;++k)b[w++]=N,N+=I}return[p,b]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Yo=yr;class hx{constructor(e,n,s,o,r,i,a,l,u,d){this.shape=e,this.shapeShape=n,this.values=s,this.valuesShape=o,this.valuesDType=r,this.defaultValue=i,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=u,this.rowPartitionTypes=LB(d),this.raggedRank=VB(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===Yo.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===Yo.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const n=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Yo.VALUE_ROWIDS:return hx.getMaxWidthValueRowID(n);case Yo.ROW_SPLITS:return hx.getMaxWidthRowSplit(n);default:throw new Error(`Cannot handle partition type ${Yo[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const n=e.length;if(n===0||n===1)return 0;let s=0;for(let o=0;o<n-1;++o){const r=e[o+1]-e[o];r>s&&(s=r)}return s}static getMaxWidthValueRowID(e){const n=e.length;if(n===0)return 0;let s=0,o=e[0],r=0;for(let i=1;i<n;++i){const a=e[i];a!==o&&(o=a,r=Math.max(i-s,r),s=i)}return Math.max(n-s,r)}tensorShapeFromTensor(e,n,s=!0){if(n.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return sP(e,s)}calculateOutputSize(e){const n=this.valuesShape,s=this.defaultValueShape;zB(s,n);const o=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=PB(this.raggedRank,o,n);i[0]<0&&(i[0]=e);for(let a=1;a<=this.raggedRank;++a)i[a]<0&&(i[a]=this.getMaxWidth(a));return i}calculateFirstParentOutputIndex(e,n,s){const o=Math.min(e,s),r=[];let i=0;for(let a=0;a<o;++a,i+=n)r.push(i);for(let a=o;a<e;++a)r.push(-1);return L(r.length===e,()=>"Final length of result must be equal to firstDimension."),r}calculateOutputIndexRowSplit(e,n,s,o){const r=e.length,i=[];for(let a=0;a<r-1;++a){const l=e[a+1]-e[a];let u=Math.min(o,l),d=n[a];d===-1&&(u=0);for(let h=0;h<u;++h)i.push(d),d+=s;for(let h=0;h<l-u;++h)i.push(-1)}if(r>0&&i.length!==e[r-1])throw new Error("Invalid row split size.");return i}calculateOutputIndexValueRowID(e,n,s,o){const r=e.length,i=[];if(r===0)return[];let a=0,l=e[0];if(l>=n.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${n.length}`);let u=n[l];i.push(u);for(let d=1;d<r;++d){const h=e[d];if(h===l)u>=0&&(++a,a<o?u+=s:u=-1);else{if(a=0,l=h,h>=n.length)throw new Error(`Got nextValueRowId=${h} which is not less than ${n.length}`);u=n[h]}i.push(u)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}calculateOutputIndex(e,n,s,o){const r=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case Yo.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(r,n,s,o);case Yo.ROW_SPLITS:if(r.length-1>n.length)throw new Error(`Row partition size is greater than output size: ${r.length-1} > ${n.length}`);return this.calculateOutputIndexRowSplit(r,n,s,o);default:throw new Error(`Unsupported partition type: ${Yo[i]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const n=this.rowPartitionTypes[0];switch(n){case Yo.FIRST_DIM_SIZE:return e[0];case Yo.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Yo.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${Yo[n]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const n=this.getFirstDimensionSize(),s=this.calculateOutputSize(n),o=new Array(this.raggedRank+1);o[o.length-1]=1;for(let l=o.length-2;l>=0;--l)o[l]=o[l+1]*s[l+1];const r=sP(s,!1),i=dn(this.valuesDType,me(r));if(o[0]*s[0]>0){let l=this.calculateFirstParentOutputIndex(n,o[0],s[0]);for(let u=1;u<=this.raggedRank;++u)l=this.calculateOutputIndex(u-1,l,o[u],s[u]);this.setOutput(this.raggedRank,l,i,r)}return[r,i]}setOutput(e,n,s,o){if(s.length===0)return;const r=this.values,i=s;let a=o.slice();a=a.slice(e+1);const l=me(a),u=n.length;let d=this.defaultValue;if(d.length!==l&&d.length!==1){const b=this.defaultValueShape;le(()=>{const w=ee(d,b);d=Kl(w,a).dataSync()})}let h=0,p=0,x=0;for(let b=0;b<=u;++b){let w=b<u?n[b]:-1;if(w===x){++x;continue}if(p<x){const C=r.subarray(h*l),T=i.subarray(p*l),N=(x-p)*l;nP(T,C,N)}if(b>=u){const C=s.length;w=Math.floor(C/l)}if(w>x)if(this.defaultValue.length===1)i.subarray(x*l,w*l).fill(this.defaultValue[0]),x=w;else for(;w>x;){const C=i.slice(x*l);nP(C,d,l),++x}w<0?(h=b+1,p=x):(h=b,p=x,x=p+1)}}}function nP(t,e,n){for(let s=0;s<n;s++)t[s]=e[s]}function sP(t,e){const n=[];for(let s of t){if(s<0){if(!e)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}n.push(s)}return n}function vG(t,e,n,s,o,r,i,a,l,u){return new hx(t,e,n,s,o,r,i,a,l,u).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bG(t,e,n,s){const o=t===e,r=t<e&&n<0,i=e<t&&n>1;if(o||r||i)return cs(0,s);const a=Math.abs(Math.ceil((e-t)/n)),l=cs(a,s);e<t&&n===1&&(n=-1),l[0]=t;for(let u=1;u<l.length;u++)l[u]=l[u-1]+n;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wG=ai(t=>1/Math.sqrt(t)),V1e=al(Kd,wG),z1e={kernelName:Kd,backendName:"cpu",kernelFunc:V1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ul(t,e,n,s,o,r,i,a,l,u){const d=[s/o,o],h=t.values,p=e.values;if(s===0)return et(n,e.dtype);const x=l instanceof In?l:et(d,e.dtype);typeof l=="string"||typeof l=="number"?x.values.fill(l):typeof l=="boolean"&&x.values.fill(+l);for(let b=0;b<r;b++){const w=[];let C=0;for(let T=0;T<i;T++){const N=h[b*i+T];w.push(N),C+=N*a[T]}if(C<0||C>=s/o)throw new Error(`Invalid indices: ${w} does not index into ${n}`);for(let T=0;T<o;T++)u?x.values[C*o+T]+=p[b*o+T]:x.values[C*o+T]=e.rank===0?p[0]:p[b*o+T]}return x}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B1e=ai(t=>1/(1+Math.exp(-t))),CG=Rt(Zd,t=>1/(1+Math.exp(-t))),U1e={kernelName:Zd,backendName:"cpu",kernelFunc:CG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TG(t,e,n,s,o){const r=bI(s,e,n),i=me(n),a=ze(s);if(r){const h=wI(e,a);return o==="string"?t.slice(h,h+i):t.subarray(h,h+i)}const l=o==="string"?Bi(t):t,u=et(s,o,l),d=et(n,o);for(let h=0;h<d.size;++h){const p=d.indexToLoc(h),x=p.map((b,w)=>b+e[w]);d.set(u.get(...x),...p)}return o==="string"?iU(d.values):d.values}function fu(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{begin:r,size:i}=s;Fe(o,"slice");const[a,l]=Ib(o,r,i);xI(o,a,l);const u=n.data.get(o.dataId).values,d=TG(u,a,l,o.shape,o.dtype);return n.makeTensorInfo(l,o.dtype,d)}const G1e={kernelName:Om,backendName:"cpu",kernelFunc:fu};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SG(t,e,n,s,o,r,i){const a=e[0],l=r[0],u=new Array(l),d=new Array(a),h=e[1];if(l===0){if(a!==0)throw new Error(KB(a));const C=dn(n,0),T=dn(o,0);return[C,[0,h],T,u,d]}let p=!0,x=0;const b=new Array(l).fill(0);for(let C=0;C<a;++C){const T=t[C*h];if(T<0)throw new Error(XB(C,T));if(T>=l)throw new Error(YB(C,T,l));++b[T],p=p&&T>=x,x=T}let w=!0;for(let C=0;C<l;++C){const T=b[C]===0;u[C]=T,w=w&&!T,b[C]=Math.max(b[C],1),C>0&&(b[C]+=b[C-1])}if(w&&p){const C=t,T=s;for(let N=0;N<a;++N)d[N]=N;return[C,[a,h],T,u,d]}else{const C=b[l-1],T=dn(n,C*h),N=dn(o,C),I=new Array(l).fill(0);for(let k=0;k<a;++k){const A=t[k*h],$=I[A],M=(A===0?0:b[A-1])+$;I[A]++;for(let O=0;O<h;++O)T[M*h+O]=t[k*h+O];N[M]=s[k],d[k]=M}for(let k=0;k<l;++k)if(I[k]===0){const $=k===0?0:b[k-1];T[$*h+0]=k;for(let M=1;M<h;++M)T[$*h+M]=0;N[$]=i}return[T,[C,h],N,u,d]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NG(t,e,n,s,o){const r=me(s),i=e[0],a=o.length,l=[];let u=1,d=-1;for(let C=0;C<a;++C){const T=o[C];if(T===-1){if(d!==-1)throw new Error(JB(d,C));d=C,l.push(1)}else{if(T<0)throw new Error(jB(C,T));u*=T,l.push(T)}}if(d!==-1){if(u<=0)throw new Error(ZB());const C=Math.trunc(r/u);if(u*C!==r)throw new Error(QB(s,l));l[d]=C}if(me(l)!==r)throw new Error(eU(s,l));const p=s.length,x=[];if(p>0){x[p-1]=1;for(let C=p-2;C>=0;--C)x[C]=x[C+1]*s[C+1]}const b=[];if(a>0){b[a-1]=1;for(let C=a-2;C>=0;--C)b[C]=b[C+1]*l[C+1]}const w=dn(n,i*a);for(let C=0;C<i;++C){let T=0;for(let N=0;N<p;++N)T+=t[C*p+N]*x[N];for(let N=0;N<a;++N)w[C*a+N]=Math.trunc(T/b[N]),T%=b[N]}return[w,[i,a],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kA(t,e,n,s,o,r=!1,i=0){const a=s.length,l=[e[0],t.length/e[0]],u=l[1],h=a>0?o[a-1]+1:0;if(h<0)throw new Error(hS());const p=e.slice();p[0]=h;const x=p.reduce((I,k)=>I*k,1),b=dn(n,x);if(a===0)return h>0&&b.fill(i),[b,p];if(h<=0)throw new Error(hS());let w=0,C=1,T=0,N=o[w];for(;;){let I=0;if(C<a){if(I=o[C],N===I){++C;continue}if(N>=I)throw new Error(tU())}if(N<0||N>=h)throw new Error(nU(N,h));N>T&&b.fill(i,T*u,N*u);for(let k=w;k<C;++k){const A=s[k];if(A<0||A>=l[0])throw new Error(sU(k,s[k],l[0]));for(let $=0;$<u;$++)b[N*u+$]+=t[A*u+$]}if(r)for(let k=0;k<u;k++)b[N*u+k]/=C-w;if(w=C,++C,T=N+1,N=I,C>a)break}return T<h&&b.fill(i,T*u,h*u),[b,p]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H1e=ai(t=>Math.sqrt(t)),W1e=Rt(ef,t=>Math.sqrt(t)),q1e={kernelName:ef,backendName:"cpu",kernelFunc:W1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EG=vn(((t,e)=>{const n=t-e;return n*n})),K1e=Vn(tf,EG),X1e={kernelName:tf,backendName:"cpu",kernelFunc:K1e};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IG=ai((t,e)=>{const{pattern:n,replaceGlobal:s,rewrite:o}=e;return t.replace(new RegExp(n,s?"g":""),o)}),Y1e=al(Bm,IG),J1e={kernelName:Bm,backendName:"cpu",kernelFunc:Y1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kG(t,e,n,s){const o=et(t,e.dtype);for(let r=0;r<o.size;r++){const i=o.indexToLoc(r),a=new Array(i.length);for(let l=0;l<a.length;l++)a[l]=i[l]*n[l]+s[l];o.set(e.get(...a),...i)}return o}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class j1e{constructor(e,n,s,o,r,i){this.separator=Jr(e),this.nGramWidths=n,this.leftPad=Jr(s),this.rightPad=Jr(o),this.padWidth=r,this.preserveShort=i}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,n){const s=this.getPadWidth(n);return Math.max(0,e+2*s-n+1)}createNGrams(e,n,s,o,r,i){for(let a=0;a<r;++a){const l=this.getPadWidth(i),u=Math.max(0,l-a),d=Math.max(0,l-(r-(a+1))),h=i-(u+d),p=n+(u>0?0:a-l);let x=0;x+=u*this.leftPad.length;for(let N=0;N<h;++N)x+=e[p+N].length;x+=d*this.rightPad.length;const b=u+d+h-1;x+=b*this.separator.length,s[o+a]=new Uint8Array(x);const w=s[o+a];let C=0;const T=N=>N.forEach(I=>w[C++]=I);for(let N=0;N<u;++N)T(this.leftPad),T(this.separator);for(let N=0;N<h-1;++N)T(e[p+N]),T(this.separator);if(h>0){T(e[p+h-1]);for(let N=0;N<d;++N)T(this.separator),T(this.rightPad)}else{for(let N=0;N<d-1;++N)T(this.rightPad),T(this.separator);T(this.rightPad)}}}compute(e,n){const s=e.length,o=n.length;if(o>0){let l=n[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let u=1;u<o;++u){let d=n[u]>=l;if(d=d&&n[u]<=s,!d)throw new Error(`Invalid split value ${n[u]}, must be in [${l}, ${s}]`);l=n[u]}if(l!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${l}`)}const r=o-1,i=dn("int32",o);if(s===0||o===0){const l=new Array(s);for(let u=0;u<=r;++u)i[u]=0;return[l,i]}i[0]=0;for(let l=1;l<=r;++l){const u=n[l]-n[l-1];let d=0;this.nGramWidths.forEach(h=>{d+=this.getNumNGrams(u,h)}),this.preserveShort&&u>0&&d===0&&(d=1),i[l]=i[l-1]+d}const a=new Array(i[r]);for(let l=0;l<r;++l){const u=n[l];let d=i[l];if(this.nGramWidths.forEach(h=>{const p=n[l+1]-n[l],x=this.getNumNGrams(p,h);this.createNGrams(e,u,a,d,x,h),d+=x}),this.preserveShort&&d===i[l]){const h=n[l+1]-n[l];if(h===0)continue;const p=h+2*this.padWidth;this.createNGrams(e,u,a,d,1,p)}}return[a,i]}}function AG(t,e,n,s,o,r,i,a){return new j1e(n,s,o,r,i,a).compute(t,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z1e(t,e,n,s){if(!t.length)return;if(e.length===0){for(let r=0;r<t.length;++r)s.push(t.subarray(r,r+1));return}if(e.length===1){const r=e[0];let i=t.indexOf(r);for(;i!==-1;){const a=t.subarray(0,i);(!n||a.length!==0)&&s.push(a),t=t.subarray(i+1),i=t.indexOf(r)}(!n||t.length!==0)&&s.push(t);return}let o=0;for(let r=0;r<t.length+1;r++)if(r===t.length||e.indexOf(t[r])!==-1){const i=t.subarray(o,r);(!n||i.length!==0)&&s.push(i),o=r+1}}function RG(t,e,n){const s=t.length,o=[];let r=0,i=0;const a=new Array(s);for(let p=0;p<s;++p){const x=o.length;Z1e(t[p],e,n,o);const b=o.length-x;a[p]=b,r+=b,i=Math.max(i,b)}const l=dn("int32",r*2),u=new Array(r),d=[s,i];let h=0;for(let p=0;p<s;++p)for(let x=0;x<a[p];++x)l[h*2]=p,l[h*2+1]=x,u[h]=o[h],++h;return[l,u,d]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $G(t,e){const n=dn("int32",t.length);for(let s=0;s<t.length;++s)n[s]=UV(t[s]).modulo(e).getLowBitsUnsigned();return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DG=vn(((t,e)=>t-e)),Q1e=SA(((t,e,n,s)=>({real:t-n,imag:e-s}))),AA=Vn(nf,DG,Q1e),eCe={kernelName:nf,backendName:"cpu",kernelFunc:AA};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _G(t,e){const n=new Array(t.rank);for(let o=0;o<n.length;o++)n[o]=t.shape[o]*e[o];const s=et(n,t.dtype);for(let o=0;o<s.values.length;++o){const r=s.indexToLoc(o),i=new Array(t.rank);for(let l=0;l<i.length;l++)i[l]=r[l]%t.shape[l];const a=t.locToIndex(i);s.values[o]=t.values[a]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gh=(t,e)=>{const n=e.value-t.value;return n===0?t.index-e.index:n};function MG(t,e,n=0,s=t.length-1){for(;s>n;){if(s-n>600){const a=s-n+1,l=e-n+1,u=Math.log(a),d=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*d*(a-d)/a)*Math.sign(l-a/2),p=Math.max(n,Math.floor(e-l*d/a+h)),x=Math.min(s,Math.floor(e+(a-l)*d/a+h));MG(t,e,p,x)}const o=t[e];let r=n,i=s;for(Ai(t,n,e),Gh(t[s],o)>0&&Ai(t,n,s);r<i;){for(Ai(t,r,i),r++,i--;Gh(t[r],o)<0;)r=r+1;for(;Gh(t[i],o)>0;)i=i-1}Gh(t[n],o)===0?Ai(t,n,i):(i=i+1,Ai(t,i,s)),i<=e&&(n=i+1),e<=i&&(s=i-1)}}function FG(t,e,n,s,o){const r=e[e.length-1],[i,a]=[t.length/r,r],l=Xn(n,i*s),u=Xn("int32",i*s);for(let h=0;h<i;h++){const p=h*a,x=t.subarray(p,p+a);let b=new Array(x.length);x.forEach((N,I)=>b[I]={value:N,index:I}),s<b.length&&(MG(b,s),b=b.slice(0,s)),o&&b.sort(Gh);const w=h*s,C=l.subarray(w,w+s),T=u.subarray(w,w+s);for(let N=0;N<s;N++)C[N]=b[N].value,T[N]=b[N].index}const d=e.slice();return d[d.length-1]=s,[et(d,n,l),et(d,"int32",u)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OG(t,e,n,s){const o=ot(e,n)[0],r=[1,n[0],1];for(let b=0;b<o;b++)r[0]*=n[b];r[1]=n[o];for(let b=o+1;b<n.length;b++)r[2]*=n[b];const i=new Map,a=new Int32Array(n[o]),l=new In(r,s,t),u=[],d=r[0]===1&&r[2]===1;for(let b=0;b<n[o];b++){let w;if(d)w=t[b].toString();else{const T=[];for(let N=0;N<r[0];N++)for(let I=0;I<r[2];I++)T.push(l.get(N,b,I));w=T.join(",")}const C=i.get(w);if(C!=null)a[b]=C;else{const T=i.size;i.set(w,T),a[b]=T,u.push(b)}}const h=r.slice();h[1]=i.size;const p=new In(h,s);u.forEach((b,w)=>{for(let C=0;C<r[0];C++)for(let T=0;T<r[2];T++)p.set(l.get(C,b,T),C,w,T)});const x=n.slice();return x[o]=h[1],{outputValues:p.values,outputShape:x,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PG=Object.freeze(Object.defineProperty({__proto__:null,addImpl:W4,bincountImpl:NA,bincountReduceImpl:q4,bitwiseAndImpl:K4,castImpl:H4,ceilImpl:X4,concatImpl:Y4,equalImpl:J4,expImpl:Z4,expm1Impl:eG,floorDivImpl:nG,floorImpl:tG,gatherNdImpl:sG,gatherV2Impl:oG,greaterEqualImpl:iG,greaterImpl:rG,lessEqualImpl:lG,lessImpl:aG,linSpaceImpl:uG,logImpl:cG,maxImpl:dG,maximumImpl:fG,minimumImpl:hG,multiplyImpl:EA,negImpl:pG,notEqualImpl:mG,prodImpl:gG,raggedGatherImpl:yG,raggedRangeImpl:xG,raggedTensorToTensorImpl:vG,rangeImpl:bG,rsqrtImpl:wG,scatterImpl:Ul,sigmoidImpl:B1e,simpleAbsImpl:G4,sliceImpl:TG,sparseFillEmptyRowsImpl:SG,sparseReshapeImpl:NG,sparseSegmentReductionImpl:kA,sqrtImpl:H1e,squaredDifferenceImpl:EG,staticRegexReplaceImpl:IG,stridedSliceImpl:kG,stringNGramsImpl:AG,stringSplitImpl:RG,stringToHashBucketFastImpl:$G,subImpl:DG,tileImpl:_G,topKImpl:FG,transposeImpl:IA,uniqueImpl:OG},Symbol.toStringTag,{value:"Module"}));/** @license See the LICENSE file. */const LG="4.20.0";/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ZN("cpu",()=>new Tg,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VG=Rt(Nd,t=>t>=0?t:Math.exp(t)-1),tCe={kernelName:Nd,backendName:"cpu",kernelFunc:VG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zG(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{alpha:r}=s;Fe([o],"leakyRelu");const i=me(o.shape),a=n.data.get(o.dataId).values,l=Xn("float32",i);for(let u=0;u<a.length;u++)l[u]=a[u]<0?r*a[u]:a[u];return n.makeTensorInfo(o.shape,"float32",l)}const nCe={kernelName:cm,backendName:"cpu",kernelFunc:zG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sCe=vn((t,e)=>t<0?e*t:t);function BG(t){const{inputs:e,backend:n}=t,{x:s,alpha:o}=e;Fe([s,o],"prelu");const r=n.data.get(s.dataId).values,i=n.data.get(o.dataId).values,[a,l]=sCe(s.shape,o.shape,r,i,"float32");return n.makeTensorInfo(l,"float32",a)}const oCe={kernelName:Am,backendName:"cpu",kernelFunc:BG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UG=Rt(Hd,t=>Math.max(0,t)),rCe={kernelName:Hd,backendName:"cpu",kernelFunc:UG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GG=Rt(Wd,t=>Math.min(Math.max(0,t),6)),iCe={kernelName:Wd,backendName:"cpu",kernelFunc:GG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function px(t,e,n,s,o){if(n==="linear")return ri({inputs:{x:e},backend:t});if(n==="relu")return UG({inputs:{x:e},backend:t});if(n==="elu")return VG({inputs:{x:e},backend:t});if(n==="relu6")return GG({inputs:{x:e},backend:t});if(n==="prelu")return BG({inputs:{x:e,alpha:s},backend:t});if(n==="leakyrelu")return zG({inputs:{x:e},backend:t,attrs:{alpha:o}});if(n==="sigmoid")return CG({inputs:{x:e},backend:t});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wt(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{shape:r}=s,i=me(o.shape),a=GN(r,i),l=me(a);L(i===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${o.shape}) has ${i} elements. The new shape and old shape must have the same number of elements.`),n.incRef(o.dataId);const u=n.data.get(o.dataId);if(u.complexTensorInfos!=null){const d=u.complexTensorInfos.real,h=u.complexTensorInfos.imag;d.shape=a,h.shape=a}return{dataId:o.dataId,shape:a,dtype:o.dtype}}const aCe={kernelName:$m,backendName:"cpu",kernelFunc:Wt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HG(t){const{inputs:e,backend:n,attrs:s}=t,{a:o,b:r}=e,{transposeA:i,transposeB:a}=s;Fe([o,r],"matMul");const l=o.shape.length,u=r.shape.length,d=i?o.shape[l-2]:o.shape[l-1],h=a?r.shape[u-1]:r.shape[u-2],p=i?o.shape[l-1]:o.shape[l-2],x=a?r.shape[u-2]:r.shape[u-1],b=o.shape.slice(0,-2),w=r.shape.slice(0,-2),C=me(b),T=me(w),I=Ze(o.shape.slice(0,-2),r.shape.slice(0,-2)).concat([p,x]);L(d===h,()=>`Error in matMul: inner shapes (${d}) and (${h}) of Tensors with shapes ${o.shape} and ${r.shape} and transposeA=${i} and transposeB=${a} must match.`);const k=i?[C,d,p]:[C,p,d],A=a?[T,x,h]:[T,h,x],$=Wt({inputs:{x:o},backend:n,attrs:{shape:k}}),M=Wt({inputs:{x:r},backend:n,attrs:{shape:A}}),O=i?$.shape[1]:$.shape[2],F=i?$.shape[2]:$.shape[1],P=a?M.shape[1]:M.shape[2],D=Math.max(C,T),H=n.data.get($.dataId).values,Z=n.data.get(M.dataId).values,ne=ze($.shape),Q=ze(M.shape),[G,q,J]=i?[ne[0],1,ne[1]]:[ne[0],ne[1],1],[oe,B,X]=a?[1,Q[1],Q[0]]:[Q[1],1,Q[0]],ie=F*P,re=et([D,F,P],$.dtype),ye=re.values,ve=n.blockSize;for(let be=0;be<D;be++){const Re=be%C,Ae=be%T;for(let De=0;De<F;De+=ve){const Ke=Math.min(De+ve,F);for(let Xe=0;Xe<P;Xe+=ve){const dt=Math.min(Xe+ve,P);for(let wt=0;wt<O;wt+=ve){const $t=Math.min(wt+ve,O);for(let It=De;It<Ke;It++)for(let Ct=Xe;Ct<dt;Ct++){let it=0;for(let Dt=wt;Dt<$t;Dt++){const js=H[Re*G+It*q+Dt*J],an=Z[Dt*oe+Ct*B+Ae*X];it+=js*an}ye[be*ie+(It*P+Ct)]+=it}}}}}return n.disposeIntermediateTensorInfo($),n.disposeIntermediateTensorInfo(M),n.makeTensorInfo(I,re.dtype,re.values)}const lCe={kernelName:Xp,backendName:"cpu",kernelFunc:HG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uCe(t){const{inputs:e,backend:n,attrs:s}=t,{a:o,b:r,bias:i,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:d,leakyreluAlpha:h}=s;let p,x,b;const w=[];p=HG({inputs:{a:o,b:r},attrs:{transposeA:l,transposeB:u},backend:n}),i&&(x=ed({inputs:{a:p,b:i},backend:n}),w.push(p),p=x),d&&(b=px(n,p,d,a,h),w.push(p),p=b);for(const T of w)n.disposeIntermediateTensorInfo(T);return p}const cCe={kernelName:pp,backendName:"cpu",kernelFunc:uCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dCe=Rt(fd,t=>Math.acos(t)),fCe={kernelName:fd,backendName:"cpu",kernelFunc:dCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hCe=Rt(hd,t=>Math.acosh(t)),pCe={kernelName:hd,backendName:"cpu",kernelFunc:hCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mCe(t){const{inputs:e,backend:n}=t,s=e;Fe(e,"addN");const o=s.map(a=>n.data.get(a.dataId).values),r=et(s[0].shape,s[0].dtype),i=r.values;for(let a=0;a<s.length;a++){const l=o[a];for(let u=0;u<i.length;u++)i[u]+=l[u]}return n.makeTensorInfo(r.shape,r.dtype,r.values)}const gCe={kernelName:Gp,backendName:"cpu",kernelFunc:mCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yCe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r,keepDims:i}=s;Fe(o,"all");const a=ot(r,o.shape);let l=a;const u=rn(l,o.shape.length);let d=o;u!=null&&(d=Js({inputs:{x:o},backend:n,attrs:{perm:u}}),l=yn(l.length,o.shape.length)),hs("all",l,d.shape.length);const[h,p]=Zn(d.shape,l),x=me(p),b=cs(me(h),d.dtype),w=n.data.get(d.dataId).values;for(let T=0;T<b.length;++T){const N=T*x;let I=w[N];for(let k=0;k<x;++k){const A=w[N+k];I=I&&A}b[T]=I}u!=null&&n.disposeIntermediateTensorInfo(d);const C=n.makeTensorInfo(h,d.dtype,b);if(i){const T=gn(h,a),N=Wt({inputs:{x:C},backend:n,attrs:{shape:T}});return n.disposeIntermediateTensorInfo(C),N}return C}const xCe={kernelName:Ox,backendName:"cpu",kernelFunc:yCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vCe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r,keepDims:i}=s;Fe(o,"any");const a=ot(r,o.shape);let l=a;const u=rn(l,o.shape.length);let d=o;u!=null&&(d=Js({inputs:{x:o},backend:n,attrs:{perm:u}}),l=yn(l.length,o.shape.length)),hs("any",l,d.shape.length);const[h,p]=Zn(d.shape,l),x=me(p),b=cs(me(h),d.dtype),w=n.data.get(d.dataId).values;for(let T=0;T<b.length;++T){const N=T*x;let I=w[N];for(let k=0;k<x;++k){const A=w[N+k];I=I||A}b[T]=I}u!=null&&n.disposeIntermediateTensorInfo(d);const C=n.makeTensorInfo(h,d.dtype,b);if(i){const T=gn(h,a),N=Wt({inputs:{x:C},backend:n,attrs:{shape:T}});return n.disposeIntermediateTensorInfo(C),N}return C}const bCe={kernelName:Px,backendName:"cpu",kernelFunc:vCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wCe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r}=s;Fe(o,"argMax");let i=ot(r,o.shape);const a=rn(i,o.shape.length);let l=o;const u=[];a!=null&&(l=Js({inputs:{x:o},backend:n,attrs:{perm:a}}),u.push(l),i=yn(i.length,l.shape.length)),i=[i[0]],hs("argMax",i,l.shape.length);const[d,h]=Zn(l.shape,i),p=me(d),x=cs(p,"int32"),b=me(h),w=n.data.get(l.dataId).values;for(let C=0;C<x.length;++C){const T=C*b;let N=w[T],I=0;for(let k=0;k<b;++k){const A=w[T+k];A>N&&(N=A,I=k)}x[C]=I}return u.forEach(C=>n.disposeIntermediateTensorInfo(C)),n.makeTensorInfo(d,"int32",x)}const CCe={kernelName:Hp,backendName:"cpu",kernelFunc:wCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TCe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r}=s;Fe(o,"argMin");let i=ot(r,o.shape);const a=rn(i,o.shape.length);let l=o;const u=[];a!=null&&(l=Js({inputs:{x:o},backend:n,attrs:{perm:a}}),u.push(l),i=yn(i.length,l.shape.length)),i=[i[0]],hs("argMin",i,l.shape.length);const[d,h]=Zn(l.shape,i),p=me(d),x=cs(p,"int32"),b=me(h),w=n.data.get(l.dataId).values;for(let C=0;C<x.length;++C){const T=C*b;let N=w[T],I=0;for(let k=0;k<b;++k){const A=w[T+k];A<N&&(N=A,I=k)}x[C]=I}return u.forEach(C=>n.disposeIntermediateTensorInfo(C)),n.makeTensorInfo(d,"int32",x)}const SCe={kernelName:Wp,backendName:"cpu",kernelFunc:TCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NCe=Rt(pd,t=>Math.asin(t)),ECe={kernelName:pd,backendName:"cpu",kernelFunc:NCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ICe=Rt(md,t=>Math.asinh(t)),kCe={kernelName:md,backendName:"cpu",kernelFunc:ICe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ACe=Rt(gd,t=>Math.atan(t)),RCe={kernelName:gd,backendName:"cpu",kernelFunc:ACe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Ce=vn((t,e)=>Math.atan2(t,e)),DCe=Vn(xd,$Ce),_Ce={kernelName:xd,backendName:"cpu",kernelFunc:DCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MCe=Rt(yd,t=>Math.atanh(t)),FCe={kernelName:yd,backendName:"cpu",kernelFunc:MCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RA(t,e,n,s,o,r){const i=o.strideHeight,a=o.strideWidth,l=o.dilationHeight,u=o.dilationWidth,d=o.effectiveFilterHeight,h=o.effectiveFilterWidth,p=o.padInfo.top,x=o.padInfo.left,b=r==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,w=et(o.outShape,n),C=w.values,T=o.outShape[1]*o.outShape[2]*o.outShape[3],N=o.outShape[2]*o.outShape[3],I=o.outShape[3];for(let k=0;k<o.batchSize;++k){const A=k*T,$=k*s[0];for(let M=0;M<o.inChannels;++M)for(let O=0;O<o.outHeight;++O){const F=O*i-p,P=Math.max(0,F),D=Math.min(o.inHeight,d+F),H=A+O*N;for(let Z=0;Z<o.outWidth;++Z){const ne=Z*a-x,Q=Math.max(0,ne),G=Math.min(o.inWidth,h+ne);let q=b,J=0,oe=0;for(let X=P;X<D;X+=l){const ie=$+X*s[1];for(let re=Q;re<G;re+=u){const ye=ie+re*s[2],ve=t[ye+M];r==="max"&&ve>q?q=ve:r==="avg"&&(J+=ve,oe++)}if(isNaN(q))break}const B=H+Z*I+M;C[B]=r==="avg"?J/oe:q}}}return w}function WG(t,e,n,s,o=!1,r=!1){const i=et(s.outShape,"int32"),a=s.strideHeight,l=s.strideWidth,u=s.dilationHeight,d=s.dilationWidth,h=s.effectiveFilterHeight,p=s.effectiveFilterWidth,x=s.padInfo.top,b=s.padInfo.left,w=et(e,n,t);for(let C=0;C<s.batchSize;++C)for(let T=0;T<s.inChannels;++T)for(let N=0;N<s.outHeight;++N){const I=N*a-x;let k=I;for(;k<0;)k+=u;const A=Math.min(s.inHeight,h+I);for(let $=0;$<s.outWidth;++$){const M=$*l-b;let O=M;for(;O<0;)O+=d;const F=Math.min(s.inWidth,p+M);let P=Number.NEGATIVE_INFINITY,D=-1;for(let H=k;H<A;H+=u){const Z=H-I;for(let ne=O;ne<F;ne+=d){const Q=ne-M,G=w.get(C,H,ne,T);G>P&&(P=G,o?D=r?((C*s.inHeight+H)*s.inWidth+ne)*s.inChannels+T:(H*s.inWidth+ne)*s.inChannels+T:D=Z*p+Q)}}i.set(D,C,N,$,T)}}return i}function qG(t,e,n,s,o,r){const i=o.strideDepth,a=o.strideHeight,l=o.strideWidth,u=o.dilationDepth,d=o.dilationHeight,h=o.dilationWidth,p=o.effectiveFilterDepth,x=o.effectiveFilterHeight,b=o.effectiveFilterWidth,w=o.padInfo.front,C=o.padInfo.top,T=o.padInfo.left,N=r==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,I=et(o.outShape,n),k=I.values,A=o.outShape[1]*o.outShape[2]*o.outShape[3]*o.outShape[4],$=o.outShape[2]*o.outShape[3]*o.outShape[4],M=o.outShape[3]*o.outShape[4],O=o.outShape[4];for(let F=0;F<o.batchSize;++F){const P=F*A,D=F*s[0];for(let H=0;H<o.inChannels;++H)for(let Z=0;Z<o.outDepth;++Z){const ne=Z*i-w;let Q=ne;for(;Q<0;)Q+=u;const G=Math.min(o.inDepth,p+ne),q=P+Z*$;for(let J=0;J<o.outHeight;++J){const oe=J*a-C;let B=oe;for(;B<0;)B+=d;const X=Math.min(o.inHeight,x+oe),ie=q+J*M;for(let re=0;re<o.outWidth;++re){const ye=re*l-T;let ve=ye;for(;ve<0;)ve+=h;const be=Math.min(o.inWidth,b+ye),Re=ie+re*O;let Ae=N,De=0,Ke=0;for(let dt=Q;dt<G;dt+=u){const wt=D+dt*s[1];for(let $t=B;$t<X;$t+=d){const It=wt+$t*s[2];for(let Ct=ve;Ct<be;Ct+=h){const it=It+Ct*s[3],Dt=t[it+H];if(r==="max"&&Dt>Ae?Ae=Dt:r==="avg"&&(De+=Dt,Ke++),isNaN(Ae))break}if(isNaN(Ae))break}if(isNaN(Ae))break}const Xe=Re+H;k[Xe]=r==="avg"?De/Math.max(Ke,1):Ae}}}}return I}function OCe(t,e){const n=et(e.outShape,"int32"),s=e.strideDepth,o=e.strideHeight,r=e.strideWidth,i=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,u=e.effectiveFilterDepth,d=e.effectiveFilterHeight,h=e.effectiveFilterWidth,p=e.padInfo.front,x=e.padInfo.top,b=e.padInfo.left;for(let w=0;w<e.batchSize;++w)for(let C=0;C<e.inChannels;++C)for(let T=0;T<e.outDepth;++T){const N=T*s-p;let I=N;for(;I<0;)I+=i;const k=Math.min(e.inDepth,u+N);for(let A=0;A<e.outHeight;++A){const $=A*o-x;let M=$;for(;M<0;)M+=a;const O=Math.min(e.inHeight,d+$);for(let F=0;F<e.outWidth;++F){const P=F*r-b;let D=P;for(;D<0;)D+=l;const H=Math.min(e.inWidth,h+P);let Z=Number.NEGATIVE_INFINITY,ne=-1;for(let Q=I;Q<k;Q+=i){const G=Q-N;for(let q=M;q<O;q+=a){const J=q-$;for(let oe=D;oe<H;oe+=l){const B=oe-P,X=t.get(w,Q,q,oe,C);X>=Z&&(Z=X,ne=G*d*h+J*d+B)}}}n.set(ne,w,T,A,F,C)}}}return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PCe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e;Fe(o,"avgPool");const{filterSize:r,strides:i,pad:a,dimRoundingMode:l}=s,u=1;L(fs(i,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const d=sr(o.shape,r,i,u,a,l);let h;if(d.filterWidth===1&&d.filterHeight===1&&lt(d.inShape,d.outShape))h=ri({inputs:{x:o},backend:n});else{const p=n.data.get(o.dataId).values,x=ze(o.shape),b=RA(p,o.shape,o.dtype,x,d,"avg");h=n.makeTensorInfo(d.outShape,o.dtype,b.values)}return h}const LCe={kernelName:qp,backendName:"cpu",kernelFunc:PCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VCe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{filterSize:r,strides:i,pad:a,dimRoundingMode:l,dataFormat:u}=s;Fe(o,"avgPool3d");const d=Wi(o.shape,r,i,1,a,l,u),h=n.data.get(o.dataId).values,p=qG(h,o.shape,o.dtype,ze(o.shape),d,"avg");return n.makeTensorInfo(p.shape,"float32",p.values)}const zCe={kernelName:Kp,backendName:"cpu",kernelFunc:VCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BCe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:o,input:r}=e,{filterSize:i,strides:a,pad:l,dimRoundingMode:u}=s;Fe([o,r],"avgPool3DGrad");const d=Wi(r.shape,i,a,1,l,u),h=d.strideDepth,p=d.strideHeight,x=d.strideWidth,b=d.filterDepth,w=d.filterHeight,C=d.filterWidth,T=d.dilationDepth,N=d.dilationHeight,I=d.dilationWidth,k=d.effectiveFilterDepth,A=d.effectiveFilterHeight,$=d.effectiveFilterWidth,M=k-1-d.padInfo.front,O=$-1-d.padInfo.left,F=A-1-d.padInfo.top,P=et(r.shape,"float32"),D=1/(b*w*C),H=n.bufferSync(o);for(let Z=0;Z<d.batchSize;++Z)for(let ne=0;ne<d.inChannels;++ne)for(let Q=0;Q<d.inDepth;++Q)for(let G=0;G<d.inHeight;++G)for(let q=0;q<d.inWidth;++q){const J=Q-M,oe=G-F,B=q-O;let X=0;for(let ie=0;ie<k;ie+=T){const re=(J+ie)/h;if(!(re<0||re>=d.outDepth||Math.floor(re)!==re))for(let ye=0;ye<A;ye+=N){const ve=(oe+ye)/p;if(!(ve<0||ve>=d.outHeight||Math.floor(ve)!==ve))for(let be=0;be<$;be+=I){const Re=(B+be)/x;if(Re<0||Re>=d.outWidth||Math.floor(Re)!==Re)continue;const Ae=H.get(Z,re,ve,Re,ne);X+=Ae}}}P.set(X*D,Z,Q,G,q,ne)}return n.makeTensorInfo(P.shape,P.dtype,P.values)}const UCe={kernelName:Vx,backendName:"cpu",kernelFunc:BCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GCe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:o,input:r}=e,i=r;Fe([o,r],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=s,d=sr(i.shape,a,l,1,u),h=d.strideHeight,p=d.strideWidth,x=d.filterHeight,b=d.filterWidth,w=d.dilationHeight,C=d.dilationWidth,T=d.effectiveFilterHeight,N=d.effectiveFilterWidth,I=N-1-d.padInfo.left,k=T-1-d.padInfo.top,A=et(i.shape,"float32"),$=1/(x*b),M=n.data.get(o.dataId).values,O=et(o.shape,"float32",M);for(let F=0;F<d.batchSize;++F)for(let P=0;P<d.inChannels;++P)for(let D=0;D<d.inHeight;++D)for(let H=0;H<d.inWidth;++H){const Z=D-k,ne=H-I;let Q=0;for(let G=0;G<T;G+=w){const q=(Z+G)/h;if(!(q<0||q>=d.outHeight||Math.floor(q)!==q))for(let J=0;J<N;J+=C){const oe=(ne+J)/p;if(oe<0||oe>=d.outWidth||Math.floor(oe)!==oe)continue;const B=O.get(F,q,oe,P);Q+=B}}A.set(Q*$,F,D,H,P)}return n.makeTensorInfo(A.shape,A.dtype,A.values)}const HCe={kernelName:Lx,backendName:"cpu",kernelFunc:GCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WCe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,scale:r,offset:i,mean:a,variance:l}=e;L(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),L(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),L(r==null||a.shape.length===r.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Fe([o,a,l,r,i],"batchNorm");let{varianceEpsilon:u}=s;u==null&&(u=.001);const d=n.data.get(o.dataId).values,h=n.data.get(a.dataId).values,p=n.data.get(l.dataId).values,x=r?n.data.get(r.dataId).values:new Float32Array([1]),b=i?n.data.get(i.dataId).values:new Float32Array([0]),w=new Float32Array(d.length),C=b.length,T=x.length,N=p.length,I=h.length;let k=0,A=0,$=0,M=0;for(let O=0;O<d.length;++O)w[O]=b[k++]+(d[O]-h[A++])*x[$++]/Math.sqrt(p[M++]+u),k>=C&&(k=0),A>=I&&(A=0),$>=T&&($=0),M>=N&&(M=0);return n.makeTensorInfo(o.shape,o.dtype,w)}const qCe={kernelName:am,backendName:"cpu",kernelFunc:WCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KCe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{blockShape:r,crops:i}=s;Fe([o],"batchToSpaceND");const a=r.reduce((T,N)=>T*N),l=dg(o.shape,r,a),u=fg(l.length,r.length),d=hg(o.shape,r,a),h=II(i,r.length),p=kI(d,i,r.length),x=Wt({inputs:{x:o},backend:n,attrs:{shape:l}}),b=Js({inputs:{x},backend:n,attrs:{perm:u}}),w=Wt({inputs:{x:b},backend:n,attrs:{shape:d}}),C=fu({inputs:{x:w},backend:n,attrs:{begin:h,size:p}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(w),C}const XCe={kernelName:Yp,backendName:"cpu",kernelFunc:KCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YCe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,weights:r}=e,{size:i}=s,a=n.data.get(o.dataId).values,l=n.data.get(r.dataId).values,u=NA(a,l,r.dtype,r.shape,i);return n.makeTensorInfo([i],r.dtype,u)}const JCe={kernelName:zx,backendName:"cpu",kernelFunc:YCe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jCe(t){const{inputs:e,backend:n}=t,{s0:s,s1:o}=e,r=n.data.get(s.dataId).values,i=n.data.get(o.dataId).values,a=Ze(Array.from(r),Array.from(i));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const ZCe={kernelName:Bx,backendName:"cpu",kernelFunc:jCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QCe=Rt(wd,(t,e)=>{const n=e;return t>n.clipValueMax?n.clipValueMax:t<n.clipValueMin?n.clipValueMin:t}),eTe={kernelName:wd,backendName:"cpu",kernelFunc:QCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tTe=t=>{const{x:e}=t.inputs,n=t.backend,s=new Float32Array(me(e.shape)),o=n.data.get(e.dataId),r=o.complexTensorInfos.real,i=o.complexTensorInfos.imag,a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values;for(let u=0;u<a.length;u++){const d=a[u],h=l[u];s[u]=Math.hypot(d,h)}return n.makeOutput(s,e.shape,"float32")},nTe={kernelName:jp,backendName:"cpu",kernelFunc:tTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function td(t){const{inputs:e,backend:n}=t,{input:s}=e,o=n.data.get(s.dataId).complexTensorInfos.imag,r=n.data.get(o.dataId).values;return n.makeTensorInfo(o.shape,o.dtype,r)}const sTe={kernelName:av,backendName:"cpu",kernelFunc:td};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nd(t){const{inputs:e,backend:n,attrs:s}=t,{axis:o}=s,r=ot(o,e[0].shape)[0],i=e.map(w=>w.shape);SI(i,r);let a=Zr(e.map(w=>w.shape),r);if(me(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(w=>me(w.shape)>0);if(l.length===1)return ri({inputs:{x:l[0]},backend:n});if(l[0].dtype==="complex64"){const w=l.map(k=>du({inputs:{input:k},backend:n})),C=l.map(k=>td({inputs:{input:k},backend:n})),T=nd({inputs:w,backend:n,attrs:{axis:r}}),N=nd({inputs:C,backend:n,attrs:{axis:r}}),I=ao({inputs:{real:T,imag:N},backend:n});return w.forEach(k=>n.disposeIntermediateTensorInfo(k)),C.forEach(k=>n.disposeIntermediateTensorInfo(k)),n.disposeIntermediateTensorInfo(T),n.disposeIntermediateTensorInfo(N),I}const u=l.map(w=>{const T=[-1,me(w.shape.slice(r))];return Wt({inputs:{x:w},backend:n,attrs:{shape:T}})}),d=u.map(w=>({vals:n.data.get(w.dataId).values,shape:w.shape}));a=Zr(u.map(w=>w.shape),1);const h=u[0].shape[0]===1,p=Y4(d,a,e[0].dtype,h),x=Zr(l.map(w=>w.shape),r),b=n.makeTensorInfo(x,e[0].dtype,p);return u.forEach(w=>n.disposeIntermediateTensorInfo(w)),b}const oTe={kernelName:Zp,backendName:"cpu",kernelFunc:nd};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KG(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,filter:r}=e,{strides:i,pad:a,dataFormat:l,dilations:u,dimRoundingMode:d}=s;Fe([o,r],"conv2d");const h=qi(l),p=jn(o.shape,r.shape,i,u,a,d,!1,h),x=p.filterHeight,b=p.filterWidth,w=p.dilationHeight,C=p.dilationWidth,T=p.padInfo.left,N=p.padInfo.top,I=p.dataFormat==="channelsLast",k=new In(p.outShape,o.dtype),A=ze(o.shape),$=ze(r.shape),M=A[0],O=I?A[1]:A[2],F=I?A[2]:1,P=I?1:A[1],D=k.strides[0],H=I?k.strides[1]:k.strides[2],Z=I?k.strides[2]:1,ne=I?1:k.strides[1],Q=n.data.get(o.dataId).values,G=n.data.get(r.dataId).values,q=k.values;for(let J=0;J<p.batchSize;++J){const oe=J*M,B=J*D;for(let X=0;X<p.outHeight;++X){const ie=B+X*H,re=X*p.strideHeight-N;for(let ye=0;ye<x;++ye){const ve=re+ye*w;if(ve<0||ve>=p.inHeight)continue;const be=ye*$[0],Re=oe+ve*O;for(let Ae=0;Ae<p.outWidth;++Ae){const De=ie+Ae*Z,Ke=Ae*p.strideWidth-T;for(let Xe=0;Xe<b;++Xe){const dt=Ke+Xe*C;if(dt<0||dt>=p.inWidth)continue;const wt=be+Xe*$[1],$t=Re+dt*F;let It=wt;for(let Ct=0;Ct<p.inChannels;++Ct){const it=Q[$t+Ct*P];for(let Dt=0;Dt<p.outChannels;++Dt)q[De+Dt*ne]+=it*G[It+Dt];It+=p.outChannels}}}}}}return n.makeTensorInfo(k.shape,k.dtype,q)}const rTe={kernelName:Qp,backendName:"cpu",kernelFunc:KG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iTe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,dy:r}=e,{strides:i,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:d}=s;Fe([o,r],"conv2dBackpropFilter");const h=qi(l),p=jn(o.shape,d,i,1,a,u,!1,h),{strideHeight:x,strideWidth:b,filterHeight:w,filterWidth:C}=p,T=p.dataFormat==="channelsLast",N=new In(p.filterShape,"float32"),I=p.padInfo.left,k=p.padInfo.top,A=n.data.get(o.dataId).values,$=n.data.get(r.dataId).values,M=new In(o.shape,o.dtype,A),O=new In(r.shape,r.dtype,$);for(let F=0;F<w;++F){const P=Math.max(0,Math.ceil((k-F)/x)),D=Math.min(p.outHeight,(p.inHeight+k-F)/x);for(let H=0;H<C;++H){const Z=Math.max(0,Math.ceil((I-H)/b)),ne=Math.min(p.outWidth,(p.inWidth+I-H)/b);for(let Q=0;Q<p.inChannels;++Q)for(let G=0;G<p.outChannels;++G){let q=0;for(let J=0;J<p.batchSize;++J)for(let oe=P;oe<D;++oe){const B=F+oe*x-k;for(let X=Z;X<ne;++X){const ie=H+X*b-I;T?q+=M.get(J,B,ie,Q)*O.get(J,oe,X,G):q+=M.get(J,Q,B,ie)*O.get(J,G,oe,X)}}N.set(q,F,H,Q,G)}}}return n.makeTensorInfo(N.shape,N.dtype,N.values)}const aTe={kernelName:Gx,backendName:"cpu",kernelFunc:iTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lTe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:o,filter:r}=e,{inputShape:i,strides:a,pad:l,dataFormat:u,dimRoundingMode:d}=s;Fe([o,r],"conv2dBackpropInput");const h=ze(r.shape),p=ze(o.shape);let x=qi(u);const b=jn(i,r.shape,a,1,l,d,!1,x),w=new In(b.inShape,"float32"),C=w.values,T=n.data.get(o.dataId).values,N=n.data.get(r.dataId).values,[I,k,A]=h,{batchSize:$,filterHeight:M,filterWidth:O,inChannels:F,inHeight:P,inWidth:D,outChannels:H,outHeight:Z,outWidth:ne,strideHeight:Q,strideWidth:G}=b;x=b.dataFormat;const q=M-1-b.padInfo.top,J=O-1-b.padInfo.left,oe=x==="channelsLast",B=w.strides[0],X=oe?w.strides[1]:w.strides[2],ie=oe?w.strides[2]:1,re=oe?1:w.strides[1],ye=p[0],ve=oe?p[1]:p[2],be=oe?p[2]:1,Re=oe?1:p[1];for(let Ae=0;Ae<$;++Ae)for(let De=0;De<F;++De)for(let Ke=0;Ke<P;++Ke){const Xe=Ke-q,dt=Math.max(0,Math.ceil(Xe/Q)),wt=Math.min(Z,(M+Xe)/Q);for(let $t=0;$t<D;++$t){const It=$t-J,Ct=Math.max(0,Math.ceil(It/G)),it=Math.min(ne,(O+It)/G);let Dt=0;for(let an=dt;an<wt;++an){const Vs=an*Q-Xe;for(let Qn=Ct;Qn<it;++Qn){const go=Qn*G-It,Ts=ye*Ae+ve*an+be*Qn,yo=I*(M-1-Vs)+k*(O-1-go)+A*De;for(let Ss=0;Ss<H;++Ss){const jt=T[Ts+Re*Ss],Rn=N[yo+Ss];Dt+=jt*Rn}}}const js=B*Ae+X*Ke+ie*$t+re*De;C[js]=Dt}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}const uTe={kernelName:em,backendName:"cpu",kernelFunc:lTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cTe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,filter:r}=e,{strides:i,pad:a,dilations:l}=s;Fe([o,r],"conv3d");const u=tl(o.shape,r.shape,i,l,a),{filterDepth:d,filterHeight:h,filterWidth:p,dilationDepth:x,dilationHeight:b,dilationWidth:w,padInfo:C}=u,T=C.front,N=C.left,I=C.top,k=new In(u.outShape,o.dtype),A=n.data.get(o.dataId).values,$=n.data.get(r.dataId).values,M=k.values,O=ze(o.shape),F=ze(r.shape);for(let P=0;P<u.batchSize;++P){const D=P*O[0],H=P*k.strides[0];for(let Z=0;Z<u.outDepth;++Z){const ne=H+Z*k.strides[1],Q=Z*u.strideDepth-T;for(let G=0;G<d;++G){const q=Q+G*x;if(q<0||q>=u.inDepth)continue;const J=G*F[0],oe=D+q*O[1];for(let B=0;B<u.outHeight;++B){const X=ne+B*k.strides[2],ie=B*u.strideHeight-I;for(let re=0;re<h;++re){const ye=ie+re*b;if(ye<0||ye>=u.inHeight)continue;const ve=J+re*F[1],be=oe+ye*O[2];for(let Re=0;Re<u.outWidth;++Re){const Ae=X+Re*u.outChannels,De=Re*u.strideWidth-N;for(let Ke=0;Ke<p;++Ke){const Xe=De+Ke*w;if(Xe<0||Xe>=u.inWidth)continue;const dt=ve+Ke*F[2],wt=be+Xe*u.inChannels;let $t=dt;for(let It=0;It<u.inChannels;++It){const Ct=A[wt+It];for(let it=0;it<u.outChannels;++it)M[Ae+it]+=Ct*$[$t+it];$t+=u.outChannels}}}}}}}}return n.makeTensorInfo(k.shape,k.dtype,k.values)}const dTe={kernelName:tm,backendName:"cpu",kernelFunc:cTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fTe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,dy:r}=e,{strides:i,pad:a,filterShape:l}=s;Fe([o,r],"conv3dBackpropFilterV2");const u=ze(o.shape),d=ze(r.shape),h=tl(o.shape,l,i,1,a),p=h.strideDepth,x=h.strideHeight,b=h.strideWidth,w=h.filterDepth,C=h.filterHeight,T=h.filterWidth,N=new In(h.filterShape,"float32"),I=N.values,[k,A,$,M]=N.strides,O=n.data.get(r.dataId).values,[F,P,D,H]=d,Z=n.data.get(o.dataId).values,[ne,Q,G,q]=u,J=h.padInfo.front,oe=h.padInfo.left,B=h.padInfo.top;for(let X=0;X<w;++X){const ie=Math.max(0,Math.ceil((J-X)/p)),re=Math.min(h.outDepth,(h.inDepth+J-X)/p),ye=X*k;for(let ve=0;ve<C;++ve){const be=Math.max(0,Math.ceil((B-ve)/x)),Re=Math.min(h.outHeight,(h.inHeight+B-ve)/x),Ae=ve*A+ye;for(let De=0;De<T;++De){const Ke=Math.max(0,Math.ceil((oe-De)/b)),Xe=Math.min(h.outWidth,(h.inWidth+oe-De)/b),dt=De*$+Ae;for(let wt=0;wt<h.inChannels;++wt){const $t=wt*M+dt;for(let It=0;It<h.outChannels;++It){let Ct=0;for(let it=0;it<h.batchSize;++it){const Dt=it*ne,js=it*F;for(let an=ie;an<re;++an){const Qn=(X+an*p-J)*Q+Dt,go=an*P+js;for(let Ts=be;Ts<Re;++Ts){const Ss=(ve+Ts*x-B)*G+Qn,jt=Ts*D+go;for(let Rn=Ke;Rn<Xe;++Rn){const ul=(De+Rn*b-oe)*q+Ss,cl=Rn*H+jt;Ct+=Z[ul+wt]*O[cl+It]}}}}I[$t+It]=Ct}}}}}return n.makeTensorInfo(N.shape,N.dtype,N.values)}const hTe={kernelName:Hx,backendName:"cpu",kernelFunc:fTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pTe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:o,filter:r}=e,{pad:i,strides:a,inputShape:l}=s;Fe([o],"conv3dBackpropInputV2");const u=ze(o.shape),d=ze(r.shape),h=tl(l,r.shape,a,1,i),p=new In(h.inShape,"float32"),x=p.values,[b,w,C,T]=p.strides,N=n.data.get(o.dataId).values,[I,k,A,$]=u,M=n.data.get(r.dataId).values,[O,F,P,D]=d,{batchSize:H,filterDepth:Z,filterHeight:ne,filterWidth:Q,inChannels:G,inDepth:q,inHeight:J,inWidth:oe,outChannels:B,outDepth:X,outHeight:ie,outWidth:re,strideDepth:ye,strideHeight:ve,strideWidth:be}=h,Re=Z-1-h.padInfo.front,Ae=ne-1-h.padInfo.top,De=Q-1-h.padInfo.left;for(let Ke=0;Ke<H;++Ke)for(let Xe=0;Xe<G;++Xe)for(let dt=0;dt<q;++dt){const wt=dt-Re,$t=Math.max(0,Math.ceil(wt/ye)),It=Math.min(X,(Z+wt)/ye);for(let Ct=0;Ct<J;++Ct){const it=Ct-Ae,Dt=Math.max(0,Math.ceil(it/ve)),js=Math.min(ie,(ne+it)/ve);for(let an=0;an<oe;++an){const Vs=an-De,Qn=Math.max(0,Math.ceil(Vs/be)),go=Math.min(re,(Q+Vs)/be);let Ts=0;for(let yo=$t;yo<It;++yo){const Ss=yo*ye-wt;for(let jt=Dt;jt<js;++jt){const Rn=jt*ve-it;for(let ln=Qn;ln<go;++ln){const ul=ln*be-Vs,cl=I*Ke+k*yo+A*jt+$*ln,Ee=O*(Z-1-Ss)+F*(ne-1-Rn)+P*(Q-1-ul)+D*Xe;for(let Ve=0;Ve<B;++Ve){const ft=N[cl+Ve],Tt=M[Ee+Ve];Ts+=ft*Tt}}}}x[b*Ke+w*dt+C*Ct+T*an+Xe]=Ts}}}return n.makeTensorInfo(p.shape,p.dtype,p.values)}const mTe={kernelName:Wx,backendName:"cpu",kernelFunc:pTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gTe=Rt(Cd,t=>Math.cos(t)),yTe={kernelName:Cd,backendName:"cpu",kernelFunc:gTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xTe=Rt(Td,t=>Math.cosh(t)),vTe={kernelName:Td,backendName:"cpu",kernelFunc:xTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bTe(t){const{inputs:e,backend:n,attrs:s}=t,{image:o,boxes:r,boxInd:i}=e,{cropSize:a,method:l,extrapolationValue:u}=s,[d,h,p,x]=o.shape,b=r.shape[0],[w,C]=a,T=et([b,w,C,x],"float32"),N=n.data.get(r.dataId).values,I=n.data.get(i.dataId).values,k=n.data.get(o.dataId).values,A=ze(o.shape),$=ze(T.shape);for(let M=0;M<b;M++){const O=M*4,F=N[O],P=N[O+1],D=N[O+2],H=N[O+3],Z=I[M];if(Z>=d)continue;const ne=w>1?(D-F)*(h-1)/(w-1):0,Q=C>1?(H-P)*(p-1)/(C-1):0;for(let G=0;G<w;G++){const q=w>1?F*(h-1)+G*ne:.5*(F+D)*(h-1);if(q<0||q>h-1){for(let J=0;J<C;J++)for(let oe=0;oe<x;oe++){const B=oe+J*$[2]+G*$[1]+M*$[0];T.values[B]=u}continue}if(l==="bilinear"){const J=Math.floor(q),oe=Math.ceil(q),B=q-J;for(let X=0;X<C;X++){const ie=C>1?P*(p-1)+X*Q:.5*(P+H)*(p-1);if(ie<0||ie>p-1){for(let be=0;be<x;be++){const Re=be+X*$[2]+G*$[1]+M*$[0];T.values[Re]=u}continue}const re=Math.floor(ie),ye=Math.ceil(ie),ve=ie-re;for(let be=0;be<x;be++){let Re=be+re*A[2]+J*A[1]+Z*A[0];const Ae=k[Re];Re=be+ye*A[2]+J*A[1]+Z*A[0];const De=k[Re];Re=be+re*A[2]+oe*A[1]+Z*A[0];const Ke=k[Re];Re=be+ye*A[2]+oe*A[1]+Z*A[0];const Xe=k[Re],dt=Ae+(De-Ae)*ve,wt=Ke+(Xe-Ke)*ve;Re=be+X*$[2]+G*$[1]+M*$[0],T.values[Re]=dt+(wt-dt)*B}}}else for(let J=0;J<C;++J){const oe=C>1?P*(p-1)+J*Q:.5*(P+H)*(p-1);if(oe<0||oe>p-1){for(let ie=0;ie<x;ie++){const re=ie+J*$[2]+G*$[1]+M*$[0];T.values[re]=u}continue}const B=Math.round(oe),X=Math.round(q);for(let ie=0;ie<x;ie++){const re=ie+B*A[2]+X*A[1]+Z*A[0],ye=ie+J*$[2]+G*$[1]+M*$[0];T.values[ye]=k[re]}}}}return n.makeTensorInfo(T.shape,T.dtype,T.values)}const wTe={kernelName:Kx,backendName:"cpu",kernelFunc:bTe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CTe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r,exclusive:i,reverse:a}=s;Fe(o,"cumprod");const l=rn([r],o.shape.length);let u=o;l!=null&&(u=Js({inputs:{x:o},backend:n,attrs:{perm:l}}));const d=yn(1,o.shape.length)[0];if(d!==u.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${d}`);const h=Ws(u.dtype,"int32"),p=Fx(me(u.shape),h),x=n.data.get(u.dataId).values,b=u.shape[u.shape.length-1],w=a?(T,N)=>T+b-N-1:(T,N)=>T+N;for(let T=0;T<x.length;T+=b)for(let N=0;N<b;N++){const I=w(T,N);if(N===0)p[I]=i?1:x[I];else{const k=w(T,N-1);p[I]=i?x[k]*p[k]:x[I]*p[k]}}const C=n.makeTensorInfo(u.shape,h,p);if(l!=null){const T=nl(l),N=Js({inputs:{x:C},backend:n,attrs:{perm:T}});return n.disposeIntermediateTensorInfo(C),n.disposeIntermediateTensorInfo(u),N}return C}const TTe={kernelName:qx,backendName:"cpu",kernelFunc:CTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function STe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r,exclusive:i,reverse:a}=s;Fe(o,"cumsum");const l=rn([r],o.shape.length);let u=o;l!=null&&(u=Js({inputs:{x:o},backend:n,attrs:{perm:l}}));const d=yn(1,o.shape.length)[0];if(d!==u.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${d}`);const h=Ws(u.dtype,"int32"),p=cs(me(u.shape),h),x=n.data.get(u.dataId).values,b=u.shape[u.shape.length-1],w=a?(T,N)=>T+b-N-1:(T,N)=>T+N;for(let T=0;T<x.length;T+=b)for(let N=0;N<b;N++){const I=w(T,N);if(N===0)p[I]=i?0:x[I];else{const k=w(T,N-1);p[I]=i?x[k]+p[k]:x[I]+p[k]}}const C=n.makeTensorInfo(u.shape,h,p);if(l!=null){const T=nl(l),N=Js({inputs:{x:C},backend:n,attrs:{perm:T}});return n.disposeIntermediateTensorInfo(C),n.disposeIntermediateTensorInfo(u),N}return C}const NTe={kernelName:nm,backendName:"cpu",kernelFunc:STe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ETe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,weights:r}=e,{size:i,binaryOutput:a}=s;if(o.shape.length===1){const l=n.data.get(o.dataId).values,u=n.data.get(r.dataId).values,d=NA(l,u,r.dtype,r.shape,i);return n.makeTensorInfo([i],r.dtype,d)}else if(o.shape.length===2){const l=n.bufferSync(o),u=n.bufferSync(r),d=q4(l,u,i,a);return n.makeTensorInfo(d.shape,r.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${o.shape.length}.`)}const ITe={kernelName:Xx,backendName:"cpu",kernelFunc:ETe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kTe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{blockSize:r,dataFormat:i}=s;L(i==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${i}`);const a=o.shape[0],l=o.shape[1],u=o.shape[2],d=o.shape[3],h=l*r,p=u*r,x=d/(r*r),b=n.data.get(o.dataId).values,w=new Float32Array(a*h*p*x);let C=0;for(let T=0;T<a;++T)for(let N=0;N<h;++N){const I=Math.floor(N/r),k=N%r;for(let A=0;A<p;++A){const $=Math.floor(A/r),M=A%r,O=(k*r+M)*x;for(let F=0;F<x;++F){const D=F+O+d*($+u*(I+l*T));w[C++]=b[D]}}}return n.makeTensorInfo([a,h,p,x],o.dtype,w)}const ATe={kernelName:Yx,backendName:"cpu",kernelFunc:kTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XG(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,filter:r}=e,{strides:i,pad:a,dilations:l,dimRoundingMode:u}=s;Fe([o,r],"depthwiseConv2DNative");const d=ze(o.shape),h=ze(r.shape);let p=l;p==null&&(p=[1,1]),L(fs(i,p),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${p}'`);const x=jn(o.shape,r.shape,i,p,a,u,!0),{filterHeight:b,filterWidth:w,dilationHeight:C,dilationWidth:T,padInfo:N}=x,I=N.left,k=N.top,A=x.outChannels/x.inChannels,$=new In(x.outShape,o.dtype),M=n.data.get(o.dataId).values,O=n.data.get(r.dataId).values,F=$.values;for(let P=0;P<x.batchSize;++P){const D=P*d[0],H=P*$.strides[0];for(let Z=0;Z<x.outHeight;++Z){const ne=H+Z*$.strides[1],Q=Z*x.strideHeight-k;for(let G=0;G<b;++G){const q=Q+G*C;if(q<0||q>=x.inHeight)continue;const J=G*h[0],oe=D+q*d[1];for(let B=0;B<x.outWidth;++B){const X=ne+B*$.strides[2],ie=B*x.strideWidth-I;for(let re=0;re<w;++re){const ye=ie+re*T;if(ye<0||ye>=x.inWidth)continue;const ve=J+re*h[1],be=oe+ye*x.inChannels;let Re=X,Ae=ve;for(let De=0;De<x.inChannels;++De){const Ke=M[be+De];for(let Xe=0;Xe<A;++Xe)F[Re+Xe]+=Ke*O[Ae+Xe];Re+=A,Ae+=A}}}}}}return n.makeTensorInfo($.shape,$.dtype,$.values)}const RTe={kernelName:sm,backendName:"cpu",kernelFunc:XG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Te(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,dy:r}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:u,filterShape:d}=s;Fe([o,r],"depthwiseConv2dNativeBackpropFilter");const h=jn(o.shape,d,i,a,l,u,!0),{strideHeight:p,strideWidth:x,filterHeight:b,filterWidth:w}=h,C=new In(h.filterShape,"float32"),T=h.padInfo.left,N=h.padInfo.top,I=h.outChannels/h.inChannels,k=n.data.get(o.dataId).values,A=new In(o.shape,o.dtype,k),$=n.data.get(r.dataId).values,M=new In(r.shape,r.dtype,$);for(let O=0;O<b;++O){const F=Math.max(0,Math.ceil((N-O)/p)),P=Math.min(h.outHeight,(h.inHeight+N-O)/p);for(let D=0;D<w;++D){const H=Math.max(0,Math.ceil((T-D)/x)),Z=Math.min(h.outWidth,(h.inWidth+T-D)/x);for(let ne=0;ne<h.outChannels;++ne){const Q=Math.trunc(ne/I),G=ne%I;let q=0;for(let J=0;J<h.batchSize;++J)for(let oe=F;oe<P;++oe){const B=O+oe*p-N;for(let X=H;X<Z;++X){const ie=D+X*x-T;q+=A.get(J,B,ie,Q)*M.get(J,oe,X,ne)}}C.set(q,O,D,Q,G)}}}return n.makeTensorInfo(C.shape,C.dtype,C.values)}const DTe={kernelName:Jx,backendName:"cpu",kernelFunc:$Te};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Te(t){const{inputs:e,backend:n,attrs:s}=t,{dy:o,filter:r}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:u,inputShape:d}=s;Fe([o,r],"depthwiseConv2DNativeBackpropInput");const h=ze(o.shape),p=ze(r.shape),x=jn(d,r.shape,i,a,l,u,!0),b=new In(x.inShape,"float32"),w=b.values,[C,T,N]=b.strides,I=n.data.get(o.dataId).values,[k,A,$]=h,M=n.data.get(r.dataId).values,[O,F,P]=p,{batchSize:D,filterHeight:H,filterWidth:Z,inChannels:ne,inHeight:Q,inWidth:G,outChannels:q,outHeight:J,outWidth:oe,strideHeight:B,strideWidth:X}=x,ie=H-1-x.padInfo.top,re=Z-1-x.padInfo.left,ye=q/ne;for(let ve=0;ve<D;++ve)for(let be=0;be<ne;++be)for(let Re=0;Re<Q;++Re){const Ae=Re-ie,De=Math.max(0,Math.ceil(Ae/B)),Ke=Math.min(J,(H+Ae)/B);for(let Xe=0;Xe<G;++Xe){const dt=Xe-re,wt=Math.max(0,Math.ceil(dt/X)),$t=Math.min(oe,(Z+dt)/X);let It=0;for(let Ct=De;Ct<Ke;++Ct){const it=Ct*B-Ae;for(let Dt=wt;Dt<$t;++Dt){const js=Dt*X-dt,an=k*ve+A*Ct+$*Dt,Vs=O*(H-1-it)+F*(Z-1-js)+P*be;for(let Qn=0;Qn<ye;++Qn){const go=be*ye+Qn,Ts=I[an+go],yo=M[Vs+Qn];It+=Ts*yo}}}w[C*ve+T*Re+N*Xe+be]=It}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}const MTe={kernelName:jx,backendName:"cpu",kernelFunc:_Te};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FTe(t){const{inputs:e,backend:n}=t,{x:s}=e,o=me(s.shape),r=n.data.get(s.dataId).values,i=et([o,o],s.dtype),a=i.values;for(let u=0;u<r.length;u++)a[u*o+u]=r[u];const l=[...s.shape,...s.shape];return n.makeTensorInfo(l,i.dtype,i.values)}const OTe={kernelName:Zx,backendName:"cpu",kernelFunc:FTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PTe={kernelName:om,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:o}=t,{strides:r,pad:i,dilations:a}=n,l=e,u=l.data.get(s.dataId).values,d=s.shape.length,h=l.data.get(o.dataId).values,p=o.shape.length,{batchSize:x,inHeight:b,inWidth:w,inChannels:C,outHeight:T,outWidth:N,padInfo:I,strideHeight:k,strideWidth:A,filterHeight:$,filterWidth:M,dilationHeight:O,dilationWidth:F,outShape:P}=Km(s.shape,o.shape,r,i,"NHWC",a),D=me(P),H=P.length,Z=dn(s.dtype,D);for(let Q=0;Q<x;++Q)for(let G=0;G<T;++G){const q=G*k-I.top;for(let J=0;J<N;++J){const oe=J*A-I.left;for(let B=0;B<C;++B){let X=Number.MIN_SAFE_INTEGER;for(let re=0;re<$;++re){const ye=q+re*O;if(ye>=0&&ye<b)for(let ve=0;ve<M;++ve){const be=oe+ve*F;if(be>=0&&be<w){const Re=vr([Q,ye,be,B],d,ze(s.shape)),Ae=vr([re,ve,B],p,ze(o.shape)),De=u[Re]+h[Ae];De>X&&(X=De)}}}const ie=vr([Q,G,J,B],H,ze(P));Z[ie]=X}}}return{dataId:l.write(Qa(Z,s.dtype),P,s.dtype),shape:P,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LTe={kernelName:X0,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:o,dy:r}=t,{strides:i,pad:a,dilations:l}=n,u=e,d=$o(s.shape,u.data.get(s.dataId).values),h=$o(o.shape,u.data.get(o.dataId).values),{batchSize:p,inHeight:x,inWidth:b,inChannels:w,outHeight:C,outWidth:T,padInfo:N,strideHeight:I,strideWidth:k,filterHeight:A,filterWidth:$,dilationHeight:M,dilationWidth:O,outShape:F}=Km(s.shape,o.shape,i,a,"NHWC",l);L(r.rank===F.length,()=>`Error in ${X0}, dy must have the same rank as output ${F.length}, but got ${r.rank}`);const P=$o(F,u.data.get(r.dataId).values),D=WN(o.shape,o.dtype);for(let Z=0;Z<p;++Z)for(let ne=0;ne<C;++ne){const Q=ne*I-N.top;for(let G=0;G<T;++G){const q=G*k-N.left;for(let J=0;J<w;++J){let oe=Number.MIN_SAFE_INTEGER,B=0,X=0;for(let ie=0;ie<A;++ie){const re=Q+ie*M;if(re>=0&&re<x)for(let ye=0;ye<$;++ye){const ve=q+ye*O;if(ve>=0&&ve<b){const be=d[Z][re][ve][J]+h[ie][ye][J];be>oe&&(oe=be,B=ie,X=ye)}}}D[B][X][J]+=P[Z][ne][G][J]}}}return{dataId:u.write(Qa(D,s.dtype),o.shape,o.dtype),shape:o.shape,dtype:o.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VTe={kernelName:K0,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:o,dy:r}=t,{strides:i,pad:a,dilations:l}=n,u=e,d=$o(s.shape,u.data.get(s.dataId).values),h=$o(o.shape,u.data.get(o.dataId).values),{batchSize:p,inHeight:x,inWidth:b,inChannels:w,outHeight:C,outWidth:T,padInfo:N,strideHeight:I,strideWidth:k,filterHeight:A,filterWidth:$,dilationHeight:M,dilationWidth:O,outShape:F}=Km(s.shape,o.shape,i,a,"NHWC",l);L(r.rank===F.length,()=>`Error in ${K0}, dy must have the same rank as output ${F.length}, but got ${r.rank}`);const P=$o(F,u.data.get(r.dataId).values),D=WN(s.shape,s.dtype);for(let Z=0;Z<p;++Z)for(let ne=0;ne<C;++ne){const Q=ne*I-N.top;for(let G=0;G<T;++G){const q=G*k-N.left;for(let J=0;J<w;++J){let oe=Number.MIN_SAFE_INTEGER,B=Q<0?0:Q,X=q<0?0:q;for(let ie=0;ie<A;++ie){const re=Q+ie*M;if(re>=0&&re<x)for(let ye=0;ye<$;++ye){const ve=q+ye*O;if(ve>=0&&ve<b){const be=d[Z][re][ve][J]+h[ie][ye][J];be>oe&&(oe=be,B=re,X=ve)}}}D[Z][B][X][J]+=P[Z][ne][G][J]}}}return{dataId:u.write(Qa(D,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zTe(t){const{inputs:e,backend:n,attrs:s}=t,{image:o}=e,{canvas:r,options:i}=s,{contextOptions:a,imageOptions:l}=i||{},u=(l==null?void 0:l.alpha)||1,d=(a==null?void 0:a.contextType)||"2d";if(d!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const h=r.getContext(d,(a==null?void 0:a.contextAttributes)||{});if(h==null)throw new Error(`Could not get the context with ${d} type.`);const[p,x]=o.shape.slice(0,2),b=o.shape.length===2?1:o.shape[2],w=n.data.get(o.dataId).values,C=o.dtype==="float32"?255:1,T=new Uint8ClampedArray(x*p*4);for(let I=0;I<p*x;++I){const k=[0,0,0,255*u];for(let $=0;$<b;$++){const M=w[I*b+$];if(o.dtype==="float32"){if(M<0||M>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${M}.`)}else if(o.dtype==="int32"&&(M<0||M>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${M}.`);b===1?(k[0]=M*C,k[1]=M*C,k[2]=M*C):k[$]=M*C}const A=I*4;T[A+0]=Math.round(k[0]),T[A+1]=Math.round(k[1]),T[A+2]=Math.round(k[2]),T[A+3]=Math.round(k[3])}r.width=x,r.height=p;const N=new ImageData(T,x,p);return h.putImageData(N,0,0),o}const BTe={kernelName:Qx,backendName:"cpu",kernelFunc:zTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sg(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r,keepDims:i}=s;Fe(o,"sum");let a;o.dtype==="bool"?a=Ja({inputs:{x:o},backend:n,attrs:{dtype:"int32"}}):a=ri({inputs:{x:o},backend:n});const l=a.shape.length,u=ot(r,a.shape),d=rn(u,l);let h=u,p=a;d!=null&&(p=Js({inputs:{x:a},backend:n,attrs:{perm:d}}),h=yn(h.length,l)),hs("sum",h,p.shape.length);const[x,b]=Zn(p.shape,h),w=Ws(p.dtype,"int32");let C=fx(n,x,w);const T=me(b),N=n.data.get(C.dataId).values,I=n.data.get(p.dataId).values;for(let k=0;k<N.length;++k){const A=k*T;let $=0;for(let M=0;M<T;++M)$+=I[A+M];N[k]=$}if(i){const k=gn(C.shape,u),A=C;C=Wt({inputs:{x:C},backend:n,attrs:{shape:k}}),n.disposeIntermediateTensorInfo(A)}return n.disposeIntermediateTensorInfo(a),d!=null&&n.disposeIntermediateTensorInfo(p),C}const UTe={kernelName:Pm,backendName:"cpu",kernelFunc:Sg};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GTe(t){const{inputs:e,backend:n,attrs:s}=t,{equation:o}=s,r=e,{allDims:i,summedDims:a,idDims:l}=OI(o,r.length);LI(i.length,l,r);const{path:u,steps:d}=VI(a,l),h=d.length;let p=null,x=i.length;const b=[];for(let w=0;w<h;++w){for(const C of d[w]){const{permutationIndices:T,expandDims:N}=PI(x,l[C]);let I;zI(T)?I=r[C]:(I=Js({inputs:{x:r[C]},backend:n,attrs:{perm:T}}),b.push(I));const k=I.shape.slice();for(let A=0;A<N.length;++A)k.splice(N[A],0,1);lt(I.shape,k)||(I=Wt({inputs:{x:I},backend:n,attrs:{shape:k}}),b.push(I)),p===null?p=I:(p=Zb({inputs:{a:I,b:p},backend:n}),b.push(p))}w<h-1&&(u[w]>=0&&(p=Sg({inputs:{x:p},backend:n,attrs:{axis:u[w]-(i.length-x),keepDims:!1}}),b.push(p)),x--)}for(const w of b)w!==p&&n.disposeIntermediateTensorInfo(w);return p}const HTe={kernelName:ev,backendName:"cpu",kernelFunc:GTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WTe(t){const{inputs:e,backend:n}=t,{dy:s,y:o}=e;Fe([s,o],"eluGrad");const r=new Float32Array(me(o.shape)),i=n.data.get(o.dataId).values,a=n.data.get(s.dataId).values;for(let l=0;l<i.length;++l){const u=i[l];u>=0?r[l]=a[l]:r[l]=a[l]*(u+1)}return n.makeTensorInfo(o.shape,"float32",r)}const qTe={kernelName:tv,backendName:"cpu",kernelFunc:WTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KTe=AI,XTe=RI,YTe=$I,JTe=DI,jTe=_I,ZTe=MI,QTe=Rt(Ed,t=>{const e=Math.sign(t),n=Math.abs(t),s=1/(1+KTe*n);return e*(1-((((ZTe*s+jTe)*s+JTe)*s+YTe)*s+XTe)*s*Math.exp(-n*n))}),eSe={kernelName:Ed,backendName:"cpu",kernelFunc:QTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mx(t){const{inputs:e,backend:n,attrs:s}=t,{input:o}=e,{dim:r}=s,i=o.shape.length,a=o.shape.slice();let l=r;return r<0&&(L(-(i+1)<=r,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),l=i+r+1),a.splice(l,0,1),Wt({inputs:{x:o},backend:n,attrs:{shape:a}})}const tSe={kernelName:im,backendName:"cpu",kernelFunc:mx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nSe=vn((t,e)=>t/e),$A=Vn(Sd,nSe),MS={kernelName:Sd,backendName:"cpu",kernelFunc:$A};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YG(t,e,n){const s=t.shape,o=s[0],r=s[1],i=n.data.get(t.dataId),a=i.complexTensorInfos.real,l=i.complexTensorInfos.imag,u=[o,r],d=me(u),h=Xn("float32",d),p=Xn("float32",d);for(let C=0;C<o;C++){const T=fu({inputs:{x:a},backend:n,attrs:{begin:[C,0],size:[1,r]}}),N=fu({inputs:{x:l},backend:n,attrs:{begin:[C,0],size:[1,r]}}),I=ao({inputs:{real:T,imag:N},backend:n}),{real:k,imag:A}=sSe(I,e,n),$=zi(k,A);for(let M=0;M<r;M++){const O=FI($,M);h[C*r+M]=O.real,p[C*r+M]=O.imag}n.disposeIntermediateTensorInfo(T),n.disposeIntermediateTensorInfo(N),n.disposeIntermediateTensorInfo(I)}const x=n.makeTensorInfo(u,"float32",h),b=n.makeTensorInfo(u,"float32",p),w=ao({inputs:{real:x,imag:b},backend:n});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(b),w}function sSe(t,e,n){const s=me(t.shape),o=n.data.get(t.dataId),r=n.data.get(o.complexTensorInfos.real.dataId).values,i=n.data.get(o.complexTensorInfos.imag.dataId).values;if(oSe(s)){const a=FS(r,i,s,e,n),l=[t.shape[0],t.shape[1]];if(e){const u=n.makeTensorInfo(l,"float32",a.real),d=n.makeTensorInfo(l,"float32",a.imag),h=n.makeTensorInfo([],"float32",Hi(s,"float32")),p=ri({inputs:{x:h},backend:n}),x=MS.kernelFunc({inputs:{a:u,b:h},backend:n}),b=MS.kernelFunc({inputs:{a:d,b:p},backend:n}),w=n.data.get(x.dataId).values,C=n.data.get(b.dataId).values;return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(b),{real:w,imag:C}}return a}else{const a=zi(r,i),l=rSe(a,s,e);return BB(l)}}function oSe(t){return(t&t-1)===0}function FS(t,e,n,s,o){if(n===1)return{real:t,imag:e};const r=zi(t,e),i=n/2,a=UB(r),l=a.real,u=a.imag,d=[l.length],h=o.makeTensorInfo(d,"float32",l),p=o.makeTensorInfo(d,"float32",u),x=ao({inputs:{real:h,imag:p},backend:o}),b=GB(r),w=b.real,C=b.imag,T=[w.length],N=o.makeTensorInfo(T,"float32",w),I=o.makeTensorInfo(T,"float32",C),k=ao({inputs:{real:N,imag:I},backend:o}),A=FS(l,u,i,s,o),$=A.real,M=A.imag,O=[$.length],F=o.makeTensorInfo(O,"float32",$),P=o.makeTensorInfo(O,"float32",M),D=ao({inputs:{real:F,imag:P},backend:o}),H=FS(w,C,i,s,o),Z=H.real,ne=H.imag,Q=[Z.length],G=o.makeTensorInfo(Q,"float32",Z),q=o.makeTensorInfo(Q,"float32",ne),J=ao({inputs:{real:G,imag:q},backend:o}),oe=WB(n,s),B=[oe.real.length],X=o.makeTensorInfo(B,"float32",oe.real),ie=o.makeTensorInfo(B,"float32",oe.imag),re=ao({inputs:{real:X,imag:ie},backend:o}),ye=Zb({inputs:{a:re,b:J},backend:o}),ve=ed({inputs:{a:D,b:ye},backend:o}),be=AA({inputs:{a:D,b:ye},backend:o}),Re=du({inputs:{input:ve},backend:o}),Ae=du({inputs:{input:be},backend:o}),De=td({inputs:{input:ve},backend:o}),Ke=td({inputs:{input:be},backend:o}),Xe=nd({inputs:[Re,Ae],backend:o,attrs:{axis:0}}),dt=nd({inputs:[De,Ke],backend:o,attrs:{axis:0}}),wt=o.data.get(Xe.dataId).values,$t=o.data.get(dt.dataId).values;return o.disposeIntermediateTensorInfo(h),o.disposeIntermediateTensorInfo(p),o.disposeIntermediateTensorInfo(x),o.disposeIntermediateTensorInfo(N),o.disposeIntermediateTensorInfo(I),o.disposeIntermediateTensorInfo(k),o.disposeIntermediateTensorInfo(F),o.disposeIntermediateTensorInfo(P),o.disposeIntermediateTensorInfo(D),o.disposeIntermediateTensorInfo(G),o.disposeIntermediateTensorInfo(q),o.disposeIntermediateTensorInfo(J),o.disposeIntermediateTensorInfo(X),o.disposeIntermediateTensorInfo(ie),o.disposeIntermediateTensorInfo(re),o.disposeIntermediateTensorInfo(ye),o.disposeIntermediateTensorInfo(ve),o.disposeIntermediateTensorInfo(be),o.disposeIntermediateTensorInfo(Re),o.disposeIntermediateTensorInfo(De),o.disposeIntermediateTensorInfo(Ae),o.disposeIntermediateTensorInfo(Ke),o.disposeIntermediateTensorInfo(Xe),o.disposeIntermediateTensorInfo(dt),{real:wt,imag:$t}}function rSe(t,e,n){const s=new Float32Array(e*2);for(let o=0;o<e;o++){let r=0,i=0;for(let a=0;a<e;a++){const l=qB(o*a,e,n),u=FI(t,a);r+=u.real*l.real-u.imag*l.imag,i+=u.real*l.imag+u.imag*l.real}n&&(r/=e,i/=e),HB(s,r,i,o)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iSe(t){const{inputs:e,backend:n}=t,{input:s}=e,o=me(s.shape),r=s.shape[s.shape.length-1],i=o/r,a=Wt({inputs:{x:s},backend:n,attrs:{shape:[i,r]}}),l=YG(a,!1,n),u=Wt({inputs:{x:l},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),u}const aSe={kernelName:nv,backendName:"cpu",kernelFunc:iSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DA(t){const{backend:e,attrs:n}=t,{shape:s,value:o,dtype:r}=n,i=r||vu(o),a=dn(i,me(s));return uSe(a,o,i),e.makeTensorInfo(s,i,a)}const lSe={kernelName:sv,backendName:"cpu",kernelFunc:DA};function uSe(t,e,n){t.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cSe={kernelName:ov,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,o=n,r=Xn(s.dtype,me(s.shape)),[i,a,l,u]=s.shape,d=o.data.get(s.dataId).values;for(let p=0;p<i;p++){const x=p*l*a*u;for(let b=0;b<a;b++){const w=b*(l*u);for(let C=0;C<l;C++){const T=C*u;for(let N=0;N<u;N++){const I=Math.round(l-C-1),k=x+w+T+N;let A=d[k];if(I>=0&&I<l){const $=I*u,M=x+w+$+N;A=d[M]}r[k]=A}}}}return{dataId:o.write(r,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dSe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,filter:r,bias:i,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:d,dilations:h,dimRoundingMode:p,activation:x,leakyreluAlpha:b}=s;let w=KG({inputs:{x:o,filter:r},backend:n,attrs:{strides:l,pad:u,dataFormat:d,dilations:h,dimRoundingMode:p}});if(i){const C=w;if(d==="NCHW"&&i.shape.length===1&&i.shape[0]!==1){const T=Wt({inputs:{x:i},backend:n,attrs:{shape:[i.shape[0],1,1]}});w=ed({inputs:{a:w,b:T},backend:n}),n.disposeIntermediateTensorInfo(T)}else w=ed({inputs:{a:w,b:i},backend:n});n.disposeIntermediateTensorInfo(C)}if(x){const C=w;if(d==="NCHW"&&x==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const T=Wt({inputs:{x:a},backend:n,attrs:{shape:[a.shape[0],1,1]}});w=px(n,w,x,T,b),n.disposeIntermediateTensorInfo(T)}else w=px(n,w,x,a,b);n.disposeIntermediateTensorInfo(C)}return w}const fSe={kernelName:mp,backendName:"cpu",kernelFunc:dSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hSe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,filter:r,bias:i,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:d,dilations:h,dimRoundingMode:p,activation:x,leakyreluAlpha:b}=s;let w=XG({inputs:{x:o,filter:r},backend:n,attrs:{strides:l,pad:u,dataFormat:d,dilations:h,dimRoundingMode:p}});if(i){const C=w;w=ed({inputs:{a:w,b:i},backend:n}),n.disposeIntermediateTensorInfo(C)}if(x){const C=w;w=px(n,w,x,a,b),n.disposeIntermediateTensorInfo(C)}return w}const pSe={kernelName:gp,backendName:"cpu",kernelFunc:hSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mSe(t){const{inputs:e,backend:n}=t,{params:s,indices:o}=e,r=me(s.shape),i=o.shape,a=i[i.length-1],[l,u,d,h]=Eb(s,o);if(u===0)return n.makeTensorInfo(l,s.dtype,[]);const p=n.data.get(o.dataId).values,x=n.bufferSync(s),b=sG(p,x,s.dtype,u,a,d,h,s.shape,r);return n.makeTensorInfo(l,s.dtype,b.values)}const gSe={kernelName:rv,backendName:"cpu",kernelFunc:mSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ySe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,indices:r}=e,{axis:i,batchDims:a}=s;Fe([o,r],"gatherV2");const l=ot(i,o.shape)[0],u=n.data.get(r.dataId).values,d=o.shape[l];for(let k=0;k<u.length;++k){const A=u[k];L(A<=d-1&&A>=0,()=>`GatherV2: the index value ${A} is not in [0, ${d-1}]`)}let h=a;a==null&&(h=0);const p=me(r.shape),x=UI(o,r,l,h),b=Wt({inputs:{x:o},backend:n,attrs:{shape:[x.batchSize,x.outerSize,x.dimSize,x.sliceSize]}}),w=Wt({inputs:{x:r},backend:n,attrs:{shape:[x.batchSize,p/x.batchSize]}}),C=[x.batchSize,x.outerSize,p/x.batchSize,x.sliceSize],T=n.bufferSync(w),N=n.bufferSync(b),I=oG(N,T,C);return n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(w),n.makeTensorInfo(x.outputShape,I.dtype,I.values)}const xSe={kernelName:lm,backendName:"cpu",kernelFunc:ySe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vSe(t){const{inputs:e,backend:n}=t,{input:s}=e,o=me(s.shape),r=s.shape[s.shape.length-1],i=o/r,a=Wt({inputs:{x:s},backend:n,attrs:{shape:[i,r]}}),l=YG(a,!0,n),u=Wt({inputs:{x:l},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),u}const bSe={kernelName:iv,backendName:"cpu",kernelFunc:vSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wSe=Rt(_d,t=>Number.isFinite(t)?1:0,"bool"),CSe={kernelName:_d,backendName:"cpu",kernelFunc:wSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TSe=Rt(Md,t=>Math.abs(t)===1/0?1:0,"bool"),SSe={kernelName:Md,backendName:"cpu",kernelFunc:TSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NSe=Rt(Fd,t=>Number.isNaN(t)?1:0,"bool"),ESe={kernelName:Fd,backendName:"cpu",kernelFunc:NSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ISe(t){const{backend:e,attrs:n}=t,{start:s,stop:o,num:r}=n,i=uG(s,o,r);return e.makeTensorInfo([i.length],"float32",i)}const kSe={kernelName:lv,backendName:"cpu",kernelFunc:ISe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ASe=Rt(Pd,t=>Math.log1p(t)),RSe={kernelName:Pd,backendName:"cpu",kernelFunc:ASe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Se=vn((t,e)=>t&&e),DSe=Vn(hm,$Se,null,"bool"),_Se={kernelName:hm,backendName:"cpu",kernelFunc:DSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MSe=Rt(pm,t=>t?0:1,"bool"),FSe={kernelName:pm,backendName:"cpu",kernelFunc:MSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OSe=vn((t,e)=>t||e),PSe=Vn(mm,OSe,null,"bool"),LSe={kernelName:mm,backendName:"cpu",kernelFunc:PSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VSe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{depthRadius:r,bias:i,alpha:a,beta:l}=s;Fe(o,"LRN");const u=o.shape[3],d=u-1,h=n.data.get(o.dataId).values,p=me(o.shape),x=new Float32Array(p);function b(w){const C=w%u;let T=w-C+Math.max(0,C-r);const N=w-C+Math.min(C+r,d);let I=0;for(;T<=N;T++){const k=h[T];I+=k*k}return I}for(let w=0;w<p;w++){const C=b(w),T=h[w]*Math.pow(i+a*C,-l);x[w]=T}return n.makeTensorInfo(o.shape,o.dtype,x)}const zSe={kernelName:gm,backendName:"cpu",kernelFunc:VSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BSe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,y:r,dy:i}=e,{depthRadius:a,bias:l,alpha:u,beta:d}=s;Fe(i,"LRNGrad");const h=me(i.shape),p=i.shape[3],x=n.data.get(i.dataId).values,b=n.data.get(o.dataId).values,w=n.data.get(r.dataId).values,C=new Float32Array(h),T=h;for(let N=0;N<T;N++){const I=N%p,k=N-I+Math.max(0,I-a),A=N-I+Math.min(p,I+a+1);let $=0;for(let M=k;M<A;M++)$+=Math.pow(b[M],2);$=u*$+l;for(let M=k;M<A;M++){let O=-2*u*d*b[M]*w[N]/$;N===M&&(O+=Math.pow($,-d)),O*=x[N],C[M]+=O}}return n.makeTensorInfo(i.shape,o.dtype,C)}const USe={kernelName:uv,backendName:"cpu",kernelFunc:BSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JG(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{reductionIndices:r,keepDims:i}=s,a=n;let l=o.shape;const u=l.length,d=ot(r,l);let h=d;const p=rn(h,u);let x=a.data.get(o.dataId).values;if(p!=null){const k=new Array(u);for(let A=0;A<k.length;A++)k[A]=l[p[A]];x=IA(x,l,o.dtype,p,k),h=yn(h.length,u),l=k}Fe(o,"max"),hs("max",h,u);const[b,w]=Zn(l,h),C=me(w),T=dG(x,C,b,o.dtype),N=a.write(T,b,o.dtype);let I=b;return i&&(I=gn(b,d)),{dataId:N,shape:I,dtype:o.dtype}}const GSe={kernelName:ym,backendName:"cpu",kernelFunc:JG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HSe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e;Fe(o,"maxPool");const{filterSize:r,strides:i,pad:a,dimRoundingMode:l}=s,u=1;L(fs(i,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const d=sr(o.shape,r,i,u,a,l);let h;if(d.filterWidth===1&&d.filterHeight===1&&lt(d.inShape,d.outShape))h=ri({inputs:{x:o},backend:n});else{const p=n.data.get(o.dataId).values,x=ze(o.shape),b=RA(p,o.shape,o.dtype,x,d,"max");h=n.makeTensorInfo(d.outShape,o.dtype,b.values)}return h}const WSe={kernelName:xm,backendName:"cpu",kernelFunc:HSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qSe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{filterSize:r,strides:i,pad:a,dimRoundingMode:l,dataFormat:u}=s;Fe(o,"maxPool3d");const d=Wi(o.shape,r,i,1,a,l,u),h=n.data.get(o.dataId).values,p=qG(h,o.shape,o.dtype,ze(o.shape),d,"max");return n.makeTensorInfo(p.shape,"float32",p.values)}const KSe={kernelName:vm,backendName:"cpu",kernelFunc:qSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XSe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:o,input:r}=e,{filterSize:i,strides:a,pad:l,dimRoundingMode:u}=s;Fe([o,r],"maxPool3DGrad");const d=Wi(r.shape,i,a,1,l,u),h=n.bufferSync(r),p=OCe(h,d),x=d.strideDepth,b=d.strideHeight,w=d.strideWidth,C=d.dilationDepth,T=d.dilationHeight,N=d.dilationWidth,I=d.effectiveFilterDepth,k=d.effectiveFilterHeight,A=d.effectiveFilterWidth,$=I-1-d.padInfo.front,M=A-1-d.padInfo.left,O=k-1-d.padInfo.top,F=et(r.shape,"float32"),P=n.bufferSync(o);for(let D=0;D<d.batchSize;++D)for(let H=0;H<d.inChannels;++H)for(let Z=0;Z<d.inDepth;++Z)for(let ne=0;ne<d.inHeight;++ne)for(let Q=0;Q<d.inWidth;++Q){const G=Z-$,q=ne-O,J=Q-M;let oe=0;for(let B=0;B<I;B+=C){const X=(G+B)/x;if(!(X<0||X>=d.outDepth||Math.floor(X)!==X))for(let ie=0;ie<k;ie+=T){const re=(q+ie)/b;if(!(re<0||re>=d.outHeight||Math.floor(re)!==re))for(let ye=0;ye<A;ye+=N){const ve=(J+ye)/w;if(ve<0||ve>=d.outWidth||Math.floor(ve)!==ve)continue;const be=I*k*A-1-p.get(D,X,re,ve,H),Re=B*k*A+ie*A+ye,Ae=be===Re?1:0;if(Ae===0)continue;const De=P.get(D,X,re,ve,H);oe+=De*Ae}}}F.set(oe,D,Z,ne,Q,H)}return n.makeTensorInfo(F.shape,F.dtype,F.values)}const YSe={kernelName:dv,backendName:"cpu",kernelFunc:XSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JSe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:o,input:r,output:i}=e,a=r;Fe([r,i],"maxPoolGrad");const{filterSize:l,strides:u,pad:d,dimRoundingMode:h}=s,p=sr(a.shape,l,u,1,d,h),x=n.data.get(a.dataId).values,b=et(p.outShape,a.dtype,WG(x,a.shape,a.dtype,p).values),w=p.strideHeight,C=p.strideWidth,T=p.dilationHeight,N=p.dilationWidth,I=p.effectiveFilterHeight,k=p.effectiveFilterWidth,A=k-1-p.padInfo.left,$=I-1-p.padInfo.top,M=et(a.shape,"float32"),O=n.data.get(o.dataId).values,F=et(o.shape,"float32",O);for(let P=0;P<p.batchSize;++P)for(let D=0;D<p.inChannels;++D)for(let H=0;H<p.inHeight;++H)for(let Z=0;Z<p.inWidth;++Z){const ne=H-$,Q=Z-A;let G=0;for(let q=0;q<I;q+=T){const J=(ne+q)/w;if(!(J<0||J>=p.outHeight||Math.floor(J)!==J))for(let oe=0;oe<k;oe+=N){const B=(Q+oe)/C;if(B<0||B>=p.outWidth||Math.floor(B)!==B)continue;const X=I*k-1-b.get(P,J,B,D),ie=q*k+oe,re=X===ie?1:0;if(re===0)continue;const ye=F.get(P,J,B,D);G+=ye*re}}M.set(G,P,H,Z,D)}return n.makeTensorInfo(M.shape,M.dtype,M.values)}const jSe={kernelName:cv,backendName:"cpu",kernelFunc:JSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZSe(t,e,n,s,o){const r=ze(e),i=RA(t,e,n,r,o,"max"),a=WG(t,e,n,o,!0,s);return[i.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QSe={kernelName:fv,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{filterSize:o,strides:r,pad:i,includeBatchInIndex:a}=e,l=n;Fe(s,"MaxPoolWithArgmax");const u=l.data.get(s.dataId).values,d=sr(s.shape,o,r,[1,1],i),[h,p]=ZSe(u,s.shape,s.dtype,a,d),x=l.write(h,d.outShape,s.dtype),b=l.write(p,d.outShape,s.dtype);return[{dataId:x,shape:d.outShape,dtype:s.dtype},{dataId:b,shape:d.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eNe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r,keepDims:i}=s,a=ot(r,o.shape),u=Zn(o.shape,a)[1],d=me(u),h=[],p=n.makeTensorInfo([],"float32",new Float32Array([d]));h.push(p);const x=Ja({inputs:{x:o},backend:n,attrs:{dtype:"float32"}});h.push(x);const b=$A({inputs:{a:x,b:p},backend:n});h.push(b);const w=Sg({inputs:{x:b},backend:n,attrs:{axis:r,keepDims:i}});return h.forEach(C=>n.disposeIntermediateTensorInfo(C)),w}const tNe={kernelName:bm,backendName:"cpu",kernelFunc:eNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nNe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r,keepDims:i}=s;Fe(o,"min");const a=ot(r,o.shape);let l=a;const u=rn(l,o.shape.length);let d=o;u!=null&&(d=Js({inputs:{x:o},backend:n,attrs:{perm:u}}),l=yn(l.length,o.shape.length)),hs("min",l,d.shape.length);const[h,p]=Zn(d.shape,l),x=me(p),b=cs(me(h),d.dtype),w=n.data.get(d.dataId).values;for(let T=0;T<b.length;++T){const N=T*x;let I=w[N];for(let k=0;k<x;++k){const A=w[N+k];(Number.isNaN(A)||A<I)&&(I=A)}b[T]=I}u!=null&&n.disposeIntermediateTensorInfo(d);const C=n.makeTensorInfo(h,d.dtype,b);if(i){const T=gn(h,a),N=Wt({inputs:{x:C},backend:n,attrs:{shape:T}});return n.disposeIntermediateTensorInfo(C),N}return C}const sNe={kernelName:wm,backendName:"cpu",kernelFunc:nNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oNe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{paddings:r,mode:i}=s;Fe(o,"mirrorPad");const a=r.map((I,k)=>I[0]+o.shape[k]+I[1]),l=r.map(I=>I[0]),u=r.map((I,k)=>I[0]+o.shape[k]),d=i==="reflect"?0:1,h=n.data.get(o.dataId).values,p=o.shape.length,x=ze(o.shape),b=me(a),w=a.length,C=ze(a),T=Xn(o.dtype,b);for(let I=0;I<b;I++){let k=bu(I,w,C);for(let $=0;$<w;$++)k[$]<l[$]?k[$]=l[$]*2-k[$]-d:k[$]>=u[$]&&(k[$]=(u[$]-1)*2-k[$]+d);k=k.map(($,M)=>$-l[M]);const A=vr(k,p,x);T[I]=h[A]}return{dataId:n.write(T,a,o.dtype),shape:a,dtype:o.dtype}}const rNe={kernelName:Cm,backendName:"cpu",kernelFunc:oNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iNe=vn(((t,e)=>{const n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e})),aNe=Vn(zd,iNe),lNe={kernelName:zd,backendName:"cpu",kernelFunc:aNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jG(t){const{inputs:e,backend:n,attrs:s}=t,{logits:o}=e,{dim:r}=s,i=o.shape.length;let a=r;if(a===-1&&(a=i-1),a!==i-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${i} and dim was ${a}`);const l=ot([a],o.shape),u=JG({inputs:{x:o},backend:n,attrs:{reductionIndices:l,keepDims:!1}}),d=gn(u.shape,l),h=Wt({inputs:{x:u},backend:n,attrs:{shape:d}}),p=AA({inputs:{a:o,b:h},backend:n}),x=Q4({inputs:{x:p},backend:n}),b=Sg({inputs:{x},backend:n,attrs:{axis:l,keepDims:!1}}),w=Wt({inputs:{x:b},backend:n,attrs:{shape:d}}),C=$A({inputs:{a:x,b:w},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(w),C}const uNe={kernelName:zm,backendName:"cpu",kernelFunc:jG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cNe(t){const{inputs:e,backend:n,attrs:s}=t,{logits:o}=e,{numSamples:r,seed:i,normalized:a}=s;Fe(o,"multinomial");const l=a?o:jG({inputs:{logits:o},backend:n,attrs:{dim:-1}}),u=l.shape[0],d=l.shape[1],h=n.data.get(l.dataId).values,p=[u,r],x=cs(me(p),"int32");for(let b=0;b<u;++b){const w=b*d,C=new Float32Array(d-1);C[0]=h[w];for(let I=1;I<C.length;++I)C[I]=C[I-1]+h[w+I];const T=pf.alea(i.toString()),N=b*r;for(let I=0;I<r;++I){const k=T();x[N+I]=C.length;for(let A=0;A<C.length;A++)if(k<C[A]){x[N+I]=A;break}}}return a||n.disposeIntermediateTensorInfo(l),n.makeTensorInfo(p,"int32",x)}const dNe={kernelName:hv,backendName:"cpu",kernelFunc:cNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fNe=Cb;function hNe(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:o,scores:r}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l}=s;Fe(o,"NonMaxSuppression");const u=n.data.get(o.dataId).values,d=n.data.get(r.dataId).values,{selectedIndices:h}=fNe(u,d,i,a,l);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}const pNe={kernelName:pv,backendName:"cpu",kernelFunc:hNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mNe=Tb;function gNe(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:o,scores:r}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=s;Fe(o,"NonMaxSuppressionPadded");const d=n.data.get(o.dataId).values,h=n.data.get(r.dataId).values,{selectedIndices:p,validOutputs:x}=mNe(d,h,i,a,l,u);return[n.makeTensorInfo([p.length],"int32",new Int32Array(p)),n.makeTensorInfo([],"int32",new Int32Array([x]))]}const yNe={kernelName:mv,backendName:"cpu",kernelFunc:gNe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xNe=Sb;function vNe(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:o,scores:r}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=s;Fe(o,"NonMaxSuppressionWithScore");const d=n.data.get(o.dataId).values,h=n.data.get(r.dataId).values,p=i,x=a,b=l,w=u,{selectedIndices:C,selectedScores:T}=xNe(d,h,p,x,b,w);return[n.makeTensorInfo([C.length],"int32",new Int32Array(C)),n.makeTensorInfo([T.length],"float32",new Float32Array(T))]}const bNe={kernelName:gv,backendName:"cpu",kernelFunc:vNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wNe(t){const{inputs:e,backend:n,attrs:s}=t,{indices:o}=e,{dtype:r,depth:i,onValue:a,offValue:l}=s;Fe(o,"oneHot");const u=me(o.shape),d=new Float32Array(u*i);d.fill(l);const h=n.data.get(o.dataId).values;for(let p=0;p<u;++p)h[p]>=0&&h[p]<i&&(d[p*i+h[p]]=a);return n.makeTensorInfo([...o.shape,i],r,d)}const CNe={kernelName:Em,backendName:"cpu",kernelFunc:wNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gx(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const o=du({inputs:{input:s},backend:n}),r=gx({inputs:{x:o},backend:n}),i=td({inputs:{input:s},backend:n}),a=gx({inputs:{x:i},backend:n}),l=ao({inputs:{real:r,imag:a},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),l}else return DA({backend:n,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const TNe={kernelName:Hm,backendName:"cpu",kernelFunc:gx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZG(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const o=du({inputs:{input:s},backend:n}),r=ZG({inputs:{x:o},backend:n}),i=td({inputs:{input:s},backend:n}),a=gx({inputs:{x:i},backend:n}),l=ao({inputs:{real:r,imag:a},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),l}else return DA({backend:n,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const SNe={kernelName:Nm,backendName:"cpu",kernelFunc:ZG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QG(t){const{inputs:e,backend:n,attrs:s}=t,{axis:o}=s;if(e.length===1)return mx({inputs:{input:e[0]},backend:n,attrs:{dim:o}});const r=e[0].shape,i=e[0].dtype;e.forEach(d=>{ds(r,d.shape,"All tensors passed to stack must have matching shapes"),L(i===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(d=>{const h=mx({inputs:{input:d},backend:n,attrs:{dim:o}});return a.push(h),h}),u=nd({inputs:l,backend:n,attrs:{axis:o}});return a.forEach(d=>n.disposeIntermediateTensorInfo(d)),u}const NNe={kernelName:Im,backendName:"cpu",kernelFunc:QG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ENe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{paddings:r,constantValue:i}=s;Fe(o,"pad");const a=r.map((N,I)=>N[0]+o.shape[I]+N[1]),l=r.map(N=>N[0]),u=n.data.get(o.dataId).values,d=me(o.shape),h=o.shape.length,p=ze(o.shape),x=me(a),b=a.length,w=ze(a),C=Xn(o.dtype,x);i!==0&&C.fill(i);for(let N=0;N<d;N++){const k=bu(N,h,p).map(($,M)=>$+l[M]),A=vr(k,b,w);C[A]=u[N]}return{dataId:n.write(C,a,o.dtype),shape:a,dtype:o.dtype}}const eH={kernelName:km,backendName:"cpu",kernelFunc:ENe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const INe=vn((t,e)=>Math.pow(t,e)),kNe=Vn(Ud,INe),ANe={kernelName:Ud,backendName:"cpu",kernelFunc:kNe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RNe(t){const{inputs:e,backend:n,attrs:s}=t,{paramsNestedSplits:o,paramsDenseValues:r,indices:i}=e,{outputRaggedRank:a}=s,l=o.map(T=>n.data.get(T.dataId).values),u=o.map(T=>T.shape),d=n.data.get(r.dataId).values,h=n.data.get(i.dataId).values,[p,x,b]=yG(l,u,d,r.shape,r.dtype,h,i.shape),w=p.map(T=>n.makeTensorInfo([T.length],"int32",T)),C=n.makeTensorInfo(b,r.dtype,x);return w.concat([C])}const $Ne={kernelName:yv,backendName:"cpu",kernelFunc:RNe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DNe(t){const{inputs:e,backend:n}=t,{starts:s,limits:o,deltas:r}=e,i=n.data.get(s.dataId).values,a=n.data.get(o.dataId).values,l=n.data.get(r.dataId).values,[u,d]=xG(i,s.shape,s.dtype,a,o.shape,l,r.shape),h=n.makeTensorInfo([u.length],"int32",u),p=n.makeTensorInfo([d.length],s.dtype,d);return[h,p]}const _Ne={kernelName:xv,backendName:"cpu",kernelFunc:DNe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MNe(t){const{inputs:e,backend:n,attrs:s}=t,{shape:o,values:r,defaultValue:i,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,u=n.data.get(o.dataId).values,d=n.data.get(r.dataId).values,h=n.data.get(i.dataId).values,p=a.map(C=>n.data.get(C.dataId).values),x=a.map(C=>C.shape),[b,w]=vG(u,o.shape,d,r.shape,r.dtype,h,i.shape,p,x,l);return n.makeTensorInfo(b,r.dtype,w)}const FNe={kernelName:vv,backendName:"cpu",kernelFunc:MNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ONe(t){const{backend:e,attrs:n}=t,{start:s,stop:o,dtype:r,step:i}=n,a=bG(s,o,i,r);return e.makeTensorInfo([a.length],r,a)}const PNe={kernelName:bv,backendName:"cpu",kernelFunc:ONe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LNe=Rt(Gd,t=>1/t),VNe={kernelName:Gd,backendName:"cpu",kernelFunc:LNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zNe(t){const{inputs:e,backend:n,attrs:s}=t,{images:o}=e,{alignCorners:r,halfPixelCenters:i,size:a}=s;Fe(o,"resizeBilinear");const l=ze(o.shape),[u,d]=a,[h,p,x,b]=o.shape,w=n.data.get(o.dataId).values,C=new Float32Array(me([h,u,d,b])),T=[r&&u>1?p-1:p,r&&d>1?x-1:x],N=[r&&u>1?u-1:u,r&&d>1?d-1:d];let I=0;const k=T[0]/N[0],A=T[1]/N[1];for(let $=0;$<h;$++)for(let M=0;M<u;M++){let O;i?O=k*(M+.5)-.5:O=k*M;const F=Math.max(0,Math.floor(O)),P=O-F,D=Math.min(p-1,Math.ceil(O)),H=$*l[0]+F*l[1],Z=$*l[0]+D*l[1];for(let ne=0;ne<d;ne++){let Q;i?Q=A*(ne+.5)-.5:Q=A*ne;const G=Math.max(0,Math.floor(Q)),q=Q-G,J=Math.min(x-1,Math.ceil(Q)),oe=H+G*l[2],B=Z+G*l[2],X=H+J*l[2],ie=Z+J*l[2];for(let re=0;re<b;re++){const ye=w[oe+re],ve=w[B+re],be=w[X+re],Re=w[ie+re],Ae=ye+(be-ye)*q,De=ve+(Re-ve)*q,Ke=Ae+(De-Ae)*P;C[I++]=Ke}}}return n.makeTensorInfo([h,u,d,b],"float32",C)}const BNe={kernelName:_m,backendName:"cpu",kernelFunc:zNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UNe(t){const{inputs:e,backend:n,attrs:s}=t,{images:o,dy:r}=e,{alignCorners:i}=s;Fe([r,o],"resizeBilinearGrad");const a=ze(o.shape),[l,u,d,h]=o.shape,[,p,x]=r.shape,b=new Float32Array(l*u*d*h),w=[i&&p>1?u-1:u,i&&x>1?d-1:d],C=[i&&p>1?p-1:p,i&&x>1?x-1:x],T=w[0]/C[0],N=w[1]/C[1],I=n.data.get(r.dataId).values;let k=0;for(let A=0;A<l;A++){const $=A*a[0];for(let M=0;M<p;M++){const O=M*T,F=Math.floor(O),P=Math.min(Math.ceil(O),u-1),D=$+F*a[1],H=$+P*a[1],Z=O-F,ne=1-Z;for(let Q=0;Q<x;Q++){const G=Q*N,q=Math.floor(G),J=Math.min(Math.ceil(G),d-1),oe=G-q,B=1-oe,X=D+q*a[2],ie=D+J*a[2],re=H+q*a[2],ye=H+J*a[2],ve=ne*B,be=ne*oe,Re=Z*B,Ae=Z*oe;for(let De=0;De<h;De++){const Ke=I[k++];b[X+De]+=Ke*ve,b[ie+De]+=Ke*be,b[re+De]+=Ke*Re,b[ye+De]+=Ke*Ae}}}}return n.makeTensorInfo([l,d,u,h],"float32",b)}const GNe={kernelName:Tv,backendName:"cpu",kernelFunc:UNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HNe(t){const{inputs:e,backend:n,attrs:s}=t,{images:o}=e,{alignCorners:r,halfPixelCenters:i,size:a}=s;Fe(o,"resizeNearestNeighbor");const l=ze(o.shape),[u,d]=a,[h,p,x,b]=o.shape,w=n.data.get(o.dataId).values,C=new Float32Array(h*u*d*b),T=[r&&u>1?p-1:p,r&&d>1?x-1:x],N=[r&&u>1?u-1:u,r&&d>1?d-1:d],I=T[0]/N[0],k=T[1]/N[1];let A=0;for(let $=0;$<h;$++){const M=$*l[0];for(let O=0;O<u;O++){const F=i?I*(O+.5):I*O;let P=Math.min(p-1,r?Math.round(F):Math.floor(F));i&&(P=Math.max(0,P));const D=M+P*l[1];for(let H=0;H<d;H++){const Z=i?k*(H+.5):k*H;let ne=Math.min(x-1,r?Math.round(Z):Math.floor(Z));i&&(ne=Math.max(0,ne));const Q=D+ne*l[2];for(let G=0;G<b;G++){const q=w[Q+G];C[A++]=q}}}}return n.makeTensorInfo([h,u,d,b],o.dtype,C)}const WNe={kernelName:Dm,backendName:"cpu",kernelFunc:HNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qNe(t){const{inputs:e,backend:n,attrs:s}=t,{images:o,dy:r}=e,{alignCorners:i}=s;Fe([r,o],"resizeNearestNeighborGrad");const a=ze(o.shape),l=ze(r.shape),[u,d,h,p]=o.shape,[,x,b]=r.shape,w=new Float32Array(u*d*h*p),C=n.data.get(r.dataId).values,T=[i&&x>1?d-1:d,i&&b>1?h-1:h],N=[i&&x>1?x-1:x,i&&b>1?b-1:b],I=T[0]/N[0],k=T[1]/N[1],A=1/I,$=1/k,M=Math.ceil(A)*2+2,O=Math.ceil($)*2+2;for(let F=0;F<u;F++){const P=F*a[0];for(let D=0;D<d;D++){const H=P+D*a[1],Z=Math.floor(D*A),ne=Math.floor(Z-M/2);for(let Q=0;Q<h;Q++){const G=H+Q*a[2],q=Math.floor(Q*$),J=Math.floor(q-O/2);for(let oe=0;oe<p;oe++){let B=0;for(let X=0;X<M;X++){const ie=X+ne;if(ie<0||ie>=x)continue;const re=P+ie*l[1],ye=ie*I,ve=Math.min(d-1,i?Math.round(ye):Math.floor(ye));if(D===ve)for(let be=0;be<O;be++){const Re=be+J;if(Re<0||Re>=b)continue;const Ae=re+Re*l[2],De=Re*k,Ke=Math.min(h-1,i?Math.round(De):Math.floor(De));Q===Ke&&(B+=C[Ae+oe])}}w[G+oe]=B}}}}return n.makeTensorInfo(o.shape,o.dtype,w)}const KNe={kernelName:Cv,backendName:"cpu",kernelFunc:qNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XNe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{dims:r}=s;Fe(o,"reverse");const i=o.shape.length,a=ot(r,o.shape);if(i===0)return ri({inputs:{x:o},backend:n});const l=new In(o.shape,o.dtype),u=n.bufferSync(o);for(let d=0;d<l.size;d++){const h=l.indexToLoc(d),p=h.slice();a.forEach(x=>p[x]=o.shape[x]-1-p[x]),l.set(u.get(...p),...h)}return n.makeTensorInfo(l.shape,l.dtype,l.values)}const YNe={kernelName:Mm,backendName:"cpu",kernelFunc:XNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JNe={kernelName:zv,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,{radians:o,fillValue:r,center:i}=e,a=n,l=Xn(s.dtype,me(s.shape)),[u,d,h,p]=s.shape,[x,b]=EI(i,d,h),w=255,C=Math.sin(o),T=Math.cos(o),N=a.data.get(s.dataId).values;for(let k=0;k<u;k++){const A=k*h*d*p;for(let $=0;$<d;$++){const M=$*(h*p);for(let O=0;O<h;O++){const F=O*p;for(let P=0;P<p;P++){const D=[u,$,O,P],H=D[2],Z=D[1];let ne=(H-x)*T-(Z-b)*C,Q=(H-x)*C+(Z-b)*T;ne=Math.round(ne+x),Q=Math.round(Q+b);let G=r;if(typeof r!="number"&&(P===3?G=w:G=r[P]),ne>=0&&ne<h&&Q>=0&&Q<d){const J=Q*(h*p),oe=ne*p,B=A+J+oe+P;G=N[B]}const q=A+M+F+P;l[q]=G}}}}return{dataId:a.write(l,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jNe=Rt(qd,t=>{const e=Math.floor(t);return t-e<.5?Math.floor(t):t-e>.5?Math.ceil(t):e%2===0?e:e+1}),ZNe={kernelName:qd,backendName:"cpu",kernelFunc:jNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QNe(t){const{inputs:e,backend:n,attrs:s}=t,{indices:o,updates:r}=e,{shape:i}=s,{sliceRank:a,numUpdates:l,sliceSize:u,strides:d,outputSize:h}=il(r,o,i),p=!0,x=n.bufferSync(o),b=n.bufferSync(r),w=Ul(x,b,i,h,u,l,a,d,0,p);return n.makeTensorInfo(i,w.dtype,w.values)}const eEe={kernelName:Sv,backendName:"cpu",kernelFunc:QNe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tEe(t,e){let n=0,s=t.length,o=0;for(;n<s;)o=Math.floor((n+s)/2),t[o]<e?n=o+1:s=o;return s}function nEe(t,e){let n=0,s=t.length,o=0;for(;n<s;)o=Math.floor((n+s)/2),t[o]<=e?n=o+1:s=o;return s}function sEe(t,e,n,s,o,r){const i=dn("int32",n*o);for(let a=0;a<n;++a){const l=t.slice(a*s,(a+1)*s),u=a*o;for(let d=0;d<o;++d)i[u+d]=r==="left"?tEe(l,e[d+u]):nEe(l,e[d+u])}return i}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oEe(t){const{inputs:e,backend:n,attrs:s}=t,{sortedSequence:o,values:r}=e,{side:i}=s,a=n.data.get(o.dataId).values,l=n.data.get(r.dataId).values,u=sEe(a,l,o.shape[0],o.shape[1],r.shape[1],i);return n.makeTensorInfo(r.shape,"int32",u)}const rEe={kernelName:Ev,backendName:"cpu",kernelFunc:oEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iEe(t){const{inputs:e,backend:n}=t,{condition:s,t:o,e:r}=e;Fe([s,o,r],"select");const i=s.shape.length,a=n.data.get(s.dataId).values,l=n.data.get(o.dataId).values,u=n.data.get(r.dataId).values,d=Ws(o.dtype,r.dtype),h=cs(me(o.shape),d);let p=0;const x=i===0||i>1||o.shape.length===1?1:me(o.shape.slice(1));for(let b=0;b<a.length;b++)for(let w=0;w<x;w++)a[b]===1?h[p++]=l[b]:h[p++]=u[b];return n.makeTensorInfo(o.shape,d,h)}const aEe={kernelName:Fm,backendName:"cpu",kernelFunc:iEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lEe=Ab,uEe=Rb,cEe=Rt(Xd,t=>t>=0?uEe*t:lEe*(Math.exp(t)-1)),dEe={kernelName:Xd,backendName:"cpu",kernelFunc:cEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fEe=Rt(jd,t=>t<0?-1:t>0?1:0),hEe={kernelName:jd,backendName:"cpu",kernelFunc:fEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pEe=Rt(Yd,t=>Math.sin(t)),mEe={kernelName:Yd,backendName:"cpu",kernelFunc:pEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gEe=Rt(Jd,t=>Math.sinh(t)),yEe={kernelName:Jd,backendName:"cpu",kernelFunc:gEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xEe=11920928955078125e-23,oP=Math.log(xEe)+2,vEe=Rt(Qd,t=>{const e=t>-oP,n=t<oP,s=Math.exp(t);let o;return n?o=s:e?o=t:o=Math.log(1+s),o}),bEe={kernelName:Qd,backendName:"cpu",kernelFunc:vEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wEe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{blockShape:r,paddings:i}=s;Fe([o],"spaceToBatchND");const a=me(r),l=[[0,0]];l.push(...i);for(let $=1+r.length;$<o.shape.length;++$)l.push([0,0]);const u=eH.kernelFunc({inputs:{x:o},backend:n,attrs:{paddings:l,constantValue:0}}),d=dg(u.shape,r,a,!1),h=fg(d.length,r.length,!1),p=hg(u.shape,r,a,!1),w=Wt({inputs:{x:u},backend:n,attrs:{shape:d}}),N=Js({inputs:{x:w},backend:n,attrs:{perm:h}}),A=Wt({inputs:{x:N},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(w),n.disposeIntermediateTensorInfo(N),A}const CEe={kernelName:Lm,backendName:"cpu",kernelFunc:wEe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TEe(t){const{inputs:e,backend:n}=t,{indices:s,values:o,denseShape:r,defaultValue:i}=e;if(r.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${r.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(o.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${o.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const a=n.data.get(s.dataId).values,l=n.data.get(o.dataId).values,u=n.data.get(r.dataId).values,d=n.data.get(i.dataId).values[0],[h,p,x,b,w]=SG(a,s.shape,s.dtype,l,o.dtype,u,d);return[n.makeTensorInfo(p,s.dtype,h),n.makeTensorInfo([p[0]],o.dtype,x),n.makeTensorInfo([b.length],"bool",new Uint8Array(b.map(C=>Number(C)))),n.makeTensorInfo([w.length],s.dtype,new Int32Array(w))]}const SEe={kernelName:Iv,backendName:"cpu",kernelFunc:TEe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NEe(t){const{inputs:e,backend:n}=t,{inputIndices:s,inputShape:o,newShape:r}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(o.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${o.shape}`);if(r.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${r.shape}`);const i=Array.from(n.data.get(o.dataId).values),a=n.data.get(s.dataId).values,l=Array.from(n.data.get(r.dataId).values),[u,d,h]=NG(a,s.shape,s.dtype,i,l);return[n.makeTensorInfo(d,s.dtype,u),n.makeTensorInfo([h.length],r.dtype,new Int32Array(h))]}const EEe={kernelName:kv,backendName:"cpu",kernelFunc:NEe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IEe(t){const{inputs:e,backend:n}=t,{data:s,indices:o,segmentIds:r}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${o.shape}`);if(r.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${r.shape}`);if(o.shape[0]!==r.shape[0])throw new Error("segmentIds and indices should have same size.");const i=n.data.get(s.dataId).values,a=n.data.get(o.dataId).values,l=n.data.get(r.dataId).values,[u,d]=kA(i,s.shape,s.dtype,a,l,!0);return n.makeTensorInfo(d,s.dtype,u)}const kEe={kernelName:Av,backendName:"cpu",kernelFunc:IEe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AEe(t){const{inputs:e,backend:n}=t,{data:s,indices:o,segmentIds:r}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${o.shape}`);if(r.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${r.shape}`);if(o.shape[0]!==r.shape[0])throw new Error("segmentIds and indices should have same size.");const i=n.data.get(s.dataId).values,a=n.data.get(o.dataId).values,l=n.data.get(r.dataId).values,[u,d]=kA(i,s.shape,s.dtype,a,l);return n.makeTensorInfo(d,s.dtype,u)}const REe={kernelName:Rv,backendName:"cpu",kernelFunc:AEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Ee(t){const{inputs:e,backend:n,attrs:s}=t,{sparseIndices:o,sparseValues:r,defaultValue:i}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:u,sliceSize:d,strides:h,outputSize:p}=il(r,o,a),x=!1,b=n.bufferSync(o);let w;switch(r.dtype){case"bool":{const C=n.bufferSync(r),T=!!n.data.get(i.dataId).values[0];w=Ul(b,C,a,p,d,u,l,h,T,x);break}case"float32":{const C=n.bufferSync(r),T=n.data.get(i.dataId).values[0];w=Ul(b,C,a,p,d,u,l,h,T,x);break}case"int32":{const C=n.bufferSync(r),T=n.data.get(i.dataId).values[0];w=Ul(b,C,a,p,d,u,l,h,T,x);break}case"string":{const C=n.bufferSync(r),T=Oi(n.data.get(i.dataId).values[0]);w=Ul(b,C,a,p,d,u,l,h,T,x);break}default:throw new Error(`Unsupported type ${r.dtype}`)}return n.makeTensorInfo(a,w.dtype,w.values)}const DEe={kernelName:$v,backendName:"cpu",kernelFunc:$Ee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Ee(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{numOrSizeSplits:r,axis:i}=s,a=ot(i,o.shape)[0],l=BI(o,r,a),u=new Array(o.shape.length).fill(0),d=o.shape.slice();return l.map(h=>{const p=[...d];p[a]=h;const x=fu({inputs:{x:o},backend:n,attrs:{begin:u,size:p}});return u[a]+=h,x})}const MEe={kernelName:Vm,backendName:"cpu",kernelFunc:_Ee};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FEe={kernelName:Dv,backendName:"cpu",kernelFunc:({inputs:t,backend:e})=>{const{x:n}=t,s=e;Fe(n,"square");const o=s.data.get(n.dataId).values,r=new Float32Array(o.length);for(let a=0;a<o.length;++a){const l=o[a];r[a]=l*l}return{dataId:s.write(r,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OEe=Rt(af,(t,e)=>{const n=e;return isNaN(t)?NaN:t>0?1:n.alpha}),PEe={kernelName:af,backendName:"cpu",kernelFunc:OEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LEe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{begin:r,end:i,strides:a,beginMask:l,endMask:u,ellipsisMask:d,newAxisMask:h,shrinkAxisMask:p}=s;Fe(o,"stridedSlice");const{finalShapeSparse:x,finalShape:b,isIdentity:w,sliceDim0:C,isSimpleSlice:T,begin:N,end:I,strides:k}=CI(o.shape,r,i,a,l,u,d,h,p);let A;if(w)A=Wt({inputs:{x:o},backend:n,attrs:{shape:b}});else if(C||T){L(o.shape.length>=1,()=>`Input must have rank at least 1, got: ${o.shape.length}`);const $=vI(N,I,k),M=fu({inputs:{x:o},backend:n,attrs:{begin:N,size:$}});A=Wt({inputs:{x:M},backend:n,attrs:{shape:b}}),n.disposeIntermediateTensorInfo(M)}else{const $=n.bufferSync(o),M=kG(x,$,k,N);A=n.makeTensorInfo(b,M.dtype,M.values)}return A}const VEe={kernelName:_v,backendName:"cpu",kernelFunc:LEe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zEe(t){const{inputs:e,backend:n,attrs:s}=t,{separator:o,nGramWidths:r,leftPad:i,rightPad:a,padWidth:l,preserveShortSequences:u}=s,{data:d,dataSplits:h}=e,p=n.data.get(d.dataId).values,x=n.data.get(h.dataId).values,[b,w]=AG(p,x,o,r,i,a,l,u);return[n.makeTensorInfo([b.length],"string",b),n.makeTensorInfo(h.shape,"int32",w)]}const BEe={kernelName:Mv,backendName:"cpu",kernelFunc:zEe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UEe(t){const{inputs:e,backend:n,attrs:s}=t,{skipEmpty:o}=s,{input:r,delimiter:i}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");if(r.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${r.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values[0],[u,d,h]=RG(a,l,o),p=d.length;return[n.makeTensorInfo([p,2],"int32",u),n.makeTensorInfo([p],"string",d),n.makeTensorInfo([2],"int32",new Int32Array(h))]}const GEe={kernelName:Fv,backendName:"cpu",kernelFunc:UEe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HEe(t){const{inputs:e,backend:n,attrs:s}=t,{numBuckets:o}=s,{input:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");if(o<=0)throw new Error("Number of buckets must be at least 1");const i=n.data.get(r.dataId).values,a=$G(i,o);return n.makeTensorInfo(r.shape,"int32",a)}const WEe={kernelName:Ov,backendName:"cpu",kernelFunc:HEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qEe=Rt(sf,t=>Math.tan(t)),KEe={kernelName:sf,backendName:"cpu",kernelFunc:qEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XEe=Rt(of,t=>Math.tanh(t)),YEe={kernelName:of,backendName:"cpu",kernelFunc:XEe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JEe(t){const{inputs:e,backend:n}=t,{tensor:s,indices:o,updates:r}=e,{sliceRank:i,numUpdates:a,sliceSize:l,strides:u,outputSize:d}=il(r,o,s.shape),h=!1,p=n.bufferSync(o),x=n.bufferSync(r),b=n.bufferSync(s),w=Ul(p,x,s.shape,d,l,a,i,u,b,h);return n.makeTensorInfo(s.shape,w.dtype,w.values)}const jEe={kernelName:Nv,backendName:"cpu",kernelFunc:JEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZEe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{reps:r}=s;Fe(o,"tile");const i=_G(n.bufferSync(o),r);return n.makeTensorInfo(i.shape,i.dtype,i.values)}const QEe={kernelName:rf,backendName:"cpu",kernelFunc:ZEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eIe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{k:r,sorted:i}=s;Fe(o,"topk");const a=n.data.get(o.dataId).values,[l,u]=FG(a,o.shape,o.dtype,r,i);return[n.makeTensorInfo(l.shape,l.dtype,l.values),n.makeTensorInfo(u.shape,u.dtype,u.values)]}const tIe={kernelName:Pv,backendName:"cpu",kernelFunc:eIe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nIe(t){const{inputs:e,attrs:n,backend:s}=t,{image:o,transforms:r}=e,{interpolation:i,fillMode:a,fillValue:l,outputShape:u}=n,[d,h,p,x]=o.shape,[b,w]=u??[h,p],C=[d,b,w,x],T=ze(o.shape),N=T[0],I=T[1],k=T[2],A=ze(C),$=A[0],M=A[1],O=A[2],F=Xn(o.dtype,me(C));F.fill(l);const P=s.data.get(o.dataId).values,D=s.data.get(r.dataId).values;for(let Z=0;Z<d;++Z){const ne=r.shape[0]===1?D:D.subarray(Z*8,Z*8+8);for(let Q=0;Q<b;++Q)for(let G=0;G<w;++G)for(let q=0;q<x;++q){let J;const oe=ne[6]*G+ne[7]*Q+1;if(oe===0)continue;const B=(ne[0]*G+ne[1]*Q+ne[2])/oe,X=(ne[3]*G+ne[4]*Q+ne[5])/oe,ie=rP(B,p,a),re=rP(X,h,a);switch(i){case"nearest":J=lIe(P,h,p,N,I,k,Z,re,ie,q,l);break;case"bilinear":J=uIe(P,h,p,N,I,k,Z,re,ie,q,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${i}`)}const ye=Z*$+Q*M+G*O+q;F[ye]=J}return s.makeTensorInfo(C,o.dtype,F)}return{dataId:s.write(F,C,o.dtype),shape:o.shape,dtype:o.dtype}}const sIe={kernelName:Lv,backendName:"cpu",kernelFunc:nIe};function rP(t,e,n){switch(n){case"reflect":return oIe(t,e);case"wrap":return rIe(t,e);case"nearest":return aIe(t,e);case"constant":default:return iIe(t)}}function oIe(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const s=2*e;n<s&&(n=s*Math.trunc(-n/s)+n),n=n<-e?n+s:-n-1}else if(n>e-1)if(e<=1)n=0;else{const s=2*e;n-=s*Math.trunc(n/s),n>=e&&(n=s-n-1)}return za(0,n,e-1)}function rIe(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const s=e-1;n+=e*(Math.trunc(-n/s)+1)}else if(n>e-1)if(e<=1)n=0;else{const s=e-1;n-=e*Math.trunc(n/s)}return za(0,n,e-1)}function iIe(t,e){return t}function aIe(t,e){return za(0,t,e-1)}function Hh(t,e,n,s,o,r,i,a,l,u,d){const h=i*s+a*o+l*r+u;return 0<=a&&a<e&&0<=l&&l<n?t[h]:d}function lIe(t,e,n,s,o,r,i,a,l,u,d){const h=Math.round(a),p=Math.round(l);return Hh(t,e,n,s,o,r,i,h,p,u,d)}function uIe(t,e,n,s,o,r,i,a,l,u,d){const h=Math.floor(a),p=Math.floor(l),x=h+1,b=p+1,w=(b-l)*Hh(t,e,n,s,o,r,i,h,p,u,d)+(l-p)*Hh(t,e,n,s,o,r,i,h,b,u,d),C=(b-l)*Hh(t,e,n,s,o,r,i,x,p,u,d)+(l-p)*Hh(t,e,n,s,o,r,i,x,b,u,d);return(x-a)*w+(a-h)*C}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cIe(t){const{inputs:e,attrs:n,backend:s}=t,{axis:o}=n,{x:r}=e;Fe(r,"unique");const i=s.data.get(r.dataId).values,{outputValues:a,outputShape:l,indices:u}=OG(i,o,r.shape,r.dtype);return[s.makeTensorInfo(l,r.dtype,a),s.makeTensorInfo([u.length],"int32",u)]}const dIe={kernelName:Vv,backendName:"cpu",kernelFunc:cIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fIe(t){const{inputs:e,backend:n,attrs:s}=t,{value:o}=e;let{axis:r}=s;r<0&&(r+=o.shape.length);const i=o.shape.length,a=o.shape[r],l=new Array(i-1);let u=0;for(let x=0;x<i;x++)x!==r&&(l[u++]=o.shape[x]);const d=new Array(i).fill(0),h=o.shape.slice();h[r]=1;const p=new Array(a);for(let x=0;x<p.length;x++){d[r]=x;const b=fu({inputs:{x:o},backend:n,attrs:{begin:d,size:h}});p[x]=Wt({inputs:{x:b},backend:n,attrs:{shape:l}}),n.disposeIntermediateTensorInfo(b)}return p}const hIe={kernelName:Um,backendName:"cpu",kernelFunc:fIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pIe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,segmentIds:r}=e,{numSegments:i}=s;Fe(o,"unsortedSegmentSum");const a=o.shape.length,l=r.shape.length,u=[],d=[],h=a-l;let p=r;for(let b=0;b<h;++b){const w=mx({inputs:{input:p},backend:n,attrs:{dim:b+1}});p=w,d.push(w)}for(let b=0;b<i;++b){const w=Hi(b,"int32"),C=n.makeTensorInfo([],"int32",w),T=j4({inputs:{a:C,b:p},backend:n}),N=Ja({inputs:{x:T},backend:n,attrs:{dtype:"float32"}}),I=Zb({inputs:{a:N,b:o},backend:n}),k=Sg({inputs:{x:I},backend:n,attrs:{axis:0,keepDims:!1}});u.push(k),d.push(C),d.push(T),d.push(N),d.push(I),d.push(k)}const x=QG({inputs:u,backend:n,attrs:{axis:0}});return d.forEach(b=>n.disposeIntermediateTensorInfo(b)),x}const mIe={kernelName:Gm,backendName:"cpu",kernelFunc:pIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gIe=[cCe,Wwe,fCe,pCe,jwe,gCe,xCe,bCe,CCe,SCe,ECe,kCe,RCe,_Ce,FCe,LCe,zCe,UCe,HCe,lCe,qCe,XCe,JCe,Qwe,ZCe,Ywe,t1e,eTe,qwe,nTe,oTe,rTe,aTe,uTe,dTe,hTe,mTe,yTe,vTe,wTe,TTe,NTe,ITe,ATe,RTe,DTe,MTe,OTe,PTe,LTe,VTe,BTe,HTe,tCe,qTe,n1e,eSe,s1e,tSe,r1e,aSe,lSe,cSe,a1e,u1e,fSe,pSe,gSe,xSe,d1e,h1e,Kwe,bSe,sTe,CSe,SSe,ESe,nCe,m1e,y1e,kSe,v1e,RSe,_Se,FSe,LSe,zSe,USe,GSe,w1e,WSe,KSe,YSe,jSe,QSe,tNe,sNe,T1e,rNe,lNe,dNe,N1e,I1e,pNe,yNe,bNe,A1e,CNe,SNe,NNe,eH,ANe,oCe,D1e,$Ne,_Ne,FNe,PNe,Xwe,MS,VNe,rCe,iCe,aCe,BNe,GNe,WNe,KNe,YNe,JNe,ZNe,z1e,eEe,rEe,aEe,dEe,U1e,hEe,mEe,yEe,G1e,uNe,bEe,CEe,SEe,EEe,kEe,REe,DEe,MEe,q1e,FEe,X1e,J1e,PEe,VEe,BEe,GEe,WEe,eCe,UTe,KEe,YEe,jEe,QEe,tIe,sIe,R1e,dIe,hIe,mIe,TNe];for(const t of gIe)Bv(t);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ll={},r0={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function tH(t,e){Ll[t]=e}function Er(t,e){if(!(t in Ll)||e!=null){const s=xIe(t,e);if(s!==null)Ll[t]=s;else return console.log("Could not get context for WebGL version",t),null}const n=Ll[t];return n==null||n.isContextLost()?(delete Ll[t],Er(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),Ll[t])}function yIe(t){if(!ue().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&t===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function xIe(t,e){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=e??yIe(t);return n.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete Ll[t]},!1),ue().getBool("SOFTWARE_WEBGL_ENABLED")&&(r0.failIfMajorPerformanceCaveat=!1),t===1?n.getContext("webgl",r0)||n.getContext("experimental-webgl",r0):n.getContext("webgl2",r0)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var kp;(function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"})(kp||(kp={}));var Ao;(function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"})(Ao||(Ao={}));var as;(function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(as||(as={}));function Ng(t,e){return[e,t]}function vIe(t,e){return t*e}function i0(t){const e=me(t),n=Math.ceil(e/4);return H0(n)}function Cf(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function bIe(t,e){const[n,s]=Cf(t,e);return n*s*4}function _A(t,e){const n=t;let s,o,r,i,a,l,u,d,h,p;return ue().getNumber("WEBGL_VERSION")===2?(s=n.R32F,o=n.R16F,r=n.RGBA16F,i=n.RGBA32F,a=n.RED,u=4,d=1,h=n.HALF_FLOAT,p=n.FLOAT,l=n.RGBA8):(s=t.RGBA,o=t.RGBA,r=t.RGBA,i=n.RGBA,a=t.RGBA,u=4,d=4,h=e!=null?e.HALF_FLOAT_OES:null,p=t.FLOAT,l=t.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:o,internalFormatPackedHalfFloat:r,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:u,defaultNumChannels:d,textureTypeHalfFloat:h,textureTypeFloat:p}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ke(t,e){const n=e();return ue().getBool("DEBUG")&&wIe(t),n}function wIe(t){const e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+sH(t,e))}const CIe=596e-10,TIe=65504;function nH(t){return!!(ue().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||t===0||CIe<Math.abs(t)&&Math.abs(t)<TIe)}function sH(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function Wh(t,e){return ji(t,()=>t.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function oH(t,e){const n=ji(t,()=>t.createShader(t.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(ke(t,()=>t.shaderSource(n,e)),ke(t,()=>t.compileShader(n)),t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function rH(t,e){const n=ji(t,()=>t.createShader(t.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(ke(t,()=>t.shaderSource(n,e)),ke(t,()=>t.compileShader(n)),ue().get("ENGINE_COMPILE_ONLY"))return n;if(t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw MA(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}const SIe=/ERROR: [0-9]+:([0-9]+):/g;function MA(t,e){const n=SIe.exec(e);if(n==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(t);return}const s=+n[1],o=t.split(`
`),r=o.length.toString().length+2,i=o.map((h,p)=>Wl((p+1).toString(),r)+h);let a=0;for(let h=0;h<i.length;h++)a=Math.max(i[h].length,a);const l=i.slice(0,s-1),u=i.slice(s-1,s),d=i.slice(s);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${Wl(u[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(d.join(`
`))}function iH(t){return ji(t,()=>t.createProgram(),"Unable to create WebGLProgram.")}function aH(t,e){if(ke(t,()=>t.linkProgram(e)),!ue().get("ENGINE_COMPILE_ONLY")&&t.getProgramParameter(e,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function k0(t,e){if(ke(t,()=>t.validateProgram(e)),t.getProgramParameter(e,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function lH(t,e){const n=ji(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return ke(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),ke(t,()=>t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function uH(t,e){const n=ji(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return ke(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n)),ke(t,()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function NIe(){return ue().getNumber("WEBGL_VERSION")===2?1:4}function cH(t){return ji(t,()=>t.createTexture(),"Unable to create WebGLTexture.")}function dH(t,e){const n=ue().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){const s=`[${t}x${e}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(t>n||e>n){const s=`[${t}x${e}]`,o=`[${n}x${n}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+o+".")}}function fH(t){return ji(t,()=>t.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function OS(t,e,n,s,o,r,i){const a=t.getAttribLocation(e,n);return a===-1?!1:(ke(t,()=>t.bindBuffer(t.ARRAY_BUFFER,s)),ke(t,()=>t.vertexAttribPointer(a,o,t.FLOAT,!1,r,i)),ke(t,()=>t.enableVertexAttribArray(a)),!0)}function hH(t,e,n){xH(t,n),ke(t,()=>t.activeTexture(t.TEXTURE0+n)),ke(t,()=>t.bindTexture(t.TEXTURE_2D,e))}function EIe(t,e){xH(t,e),ke(t,()=>t.activeTexture(t.TEXTURE0+e)),ke(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function pH(t,e,n){return ji(t,()=>t.getUniformLocation(e,n),'uniform "'+n+'" not present in program.')}function mH(t,e,n){return t.getUniformLocation(e,n)}function gH(t,e,n,s){ke(t,()=>hH(t,e,s)),ke(t,()=>t.uniform1i(n,s))}function IIe(t){ke(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,null)),ke(t,()=>t.viewport(0,0,t.canvas.width,t.canvas.height)),ke(t,()=>t.scissor(0,0,t.canvas.width,t.canvas.height))}function A0(t,e,n){ke(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,n)),ke(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0))}function PS(t,e){ke(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,e)),ke(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0))}function qh(t){const e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+yH(t,e))}function yH(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function ji(t,e,n){const s=ke(t,()=>e());if(s==null)throw new Error(n);return s}function xH(t,e){const n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+t.TEXTURE0;if(s<t.TEXTURE0||s>n){const o=`[gl.TEXTURE0, gl.TEXTURE${n}]`;throw new Error(`textureUnit must be in ${o}.`)}}function hu(t,e=2){return me(t.slice(0,t.length-e))}function pu(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function Kh(t){let e=[1,1,1];return t.length===0||t.length===1&&t[0]===1||(e=[hu(t),...pu(t)]),e}function vH(t,e=!1){let n=ue().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=ue().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&ue().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=n/2),e&&(n=n*2,s=s*2,t=t.map((a,l)=>l>=t.length-2?Mx(t[l]):t[l]),t.length===1&&(t=[2,t[0]])),t.length!==2&&(t=Gi(t).newShape);let o=me(t),r=null;t.length<=1&&o<=n?r=[1,o]:t.length===2&&t[0]<=n&&t[1]<=n?r=t:t.length===3&&t[0]*t[1]<=n&&t[2]<=n?r=[t[0]*t[1],t[2]]:t.length===3&&t[0]<=n&&t[1]*t[2]<=n?r=[t[0],t[1]*t[2]]:t.length===4&&t[0]*t[1]*t[2]<=n&&t[3]<=n?r=[t[0]*t[1]*t[2],t[3]]:t.length===4&&t[0]<=n&&t[1]*t[2]*t[3]<=n&&(r=[t[0],t[1]*t[2]*t[3]]);const i=r!=null&&Math.max(...r)>s&&Math.min(...r)<=(e?2:1)&&Math.min(...r)>0;if(r==null||i)if(e){const a=hu(t);let l=2,u=2;t.length&&([l,u]=pu(t)),o=a*(l/2)*(u/2),r=H0(o).map(d=>d*2)}else r=H0(o);return r}function a0(t){return t%2===0}function Ap(t,e){if(t=t.slice(-2),e=e.slice(-2),lt(t,e)||!t.length||!e.length||t[0]===0||t[1]===0||e[0]===0||e[1]===0)return!0;if(t.length!==e.length){const n=t[t.length-1],s=e[e.length-1];if(n===s||a0(n)&&a0(s)&&(t[0]===1||e[0]===1))return!0}return t[1]===e[1]&&a0(t[0])&&a0(e[0])}let R0,$0;function bH(t){if(R0==null){const e=Er(t);R0=e.getParameter(e.MAX_TEXTURE_SIZE)}return R0}function kIe(){R0=null}function AIe(){$0=null}function wH(t){if($0==null){const e=Er(t);$0=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,$0)}function CH(t){if(t===0)return 0;let e;const n=Er(t);return Ro(n,"EXT_disjoint_timer_query_webgl2")&&t===2?e=2:Ro(n,"EXT_disjoint_timer_query")?e=1:e=0,e}function Ro(t,e){return t.getExtension(e)!=null}function LS(t){try{if(Er(t)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function TH(t){if(t===0)return!1;const e=Er(t);if(t===1){if(!Ro(e,"OES_texture_float"))return!1}else if(!Ro(e,"EXT_color_buffer_float"))return!1;return VS(e)}function SH(t){if(t===0)return!1;const e=Er(t);if(t===1){if(!Ro(e,"OES_texture_float")||!Ro(e,"WEBGL_color_buffer_float"))return!1}else{if(Ro(e,"EXT_color_buffer_float"))return VS(e);const s="EXT_color_buffer_half_float";if(Ro(e,s)){const o=e.getExtension(s);return RIe(e,o)}return!1}return VS(e)}function VS(t){const e=_A(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);const i=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(r),i}function RIe(t,e){const n=_A(t,e),s=t.createTexture();t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0);const a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(s),t.deleteFramebuffer(i),a}function NH(t){return t!==2?!1:Er(t).fenceSync!=null}function Tf(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&L(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}const $Ie=Object.freeze(Object.defineProperty({__proto__:null,assertNotComplex:Tf,bindCanvasToFramebuffer:IIe,bindColorTextureToFramebuffer:A0,bindTextureToProgramUniformSampler:gH,bindTextureUnit:hH,bindVertexBufferToProgramAttribute:OS,callAndCheck:ke,canBeRepresented:nH,createFragmentShader:rH,createFramebuffer:fH,createProgram:iH,createStaticIndexBuffer:uH,createStaticVertexBuffer:lH,createTexture:cH,createVertexShader:oH,getBatchDim:hu,getExtensionOrThrow:Wh,getFramebufferErrorMessage:yH,getMaxTexturesInShader:wH,getNumChannels:NIe,getProgramUniformLocation:mH,getProgramUniformLocationOrThrow:pH,getRowsCols:pu,getShapeAs3D:Kh,getTextureShapeFromLogicalShape:vH,getWebGLDisjointQueryTimerVersion:CH,getWebGLErrorMessage:sH,getWebGLMaxTextureSize:bH,hasExtension:Ro,isCapableOfRenderingToFloatTexture:TH,isDownloadFloatTextureEnabled:SH,isReshapeFree:Ap,isWebGLFenceEnabled:NH,isWebGLVersionEnabled:LS,linkProgram:aH,logShaderSourceAndInfoLog:MA,resetMaxTextureSize:kIe,resetMaxTexturesInShader:AIe,unbindColorTextureFromFramebuffer:PS,unbindTextureUnit:EIe,validateFramebuffer:qh,validateProgram:k0,validateTextureSize:dH},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Le=ue();Le.registerFlag("HAS_WEBGL",()=>Le.getNumber("WEBGL_VERSION")>0);Le.registerFlag("WEBGL_VERSION",()=>LS(2)?2:LS(1)?1:0);Le.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Le.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Le.get("WEBGL_VERSION")===2);Le.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Le.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Le.registerFlag("WEBGL_PACK",()=>Le.getBool("HAS_WEBGL"));Le.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Le.getBool("WEBGL_PACK"));Le.registerFlag("WEBGL_PACK_CLIP",()=>Le.getBool("WEBGL_PACK"));Le.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Le.getBool("WEBGL_PACK"));Le.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Le.getBool("WEBGL_PACK"));Le.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Le.getBool("WEBGL_PACK"));Le.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Le.getBool("WEBGL_PACK"));Le.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Le.getBool("WEBGL_PACK"));Le.registerFlag("WEBGL_PACK_REDUCE",()=>Le.getBool("WEBGL_PACK"));Le.registerFlag("WEBGL_LAZILY_UNPACK",()=>Le.getBool("WEBGL_PACK"));Le.registerFlag("WEBGL_CONV_IM2COL",()=>Le.getBool("WEBGL_PACK"));Le.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>Le.getBool("WEBGL_PACK"));Le.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>bH(Le.getNumber("WEBGL_VERSION")));Le.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>wH(Le.getNumber("WEBGL_VERSION")));Le.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const t=Le.getNumber("WEBGL_VERSION");return t===0?0:CH(t)});Le.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Le.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!YN());Le.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>TH(Le.getNumber("WEBGL_VERSION")));Le.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Le.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Le.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Le.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>SH(Le.getNumber("WEBGL_VERSION")));Le.registerFlag("WEBGL_FENCE_API_ENABLED",()=>NH(Le.getNumber("WEBGL_VERSION")));Le.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Le.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Le.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)});Le.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>YN()?1:-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)});Le.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);Le.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);Le.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);Le.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);Le.registerFlag("WEBGL_EXP_CONV",()=>!1);Le.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Le.getBool("IS_TEST"));Le.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);Le.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);Le.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);Le.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ls(){let t,e,n,s,o,r,i,a,l,u;return ue().getNumber("WEBGL_VERSION")===2?(t="#version 300 es",e="in",n="out",s="in",o="texture",r="outputColor",i="out vec4 outputColor;",a=ue().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",u=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(t="",e="attribute",n="varying",s="varying",o="texture2D",r="gl_FragColor",i="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,u=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:t,attribute:e,varyingVs:n,varyingFs:s,texture2D:o,output:r,defineOutput:i,defineSpecialNaN:a,defineSpecialInf:l,defineRound:u}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Au(t,e,n="index"){const s=ze(e);return s.map((o,r)=>{const i=`int ${t[r]} = ${n} / ${o}`,a=r===s.length-1?`int ${t[r+1]} = ${n} - ${t[r]} * ${o}`:`index -= ${t[r]} * ${o}`;return`${i}; ${a};`}).join("")}function Qb(t,e,n="index"){const s=ze(e);return s.map((o,r)=>{const i=`int ${t[r]} = ${n} / outShapeStrides[${r}]`,a=r===s.length-1?`int ${t[r+1]} = ${n} - ${t[r]} * outShapeStrides[${r}]`:`index -= ${t[r]} * outShapeStrides[${r}]`;return`${i}; ${a};`}).join("")}function DIe(t,e){const n=t.length,s=t.map(r=>`${e}[${r}]`),o=new Array(n-1);o[n-2]=s[n-1];for(let r=n-3;r>=0;--r)o[r]=`(${o[r+1]} * ${s[r+1]})`;return o}function _Ie(t,e,n="index"){const s=t.map((r,i)=>i),o=DIe(s,e);return o.map((r,i)=>{const a=`int ${t[i]} = ${n} / ${o[i]}`,l=i===o.length-1?`int ${t[i+1]} = ${n} - ${t[i]} * ${o[i]}`:`index -= ${t[i]} * ${o[i]}`;return`${a}; ${l};`}).join("")}function FA(t){const e=ze(t).map(n=>n.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function OA(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const EH=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:IH}=aU;function MIe(t,e,n){const s=[];if(t.forEach(x=>{const b=me(x.shapeInfo.logicalShape);if(x.shapeInfo.isUniform?s.push(`uniform float ${x.name}${b>1?`[${b}]`:""};`):(s.push(`uniform sampler2D ${x.name};`),s.push(`uniform int offset${x.name};`)),n.enableShapeUniforms){const{uniformShape:w}=PA(n.packedInputs,x.shapeInfo.logicalShape,x.shapeInfo.texShape);switch(w.length){case 1:s.push(`uniform int ${x.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${x.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${x.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${x.name}Shape;`);break}s.push(`uniform ivec2 ${x.name}TexShape;`)}}),n.enableShapeUniforms){switch(e.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(x=>{s.push(`uniform ${x.type} ${x.name}${x.arrayIndex?`[${x.arrayIndex}]`:""};`)});const o=s.join(`
`),r=t.map(x=>FIe(x,e,n.packedInputs,n.enableShapeUniforms)).join(`
`),i=e.texShape,a=Ls(),l=LIe(a);let u,d,h=BIe(a);return e.isPacked?(u=OIe(e.logicalShape,i,n.enableShapeUniforms),d=zIe(a)):(u=PIe(e.logicalShape,i,n.enableShapeUniforms),d=VIe(a)),n.packedInputs&&(h+=WIe),[h,l,d,o,u,r,n.userCode].join(`
`)}function Sf(t,e=!1){const n=t.shapeInfo.logicalShape;switch(n.length){case 0:return ske(t,e);case 1:return rke(t,e);case 2:return ake(t,e);case 3:return uke(t,e);case 4:return dke(t,e);case 5:return fke(t);case 6:return hke(t);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function kH(t,e){switch(t.shapeInfo.logicalShape.length){case 0:return nke(t);case 1:return oke(t,e);case 2:return ike(t,e);case 3:return lke(t,e);default:return cke(t,e)}}function FIe(t,e,n=!1,s){let o="";n?o+=kH(t,s):o+=Sf(t,s);const r=t.shapeInfo.logicalShape,i=e.logicalShape;return r.length<=i.length&&(n?o+=pke(t,e):o+=mke(t,e)),o}function OIe(t,e,n){switch(t.length){case 0:return AH();case 1:return qIe(t,e,n);case 2:return eke(t,e,n);case 3:return XIe(t,e,n);default:return JIe(t,e,n)}}function PIe(t,e,n){switch(t.length){case 0:return AH();case 1:return KIe(t,e,n);case 2:return tke(t,e,n);case 3:return YIe(t,e,n);case 4:return jIe(t,e,n);case 5:return ZIe(t,e);case 6:return QIe(t,e);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}function LIe(t){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${t.texture2D}(textureSampler, uv).r;
    }
  `}function VIe(t){return`
    void setOutput(float val) {
      ${t.output} = vec4(val, 0, 0, 0);
    }
  `}function zIe(t){return`
    void setOutput(vec4 val) {
      ${t.output} = val;
    }
  `}function BIe(t){return`${t.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${t.varyingFs} vec2 resultUV;
    ${t.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${t.defineSpecialNaN}
    ${t.defineSpecialInf}
    ${t.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${UIe}
    ${GIe}
    ${HIe}
  `}const UIe=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,GIe=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,HIe=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,WIe=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function AH(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function qIe(t,e,n){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return s[0]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function KIe(t,e,n){return e[0]===1?n?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?n?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function XIe(t,e,n){if(n)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],o=Math.ceil(t[2]/2),r=o*Math.ceil(t[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${r};
      index -= b * ${r};

      int r = 2 * (index / ${o});
      int c = imod(index, ${o}) * 2;

      return ivec3(b, r, c);
    }
  `}function YIe(t,e,n){if(n)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${Qb(["r","c","d"],t)}
    return ivec3(r, c, d);
  }
`;const s=Au(["r","c","d"],t);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function JIe(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],o=Math.ceil(t[t.length-1]/2),r=o*Math.ceil(t[t.length-2]/2);let i=r,a="",l="b, r, c";for(let u=2;u<t.length-1;u++)i*=t[t.length-u-1],a=`
      int b${u} = index / ${i};
      index -= b${u} * ${i};
    `+a,l=`b${u}, `+l;return`
    ivec${t.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${a}

      int b = index / ${r};
      index -= b * ${r};

      int r = 2 * (index / ${o});
      int c = imod(index, ${o}) * 2;

      return ivec${t.length}(${l});
    }
  `}function jIe(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${Qb(["r","c","d","d2"],t)}
      return ivec4(r, c, d, d2);
    }
  `;const s=Au(["r","c","d","d2"],t);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function ZIe(t,e){const n=Au(["r","c","d","d2","d3"],t);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function QIe(t,e){const n=Au(["r","c","d","d2","d3","d4"],t);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function eke(t,e,n){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(lt(t,e))return n?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const o=Math.ceil(t[1]/2);return n?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${o});
      int c = imod(index, ${o}) * 2;

      return ivec2(r, c);
    }
  `}function tke(t,e,n){return lt(t,e)?n?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:t[1]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:t[0]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:n?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${t[1]};
      int c = index - r * ${t[1]};
      return ivec2(r, c);
    }
  `}function Ru(t){return`offset${t}`}function nke(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),s=Ls();return`
    vec4 ${n}() {
      return ${s.texture2D}(${e}, halfCR);
    }
  `}function ske(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`float ${s}() {return ${n};}`;const[o,r]=t.shapeInfo.texShape;if(o===1&&r===1)return`
      float ${s}() {
        return sampleTexture(${n}, halfCR);
      }
    `;const i=Ru(n);if(e)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${i});
      return sampleTexture(${n}, uv);
    }
  `;const[a,l]=t.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${i});
      return sampleTexture(${n}, uv);
    }
  `}function oke(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t.shapeInfo.texShape,r=Ls();if(e)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${r.texture2D}(${n}, uv);
    }
  `;const i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${i[0]}, ${i[1]}, index);
      return ${r.texture2D}(${n}, uv);
    }
  `}function rke(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${Nf(t)}
      }
    `;const o=t.shapeInfo.texShape,r=o[0],i=o[1];if(i===1&&r===1)return`
      float ${s}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;const a=Ru(n);return i===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${r}.0);
        return sampleTexture(${n}, uv);
      }
    `:r===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${i}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:e?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${a});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${r}, ${i}, index + ${a});
      return sampleTexture(${n}, uv);
    }
  `}function ike(t,e){const n=t.shapeInfo.logicalShape,s=t.name,o="get"+s.charAt(0).toUpperCase()+s.slice(1),r=t.shapeInfo.texShape,i=r[0],a=r[1],l=Ls();if(r!=null&&lt(n,r))return e?`
      vec4 ${o}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${l.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${o}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${i}.0);

        return ${l.texture2D}(${s}, uv);
      }
    `;if(e)return`
    vec4 ${o}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `;const u=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],d=Math.ceil(n[1]/2);return`
    vec4 ${o}(int row, int col) {
      vec2 uv = packedUVfrom2D(${d}, ${u[0]}, ${u[1]}, row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `}function ake(t,e){const n=t.shapeInfo.logicalShape,s=t.name,o="get"+s.charAt(0).toUpperCase()+s.slice(1),r=t.shapeInfo.texShape;if(r!=null&&lt(n,r)){if(e)return`
      float ${o}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const p=r[0],x=r[1];return`
    float ${o}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${x}.0, ${p}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:i,keptDims:a}=Gi(n),l=i;if(l.length<n.length){const p=Ef(t,l),x=["row","col"];return`
      ${Sf(p,e)}
      float ${o}(int row, int col) {
        return ${o}(${If(x,a)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${o}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${Nf(t)}
      }
    `;const u=r[0],d=r[1],h=Ru(s);return d===1?e?`
      float ${o}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${o}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${u}.0);
      return sampleTexture(${s}, uv);
    }
  `:u===1?e?`
      float ${o}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${o}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${d}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:e?`
      float ${o}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${h};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${o}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${h};
    vec2 uv = uvFromFlat(${u}, ${d}, index);
    return sampleTexture(${s}, uv);
  }
`}function lke(t,e){const n=t.shapeInfo.logicalShape,s=t.name,o="get"+s.charAt(0).toUpperCase()+s.slice(1),r=t.shapeInfo.texShape,i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];if(n[0]===1){const p=n.slice(1),x=[1,2],b=Ef(t,p),w=["b","row","col"];return`
        ${kH(b,e)}
        vec4 ${o}(int b, int row, int col) {
          return ${o}(${If(w,x)});
        }
      `}const a=Ls();if(e)return`
    vec4 ${o}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `;const l=i[0],u=i[1],d=Math.ceil(n[2]/2),h=d*Math.ceil(n[1]/2);return`
    vec4 ${o}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${u}, ${h}, ${d}, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `}function uke(t,e){const n=t.shapeInfo.logicalShape,s=t.name,o="get"+s.charAt(0).toUpperCase()+s.slice(1),r=n[1]*n[2],i=n[2],{newShape:a,keptDims:l}=Gi(n),u=a;if(u.length<n.length){const w=Ef(t,u),C=["row","col","depth"];return`
        ${Sf(w,e)}
        float ${o}(int row, int col, int depth) {
          return ${o}(${If(C,l)});
        }
      `}if(t.shapeInfo.isUniform)return`
      float ${o}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${r}, ${i}, 1)));
        ${Nf(t)}
      }
    `;const d=t.shapeInfo.texShape,h=d[0],p=d[1],x=t.shapeInfo.flatOffset;if(p===r&&x==null)return e?`
      float ${o}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${o}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${i}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${p}.0, ${h}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(p===i&&x==null)return e?`
      float ${o}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${o}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${p}.0, ${h}.0);
      return sampleTexture(${s}, uv);
    }
  `;const b=Ru(s);return e?`
    float ${o}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${b};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${o}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${r} + col * ${i} + depth + ${b};
        vec2 uv = uvFromFlat(${h}, ${p}, index);
        return sampleTexture(${s}, uv);
      }
  `}function cke(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),o=Ls();if(e)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${n}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${o.texture2D}(${n}, uv);
    }
  `;const r=t.shapeInfo.logicalShape,i=r.length,a=t.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],u=l[0],d=l[1],h=Math.ceil(r[i-1]/2);let p=h*Math.ceil(r[i-2]/2),x="int b, int row, int col",b=`b * ${p} + (row / 2) * ${h} + (col / 2)`;for(let w=2;w<i-1;w++)x=`int b${w}, `+x,p*=r[i-w-1],b=`b${w} * ${p} + `+b;return`
    vec4 ${s}(${x}) {
      int index = ${b};
      int texR = index / ${d};
      int texC = index - texR * ${d};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}, ${u});
      return ${o.texture2D}(${n}, uv);
    }
  `}function dke(t,e){const n=t.shapeInfo.logicalShape,s=t.name,o="get"+s.charAt(0).toUpperCase()+s.slice(1),r=n[3],i=n[2]*r,a=n[1]*i,{newShape:l,keptDims:u}=Gi(n);if(l.length<n.length){const N=Ef(t,l),I=["row","col","depth","depth2"];return`
      ${Sf(N,e)}
      float ${o}(int row, int col, int depth, int depth2) {
        return ${o}(${If(I,u)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${o}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${i}, ${r}, 1)));
        ${Nf(t)}
      }
    `;const d=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,p=h[0],x=h[1],b=`int stride2 = ${s}Shape[3];`,w=`int stride1 = ${s}Shape[2] * stride2;`,C=`int stride0 = ${s}Shape[1] * stride1;`;if(x===a&&d==null)return e?`
      float ${o}(int row, int col, int depth, int depth2) {
        ${b}
        ${w}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${o}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${i}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${x}.0, ${p}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(x===r&&d==null)return e?`
      float ${o}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${o}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${x}.0, ${p}.0);
        return sampleTexture(${s}, uv);
      }
    `;const T=Ru(s);return e?`
    float ${o}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${b}
      ${w}
      ${C}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${T});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${o}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} +
          depth * ${r} + depth2;
      vec2 uv = uvFromFlat(${p}, ${x}, index + ${T});
      return sampleTexture(${s}, uv);
    }
  `}function fke(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e[4],r=e[3]*o,i=e[2]*r,a=e[1]*i,{newShape:l,keptDims:u}=Gi(e);if(l.length<e.length){const w=Ef(t,l),C=["row","col","depth","depth2","depth3"];return`
      ${Sf(w)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${If(C,u)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${i}, ${r}, ${o})) +
          depth3;
        ${Nf(t)}
      }
    `;const d=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,p=h[0],x=h[1];if(x===a&&d==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${i}, ${r}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${x}.0, ${p}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(x===o&&d==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${x}.0, ${p}.0);
        return sampleTexture(${n}, uv);
      }
    `;const b=Ru(n);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} + depth * ${r} +
          depth2 * ${o} + depth3 + ${b};
      vec2 uv = uvFromFlat(${p}, ${x}, index);
      return sampleTexture(${n}, uv);
    }
  `}function hke(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:o,keptDims:r}=Gi(e);if(o.length<e.length){const C=Ef(t,o),T=["row","col","depth","depth2","depth3","depth4"];return`
      ${Sf(C)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${If(T,r)});
      }
    `}const i=e[5],a=e[4]*i,l=e[3]*a,u=e[2]*l,d=e[1]*u;if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${d}, ${u}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${i}, 1)));
        ${Nf(t)}
      }
    `;const h=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,x=p[0],b=p[1];if(b===d&&h==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${u}, ${l}, ${a}, ${i})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${b}.0, ${x}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(b===i&&h==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${b}.0, ${x}.0);
        return sampleTexture(${n}, uv);
      }
    `;const w=Ru(n);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${d} + col * ${u} + depth * ${l} +
          depth2 * ${a} + depth3 * ${i} + depth4 + ${w};
      vec2 uv = uvFromFlat(${x}, ${b}, index);
      return sampleTexture(${n}, uv);
    }
  `}function Nf(t){const e=t.name,n=me(t.shapeInfo.logicalShape);return n<2?`return ${e};`:`
    for (int i = 0; i < ${n}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function pke(t,e){const n=t.name,s=n.charAt(0).toUpperCase()+n.slice(1),o="get"+s+"AtOutCoords",r=t.shapeInfo.logicalShape.length,i=e.logicalShape.length,a=IH(t.shapeInfo.logicalShape,e.logicalShape),l=Pt(i),u=i-r;let d;const h=["x","y","z","w","u","v"];r===0?d="":i<2&&a.length>=1?d="coords = 0;":d=a.map(N=>`coords.${h[N+u]} = 0;`).join(`
`);let p="";i<2&&r>0?p="coords":p=t.shapeInfo.logicalShape.map((N,I)=>`coords.${h[I+u]}`).join(", ");let x="return outputValue;";const w=me(t.shapeInfo.logicalShape)===1,T=me(e.logicalShape)===1;if(r===1&&!w&&!T)x=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(w&&!T)i===1?x=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:x=`
        return vec4(outputValue.x);
      `;else if(a.length){const N=r-2,I=r-1;a.indexOf(N)>-1&&a.indexOf(I)>-1?x="return vec4(outputValue.x);":a.indexOf(N)>-1?x="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(I)>-1&&(x="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${o}() {
      ${l} coords = getOutputCoords();
      ${d}
      vec4 outputValue = get${s}(${p});
      ${x}
    }
  `}function mke(t,e){const n=t.name,s=n.charAt(0).toUpperCase()+n.slice(1),o="get"+s+"AtOutCoords",r=e.texShape,i=t.shapeInfo.texShape,a=t.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!t.shapeInfo.isUniform&&a===l&&t.shapeInfo.flatOffset==null&&lt(i,r))return`
      float ${o}() {
        return sampleTexture(${n}, resultUV);
      }
    `;const u=Pt(l),d=IH(t.shapeInfo.logicalShape,e.logicalShape),h=l-a;let p;const x=["x","y","z","w","u","v"];a===0?p="":l<2&&d.length>=1?p="coords = 0;":p=d.map(w=>`coords.${x[w+h]} = 0;`).join(`
`);let b="";return l<2&&a>0?b="coords":b=t.shapeInfo.logicalShape.map((w,C)=>`coords.${x[C+h]}`).join(", "),`
    float ${o}() {
      ${u} coords = getOutputCoords();
      ${p}
      return get${s}(${b});
    }
  `}function Pt(t){if(t<=1)return"int";if(t===2)return"ivec2";if(t===3)return"ivec3";if(t===4)return"ivec4";if(t===5)return"ivec5";if(t===6)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function PA(t,e,n){const{newShape:s,keptDims:o}=Gi(e),r=e.length,i=t&&r===3&&e[0]===1,a=i?e.slice(1):s,l=!t&&r>1&&!lt(e,n)&&s.length<r||i;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:o}}function Ef(t,e){const n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function If(t,e){return e.map(n=>t[n]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gke(t,e,n,s){const o=n.map((d,h)=>{const p={logicalShape:d.shape,texShape:d.isUniform?null:d.texData.texShape,isUniform:d.isUniform,isPacked:d.isUniform?!1:d.texData.isPacked,flatOffset:null};return d.texData!=null&&d.texData.slice!=null&&d.texData.slice.flatOffset>0&&(p.flatOffset=d.texData.slice.flatOffset),{name:e.variableNames[h],shapeInfo:p}}),r=o.map(d=>d.shapeInfo),i={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},a=MIe(o,i,e),l=rH(t.gl,a),u=t.createProgram(l);return ue().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:r,outShapeInfo:i,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(t.buildVao(u),Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:r,outShapeInfo:i},RH(t,e,u)))}function RH(t,e,n){const s=[],o=[];let r,i,a,l=null,u=null;u=t.getUniformLocation(n,"NAN",!1),ue().getNumber("WEBGL_VERSION")===1&&(l=t.getUniformLocation(n,"INFINITY",!1));const d=!1;for(const h of e.variableNames){const p={name:h,uniform:t.getUniformLocation(n,h,d),offset:t.getUniformLocation(n,`offset${h}`,d)};e.enableShapeUniforms&&(p.shape=t.getUniformLocation(n,`${h}Shape`,d),p.texShape=t.getUniformLocation(n,`${h}TexShape`,d)),s.push(p)}if(e.enableShapeUniforms&&(r=t.getUniformLocation(n,"outShape",d),a=t.getUniformLocation(n,"outShapeStrides",d),i=t.getUniformLocation(n,"outTexShape",d)),e.customUniforms)for(const h of e.customUniforms)o.push(t.getUniformLocation(n,h.name,d));return{variablesLocations:s,customUniformLocations:o,infLoc:l,nanLoc:u,outShapeLocation:r,outShapeStridesLocation:a,outTexShapeLocation:i}}function iP(t,e){if(t.length!==e.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${e.length} inputs`);t.forEach((n,s)=>{const o=n.logicalShape,r=e[s],i=r.shape;if(!lt(o,i))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${o} and ${i} must match`);if(n.isUniform&&r.isUniform)return;const a=n.texShape,l=r.isUniform?null:r.texData.texShape;if(!lt(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function yke(t,e,n,s,o){e.program.enableShapeUniforms||(iP(e.inShapeInfos,n),iP([e.outShapeInfo],[s]));const r=s.texData.texture,i=s.texData.texShape;s.texData.isPacked?t.setOutputPackedMatrixTexture(r.texture,i[0],i[1]):t.setOutputMatrixTexture(r.texture,i[0],i[1]),t.setProgram(e.webGLProgram),t.bindVertexArray(e.webGLProgram.vao),ue().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&t.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&t.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<n.length;++l){const u=n[l],{uniform:d,offset:h,shape:p,texShape:x}=e.variablesLocations[l];if(p){const{uniformShape:b}=PA(e.program.packedInputs,u.shape,u.texData.texShape);switch(b.length){case 1:t.gl.uniform1iv(p,new Int32Array(b));break;case 2:t.gl.uniform2iv(p,new Int32Array(b));break;case 3:t.gl.uniform3iv(p,new Int32Array(b));break;case 4:t.gl.uniform4iv(p,new Int32Array(b));break}}if(x&&t.gl.uniform2i(x,u.texData.texShape[0],u.texData.texShape[1]),d!=null){if(u.isUniform){if(me(u.shape)<2)t.gl.uniform1f(d,u.uniformValues[0]);else{let b=u.uniformValues;b instanceof Float32Array||(b=new Float32Array(b)),t.gl.uniform1fv(d,b)}continue}u.texData.slice!=null&&h!=null&&t.gl.uniform1i(h,u.texData.slice.flatOffset),t.setInputMatrixTexture(u.texData.texture.texture,d,l)}}const a=e.outShapeLocation;if(a)switch(s.shape.length){case 1:t.gl.uniform1iv(a,new Int32Array(s.shape));break;case 2:t.gl.uniform2iv(a,new Int32Array(s.shape));break;case 3:t.gl.uniform3iv(a,new Int32Array(s.shape));break;case 4:t.gl.uniform4iv(a,new Int32Array(s.shape));break}if(e.outShapeStridesLocation){const l=ze(s.shape);switch(s.shape.length){case 2:t.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:t.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:t.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&t.gl.uniform2i(e.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),e.program.customUniforms&&o)for(let l=0;l<e.program.customUniforms.length;++l){const u=e.program.customUniforms[l],d=e.customUniformLocations[l],h=o[l];if(u.type==="float")t.gl.uniform1fv(d,h);else if(u.type==="vec2")t.gl.uniform2fv(d,h);else if(u.type==="vec3")t.gl.uniform3fv(d,h);else if(u.type==="vec4")t.gl.uniform4fv(d,h);else if(u.type==="int")t.gl.uniform1iv(d,h);else if(u.type==="ivec2")t.gl.uniform2iv(d,h);else if(u.type==="ivec3")t.gl.uniform3iv(d,h);else if(u.type==="ivec4")t.gl.uniform4iv(d,h);else throw Error(`uniform type ${u.type} is not supported yet.`)}t.executeProgram()}function xke(t,e,n){let s="";e.concat(n).forEach(i=>{const a=i.texData!=null&&i.texData.slice!=null&&i.texData.slice.flatOffset>0;if(t.enableShapeUniforms&&!i.isUniform){const l=i.texData.texShape,{useSqueezeShape:u,uniformShape:d,keptDims:h}=PA(t.packedInputs,i.shape,l);let p="",x="",b="";if(d.length===1&&t.packedInputs){const A=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];p=`${A[0]>1}_${A[1]>1}`}else if(d.length===2&&!t.packedInputs)x=`${d[0]>1}_${d[1]>1}`;else if(d.length>2&&!t.packedInputs){const A=ze(d);b=`${A[0]===l[1]}_${A[A.length-1]===l[1]}`}const w=i.shape.length,C=d.length===2&&lt(i.shape,l),T=me(i.shape)===1,N=ou(i.shape,n.shape),I=!t.packedInputs&&w===n.shape.length&&lt(l,n.texData.texShape),k=t.packedInputs||d.length>2?"":`${l[0]>1}_${l[1]>1}`;s+=`${w}_${I}_${u?h:""}_${d.length}_${T}_${N}_${C}_${p}_${x}_${b}_${k}_${a}`}else{const l=i.isUniform?"uniform":i.texData.texShape;s+=`${i.shape}_${l}_${a}`}});const o=t.userCode;let r=t.constructor.name;return r+="_"+s+"_"+o+`${ue().getNumber("WEBGL_VERSION")}`,r}function Cs(t){return ue().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&t<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vke{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=kp.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=Ls();this.outputShape=e,this.enableShapeUniforms=Cs(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Qb(["r","c","d"],e):Au(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bke{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=kp.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=Ls();this.outputShape=e,this.enableShapeUniforms=Cs(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Qb(["r","c","d"],e):Au(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wke{constructor(e){this.variableNames=["A"],this.outTexUsage=Ao.DOWNLOAD;const n=Ls();this.outputShape=e,this.userCode=`
      ${EH}

      void main() {
        float x = getAAtOutCoords();
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cke{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Ao.DOWNLOAD;const n=Ls();this.outputShape=e,this.userCode=`
      ${EH}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tke={R:0,G:1,B:2,A:3};class aP{constructor(e,n=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const o=Ls();this.outputShape=e,this.enableShapeUniforms=Cs(this.outputShape.length);let r="result";n&&(r="floor(result * 255. + 0.5)");let i="";for(let a=0;a<s.length;a++){const l=s[a];i+=`
          if(offset == ${a}) {
            result = values[${Tke[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?OA():FA(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${o.texture2D}(A, uv);
          ${i}
        }
        ${o.output} = vec4(${r}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ske{constructor(e,n=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=Ls();this.outputShape=e,this.enableShapeUniforms=Cs(this.outputShape.length);let o="",r="result";n&&(r="floor(result * 255. + 0.5)");for(let i=0;i<=1;i++)for(let a=0;a<=1;a++){const l=i*2+a;o+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${i} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${i};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?OA():FA(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${o}

          ${s.output} = ${r};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $H(t){const e=Ls(),n=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return oH(t,n)}function DH(t){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return lH(t,e)}function _H(t){const e=new Uint16Array([0,1,2,2,1,3]);return uH(t,e)}function Eg(t,e,n,s,o,r){dH(e,n);const i=cH(t),a=t.TEXTURE_2D;return ke(t,()=>t.bindTexture(a,i)),ke(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)),ke(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),ke(t,()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST)),ke(t,()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST)),ue().getNumber("WEBGL_VERSION")===1?ke(t,()=>t.texImage2D(a,0,s,e,n,0,o,r,null)):ke(t,()=>t.texStorage2D(a,1,s,e,n)),ke(t,()=>t.bindTexture(t.TEXTURE_2D,null)),{texture:i,texShape:[n,e]}}function LA(t){return t.internalFormatFloat}function MH(t,e,n,s){const[o,r]=Ng(e,n);return Eg(t,o,r,LA(s),s.textureFormatFloat,t.FLOAT)}function VA(t){return t.internalFormatHalfFloat}function FH(t,e,n,s){const[o,r]=Ng(e,n);return Eg(t,o,r,VA(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function zA(t){return t.downloadTextureFormat}function OH(t,e,n,s){const[o,r]=Ng(e,n);return Eg(t,o,r,zA(s),t.RGBA,t.UNSIGNED_BYTE)}function BA(t){return t.internalFormatPackedFloat}function PH(t,e,n,s){const[o,r]=Cf(e,n);return Eg(t,o,r,BA(s),t.RGBA,t.FLOAT)}function UA(t){return t.internalFormatPackedHalfFloat}function LH(t,e,n,s){const[o,r]=Cf(e,n);return Eg(t,o,r,UA(s),t.RGBA,s.textureTypeHalfFloat)}function VH(t,e,n){return ke(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),OS(t,e,"clipSpacePos",n,3,20,0)&&OS(t,e,"uv",n,2,20,12)}function zH(t,e,n,s,o,r){ke(t,()=>t.bindTexture(t.TEXTURE_2D,e));let i,a,l;o instanceof Uint8Array?(i=new Uint8Array(n*s*4),a=t.UNSIGNED_BYTE,l=t.RGBA):(i=new Float32Array(n*s*4),a=t.FLOAT,l=r.internalFormatPackedFloat),i.set(o),ue().getNumber("WEBGL_VERSION")===2?ke(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,s,t.RGBA,a,i)):ke(t,()=>t.texImage2D(t.TEXTURE_2D,0,l,n,s,0,t.RGBA,a,i)),ke(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function BH(t,e,n){ke(t,()=>t.bindTexture(t.TEXTURE_2D,e)),n.data instanceof Uint8Array?ue().getNumber("WEBGL_VERSION")===2?ke(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n.width,n.height,t.RGBA,t.UNSIGNED_BYTE,n.data)):ke(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,n.data)):ue().getNumber("WEBGL_VERSION")===2?ke(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,n)):ke(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)),ke(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function UH(t,e,n,s){const o=t.createBuffer();ke(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,o));const a=4*4*e*n;return ke(t,()=>t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)),ke(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,0)),ke(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null)),o}function GH(t,e,n){const s=t,o=new Float32Array(n);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,o),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),o}function HH(t,e,n,s){const[o,r]=Ng(e,n),i=4,a=new Uint8Array(vIe(e*n,i));return ke(t,()=>t.readPixels(0,0,o,r,s.downloadTextureFormat,t.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function WH(t,e,n,s,o,r,i,a){const l=t,u=new Float32Array(bIe(r,i));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,u),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),u}function qH(t,e,n){const s=new Float32Array(e*n*4);return ke(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,s)),s}const Nke=Object.freeze(Object.defineProperty({__proto__:null,bindVertexProgramAttributeStreams:VH,createBufferFromOutputTexture:UH,createFloat16MatrixTexture:FH,createFloat16PackedMatrixTexture:LH,createFloat32MatrixTexture:MH,createIndexBuffer:_H,createPackedMatrixTexture:PH,createUnsignedBytesMatrixTexture:OH,createVertexBuffer:DH,createVertexShader:$H,downloadByteEncodedFloatMatrixFromOutputTexture:HH,downloadFloat32MatrixFromBuffer:GH,downloadMatrixFromPackedOutputTexture:qH,downloadPackedMatrixFromBuffer:WH,getInternalFormatForFloat16MatrixTexture:VA,getInternalFormatForFloat16PackedMatrixTexture:UA,getInternalFormatForFloat32MatrixTexture:LA,getInternalFormatForPackedMatrixTexture:BA,getInternalFormatForUnsignedBytesMatrixTexture:zA,uploadDenseMatrixToTexture:zH,uploadPixelDataToTexture:BH},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class D0{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const n=ue().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,tH(n,e)):this.gl=Er(n),e=this.gl,ue().getNumber("WEBGL_VERSION")===2){const r=e;this.createVertexArray=()=>ke(r,()=>r.createVertexArray()),this.bindVertexArray=i=>ke(r,()=>r.bindVertexArray(i)),this.deleteVertexArray=i=>ke(r,()=>r.deleteVertexArray(i)),this.getVertexArray=()=>ke(r,()=>r.getParameter(r.VERTEX_ARRAY_BINDING))}else if(e!=null){const r=e.getExtension("OES_vertex_array_object");if(r==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>ke(e,()=>r.createVertexArrayOES()),this.bindVertexArray=i=>ke(e,()=>r.bindVertexArrayOES(i)),this.deleteVertexArray=i=>ke(e,()=>r.deleteVertexArrayOES(i)),this.getVertexArray=()=>ke(e,()=>e.getParameter(r.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const o="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),ue().getNumber("WEBGL_VERSION")===1){const r="OES_texture_float",i="OES_texture_half_float";if(this.textureFloatExtension=Wh(this.gl,r),Ro(this.gl,i))this.textureHalfFloatExtension=Wh(this.gl,i);else if(ue().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),Ro(this.gl,o))this.colorBufferHalfFloatExtension=Wh(this.gl,o);else if(ue().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",Ro(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(Ro(this.gl,o))this.colorBufferHalfFloatExtension=this.gl.getExtension(o);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=DH(this.gl),this.indexBuffer=_H(this.gl),this.framebuffer=fH(this.gl),this.textureConfig=_A(this.gl,this.textureHalfFloatExtension)}get debug(){return ue().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;ke(e,()=>e.finish()),ke(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),ke(e,()=>e.deleteFramebuffer(this.framebuffer)),ke(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),ke(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),ke(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,n){return this.throwIfDisposed(),MH(this.gl,e,n,this.textureConfig)}createFloat16MatrixTexture(e,n){return this.throwIfDisposed(),FH(this.gl,e,n,this.textureConfig)}createUnsignedBytesMatrixTexture(e,n){return this.throwIfDisposed(),OH(this.gl,e,n,this.textureConfig)}uploadPixelDataToTexture(e,n){this.throwIfDisposed(),BH(this.gl,e,n)}uploadDenseMatrixToTexture(e,n,s,o){this.throwIfDisposed(),zH(this.gl,e,n,s,o,this.textureConfig)}createFloat16PackedMatrixTexture(e,n){return this.throwIfDisposed(),LH(this.gl,e,n,this.textureConfig)}createPackedMatrixTexture(e,n){return this.throwIfDisposed(),PH(this.gl,e,n,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(PS(this.gl,this.framebuffer),this.outputTexture=null),ke(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,n,s){return this.downloadMatrixDriver(e,()=>HH(this.gl,n,s,this.textureConfig))}downloadPackedMatrixFromBuffer(e,n,s,o,r,i){return WH(this.gl,e,n,s,o,r,i,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,n){return GH(this.gl,e,n)}createBufferFromTexture(e,n,s){this.bindTextureToFrameBuffer(e);const o=UH(this.gl,n,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),o}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let n,s;if(ue().getBool("WEBGL_FENCE_API_ENABLED")){const o=e,r=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),s=()=>{const i=o.clientWaitSync(r,0,0);return i===o.ALREADY_SIGNALED||i===o.CONDITION_SATISFIED},n=r}else ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(n,ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:n,isFencePassed:s}}downloadMatrixFromPackedTexture(e,n,s){return this.downloadMatrixDriver(e,()=>qH(this.gl,n,s))}createProgram(e){this.throwIfDisposed();const n=this.gl;this.vertexShader==null&&(this.vertexShader=$H(n));const s=iH(n);ke(n,()=>n.attachShader(s,this.vertexShader)),ke(n,()=>n.attachShader(s,e)),aH(n,s);const o=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&k0(n,o),o}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const n=this.gl;ke(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),VH(n,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(ke(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&k0(this.gl,this.program),ke(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,n,s=!0){return this.throwIfDisposed(),s?pH(this.gl,e,n):mH(this.gl,e,n)}getAttributeLocation(e,n){return this.throwIfDisposed(),ke(this.gl,()=>this.gl.getAttribLocation(e,n))}getUniformLocationNoThrow(e,n){return this.throwIfDisposed(),this.gl.getUniformLocation(e,n)}setInputMatrixTexture(e,n,s){this.throwIfDisposed(),this.throwIfNoProgram(),gH(this.gl,e,n,s)}setOutputMatrixTexture(e,n,s){this.setOutputMatrixTextureDriver(e,s,n)}setOutputPackedMatrixTexture(e,n,s){this.throwIfDisposed();const[o,r]=Cf(n,s);this.setOutputMatrixTextureDriver(e,o,r)}setOutputMatrixWriteRegion(e,n,s,o){this.setOutputMatrixWriteRegionDriver(s,e,o,n)}setOutputPackedMatrixWriteRegion(e,n,s,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&k0(this.gl,this.program),qh(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const n=this.getVertexArray();console.assert(n===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}ke(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),ke(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Wh(this.gl,ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,o=this.getQueryTimerExtensionWebGL2(),r=s.createQuery();return s.beginQuery(o.TIME_ELAPSED_EXT,r),r}const e=this.getQueryTimerExtensionWebGL1(),n=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,n),n}endQuery(){if(ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const n=this.gl,s=this.getQueryTimerExtensionWebGL2();n.endQuery(s.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await WT(()=>this.disposed||this.isQueryAvailable(e,ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,n){if(n===0)return null;if(n===2){const s=this.gl;return s.getQueryParameter(e,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,n){if(n===0)return!0;if(n===2){const s=this.gl,o=this.getQueryTimerExtensionWebGL2(),r=s.getQueryParameter(e,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),r&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),o=s.getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),o&&!this.disjoint}}pollFence(e){return new Promise(n=>{this.addItemToPoll(()=>e.isFencePassed(),()=>n())})}pollItems(){const e=Eke(this.itemsToPoll.map(n=>n.isDoneFn));for(let n=0;n<=e;++n){const{resolveFn:s}=this.itemsToPoll[n];s()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,n){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:n}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in ue().platform&&(s=ue().platform.setTimeoutCustom.bind(ue().platform)),WT(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),A0(this.gl,e,this.framebuffer),this.debug&&qh(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(A0(this.gl,this.outputTexture,this.framebuffer),this.debug&&qh(this.gl)):PS(this.gl,this.framebuffer)}downloadMatrixDriver(e,n){this.bindTextureToFrameBuffer(e);const s=n();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(e,n,s){this.throwIfDisposed();const o=this.gl;A0(o,e,this.framebuffer),this.debug&&qh(o),this.outputTexture=e,ke(o,()=>o.viewport(0,0,n,s)),ke(o,()=>o.scissor(0,0,n,s))}setOutputMatrixWriteRegionDriver(e,n,s,o){this.throwIfDisposed(),ke(this.gl,()=>this.gl.scissor(e,n,s,o))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function Eke(t){let e=0;for(;e<t.length&&t[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:Ike,bincountImpl:KH,bincountReduceImpl:kke,bitwiseAndImpl:Ake,castImpl:Rke,ceilImpl:$ke,concatImpl:Dke,equalImpl:_ke,expImpl:Mke,expm1Impl:Fke,floorImpl:Oke,gatherNdImpl:Pke,gatherV2Impl:Lke,greaterImpl:Vke,greaterEqualImpl:zke,lessImpl:Bke,lessEqualImpl:Uke,linSpaceImpl:Gke,logImpl:Hke,maxImpl:Wke,maximumImpl:qke,minimumImpl:Kke,multiplyImpl:Xke,negImpl:Yke,notEqualImpl:Jke,prodImpl:jke,raggedGatherImpl:Zke,raggedRangeImpl:Qke,raggedTensorToTensorImpl:eAe,rangeImpl:tAe,rsqrtImpl:nAe,scatterImpl:sAe,sigmoidImpl:oAe,simpleAbsImpl:XH,sliceImpl:rAe,sparseFillEmptyRowsImpl:iAe,sparseReshapeImpl:aAe,sparseSegmentReductionImpl:YH,sqrtImpl:lAe,staticRegexReplaceImpl:uAe,stridedSliceImpl:cAe,stringNGramsImpl:dAe,stringSplitImpl:fAe,stringToHashBucketFastImpl:hAe,subImpl:pAe,tileImpl:mAe,topKImpl:gAe,transposeImpl:GA,uniqueImpl:yAe}=PG;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JH(t,e){return["x","y","z","w","u","v"].slice(0,e).map(n=>`${t}.${n}`)}function $s(t,e){return e===1?[t]:JH(t,e)}function xAe(t,e){if(t===1)return"rc";let n="";for(let s=0;s<t;s++)n+=e[s],s<t-1&&(n+=",");return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vAe{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=Cs(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const n=$s("rc",this.rank),s=Pt(this.rank),o=this.getOutOfBoundsCondition(n),r=this.getSetup(n),i=this.getOutput(n);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${o}) {
            setOutput(vec4(0));
          } else {
            ${r}

            setOutput(vec4(${i}));
          }
        }
      `}}getSourceCoordsArr(e){const n=[];for(let s=0;s<=1;s++)for(let o=0;o<=1;o++){let r=`${s===0?"r":"rp1"}, ${o===0?"c":"cp1"}`;for(let i=2;i<this.rank;i++)r=`${e[e.length-1-i]},`+r;n.push(r)}return n}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let n="";for(let s=this.rank-2;s<this.rank;s++)n+=`${e[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(n+="||");return n}getSetup(e){if(this.rank===1)return"";const n=e.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],o=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${n[0]};
      int c = ${n[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${o};
    `}getOutput(e){const n=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${n[0]}),
            cEdge ? 0. : getA(${n[1]}),
            rEdge ? 0. : getA(${n[2]}),
            rEdge || cEdge ? 0. : getA(${n[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jH{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=Cs(this.outputShape.length);let s="";for(let o=0;o<4;o++){let r="thisRC = rc;";o%2===1&&(r+="thisRC.z += 1;"),o>1&&(r+="thisRC.y += 1;"),s+=`
        ${r}
        ${o>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${o}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${o>0?"}":""}
      `}this.userCode=`
      ${bAe(n,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?OA():FA(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${s}

        setOutput(result);
      }
    `}}function bAe(t,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?_Ie(["r","c","d"],"inputShape"):Au(["r","c","d"],t)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wAe{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,n,s){const o=uP(n,s),r=cP(e,o,s);r in this.freeTextures||(this.freeTextures[r]=[]),r in this.usedTextures||(this.usedTextures[r]=[]);const i=lP(e,o,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[r].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=i,this.log();const l=this.freeTextures[r].pop();return this.usedTextures[r].push(l),l}let a;return o===as.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):o===as.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):o===as.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):o===as.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):o===as.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[r].push(a),this.numUsedTextures++,this._numBytesAllocated+=i,this.log(),a}releaseTexture(e,n,s,o){if(this.freeTextures==null)return;const r=uP(s,o),i=cP(n,r,o);i in this.freeTextures||(this.freeTextures[i]=[]);const a=lP(n,r,this.gpgpu.gl,this.gpgpu.textureConfig,o),l=ue().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const u=this.usedTextures[i],d=u&&u.indexOf(e);if(d==null||d<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u[d]=u[u.length-1],u.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const n=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*n)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function CAe(t,e){const n=t;if(e===n.R32F)return 4;if(e===n.R16F)return 2;if(e===n.RGBA32F)return 16;if(e===t.RGBA)return 16;if(e===n.RGBA16F)return 8;if(e===n.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function lP(t,e,n,s,o){const r=TAe(e,s);let i;if(o){const[l,u]=Cf(t[0],t[1]);i=l*u}else{const[l,u]=Ng(t[0],t[1]);i=l*u}const a=CAe(n,r);return i*a}function TAe(t,e){switch(t){case as.PACKED_2X2_FLOAT32:return BA(e);case as.PACKED_2X2_FLOAT16:return UA(e);case as.UNPACKED_FLOAT32:return LA(e);case as.UNPACKED_FLOAT16:return VA(e);case as.PACKED_4X1_UNSIGNED_BYTE:return zA(e);default:throw new Error(`Unknown physical texture type ${t}`)}}function SAe(t){return ue().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?as.PACKED_2X2_FLOAT32:as.UNPACKED_FLOAT32:t?as.PACKED_2X2_FLOAT16:as.UNPACKED_FLOAT16}function uP(t,e){if(t===Ao.UPLOAD)return as.PACKED_2X2_FLOAT32;if(t===Ao.RENDER||t==null)return SAe(e);if(t===Ao.DOWNLOAD||t===Ao.PIXELS)return as.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function cP(t,e,n){return`${t[0]}_${t[1]}_${e}_${n}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qr{constructor(e,n){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=Cs(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${n}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const rr="if (isnan(x)) return x;",NAe="return x;",dP="return abs(x);",EAe="return (x >= 0.0) ? x : (exp(x) - 1.0);",IAe=rr+`
  return (x < 0.0) ? 0.0 : x;
`,kAe=rr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Ia="return x;",AAe="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RAe="return x;",$Ae=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,DAe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,_Ae=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,MAe="return 1.0 / (1.0 + exp(-1.0 * x));";class _a{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=Cs(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${n}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class FAe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=Cs(this.outputShape.length);const n=e.length,s=$s("rc",n),o=Pt(n),r=xAe(n,s),i=s.slice(-2),a=n<=1?"rc":`vec2(${i.join(",")})`;this.userCode=`
      void main() {
        ${o} rc = getOutputCoords();
        vec4 packedInput = getA(${r});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OAe=gb,PAe=1e-7,LAe=1e-4,l0={};function VAe(t){return t in l0||(l0[t]={}),l0[t]}const zAe=ue().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),BAe=600;function UAe(){return ue().global.screen==null?1024:ue().global.screen.height*ue().global.screen.width*window.devicePixelRatio*BAe/1024/1024}class Ig extends _x{nextDataId(){return Ig.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!ue().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let n;if(e!=null){if(e instanceof D0)n=e;else{const s=Er(ue().getNumber("WEBGL_VERSION"),e);n=new D0(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=Er(ue().getNumber("WEBGL_VERSION"));n=new D0(s),this.binaryCache=VAe(ue().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=n,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new wAe(this.gpgpu),this.numMBBeforeWarning=UAe(),this.texData=new BN(this,mr())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,n,s,o,r,i){const a=this.makeTensorInfo(n,s),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[o,r]},l.texShape=[o,r];const u=Kh(n),d=new aP(u,!1,i),h=this.runWebGLProgram(d,[a],s,[[o,r]]);return h.shape=n,l.texture=null,this.disposeIntermediateTensorInfo(a),h.dataId}write(e,n,s){if((ue().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||ue().getBool("DEBUG"))&&this.checkNumericalProblems(e),s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const o={id:this.nextDataId()};return this.texData.set(o,{shape:n,dtype:s,values:e,usage:Ao.UPLOAD,refCount:1}),o}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const n=this.texData.get(e);n.refCount++}decRef(e){if(this.texData.has(e)){const n=this.texData.get(e);n.refCount--}}move(e,n,s,o,r){if(ue().getBool("DEBUG")&&this.checkNumericalProblems(n),o==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:s,dtype:o,values:n,usage:Ao.UPLOAD,refCount:r})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const n=this.texData.get(e),{values:s,dtype:o,complexTensorInfos:r,slice:i,shape:a,isPacked:l}=n;if(i!=null){let p;l?p=new _a(a,Ia):p=new qr(a,Ia);const x=this.runWebGLProgram(p,[{dataId:e,shape:a,dtype:o}],o),b=this.readSync(x.dataId);return this.disposeIntermediateTensorInfo(x),b}if(s!=null)return this.convertAndCacheOnCPU(e);if(o==="string")return s;const u=this.activeTimers!=null;let d;u&&(d=os());let h;if(o==="complex64"){const p=this.readSync(r.real.dataId),x=this.readSync(r.imag.dataId);h=zi(p,x)}else h=this.getValuesFromTexture(e);return u&&(this.downloadWaitMs+=os()-d),this.convertAndCacheOnCPU(e,h)}async read(e){if(this.pendingRead.has(e)){const b=this.pendingRead.get(e);return new Promise(w=>b.push(w))}const n=this.texData.get(e),{values:s,shape:o,slice:r,dtype:i,complexTensorInfos:a,isPacked:l}=n;if(r!=null){let b;l?b=new _a(o,Ia):b=new qr(o,Ia);const w=this.runWebGLProgram(b,[{dataId:e,shape:o,dtype:i}],i),C=this.read(w.dataId);return this.disposeIntermediateTensorInfo(w),C}if(s!=null)return this.convertAndCacheOnCPU(e);if(ue().getBool("DEBUG")&&!ue().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&ue().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u=null,d;if(i!=="complex64"&&ue().get("WEBGL_BUFFER_SUPPORTED")){d=this.decode(e);const b=this.texData.get(d.dataId);u=this.gpgpu.createBufferFromTexture(b.texture.texture,...i0(o))}this.pendingRead.set(e,[]),i!=="complex64"&&await this.gpgpu.createAndWaitForFence();let h;if(i==="complex64"){const b=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),w=b[0],C=b[1];h=zi(w,C)}else if(u==null)h=this.getValuesFromTexture(e);else{const b=me(o);h=this.gpgpu.downloadFloat32MatrixFromBuffer(u,b)}if(d!=null&&this.disposeIntermediateTensorInfo(d),u!=null){const b=this.gpgpu.gl;ke(b,()=>b.deleteBuffer(u))}const p=this.convertAndCacheOnCPU(e,h),x=this.pendingRead.get(e);return this.pendingRead.delete(e),x.forEach(b=>b(p)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&mr().removeDataId(e,this),this.pendingDeletes--),p}readToGPU(e,n={}){const s=this.texData.get(e),{values:o,shape:r,slice:i,dtype:a,isPacked:l,texture:u}=s;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(i!=null){let x;l?x=new _a(r,Ia):x=new qr(r,Ia);const b=this.runWebGLProgram(x,[{dataId:e,shape:r,dtype:a}],a),w=this.readToGPU(b,n);return this.disposeIntermediateTensorInfo(b),w}if(u==null)throw o!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const d=this.decode(e,n.customTexShape),h=mr().makeTensorFromTensorInfo(d),p=this.texData.get(d.dataId);return Object.assign({tensorRef:h},p.texture)}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const s=n.map(o=>Oi(o));return et(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return et(e.shape,e.dtype,n)}checkNumericalProblems(e){if(e!=null)for(let n=0;n<e.length;n++){const s=e[n];if(!nH(s))throw ue().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:n,dtype:s,isPacked:o}=this.texData.get(e),r=me(n);if(ue().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const p=this.decode(e),x=this.texData.get(p.dataId),b=this.gpgpu.downloadMatrixFromPackedTexture(x.texture.texture,...i0(n)).subarray(0,r);return this.disposeIntermediateTensorInfo(p),b}const i=ue().getBool("WEBGL_PACK")&&o===!0,a=i?Kh(n):n,l=i?new Cke(a):new wke(a),u=this.runWebGLProgram(l,[{shape:a,dtype:s,dataId:e}],"float32"),d=this.texData.get(u.dataId),h=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(d.texture.texture,d.texShape[0],d.texShape[1]).subarray(0,r);return this.disposeIntermediateTensorInfo(u),h}timerAvailable(){return ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const n=this.activeTimers,s=[];let o=!1;this.programTimersStack==null?(this.programTimersStack=s,o=!0):this.activeTimers.push(s),this.activeTimers=s,e();const r=ti(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),i=ti(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=n,o&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(r);a.kernelMs=SV(l),a.getExtraProfileInfo=()=>l.map((u,d)=>({name:i[d],ms:u})).map(u=>`${u.name}: ${u.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:os(),endMs:null}}endTimer(e){return ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=os(),e)}async getQueryTime(e){if(ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const n=e;return n.endMs-n.startMs}disposeData(e,n=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(n?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!n&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:s}=this.texData.get(e);return s!=null&&(this.disposeData(s.real.dataId,n),this.disposeData(s.imag.dataId,n)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:n,dtype:s,texShape:o,usage:r,isPacked:i,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,u=this.dataRefCount.get(l);u>1?this.dataRefCount.set(l,u-1):(this.dataRefCount.delete(l),n!=null&&(this.numBytesInGPU-=this.computeBytes(o,s),this.textureManager.releaseTexture(n,o,r,i)));const d=this.texData.get(e);d.texture=null,d.texShape=null,d.isPacked=!1,d.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,n=zAe){return ue().getBool("WEBGL_CPU_FORWARD")&&e.every(s=>this.texData.get(s.dataId).texture==null&&me(s.shape)<n)}getGPGPUContext(){return this.gpgpu}where(e){Eo("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const n=e.dataSync();return OAe(e.shape,n)}packedUnaryOp(e,n,s){const o=new _a(e.shape,n),r=this.compileAndRun(o,[e],s);return mr().makeTensorFromTensorInfo(r)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const o=XH(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,o)}if(ue().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,dP,e.dtype);const n=new qr(e.shape,dP),s=this.compileAndRun(n,[e]);return mr().makeTensorFromTensorInfo(s)}makeTensorInfo(e,n,s){let o;if(n==="string"&&s!=null&&s.length>0&&Wr(s[0])){const r=s.map(i=>Jr(i));o=this.write(r,e,n)}else o=this.write(s,e,n);return this.texData.get(o).usage=null,{dataId:o,shape:e,dtype:n}}makeOutput(e,n,s){return mr().makeTensorFromTensorInfo(this.makeTensorInfo(e,n,s),this)}unpackTensor(e){const n=new FAe(e.shape);return this.runWebGLProgram(n,[e],e.dtype)}packTensor(e){const n=new vAe(e.shape);return this.runWebGLProgram(n,[e],e.dtype,null,!0)}packedReshape(e,n){const s=[hu(e.shape),...pu(e.shape)],o={dtype:e.dtype,shape:s,dataId:e.dataId},r=[hu(n),...pu(n)],i=new jH(r,s),a=!0,l=[s],u=this.runWebGLProgram(i,[o],e.dtype,l,a);return{dataId:u.dataId,shape:n,dtype:u.dtype}}decode(e,n){const s=this.texData.get(e),{isPacked:o,shape:r,dtype:i}=s;if(n!=null){const p=me(r),x=n[0]*n[1]*4;L(p<=x,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=Kh(r);let l;o?l=new bke(a):l=new vke(a);const u=!0,d=[n??i0(a)],h=this.runWebGLProgram(l,[{shape:a,dtype:i,dataId:e}],i,d,u,n);return{dtype:i,shape:r,dataId:h.dataId}}runWebGLProgram(e,n,s,o,r=!1,i){const a=this.makeTensorInfo(e.outputShape,s),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===kp.DENSE){const T=i??i0(e.outputShape);l.texShape=T.map(N=>N*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),me(a.shape)===0)return l.values=Xn(a.dtype,0),a;const u=[],d=n.map(T=>{if(T.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let N=this.texData.get(T.dataId);if(N.texture==null){if(!e.packedInputs&&me(T.shape)<=ue().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:T.shape,texData:null,isUniform:!0,uniformValues:N.values};e.packedInputs&&(N.isPacked=!0,N.shape=T.shape)}if(this.uploadToGPU(T.dataId),!!N.isPacked!=!!e.packedInputs)T=N.isPacked?this.unpackTensor(T):this.packTensor(T),u.push(T),N=this.texData.get(T.dataId);else if(N.isPacked&&!Ap(N.shape,T.shape)){const I=T,k=T.shape;T.shape=N.shape,T=this.packedReshape(T,k),u.push(T),N=this.texData.get(T.dataId),I.shape=k}return{shape:T.shape,texData:N,isUniform:!1}});this.uploadToGPU(a.dataId);const h={shape:a.shape,texData:l,isUniform:!1},p=xke(e,d,h),x=this.getAndSaveBinary(p,()=>gke(this.gpgpu,e,d,h)),b=this.activeTimers!=null;let w;b&&(w=this.startTimer()),ue().get("ENGINE_COMPILE_ONLY")||yke(this.gpgpu,x,d,h,o),u.forEach(T=>this.disposeIntermediateTensorInfo(T)),b&&(w=this.endTimer(w),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(w)}));const C=ue().getNumber("WEBGL_FLUSH_THRESHOLD");if(C>0){const T=os();T-this.lastGlFlushTime>C&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=T)}if(!ue().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&r===!1){const T=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),T}return a}compileAndRun(e,n,s,o,r=!1){return s=s||n[0].dtype,this.runWebGLProgram(e,n,s,o,r)}getAndSaveBinary(e,n){return e in this.binaryCache||(this.binaryCache[e]=n()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(ue().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(n=>{this.gpgpu.deleteProgram(this.binaryCache[n].webGLProgram),delete this.binaryCache[n]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=le(()=>{if(!ue().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=ue().getBool("DEBUG");ue().set("DEBUG",!1);const n=this.abs(Be(1e-8)).dataSync()[0];if(ue().set("DEBUG",e),n>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?PAe:LAe}uploadToGPU(e){const n=this.texData.get(e),{shape:s,dtype:o,values:r,texture:i,usage:a,isPacked:l}=n;if(i!=null)return;const u=this.activeTimers!=null;let d;u&&(d=os());let h=n.texShape;if(h==null&&(h=vH(s,l),n.texShape=h),r!=null){const p=Kh(s);let x,b=h[1],w=h[0];const C=r instanceof Uint8Array||r instanceof Uint8ClampedArray;(l||!C)&&([b,w]=Cf(h[0],h[1])),l?x=new Ske(p,C):x=new aP(p,C);const T=C?[w,b]:h,N=this.makeTensorInfo(T,o),I=this.texData.get(N.dataId);C?I.usage=Ao.PIXELS:I.usage=Ao.UPLOAD,I.texShape=T,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(N.dataId),b,w,r);const k=[[w,b]],$=this.runWebGLProgram(x,[N],o,k,!0),M=this.texData.get($.dataId);n.texShape=M.texShape,n.isPacked=M.isPacked,n.usage=M.usage,ue().get("ENGINE_COMPILE_ONLY")?this.disposeData($.dataId):(n.texture=M.texture,n.values=null,this.texData.delete($.dataId)),this.disposeIntermediateTensorInfo(N),u&&(this.uploadWaitMs+=os()-d)}else{const p=this.acquireTexture(h,a,o,l);n.texture=p}}convertAndCacheOnCPU(e,n){const s=this.texData.get(e),{dtype:o}=s;return n!=null&&(s.values=GAe(n,o)),s.values}acquireTexture(e,n,s,o){if(this.numBytesInGPU+=this.computeBytes(e,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const r=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${r} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,n,o)}computeBytes(e,n){return e[0]*e[1]*hp(n)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,n]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(n));return Promise.all(e)}else{for(const[,n]of Object.entries(this.binaryCache)){const s=new Promise(o=>{try{this.checkCompletion_(n),o(!0)}catch(r){throw r}});e.push(s)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await TI(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(MA(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:n,customUniformLocations:s,infLoc:o,nanLoc:r,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:l}=RH(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=n,e.customUniformLocations=s,e.infLoc=o,e.nanLoc=r,e.outShapeLocation=i,e.outShapeStridesLocation=a,e.outTexShapeLocation=l}}createTensorFromGPUData(e,n,s){e.channels=e.channels||"RGBA";const{texture:o,height:r,width:i,channels:a}=e,l=mr().backend;if(!l.gpgpu.gl.isTexture(o))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const u=l.writeTexture(o,n,s,r,i,a);return mr().makeTensorFromDataId(u,n,s,l)}}Ig.nextDataId=0;function GAe(t,e){if(e==="float32"||e==="complex64")return t;if(e==="int32"||e==="bool"){const n=e==="int32"?new Int32Array(t.length):new Uint8Array(t.length);for(let s=0;s<n.length;++s)n[s]=Math.round(t[s]);return n}else throw new Error(`Unknown dtype ${e}`)}/** @license See the LICENSE file. */const ZH="4.20.0";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QH(){ue().set("WEBGL_FORCE_F16_TEXTURES",!0)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */JN()&&ZN("webgl",()=>new Ig,2);const HAe={forceHalfFloat:QH};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HA=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class mu{constructor(e,n,s){this.variableNames=["A","B"],this.outputShape=Ze(n,s),this.enableShapeUniforms=Cs(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $u=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class kf{constructor(e,n,s,o=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Ze(n,s);const r=this.outputShape.length;this.enableShapeUniforms=Cs(r);let i="";if(o)if(r===0||me(this.outputShape)===1)i=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(i=`
          ${Pt(r)} coords = getOutputCoords();
        `,r===1)this.enableShapeUniforms?i+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:i+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=$s("coords",r);this.enableShapeUniforms?i+=`
            bool nextRowOutOfBounds =
              (${l[r-2]} + 1) >= outShape[${r} - 2];
            bool nextColOutOfBounds =
              (${l[r-1]} + 1) >= outShape[${r} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:i+=`
            bool nextRowOutOfBounds =
              (${l[r-2]} + 1) >= ${this.outputShape[r-2]};
            bool nextColOutOfBounds =
              (${l[r-1]} + 1) >= ${this.outputShape[r-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${i}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function po(t){const{inputs:e,backend:n}=t,{x:s}=e;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const WAe={kernelName:Dd,backendName:"webgl",kernelFunc:po};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ll(t){const{inputs:e,backend:n}=t,{real:s,imag:o}=e,r=n.makeTensorInfo(s.shape,"complex64"),i=n.texData.get(r.dataId),a=po({inputs:{x:s},backend:n}),l=po({inputs:{x:o},backend:n});return i.complexTensorInfos={real:a,imag:l},r}const qAe={kernelName:Ux,backendName:"webgl",kernelFunc:ll};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eW="return (a < 0.) ? b * a : a;",tW=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function KAe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{alpha:r}=s,i=n.makeTensorInfo([],"float32",Hi(r,"float32")),a=ue().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new kf(tW,o.shape,i.shape):new mu(eW,o.shape,i.shape),l=n.runWebGLProgram(a,[o,i],"float32");return n.disposeIntermediateTensorInfo(i),l}const XAe={kernelName:cm,backendName:"webgl",kernelFunc:KAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nW="return (a < 0.) ? b * a : a;",sW=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function YAe(t){const{inputs:e,backend:n}=t,{x:s,alpha:o}=e,r=ue().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new kf(sW,s.shape,o.shape):new mu(nW,s.shape,o.shape);return n.runWebGLProgram(r,[s,o],"float32")}const JAe={kernelName:Am,backendName:"webgl",kernelFunc:YAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Af="if (isnan(x)) return x;";function xt({opSnippet:t,packedOpSnippet:e,cpuKernelImpl:n,dtype:s}){return({inputs:o,backend:r})=>{const{x:i}=o,a=r,l=s||i.dtype;if(a.shouldExecuteOnCPU([i])&&n!=null){const h=a.texData.get(i.dataId),p=n(h.values,l);return a.makeTensorInfo(i.shape,l,p)}const u=ue().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let d;return u?d=new _a(i.shape,e):d=new qr(i.shape,t),a.runWebGLProgram(d,[i],l)}}function ms({opSnippet:t,packedOpSnippet:e,checkOutOfBounds:n=!1,supportsComplex:s=!1,cpuKernelImpl:o,dtype:r}){return({inputs:i,backend:a})=>{const{a:l,b:u}=i,d=a;if(s&&l.dtype==="complex64"){const b=d.texData.get(l.dataId),w=d.texData.get(u.dataId),[C,T]=[[b.complexTensorInfos.real,w.complexTensorInfos.real],[b.complexTensorInfos.imag,w.complexTensorInfos.imag]].map(I=>{const[k,A]=I,$={dataId:k.dataId,dtype:k.dtype,shape:l.shape},M={dataId:A.dataId,dtype:A.dtype,shape:u.shape},O=new mu(t,l.shape,u.shape);return d.runWebGLProgram(O,[$,M],Ws(k.dtype,A.dtype))}),N=ll({inputs:{real:C,imag:T},backend:d});return d.disposeIntermediateTensorInfo(C),d.disposeIntermediateTensorInfo(T),N}const h=r||Ws(l.dtype,u.dtype);if((l.dtype==="string"||u.dtype==="string"||d.shouldExecuteOnCPU([l,u]))&&o!=null){const b=d.texData.get(l.dataId).values,w=d.texData.get(u.dataId).values,C=l.dtype==="string"?Bi(b):b,T=l.dtype==="string"?Bi(w):w,[N,I]=o(l.shape,u.shape,C,T,h),k=d.makeTensorInfo(I,h),A=d.texData.get(k.dataId);return A.values=N,k}const p=ue().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let x;return p?x=new kf(e,l.shape,u.shape,n):x=new mu(t,l.shape,u.shape),d.runWebGLProgram(x,[l,u],h)}}function Rp(t,e=!1){if(t==="linear")return e?RAe:NAe;if(t==="relu")return e?DAe:IAe;if(t==="elu")return e?$Ae:EAe;if(t==="relu6")return e?_Ae:kAe;if(t==="prelu")return e?sW:nW;if(t==="leakyrelu")return e?tW:eW;if(t==="sigmoid")return e?MAe:AAe;throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oW{constructor(e,n,s,o=!1,r=!1,i=!1,a=null,l=!1,u=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=Cs(this.outputShape.length);const d=o?e[1]:e[2],h=Math.ceil(d/2),p=o?"i * 2, rc.y":"rc.y, i * 2",x=r?"rc.z, i * 2":"i * 2, rc.z",b=o?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],w=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let C="",T="";a&&(l?C=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:u?C=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:C=`vec4 activation(vec4 x) {
          ${a}
        }`,T="result = activation(result);");const N=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");let I="rc.x",k="rc.x";e[0]<n[0]?I=`imod(rc.x, ${e[0]})`:n[0]<e[0]&&(k=`imod(rc.x, ${n[0]})`),this.userCode=`
      ${C}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${h}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${I};
        int batchB = ${k};
        for (int i = 0; i < ${h}; i++) {
          vec4 a = getMatrixA(batchA, ${p});
          vec4 b = getMatrixB(batchB, ${x});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${b[0]} * ${w[0]});
          result += (${b[1]} * ${w[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${N}

        ${T}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fP={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class hP{constructor(e,n,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Ze(n,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pP="return a * b;";function WA(t){const{inputs:e,backend:n}=t,{a:s,b:o}=e,r=Ws(s.dtype,o.dtype);if(s.dtype==="complex64"){const a=n.texData.get(s.dataId),l=n.texData.get(o.dataId),u=new hP(fP.REAL,s.shape,o.shape),d=new hP(fP.IMAG,s.shape,o.shape),h=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:o.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:o.shape}],p=n.runWebGLProgram(u,h,"float32"),x=n.runWebGLProgram(d,h,"float32"),b=ll({inputs:{real:p,imag:x},backend:n});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(x),b}if(n.shouldExecuteOnCPU([s,o])){const a=n.texData.get(s.dataId),l=n.texData.get(o.dataId),[u,d]=Xke(s.shape,o.shape,a.values,l.values,r),h=n.makeTensorInfo(d,r),p=n.texData.get(h.dataId);return p.values=u,h}let i;return ue().getBool("WEBGL_PACK_BINARY_OPERATIONS")?i=new kf(pP,s.shape,o.shape):i=new mu(pP,s.shape,o.shape),n.runWebGLProgram(i,[s,o],r)}const jAe={kernelName:Bd,backendName:"webgl",kernelFunc:WA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZAe(t,e,n){const s=[hu(t.shape),...pu(t.shape)],o={dtype:t.dtype,shape:s,dataId:t.dataId},r=[hu(e),...pu(e)],i=new jH(r,s),a=!0,l=[s],u=n.runWebGLProgram(i,[o],t.dtype,l,a);return{dataId:u.dataId,shape:e,dtype:u.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ie(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{shape:r}=s,i=n,a=me(o.shape),l=GN(r,a),u=me(l);L(a===u,()=>`The new shape (${l}) has ${u} elements and the old shape (${o.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const d=i.texData.get(o.dataId);return d.isPacked&&!Ap(o.shape,l)&&!(d.texture!==null&&Ap(d.shape,l))?ZAe(o,l,i):(i.incRef(o.dataId),{dataId:o.dataId,shape:l,dtype:o.dtype})}const QAe={kernelName:$m,backendName:"webgl",kernelFunc:Ie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mP{constructor(e,n){this.variableNames=["x"];const{windowSize:s,batchSize:o,inSize:r,outSize:i}=e;this.outputShape=[o,i];const a=Math.floor(s/4)*4,l=s%4;let u="sumValue += dot(values, ones);";if(n!=null){const h=1/n;u=`sumValue += dot(values * ${Zl(h)?h.toPrecision(2):h}, ones);`}let d="";r%s>0&&(d=`
        if (inIdx < 0 || inIdx >= ${r}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${d}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${u}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${u}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${u}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${u}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class e2e{constructor(e,n){this.variableNames=["x"];const{windowSize:s,batchSize:o,inSize:r,outSize:i}=e;this.outputShape=[o,i];let a="0.0",l="";n==="prod"?a="1.0":n==="min"?(a="1.0 / 1e-20",l="min"):n==="max"&&(a="-1.0 / 1e-20",l="max");let u=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="sum"?u="sumValue":n==="prod"?u="prodValue":n==="all"?u="allValue":n==="any"&&(u="anyValue");const d=Math.floor(s/4)*4,h=s%4;let p=`
      if (${n==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${n==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${n==="min"} || ${n==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,x="vec4";n==="all"?(a="1.0",p=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,x="bvec4"):n==="any"&&(a="0.0",p=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,x="bvec4");let b="";r%s>0&&(b=`
        if (inIdx < 0 || inIdx >= ${r}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${b}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          ${x} values = ${x}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${p}
        }

        int inIdx = inOffset + ${d};
        if (${h===1}) {
          ${x} values = ${x}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${h===2}) {
          ${x} values = ${x}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${h===3}) {
          ${x} values = ${x}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${p}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t2e(t){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const n=e.length?e[e.length-1].outSize:t[1],s=kb(n);e.push({inSize:n,windowSize:s,outSize:Math.ceil(n/s)})}return e}function Du(t,e,n,s){const o=t2e(t.shape);let r=t;for(let i=0;i<o.length;i++){const{inSize:a,windowSize:l,outSize:u}=o[i];let d,h;n==="mean"?d=i===0?new mP({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:u},a):new mP({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:u}):d=new e2e({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:u},n),h=r,r=s.runWebGLProgram(d,[r],e),h.dataId!==t.dataId&&s.disposeIntermediateTensorInfo(h)}return r}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class n2e{constructor(e,n){this.variableNames=["A"];const s=new Array(e.length);for(let i=0;i<s.length;i++)s[i]=e[n[i]];this.outputShape=s,this.rank=s.length;const o=Pt(this.rank),r=s2e(n);this.userCode=`
    void main() {
      ${o} resRC = getOutputCoords();
      setOutput(getA(${r}));
    }
    `}}function s2e(t){const e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let o=0;o<t.length;o++)s[t[o]]=n[o];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class o2e{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(e.length);for(let d=0;d<s.length;d++)s[d]=e[n[d]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const o=Pt(this.rank),r=JH("rc",this.rank),i=new Array(this.rank);for(let d=0;d<n.length;d++)i[n[d]]=r[d];const a=`vec2(${i.slice(-2).join()})`,l=`++${r[this.rank-1]} < ${s[this.rank-1]}`,u=`getChannel(getA(${i.join()}), ${a})`;this.userCode=`
    void main() {
      ${o} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${u};
      if(${l}) {
        result[1] = ${u};
      }
      --${r[this.rank-1]};
      if(++${r[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${u};
        if(${l}) {
          result[3] = ${u};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ew(t,e,n){const s=ue().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new o2e(t.shape,e):new n2e(t.shape,e);return n.runWebGLProgram(s,[t],t.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r2e(t,e,n,s){const o=e,r=t.shape.length,i=ot(o,t.shape);let a=i;const l=rn(a,r),u=l!=null;let d=t;u&&(d=ew(t,l,s),a=yn(a.length,r)),hs("sum",a,r);const[h,p]=Zn(d.shape,a);let x=h;n&&(x=gn(h,i));const b=me(p),C=me(t.shape)/b,T=Ie({inputs:{x:d},attrs:{shape:[C,b]},backend:s}),N=Uv(t.dtype),I=Du(T,N,"sum",s),k=Ie({inputs:{x:I},attrs:{shape:x},backend:s});return s.disposeIntermediateTensorInfo(T),s.disposeIntermediateTensorInfo(I),u&&s.disposeIntermediateTensorInfo(d),k}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tw(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r,keepDims:i}=s;return r2e(o,r,i,n)}const i2e={kernelName:Pm,backendName:"webgl",kernelFunc:tw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fs(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{perm:r}=s,i=n,a=o.shape.length,l=new Array(a);for(let d=0;d<l.length;d++)l[d]=o.shape[r[d]];let u;if(i.shouldExecuteOnCPU([o])){const h=i.texData.get(o.dataId).values,p=GA(h,o.shape,o.dtype,r,l);u=i.makeTensorInfo(l,o.dtype);const x=i.texData.get(u.dataId);x.values=p}else u=ew(o,r,i);return u}const a2e={kernelName:ql,backendName:"webgl",kernelFunc:Fs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rW=1e3;function yx({a:t,b:e,transposeA:n,transposeB:s,backend:o,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:a=0,activation:l=null}){const u=t.shape.length,d=e.shape.length,h=n?t.shape[u-2]:t.shape[u-1],p=s?e.shape[d-1]:e.shape[d-2],x=n?t.shape[u-1]:t.shape[u-2],b=s?e.shape[d-2]:e.shape[d-1],w=t.shape.slice(0,-2),C=e.shape.slice(0,-2),T=me(w),N=me(C),k=Ze(t.shape.slice(0,-2),e.shape.slice(0,-2)).concat([x,b]);L(h===p,()=>`Error in matMul: inner shapes (${h}) and (${p}) of Tensors with shapes ${t.shape} and ${e.shape} and transposeA=${n} and transposeB=${s} must match.`);const A=n?[T,h,x]:[T,x,h],$=s?[N,b,p]:[N,p,b],M=Ie({inputs:{x:t},backend:o,attrs:{shape:A}}),O=Ie({inputs:{x:e},backend:o,attrs:{shape:$}}),F=[M,O],P=Math.max(T,N),D=n?M.shape[1]:M.shape[2],H=r!=null,Z=i!=null,ne=l==="leakyrelu",Q=l!=null?Rp(l,!0):null,G=H||Z||ne||Q!=null;let q;if((x===1||b===1)&&D>rW&&G===!1){let oe=M,B=O;n&&(oe=Fs({inputs:{x:M},backend:o,attrs:{perm:[0,2,1]}}),F.push(oe)),s&&(B=Fs({inputs:{x:O},backend:o,attrs:{perm:[0,2,1]}}),F.push(B));const X=b!==1,ie=b===1;let re=oe;X&&(re=Ie({inputs:{x:oe},backend:o,attrs:{shape:[P,D,1]}}),F.push(re));const ye=b===1?2:1;let ve=B;ie&&(ve=Ie({inputs:{x:B},backend:o,attrs:{shape:[P,1,D]}}),F.push(ve));const be=WA({inputs:{a:re,b:ve},backend:o});q=tw({inputs:{x:be},backend:o,attrs:{axis:ye,keepDims:!0}}),F.push(be)}else{const oe=Ws(t.dtype,e.dtype),B=new oW(A,$,[P,x,b],n,s,H,Q,Z,ne),X=[M,O];if(r!=null&&X.push(r),Z&&X.push(i),ne){const ie=o.makeTensorInfo([],"float32",Hi(a,"float32"));X.push(ie),F.push(ie)}q=o.runWebGLProgram(B,X,oe)}const J=Ie({inputs:{x:q},backend:o,attrs:{shape:k}});F.push(q);for(const oe of F)o.disposeIntermediateTensorInfo(oe);return J}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l2e(t){const{inputs:e,backend:n,attrs:s}=t,{a:o,b:r,bias:i,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:d,leakyreluAlpha:h}=s;return yx({a:o,b:r,transposeA:l,transposeB:u,backend:n,bias:i,preluActivationWeights:a,leakyreluAlpha:h,activation:d})}const u2e={kernelName:pp,backendName:"webgl",kernelFunc:l2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gP="return abs(x);";function c2e(t){const{inputs:e,backend:n}=t,{x:s}=e;if(n.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const r=n.texData.get(s.dataId),i=XH(r.values);return n.makeTensorInfo(s.shape,s.dtype,i)}let o;return ue().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new _a(s.shape,gP):o=new qr(s.shape,gP),n.runWebGLProgram(o,[s],s.dtype)}const d2e={kernelName:Up,backendName:"webgl",kernelFunc:c2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f2e=rr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,h2e=xt({opSnippet:f2e}),p2e={kernelName:fd,backendName:"webgl",kernelFunc:h2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m2e=rr+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,g2e=xt({opSnippet:m2e}),y2e={kernelName:hd,backendName:"webgl",kernelFunc:g2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yP="return a + b;",x2e=ms({opSnippet:yP,packedOpSnippet:yP,supportsComplex:!0,cpuKernelImpl:Ike}),v2e={kernelName:wu,backendName:"webgl",kernelFunc:x2e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class b2e{constructor(e,n){this.outputShape=[],this.outputShape=e,this.variableNames=n.map((r,i)=>`T${i}`);const s=[];this.variableNames.forEach(r=>{s.push(`float v${r} = get${r}AtOutCoords();`)});const o=this.variableNames.map(r=>`v${r}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${o};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class w2e{constructor(e,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=n.map((r,i)=>`T${i}`);const s=[];this.variableNames.forEach(r=>{s.push(`vec4 v${r} = get${r}AtOutCoords();`)});const o=this.variableNames.map(r=>`v${r}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${o};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _0(t){const{inputs:e,backend:n}=t,s=e;if(s.length===1)return po({inputs:{x:s[0]},backend:n});if(s.length>ue().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(s.length/2),u=_0({inputs:s.slice(0,l),backend:n}),d=_0({inputs:s.slice(l),backend:n});return _0({inputs:[u,d],backend:n})}const o=s.map(l=>l.dtype).reduce((l,u)=>Ws(l,u)),r=s.map(l=>l.shape),a=ue().getBool("WEBGL_PACK")?new w2e(s[0].shape,r):new b2e(s[0].shape,r);return n.runWebGLProgram(a,s,o)}const C2e={kernelName:Gp,backendName:"webgl",kernelFunc:_0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T2e(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r,keepDims:i}=s,a=o.shape.length,l=ot(r,o.shape);let u=l;const d=rn(u,a);let h=o;d!=null&&(h=Fs({inputs:{x:o},backend:n,attrs:{perm:d}}),u=yn(u.length,a)),hs("all",u,a);const[p,x]=Zn(h.shape,u),b=me(x),w=Ie({inputs:{x:h},backend:n,attrs:{shape:[-1,b]}}),C=Du(w,w.dtype,"all",n);let T;if(i){const N=gn(p,l);T=Ie({inputs:{x:C},backend:n,attrs:{shape:N}})}else T=Ie({inputs:{x:C},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(w),n.disposeIntermediateTensorInfo(C),d!=null&&n.disposeIntermediateTensorInfo(h),T}const S2e={kernelName:Ox,backendName:"webgl",kernelFunc:T2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N2e(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r,keepDims:i}=s,a=o.shape.length,l=ot(r,o.shape);let u=l;const d=rn(u,a);let h=o;d!=null&&(h=Fs({inputs:{x:o},backend:n,attrs:{perm:d}}),u=yn(u.length,a)),hs("any",u,a);const[p,x]=Zn(h.shape,u),b=me(x),w=Ie({inputs:{x:h},backend:n,attrs:{shape:[-1,b]}}),C=Du(w,w.dtype,"any",n);let T;if(i){const N=gn(p,l);T=Ie({inputs:{x:C},backend:n,attrs:{shape:N}})}else T=Ie({inputs:{x:C},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(w),n.disposeIntermediateTensorInfo(C),d!=null&&n.disposeIntermediateTensorInfo(h),T}const E2e={kernelName:Px,backendName:"webgl",kernelFunc:N2e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class I2e{constructor(e,n,s){this.variableNames=["A"];const{windowSize:o,batchSize:r,outSize:i}=e;s||this.variableNames.push("bestIndicesA"),this.outputShape=[r,i];const a=n==="max"?">":"<",l=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${o};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${o}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class k2e{constructor(e,n,s,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,L(e.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const r=e[e.length-1],i=Math.ceil(r/n);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),o||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,u=Pt(l),d=$s("coords",l);let h,p;if(i===1){p=l+1;const O=Pt(p);h=`
        ${O} sourceLocR = ${O}(${d.join()}, 0);
        ++${d[l-1]};
        ${O} sourceLocG = ${O}(${d.join()}, 0);
        ++${d[l-2]};
        ${O} sourceLocA = ${O}(${d.join()}, 0);
        --${d[l-1]};
        ${O} sourceLocB = ${O}(${d.join()}, 0);
        --${d[l-2]};`}else p=l,h=`
        ${u} sourceLocR = coords;
        ++${d[l-1]};
        ${u} sourceLocG = coords;
        ++${d[l-2]};
        ${u} sourceLocA = coords;
        --${d[l-1]};
        ${u} sourceLocB = coords;
        --${d[l-2]};`;const x=["x","y","z","w","u","v"].slice(0,p),b="."+x[p-1],w=x.map(O=>"int "+O),C=$s("sourceLocR",p-1).concat("inIdx.r"),T=$s("sourceLocG",p-1).concat("inIdx.g"),N=$s("sourceLocB",p-1).concat("inIdx.b"),I=$s("sourceLocA",p-1).concat("inIdx.a"),k=s==="max"?"greaterThan":"lessThan",A=o?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${C.join()}),
                             getBestIndicesAChannel(${T.join()}),
                             getBestIndicesAChannel(${N.join()}),
                             getBestIndicesAChannel(${I.join()})));`,$=`vec4(
            getAChannel(${C.join()}),
            hasNextCol ? getAChannel(${T.join()}) : 0.,
            hasNextRow ? getAChannel(${N.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${I.join()}) : 0.)`,M=o?"":`
      float getBestIndicesAChannel(${w.join()}) {
        return getChannel(getBestIndicesA(${x.join()}),
                                          vec2(${x.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${w.join()}) {
        return getChannel(getA(${x.join()}),
                               vec2(${x.slice(-2).join()}));
      }
      ${M}
      void main() {
        ${u} coords = getOutputCoords();
        bool hasNextCol = ${d[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${d[l-2]} < ${a[l-2]-1};
        ${h}
        ivec4 srcIdx = ivec4(sourceLocR${b}, sourceLocG${b},
          sourceLocB${b}, sourceLocA${b}) * ${n};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${$};

        for (int i = 0; i < ${n}; i++) {
          inIdx = srcIdx;
          ${A}
          vec4 candidate = ${$};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${k}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iW(t,e,n,s=null){let o=e.shape[0],r=e.shape[1];s!=null&&(o=s.shape[0],r=s.shape[1]);const i=kb(r),a={windowSize:i,inSize:r,batchSize:o,outSize:Math.ceil(r/i)},l=new I2e(a,n,s==null),u=[e];s!=null&&u.push(s);const d=t.runWebGLProgram(l,u,"int32");if(d.shape[1]===1)return d;const h=iW(t,e,n,d);return t.disposeIntermediateTensorInfo(d),h}function aW(t,e,n,s=null){const o=s!=null?s.shape:e.shape,r=o[o.length-1],i=kb(r),a=new k2e(o,i,n,s==null),l=s==null?[e]:[e,s],u=t.runWebGLProgram(a,l,"int32");if(u.shape.length===e.shape.length){const d=aW(t,e,n,u);return t.disposeIntermediateTensorInfo(u),d}return u}function lW(t,e,n,s){const o=[n];if(hs("arg"+s.charAt(0).toUpperCase()+s.slice(1),o,e.shape.length),!ue().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const r=[],i=t.texData.get(e.dataId),a=i!==null&&i.isPacked;let l=e;a&&(l=t.unpackTensor(e),r.push(l));const[u,d]=Zn(l.shape,o),h=me(d),p=Ie({inputs:{x:l},backend:t,attrs:{shape:[-1,h]}});r.push(p);const x=iW(t,p,s);r.push(x);const b=Ie({inputs:{x},backend:t,attrs:{shape:u}});return r.forEach(w=>t.disposeIntermediateTensorInfo(w)),b}return aW(t,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A2e(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r}=s;let i=ot(r,o.shape);const a=rn(i,o.shape.length);let l=o;const u=[];a!=null&&(l=Fs({inputs:{x:o},backend:n,attrs:{perm:a}}),u.push(l),i=yn(i.length,l.shape.length)),hs("argMax",[i[0]],l.shape.length);const d=lW(n,l,i[0],"max");return u.forEach(h=>n.disposeIntermediateTensorInfo(h)),d}const R2e={kernelName:Hp,backendName:"webgl",kernelFunc:A2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $2e(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r}=s;let i=ot(r,o.shape);const a=rn(i,o.shape.length);let l=o;const u=[];a!=null&&(l=Fs({inputs:{x:o},backend:n,attrs:{perm:a}}),u.push(l),i=yn(i.length,l.shape.length)),hs("argMin",[i[0]],l.shape.length);const d=lW(n,l,i[0],"min");return u.forEach(h=>n.disposeIntermediateTensorInfo(h)),d}const D2e={kernelName:Wp,backendName:"webgl",kernelFunc:$2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _2e=rr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,M2e=xt({opSnippet:_2e}),F2e={kernelName:pd,backendName:"webgl",kernelFunc:M2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O2e=rr+"return log(x + sqrt(x * x + 1.0));",P2e=xt({opSnippet:O2e}),L2e={kernelName:md,backendName:"webgl",kernelFunc:P2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V2e=rr+`
  return atan(x);
`,z2e=xt({opSnippet:V2e}),B2e={kernelName:gd,backendName:"webgl",kernelFunc:z2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U2e=HA+`
  return atan(a, b);
`,G2e=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+$u+`
  return result;
`,H2e=ms({opSnippet:U2e,packedOpSnippet:G2e}),W2e={kernelName:xd,backendName:"webgl",kernelFunc:H2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q2e=rr+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,K2e=xt({opSnippet:q2e}),X2e={kernelName:yd,backendName:"webgl",kernelFunc:K2e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $p{constructor(e,n,s,o=!1,r=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,a=e.strideHeight,l=e.strideWidth,u=e.dilationHeight,d=e.dilationWidth,h=e.effectiveFilterHeight,p=e.effectiveFilterWidth,x=e.padInfo.top,b=e.padInfo.left;this.outputShape=e.outShape;const w=n==="avg",C=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,T=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let N="0.0";if(w||(N="-1.0 / 1e-20"),s){this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${x}, ${b});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${h};
              wR += ${u}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p};
                wC += ${d}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${o?r?C:T:`wR * ${p} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const I="max";let k=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(k="avgValue / max(count, 1.0)");const A=Math.floor(i/4)*4,$=i%4,M=`
      if (${w}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${I}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${x}, ${b});
      const float initializationValue = ${N};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${N});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${h};
            wR += ${u}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${A}; wC += 4) {
            int xC = xCCorner + wC * ${d};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              getValue(batch, xR, xC + 3 * ${d}, d)
            );

            ${M}
          }

          int xC = xCCorner + ${A};
          if (${$===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${M}
          } else if (${$===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              initializationValue,
              initializationValue
            );

            ${M}
          } else if (${$===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              initializationValue
            );

            ${M}
          }
        }
        setOutput(${k});
      }
    `}}class qA{constructor(e,n,s,o=!1,r=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,a=e.strideDepth,l=e.strideHeight,u=e.strideWidth,d=e.dilationDepth,h=e.dilationHeight,p=e.dilationWidth,x=e.effectiveFilterDepth,b=e.effectiveFilterHeight,w=e.effectiveFilterWidth,C=e.padInfo.front,T=e.padInfo.top,N=e.padInfo.left;this.outputShape=e.outShape;const I=n==="avg";let k="0.0";if(I||(k="-1.0 / 1e-20"),s){this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${u});
        const ivec3 pads = ivec3(${C}, ${T}, ${N});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${x};
              wD += ${d}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${b};
                wR += ${h}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${w};
                  wC += ${p}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${o?r?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${b} * ${w} +
                      wR * ${w} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const A="max";let $=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&($="avgValue / max(count, 1.0)");const M=Math.floor(i/4)*4,O=i%4,F=`
      if (${I}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${A}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${u});
      const ivec3 pads = ivec3(${C}, ${T}, ${N});
      const float initializationValue = ${k};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${k});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${x};
            wD += ${d}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${b};
            wR += ${h}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${M}; wC += 4) {
              int xC = xCCorner + wC * ${p};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                getValue(batch, xD, xR, xC + 3 * ${p}, ch)
              );

              ${F}
            }

            int xC = xCCorner + ${M};
            if (${O===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${F}
            } else if (${O===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                initializationValue,
                initializationValue
              );

              ${F}
            } else if (${O===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                initializationValue
              );

              ${F}
            }
          }
        }
        setOutput(${$});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y2e(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e;Tf(o,"avgPool");const{filterSize:r,strides:i,pad:a,dimRoundingMode:l}=s,u=1;L(fs(i,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const d=sr(o.shape,r,i,u,a,l);if(d.filterWidth===1&&d.filterHeight===1&&lt(d.inShape,d.outShape))return po({inputs:{x:o},backend:n});const h=new $p(d,"avg",!1);return n.runWebGLProgram(h,[o],"float32")}const J2e={kernelName:qp,backendName:"webgl",kernelFunc:Y2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j2e(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{filterSize:r,strides:i,pad:a,dimRoundingMode:l,dataFormat:u}=s,d=[1,1,1],h=Wi(o.shape,r,i,d,a,l,u),p=new qA(h,"avg",!1);return n.runWebGLProgram(p,[o],"float32")}const Z2e={kernelName:Kp,backendName:"webgl",kernelFunc:j2e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Q2e{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,o=e.strideHeight,r=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,u=e.effectiveFilterWidth,d=l-1-e.padInfo.top,h=u-1-e.padInfo.left,p=1/(n*s);this.userCode=`
      const ivec2 pads = ivec2(${d}, ${h});
      const float avgMultiplier = float(${p});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${i}) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${u};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class eRe{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterDepth,s=e.filterHeight,o=e.filterWidth,r=e.strideDepth,i=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,d=e.dilationWidth,h=e.effectiveFilterDepth,p=e.effectiveFilterHeight,x=e.effectiveFilterWidth,b=h-1-e.padInfo.front,w=p-1-e.padInfo.top,C=x-1-e.padInfo.left,T=1/(n*s*o);this.userCode=`
      const ivec3 pads = ivec3(${b}, ${w}, ${C});
      const float avgMultiplier = float(${T});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${h};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${r}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${p};
              wR += ${u}) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${x};
                wC += ${d}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tRe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:o,input:r}=e,i=r,{filterSize:a,strides:l,pad:u,dimRoundingMode:d}=s,h=[1,1,1],p=Wi(i.shape,a,l,h,u,d),x=new eRe(p);return n.runWebGLProgram(x,[o],i.dtype)}const nRe={kernelName:Vx,backendName:"webgl",kernelFunc:tRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sRe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:o,input:r}=e,i=r;Tf([o,r],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=s,d=sr(i.shape,a,l,1,u),h=new Q2e(d);return n.runWebGLProgram(h,[o],i.dtype)}const oRe={kernelName:Lx,backendName:"webgl",kernelFunc:sRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rRe(t){const{inputs:e,backend:n,attrs:s}=t,{a:o,b:r}=e,{transposeA:i,transposeB:a}=s;return yx({a:o,b:r,transposeA:i,transposeB:a,backend:n})}const iRe={kernelName:Xp,backendName:"webgl",kernelFunc:rRe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aRe{constructor(e,n,s,o,r,i){this.outputShape=[],this.variableNames=["x","mean","variance"],Ze(e,n),Ze(e,s);let a="0.0";o!=null&&(Ze(e,o),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";r!=null&&(Ze(e,r),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${i}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lRe{constructor(e,n,s,o,r,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Ze(e,n),Ze(e,s);let a="vec4(0.0)";o!=null&&(Ze(e,o),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";r!=null&&(Ze(e,r),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${i}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uRe=({inputs:t,backend:e,attrs:n})=>{const{x:s,mean:o,variance:r,offset:i,scale:a}=t;L(o.shape.length===r.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),L(i==null||o.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),L(a==null||o.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=n;l==null&&(l=.001);const u=[s,o,r];let d=null;i!=null&&(d=i.shape,u.push(i));let h=null;a!=null&&(h=a.shape,u.push(a));const p=ue().getBool("WEBGL_PACK_NORMALIZATION")?new lRe(s.shape,o.shape,r.shape,d,h,l):new aRe(s.shape,o.shape,r.shape,d,h,l);return e.runWebGLProgram(p,u,u[0].dtype)},cRe={kernelName:am,backendName:"webgl",kernelFunc:uRe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dRe{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const n=Pt(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=fRe(this.rank);let o;const r=e.map((i,a)=>`sourceLoc.${zS[a]} = start[${a}] + coords.${zS[a]};`);o=`
        ${n} sourceLoc;
        ${n} coords = getOutputCoords();
        ${r.join(`
`)}
      `,this.userCode=`
      void main() {
        ${o}
        setOutput(getSource(${s}));
      }
    `}}const zS=["x","y","z","w","u","v"];function fRe(t){if(t===1)return"sourceLoc";if(t<=6)return zS.slice(0,t).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hRe{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=Pt(this.rank),s=$s("coords",this.rank),o=$s("sourceLoc",this.rank),r=this.rank===1?"sourceLoc":`vec2(${o.slice(-2).join()})`,i=`getChannel(getSource(${o.join()}), ${r})`,a=`
      result.x = ${i};
      if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
        ++${o[this.rank-1]};
        result.y = ${i};
        --${o[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${e[this.rank-2]}) {
        ++${o[this.rank-2]};
        result.z = ${i};
        if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
          ++${o[this.rank-1]};
          result.w = ${i};
        }
      }
    `,u=this.rank<=4?`sourceLoc = coords +
            ${n}(${e.map((d,h)=>`start[${h}]`).join()});`:e.map((d,h)=>`${o[h]} = ${s[h]} + start[${h}];`).join(`
`);this.userCode=`
      void main() {
        ${n} coords = getOutputCoords();
        ${n} sourceLoc;
        ${u}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pRe(t,e,n,s){const o=s.texData.get(t.dataId),r=s.makeTensorInfo(n,t.dtype),i=s.texData.get(r.dataId);Object.assign(i,o),i.refCount=1,i.shape=n,i.dtype=t.dtype;let a=wI(e,ze(t.shape));o.slice&&(a+=o.slice.flatOffset),i.slice={flatOffset:a,origDataId:o.slice&&o.slice.origDataId||t.dataId};const l=s.dataRefCount.get(i.slice.origDataId)||1;return s.dataRefCount.set(i.slice.origDataId,l+1),r}function Rf(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{begin:r,size:i}=s,[a,l]=Ib(o,r,i);if(xI(o,a,l),me(l)===0)return n.makeTensorInfo(l,o.dtype,[]);if(n.shouldExecuteOnCPU([o])||o.dtype==="string"){const h=n.texData.get(o.dataId),p=rAe(h.values,a,l,o.shape,o.dtype);return n.makeTensorInfo(l,o.dtype,p)}const{isPacked:u}=n.texData.get(o.dataId),d=bI(o.shape,a,l);if(u||!d){const h=ue().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new hRe(l):new dRe(l),p=[a];return n.runWebGLProgram(h,[o],o.dtype,p)}return n.uploadToGPU(o.dataId),pRe(o,a,l,n)}const mRe={kernelName:Om,backendName:"webgl",kernelFunc:Rf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gRe=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{blockShape:r,crops:i}=s;L(o.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=r.reduce((N,I)=>N*I),l=dg(o.shape,r,a),u=fg(l.length,r.length),d=hg(o.shape,r,a),h=II(i,r.length),p=kI(d,i,r.length),x=[],b=Ie({inputs:{x:o},backend:n,attrs:{shape:l}}),w=Fs({inputs:{x:b},backend:n,attrs:{perm:u}}),C=Ie({inputs:{x:w},backend:n,attrs:{shape:d}}),T=Rf({inputs:{x:C},backend:n,attrs:{begin:h,size:p}});return x.push(b),x.push(w),x.push(C),x.forEach(N=>n.disposeIntermediateTensorInfo(N)),T},yRe={kernelName:Yp,backendName:"webgl",kernelFunc:gRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xRe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,weights:r}=e,{size:i}=s,a=n.readSync(o.dataId),l=n.readSync(r.dataId),u=KH(a,l,r.dtype,r.shape,i);return n.makeTensorInfo([i],r.dtype,u)}const vRe={kernelName:zx,backendName:"webgl",kernelFunc:xRe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bRe=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,wRe=`
  return float(int(a.r) & int(b.r));
`;function CRe(t){const{inputs:e,backend:n}=t,{a:s,b:o}=e,r=ue().getBool("WEBGL_PACK_BINARY_OPERATIONS"),i=ue().getNumber("WEBGL_VERSION");if(n.shouldExecuteOnCPU([s,o])||i===1){const l=n.texData.get(s.dataId).values,u=n.texData.get(o.dataId).values,[d,h]=Ake(s.shape,o.shape,l,u,s.dtype),p=n.makeTensorInfo(h,s.dtype),x=n.texData.get(p.dataId);return x.values=d,p}let a;return r?a=new kf(bRe,s.shape,o.shape,!1):a=new mu(wRe,s.shape,o.shape),n.runWebGLProgram(a,[s,o],s.dtype)}const TRe={kernelName:Jp,backendName:"webgl",kernelFunc:CRe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SRe(t){const{inputs:e,backend:n}=t,{s0:s,s1:o}=e,r=n.readSync(s.dataId),i=n.readSync(o.dataId),a=Ze(Array.from(r),Array.from(i));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const NRe={kernelName:Bx,backendName:"webgl",kernelFunc:SRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ERe="return float(a != b);",uW=ms({opSnippet:ERe,cpuKernelImpl:Jke,dtype:"bool"}),IRe={kernelName:Sm,backendName:"webgl",kernelFunc:uW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kg(t){const{inputs:e,backend:n}=t,{input:s}=e,o=n.texData.get(s.dataId);return po({inputs:{x:o.complexTensorInfos.real},backend:n})}const kRe={kernelName:wv,backendName:"webgl",kernelFunc:kg};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ARe="return float(int(x));";function RRe(t,e){const n=new qr(t.shape,ARe),s=e.runWebGLProgram(n,[t],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BS(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{dtype:r}=s;if(r==="complex64"){if(o.dtype==="complex64")return po({inputs:{x:o},backend:n});const i=Nn(o.shape),a=BS({inputs:{x:o},backend:n,attrs:{dtype:"float32"}}),l=ll({inputs:{real:a,imag:i},backend:n});return i.dispose(),n.disposeIntermediateTensorInfo(a),l}if(o.dtype==="complex64"){const i=kg({inputs:{input:o},backend:n}),a=BS({inputs:{x:i},backend:n,attrs:{dtype:r}});return n.disposeIntermediateTensorInfo(i),a}if(!HN(o.dtype,r)){const i=po({inputs:{x:o},backend:n});return{dataId:i.dataId,shape:i.shape,dtype:r}}if(n.shouldExecuteOnCPU([o])){const i=n.texData.get(o.dataId).values,[a,l,u]=Rke(i,o.shape,o.dtype,r);return n.makeTensorInfo(a,l,u)}if(r==="int32")return RRe(o,n);if(r==="bool"){const i=n.makeTensorInfo([],"bool",Xn("bool",1)),l=uW({inputs:{a:o,b:i},backend:n});return n.disposeIntermediateTensorInfo(i),l}throw new Error(`Error in Cast: failed to cast ${o.dtype} to ${r}`)}const $Re={kernelName:vd,backendName:"webgl",kernelFunc:BS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xP="return ceil(x);",DRe=xt({opSnippet:xP,packedOpSnippet:xP,cpuKernelImpl:$ke}),_Re={kernelName:bd,backendName:"webgl",kernelFunc:DRe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class MRe{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class FRe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ORe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{clipValueMin:r,clipValueMax:i}=s;let a;ue().getBool("WEBGL_PACK_CLIP")?a=new FRe(o.shape):a=new MRe(o.shape);const l=[[r],[i]];return n.runWebGLProgram(a,[o],o.dtype,l)}const PRe={kernelName:wd,backendName:"webgl",kernelFunc:ORe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LRe{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vP(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}function VRe(t){const{inputs:e,backend:n}=t,{x:s}=e,o=n.texData.get(s.dataId),r=new LRe(s.shape),i=[vP(s,o.complexTensorInfos.real),vP(s,o.complexTensorInfos.imag)];return n.runWebGLProgram(r,i,i[0].dtype)}const zRe={kernelName:jp,backendName:"webgl",kernelFunc:VRe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BRe{constructor(e){this.outputShape=[],this.outputShape=Zr(e,1),this.variableNames=e.map((i,a)=>`T${a}`);const n=new Array(e.length-1);n[0]=e[0][1];for(let i=1;i<n.length;i++)n[i]=n[i-1]+e[i][1];const s=[`if (yC < ${n[0]}) setOutput(getT0(yR, yC));`];for(let i=1;i<n.length;i++){const a=n[i-1];s.push(`else if (yC < ${n[i]}) setOutput(getT${i}(yR, yC-${a}));`)}const o=n.length,r=n[n.length-1];s.push(`else setOutput(getT${o}(yR, yC-${r}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class URe{constructor(e,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Zr(e,n);const s=this.outputShape,o=s.length,r=Pt(o),i=$s("coords",o),a=["x","y","z","w","u","v"].slice(0,o);this.variableNames=e.map((w,C)=>`T${C}`);const l=new Array(e.length-1);l[0]=e[0][n];for(let w=1;w<l.length;w++)l[w]=l[w-1]+e[w][n];const u=a[n],d=a.slice(-2),h=a.join();let p=`if (${u} < ${l[0]}) {
        return getChannel(
            getT0(${h}), vec2(${d.join()}));
        }`;for(let w=1;w<l.length;w++){const C=l[w-1];p+=`
        if (${u} < ${l[w]}  && ${u} >= ${l[w-1]}) {
          return getChannel(
            getT${w}(${u0(a,u,C)}),
            vec2(${u0(d,u,C)}));
        }`}const x=l.length,b=l[l.length-1];p+=`
        return getChannel(
          getT${x}(${u0(a,u,b)}),
          vec2(${u0(d,u,b)}));`,this.userCode=`
      float getValue(${a.map(w=>"int "+w)}) {
        ${p}
      }

      void main() {
        ${r} coords = getOutputCoords();
        vec4 result = vec4(getValue(${i}), 0., 0., 0.);

        ${i[o-1]} = ${i[o-1]} + 1;
        if (${i[o-1]} < ${s[o-1]}) {
          result.g = getValue(${i});
        }

        ${i[o-2]} = ${i[o-2]} + 1;
        if (${i[o-2]} < ${s[o-2]}) {
          result.a = getValue(${i});
        }

        ${i[o-1]} = ${i[o-1]} - 1;
        if (${i[o-2]} < ${s[o-2]} &&
            ${i[o-1]} < ${s[o-1]}) {
          result.b = getValue(${i});
        }
        setOutput(result);
      }
    `}}function u0(t,e,n){const s=t.indexOf(e);return t.map((r,i)=>i===s?`${r} - ${n}`:r).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nw(t){const{inputs:e,backend:n}=t,{input:s}=e,o=n.texData.get(s.dataId);return po({inputs:{x:o.complexTensorInfos.imag},backend:n})}const GRe={kernelName:av,backendName:"webgl",kernelFunc:nw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xh(t,e,n){const s=t[0].dtype;if(s==="complex64"){const x=t.map(N=>kg({inputs:{input:N},backend:n})),b=t.map(N=>nw({inputs:{input:N},backend:n})),w=Xh(x,e,n),C=Xh(b,e,n),T=ll({inputs:{real:w,imag:C},backend:n});return x.forEach(N=>n.disposeIntermediateTensorInfo(N)),b.forEach(N=>n.disposeIntermediateTensorInfo(N)),n.disposeIntermediateTensorInfo(w),n.disposeIntermediateTensorInfo(C),T}let o=n.shouldExecuteOnCPU(t);if(s==="string"&&(o=!0),o){const x=t.map(k=>{const $=[-1,me(k.shape.slice(e))];return Ie({inputs:{x:k},backend:n,attrs:{shape:$}})}),b=x.map(k=>({vals:n.readSync(k.dataId),shape:k.shape})),w=Zr(x.map(k=>k.shape),1),C=x[0].shape[0]===1,T=Dke(b,w,s,C),N=Zr(t.map(k=>k.shape),e),I=n.makeTensorInfo(N,s,T);return x.forEach(k=>n.disposeIntermediateTensorInfo(k)),I}const r=t.filter(x=>me(x.shape)>0),i=ue().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&r[0].shape.length>1;if(r.length===1){const x=i?new qr(t[0].shape,Ia):new _a(t[0].shape,Ia);return n.runWebGLProgram(x,t,s)}const a=ue().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(r.length>a){const x=[];for(let w=0;w<r.length;w+=a){const C=r.slice(w,w+a);x.push(Xh(C,e,n))}const b=Xh(x,e,n);for(const w of x)n.disposeIntermediateTensorInfo(w);return b}if(i){const x=new URe(r.map(b=>b.shape),e);return n.runWebGLProgram(x,r,s)}const{tensors2D:l,outShape:u}=HRe(r,e,n),d=new BRe(l.map(x=>x.shape)),h=n.runWebGLProgram(d,l,s);l.forEach(x=>n.disposeIntermediateTensorInfo(x));const p=Ie({inputs:{x:h},attrs:{shape:u},backend:n});return n.disposeIntermediateTensorInfo(h),p}function HRe(t,e,n){const s=Zr(t.map(r=>r.shape),e);return{tensors2D:t.map(r=>Ie({inputs:{x:r},attrs:{shape:[-1,me(r.shape.slice(e))]},backend:n})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cW(t){const{inputs:e,backend:n,attrs:s}=t,{axis:o}=s,r=ot(o,e[0].shape)[0],i=e.map(u=>u.shape);SI(i,r);const a=Zr(e.map(u=>u.shape),r);if(me(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(u=>me(u.shape)>0);return l.length===1?po({inputs:{x:l[0]},backend:n}):Xh(l,r,n)}const WRe={kernelName:Zp,backendName:"webgl",kernelFunc:cW};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dW{constructor(e,n=!1,s=null,o=!1,r=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const i=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,u=e.strideWidth,d=e.dilationHeight,h=e.dilationWidth,p=e.filterHeight,x=e.filterWidth,b=Math.floor(e.inChannels/4)*4,w=e.inChannels%4,C=e.dataFormat==="channelsLast",T=C?1:2,N=C?2:3,I=C?3:1;let k="",A="";s&&(o?k=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:r?k=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:k=`
          float activation(float x) {
            ${s}
          }
        `,A="result = activation(result);");const $=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),r&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${k}

      const ivec2 strides = ivec2(${l}, ${u});
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${I}];

        ivec2 xRCCorner =
            ivec2(coords[${T}], coords[${N}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${p}; wR++) {
          int xR = xRCorner + wR * ${d};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${x}; wC++) {
            int xC = xCCorner + wC * ${h};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${b}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${C}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${w===1}) {

              if (${C}) {
                dotProd +=
                    getX(batch, xR, xC, ${b}) *
                    getW(wR, wC, ${b}, d2);
              } else {
                dotProd +=
                    getX(batch, ${b}, xR, xC) *
                    getW(wR, wC, ${b}, d2);
              }

            } else if (${w===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${b}, d2),
                getW(wR, wC, ${b} + 1, d2)
              );

              if (${C}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${b}),
                  getX(batch, xR, xC, ${b} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${b}, xR, xC),
                  getX(batch, ${b} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${w===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${b}, d2),
                getW(wR, wC, ${b} + 1, d2),
                getW(wR, wC, ${b} + 2, d2)
              );

              if (${C}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${b}),
                  getX(batch, xR, xC, ${b} + 1),
                  getX(batch, xR, xC, ${b} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${b}, xR, xC),
                  getX(batch, ${b} + 1, xR, xC),
                  getX(batch, ${b} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${$}
        ${A}
        setOutput(result);
      }
    `}}class qRe{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const n=e.padInfo.front,s=e.padInfo.top,o=e.padInfo.left,r=e.strideDepth,i=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,d=e.dilationWidth,h=e.filterDepth,p=e.filterHeight,x=e.filterWidth,b=Math.floor(e.inChannels/4)*4,w=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${r}, ${i}, ${a});
      const ivec3 pads = ivec3(${n}, ${s}, ${o});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${h}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p}; wR++) {
            int xR = xRCorner + wR * ${u};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${x}; wC++) {
              int xC = xCCorner + wC * ${d};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${b}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${w===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${b}) *
                  getW(wF, wR, wC, ${b}, d2);
              } else if (${w===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${b}),
                  getX(batch, xF, xR, xC, ${b} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${b}, d2),
                  getW(wF, wR, wC, ${b} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${w===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${b}),
                  getX(batch, xF, xR, xC, ${b} + 1),
                  getX(batch, xF, xR, xC, ${b} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${b}, d2),
                  getW(wF, wR, wC, ${b} + 1, d2),
                  getW(wF, wR, wC, ${b} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fW{constructor(e,n=!1,s=null,o=!1,r=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Cs(this.outputShape.length);const i=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,u=e.filterHeight,d=e.filterWidth,h=d;let p=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let C=0;C<d;C++)p+=`
           vec4 xTexelC${C*2};
           int xTexelC${C*2}Ready;
           vec4 xTexelC${C*2+1};
           int xTexelC${C*2+1}Ready;
           vec4 xC${C};`;p+=`
     for (int r = 0; r < ${u}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let C=0;C<d;C++)p+=`
           xTexelC${C*2} = vec4(0.0);
           xTexelC${C*2}Ready = 0;
           xTexelC${C*2+1} = vec4(0.0);
           xTexelC${C*2+1}Ready = 0;
           xC${C} = vec4(0.0);`;p+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let C=0;C<(h+1)/2;C++){const T=C*2;if(p+=`
           xC = xCCorner + ${T*l};
           `,a===1){if(T<d&&(i%2===1?(p+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${T}Ready == 0) {
                   xTexelC${T} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${T}.zw = vec2(0.0);
                   }
                   xTexelC${T}Ready = 1;
                 }
               `,l===1&&T>0?p+=`
                 xC${T} = vec4(xTexelC${T-2}.zw, xTexelC${T}.xy);
                 `:p+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${T} = vec4(previous.zw, xTexelC${T}.xy);
                   } else {
                     xC${T} = vec4(0.0, 0.0, xTexelC${T}.xy);
                   }
                   `):p+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${T}Ready == 0) {
                   xTexelC${T} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${T}.zw = vec2(0.0);
                   }
                   xTexelC${T}Ready = 1;
                 }

                 xC${T} = xTexelC${T};
                 `,T+1<d)){const N=i%2===0?Mx(l):l;l%2===0&&i%2===1||l%2!==0&&i%2!==1?(p+=`
                   xCOffset = xC + imod(pads[1], 2) + ${N};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${T+1}Ready == 0) {
                     xTexelC${T+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${T+1}.zw = vec2(0.0);
                     }
                     xTexelC${T+1}Ready = 1;
                   }
                   `,l>1?p+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${T+1} = vec4(previous.zw, xTexelC${T+1}.xy);
                     } else {
                      xC${T+1} = vec4(0.0, 0.0, xTexelC${T+1}.xy);
                     }
                     `:p+=`
                     xC${T+1} = vec4(xTexelC${T}.zw, xTexelC${T+1}.xy);
                     `):N===1?p+=`
                     xC${T+1} = xTexelC${T};
                     `:p+=`
                     xCOffset = xC + ${N};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${T+1}Ready == 0) {
                       xTexelC${T+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${T+1}.zw = vec2(0.0);
                       }
                       xTexelC${T+1}Ready = 1;
                     }

                     xC${T+1} = xTexelC${T+1};
                     `}}else T<d&&(i%2===1?(p+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${T}Ready == 0) {
                   xTexelC${T} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${T}.zw = vec2(0.0);
                   }
                   xTexelC${T}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${T+1}Ready == 0) {
                   xTexelC${T+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${T+1}.zw = vec2(0.0);
                   }
                   xTexelC${T+1}Ready = 1;
                 }

                 xC${T} = vec4(xTexelC${T}.zw, xTexelC${T+1}.zw);
               `,T+1<d&&(p+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${T+1} = vec4(xTexelC${T+1}.xy, final.xy);
                 `)):(p+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${T}Ready == 0) {
                   xTexelC${T} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${T}.zw = vec2(0.0);
                   }
                   xTexelC${T}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${T+1}Ready == 0) {
                   xTexelC${T+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${T+1}.zw = vec2(0.);
                   }
                   xTexelC${T+1}Ready = 1;
                 }

                 xC${T} = vec4(
                   xTexelC${T}.xy, xTexelC${T+1}.xy);
               `,T+1<d&&(p+=`
                   xC${T+1} = vec4(xTexelC${T}.zw, xTexelC${T+1}.zw);
                 `)));T<d&&(p+=`
             wTexel = getW(r, ${T}, d1, d2);
             dotProd += xC${T}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${T}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,T+1<d&&(p+=`
               wTexel = getW(r, ${T+1}, d1, d2);
               dotProd += xC${T+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${T+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}p+=`
     }
   `,p+=`
     }
   `,p+=`
     }
   `;let x="",b="";s&&(o?x=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:r?x=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:x=`vec4 activation(vec4 x) {
           ${s}
         }`,b="result = activation(result);");const w=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),r&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${x}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${p}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${w}
         ${b}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KRe{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=Cs(this.outputShape.length);const{dataFormat:s}=n,o=Ls(),r=s==="channelsLast",i=r?1:2,a=r?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let u="";for(let d=0;d<=1;d++)for(let h=0;h<=1;h++)u+=`
          blockIndex = rc.z + ${h};
          pos = rc.y + ${d};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${i}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${r}) {
                  innerDims = vec2(d1, ch);
                  result[${d*2+h}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${d*2+h}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${u}

        ${o.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xx(t,e){const n=t.length;return n>=3?e?[...t.slice(0,-3),t[n-3]*t[n-2],t[n-1]]:[...t.slice(0,-3),t[n-3],t[n-2]*t[n-1]]:!e&&n===1&&t[0]>1?[t[0],1]:null}function hW({x:t,filter:e,convInfo:n,backend:s,bias:o=null,preluActivationWeights:r=null,leakyreluAlpha:i=0,activation:a=null}){const l=t.shape,u=s.texData.get(t.dataId),d=n.inChannels,h=l[0]*l[1]*l[2],p=n.outChannels,x=n.dataFormat==="channelsLast",b=!1,w=!1;let C;const T=[];if(r!=null){const k=xx(r.shape,x);k!=null&&(r=Ie({inputs:{x:r},backend:s,attrs:{shape:k}}),T.push(r))}if(o!=null){const k=xx(o.shape,x);k!=null&&(o=Ie({inputs:{x:o},backend:s,attrs:{shape:k}}),T.push(o))}if(!((h===1||p===1)&&d>rW)&&u.isPacked&&x&&u.texture!=null&&l[2]%2!==0&&lt(u.shape.slice(-3),l.slice(-3))){const k=l[0]*l[1]*(l[2]+1),A={dataId:t.dataId,shape:[1,k,n.inChannels],dtype:t.dtype},$=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,L(Ap(u.shape,A.shape),()=>`packed reshape ${u.shape} to ${A.shape} isn't free`);const M=Ie({inputs:{x:e},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}});T.push(M);const O=yx({a:A,b:M,backend:s,transposeA:b,transposeB:w,bias:o,activation:a,preluActivationWeights:r,leakyreluAlpha:i}),F=s.texData.get(O.dataId);L(F.isPacked,()=>"batchMatMul result is expected to be packed"),u.shape=$,F.shape=n.outShape,C=po({inputs:{x:O},backend:s}),C.shape=n.outShape,T.push(O)}else{const k=n.outHeight*n.outWidth,A=Ie({inputs:{x:t},backend:s,attrs:{shape:x?[n.batchSize,k,n.inChannels]:[n.batchSize,n.inChannels,k]}}),$=Ie({inputs:{x:e},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}}),M=yx({a:x?A:$,b:x?$:A,transposeA:!x,transposeB:w,backend:s,bias:o,activation:a,preluActivationWeights:r,leakyreluAlpha:i});C=Ie({inputs:{x:M},backend:s,attrs:{shape:n.outShape}}),T.push(A),T.push($),T.push(M)}for(const k of T)s.disposeIntermediateTensorInfo(k);return C}function pW({x:t,filter:e,convInfo:n,backend:s,bias:o=null,preluActivationWeights:r=null,leakyreluAlpha:i=0,activation:a=null}){const{filterWidth:l,filterHeight:u,inChannels:d,outWidth:h,outHeight:p,dataFormat:x}=n,b=x==="channelsLast",w=l*u*d,C=p*h,T=[n.batchSize,w,C],N=!0,I=!1,k=[];if(r!=null){const J=xx(r.shape,b);J!=null&&(r=Ie({inputs:{x:r},backend:s,attrs:{shape:J}}),k.push(r))}if(o!=null){const J=xx(o.shape,b);J!=null&&(o=Ie({inputs:{x:o},backend:s,attrs:{shape:J}}),k.push(o))}const A=Ie({inputs:{x:e},backend:s,attrs:{shape:[1,w,me(e.shape)/w]}});k.push(A);const $=new KRe(T,n),M=[t.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],O=s.runWebGLProgram($,[t],"float32",M),F=Ie({inputs:{x:O},backend:s,attrs:{shape:T}});k.push(O),k.push(F);const P=o!=null,D=r!=null,H=a==="leakyrelu",Z=a?Rp(a,!0):null,ne=new oW(b?F.shape:A.shape,b?A.shape:F.shape,b?[n.batchSize,C,n.outChannels]:[n.batchSize,n.outChannels,C],N,I,P,Z,D,H),Q=b?[F,A]:[A,F];if(o&&Q.push(o),D&&Q.push(r),H){const J=s.makeTensorInfo([],"float32",Hi(i,"float32"));Q.push(J),k.push(J)}const G=s.runWebGLProgram(ne,Q,"float32"),q=Ie({inputs:{x:G},backend:s,attrs:{shape:n.outShape}});k.push(G);for(const J of k)s.disposeIntermediateTensorInfo(J);return q}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XRe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,filter:r}=e,{strides:i,pad:a,dataFormat:l,dilations:u,dimRoundingMode:d}=s,h=qi(l),p=jn(o.shape,r.shape,i,u,a,d,!1,h);let x;if(p.filterHeight===1&&p.filterWidth===1&&p.dilationHeight===1&&p.dilationWidth===1&&p.strideHeight===1&&p.strideWidth===1&&(p.padInfo.type==="SAME"||p.padInfo.type==="VALID"))x=hW({x:o,filter:r,convInfo:p,backend:n});else if(p.strideWidth<=2&&h==="channelsLast"&&ue().getBool("WEBGL_EXP_CONV")){const w=new fW(p),C=[[p.padInfo.top,p.padInfo.left],[p.strideHeight,p.strideWidth],[p.dilationHeight,p.dilationWidth],[p.inHeight,p.inWidth]];x=n.runWebGLProgram(w,[o,r],"float32",C)}else if(ue().getBool("WEBGL_CONV_IM2COL"))x=pW({x:o,filter:r,convInfo:p,backend:n});else{const w=new dW(p);x=n.runWebGLProgram(w,[o,r],"float32")}const b=Ie({inputs:{x},backend:n,attrs:{shape:p.outShape}});return n.disposeIntermediateTensorInfo(x),b}const YRe={kernelName:Qp,backendName:"webgl",kernelFunc:XRe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JRe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,s=e.strideWidth,o=e.padInfo.top,r=e.padInfo.left,i=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${o};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${r};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${i?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class jRe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,o=e.strideHeight,r=e.strideWidth,i=e.dataFormat==="channelsLast",a=n-1-e.padInfo.top,l=s-1-e.padInfo.left,u=i?1:2,d=i?2:3,h=i?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${h}];

        ivec2 dyCorner = ivec2(coords[${u}], coords[${d}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${i}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class ZRe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideDepth,s=e.strideHeight,o=e.strideWidth,r=e.padInfo.front,i=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${n} - ${r};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${i};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${o} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class QRe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterDepth,s=e.filterHeight,o=e.filterWidth,r=e.strideDepth,i=e.strideHeight,a=e.strideWidth,l=n-1-e.padInfo.front,u=s-1-e.padInfo.top,d=o-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${u}, ${d});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${n}; wF++) {
          float dyF = float(dyFCorner + wF) / ${r}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${n} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${o}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${o} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e$e(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,dy:r}=e,{strides:i,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:d}=s,h=qi(l),p=jn(o.shape,d,i,1,a,u,!1,h),x=new JRe(p);return n.runWebGLProgram(x,[o,r],"float32")}const t$e={kernelName:Gx,backendName:"webgl",kernelFunc:e$e};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class n$e{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=Cs(this.outputShape.length);const n=e.filterHeight,s=e.filterWidth,o=n-1-e.padInfo.top,r=s-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${r});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s$e(t){const{inputs:e,backend:n,attrs:s}=t,{dy:o,filter:r}=e,{inputShape:i,strides:a,pad:l,dataFormat:u,dimRoundingMode:d}=s,h=qi(u),p=jn(i,r.shape,a,1,l,d,!1,h);if(ue().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&h==="channelsLast"){const x=[[p.strideHeight,p.strideWidth]],b=new n$e(p);return n.runWebGLProgram(b,[o,r],"float32",x)}else{const x=new jRe(p);return n.runWebGLProgram(x,[o,r],"float32")}}const o$e={kernelName:em,backendName:"webgl",kernelFunc:s$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r$e(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,filter:r}=e,{strides:i,pad:a,dilations:l}=s,u=tl(o.shape,r.shape,i,l,a),d=new qRe(u);return n.runWebGLProgram(d,[o,r],"float32")}const i$e={kernelName:tm,backendName:"webgl",kernelFunc:r$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a$e(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,dy:r}=e,{strides:i,pad:a,filterShape:l}=s,u=tl(o.shape,l,i,1,a),d=new ZRe(u);return n.runWebGLProgram(d,[o,r],"float32")}const l$e={kernelName:Hx,backendName:"webgl",kernelFunc:a$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u$e(t){const{inputs:e,backend:n,attrs:s}=t,{dy:o,filter:r}=e,{pad:i,strides:a,inputShape:l}=s,u=tl(l,r.shape,a,1,i),d=new QRe(u);return n.runWebGLProgram(d,[o,r],"float32")}const c$e={kernelName:Wx,backendName:"webgl",kernelFunc:u$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d$e=Af+`
  return cos(x);
`,f$e=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${$u}
  return result;
`,h$e=xt({opSnippet:d$e,packedOpSnippet:f$e}),p$e={kernelName:Cd,backendName:"webgl",kernelFunc:h$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m$e=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,g$e=xt({opSnippet:m$e}),y$e={kernelName:Td,backendName:"webgl",kernelFunc:g$e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class x$e{constructor(e,n,s,o,r){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[i,a,l,u]=e,[d]=n,[h,p]=s;this.outputShape=[d,h,p,u];const x=o==="bilinear"?1:0,[b,w]=[`${a-1}.0`,`${l-1}.0`],[C,T,N]=h>1?[`${(a-1)/(h-1)}`,"(y2-y1) * height_ratio",`y1*${b} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${b}`],[I,k,A]=p>1?[`${(l-1)/(p-1)}`,"(x2-x1) * width_ratio",`x1*${w} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${w}`];this.userCode=`
      const float height_ratio = float(${C});
      const float width_ratio = float(${I});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${i}) {
          return;
        }

        float height_scale = ${T};
        float width_scale = ${k};

        float in_y = ${N};
        if( in_y < 0.0 || in_y > ${b} ) {
          setOutput(float(${r}));
          return;
        }
        float in_x = ${A};
        if( in_x < 0.0 || in_x > ${w} ) {
          setOutput(float(${r}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${x} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v$e=t=>{const{inputs:e,backend:n,attrs:s}=t,{image:o,boxes:r,boxInd:i}=e,{cropSize:a,method:l,extrapolationValue:u}=s,d=new x$e(o.shape,r.shape,a,l,u);return n.runWebGLProgram(d,[o,r,i],"float32")},b$e={kernelName:Kx,backendName:"webgl",kernelFunc:v$e};var Dp;(function(t){t.Prod="*",t.Sum="+"})(Dp||(Dp={}));class bP{constructor(e,n,s,o){this.op=e,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const r=this.outputShape.length,i=this.op===Dp.Prod?"1.0":"0.0",a=s?i:`getX(${wP(r,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let u="",d="";s?(u=o?`end != ${l-1}`:"end != 0",d=o?"end + 1":"end - 1"):(u=o?`end + pow2 < ${l}`:"end >= pow2",d=o?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${Pt(r)} coords = getOutputCoords();
        int end = ${CP(r,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${u}) {
          int idx = ${d};
          ${CP(r,"coords",this.op)} = idx;
          val ${this.op}= getX(${wP(r,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function wP(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.x, ${e}.y`;if(t===3)return`${e}.x, ${e}.y, ${e}.z`;if(t===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}function CP(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.y`;if(t===3)return`${e}.z`;if(t===4)return`${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mW(t,e,n,s,o,r){const i=e.shape.length,a=rn([s],i);let l=e;a!=null&&(l=Fs({inputs:{x:e},backend:n,attrs:{perm:a}}));const u=yn(1,i)[0];if(u!==i-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const d=l.shape[u];let h=po({inputs:{x:l},backend:n});for(let p=0;p<=Math.ceil(Math.log2(d))-1;p++){const x=new bP(t,l.shape,!1,r),b=[[p]],w=h;h=n.runWebGLProgram(x,[h],h.dtype,b),n.disposeIntermediateTensorInfo(w)}if(o){const p=new bP(t,l.shape,o,r),x=h;h=n.runWebGLProgram(p,[h],h.dtype),n.disposeIntermediateTensorInfo(x)}if(a!=null){const p=nl(a),x=Fs({inputs:{x:h},backend:n,attrs:{perm:p}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(l),x}return h}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w$e(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r,exclusive:i,reverse:a}=s;return mW(Dp.Prod,o,n,r,i,a)}const C$e={kernelName:qx,backendName:"webgl",kernelFunc:w$e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T$e(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r,exclusive:i,reverse:a}=s;return mW(Dp.Sum,o,n,r,i,a)}const S$e={kernelName:nm,backendName:"webgl",kernelFunc:T$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N$e(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,weights:r}=e,{size:i,binaryOutput:a}=s;if(o.shape.length===1){const l=n.readSync(o.dataId),u=n.readSync(r.dataId),d=KH(l,u,r.dtype,r.shape,i);return n.makeTensorInfo([i],r.dtype,d)}else if(o.shape.length===2){const l=n.bufferSync(o),u=n.bufferSync(r),d=kke(l,u,i,a);return n.makeTensorInfo(d.shape,r.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${o.shape.length}.`)}const E$e={kernelName:Xx,backendName:"webgl",kernelFunc:N$e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class I$e{constructor(e,n,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=n,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${n};
      int offset_h = imod(h, ${n});
      int in_w = w / ${n};
      int offset_w = imod(w, ${n});
      int offset_d = (offset_h * ${n} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k$e(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{blockSize:r,dataFormat:i}=s,a=o.shape[0],l=i==="NHWC"?o.shape[1]:o.shape[2],u=i==="NHWC"?o.shape[2]:o.shape[3],d=i==="NHWC"?o.shape[3]:o.shape[1],h=l*r,p=u*r,x=d/(r*r),b=i==="NHWC"?[a,h,p,x]:[a,x,h,p],w=new I$e(b,r,i);return n.runWebGLProgram(w,[o],o.dtype)}const A$e={kernelName:Yx,backendName:"webgl",kernelFunc:k$e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gW{constructor(e,n=!1,s=null,o=!1,r=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Cs(this.outputShape.length);const i=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels;let u="",d="";s&&(o?u=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:r?u=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:u=`
          float activation(float x) {
            ${s}
          }
        `,d="result = activation(result);");const h=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),r&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${u}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${i}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${h}
        ${d}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yW{constructor(e,n=!1,s=null,o=!1,r=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Cs(this.outputShape.length);const i=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,u=e.dilationWidth,d=e.filterHeight,h=e.filterWidth,p=h;let x=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let T=0;T<h;T++)x+=`
          vec4 xTexelC${T*2};
          int xTexelC${T*2}Ready;
          vec4 xTexelC${T*2+1};
          int xTexelC${T*2+1}Ready;
          vec4 xC${T};`;x+=`
    for (int r = 0; r < ${d}; r++) {
      `;for(let T=0;T<h;T++)x+=`
          xTexelC${T*2} = vec4(0.0);
          xTexelC${T*2}Ready = 0;
          xTexelC${T*2+1} = vec4(0.0);
          xTexelC${T*2+1}Ready = 0;
          xC${T} = vec4(0.0);`;x+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let T=0;T<(p+1)/2;T++){const N=T*2;if(x+=`
          xC = xCCorner + ${N*u};
          `,l===1){if(N<h&&(a%2===1?(x+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${N}Ready == 0) {
                  xTexelC${N} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${N}.zw = vec2(0.0);
                  }
                  xTexelC${N}Ready = 1;
                }
              `,u===1&&N>0?x+=`
                xC${N} = vec4(xTexelC${N-2}.zw, xTexelC${N}.xy);
                `:x+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${N} = vec4(previous.zw, xTexelC${N}.xy);
                  } else {
                    xC${N} = vec4(0.0, 0.0, xTexelC${N}.xy);
                  }
                  `):x+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${N}Ready == 0) {
                  xTexelC${N} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${N}.zw = vec2(0.0);
                  }
                  xTexelC${N}Ready = 1;
                }

                xC${N} = xTexelC${N};
                `,N+1<h)){const I=a%2===0?Mx(u):u;u%2===0&&a%2===1||u%2!==0&&a%2!==1?(x+=`
                  xCOffset = xC + imod(pads[1], 2) + ${I};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${N+1}Ready == 0) {
                    xTexelC${N+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${N+1}.zw = vec2(0.0);
                    }
                    xTexelC${N+1}Ready = 1;
                  }
                  `,u>1?x+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${N+1} = vec4(previous.zw, xTexelC${N+1}.xy);
                    } else {
                     xC${N+1} = vec4(0.0, 0.0, xTexelC${N+1}.xy);
                    }
                    `:x+=`
                    xC${N+1} = vec4(xTexelC${N}.zw, xTexelC${N+1}.xy);
                    `):I===1?x+=`
                    xC${N+1} = xTexelC${N};
                    `:x+=`
                    xCOffset = xC + ${I};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${N+1}Ready == 0) {
                      xTexelC${N+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${N+1}.zw = vec2(0.0);
                      }
                      xTexelC${N+1}Ready = 1;
                    }

                    xC${N+1} = xTexelC${N+1};
                    `}}else N<h&&(a%2===1?(x+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${N}Ready == 0) {
                  xTexelC${N} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${N}.zw = vec2(0.0);
                  }
                  xTexelC${N}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${N+1}Ready == 0) {
                  xTexelC${N+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${N+1}.zw = vec2(0.0);
                  }
                  xTexelC${N+1}Ready = 1;
                }

                xC${N} = vec4(xTexelC${N}.zw, xTexelC${N+1}.zw);
              `,N+1<h&&(x+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${N+1} = vec4(xTexelC${N+1}.xy, final.xy);
                `)):(x+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${N}Ready == 0) {
                  xTexelC${N} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${N}.zw = vec2(0.0);
                  }
                  xTexelC${N}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${N+1}Ready == 0) {
                  xTexelC${N+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${N+1}.zw = vec2(0.);
                  }
                  xTexelC${N+1}Ready = 1;
                }

                xC${N} = vec4(
                  xTexelC${N}.xy, xTexelC${N+1}.xy);
              `,N+1<h&&(x+=`
                  xC${N+1} = vec4(xTexelC${N}.zw, xTexelC${N+1}.zw);
                `)));N<h&&(x+=`
            wTexel = getW(r, ${N}, d1, q);
            dotProd += xC${N} * vec4(wTexel.xz, wTexel.xz);
          `,N+1<h&&(x+=`
              wTexel = getW(r, ${N+1}, d1, q);
              dotProd += xC${N+1} * vec4(wTexel.xz, wTexel.xz);
            `))}x+=`
    }
  `,x+=`
      }
    `;let b="",w="";s&&(o?b=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:r?b=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:b=`vec4 activation(vec4 x) {
          ${s}
        }`,w="result = activation(result);");const C=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),r&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${b}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${i};
        int q = d2 - d1 * ${i};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${x}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${C}
        ${w}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R$e(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,filter:r}=e,{strides:i,pad:a,dilations:l,dimRoundingMode:u}=s;let d=l;d==null&&(d=[1,1]),L(fs(i,d),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${d}'`);const h=jn(o.shape,r.shape,i,d,a,u,!0);let p;ue().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels===1?p=new yW(h):p=new gW(h);const x=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return n.runWebGLProgram(p,[o,r],"float32",x)}const $$e={kernelName:sm,backendName:"webgl",kernelFunc:R$e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class D$e{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,s=e.strideWidth,o=e.padInfo.top,r=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${i} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${o};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${r};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class _$e{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,o=e.strideHeight,r=e.strideWidth,i=n-1-e.padInfo.top,a=s-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M$e(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,dy:r}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:u,filterShape:d}=s,h=jn(o.shape,d,i,a,l,u,!0),p=new D$e(h);return n.runWebGLProgram(p,[o,r],"float32")}const F$e={kernelName:Jx,backendName:"webgl",kernelFunc:M$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O$e(t){const{inputs:e,backend:n,attrs:s}=t,{dy:o,filter:r}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:u,inputShape:d}=s,h=jn(d,r.shape,i,a,l,u,!0),p=new _$e(h);return n.runWebGLProgram(p,[o,r],"float32")}const P$e={kernelName:jx,backendName:"webgl",kernelFunc:O$e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class L$e{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V$e(t){const{inputs:e,backend:n}=t,{x:s}=e,o=[...s.shape,...s.shape],r=me(s.shape),i=Ie({inputs:{x:s},backend:n,attrs:{shape:[r]}}),a=new L$e(r),l=n.runWebGLProgram(a,[i],i.dtype),u=Ie({inputs:{x:l},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(l),u}const z$e={kernelName:Zx,backendName:"webgl",kernelFunc:V$e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class B$e{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:n,inWidth:s,padInfo:o,strideHeight:r,strideWidth:i,filterHeight:a,filterWidth:l,dilationHeight:u,dilationWidth:d}=e,{top:h,left:p}=o;this.userCode=`
      const ivec2 strides = ivec2(${r}, ${i});
      const ivec2 pads = ivec2(${h}, ${p});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${u};

          if (hIn >= 0 && hIn < ${n}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${d};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U$e(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,filter:r}=e,{strides:i,pad:a,dilations:l}=s,u=Km(o.shape,r.shape,i,a,"NHWC",l);let d;const h=new B$e(u);d=n.runWebGLProgram(h,[o,r],"float32");const p=Ie({inputs:{x:d},backend:n,attrs:{shape:u.outShape}});return n.disposeIntermediateTensorInfo(d),p}const G$e={kernelName:om,backendName:"webgl",kernelFunc:U$e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H$e(t){const{inputs:e,backend:n,attrs:s}=t,{equation:o}=s,r=e,{allDims:i,summedDims:a,idDims:l}=OI(o,r.length);LI(i.length,l,r);const{path:u,steps:d}=VI(a,l),h=d.length;let p=null,x=i.length;const b=[];for(let w=0;w<h;++w){for(const C of d[w]){const{permutationIndices:T,expandDims:N}=PI(x,l[C]);let I;zI(T)?I=r[C]:(I=Fs({inputs:{x:r[C]},backend:n,attrs:{perm:T}}),b.push(I));const k=I.shape.slice();for(let A=0;A<N.length;++A)k.splice(N[A],0,1);lt(I.shape,k)||(I=Ie({inputs:{x:I},backend:n,attrs:{shape:k}}),b.push(I)),p===null?p=I:(p=WA({inputs:{a:I,b:p},backend:n}),b.push(p))}w<h-1&&(u[w]>=0&&(p=tw({inputs:{x:p},backend:n,attrs:{axis:u[w]-(i.length-x),keepDims:!1}}),b.push(p)),x--)}for(const w of b)w!==p&&n.disposeIntermediateTensorInfo(w);return p}const W$e={kernelName:ev,backendName:"webgl",kernelFunc:H$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q$e="return (x >= 0.0) ? x : (exp(x) - 1.0);",K$e=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,X$e=xt({opSnippet:q$e,packedOpSnippet:K$e}),Y$e={kernelName:Nd,backendName:"webgl",kernelFunc:X$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J$e="return (b >= 0.0) ? a : a * (b + 1.0);",j$e=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,Z$e=t=>{const{inputs:e,backend:n}=t,{dy:s,y:o}=e,r=ue().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new kf(j$e,s.shape,o.shape):new mu(J$e,s.shape,o.shape);return n.runWebGLProgram(r,[s,o],s.dtype)},Q$e={kernelName:tv,backendName:"webgl",kernelFunc:Z$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eDe=`
  return vec4(equal(a, b));
`,tDe="return float(a == b);",nDe=ms({opSnippet:tDe,packedOpSnippet:eDe,dtype:"bool",cpuKernelImpl:_ke}),sDe={kernelName:rm,backendName:"webgl",kernelFunc:nDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oDe=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${AI};
  float a1 = ${RI};
  float a2 = ${$I};
  float a3 = ${DI};
  float a4 = ${_I};
  float a5 = ${MI};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,rDe=xt({opSnippet:oDe}),iDe={kernelName:Ed,backendName:"webgl",kernelFunc:rDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aDe=Af+`
  return exp(x);
`,lDe=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,xW=xt({opSnippet:aDe,packedOpSnippet:lDe,cpuKernelImpl:Mke,dtype:"float32"}),uDe={kernelName:Id,backendName:"webgl",kernelFunc:xW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function US(t){const{inputs:e,attrs:n,backend:s}=t,{dim:o}=n,{input:r}=e,i=r.shape.length,a=r.shape.slice();let l=o;return o<0&&(L(-(i+1)<=o,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),l=i+o+1),a.splice(l,0,1),Ie({inputs:{x:r},backend:s,attrs:{shape:a}})}const cDe={kernelName:im,backendName:"webgl",kernelFunc:US};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TP="return exp(x) - 1.0;",dDe=xt({opSnippet:TP,packedOpSnippet:TP,cpuKernelImpl:Fke}),fDe={kernelName:kd,backendName:"webgl",kernelFunc:dDe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SP{constructor(e,n,s){this.variableNames=["real","imag"];const o=n[1];this.outputShape=n;const r=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,i=s?`${o}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${r};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${o});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${o}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${i};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vW(t,e,n){const s=n.texData.get(t.dataId),o=me(t.shape),r=t.shape[t.shape.length-1],i=o/r,a=Ie({inputs:{x:t},backend:n,attrs:{shape:[i,r]}}),l=a.shape,u=new SP("real",l,e),d=new SP("imag",l,e),h=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:l},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:l}],p=n.runWebGLProgram(u,h,"float32"),x=n.runWebGLProgram(d,h,"float32"),b=ll({inputs:{real:p,imag:x},backend:n});n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(x);const w=Ie({inputs:{x:b},backend:n,attrs:{shape:t.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(b),w}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hDe(t){const{inputs:e,backend:n}=t,{input:s}=e;return vW(s,!1,n)}const pDe={kernelName:nv,backendName:"webgl",kernelFunc:hDe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mDe{constructor(e,n){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ag(t){const{backend:e,attrs:n}=t,{shape:s,value:o}=n;let{dtype:r}=n;if(r=r||vu(o),r==="string"){const i=dn(r,me(s));return i.fill(o),e.makeTensorInfo(s,r,i)}else{const i=new mDe(s,o),a=[[o]];return e.runWebGLProgram(i,[],r,a)}}const gDe={kernelName:sv,backendName:"webgl",kernelFunc:Ag};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yDe{constructor(e){this.variableNames=["Image"],this.outputShape=[];const n=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${n} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${n}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xDe={kernelName:ov,backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{const{image:n}=t,s=e,o=new yDe(n.shape);return s.runWebGLProgram(o,[n],n.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NP="return floor(x);",vDe=xt({opSnippet:NP,packedOpSnippet:NP,cpuKernelImpl:Oke}),bDe={kernelName:Ad,backendName:"webgl",kernelFunc:vDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wDe=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,CDe=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,TDe=ms({opSnippet:wDe,packedOpSnippet:CDe,dtype:"int32"}),SDe={kernelName:Rd,backendName:"webgl",kernelFunc:TDe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NDe{constructor(e){this.variableNames=["A"];const n=Ls(),[s,o]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${o}.0, ${s}.0);

        vec4 values = ${n.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class EDe{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const n=Ls(),[s,o]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${o}.0, ${s}.0);
            vec4 values = ${n.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IDe={kernelName:Y0,backendName:"webgl",kernelFunc:kDe};let vc,lT=ue().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function kDe(t){const{inputs:e,backend:n,attrs:s}=t;let{pixels:o}=e;const{numChannels:r}=s,i=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,[l,u]=i?[o.videoWidth,o.videoHeight]:[o.width,o.height],d=[u,l],h=[u,l,r];if(a||i){const w=ue().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(vc==null||w!==lT)&&(lT=w,vc=document.createElement("canvas").getContext("2d",{willReadFrequently:lT})),vc.canvas.width=l,vc.canvas.height=u,vc.drawImage(o,0,0,l,u),o=vc.canvas}const p=n.makeTensorInfo(d,"int32");n.texData.get(p.dataId).usage=Ao.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(p.dataId),o);const x=ue().getBool("WEBGL_PACK")?new EDe(h):new NDe(h),b=n.runWebGLProgram(x,[p],"int32");return n.disposeData(p.dataId),b}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ADe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,filter:r,bias:i,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:d,dilations:h,dimRoundingMode:p,activation:x,leakyreluAlpha:b}=s,w=qi(d),C=jn(o.shape,r.shape,l,h,u,p,!1,w);let T;const N=[],I=i!=null,k=a!=null,A=x==="leakyrelu",$=()=>{const O=[o,r],F=(P,D)=>{if(D==="NCHW"&&P.shape.length===1&&P.shape[0]!==1){const H=Ie({inputs:{x:P},backend:n,attrs:{shape:[P.shape[0],1,1]}});return N.push(H),H}return P};if(I&&O.push(F(i,d)),k&&O.push(F(a,d)),A){const P=n.makeTensorInfo([],"float32",Hi(b,"float32"));O.push(P),N.push(P)}return O};if(C.filterHeight===1&&C.filterWidth===1&&C.dilationHeight===1&&C.dilationWidth===1&&C.strideHeight===1&&C.strideWidth===1&&(C.padInfo.type==="SAME"||C.padInfo.type==="VALID"))T=hW({x:o,filter:r,convInfo:C,backend:n,bias:i,activation:x,preluActivationWeights:a,leakyreluAlpha:b});else if(C.strideWidth<=2&&w==="channelsLast"&&ue().getBool("WEBGL_EXP_CONV")){const O=x?Rp(x,!0):null,F=new fW(C,I,O,k,A),P=[[C.padInfo.top,C.padInfo.left],[C.strideHeight,C.strideWidth],[C.dilationHeight,C.dilationWidth],[C.inHeight,C.inWidth]],D=$();T=n.runWebGLProgram(F,D,"float32",P)}else if(ue().getBool("WEBGL_CONV_IM2COL"))T=pW({x:o,filter:r,convInfo:C,backend:n,bias:i,activation:x,preluActivationWeights:a,leakyreluAlpha:b});else{const O=x?Rp(x,!1):null,F=new dW(C,I,O,k,A),P=$();T=n.runWebGLProgram(F,P,"float32")}const M=Ie({inputs:{x:T},backend:n,attrs:{shape:C.outShape}});return N.push(T),N.forEach(O=>n.disposeIntermediateTensorInfo(O)),M}const RDe={kernelName:mp,backendName:"webgl",kernelFunc:ADe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $De(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,filter:r,bias:i,preluActivationWeights:a}=e,{strides:l,pad:u,dilations:d,dimRoundingMode:h,activation:p,leakyreluAlpha:x}=s,b=[];let w=d;w==null&&(w=[1,1]),L(fs(l,w),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${w}'`);const C=jn(o.shape,r.shape,l,w,u,h,!0),T=ue().getBool("WEBGL_PACK_DEPTHWISECONV")&&C.strideWidth<=2&&C.outChannels/C.inChannels===1,N=p?Rp(p,T):null,I=[o,r],k=i!=null,A=a!=null,$=p==="leakyrelu";if(k&&I.push(i),A&&I.push(a),$){const P=n.makeTensorInfo([],"float32",Hi(x,"float32"));I.push(P),b.push(P)}let M;T?M=new yW(C,k,N,A,$):M=new gW(C,k,N,A,$);const O=[[C.padInfo.top,C.padInfo.left],[C.strideHeight,C.strideWidth],[C.dilationHeight,C.dilationWidth],[C.inHeight,C.inWidth]],F=n.runWebGLProgram(M,I,"float32",O);return b.forEach(P=>n.disposeIntermediateTensorInfo(P)),F}const DDe={kernelName:gp,backendName:"webgl",kernelFunc:$De};class _De{constructor(e,n,s,o){this.sliceDim=e,this.strides=n,this.paramsShape=o,this.variableNames=["x","indices"],this.outputShape=s;const r=Pt(s.length);let i=`
    int index;`;for(let a=0;a<this.sliceDim;a++)i+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${r} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${i}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MDe(t){const{inputs:e,backend:n}=t,{params:s,indices:o}=e,r=o.shape,i=r[r.length-1],a=me(s.shape),[l,u,d,h]=Eb(s,o),p=Ie({inputs:{x:o},backend:n,attrs:{shape:[u,i]}}),x=Ie({inputs:{x:s},backend:n,attrs:{shape:[me(s.shape)/d,d]}});if(n.shouldExecuteOnCPU([s,o])||s.dtype==="string"){const T=n.readSync(o.dataId),N=n.bufferSync(s),I=Pke(T,N,s.dtype,u,i,d,h,s.shape,a);return n.makeTensorInfo(l,s.dtype,I.values)}const b=new _De(i,h,[u,d],s.shape),w=n.runWebGLProgram(b,[x,p],x.dtype),C=Ie({inputs:{x:w},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(w),C}const FDe={kernelName:rv,backendName:"webgl",kernelFunc:MDe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ODe{constructor(e,n){this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;const s=Pt(this.rank),o=PDe(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${o}));
      }
    `}}function PDe(t,e){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let o=0;o<t.length;o++)o===2?s.push("index"):s.push(`${n[o]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bW(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,indices:r}=e,{axis:i,batchDims:a}=s,l=ot(i,o.shape)[0];if(ue().get("DEBUG")){const N=n.readSync(r.dataId),I=o.shape[l];for(let k=0;k<N.length;++k){const A=N[k];L(A<=I-1&&A>=0,()=>`GatherV2: the index value ${A} is not in [0, ${I-1}]`)}}const u=UI(o,r,l,a),d=me(r.shape),h=[],p=Ie({inputs:{x:o},backend:n,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),x=Ie({inputs:{x:r},backend:n,attrs:{shape:[u.batchSize,d/u.batchSize]}});h.push(p),h.push(x);const b=[u.batchSize,u.outerSize,d/u.batchSize,u.sliceSize];if(n.shouldExecuteOnCPU([o,r])||o.dtype==="string"){const N=n.bufferSync(x),I=n.bufferSync(p),k=Lke(I,N,b);return h.forEach(A=>n.disposeIntermediateTensorInfo(A)),n.makeTensorInfo(u.outputShape,k.dtype,k.values)}const w=new ODe(p.shape,b),C=n.runWebGLProgram(w,[p,x],p.dtype);h.push(C);const T=Ie({inputs:{x:C},backend:n,attrs:{shape:u.outputShape}});return h.forEach(N=>n.disposeIntermediateTensorInfo(N)),T}const LDe={kernelName:lm,backendName:"webgl",kernelFunc:bW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VDe="return float(a > b);",zDe=`
  return vec4(greaterThan(a, b));
`,BDe=ms({opSnippet:VDe,packedOpSnippet:zDe,cpuKernelImpl:Vke,dtype:"bool"}),UDe={kernelName:um,backendName:"webgl",kernelFunc:BDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GDe="return float(a >= b);",HDe=`
  return vec4(greaterThanEqual(a, b));
`,WDe=ms({opSnippet:GDe,packedOpSnippet:HDe,dtype:"bool",cpuKernelImpl:zke}),qDe={kernelName:$d,backendName:"webgl",kernelFunc:WDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KDe(t){const{inputs:e,backend:n}=t,{input:s}=e;return vW(s,!0,n)}const XDe={kernelName:iv,backendName:"webgl",kernelFunc:KDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YDe="return float(!isnan(x) && !isinf(x));",JDe=xt({opSnippet:YDe,dtype:"bool"}),jDe={kernelName:_d,backendName:"webgl",kernelFunc:JDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZDe="return float(isinf(x));",QDe=xt({opSnippet:ZDe,dtype:"bool"}),e_e={kernelName:Md,backendName:"webgl",kernelFunc:QDe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t_e="return float(isnan(x));",n_e=xt({opSnippet:t_e,dtype:"bool"}),s_e={kernelName:Fd,backendName:"webgl",kernelFunc:n_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o_e="return float(a < b);",r_e=`
  return vec4(lessThan(a, b));
`,i_e=ms({opSnippet:o_e,packedOpSnippet:r_e,cpuKernelImpl:Bke,dtype:"bool"}),a_e={kernelName:dm,backendName:"webgl",kernelFunc:i_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l_e="return float(a <= b);",u_e=`
  return vec4(lessThanEqual(a, b));
`,c_e=ms({opSnippet:l_e,packedOpSnippet:u_e,cpuKernelImpl:Uke,dtype:"bool"}),d_e={kernelName:fm,backendName:"webgl",kernelFunc:c_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f_e(t){const{backend:e,attrs:n}=t,{start:s,stop:o,num:r}=n,i=Gke(s,o,r);return e.makeTensorInfo([i.length],"float32",i)}const h_e={kernelName:lv,backendName:"webgl",kernelFunc:f_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p_e=Af+`
  return x < 0.0 ? 0./0. : log(x);
`,m_e=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,g_e=xt({opSnippet:p_e,packedOpSnippet:m_e,cpuKernelImpl:Hke}),y_e={kernelName:Od,backendName:"webgl",kernelFunc:g_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x_e=Af+`
  return log(1.0 + x);
`,v_e=xt({opSnippet:x_e}),b_e={kernelName:Pd,backendName:"webgl",kernelFunc:v_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w_e="return float(a >= 1.0 && b >= 1.0);",C_e=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,T_e=ms({opSnippet:w_e,packedOpSnippet:C_e,dtype:"bool"}),S_e={kernelName:hm,backendName:"webgl",kernelFunc:T_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N_e="return float(!(x >= 1.0));",E_e=xt({opSnippet:N_e}),I_e={kernelName:pm,backendName:"webgl",kernelFunc:E_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k_e="return float(a >= 1.0 || b >= 1.0);",A_e=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,R_e=ms({opSnippet:k_e,packedOpSnippet:A_e,dtype:"bool"}),$_e={kernelName:mm,backendName:"webgl",kernelFunc:R_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class D_e{constructor(e,n,s,o,r){this.variableNames=["x"],this.outputShape=[];const i=n,a=e[3]-1;this.outputShape=e;let l;const u=`float(${s}) + float(${o}) * sum`;r===.5?l=`inversesqrt(${u})`:r===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${r}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${i}; j <= ${i}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class __e{constructor(e,n,s,o,r){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const i=n,a=e[3]-1;this.outputShape=e;let l;const u=`float(${s}) + float(${o}) * sum`;r===.5?l=`inversesqrt(${u})`:r===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${r}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${i};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${i}; j <= ${i}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M_e=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{depthRadius:r,bias:i,alpha:a,beta:l}=s,u=ue().getBool("WEBGL_PACK_NORMALIZATION")?new __e(o.shape,r,i,a,l):new D_e(o.shape,r,i,a,l);return n.runWebGLProgram(u,[o],o.dtype)},F_e={kernelName:gm,backendName:"webgl",kernelFunc:M_e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class O_e{constructor(e,n,s,o,r){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=n,this.bias=s,this.alpha=o,this.beta=r,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${n})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${n} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${o}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${o})
                * float(${r})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${r});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P_e=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:o,y:r,dy:i}=e,{depthRadius:a,bias:l,alpha:u,beta:d}=s,h=new O_e(o.shape,a,l,u,d);return n.runWebGLProgram(h,[o,r,i],o.dtype)},L_e={kernelName:uv,backendName:"webgl",kernelFunc:P_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V_e(t,e,n,s){const o=me(e),i=me(t.shape)/o,a=Ie({inputs:{x:t},attrs:{shape:[i,o]},backend:s}),l=Du(a,t.dtype,"max",s),u=Ie({inputs:{x:l},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wW(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{reductionIndices:r,keepDims:i}=s,a=o.shape.length,l=ot(r,o.shape);let u=l;const d=rn(u,a),h=d!=null,p=n.shouldExecuteOnCPU([o]);let x=o;if(h){if(p){const I=n.texData.get(x.dataId).values,k=new Array(a);for(let M=0;M<k.length;M++)k[M]=o.shape[d[M]];const A=GA(I,o.shape,o.dtype,d,k);x=n.makeTensorInfo(k,o.dtype);const $=n.texData.get(x.dataId);$.values=A}else x=ew(o,d,n);u=yn(u.length,a)}hs("max",u,a);const[b,w]=Zn(x.shape,u);let C=b;i&&(C=gn(b,l));let T;if(p){const I=n.texData.get(x.dataId).values,k=Wke(I,me(w),C,o.dtype);T=n.makeTensorInfo(C,o.dtype);const A=n.texData.get(T.dataId);A.values=k}else T=V_e(x,w,C,n);return h&&n.disposeIntermediateTensorInfo(x),T}const z_e={kernelName:ym,backendName:"webgl",kernelFunc:wW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B_e=HA+`
  return max(a, b);
`,U_e=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+$u+`
  return result;
`,G_e=ms({opSnippet:B_e,packedOpSnippet:U_e,cpuKernelImpl:qke}),H_e={kernelName:Ld,backendName:"webgl",kernelFunc:G_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W_e(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e;Tf(o,"maxPool");const{filterSize:r,strides:i,pad:a,dimRoundingMode:l}=s,u=1;L(fs(i,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const d=sr(o.shape,r,i,u,a,l);if(d.filterWidth===1&&d.filterHeight===1&&lt(d.inShape,d.outShape))return po({inputs:{x:o},backend:n});const h=new $p(d,"max",!1);return n.runWebGLProgram(h,[o],o.dtype)}const q_e={kernelName:xm,backendName:"webgl",kernelFunc:W_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K_e(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{filterSize:r,strides:i,pad:a,dataFormat:l,dimRoundingMode:u}=s,d=[1,1,1],h=Wi(o.shape,r,i,d,a,u,l),p=new qA(h,"max",!1);return n.runWebGLProgram(p,[o],o.dtype)}const X_e={kernelName:vm,backendName:"webgl",kernelFunc:K_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Y_e{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideHeight,s=e.strideWidth,o=e.dilationHeight,r=e.effectiveFilterHeight,i=e.effectiveFilterWidth,a=r-1-e.padInfo.top,l=i-1-e.padInfo.left,u=r*i-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${r};
          wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${n}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${i}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${u} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${i} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class J_e{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideDepth,s=e.strideHeight,o=e.strideWidth,r=e.dilationDepth,i=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,u=e.effectiveFilterHeight,d=e.effectiveFilterWidth,h=l-1-e.padInfo.front,p=u-1-e.padInfo.top,x=d-1-e.padInfo.left,b=l*u*d-1;this.userCode=`
      const ivec3 pads = ivec3(${h}, ${p}, ${x});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${r}) {
          float dyD = float(dyDCorner + wD) / ${n}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${u};
              wR += ${i}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${d};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${o}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${b} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${u} * ${d} +
                  wR * ${d} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j_e(t){const{inputs:e,backend:n,attrs:s}=t,{dy:o,input:r}=e,i=r,{filterSize:a,strides:l,pad:u,dimRoundingMode:d}=s,h=[1,1,1],p=Wi(i.shape,a,l,h,u,d),x=new qA(p,"max",!0),b=n.runWebGLProgram(x,[i],i.dtype),w=new J_e(p),C=n.runWebGLProgram(w,[o,b],i.dtype);return n.disposeIntermediateTensorInfo(b),C}const Z_e={kernelName:dv,backendName:"webgl",kernelFunc:j_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q_e(t){const{inputs:e,backend:n,attrs:s}=t,{dy:o,input:r,output:i}=e,a=r;Tf([r,i],"maxPoolGrad");const{filterSize:l,strides:u,pad:d,dimRoundingMode:h}=s,p=sr(a.shape,l,u,1,d,h),x=!0,b=new $p(p,"max",x),w=n.runWebGLProgram(b,[a],a.dtype),C=new Y_e(p),T=n.runWebGLProgram(C,[o,w],a.dtype);return n.disposeIntermediateTensorInfo(w),T}const eMe={kernelName:cv,backendName:"webgl",kernelFunc:Q_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tMe(t,e,n,s){let o=new $p(n,"max",!1);const r=s.runWebGLProgram(o,[t],"float32");o=new $p(n,"max",!0,!0,e);const i=s.runWebGLProgram(o,[t],"float32");return[r,i]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nMe={kernelName:fv,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{filterSize:o,strides:r,pad:i,includeBatchInIndex:a}=e,l=n;L(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const u=[1,1];L(fs(r,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${r} and dilations '${u}'`);const d=sr(s.shape,o,r,u,i),[h,p]=tMe(s,a,d,l);return[h,p]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sMe(t,e,n,s){const o=me(e),i=me(t.shape)/o,a=Ie({inputs:{x:t},attrs:{shape:[i,o]},backend:s}),l=Du(a,"float32","mean",s),u=Ie({inputs:{x:l},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oMe={kernelName:bm,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{keepDims:o,axis:r}=e,i=n,a=s.shape.length,l=ot(r,s.shape);let u=l;const d=rn(u,a),h=d!=null,p=i.shouldExecuteOnCPU([s]),x=[];let b=s;if(h){if(p){const k=i.texData.get(b.dataId).values,A=new Array(a);for(let O=0;O<A.length;O++)A[O]=s.shape[d[O]];const $=GA(k,s.shape,s.dtype,d,A);b=i.makeTensorInfo(A,s.dtype);const M=i.texData.get(b.dataId);M.values=$}else b=ew(s,d,i);x.push(b),u=yn(u.length,a)}hs("sum",u,a);const[w,C]=Zn(b.shape,u);let T=w;o&&(T=gn(w,l));const N=sMe(b,C,T,i);for(const I of x)i.disposeIntermediateTensorInfo(I);return N}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rMe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r,keepDims:i}=s,a=o.shape.length,l=ot(r,o.shape);let u=l;const d=rn(u,a);let h=o;d!=null&&(h=Fs({inputs:{x:o},backend:n,attrs:{perm:d}}),u=yn(u.length,o.shape.length)),hs("min",u,a);const[p,x]=Zn(h.shape,u),b=me(x),w=Ie({inputs:{x:h},backend:n,attrs:{shape:[-1,b]}}),C=Du(w,w.dtype,"min",n);let T;if(i){const N=gn(p,l);T=Ie({inputs:{x:C},backend:n,attrs:{shape:N}})}else T=Ie({inputs:{x:C},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(w),n.disposeIntermediateTensorInfo(C),d!=null&&n.disposeIntermediateTensorInfo(h),T}const iMe={kernelName:wm,backendName:"webgl",kernelFunc:rMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aMe=HA+`
  return min(a, b);
`,lMe=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+$u+`
  return result;
`,uMe=ms({opSnippet:aMe,packedOpSnippet:lMe,cpuKernelImpl:Kke}),cMe={kernelName:Vd,backendName:"webgl",kernelFunc:uMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dMe{constructor(e,n,s){this.variableNames=["x"],this.outputShape=n.map((d,h)=>d[0]+e[h]+d[1]);const o=e.length,r=Pt(o),i=n.map(d=>d[0]).join(","),a=n.map((d,h)=>d[0]+e[h]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o),u=s==="reflect"?0:1;if(o===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${u};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${u};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${r} start = ${r}(${i});
      ${r} end = ${r}(${a});

      void main() {
        ${r} outC = getOutputCoords();
        for (int i = 0; i < ${o}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${u};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${u};
          }
        }
        ${r} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fMe{constructor(e,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((b,w)=>b[0]+e[w]+b[1]);const o=e.length,r=Pt(o),i=n.map(b=>b[0]).join(","),a=n.map((b,w)=>b[0]+e[w]).join(","),l=$s("rc",o),u=$s("source",o),d=`${l[o-1]} < ${this.outputShape[o-1]}`,h=o===1?"source":`vec2(${u.slice(-2).join()})`,p=s==="reflect"?0:1;let x="";if(o===1){const b=`
        ${r} source = rc;
        if (source < start) {
          source = start * 2 - source - ${p};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${p};
        }
        source -= start;
      `;x=`
        ${r} rc = outputLoc;
        ${b}
        result[0] = getChannel(getX(${u.join()}), ${h});
        ${l[o-1]} += 1;
        if(${d}) {
          ${b}
          result[1] = getChannel(getX(${u.join()}), ${h});
        }
      `}else{const b=`
        ${r} source = rc;
        ${r} lt = ${r}(lessThan(source, start));
        ${r} gte = ${r}(greaterThanEqual(source, end));
        ${r} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${p}) +
                gte * ((end - 1) * 2 - source + ${p});
        source -= start;
      `;x=`
        ${r} rc = outputLoc;
        ${b}
        result[0] = getChannel(getX(${u.join()}), ${h});
        ${l[o-1]} += 1;
        if(${d}) {
          ${b}
          result[1] = getChannel(getX(${u.join()}), ${h});
        }
        rc = outputLoc;
        ${l[o-2]} += 1;
        if(${l[o-2]} < ${this.outputShape[o-2]}) {
          ${b}
          result[2] = getChannel(getX(${u.join()}), ${h});
          ${l[o-1]} += 1;
          if(${d}) {
            ${b}
            result[3] = getChannel(getX(${u.join()}), ${h});
          }
        }
      `}this.userCode=`
      const ${r} start = ${r}(${i});
      const ${r} end = ${r}(${a});

      void main() {
        ${r} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${x}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hMe=({inputs:t,backend:e,attrs:n})=>{const{x:s}=t,{paddings:o,mode:r}=n,i=ue().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new fMe(s.shape,o,r):new dMe(s.shape,o,r);return e.runWebGLProgram(i,[s],s.dtype)},pMe={kernelName:Cm,backendName:"webgl",kernelFunc:hMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mMe=`if (b == 0.0) return NAN;
  return mod(a, b);`,gMe=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+$u+`
  return result;
`,yMe=ms({opSnippet:mMe,packedOpSnippet:gMe}),xMe={kernelName:zd,backendName:"webgl",kernelFunc:yMe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vMe{constructor(e,n,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${n-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${n-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bMe=`
if (a == b) {
  return 1.0;
};
return a / b;`,wMe=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,CW=ms({opSnippet:bMe,packedOpSnippet:wMe,checkOutOfBounds:!0}),CMe={kernelName:Sd,backendName:"webgl",kernelFunc:CW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EP="return a - b;",TW=ms({opSnippet:EP,packedOpSnippet:EP,supportsComplex:!0,cpuKernelImpl:pAe}),TMe={kernelName:nf,backendName:"webgl",kernelFunc:TW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SW(t){const{inputs:e,backend:n,attrs:s}=t,{logits:o}=e,{dim:r}=s,i=ot([r],o.shape),a=wW({inputs:{x:o},backend:n,attrs:{reductionIndices:i,keepDims:!1}}),l=gn(a.shape,i),u=Ie({inputs:{x:a},backend:n,attrs:{shape:l}}),d=TW({inputs:{a:o,b:u},backend:n}),h=xW({inputs:{x:d},backend:n}),p=tw({inputs:{x:h},backend:n,attrs:{axis:i,keepDims:!1}}),x=Ie({inputs:{x:p},backend:n,attrs:{shape:l}}),b=CW({inputs:{a:h,b:x},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(x),b}const SMe={kernelName:zm,backendName:"webgl",kernelFunc:SW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NMe(t){const{inputs:e,backend:n,attrs:s}=t,{logits:o}=e,{numSamples:r,seed:i,normalized:a}=s,l=a?o:SW({inputs:{logits:o},backend:n,attrs:{dim:o.shape.length-1}}),u=l.shape[0],d=l.shape[1],h=new vMe(u,d,r),p=[[i]],x=n.runWebGLProgram(h,[l],"int32",p);return a||n.disposeIntermediateTensorInfo(l),x}const EMe={kernelName:hv,backendName:"webgl",kernelFunc:NMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IMe=rr+`
  return -x;
`,kMe=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function AMe(t){const{inputs:e,backend:n}=t,{x:s}=e;if(n.shouldExecuteOnCPU([s])){const r=n.texData.get(s.dataId),[i,a]=Yke(r.values,s.shape,s.dtype);return n.makeTensorInfo(a,s.dtype,i)}let o;return ue().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new _a(s.shape,kMe):o=new qr(s.shape,IMe),n.runWebGLProgram(o,[s],s.dtype)}const RMe={kernelName:Tm,backendName:"webgl",kernelFunc:AMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Me=Cb;function DMe(t){Eo("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:o,scores:r}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l}=s,u=n.readSync(o.dataId),d=n.readSync(r.dataId),{selectedIndices:h}=$Me(u,d,i,a,l);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}const _Me={kernelName:pv,backendName:"webgl",kernelFunc:DMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MMe=Tb;function FMe(t){Eo("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:o,scores:r}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=s,d=n.readSync(o.dataId),h=n.readSync(r.dataId),{selectedIndices:p,validOutputs:x}=MMe(d,h,i,a,l,u);return[n.makeTensorInfo([p.length],"int32",new Int32Array(p)),n.makeTensorInfo([],"int32",new Int32Array([x]))]}const OMe={kernelName:mv,backendName:"webgl",kernelFunc:FMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PMe=Sb;function LMe(t){Eo("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:o,scores:r}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=s,d=n.readSync(o.dataId),h=n.readSync(r.dataId),p=i,x=a,b=l,w=u,{selectedIndices:C,selectedScores:T}=PMe(d,h,p,x,b,w);return[n.makeTensorInfo([C.length],"int32",new Int32Array(C)),n.makeTensorInfo([T.length],"float32",new Float32Array(T))]}const VMe={kernelName:gv,backendName:"webgl",kernelFunc:LMe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zMe{constructor(e,n,s,o){this.variableNames=["indices"],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${o}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BMe=t=>{const{inputs:e,backend:n,attrs:s}=t,{indices:o}=e,{dtype:r,depth:i,onValue:a,offValue:l}=s,u=me(o.shape),d=new zMe(u,i,a,l),h=Ie({inputs:{x:o},backend:n,attrs:{shape:[u]}}),p=n.runWebGLProgram(d,[h],r);n.disposeIntermediateTensorInfo(h);const x=[...o.shape,i],b=Ie({inputs:{x:p},backend:n,attrs:{shape:x}});return n.disposeIntermediateTensorInfo(p),b},UMe={kernelName:Em,backendName:"webgl",kernelFunc:BMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vx(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="complex64"){const o=kg({inputs:{input:s},backend:n}),r=vx({inputs:{x:o},backend:n}),i=nw({inputs:{input:s},backend:n}),a=vx({inputs:{x:i},backend:n}),l=ll({inputs:{real:r,imag:a},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),l}else return Ag({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:n})}const GMe={kernelName:Hm,backendName:"webgl",kernelFunc:vx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NW(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const o=kg({inputs:{input:s},backend:n}),r=NW({inputs:{x:o},backend:n}),i=nw({inputs:{input:s},backend:n}),a=vx({inputs:{x:i},backend:n}),l=ll({inputs:{real:r,imag:a},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),l}else return Ag({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:n})}const HMe={kernelName:Nm,backendName:"webgl",kernelFunc:NW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WMe(t){const{inputs:e,backend:n,attrs:s}=t,{axis:o}=s;if(e.length===1)return US({inputs:{input:e[0]},backend:n,attrs:{dim:o}});const r=e[0].shape,i=e[0].dtype;e.forEach(d=>{ds(r,d.shape,"All tensors passed to stack must have matching shapes"),L(i===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(d=>{const h=US({inputs:{input:d},backend:n,attrs:{dim:o}});return a.push(h),h}),u=cW({inputs:l,backend:n,attrs:{axis:o}});return a.forEach(d=>n.disposeIntermediateTensorInfo(d)),u}const qMe={kernelName:Im,backendName:"webgl",kernelFunc:WMe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KMe{constructor(e,n,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((u,d)=>u[0]+e[d]+u[1]);const o=e.length,r=Pt(o),i=n.map(u=>u[0]).join(","),a=n.map((u,d)=>u[0]+e[d]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o);if(o===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${r} start = ${r}(${i});
      ${r} end = ${r}(${a});

      void main() {
        ${r} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${r} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XMe{constructor(e,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((w,C)=>w[0]+e[C]+w[1]);const o=e.length,r=Pt(o),i=n.map(w=>w[0]).join(","),a=n.map((w,C)=>w[0]+e[C]).join(","),l=$s("rc",o),u=$s("source",o),d=`${l[o-1]} < ${this.outputShape[o-1]}`,h=o===1?"source":`vec2(${u.slice(-2).join()})`,p=[`${r} rc = outputLoc;`,`${l[o-1]} += 1;
       if(${d}) {
      `,o===1?"":`}
       rc = outputLoc;
       ${l[o-2]} += 1;
       if(${l[o-2]} < ${this.outputShape[o-2]}) {`,o===1?"":`  ${l[o-1]} += 1;
         if(${d}) {`],x=o===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let b="";for(let w=0,C=o===1?2:4;w<C;w++)b+=`
        ${p[w]}
        if (${x}) {
          result[${w}] = float(value);
        } else {
          ${r} source = rc - start;
          result[${w}] = getChannel(getX(${u.join()}), ${h});
        }
      `;b+=o===1?"} ":"}}",this.userCode=`
      const ${r} start = ${r}(${i});
      const ${r} end = ${r}(${a});

      void main() {
        ${r} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${b}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EW=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{paddings:r,constantValue:i}=s;if(me(o.shape)===0){const u=r.map((d,h)=>d[0]+o.shape[h]+d[1]);return Ag({backend:n,attrs:{shape:u,value:i,dtype:o.dtype}})}const a=ue().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new XMe(o.shape,r,i):new KMe(o.shape,r,i),l=[[i]];return n.runWebGLProgram(a,[o],o.dtype,l)},YMe={kernelName:km,backendName:"webgl",kernelFunc:EW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JMe=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,jMe=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+$u+`
  return result;
`,ZMe=ms({opSnippet:JMe,packedOpSnippet:jMe}),QMe={kernelName:Ud,backendName:"webgl",kernelFunc:ZMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eFe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r,keepDims:i}=s,a=o.shape.length,l=[],u=ot(r,o.shape);let d=u;const h=rn(d,a);let p=o;h!=null&&(p=Fs({inputs:{x:o},backend:n,attrs:{perm:h}}),d=yn(d.length,a),l.push(p)),hs("prod",d,a);let x;if(n.shouldExecuteOnCPU([p])){const b=n.texData.get(p.dataId).values,{outVals:w,outShape:C,outDtype:T}=jke(p.shape,p.dtype,b,d);x=n.makeTensorInfo(C,T,w)}else{const[b,w]=Zn(p.shape,d),C=me(w),T=Ie({inputs:{x:p},backend:n,attrs:{shape:[-1,C]}}),N=Uv(o.dtype),I=Du(T,N,"prod",n);x=Ie({inputs:{x:I},backend:n,attrs:{shape:b}}),l.push(T),l.push(I)}if(i){l.push(x);const b=gn(x.shape,u);x=Ie({inputs:{x},backend:n,attrs:{shape:b}})}return l.forEach(b=>n.disposeIntermediateTensorInfo(b)),x}const tFe={kernelName:Rm,backendName:"webgl",kernelFunc:eFe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nFe(t){const{inputs:e,backend:n,attrs:s}=t,{paramsNestedSplits:o,paramsDenseValues:r,indices:i}=e,{outputRaggedRank:a}=s,l=o.map(T=>n.readSync(T.dataId)),u=o.map(T=>T.shape),d=n.readSync(r.dataId),h=n.readSync(i.dataId),[p,x,b]=Zke(l,u,d,r.shape,r.dtype,h,i.shape,a),w=p.map(T=>n.makeTensorInfo([T.length],"int32",T)),C=n.makeTensorInfo(b,r.dtype,x);return w.concat([C])}const sFe={kernelName:yv,backendName:"webgl",kernelFunc:nFe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oFe(t){const{inputs:e,backend:n}=t,{starts:s,limits:o,deltas:r}=e,i=n.readSync(s.dataId),a=n.readSync(o.dataId),l=n.readSync(r.dataId),[u,d]=Qke(i,s.shape,s.dtype,a,o.shape,l,r.shape),h=n.makeTensorInfo([u.length],"int32",u),p=n.makeTensorInfo([d.length],s.dtype,d);return[h,p]}const rFe={kernelName:xv,backendName:"webgl",kernelFunc:oFe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iFe(t){const{inputs:e,backend:n,attrs:s}=t,{shape:o,values:r,defaultValue:i,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,u=n.readSync(o.dataId),d=n.readSync(r.dataId),h=n.readSync(i.dataId),p=a.map(C=>n.readSync(C.dataId)),x=a.map(C=>C.shape),[b,w]=eAe(u,o.shape,d,r.shape,r.dtype,h,i.shape,p,x,l);return n.makeTensorInfo(b,r.dtype,w)}const aFe={kernelName:vv,backendName:"webgl",kernelFunc:iFe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IW=t=>{const{backend:e,attrs:n}=t,{start:s,stop:o,step:r,dtype:i}=n,a=tAe(s,o,r,i);return e.makeTensorInfo([a.length],i,a)},lFe={kernelName:bv,backendName:"webgl",kernelFunc:IW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uFe="return 1.0 / x;",cFe=xt({opSnippet:uFe}),dFe={kernelName:Gd,backendName:"webgl",kernelFunc:cFe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fFe=rr+`
  return (x < 0.0) ? 0.0 : x;
`,hFe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,pFe=xt({opSnippet:fFe,packedOpSnippet:hFe}),mFe={kernelName:Hd,backendName:"webgl",kernelFunc:pFe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gFe=rr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,yFe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,xFe=xt({opSnippet:gFe,packedOpSnippet:yFe}),vFe={kernelName:Wd,backendName:"webgl",kernelFunc:xFe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bFe{constructor(e,n,s,o,r){this.variableNames=["A"],this.outputShape=[];const[i,a,l,u]=e;this.outputShape=[i,n,s,u];const d=[o&&n>1?a-1:a,o&&s>1?l-1:l],h=[o&&n>1?n-1:n,o&&s>1?s-1:s];let p;r?p="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/h[0]},
          ${d[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wFe{constructor(e,n,s,o,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,a,l,u]=e;this.outputShape=[i,n,s,u];const d=[o&&n>1?a-1:a,o&&s>1?l-1:l],h=[o&&n>1?n-1:n,o&&s>1?s-1:s];let p;r?p="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/h[0]},
          ${d[1]/h[1]},
          ${d[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CFe(t){const{inputs:e,backend:n,attrs:s}=t,{images:o}=e,{alignCorners:r,halfPixelCenters:i,size:a}=s,[l,u]=a,d=ue().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new wFe(o.shape,l,u,r,i):new bFe(o.shape,l,u,r,i);return n.runWebGLProgram(d,[o],"float32")}const TFe={kernelName:_m,backendName:"webgl",kernelFunc:CFe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SFe{constructor(e,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,o,r]=n,[,i,a]=e,l=[s&&i>1?o-1:o,s&&a>1?r-1:r],u=[s&&i>1?i-1:i,s&&a>1?a-1:a],d=l[0]/u[0],h=l[1]/u[1],p=1/d,x=1/h,b=Math.ceil(p)*2+2,w=Math.ceil(x)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${h});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${x});

        const int winHeight = int(${b});
        const int winWidth = int(${w});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${o-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${r-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NFe(t){const{inputs:e,backend:n,attrs:s}=t,{images:o,dy:r}=e,{alignCorners:i}=s,a=new SFe(r.shape,o.shape,i);return n.runWebGLProgram(a,[r],r.dtype)}const EFe={kernelName:Tv,backendName:"webgl",kernelFunc:NFe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class IFe{constructor(e,n,s,o,r){this.variableNames=["A"],this.outputShape=[];const[i,a,l,u]=e;this.outputShape=[i,n,s,u];const d=[o&&n>1?a-1:a,o&&s>1?l-1:l],h=[o&&n>1?n-1:n,o&&s>1?s-1:s],p=o?"0.5":"0.0";let x;r?x="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":x="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/h[0]},
          ${d[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${x};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kFe{constructor(e,n,s,o,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,a,l,u]=e;this.outputShape=[i,n,s,u];const d=[o&&n>1?a-1:a,o&&s>1?l-1:l],h=[o&&n>1?n-1:n,o&&s>1?s-1:s],p=o?"0.5":"0.0";let x;r?x="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":x="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/h[0]},
          ${d[1]/h[1]},
          ${d[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${x};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AFe(t){const{inputs:e,backend:n,attrs:s}=t,{images:o}=e,{alignCorners:r,halfPixelCenters:i,size:a}=s,[l,u]=a,d=ue().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new kFe(o.shape,l,u,r,i):new IFe(o.shape,l,u,r,i);return n.runWebGLProgram(d,[o],o.dtype)}const RFe={kernelName:Dm,backendName:"webgl",kernelFunc:AFe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $Fe{constructor(e,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,o,r]=n,[,i,a]=e,l=[s&&i>1?o-1:o,s&&a>1?r-1:r],u=[s&&i>1?i-1:i,s&&a>1?a-1:a],d=l[0]/u[0],h=l[1]/u[1],p=1/d,x=1/h,b=Math.ceil(p)*2+2,w=Math.ceil(x)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${h});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${x});

        const int winHeight = int(${b});
        const int winWidth = int(${w});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${u[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${u[1]}));

            int sourceNearestRow = int(min(
                float(int(${o}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DFe(t){const{inputs:e,backend:n,attrs:s}=t,{images:o,dy:r}=e,{alignCorners:i}=s,a=new $Fe(r.shape,o.shape,i);return n.runWebGLProgram(a,[r],r.dtype)}const _Fe={kernelName:Cv,backendName:"webgl",kernelFunc:DFe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class MFe{constructor(e,n){this.variableNames=["x"];const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=e,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const o=a=>n.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,r=e.map((a,l)=>o(l)).join(","),i=Pt(s);this.userCode=`
      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${r}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class FFe{constructor(e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=e;const o=$s("rc",s),r=`${o[s-1]} + 1 < ${this.outputShape[s-1]}`,i=`${o[s-2]} + 1 < ${this.outputShape[s-2]}`,a=Pt(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${r}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(o.slice())};
          if(${r}){
            result.g = ${u(o.slice())};
          }
          if(${i}) {
            result.b = ${d(o.slice())};
            if(${r}) {
              result.a = ${h(o.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(b){return p(b)}function u(b){return b[s-1]="("+b[s-1]+" + 1)",p(b)}function d(b){return b[s-2]="("+b[s-2]+" + 1)",p(b)}function h(b){return b[s-1]="("+b[s-1]+" + 1)",b[s-2]="("+b[s-2]+" + 1)",p(b)}function p(b){const w=e.map((N,I)=>x(I,b)),C=w.join(","),T=w.slice(-2).join(",");return`getChannel(getX(${C}), vec2(${T}))`}function x(b,w){return n.indexOf(b)!==-1&&e[b]!==1?`${e[b]} - ${w[b]} - 1`:`${w[b]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OFe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{dims:r}=s,i=o.shape.length,a=ot(r,o.shape);if(i===0)return po({inputs:{x:o},backend:n});const l=ue().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new FFe(o.shape,a):new MFe(o.shape,a);return n.runWebGLProgram(l,[o],o.dtype)}const PFe={kernelName:Mm,backendName:"webgl",kernelFunc:OFe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LFe{constructor(e,n){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=e[1],o=e[2];this.outputShape=e;let r="";typeof n=="number"?r=`float outputValue = ${n.toFixed(2)};`:r=`
        vec3 fill = vec3(${n.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${r}
          if(coordX >= 0 && coordX < ${o} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VFe={kernelName:zv,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,{radians:o,fillValue:r,center:i}=e,a=n,l=new LFe(s.shape,r),[u,d]=EI(i,s.shape[1],s.shape[2]),h=[[u,d,Math.sin(o),Math.cos(o)]];return a.runWebGLProgram(l,[s],s.dtype,h)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zFe=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,BFe=xt({opSnippet:zFe}),UFe={kernelName:qd,backendName:"webgl",kernelFunc:BFe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GFe="return inversesqrt(x);",HFe=xt({opSnippet:GFe,cpuKernelImpl:nAe}),WFe={kernelName:Kd,backendName:"webgl",kernelFunc:HFe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KA{constructor(e,n,s,o,r,i,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;const u=Pt(r.length),d=Pt(i.length);let h="";s===1?h="i":s===2&&(h="i, j");const p=`getIndices(${h})`;let x="";o===1?x="i":o===2&&(x="i, coords[1]");const b=`getUpdates(${x})`;let w="";l&&(w="coords[0], coords[1]");const C=`getDefaultValue(${w})`,T=n>1?"strides[j]":"strides";this.userCode=`
        ${u} strides = ${u}(${r});

        void main() {
          ${d} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${n}; j++) {
              int index = round(${p});
              flattenedIndex += index * ${T};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${b};
              found = true;
            }
          }
          setOutput(mix(${C}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qFe{constructor(e,n,s,o,r,i,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=i;const u=Pt(r.length),d=Pt(i.length);let h="";s===1?h="i":s===2&&(h="i, j");const p=`getIndices(${h})`;let x="";o===1?x="i":o===2&&(x="i, coords[1]");const b=`getUpdates(${x})`;let w="";l&&(w="coords[0], coords[1]");const C=`getDefaultValue(${w})`,T=n>1?"strides[j]":"strides",N=n>1?"strides[j + 1]":"strides";this.userCode=`
        ${u} strides = ${u}(${r});

        void main() {
          ${d} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${n}; j+=2) {
              ivec4 index = round(${p});
              flattenedIndex += index.xz * ${T};
              if (j + 1 < ${n}) {
                flattenedIndex += index.yw * ${N};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${b};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${C}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KFe(t){const{inputs:e,backend:n,attrs:s}=t,{indices:o,updates:r}=e,{shape:i}=s,{sliceRank:a,numUpdates:l,sliceSize:u,strides:d,outputSize:h}=il(r,o,i),p=[h/u,u];if(h===0)return n.makeTensorInfo(i,o.dtype);const x=Ie({inputs:{x:o},backend:n,attrs:{shape:[l,a]}}),b=Ie({inputs:{x:r},backend:n,attrs:{shape:[l,u]}}),w=n.makeTensorInfo([],"float32",new Float32Array([0]));let C;ue().getBool("WEBGL_PACK")?C=new qFe(l,a,x.shape.length,b.shape.length,d,p):C=new KA(l,a,x.shape.length,b.shape.length,d,p);const T=n.runWebGLProgram(C,[b,x,w],b.dtype),N=Ie({inputs:{x:T},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(T),n.disposeIntermediateTensorInfo(w),N}const XFe={kernelName:Sv,backendName:"webgl",kernelFunc:KFe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YFe{constructor(e,n,s,o){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,s];const r="while (left < right) {",i=`for (int i = 0; i < ${Math.ceil(Math.log2(n+1))}; ++i) { if (left >= right) break;`,a=ue().getNumber("WEBGL_VERSION")===2?r:i,l=o==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JFe(t){const{inputs:e,backend:n,attrs:s}=t,{sortedSequence:o,values:r}=e,{side:i}=s,a=new YFe(o.shape[0],o.shape[1],r.shape[1],i),l=[[o.shape[1]]];return n.runWebGLProgram(a,[o,r],"int32",l)}const jFe={kernelName:Ev,backendName:"webgl",kernelFunc:JFe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZFe{constructor(e,n,s){this.variableNames=["c","a","b"],this.outputShape=n;let o,r;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)r="resRC",o="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],u=[];for(let d=0;d<n.length;d++)u.push(`${a[d]}`),d<e&&l.push(`${a[d]}`);o=l.join(),r=u.join()}const i=Pt(s);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        float cVal = getC(${o});
        if (cVal >= 1.0) {
          setOutput(getA(${r}));
        } else {
          setOutput(getB(${r}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QFe(t){const{inputs:e,backend:n}=t,{condition:s,t:o,e:r}=e,i=new ZFe(s.shape.length,o.shape,o.shape.length);return n.runWebGLProgram(i,[s,o,r],Ws(o.dtype,r.dtype))}const eOe={kernelName:Fm,backendName:"webgl",kernelFunc:QFe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tOe=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${Ab};
  float scale = ${Rb};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,nOe=xt({opSnippet:tOe}),sOe={kernelName:Xd,backendName:"webgl",kernelFunc:nOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oOe=Af+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,rOe=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,iOe=xt({opSnippet:oOe,packedOpSnippet:rOe,cpuKernelImpl:oAe}),aOe={kernelName:Zd,backendName:"webgl",kernelFunc:iOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lOe=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,uOe=xt({opSnippet:lOe}),cOe={kernelName:jd,backendName:"webgl",kernelFunc:uOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dOe=Af+`
  return sin(x);
`,fOe=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${$u}
  return result;
`,hOe=xt({opSnippet:dOe,packedOpSnippet:fOe}),pOe={kernelName:Yd,backendName:"webgl",kernelFunc:hOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mOe=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,gOe=xt({opSnippet:mOe}),yOe={kernelName:Jd,backendName:"webgl",kernelFunc:gOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xOe=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,vOe=xt({opSnippet:xOe}),bOe={kernelName:Qd,backendName:"webgl",kernelFunc:vOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wOe=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{blockShape:r,paddings:i}=s;L(o.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=r.reduce((T,N)=>T*N),l=[[0,0]];l.push(...i);for(let T=1+r.length;T<o.shape.length;++T)l.push([0,0]);const u=[],d=EW({inputs:{x:o},backend:n,attrs:{paddings:l,constantValue:0}}),h=dg(d.shape,r,a,!1),p=fg(h.length,r.length,!1),x=hg(d.shape,r,a,!1),b=Ie({inputs:{x:d},backend:n,attrs:{shape:h}}),w=Fs({inputs:{x:b},backend:n,attrs:{perm:p}}),C=Ie({inputs:{x:w},backend:n,attrs:{shape:x}});return u.push(d),u.push(b),u.push(w),u.forEach(T=>n.disposeIntermediateTensorInfo(T)),C},COe={kernelName:Lm,backendName:"webgl",kernelFunc:wOe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TOe(t){const{inputs:e,backend:n}=t,{indices:s,values:o,denseShape:r,defaultValue:i}=e;if(r.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${r.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(o.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${o.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const a=n.readSync(s.dataId),l=n.readSync(o.dataId),u=n.readSync(r.dataId),d=n.readSync(i.dataId)[0],[h,p,x,b,w]=iAe(a,s.shape,s.dtype,l,o.dtype,u,d);return[n.makeTensorInfo(p,s.dtype,h),n.makeTensorInfo([p[0]],o.dtype,x),n.makeTensorInfo([b.length],"bool",new Uint8Array(b.map(C=>Number(C)))),n.makeTensorInfo([w.length],s.dtype,new Int32Array(w))]}const SOe={kernelName:Iv,backendName:"webgl",kernelFunc:TOe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NOe(t){const{inputs:e,backend:n}=t,{inputIndices:s,inputShape:o,newShape:r}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(o.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${o.shape}`);if(r.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${r.shape}`);const i=Array.from(n.readSync(o.dataId)),a=n.readSync(s.dataId),l=Array.from(n.readSync(r.dataId)),[u,d,h]=aAe(a,s.shape,s.dtype,i,l);return[n.makeTensorInfo(d,s.dtype,u),n.makeTensorInfo([h.length],r.dtype,new Int32Array(h))]}const EOe={kernelName:kv,backendName:"webgl",kernelFunc:NOe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IOe(t){const{inputs:e,backend:n}=t,{data:s,indices:o,segmentIds:r}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${o.shape}`);if(r.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${r.shape}`);const i=n.readSync(s.dataId),a=n.readSync(o.dataId),l=n.readSync(r.dataId),[u,d]=YH(i,s.shape,s.dtype,a,l,!0);return n.makeTensorInfo(d,s.dtype,u)}const kOe={kernelName:Av,backendName:"webgl",kernelFunc:IOe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AOe(t){const{inputs:e,backend:n}=t,{data:s,indices:o,segmentIds:r}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${o.shape}`);if(r.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${r.shape}`);const i=n.readSync(s.dataId),a=n.readSync(o.dataId),l=n.readSync(r.dataId),[u,d]=YH(i,s.shape,s.dtype,a,l);return n.makeTensorInfo(d,s.dtype,u)}const ROe={kernelName:Rv,backendName:"webgl",kernelFunc:AOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Oe(t){const{inputs:e,backend:n,attrs:s}=t,{sparseIndices:o,sparseValues:r,defaultValue:i}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:u,sliceSize:d,strides:h,outputSize:p}=il(r,o,a),x=!1;if(r.dtype==="string"){const T=n.bufferSync(o),N=n.bufferSync(r),I=Oi(n.readSync(i.dataId)[0]),k=sAe(T,N,a,p,d,u,l,h,I,x);return n.makeTensorInfo(a,k.dtype,k.values)}const b=new KA(u,l,o.shape.length,r.shape.length,h,[p,1],x),w=n.runWebGLProgram(b,[r,o,i],r.dtype),C=Ie({inputs:{x:w},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(w),C}const DOe={kernelName:$v,backendName:"webgl",kernelFunc:$Oe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Oe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{numOrSizeSplits:r,axis:i}=s,a=ot(i,o.shape)[0],l=BI(o,r,a),u=o.shape.length,d=new Array(u).fill(0),h=o.shape.slice();return l.map(p=>{const x=[...h];x[a]=p;const b=Rf({inputs:{x:o},backend:n,attrs:{begin:d,size:x}});return d[a]+=p,b})}const MOe={kernelName:Vm,backendName:"webgl",kernelFunc:_Oe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IP="return sqrt(x);",FOe=xt({opSnippet:IP,packedOpSnippet:IP,cpuKernelImpl:lAe}),OOe={kernelName:ef,backendName:"webgl",kernelFunc:FOe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const POe="return x * x;",LOe=xt({opSnippet:POe}),VOe={kernelName:Dv,backendName:"webgl",kernelFunc:LOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kP="return (a - b) * (a - b);",zOe=ms({opSnippet:kP,packedOpSnippet:kP}),BOe={kernelName:tf,backendName:"webgl",kernelFunc:zOe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UOe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");const r=n.readSync(o.dataId),i=Bi(r),a=uAe(i,"string",s);return n.makeTensorInfo(o.shape,"string",a)}const GOe={kernelName:Bm,backendName:"webgl",kernelFunc:UOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HOe({inputs:t,attrs:e,backend:n}){const{x:s}=t,o=rr+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,r=new qr(s.shape,o);return n.runWebGLProgram(r,[s],s.dtype)}const WOe={kernelName:af,backendName:"webgl",kernelFunc:HOe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qOe{constructor(e,n,s){this.variableNames=["x"],this.outputShape=s;const o=s.length,r=Pt(s.length),i=Pt(s.length);let a="";if(o===1)a="coords * strides + begin";else{let l=0;a=s.map((u,d)=>(l++,s.length===1?`coords * strides[${d}] + begin[${d}]`:`coords[${l-1}] * strides[${d}] + begin[${d}]`)).join(",")}this.userCode=`
      ${r} begin = ${r}(${e});
      ${r} strides = ${r}(${n});

      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KOe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{begin:r,end:i,strides:a,beginMask:l,endMask:u,ellipsisMask:d,newAxisMask:h,shrinkAxisMask:p}=s,{finalShapeSparse:x,finalShape:b,isIdentity:w,sliceDim0:C,isSimpleSlice:T,begin:N,end:I,strides:k}=CI(o.shape,r,i,a,l,u,d,h,p);let A;if(w)A=Ie({inputs:{x:o},backend:n,attrs:{shape:b}});else if(C||T){L(o.shape.length>=1,()=>`Input must have rank at least 1, got: ${o.shape.length}`);const M=vI(N,I,k),O=Rf({inputs:{x:o},backend:n,attrs:{begin:N,size:M}});A=Ie({inputs:{x:O},backend:n,attrs:{shape:b}}),n.disposeIntermediateTensorInfo(O)}else if(n.shouldExecuteOnCPU([o])){const O=n.readSync(o.dataId),F=et(o.shape,o.dtype,O),P=cAe(x,F,k,N);A=n.makeTensorInfo(b,o.dtype,P.values)}else{const O=new qOe(N,k,x);A=n.runWebGLProgram(O,[o],o.dtype)}const $=Ie({inputs:{x:A},backend:n,attrs:{shape:b}});return n.disposeIntermediateTensorInfo(A),$}const XOe={kernelName:_v,backendName:"webgl",kernelFunc:KOe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YOe(t){const{inputs:e,backend:n,attrs:s}=t,{separator:o,nGramWidths:r,leftPad:i,rightPad:a,padWidth:l,preserveShortSequences:u}=s,{data:d,dataSplits:h}=e,p=n.readSync(d.dataId),x=n.readSync(h.dataId),[b,w]=dAe(p,x,o,r,i,a,l,u);return[n.makeTensorInfo([b.length],"string",b),n.makeTensorInfo(h.shape,"int32",w)]}const JOe={kernelName:Mv,backendName:"webgl",kernelFunc:YOe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jOe(t){const{inputs:e,backend:n,attrs:s}=t,{skipEmpty:o}=s,{input:r,delimiter:i}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");if(r.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${r.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const a=n.readSync(r.dataId),l=n.readSync(i.dataId)[0],[u,d,h]=fAe(a,l,o),p=d.length;return[n.makeTensorInfo([p,2],"int32",u),n.makeTensorInfo([p],"string",d),n.makeTensorInfo([2],"int32",new Int32Array(h))]}const ZOe={kernelName:Fv,backendName:"webgl",kernelFunc:jOe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QOe(t){const{inputs:e,backend:n,attrs:s}=t,{numBuckets:o}=s,{input:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");if(o<=0)throw new Error("Number of buckets must be at least 1");const i=n.readSync(r.dataId),a=hAe(i,o);return n.makeTensorInfo(r.shape,"int32",a)}const ePe={kernelName:Ov,backendName:"webgl",kernelFunc:QOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tPe="return tan(x);",nPe=xt({opSnippet:tPe}),sPe={kernelName:sf,backendName:"webgl",kernelFunc:nPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oPe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,rPe=xt({opSnippet:oPe}),iPe={kernelName:of,backendName:"webgl",kernelFunc:rPe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aPe(t){const{inputs:e,backend:n,attrs:s}=t,{tensor:o,indices:r,updates:i}=e,{sliceRank:a,numUpdates:l,sliceSize:u,strides:d,outputSize:h}=il(i,r,o.shape),p=[h/u,u];if(h===0)return n.makeTensorInfo(o.shape,r.dtype);const x=Ie({inputs:{x:r},backend:n,attrs:{shape:[l,a]}}),b=Ie({inputs:{x:i},backend:n,attrs:{shape:[l,u]}}),w=Ie({inputs:{x:o},backend:n,attrs:{shape:p}}),C=new KA(l,a,x.shape.length,b.shape.length,d,p,!1,!0),T=n.runWebGLProgram(C,[b,x,w],w.dtype),N=Ie({inputs:{x:T},backend:n,attrs:{shape:o.shape}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(w),n.disposeIntermediateTensorInfo(T),N}const lPe={kernelName:Nv,backendName:"webgl",kernelFunc:aPe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uPe{constructor(e,n){this.variableNames=["A"];const s=new Array(e.length);for(let i=0;i<s.length;i++)s[i]=e[i]*n[i];this.outputShape=s,this.rank=s.length;const o=Pt(this.rank),r=cPe(e);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        setOutput(getA(${r}));
      }
    `}}function cPe(t){const e=t.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${t[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let o=0;o<t.length;o++)s.push(`imod(${n[o]}, ${t[o]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kW(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{reps:r}=s;if(o.dtype==="string"||o.shape.length>5){const l=n.readSync(o.dataId),u=o.dtype==="string"?l.map(p=>Oi(p)):l,d=et(o.shape,o.dtype,u),h=mAe(d,r);return n.makeTensorInfo(h.shape,h.dtype,h.values)}const i=new uPe(o.shape,r);return n.runWebGLProgram(i,[o],o.dtype)}const dPe={kernelName:rf,backendName:"webgl",kernelFunc:kW};class fPe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class hPe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rl(t,e){e!==null&&t.disposeIntermediateTensorInfo(e)}function AP(t){let e=1;for(;e<t;)e*=2;return e}function pPe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{k:r,sorted:i}=s,a=ue().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=ue().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),u=o.shape,d=u[u.length-1];if(n.shouldExecuteOnCPU([o])||d<a||r>l){const P=n.readSync(o.dataId),[D,H]=gAe(P,u,o.dtype,r,i);return[n.makeTensorInfo(D.shape,D.dtype,D.values),n.makeTensorInfo(H.shape,H.dtype,H.values)]}if(r===0)return u[u.length-1]=0,[n.makeTensorInfo(u,o.dtype,[]),n.makeTensorInfo(u,"int32",[])];if(d===1)return[o,Ag({attrs:{shape:u,dtype:"int32",value:0},backend:n})];const h=n.texData.get(o.dataId),p=h!==null&&h.isPacked,x=p?n.unpackTensor(o):o,w=me(u)/d,C=Ie({inputs:{x},attrs:{shape:[w,d]},backend:n});p&&Rl(n,x);const T=AP(r),N=AP(d);let I=null;const k=()=>I===null?[C,C]:[C,I],A=(P,D,H)=>{const Z=k(),ne=new fPe(H),G=[[d],[I===null?1:0],[Number.NEGATIVE_INFINITY],[P],[D]],q=I;I=n.runWebGLProgram(ne,Z,"int32",G),Rl(n,q)};for(let P=1;P<T;P*=2){const D=P*2;for(let H=P;H>=1;H/=2)A(D,H,[w,N])}for(let P=N;P>T;P/=2){const D=k(),H=new hPe([w,P/2]),ne=[[d],[I===null?1:0],[T]],Q=I;I=n.runWebGLProgram(H,D,"int32",ne),Rl(n,Q);const G=T/2,q=G*2;for(let J=G;J>=1;J/=2)A(q,J,I.shape)}let $=I;I=Rf({inputs:{x:I},backend:n,attrs:{begin:0,size:[w,r]}}),Rl(n,$);let M=bW({inputs:{x:C,indices:I},backend:n,attrs:{axis:1,batchDims:1}});Rl(n,C);const O=u.slice(0,-1);O.push(r),$=I,I=Ie({inputs:{x:I},attrs:{shape:O},backend:n}),Rl(n,$);const F=M;return M=Ie({inputs:{x:M},attrs:{shape:O},backend:n}),Rl(n,F),[M,I]}const mPe={kernelName:Pv,backendName:"webgl",kernelFunc:pPe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gPe{constructor(e,n,s,o,r,i){this.variableNames=["Image","Transforms"],this.outputShape=i;const a=s==="nearest"?1:2;let l;switch(o){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${n}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${r});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${r});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${n}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yPe(t){const{inputs:e,backend:n,attrs:s}=t,{image:o,transforms:r}=e,{interpolation:i,fillMode:a,fillValue:l,outputShape:u}=s,[d,h,p,x]=o.shape,[b,w]=u??[h,p],C=[d,b,w,x],T=new gPe(h,p,i,a,l,C);return n.runWebGLProgram(T,[o,r],"float32")}const xPe={kernelName:Lv,backendName:"webgl",kernelFunc:yPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vPe(t){const{inputs:e,attrs:n,backend:s}=t,{axis:o}=n,{x:r}=e;Tf(r,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const i=s.readSync(r.dataId),{outputValues:a,outputShape:l,indices:u}=yAe(i,o,r.shape,r.dtype);return[s.makeTensorInfo(l,r.dtype,a),s.makeTensorInfo([u.length],"int32",u)]}const bPe={kernelName:Vv,backendName:"webgl",kernelFunc:vPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wPe(t){const{inputs:e,backend:n,attrs:s}=t,{value:o}=e;let{axis:r}=s;r<0&&(r+=o.shape.length);const i=o,a=i.shape.length,l=o.shape[r],u=new Array(a-1);let d=0;for(let w=0;w<a;w++)w!==r&&(u[d++]=i.shape[w]);const h=[],p=new Array(a).fill(0),x=i.shape.slice();x[r]=1;const b=new Array(l);for(let w=0;w<b.length;w++){p[r]=w;const C=Rf({inputs:{x:i},backend:n,attrs:{begin:p,size:x}}),T=Ie({inputs:{x:C},backend:n,attrs:{shape:u}});b[w]=T,h.push(C)}return h.forEach(w=>n.disposeIntermediateTensorInfo(w)),b}const CPe={kernelName:Um,backendName:"webgl",kernelFunc:wPe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TPe{constructor(e,n){this.variableNames=["x","segmentIds"];const s=e.windowSize,o=e.batchSize,r=e.inSize,i=e.numSegments,a=i*Math.ceil(r/s);this.outputShape=[o,a];const l="0.0",u="sumValue",d=Math.floor(s/4)*4,h=s%4,p=`
        sumValue += dot(values, segFilter);
    `;let x="";r%s>0&&(x=`
        if (inIdx < 0 || inIdx >= ${r}) {
          return initializationValue;
        }
      `);let b="";r%s>0&&(b=`
        if (inIdx < 0 || inIdx >= ${r}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${x}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${b}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${i})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${i})));

        float sumValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${p}
        }

        int inIdx = inOffset + ${d};
        if (${h===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${p}
        } else if (${h===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${p}
        } else if (${h===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${p}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SPe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,segmentIds:r}=e,{numSegments:i}=s,a=o.shape.length,l=[];let u=0;const d=rn([u],a);let h=o;d!=null&&(h=Fs({inputs:{x:o},backend:n,attrs:{perm:d}}),l.push(h),u=yn(1,a)[0]);const p=rU(h.shape,u,i),x=me([h.shape[u]]),b=Ie({inputs:{x:h},backend:n,attrs:{shape:[-1,x]}});l.push(b);const w=Uv(o.dtype),C=(k,A,$,M,O)=>{const F=k.shape[0],P=k.shape[1],D=oU(P,O),H={windowSize:D,inSize:P,batchSize:F,numSegments:O},Z=new TPe(H,A),ne=n.compileAndRun(Z,[k,$],M);if(l.push(ne),ne.shape[1]===O)return ne;const Q=IW({backend:n,attrs:{start:0,stop:O,step:1,dtype:"float32"}}),G=kW({inputs:{x:Q},backend:n,attrs:{reps:[P/D]}});return l.push(Q),l.push(G),C(ne,A,G,M,O)},T=C(b,"unsortedSegmentSum",r,w,i),N=Ie({inputs:{x:T},backend:n,attrs:{shape:p}});let I=N;if(d!=null){l.push(N);const k=nl(d);I=Fs({inputs:{x:I},backend:n,attrs:{perm:k}})}return l.forEach(k=>n.disposeIntermediateTensorInfo(k)),I}const NPe={kernelName:Gm,backendName:"webgl",kernelFunc:SPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EPe=[u2e,d2e,p2e,y2e,v2e,C2e,S2e,E2e,R2e,D2e,F2e,L2e,B2e,W2e,X2e,J2e,Z2e,nRe,oRe,iRe,cRe,yRe,vRe,TRe,NRe,$Re,_Re,PRe,qAe,zRe,WRe,YRe,t$e,o$e,i$e,l$e,c$e,p$e,y$e,b$e,C$e,S$e,E$e,A$e,$$e,F$e,P$e,z$e,G$e,W$e,Y$e,Q$e,sDe,iDe,uDe,cDe,fDe,pDe,gDe,xDe,bDe,SDe,IDe,RDe,DDe,FDe,LDe,UDe,qDe,WAe,XDe,GRe,jDe,e_e,s_e,XAe,a_e,d_e,h_e,y_e,b_e,S_e,I_e,$_e,F_e,L_e,z_e,H_e,q_e,X_e,Z_e,eMe,nMe,oMe,iMe,cMe,pMe,xMe,EMe,jAe,RMe,_Me,OMe,VMe,IRe,UMe,HMe,qMe,YMe,QMe,JAe,tFe,sFe,rFe,aFe,lFe,kRe,CMe,dFe,mFe,vFe,QAe,TFe,EFe,RFe,_Fe,PFe,VFe,UFe,WFe,XFe,jFe,eOe,sOe,aOe,cOe,pOe,yOe,mRe,SMe,bOe,COe,SOe,EOe,kOe,ROe,DOe,MOe,OOe,VOe,BOe,GOe,WOe,XOe,JOe,ZOe,ePe,TMe,i2e,sPe,iPe,lPe,dPe,mPe,xPe,a2e,bPe,CPe,NPe,GMe];for(const t of EPe)Bv(t);/** @license See the LICENSE file. */const IPe="4.20.0";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kPe={"tfjs-core":FB,"tfjs-backend-cpu":LG,"tfjs-backend-webgl":ZH,"tfjs-data":U4,"tfjs-layers":Gb,"tfjs-converter":E4,tfjs:IPe},APe=Object.freeze(Object.defineProperty({__proto__:null,Abs:Up,Acos:fd,Acosh:hd,AdadeltaOptimizer:uI,AdagradOptimizer:cI,AdamOptimizer:dI,AdamaxOptimizer:fI,Add:wu,AddN:Gp,All:Ox,Any:Px,ArgMax:Hp,ArgMin:Wp,Asin:pd,Asinh:md,Atan:gd,Atan2:xd,Atanh:yd,AvgPool:qp,AvgPool3D:Kp,AvgPool3DGrad:Vx,AvgPoolGrad:Lx,BatchMatMul:Xp,BatchToSpaceND:Yp,Bincount:zx,BitwiseAnd:Jp,BroadcastArgs:Bx,BroadcastTo:MV,Callback:w4,CallbackList:SU,Cast:vd,Ceil:bd,ClipByValue:wd,Complex:Ux,ComplexAbs:jp,Concat:Zp,Conv2D:Qp,Conv2DBackpropFilter:Gx,Conv2DBackpropInput:em,Conv3D:tm,Conv3DBackpropFilterV2:Hx,Conv3DBackpropInputV2:Wx,Cos:Cd,Cosh:Td,CropAndResize:Kx,Cumprod:qx,Cumsum:nm,CustomCallback:EU,DataStorage:BN,DenseBincount:Xx,DepthToSpace:Yx,DepthwiseConv2dNative:sm,DepthwiseConv2dNativeBackpropFilter:Jx,DepthwiseConv2dNativeBackpropInput:jx,Diag:Zx,Dilation2D:om,Dilation2DBackpropFilter:X0,Dilation2DBackpropInput:K0,Draw:Qx,get ENV(){return qN},EarlyStopping:C4,Einsum:ev,Elu:Nd,EluGrad:tv,Environment:DV,Equal:rm,Erf:Ed,Exp:Id,ExpandDims:im,Expm1:kd,FFT:nv,Fill:sv,FlipLeftRight:ov,Floor:Ad,FloorDiv:Rd,FromPixels:Y0,FusedBatchNorm:am,FusedConv2D:mp,FusedDepthwiseConv2D:gp,GPGPUContext:D0,GatherNd:rv,GatherV2:lm,GraphModel:vA,Greater:um,GreaterEqual:$d,History:NU,IFFT:iv,Identity:Dd,Imag:av,InputSpec:En,IsFinite:_d,IsInf:Md,IsNan:Fd,KernelBackend:_x,LRN:gm,LRNGrad:uv,LayerVariable:bU,LayersModel:$i,LeakyRelu:cm,Less:dm,LessEqual:fm,LinSpace:lv,Log:Od,Log1p:Pd,LogSoftmax:FV,LogicalAnd:hm,LogicalNot:pm,LogicalOr:mm,LogicalXor:xie,LowerBound:vie,MathBackendCPU:Tg,MathBackendWebGL:Ig,MatrixBandPart:bie,Max:ym,MaxPool:xm,MaxPool3D:vm,MaxPool3DGrad:dv,MaxPoolGrad:cv,MaxPoolWithArgmax:fv,Maximum:Ld,Mean:bm,Min:wm,Minimum:Vd,MirrorPad:Cm,Mod:zd,MomentumOptimizer:hI,Multinomial:hv,Multiply:Bd,Neg:Tm,NonMaxSuppressionV3:pv,NonMaxSuppressionV4:mv,NonMaxSuppressionV5:gv,NotEqual:Sm,OP_SCOPE_SUFFIX:jN,OneHot:Em,OnesLike:Nm,Optimizer:Ji,OptimizerConstructors:OB,Pack:Im,PadV2:km,Pool:wie,Pow:Ud,Prelu:Am,Prod:Rm,RMSPropOptimizer:pI,RNN:$r,RaggedGather:yv,RaggedRange:xv,RaggedTensorToTensor:vv,Range:bv,get Rank(){return XT},Real:wv,RealDiv:Sd,Reciprocal:Gd,get Reduction(){return Rs},Relu:Hd,Relu6:Wd,Reshape:$m,ResizeBilinear:_m,ResizeBilinearGrad:Tv,ResizeNearestNeighbor:Dm,ResizeNearestNeighborGrad:Cv,Reverse:Mm,RotateWithOffset:zv,Round:qd,Rsqrt:Kd,SGDOptimizer:Nb,ScatterNd:Sv,SearchSorted:Ev,Select:Fm,Selu:Xd,Sequential:uu,Sigmoid:Zd,Sign:jd,Sin:Yd,Sinh:Jd,Slice:Om,Softmax:zm,Softplus:Qd,SpaceToBatchND:Lm,SparseFillEmptyRows:Iv,SparseReshape:kv,SparseSegmentMean:Av,SparseSegmentSum:Rv,SparseToDense:$v,SplitV:Vm,Sqrt:ef,Square:Dv,SquaredDifference:tf,StaticRegexReplace:Bm,Step:af,StridedSlice:_v,StringNGrams:Mv,StringSplit:Fv,StringToHashBucketFast:Ov,Sub:nf,Sum:Pm,SymbolicTensor:Nr,Tan:sf,Tanh:of,Tensor:yt,TensorBuffer:In,TensorScatterUpdate:Nv,Tile:rf,TopK:Pv,Transform:Lv,Transpose:ql,Unique:Vv,Unpack:Um,UnsortedSegmentSum:Gm,UpperBound:Cie,Variable:vp,ZerosLike:Hm,_FusedMatMul:pp,abs:Sn,acos:rE,acosh:iE,add:Te,addN:dz,all:Wv,any:wp,argMax:nu,argMin:aE,asin:lE,asinh:uE,atan:cE,atan2:dE,atanh:fE,avgPool:Xm,avgPool3d:pE,backend:QN,backend_util:aU,basicLSTMCell:fz,batchNorm:lf,batchNorm2d:mE,batchNorm3d:gE,batchNorm4d:yE,batchToSpaceND:Ym,bincount:xE,bitwiseAnd:hz,booleanMaskAsync:jz,broadcastArgs:pz,broadcastTo:Kl,broadcast_util:jle,browser:ppe,buffer:et,callbacks:Ave,cast:Ne,ceil:vE,clipByValue:Ks,clone:jr,complex:Li,concat:mn,concat1d:bE,concat2d:wE,concat3d:CE,concat4d:TE,constraints:gye,conv1d:qv,conv2d:Vi,conv2dTranspose:Kv,conv3d:NE,conv3dTranspose:EE,copyRegisteredKernels:Eie,cos:Jm,cosh:Xv,cosineWindow:yb,cumprod:Sp,cumsum:Yv,customGrad:oi,data:Uwe,denseBincount:Z0,deprecationWarn:sae,depthToSpace:IE,depthwiseConv2d:uf,deregisterOp:Dve,device_util:jie,diag:gz,dilation2d:kE,disableDeprecationWarnings:nae,dispose:je,disposeVariables:oae,div:Pe,divNoNan:AE,dot:RE,dropout:oI,einsum:Fl,elu:cf,enableDebugMode:tae,enableProdMode:eae,enclosingPowerOfTwo:rI,engine:mr,ensureShape:yz,env:ue,equal:co,erf:Jv,euclideanNorm:DE,exp:Xs,expandDims:rs,expm1:_E,eye:jv,fft:ug,fill:Cu,findBackend:lae,findBackendFactory:uae,floor:ff,floorDiv:Hv,forceHalfFloat:QH,fused:iB,gather:hf,gatherND:tB,gather_util:mpe,getBackend:jV,getGradient:qT,getKernel:xp,getKernelsForBackend:J0,gpgpu_util:Nke,grad:Mue,grads:Fue,greater:Ps,greaterEqual:Ki,ifft:Jc,imag:jm,image:Zo,inTopKAsync:nB,initializers:Dye,input:zU,io:yI,irfft:db,isFinite:ME,isInf:FE,isNaN:OE,keep:Fn,kernel_impls:Spe,layers:ive,leakyRelu:Zm,less:qc,lessEqual:sl,linalg:lI,linspace:bz,loadGraphModel:swe,loadGraphModelSync:owe,loadLayersModel:w0e,localResponseNormalization:PE,log:fo,log1p:Qm,logSigmoid:LE,logSoftmax:Qv,logSumExp:eg,logicalAnd:nr,logicalNot:tg,logicalOr:eb,logicalXor:VE,losses:hB,lowerBound:Cz,matMul:st,math:ipe,max:Do,maxPool:ng,maxPool3d:zE,maxPoolWithArgmax:Tz,maximum:ii,mean:tn,memory:eS,meshgrid:Sz,metrics:Cve,min:Wc,minimum:Wa,mirrorPad:BE,mod:UE,model:S0e,models:Tve,moments:sg,movingAverage:Zz,mul:j,multiRNNCell:Nz,multinomial:Ez,neg:Ht,nextFrame:TI,norm:df,notEqual:ru,oneHot:Kc,ones:Gs,onesLike:ho,op:K,outerProduct:Iz,pad:Xi,pad1d:kz,pad2d:Az,pad3d:Rz,pad4d:$z,pool:GE,pow:si,prelu:rg,print:oE,prod:HE,profile:rae,raggedGather:Dz,raggedRange:_z,raggedTensorToTensor:Mz,rand:Fz,randomGamma:Lz,randomNormal:nb,randomStandardNormal:Vz,randomUniform:ol,randomUniformInt:zz,range:iu,ready:nS,real:Xc,reciprocal:XE,registerBackend:ZN,registerCallbackConstructor:E0e,registerGradient:OV,registerKernel:Bv,registerOp:$ve,regularizers:Ive,relu:Ar,relu6:sb,removeBackend:aae,reshape:ee,reverse:_o,reverse1d:Bz,reverse2d:Uz,reverse3d:Gz,reverse4d:Hz,rfft:cg,round:ob,rsqrt:rb,scalar:Be,scatterND:Qz,scatter_util:Vde,searchSorted:tb,selu:ib,separableConv2d:ab,sequential:N0e,serialization:zhe,setBackend:tS,setPlatform:cae,setWebGLContext:tH,setdiff1dAsync:Wz,shared:PG,sigmoid:br,sign:YE,signal:fB,sin:lb,sinh:ub,slice:mt,slice1d:ig,slice2d:cb,slice3d:ag,slice4d:Yc,slice_util:MB,softmax:lg,softplus:Tu,spaceToBatchND:og,sparse:pB,sparseToDense:eB,spectral:dB,split:Hs,sqrt:Yn,square:Ot,squaredDifference:fb,squeeze:rl,stack:Ms,step:Su,stridedSlice:JE,string:mB,sub:$e,sum:_e,sumOutType:Uv,tan:jE,tanh:Ha,tensor:uo,tensor1d:us,tensor2d:Fa,tensor3d:ZE,tensor4d:qz,tensor5d:Kz,tensor6d:Xz,tensorScatterUpdate:Yz,tensor_util:qie,test_util:Zce,tidy:le,tile:ko,time:iae,topk:eI,train:_l,transpose:ct,truncatedNormal:pb,unique:tI,unregisterGradient:Nie,unregisterKernel:Sie,unsortedSegmentSum:mb,unstack:Mo,upcastType:Ws,upperBound:Jz,util:Mie,valueAndGrad:Oue,valueAndGrads:Pue,variable:nI,variableGrads:wz,version:kPe,version_converter:E4,version_core:FB,version_cpu:LG,version_layers:Gb,version_webgl:ZH,webgl:HAe,webgl_util:$Ie,where:Kn,whereAsync:sI,zeros:Nn,zerosLike:gt},Symbol.toStringTag,{value:"Module"})),RPe=({scale:t,name:e,version:n,meta:{architecture:s,...o},path:r})=>({scale:t,modelType:"layers",_internals:{path:r,name:e,version:n},meta:{architecture:s,...o},inputRange:[0,255],outputRange:[0,255]}),$Pe="@upscalerjs/default-model",DPe="1.0.0-beta.17",_Pe=2,MPe=RPe({scale:_Pe,name:$Pe,version:DPe,path:"models/model.json",meta:{C:1,D:2,G:4,G0:64,T:10,architecture:"rdn",patchSize:128,size:"slim",artifactReducing:!1,sharpening:!1,dataset:"div2k",modelFileName:"rdn-C1-D2-G4-G064-T10-x2-patchsize128-compress100-sharpen0-datadiv2k-vary_cFalse_best-val_loss_epoch494"}});var Jl;(function(t){t.UNDEFINED="undefined",t.INVALID_MODEL_TYPE="invalidModelType",t.MISSING_PATH="missingPath"})(Jl||(Jl={}));const AW=t=>!t||!Array.isArray(t)||t.length!==4?!1:t.every(e=>e===null||typeof e=="number"),RW=t=>AW(t)&&t[1]!==null&&t[2]!==null&&t[1]>0&&t[2]>0;function $W(t){function e(n){try{return n.shape.length===t}catch{}return!1}return e}const DW=$W(4),FPe=$W(3),Rg=t=>t instanceof yt,OPe=t=>typeof t=="string",PPe=t=>typeof t=="string"&&["layers","graph"].includes(t);class M0 extends Error{constructor(n){super(n);qo(this,"type");this.type=n}}const LPe=t=>{var e;if(t===void 0)throw new M0(Jl.UNDEFINED);if(!PPe(t.modelType??"layers"))throw new M0(Jl.INVALID_MODEL_TYPE);if(!t.path&&!((e=t._internals)!=null&&e.path))throw new M0(Jl.MISSING_PATH);return!0},VPe=t=>typeof t=="number",_W=t=>Array.isArray(t)&&t.length===2&&t.every(VPe),np=t=>{console.warn(Array.isArray(t)?t.join(`
`):t)};function XA(t){return t!==void 0&&typeof t=="function"}function zPe(t){return XA(t)&&t.length<=1}const BPe=(t,e,n)=>!XA(t)||t.length<=1?!1:n===void 0&&e==="tensor"?!0:n==="tensor",UPe=t=>t?t.aborted:!1;async function MW(t,e){let n;for(n=await t.next();!n.done;n=await t.next())e&&await e(n.value);return n.value}function FW(t){return t!=null}function sp(t,e,...n){const s=n.filter(FW);if(s.length){const o=t.tidy(()=>s.reduce((r,i)=>i(r),e));return!e.isDisposed&&e!==o&&e.dispose(),o}return e}const GPe=t=>t instanceof M0,HPe="https://upscalerjs.com/documentation/troubleshooting#deprecated-model-definition-function",WPe=["Passing a model definition as a function is deprecated and will be removed in a future version.","To leverage model lifecycle methods, use the setup and teardown methods.",`For more information, see ${HPe}.`].join(" "),qPe="https://upscalerjs.com/documentation/troubleshooting#padding-is-undefined",KPe=['"padding" is undefined, but "patchSize" is explicitly defined.',"Without padding, patches of images often have visible artifacting at the seams. Defining an explicit padding will resolve the artifacting.",`For more information, see ${qPe}.`,'To hide this warning, pass an explicit padding of "0".'].join(" "),XPe="https://upscalerjs.com/documentation/troubleshooting#progress-specified-without-patch-size",YPe=['The "progress" callback was provided but "patchSize" was not defined.','Without a "patchSize", the "progress" callback will never be called.',`For more information, see ${XPe}.`].join(" "),JPe="https://upscalerjs.com/documentation/troubleshooting#invalid-predicted-tensor",jPe=t=>[`The tensor returned by the model was not a valid rank-4 tensor. It's shape is ${JSON.stringify(t)}.}`,"UpscalerJS only supports models returning valid image-like data in four dimensional form.",`For more information, see ${JPe}.`].join(" "),ZPe="https://upscalerjs.com/documentation/troubleshooting#invalid-model-prediction",QPe=["The model output was not a valid tensor. UpscalerJS only supports models returning valid tensors.","This is likely an error with the model itself, not UpscalerJS.",`For more information, see ${ZPe}.`].join(" "),eLe=new Error("No defined tensors were passed to concatTensors");class tLe extends Error{constructor(){super(...arguments);qo(this,"message","The upscale request received an abort signal")}}const nLe="https://upscalerjs.com/documentation/troubleshooting#invalid-model-type",sLe="https://upscalerjs.com/documentation/troubleshooting#input-size-and-patch-size",oLe="https://upscalerjs.com/documentation/troubleshooting#error-with-model-input-shape",rLe=t=>[`You've provided an invalid model type: ${JSON.stringify(t)}. Accepted types are "layers" and "graph".`,`For more information, see ${nLe}.`].join(" "),YA="There is a bug with the upscaler code. Please report this.",iLe=["You have provided a patchSize, but the model definition already includes an input size.","Your patchSize will be ignored.",`For more information, see ${sLe}.`].join(" "),aLe=t=>[`Expected model to have a rank-4 compatible input shape. Instead got: ${JSON.stringify(t)}.`,`For more information, see ${oLe}.`].join(" "),lLe=t=>new Error([`Invalid patch size: ${t}. Patch size must be greater than 0.`].join(" ")),uLe=(t,e)=>new Error([`Invalid patch size and padding: ${t} and ${e}. Patch size must be greater than padding * 2.`].join(" ")),cLe="https://upscalerjs.com/documentation/troubleshooting#patch-size-indivisible-by-divisibility-factor",dLe=(t,e,n)=>[`Invalid patch size: ${t}. The model has a defined divibility factor of ${e} and patch size must be a multiple of this number.`,`Patch size has been scaled up to ${n}.`,`
For more information, see ${cLe}.`].join(" "),fLe=new Error(["Model input sizes must be square. If you are using a model with a non-square input size and would like to request support,","please file a feature request at https://github.com/thekevinscott/upscalerjs"].join(" ")),hLe="https://upscalerjs.com/documentation/troubleshooting#missing-path-and-internals",pLe=t=>['Provided model configuration is missing both a "path" and "_internals". A valid path to a model JSON file must be provided.',`For more information, see ${hLe}.`,`The model configuration provided was: ${JSON.stringify(t)}`].join(" ");function mLe(t,e){switch(t){case Jl.INVALID_MODEL_TYPE:return new Error(rLe(e==null?void 0:e.modelType));case Jl.MISSING_PATH:return new Error(pLe(e));default:return new Error(YA)}}const OW=(t,e,n)=>async s=>{if(n&&await t.nextFrame(),UPe(e))throw Array.isArray(s)?s.forEach(o=>o==null?void 0:o.dispose()):Rg(s)&&s.dispose(),new tLe},bx=t=>!t||typeof t!="object"?!1:"patchSize"in t&&typeof t.patchSize=="number",GS=t=>!!t&&typeof t=="number"&&t>0,gLe="https://upscalerjs.com/documentation/troubleshooting#invalid-warmup-value",yLe=t=>["Invalid value passed to warmup in warmupSizes:",JSON.stringify(t),`For more information, see ${gLe}.`].join(`
`),HS=t=>new Error(yLe(t)),xLe=t=>{if(bx(t)){const{patchSize:e}=t;return e}return t};async function*vLe(t,e,n){const{model:s,modelDefinition:o}=await e;for(const r of n){if(!bx(r)&&!GS(r))throw HS(r);const i=xLe(r);let a=t.zeros([1,i,i,3]);yield[a];const l=[o.preprocess,u=>s.predict(u),o.postprocess].filter(Boolean);for(const u of l)a=sp(t,a,u),yield[a];a.dispose(),yield}}const bLe=t=>{if(Array.isArray(t)){for(const e of t)if(!bx(e)&&!GS(e))throw HS(t);return t}else if(bx(t)||GS(t))return[t];throw HS(t)},RP=async(t,e,n,{signal:s=void 0,awaitNextFrame:o=!1}={},r)=>{const i=OW(t,s||r.signal,o);await i(),await MW(vLe(t,e,bLe(n)),i)},wLe=(t,e)=>e instanceof t.LayersModel,CLe=t=>({...t});function TLe(t){return typeof t=="function"}function SLe(t,e){return TLe(e)?(np(WPe),e(t)):e}async function NLe(t,e){const n=SLe(t,e);return n.setup&&await n.setup(t),n}function $P(t,e,n){return n==="graph"?t.loadGraphModel(e):t.loadLayersModel(e)}const ELe=(t,e)=>wLe(t,e)?e.layers[0].batchInputShape:e.inputs[0].shape,ILe=(t,{model:e})=>{const n=ELe(t,e);if(!AW(n))throw new Error(aLe(n));return n},uT=(t,e)=>Math.ceil(e/t)*t,kLe=(t,e,{patchSize:n,padding:s},o)=>{const r=ILe(t,e);if(n!==void 0){if(n<=0)throw lLe(n);if(s!==void 0&&s*2>=n)throw uLe(n,s)}if(RW(r)){if(n!==void 0&&np(iLe),r[1]!==r[2])throw fLe;return{patchSize:r[1],padding:s,modelInputShape:r}}n!==void 0&&s===void 0&&np(KPe);const{divisibilityFactor:i}=e.modelDefinition;if(i!==void 0){if(n!==void 0){const a=uT(i,n);return a!==n&&np(dLe(n,i,a)),{patchSize:a,padding:s,modelInputShape:[null,a,a,3]}}return{patchSize:void 0,padding:void 0,modelInputShape:[null,uT(i,o[1]),uT(i,o[2]),3]}}return{patchSize:n,padding:s,modelInputShape:void 0}},ALe=(t,e)=>n=>{const s=n.shape[1],o=n.shape[2];return RW(e)&&(e[1]>s||e[2]>o)?t.tidy(()=>{const r=Math.max(s,e[1]),i=Math.max(o,e[2]),a=t.zeros([1,s,i-o,3]),l=t.zeros([1,r-s,i,3]),u=t.concat([n,a],2);return t.concat([u,l],1)}):n},DP=(t,e,n)=>s=>{const o=e[1]*n,r=e[2]*n;return o<s.shape[1]||r<s.shape[2]?t.tidy(()=>t.slice(s,[0,0,0],[1,o,r,3])):s},_P=t=>e=>{const n=_W(t)?t[1]:255;return e.clipByValue(0,n).mul(n===1?255:1)},RLe=(t,e)=>n=>_W(e)&&e[1]===1?t.mul(n,1/255):n,$Le=(t,e)=>t.tidy(()=>{const[n,s]=e.shape,o=t.fill([n,s],255).expandDims(2);return e.clipByValue(0,255).concat([o],2).dataSync()});function DLe(t){return Rg(t)?t.clone():t}function MP(t,e,n=0){const s=e.filter(FW);if(s.length===0)throw eLe;const o=t.concat(s,n);return e.forEach(r=>r==null?void 0:r.dispose()),o}const FP=(t,e,n,s)=>{let o=e;const r=e===0||n===t?0:s,i=o+n>t;let a=i?n-(t-o):0;const l=i||n===t?0:s,u=i?0:r;let d=n-(i?a:0);i&&(o=t-n),o-=u,a+=u,d-=u+l;const h=n>t?t:n-r-l;return{pre:{origin:o,size:n},post:{origin:a,size:d},increment:h}},_Le=([t,e],n,s)=>{const o=[];let r=0,i=0;for(;i<e;){const{pre:{origin:a,size:l},post:{origin:u,size:d},increment:h}=FP(e,i,Math.min(n,e),s),p=[];for(;r<t;){const{pre:{origin:x,size:b},post:{origin:w,size:C},increment:T}=FP(t,r,Math.min(n,t),s);p.push({pre:{origin:[a,x],size:[l,b]},post:{origin:[u,w],size:[d,C]}}),r+=T}o.push(p),r=0,i+=h}return o},MLe=(t,e,n,s)=>(t*n+e+1)/s,OP=(t,e)=>{const n=t.predict(e);if(!Rg(n))throw new Error(QPe);if(DW(n))return n;throw new Error(jPe(n.shape))};async function*FLe(t,e,{output:n,progress:s,progressOutput:o},r,{originalImageSize:i,patchSize:a,padding:l=0},{tensorAsBase64:u}){const{model:d,modelDefinition:h}=r,p=h.scale??1;if(a){const[C,T]=e.shape.slice(1),N=_Le([T,C],a,l);yield;let I;const k=N.length*N[0].length;for(let M=0;M<N.length;M++){const O=N[M],F=O.length;let P;yield[P,I];for(let D=0;D<F;D++){const{pre:H,post:Z}=O[D];yield[I,P];const ne=e.slice([0,...H.origin],[-1,...H.size]);yield[I,P,ne];const Q=OP(d,ne);ne.dispose(),yield[I,P,Q];const G=[0,Z.origin[0]*p,Z.origin[1]*p],q=[-1,Z.size[0]*p,Z.size[1]*p],J=Q.slice(G,q);Q.dispose(),yield[I,P,J];const oe=sp(t,J,h.postprocess,_P(h.outputRange));if(yield[I,P,oe],s!==void 0&&XA(s)){const B=MLe(M,D,F,k);if(zPe(s))s(B);else{const X=oe.squeeze(),ie={row:M,col:D,patchCoordinates:{pre:H,post:Z}};if(BPe(s,n,o))s(B,X,ie);else{const re=u(t,X);X.dispose(),s(B,re,ie)}}}yield[I,P,oe],P=MP(t,[P,oe],2),oe.dispose(),yield[I,P]}I=MP(t,[I,P],1),P.dispose(),yield[I]}const A=sp(t,I.clone(),DP(t,i,p));I==null||I.dispose(),yield[A];const $=A.squeeze();return A.dispose(),$}s&&np(YPe);const x=OP(d,e);yield[x];const b=sp(t,x.clone(),h.postprocess,_P(h.outputRange),DP(t,i,p));x.dispose(),yield[b];const w=b.squeeze();return b.dispose(),w}async function*OLe(t,e,n,s,{getImageAsTensor:o,tensorAsBase64:r}){const i=DLe(e),a=await o(t,i);yield a;const l=a.shape,{patchSize:u,padding:d,modelInputShape:h}=kLe(t,s,n,l),p=sp(t,a,s.modelDefinition.preprocess,RLe(t,s.modelDefinition.inputRange),h?ALe(t,h):void 0);yield p;const x=FLe(t,p,{output:n.output,progressOutput:n.progressOutput,progress:n.progress},s,{originalImageSize:l,patchSize:u,padding:d},{tensorAsBase64:r});let b=await x.next();for(yield b.value;!b.done;)b=await x.next(),Array.isArray(b.value)?yield[...b.value,p]:Rg(b.value)?yield[b.value,p]:yield p;p.dispose();const w=b.value;if(n.output==="tensor")return w;const C=r(t,w);return w.dispose(),C}async function PLe(t,e,{signal:n,awaitNextFrame:s,...o},r,{checkValidEnvironment:i,...a}){i(e,{output:o.output,progressOutput:o.progressOutput});const l=OW(t,n||r.signal,s);await l();const u=await MW(OLe(t,e,o,r,a),l);return await l(),u}const LLe=MPe;function VLe({tf:t,getUpscaleOptions:e,checkValidEnvironment:n,getImageAsTensor:s,tensorAsBase64:o,loadModel:r}){class i{constructor(l={}){qo(this,"_opts");qo(this,"_model");qo(this,"ready");qo(this,"_abortController",new AbortController);qo(this,"upscale",this.execute.bind(this));qo(this,"warmup",async(l=[],u)=>(await this.ready,RP(t,this._model,l,u,{signal:this._abortController.signal})));qo(this,"abort",()=>{this._abortController.abort(),this._abortController=new AbortController});qo(this,"dispose",async()=>{await this.ready;const{model:l,modelDefinition:u}=await this._model;u.teardown&&await u.teardown(t),l.dispose()});qo(this,"getModel",()=>this._model);this._opts={...l},this._model=r(t,NLe(t,this._opts.model||LLe)),this.ready=new Promise((u,d)=>{this._model.then(()=>RP(t,this._model,this._opts.warmupSizes||[],void 0,{signal:this._abortController.signal})).then(u).catch(d)})}async execute(l,u){const d={checkValidEnvironment:n,getImageAsTensor:s,tensorAsBase64:o};await this.ready;const h=await this._model;return PLe(t,l,e(u),{...h,signal:this._abortController.signal},d)}}return i}const PP=t=>t==="tensor"?"tensor":"base64",zLe=({output:t,progressOutput:e,...n}={})=>({...n,output:PP(t),progressOutput:PP(e||t)}),BLe={jsdelivr:(t,e,n)=>`https://cdn.jsdelivr.net/npm/${t}@${e}/${n}`,unpkg:(t,e,n)=>`https://unpkg.com/${t}@${e}/${n}`},ULe=["jsdelivr","unpkg"],GLe=(t,e,n)=>new Error([`Could not resolve URL ${e} for package ${n==null?void 0:n.name}@${n==null?void 0:n.version}`,"Errors include:",...t.map(([s,o])=>`- ${s}: ${o.message}`)].join(`
`));async function HLe(t,e){const{modelType:n,_internals:s,path:o}=e;if(o)return await $P(t,o,n);if(!s)throw new Error(YA);const r=[];for(const i of ULe){const a=BLe[i];try{const l=a(s.name,s.version,s.path);return await $P(t,l,n)}catch(l){r.push([i,l instanceof Error?l:new Error(`There was an unknown error: ${JSON.stringify(l)}`)])}}throw GLe(r,o||s.path,s)}const WLe=async(t,e)=>{const n=await e;try{LPe(n)}catch(r){throw GPe(r)?mLe(r.type,n):new Error(YA)}const s=CLe(n);return{model:await HLe(t,s),modelDefinition:s}},qLe="https://upscalerjs.com/documentation/troubleshooting#environment-disallows-base64",KLe="https://upscalerjs.com/documentation/troubleshooting#environment-disallows-string-input",XLe=()=>new Error(["Environment does not support a string URL as an input format.",`For more information, see ${KLe}.`].join(`
`)),YLe=()=>new Error(["Environment does not support base64 as an output format.",`For more information, see ${qLe}.`].join(`
`)),JLe=t=>new Error([`Unsupported dimensions for incoming pixels: ${t.shape.length}.`,"Only 3 or 4 rank tensors are supported."].join(`
`)),jLe=()=>new Error(["Failed to load image"].join(" ")),ZLe=t=>new Promise((e,n)=>{const s=new Image;s.src=t,s.crossOrigin="anonymous",s.onload=()=>e(s),s.onerror=()=>n(jLe())}),LP=t=>TB(t),QLe=async(t,e)=>{if(Rg(t))return t;if(OPe(t)){const n=await ZLe(t);return LP(n)}return LP(t)},e3e=async(t,e)=>{const n=await QLe(e);if(FPe(n)){const s=n.expandDims(0);return n.dispose(),s}if(DW(n))return n;throw JLe(n)},t3e=(t,e)=>{const n=$Le(t,e),[s,o]=e.shape,r=new ImageData(o,s);r.data.set(n);const i=document.createElement("canvas");i.width=o,i.height=s;const a=i.getContext("2d");if(!a)throw new Error("No context found");return a.putImageData(r,0,0),i.toDataURL()},VP=t=>{try{if((new Image&&"createElement"in document)!==!0)throw t()}catch{throw t()}},n3e=(t,{output:e="base64",progressOutput:n})=>{typeof t=="string"&&VP(XLe),(n==="base64"||e==="base64")&&VP(YLe)},zP=VLe({tf:APe,getUpscaleOptions:zLe,loadModel:WLe,getImageAsTensor:e3e,tensorAsBase64:t3e,checkValidEnvironment:n3e});let Oh=null,Ph=2;const JA=async()=>{if(Oh)return{instance:Oh,scale:Ph};try{await tS("webgl"),await nS(),console.log("TensorFlow.js backend set to WebGL.")}catch(t){console.warn("WebGL backend for TensorFlow.js not available, falling back to CPU.",t),await tS("cpu"),await nS(),console.log("TensorFlow.js backend set to CPU.")}try{const t=(await oie(async()=>{const{default:e}=await import("https://cdn.jsdelivr.net/npm/@upscalerjs/esrgan-slim@1.0.0-beta.12/4x/+esm");return{default:e}},[])).default;Ph=4,Oh=new zP({model:t}),console.log(`Upscaler.js initialized with ${Ph}x ESRGAN-Slim model.`)}catch(t){console.error("Failed to load ESRGAN-Slim model, falling back to default 2x model.",t),Ph=2,Oh=new zP,console.log("Upscaler.js initialized with default 2x model.")}return{instance:Oh,scale:Ph}},Lh=["Briefing the AI stylist...","Analyzing facial structure...","Selecting color palette...","Simulating hair texture...","Rendering the initial look...","Applying realistic lighting...","Adding final touches...","Perfecting the details..."],s3e=({message:t})=>{const e=(t==null?void 0:t.split("Details:")[0].trim())||"An unknown error occurred.";return U.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center p-4 text-red-400",children:[U.jsx(pV,{className:"h-10 w-10"}),U.jsx("p",{className:"mt-2 text-sm font-semibold",children:"Generation Failed"}),U.jsx("p",{className:"mt-1 text-xs text-neutral-400 px-2 leading-snug",children:e})]})},o3e=({imageUrl:t,caption:e,status:n,error:s,onRegenerate:o,angle:r})=>{const[i,a]=ce.useState(!1),[l,u]=ce.useState(Lh[0]),[d,h]=ce.useState(!1),[p,x]=ce.useState(!1),[,b]=ce.useTransition(),{comparisonSourceImage:w,openShareMenu:C}=xr();ce.useEffect(()=>{n==="done"&&t&&a(!1),n==="pending"&&b(()=>{h(!1)})},[t,n]),ce.useEffect(()=>{let A;return n==="pending"&&(u(Lh[0]),A=window.setInterval(()=>{u($=>{const O=(Lh.indexOf($)+1)%Lh.length;return Lh[O]})},2500)),()=>{A&&clearInterval(A)}},[n]);const T=async()=>{if(!t||p)return;x(!0);let A=2;const $=Ft.loading("Preparing download...");try{const{instance:M,scale:O}=await JA();A=O,Ft.loading(`Upscaling image (${A}x)... (0%)`,{id:$});const F=await M.upscale(t,{output:"base64",patchSize:64,padding:2,progress:D=>{Ft.loading(`Upscaling... ${Math.round(D*100)}%`,{id:$})}});Ft.success("Upscaling complete!",{id:$});const P=document.createElement("a");P.href=F,P.download=`barber-booth-pro-${r}-upscaled.jpg`,document.body.appendChild(P),P.click(),document.body.removeChild(P)}catch(M){Ft.error(`Upscaling failed (${A}x). Downloading original.`,{id:$}),console.error("Upscaling failed:",M);const O=document.createElement("a");O.href=t,O.download=`barber-booth-pro-${r}.jpg`,document.body.appendChild(O),O.click(),document.body.removeChild(O)}finally{x(!1)}},N=()=>{w&&t&&b(()=>{h(A=>!A)})},I=()=>{t&&zN({url:t,title:e,type:"image"},()=>C({url:t,title:e,type:"image"}))},k=n==="error"?"border-red-500/50":n==="done"?"border-green-500/50":"border-neutral-800";return U.jsxs(Uc,{className:ls("aspect-[3/4] w-full flex flex-col transition-all border",k),children:[U.jsxs("div",{className:"w-full bg-neutral-900 flex-grow relative overflow-hidden rounded-t-lg group",children:[n==="pending"&&U.jsx(dp,{className:"h-full",message:l}),n==="error"&&U.jsx(s3e,{message:s}),n==="done"&&t&&U.jsx(Tn.img,{src:t,alt:e,onLoad:()=>a(!0),initial:{opacity:.5,filter:"saturate(0)"},animate:{opacity:i?1:.5,filter:i?"saturate(1)":"saturate(0)"},transition:{duration:1.5,ease:"easeOut"},className:"w-full h-full object-cover"},t),U.jsx(Vr,{children:d&&w&&t&&U.jsx(tie,{beforeImage:w,afterImage:t,onClose:()=>b(()=>h(!1))})}),(n==="done"||n==="error")&&U.jsxs("div",{className:"absolute top-2 right-2 z-20 flex flex-col gap-2 transition-opacity duration-300 opacity-0 group-hover:opacity-100",children:[U.jsx(St,{onClick:()=>o(),size:"icon",variant:"secondary",title:"Regenerate",children:U.jsx(Goe,{className:"w-4 h-4"})}),n==="done"&&U.jsx(St,{onClick:I,size:"icon",variant:"secondary",title:"Share",children:U.jsx(LN,{className:"w-4 h-4"})}),n==="done"&&U.jsx(St,{onClick:T,size:"icon",variant:"secondary",title:"Download",disabled:p,children:U.jsx(zp,{className:"w-4 h-4"})}),n==="done"&&r==="front"&&U.jsx(St,{onClick:N,size:"icon",variant:d?"primary":"secondary",title:d?"Close Comparison":"Compare",children:U.jsx(Voe,{className:"w-4 h-4"})})]})]}),U.jsx("div",{className:"flex-shrink-0 p-3 text-center border-t border-neutral-800",children:U.jsx("p",{className:"font-semibold text-sm truncate text-neutral-200",children:e})})]})},r3e=()=>{const{installPromptEvent:t,setInstallPromptEvent:e}=xr(s=>({installPromptEvent:s.installPromptEvent,setInstallPromptEvent:s.setInstallPromptEvent})),n=async()=>{if(!t)return;t.prompt();const{outcome:s}=await t.userChoice;console.log(s==="accepted"?"User accepted the A2HS prompt":"User dismissed the A2HS prompt"),e(null)};return U.jsx("footer",{className:"fixed bottom-0 left-0 right-0 bg-neutral-950/50 backdrop-blur-sm p-3 z-50 text-neutral-400 text-xs sm:text-sm border-t border-neutral-800",children:U.jsxs("div",{className:"max-w-screen-xl mx-auto flex justify-between items-center gap-4 px-4",children:[U.jsx("p",{children:"Developed by Ronnie H. Placo, powered by the Gemini family"}),U.jsx("div",{className:"flex items-center gap-4",children:U.jsxs(St,{variant:"secondary",size:"sm",onClick:n,disabled:!t,title:t?"Install this app on your device":"Installation not available on this browser. On iOS, use Share > Add to Home Screen.",children:[U.jsx(zp,{className:"h-4 w-4 mr-2"}),"Home Screen"]})})]})})};var i3e=Object.defineProperty,a3e=(t,e,n)=>e in t?i3e(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Qt=(t,e,n)=>a3e(t,typeof e!="symbol"?e+"":e,n);const wx={x:0,y:0,width:0,height:0,unit:"px"},bc=(t,e,n)=>Math.min(Math.max(t,e),n),l3e=(...t)=>t.filter(e=>e&&typeof e=="string").join(" "),BP=(t,e)=>t===e||t.width===e.width&&t.height===e.height&&t.x===e.x&&t.y===e.y&&t.unit===e.unit;function u3e(t,e,n,s){const o=Lr(t,n,s);return t.width&&(o.height=o.width/e),t.height&&(o.width=o.height*e),o.y+o.height>s&&(o.height=s-o.y,o.width=o.height*e),o.x+o.width>n&&(o.width=n-o.x,o.height=o.width/e),t.unit==="%"?ka(o,n,s):o}function c3e(t,e,n){const s=Lr(t,e,n);return s.x=(e-s.width)/2,s.y=(n-s.height)/2,t.unit==="%"?ka(s,e,n):s}function ka(t,e,n){return t.unit==="%"?{...wx,...t,unit:"%"}:{unit:"%",x:t.x?t.x/e*100:0,y:t.y?t.y/n*100:0,width:t.width?t.width/e*100:0,height:t.height?t.height/n*100:0}}function Lr(t,e,n){return t.unit?t.unit==="px"?{...wx,...t,unit:"px"}:{unit:"px",x:t.x?t.x*e/100:0,y:t.y?t.y*n/100:0,width:t.width?t.width*e/100:0,height:t.height?t.height*n/100:0}:{...wx,...t,unit:"px"}}function UP(t,e,n,s,o,r=0,i=0,a=s,l=o){const u={...t};let d=Math.min(r,s),h=Math.min(i,o),p=Math.min(a,s),x=Math.min(l,o);e&&(e>1?(d=i?i*e:d,h=d/e,p=a*e):(h=r?r/e:h,d=h*e,x=l/e)),u.y<0&&(u.height=Math.max(u.height+u.y,h),u.y=0),u.x<0&&(u.width=Math.max(u.width+u.x,d),u.x=0);const b=s-(u.x+u.width);b<0&&(u.x=Math.min(u.x,s-d),u.width+=b);const w=o-(u.y+u.height);if(w<0&&(u.y=Math.min(u.y,o-h),u.height+=w),u.width<d&&((n==="sw"||n=="nw")&&(u.x-=d-u.width),u.width=d),u.height<h&&((n==="nw"||n=="ne")&&(u.y-=h-u.height),u.height=h),u.width>p&&((n==="sw"||n=="nw")&&(u.x-=p-u.width),u.width=p),u.height>x&&((n==="nw"||n=="ne")&&(u.y-=x-u.height),u.height=x),e){const C=u.width/u.height;if(C<e){const T=Math.max(u.width/e,h);(n==="nw"||n=="ne")&&(u.y-=T-u.height),u.height=T}else if(C>e){const T=Math.max(u.height*e,d);(n==="sw"||n=="nw")&&(u.x-=T-u.width),u.width=T}}return u}function d3e(t,e,n,s){const o={...t};return e==="ArrowLeft"?s==="nw"?(o.x-=n,o.y-=n,o.width+=n,o.height+=n):s==="w"?(o.x-=n,o.width+=n):s==="sw"?(o.x-=n,o.width+=n,o.height+=n):s==="ne"?(o.y+=n,o.width-=n,o.height-=n):s==="e"?o.width-=n:s==="se"&&(o.width-=n,o.height-=n):e==="ArrowRight"&&(s==="nw"?(o.x+=n,o.y+=n,o.width-=n,o.height-=n):s==="w"?(o.x+=n,o.width-=n):s==="sw"?(o.x+=n,o.width-=n,o.height-=n):s==="ne"?(o.y-=n,o.width+=n,o.height+=n):s==="e"?o.width+=n:s==="se"&&(o.width+=n,o.height+=n)),e==="ArrowUp"?s==="nw"?(o.x-=n,o.y-=n,o.width+=n,o.height+=n):s==="n"?(o.y-=n,o.height+=n):s==="ne"?(o.y-=n,o.width+=n,o.height+=n):s==="sw"?(o.x+=n,o.width-=n,o.height-=n):s==="s"?o.height-=n:s==="se"&&(o.width-=n,o.height-=n):e==="ArrowDown"&&(s==="nw"?(o.x+=n,o.y+=n,o.width-=n,o.height-=n):s==="n"?(o.y+=n,o.height-=n):s==="ne"?(o.y+=n,o.width-=n,o.height-=n):s==="sw"?(o.x-=n,o.width+=n,o.height+=n):s==="s"?o.height+=n:s==="se"&&(o.width+=n,o.height+=n)),o}const wc={capture:!0,passive:!1};let f3e=0;const Ea=class fr extends ce.PureComponent{constructor(){super(...arguments),Qt(this,"docMoveBound",!1),Qt(this,"mouseDownOnCrop",!1),Qt(this,"dragStarted",!1),Qt(this,"evData",{startClientX:0,startClientY:0,startCropX:0,startCropY:0,clientX:0,clientY:0,isResize:!0}),Qt(this,"componentRef",ce.createRef()),Qt(this,"mediaRef",ce.createRef()),Qt(this,"resizeObserver"),Qt(this,"initChangeCalled",!1),Qt(this,"instanceId",`rc-${f3e++}`),Qt(this,"state",{cropIsActive:!1,newCropIsBeingDrawn:!1}),Qt(this,"onCropPointerDown",e=>{const{crop:n,disabled:s}=this.props,o=this.getBox();if(!n)return;const r=Lr(n,o.width,o.height);if(s)return;e.cancelable&&e.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const i=e.target.dataset.ord,a=!!i;let l=e.clientX,u=e.clientY,d=r.x,h=r.y;if(i){const p=e.clientX-o.x,x=e.clientY-o.y;let b=0,w=0;i==="ne"||i=="e"?(b=p-(r.x+r.width),w=x-r.y,d=r.x,h=r.y+r.height):i==="se"||i==="s"?(b=p-(r.x+r.width),w=x-(r.y+r.height),d=r.x,h=r.y):i==="sw"||i=="w"?(b=p-r.x,w=x-(r.y+r.height),d=r.x+r.width,h=r.y):(i==="nw"||i=="n")&&(b=p-r.x,w=x-r.y,d=r.x+r.width,h=r.y+r.height),l=d+o.x+b,u=h+o.y+w}this.evData={startClientX:l,startClientY:u,startCropX:d,startCropY:h,clientX:e.clientX,clientY:e.clientY,isResize:a,ord:i},this.mouseDownOnCrop=!0,this.setState({cropIsActive:!0})}),Qt(this,"onComponentPointerDown",e=>{const{crop:n,disabled:s,locked:o,keepSelection:r,onChange:i}=this.props,a=this.getBox();if(s||o||r&&n)return;e.cancelable&&e.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const l=e.clientX-a.x,u=e.clientY-a.y,d={unit:"px",x:l,y:u,width:0,height:0};this.evData={startClientX:e.clientX,startClientY:e.clientY,startCropX:l,startCropY:u,clientX:e.clientX,clientY:e.clientY,isResize:!0},this.mouseDownOnCrop=!0,i(Lr(d,a.width,a.height),ka(d,a.width,a.height)),this.setState({cropIsActive:!0,newCropIsBeingDrawn:!0})}),Qt(this,"onDocPointerMove",e=>{const{crop:n,disabled:s,onChange:o,onDragStart:r}=this.props,i=this.getBox();if(s||!n||!this.mouseDownOnCrop)return;e.cancelable&&e.preventDefault(),this.dragStarted||(this.dragStarted=!0,r&&r(e));const{evData:a}=this;a.clientX=e.clientX,a.clientY=e.clientY;let l;a.isResize?l=this.resizeCrop():l=this.dragCrop(),BP(n,l)||o(Lr(l,i.width,i.height),ka(l,i.width,i.height))}),Qt(this,"onComponentKeyDown",e=>{const{crop:n,disabled:s,onChange:o,onComplete:r}=this.props;if(s)return;const i=e.key;let a=!1;if(!n)return;const l=this.getBox(),u=this.makePixelCrop(l),d=(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)?fr.nudgeStepLarge:e.shiftKey?fr.nudgeStepMedium:fr.nudgeStep;if(i==="ArrowLeft"?(u.x-=d,a=!0):i==="ArrowRight"?(u.x+=d,a=!0):i==="ArrowUp"?(u.y-=d,a=!0):i==="ArrowDown"&&(u.y+=d,a=!0),a){e.cancelable&&e.preventDefault(),u.x=bc(u.x,0,l.width-u.width),u.y=bc(u.y,0,l.height-u.height);const h=Lr(u,l.width,l.height),p=ka(u,l.width,l.height);o(h,p),r&&r(h,p)}}),Qt(this,"onHandlerKeyDown",(e,n)=>{const{aspect:s=0,crop:o,disabled:r,minWidth:i=0,minHeight:a=0,maxWidth:l,maxHeight:u,onChange:d,onComplete:h}=this.props,p=this.getBox();if(r||!o)return;if(e.key==="ArrowUp"||e.key==="ArrowDown"||e.key==="ArrowLeft"||e.key==="ArrowRight")e.stopPropagation(),e.preventDefault();else return;const x=(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)?fr.nudgeStepLarge:e.shiftKey?fr.nudgeStepMedium:fr.nudgeStep,b=Lr(o,p.width,p.height),w=d3e(b,e.key,x,n),C=UP(w,s,n,p.width,p.height,i,a,l,u);if(!BP(o,C)){const T=ka(C,p.width,p.height);d(C,T),h&&h(C,T)}}),Qt(this,"onDocPointerDone",e=>{const{crop:n,disabled:s,onComplete:o,onDragEnd:r}=this.props,i=this.getBox();this.unbindDocMove(),!(s||!n)&&this.mouseDownOnCrop&&(this.mouseDownOnCrop=!1,this.dragStarted=!1,r&&r(e),o&&o(Lr(n,i.width,i.height),ka(n,i.width,i.height)),this.setState({cropIsActive:!1,newCropIsBeingDrawn:!1}))}),Qt(this,"onDragFocus",()=>{var e;(e=this.componentRef.current)==null||e.scrollTo(0,0)})}get document(){return document}getBox(){const e=this.mediaRef.current;if(!e)return{x:0,y:0,width:0,height:0};const{x:n,y:s,width:o,height:r}=e.getBoundingClientRect();return{x:n,y:s,width:o,height:r}}componentDidUpdate(e){const{crop:n,onComplete:s}=this.props;if(s&&!e.crop&&n){const{width:o,height:r}=this.getBox();o&&r&&s(Lr(n,o,r),ka(n,o,r))}}componentWillUnmount(){this.resizeObserver&&this.resizeObserver.disconnect(),this.unbindDocMove()}bindDocMove(){this.docMoveBound||(this.document.addEventListener("pointermove",this.onDocPointerMove,wc),this.document.addEventListener("pointerup",this.onDocPointerDone,wc),this.document.addEventListener("pointercancel",this.onDocPointerDone,wc),this.docMoveBound=!0)}unbindDocMove(){this.docMoveBound&&(this.document.removeEventListener("pointermove",this.onDocPointerMove,wc),this.document.removeEventListener("pointerup",this.onDocPointerDone,wc),this.document.removeEventListener("pointercancel",this.onDocPointerDone,wc),this.docMoveBound=!1)}getCropStyle(){const{crop:e}=this.props;if(e)return{top:`${e.y}${e.unit}`,left:`${e.x}${e.unit}`,width:`${e.width}${e.unit}`,height:`${e.height}${e.unit}`}}dragCrop(){const{evData:e}=this,n=this.getBox(),s=this.makePixelCrop(n),o=e.clientX-e.startClientX,r=e.clientY-e.startClientY;return s.x=bc(e.startCropX+o,0,n.width-s.width),s.y=bc(e.startCropY+r,0,n.height-s.height),s}getPointRegion(e,n,s,o){const{evData:r}=this,i=r.clientX-e.x,a=r.clientY-e.y;let l;o&&n?l=n==="nw"||n==="n"||n==="ne":l=a<r.startCropY;let u;return s&&n?u=n==="nw"||n==="w"||n==="sw":u=i<r.startCropX,u?l?"nw":"sw":l?"ne":"se"}resolveMinDimensions(e,n,s=0,o=0){const r=Math.min(s,e.width),i=Math.min(o,e.height);return!n||!r&&!i?[r,i]:n>1?r?[r,r/n]:[i*n,i]:i?[i*n,i]:[r,r/n]}resizeCrop(){const{evData:e}=this,{aspect:n=0,maxWidth:s,maxHeight:o}=this.props,r=this.getBox(),[i,a]=this.resolveMinDimensions(r,n,this.props.minWidth,this.props.minHeight);let l=this.makePixelCrop(r);const u=this.getPointRegion(r,e.ord,i,a),d=e.ord||u;let h=e.clientX-e.startClientX,p=e.clientY-e.startClientY;(i&&d==="nw"||d==="w"||d==="sw")&&(h=Math.min(h,-i)),(a&&d==="nw"||d==="n"||d==="ne")&&(p=Math.min(p,-a));const x={unit:"px",x:0,y:0,width:0,height:0};u==="ne"?(x.x=e.startCropX,x.width=h,n?(x.height=x.width/n,x.y=e.startCropY-x.height):(x.height=Math.abs(p),x.y=e.startCropY-x.height)):u==="se"?(x.x=e.startCropX,x.y=e.startCropY,x.width=h,n?x.height=x.width/n:x.height=p):u==="sw"?(x.x=e.startCropX+h,x.y=e.startCropY,x.width=Math.abs(h),n?x.height=x.width/n:x.height=p):u==="nw"&&(x.x=e.startCropX+h,x.width=Math.abs(h),n?(x.height=x.width/n,x.y=e.startCropY-x.height):(x.height=Math.abs(p),x.y=e.startCropY+p));const b=UP(x,n,u,r.width,r.height,i,a,s,o);return n||fr.xyOrds.indexOf(d)>-1?l=b:fr.xOrds.indexOf(d)>-1?(l.x=b.x,l.width=b.width):fr.yOrds.indexOf(d)>-1&&(l.y=b.y,l.height=b.height),l.x=bc(l.x,0,r.width-l.width),l.y=bc(l.y,0,r.height-l.height),l}renderCropSelection(){const{ariaLabels:e=fr.defaultProps.ariaLabels,disabled:n,locked:s,renderSelectionAddon:o,ruleOfThirds:r,crop:i}=this.props,a=this.getCropStyle();if(i)return Ge.createElement("div",{style:a,className:"ReactCrop__crop-selection",onPointerDown:this.onCropPointerDown,"aria-label":e.cropArea,tabIndex:0,onKeyDown:this.onComponentKeyDown,role:"group"},!n&&!s&&Ge.createElement("div",{className:"ReactCrop__drag-elements",onFocus:this.onDragFocus},Ge.createElement("div",{className:"ReactCrop__drag-bar ord-n","data-ord":"n"}),Ge.createElement("div",{className:"ReactCrop__drag-bar ord-e","data-ord":"e"}),Ge.createElement("div",{className:"ReactCrop__drag-bar ord-s","data-ord":"s"}),Ge.createElement("div",{className:"ReactCrop__drag-bar ord-w","data-ord":"w"}),Ge.createElement("div",{className:"ReactCrop__drag-handle ord-nw","data-ord":"nw",tabIndex:0,"aria-label":e.nwDragHandle,onKeyDown:l=>this.onHandlerKeyDown(l,"nw"),role:"button"}),Ge.createElement("div",{className:"ReactCrop__drag-handle ord-n","data-ord":"n",tabIndex:0,"aria-label":e.nDragHandle,onKeyDown:l=>this.onHandlerKeyDown(l,"n"),role:"button"}),Ge.createElement("div",{className:"ReactCrop__drag-handle ord-ne","data-ord":"ne",tabIndex:0,"aria-label":e.neDragHandle,onKeyDown:l=>this.onHandlerKeyDown(l,"ne"),role:"button"}),Ge.createElement("div",{className:"ReactCrop__drag-handle ord-e","data-ord":"e",tabIndex:0,"aria-label":e.eDragHandle,onKeyDown:l=>this.onHandlerKeyDown(l,"e"),role:"button"}),Ge.createElement("div",{className:"ReactCrop__drag-handle ord-se","data-ord":"se",tabIndex:0,"aria-label":e.seDragHandle,onKeyDown:l=>this.onHandlerKeyDown(l,"se"),role:"button"}),Ge.createElement("div",{className:"ReactCrop__drag-handle ord-s","data-ord":"s",tabIndex:0,"aria-label":e.sDragHandle,onKeyDown:l=>this.onHandlerKeyDown(l,"s"),role:"button"}),Ge.createElement("div",{className:"ReactCrop__drag-handle ord-sw","data-ord":"sw",tabIndex:0,"aria-label":e.swDragHandle,onKeyDown:l=>this.onHandlerKeyDown(l,"sw"),role:"button"}),Ge.createElement("div",{className:"ReactCrop__drag-handle ord-w","data-ord":"w",tabIndex:0,"aria-label":e.wDragHandle,onKeyDown:l=>this.onHandlerKeyDown(l,"w"),role:"button"})),o&&Ge.createElement("div",{className:"ReactCrop__selection-addon",onPointerDown:l=>l.stopPropagation()},o(this.state)),r&&Ge.createElement(Ge.Fragment,null,Ge.createElement("div",{className:"ReactCrop__rule-of-thirds-hz"}),Ge.createElement("div",{className:"ReactCrop__rule-of-thirds-vt"})))}makePixelCrop(e){const n={...wx,...this.props.crop||{}};return Lr(n,e.width,e.height)}render(){const{aspect:e,children:n,circularCrop:s,className:o,crop:r,disabled:i,locked:a,style:l,ruleOfThirds:u}=this.props,{cropIsActive:d,newCropIsBeingDrawn:h}=this.state,p=r?this.renderCropSelection():null,x=l3e("ReactCrop",o,d&&"ReactCrop--active",i&&"ReactCrop--disabled",a&&"ReactCrop--locked",h&&"ReactCrop--new-crop",r&&e&&"ReactCrop--fixed-aspect",r&&s&&"ReactCrop--circular-crop",r&&u&&"ReactCrop--rule-of-thirds",!this.dragStarted&&r&&!r.width&&!r.height&&"ReactCrop--invisible-crop",s&&"ReactCrop--no-animate");return Ge.createElement("div",{ref:this.componentRef,className:x,style:l},Ge.createElement("div",{ref:this.mediaRef,className:"ReactCrop__child-wrapper",onPointerDown:this.onComponentPointerDown},n),r?Ge.createElement("svg",{className:"ReactCrop__crop-mask",width:"100%",height:"100%"},Ge.createElement("defs",null,Ge.createElement("mask",{id:`hole-${this.instanceId}`},Ge.createElement("rect",{width:"100%",height:"100%",fill:"white"}),s?Ge.createElement("ellipse",{cx:`${r.x+r.width/2}${r.unit}`,cy:`${r.y+r.height/2}${r.unit}`,rx:`${r.width/2}${r.unit}`,ry:`${r.height/2}${r.unit}`,fill:"black"}):Ge.createElement("rect",{x:`${r.x}${r.unit}`,y:`${r.y}${r.unit}`,width:`${r.width}${r.unit}`,height:`${r.height}${r.unit}`,fill:"black"}))),Ge.createElement("rect",{fill:"black",fillOpacity:.5,width:"100%",height:"100%",mask:`url(#hole-${this.instanceId})`})):void 0,p)}};Qt(Ea,"xOrds",["e","w"]),Qt(Ea,"yOrds",["n","s"]),Qt(Ea,"xyOrds",["nw","ne","se","sw"]),Qt(Ea,"nudgeStep",1),Qt(Ea,"nudgeStepMedium",10),Qt(Ea,"nudgeStepLarge",100),Qt(Ea,"defaultProps",{ariaLabels:{cropArea:"Use the arrow keys to move the crop selection area",nwDragHandle:"Use the arrow keys to move the north west drag handle to change the crop selection area",nDragHandle:"Use the up and down arrow keys to move the north drag handle to change the crop selection area",neDragHandle:"Use the arrow keys to move the north east drag handle to change the crop selection area",eDragHandle:"Use the up and down arrow keys to move the east drag handle to change the crop selection area",seDragHandle:"Use the arrow keys to move the south east drag handle to change the crop selection area",sDragHandle:"Use the up and down arrow keys to move the south drag handle to change the crop selection area",swDragHandle:"Use the arrow keys to move the south west drag handle to change the crop selection area",wDragHandle:"Use the up and down arrow keys to move the west drag handle to change the crop selection area"}});let h3e=Ea;const p3e=(t,e,n,s=1,o=0)=>{const r=e.getContext("2d");if(!r)throw new Error("No 2d context");const i=t.naturalWidth/t.width,a=t.naturalHeight/t.height,l=window.devicePixelRatio;e.width=Math.floor(n.width*i*l),e.height=Math.floor(n.height*a*l),r.scale(l,l),r.imageSmoothingQuality="high";const u=n.x*i,d=n.y*a,h=o*(Math.PI/180),p=t.naturalWidth/2,x=t.naturalHeight/2;r.save(),r.translate(-u,-d),r.translate(p,x),r.rotate(h),r.scale(s,s),r.translate(-p,-x),r.drawImage(t,0,0,t.naturalWidth,t.naturalHeight),r.restore()},m3e=({imageSrc:t,onSave:e,onCancel:n,title:s})=>{const o=ce.useRef(null),r=ce.useRef(null),[i,a]=ce.useState(),[l,u]=ce.useState(null),[d,h]=ce.useState(0),p=w=>{const{width:C,height:T}=w.currentTarget,N=c3e(u3e({unit:"%",width:90},1,C,T),C,T);a(N)},x=()=>{const w=o.current,C=r.current;!l||!w||!C||!l.width||!l.height||(p3e(w,C,l,1,d),e(C.toDataURL("image/jpeg",.9)))},b=!l||l.width===0||l.height===0;return U.jsx(Tn.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4","aria-modal":"true",role:"dialog",children:U.jsxs(Tn.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-neutral-900 rounded-lg shadow-xl w-full max-w-lg border border-neutral-700 flex flex-col max-h-[90vh]",children:[U.jsx("h2",{className:"text-2xl font-semibold text-center p-6 pb-4 text-white flex-shrink-0",children:s}),U.jsxs("div",{className:"flex-grow overflow-y-auto px-6 space-y-6",children:[U.jsx("div",{className:"flex justify-center items-center bg-black/50 p-4 rounded-md",children:U.jsx(h3e,{crop:i,onChange:(w,C)=>a(C),onComplete:w=>u(w),aspect:1,children:U.jsx("img",{ref:o,alt:"Crop me",src:t,style:{transform:`rotate(${d}deg)`},onLoad:p,className:"max-h-[50vh] object-contain"})})}),U.jsxs("div",{children:[U.jsxs("label",{htmlFor:"rotation",className:"block text-sm font-medium text-neutral-400 mb-2",children:["Rotation: ",U.jsxs("span",{className:"font-bold text-white",children:[d,""]})]}),U.jsx("input",{id:"rotation",type:"range",value:d,min:-45,max:45,step:1,onChange:w=>h(Number(w.target.value)),className:"w-full h-2 bg-neutral-700 rounded-lg appearance-none cursor-pointer accent-pink-500"})]})]}),U.jsx("canvas",{ref:r,className:"hidden"}),U.jsxs("div",{className:"flex justify-end gap-4 p-6 pt-4 mt-auto flex-shrink-0 border-t border-neutral-800",children:[U.jsx(St,{onClick:n,variant:"ghost",children:"Cancel"}),U.jsx(St,{onClick:x,disabled:b,variant:"primary",children:"Confirm"})]})]})})},g3e=({onCapture:t,onCancel:e})=>{const n=ce.useRef(null),s=ce.useRef(null),[o,r]=ce.useState(null),[i,a]=ce.useState(null),[l,u]=ce.useState([]),[d,h]=ce.useState(void 0),[p,x]=ce.useState(!0);ce.useEffect(()=>{(async()=>{var T;try{if(!((T=navigator.mediaDevices)!=null&&T.enumerateDevices))throw new Error("Camera enumeration not supported.");const N=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1}),k=(await navigator.mediaDevices.enumerateDevices()).filter($=>$.kind==="videoinput");if(N.getTracks().forEach($=>$.stop()),k.length===0){a("No cameras found on this device.");return}u(k);const A=k.find($=>$.facingMode==="user"||$.label.toLowerCase().includes("front"));h((A==null?void 0:A.deviceId)||k[0].deviceId)}catch(N){N instanceof Error?N.name==="NotAllowedError"||N.name==="PermissionDeniedError"?a("Camera permission denied. Please enable it in your browser settings."):a("Could not access camera. Is it in use by another app?"):a("An unknown error occurred while accessing the camera.")}})()},[]),ce.useEffect(()=>(o&&o.getTracks().forEach(C=>C.stop()),d&&(async()=>{try{const T=await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:d}}});r(T);const N=l.find(k=>k.deviceId===d),I=(N==null?void 0:N.facingMode)==="user"||(N==null?void 0:N.label.toLowerCase().includes("front"));x(I),n.current&&(n.current.srcObject=T)}catch(T){a("Failed to start the selected camera."),console.error(T)}})(),()=>{o&&o.getTracks().forEach(C=>C.stop())}),[d]);const b=()=>{if(l.length<2)return;const T=(l.findIndex(N=>N.deviceId===d)+1)%l.length;h(l[T].deviceId)},w=ce.useCallback(()=>{const C=n.current,T=s.current;if(C&&T&&C.readyState===4){const N=T.getContext("2d");N&&(T.width=C.videoWidth,T.height=C.videoHeight,p&&(N.translate(T.width,0),N.scale(-1,1)),N.drawImage(C,0,0,T.width,T.height),t(T.toDataURL("image/jpeg",.9)))}},[t,p]);return U.jsx(Tn.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/90 backdrop-blur-sm z-[60] flex flex-col items-center justify-center p-4","aria-modal":"true",role:"dialog",children:U.jsxs("div",{className:"w-full max-w-2xl h-full flex flex-col items-center justify-center relative",children:[U.jsx(St,{onClick:e,variant:"ghost",size:"icon",className:"absolute top-4 right-4 z-10 text-white rounded-full hover:bg-white/20 hover:text-white","aria-label":"Close camera",children:U.jsx(dd,{className:"h-6 w-6"})}),i?U.jsxs("div",{className:"text-center p-8 bg-neutral-900 rounded-lg border border-red-500/50",children:[U.jsx("h3",{className:"text-2xl font-semibold text-red-400 mb-4",children:"Camera Error"}),U.jsx("p",{className:"text-neutral-300 max-w-sm",children:i}),U.jsx(St,{onClick:e,variant:"primary",className:"mt-6",children:"Close"})]}):U.jsxs(U.Fragment,{children:[U.jsxs("div",{className:"w-full aspect-[3/4] max-h-[80%] bg-black rounded-lg overflow-hidden relative border border-neutral-700",children:[U.jsx("video",{ref:n,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover",style:{transform:p?"scaleX(-1)":"none"}}),!o&&U.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:U.jsx(dp,{message:"Starting camera..."})})]}),U.jsx("canvas",{ref:s,className:"hidden"}),U.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 w-full flex justify-center items-center gap-12",children:[U.jsx(St,{onClick:e,variant:"ghost",className:"text-white hover:bg-white/20 hover:text-white",children:"Cancel"}),U.jsx("button",{onClick:w,disabled:!o,className:"w-20 h-20 rounded-full bg-white/20 border-4 border-white flex items-center justify-center group disabled:opacity-50","aria-label":"Take photo",children:U.jsx("div",{className:"w-[85%] h-[85%] rounded-full bg-white group-hover:scale-105 transition-transform duration-200"})}),U.jsx("div",{className:"w-16 h-16 flex items-center justify-center",children:l.length>1&&U.jsx(St,{onClick:b,variant:"ghost",size:"icon",className:"w-16 h-16 rounded-full bg-white/20 hover:bg-white/30 text-white","aria-label":"Switch camera",children:U.jsx(Woe,{className:"h-8 w-8"})})})]})]})]})})},y3e=()=>{const{isHistoryPanelOpen:t,setHistoryPanelOpen:e,generationHistory:n,restoreFromHistory:s,clearHistory:o,toggleFavorite:r}=xr(),[i,a]=ce.useState("all"),l={open:{x:0},closed:{x:"100%"}},u=i==="favorites"?n.filter(d=>d.isFavorite):n;return U.jsx(Vr,{children:t&&U.jsxs(U.Fragment,{children:[U.jsx(Tn.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[70]",onClick:()=>e(!1),"aria-hidden":"true"}),U.jsxs(Tn.div,{variants:l,initial:"closed",animate:"open",exit:"closed",transition:{type:"spring",stiffness:300,damping:30},className:"fixed top-0 right-0 h-full w-full max-w-md bg-neutral-900 border-l border-neutral-800 shadow-2xl z-[80] flex flex-col",role:"dialog","aria-modal":"true","aria-labelledby":"history-panel-title",children:[U.jsxs("header",{className:"flex-shrink-0 p-4 flex items-center justify-between border-b border-neutral-800",children:[U.jsx("h2",{id:"history-panel-title",className:"text-xl font-semibold text-white",children:"Generation History"}),U.jsx(St,{onClick:()=>e(!1),variant:"ghost",size:"icon","aria-label":"Close history panel",children:U.jsx(dd,{className:"h-4 w-4"})})]}),n.length>0&&U.jsx("div",{className:"p-4 border-b border-neutral-800",children:U.jsxs("div",{className:"flex bg-neutral-800 p-1 rounded-md",children:[U.jsx("button",{onClick:()=>a("all"),className:ls("w-1/2 py-1.5 text-sm rounded",i==="all"?"bg-indigo-600 text-white":"text-neutral-400"),children:"All"}),U.jsx("button",{onClick:()=>a("favorites"),className:ls("w-1/2 py-1.5 text-sm rounded",i==="favorites"?"bg-indigo-600 text-white":"text-neutral-400"),children:"Favorites"})]})}),U.jsx("div",{className:"flex-grow overflow-y-auto p-4 space-y-4 scrollbar-thin",children:u.length===0?U.jsxs("div",{className:"text-center text-neutral-500 pt-10",children:[U.jsx("p",{children:n.length===0?"No history yet.":"No favorites found."}),U.jsx("p",{className:"text-sm",children:n.length===0?"Complete a generation to save it here.":"Click the star to save a favorite."})]}):u.map(d=>U.jsxs(Tn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-neutral-800/50 p-3 rounded-lg flex gap-4 border border-neutral-700/50",children:[U.jsx("img",{src:d.uploadedImage,alt:"User",className:"w-20 h-20 object-cover rounded-md flex-shrink-0"}),U.jsxs("div",{className:"flex-grow min-w-0",children:[U.jsx("p",{className:"text-xs text-neutral-400",children:new Date(d.timestamp).toLocaleString()}),U.jsx("p",{className:"text-white truncate font-medium mt-1",children:d.hairstyleReferenceImage?"Reference Image":`"${d.hairstyleDescription}"`}),U.jsxs("div",{className:"flex items-center justify-between mt-2",children:[U.jsx(St,{onClick:()=>s(d),variant:"ghost",className:"text-pink-400 hover:text-pink-300 h-auto p-0",children:"Restore"}),U.jsx(St,{onClick:()=>r(d.id),variant:"ghost",size:"icon",className:"text-neutral-400 hover:text-yellow-400",children:U.jsx(Hoe,{className:ls("h-5 w-5",d.isFavorite&&"fill-yellow-400 text-yellow-400")})})]})]})]},d.id))}),n.length>0&&U.jsx("footer",{className:"flex-shrink-0 p-4 border-t border-neutral-800",children:U.jsxs(St,{onClick:o,variant:"destructive",className:"w-full",children:[U.jsx(hV,{className:"mr-2 h-4 w-4"}),"Clear All History"]})})]})]})})},x3e=({message:t})=>U.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center p-4 text-red-400",children:[U.jsx(pV,{className:"h-10 w-10"}),U.jsx("p",{className:"mt-2 text-sm font-semibold",children:"Video Generation Failed"}),U.jsx("p",{className:"mt-1 text-xs text-neutral-400 px-2 leading-snug max-w-md mx-auto",children:t})]}),v3e=({status:t,progressMessage:e,videoUrl:n,error:s,onClear:o})=>{const{openShareMenu:r}=xr(),i=()=>{if(!n)return;const l=document.createElement("a");l.href=n,l.download="barber-booth-pro-360.mp4",document.body.appendChild(l),l.click(),document.body.removeChild(l)},a=()=>{n&&zN({url:n,title:"360 Video",type:"video"},()=>r({url:n,title:"360 Video",type:"video"}))};return U.jsx(Uc,{className:ls(t==="error"&&"border-red-500/50"),children:U.jsxs(PN,{className:"p-4",children:[U.jsxs("div",{className:"w-full bg-neutral-900 shadow-inner flex-grow relative aspect-square group rounded-md overflow-hidden",children:[t==="generating"&&U.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center gap-4 text-center",children:[U.jsx(dp,{}),U.jsx("p",{className:"text-neutral-300 font-medium",children:e}),U.jsx("p",{className:"text-xs text-neutral-500",children:"(This can take a few minutes)"})]}),t==="error"&&U.jsx(x3e,{message:s}),t==="done"&&n&&U.jsx("video",{src:n,controls:!0,autoPlay:!0,loop:!0,muted:!0,className:"w-full h-full object-contain"}),U.jsxs("div",{className:"absolute top-2 right-2 z-20 flex flex-col gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[t==="done"&&n&&U.jsxs(U.Fragment,{children:[U.jsx(St,{onClick:a,variant:"secondary",size:"icon",title:"Share",children:U.jsx(LN,{className:"h-4 w-4"})}),U.jsx(St,{onClick:i,variant:"secondary",size:"icon",title:"Download",children:U.jsx(zp,{className:"h-4 w-4"})})]}),U.jsx(St,{onClick:o,variant:"secondary",size:"icon",title:"Close",children:U.jsx(dd,{className:"h-4 w-4"})})]})]}),U.jsx("p",{className:"text-center font-semibold text-sm mt-3 text-neutral-200",children:"360 Video Preview"})]})})};function sw(){return(sw=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t}).apply(this,arguments)}function PW(t,e){if(t==null)return{};var n,s,o={},r=Object.keys(t);for(s=0;s<r.length;s++)e.indexOf(n=r[s])>=0||(o[n]=t[n]);return o}function WS(t){var e=ce.useRef(t),n=ce.useRef(function(s){e.current&&e.current(s)});return e.current=t,n.current}var _p=function(t,e,n){return e===void 0&&(e=0),n===void 0&&(n=1),t>n?n:t<e?e:t},op=function(t){return"touches"in t},qS=function(t){return t&&t.ownerDocument.defaultView||self},GP=function(t,e,n){var s=t.getBoundingClientRect(),o=op(e)?(function(r,i){for(var a=0;a<r.length;a++)if(r[a].identifier===i)return r[a];return r[0]})(e.touches,n):e;return{left:_p((o.pageX-(s.left+qS(t).pageXOffset))/s.width),top:_p((o.pageY-(s.top+qS(t).pageYOffset))/s.height)}},HP=function(t){!op(t)&&t.preventDefault()},LW=Ge.memo(function(t){var e=t.onMove,n=t.onKey,s=PW(t,["onMove","onKey"]),o=ce.useRef(null),r=WS(e),i=WS(n),a=ce.useRef(null),l=ce.useRef(!1),u=ce.useMemo(function(){var x=function(C){HP(C),(op(C)?C.touches.length>0:C.buttons>0)&&o.current?r(GP(o.current,C,a.current)):w(!1)},b=function(){return w(!1)};function w(C){var T=l.current,N=qS(o.current),I=C?N.addEventListener:N.removeEventListener;I(T?"touchmove":"mousemove",x),I(T?"touchend":"mouseup",b)}return[function(C){var T=C.nativeEvent,N=o.current;if(N&&(HP(T),!(function(k,A){return A&&!op(k)})(T,l.current)&&N)){if(op(T)){l.current=!0;var I=T.changedTouches||[];I.length&&(a.current=I[0].identifier)}N.focus(),r(GP(N,T,a.current)),w(!0)}},function(C){var T=C.which||C.keyCode;T<37||T>40||(C.preventDefault(),i({left:T===39?.05:T===37?-.05:0,top:T===40?.05:T===38?-.05:0}))},w]},[i,r]),d=u[0],h=u[1],p=u[2];return ce.useEffect(function(){return p},[p]),Ge.createElement("div",sw({},s,{onTouchStart:d,onMouseDown:d,className:"react-colorful__interactive",ref:o,onKeyDown:h,tabIndex:0,role:"slider"}))}),jA=function(t){return t.filter(Boolean).join(" ")},VW=function(t){var e=t.color,n=t.left,s=t.top,o=s===void 0?.5:s,r=jA(["react-colorful__pointer",t.className]);return Ge.createElement("div",{className:r,style:{top:100*o+"%",left:100*n+"%"}},Ge.createElement("div",{className:"react-colorful__pointer-fill",style:{backgroundColor:e}}))},bs=function(t,e,n){return e===void 0&&(e=0),n===void 0&&(n=Math.pow(10,e)),Math.round(n*t)/n},b3e=function(t){return N3e(KS(t))},KS=function(t){return t[0]==="#"&&(t=t.substring(1)),t.length<6?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:t.length===4?bs(parseInt(t[3]+t[3],16)/255,2):1}:{r:parseInt(t.substring(0,2),16),g:parseInt(t.substring(2,4),16),b:parseInt(t.substring(4,6),16),a:t.length===8?bs(parseInt(t.substring(6,8),16)/255,2):1}},w3e=function(t){return S3e(T3e(t))},C3e=function(t){var e=t.s,n=t.v,s=t.a,o=(200-e)*n/100;return{h:bs(t.h),s:bs(o>0&&o<200?e*n/100/(o<=100?o:200-o)*100:0),l:bs(o/2),a:bs(s,2)}},XS=function(t){var e=C3e(t);return"hsl("+e.h+", "+e.s+"%, "+e.l+"%)"},T3e=function(t){var e=t.h,n=t.s,s=t.v,o=t.a;e=e/360*6,n/=100,s/=100;var r=Math.floor(e),i=s*(1-n),a=s*(1-(e-r)*n),l=s*(1-(1-e+r)*n),u=r%6;return{r:bs(255*[s,a,i,i,l,s][u]),g:bs(255*[l,s,s,a,i,i][u]),b:bs(255*[i,i,l,s,s,a][u]),a:bs(o,2)}},c0=function(t){var e=t.toString(16);return e.length<2?"0"+e:e},S3e=function(t){var e=t.r,n=t.g,s=t.b,o=t.a,r=o<1?c0(bs(255*o)):"";return"#"+c0(e)+c0(n)+c0(s)+r},N3e=function(t){var e=t.r,n=t.g,s=t.b,o=t.a,r=Math.max(e,n,s),i=r-Math.min(e,n,s),a=i?r===e?(n-s)/i:r===n?2+(s-e)/i:4+(e-n)/i:0;return{h:bs(60*(a<0?a+6:a)),s:bs(r?i/r*100:0),v:bs(r/255*100),a:o}},E3e=Ge.memo(function(t){var e=t.hue,n=t.onChange,s=jA(["react-colorful__hue",t.className]);return Ge.createElement("div",{className:s},Ge.createElement(LW,{onMove:function(o){n({h:360*o.left})},onKey:function(o){n({h:_p(e+360*o.left,0,360)})},"aria-label":"Hue","aria-valuenow":bs(e),"aria-valuemax":"360","aria-valuemin":"0"},Ge.createElement(VW,{className:"react-colorful__hue-pointer",left:e/360,color:XS({h:e,s:100,v:100,a:1})})))}),I3e=Ge.memo(function(t){var e=t.hsva,n=t.onChange,s={backgroundColor:XS({h:e.h,s:100,v:100,a:1})};return Ge.createElement("div",{className:"react-colorful__saturation",style:s},Ge.createElement(LW,{onMove:function(o){n({s:100*o.left,v:100-100*o.top})},onKey:function(o){n({s:_p(e.s+100*o.left,0,100),v:_p(e.v-100*o.top,0,100)})},"aria-label":"Color","aria-valuetext":"Saturation "+bs(e.s)+"%, Brightness "+bs(e.v)+"%"},Ge.createElement(VW,{className:"react-colorful__saturation-pointer",top:1-e.v/100,left:e.s/100,color:XS(e)})))}),zW=function(t,e){if(t===e)return!0;for(var n in t)if(t[n]!==e[n])return!1;return!0},k3e=function(t,e){return t.toLowerCase()===e.toLowerCase()||zW(KS(t),KS(e))};function A3e(t,e,n){var s=WS(n),o=ce.useState(function(){return t.toHsva(e)}),r=o[0],i=o[1],a=ce.useRef({color:e,hsva:r});ce.useEffect(function(){if(!t.equal(e,a.current.color)){var u=t.toHsva(e);a.current={hsva:u,color:e},i(u)}},[e,t]),ce.useEffect(function(){var u;zW(r,a.current.hsva)||t.equal(u=t.fromHsva(r),a.current.color)||(a.current={hsva:r,color:u},s(u))},[r,t,s]);var l=ce.useCallback(function(u){i(function(d){return Object.assign({},d,u)})},[]);return[r,l]}var R3e=typeof window<"u"?ce.useLayoutEffect:ce.useEffect,$3e=function(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:void 0},WP=new Map,D3e=function(t){R3e(function(){var e=t.current?t.current.ownerDocument:document;if(e!==void 0&&!WP.has(e)){var n=e.createElement("style");n.innerHTML=`.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:"";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}`,WP.set(e,n);var s=$3e();s&&n.setAttribute("nonce",s),e.head.appendChild(n)}},[])},_3e=function(t){var e=t.className,n=t.colorModel,s=t.color,o=s===void 0?n.defaultColor:s,r=t.onChange,i=PW(t,["className","colorModel","color","onChange"]),a=ce.useRef(null);D3e(a);var l=A3e(n,o,r),u=l[0],d=l[1],h=jA(["react-colorful",e]);return Ge.createElement("div",sw({},i,{ref:a,className:h}),Ge.createElement(I3e,{hsva:u,onChange:d}),Ge.createElement(E3e,{hue:u.h,onChange:d,className:"react-colorful__last-control"}))},M3e={defaultColor:"000",toHsva:b3e,fromHsva:function(t){return w3e({h:t.h,s:t.s,v:t.v,a:1})},equal:k3e},F3e=function(t){return Ge.createElement(_3e,sw({},t,{colorModel:M3e}))};const O3e=[{name:"Royal Blue",color:"#1e40af"},{name:"Fuchsia",color:"#be185d"},{name:"Emerald",color:"#059669"},{name:"Amber",color:"#eab308"},{name:"Orange",color:"#f97316"},{name:"Purple",color:"#c026d3"},{name:"Ruby Red",color:"#dc2626"},{name:"Silver",color:"#d4d4d8"}],P3e=()=>{const{hairColor:t,setHairColor:e}=xr(),[n,s]=ce.useState(!1),[o,r]=ce.useState(t),i=ce.useRef(null);ce.useEffect(()=>{r(t)},[t]),ce.useEffect(()=>{const u=d=>{n&&i.current&&!i.current.contains(d.target)&&s(!1)};return document.addEventListener("mousedown",u),()=>{document.removeEventListener("mousedown",u)}},[n]);const a=u=>{let d=u.target.value;d.startsWith("#")||(d="#"+d),r(d),/^#([0-9a-f]{3}){1,2}$/i.test(d)&&e(d)},l=u=>{u.stopPropagation(),e(""),s(!1)};return U.jsxs("div",{className:"relative mt-4",ref:i,children:[U.jsxs("button",{onClick:()=>s(!n),className:"w-full flex items-center justify-between p-3 bg-neutral-800 rounded-md border border-neutral-700 hover:bg-neutral-700 transition-colors",children:[U.jsxs("div",{className:"flex items-center gap-3",children:[U.jsx(Uoe,{className:"w-5 h-5 text-neutral-400"}),U.jsx("span",{className:"font-medium text-sm",children:t?`Hair Color: ${t}`:"Add Hair Color (Optional)"})]}),U.jsxs("div",{className:"flex items-center gap-2",children:[t&&U.jsx("button",{onClick:l,className:"text-neutral-500 hover:text-white","aria-label":"Clear color",children:U.jsx(Ooe,{className:"w-4 h-4"})}),U.jsx("div",{className:"w-6 h-6 rounded-full border-2 border-neutral-600",style:{backgroundColor:t||"transparent"}})]})]}),U.jsx(Vr,{children:n&&U.jsx(Tn.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"absolute bottom-full left-0 w-full mb-2 z-20 bg-neutral-900 rounded-lg border border-neutral-700 shadow-xl max-h-96 overflow-y-auto scrollbar-thin",children:U.jsxs("div",{className:"p-4",children:[U.jsx(F3e,{color:t,onChange:e,className:"!w-full"}),U.jsx("div",{className:"relative mt-4",children:U.jsx("input",{type:"text",value:o,onChange:a,className:"w-full bg-neutral-800 border border-neutral-700 rounded-md py-2 pl-3 pr-3 text-white text-sm font-mono focus:ring-2 focus:ring-pink-500 outline-none",maxLength:7,placeholder:"#e.g. ff0000"})}),U.jsx("div",{className:"grid grid-cols-4 gap-2 mt-4",children:O3e.map(({name:u,color:d})=>U.jsxs("button",{onClick:()=>e(d),className:"group flex flex-col items-center justify-center p-2 rounded-md hover:bg-neutral-800 transition-colors","aria-label":`Select color ${u}`,children:[U.jsx("div",{className:ls("w-8 h-8 rounded-full transition-transform group-hover:scale-110 relative border-2",t.toLowerCase()===d.toLowerCase()?"border-white":"border-neutral-700"),style:{backgroundColor:d},children:t.toLowerCase()===d.toLowerCase()&&U.jsx(Foe,{className:"w-4 h-4 text-white absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"})}),U.jsx("span",{className:"text-xs text-neutral-400 mt-1.5 group-hover:text-white",children:u})]},d))})]})})})]})},L3e=({isOpen:t,onClose:e,children:n,title:s,className:o,onAnimationComplete:r})=>U.jsx(Vr,{children:t&&U.jsx(Tn.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-[60] flex items-center justify-center p-4",onClick:e,children:U.jsx(Tn.div,{initial:{scale:.95,y:20},animate:{scale:1,y:0},exit:{scale:.95,y:20},transition:{type:"spring",stiffness:300,damping:30},onClick:i=>i.stopPropagation(),onAnimationComplete:r,className:o,role:"dialog","aria-modal":"true","aria-labelledby":"dialog-title",children:U.jsxs(Uc,{className:"w-full flex flex-col",children:[U.jsxs("header",{className:"flex-shrink-0 p-4 flex items-center justify-between border-b border-neutral-800",children:[U.jsx("h2",{id:"dialog-title",className:"text-lg font-semibold text-white",children:s}),U.jsx(St,{onClick:e,variant:"ghost",size:"icon","aria-label":"Close dialog",children:U.jsx(dd,{className:"h-4 w-4"})})]}),U.jsx("div",{className:"flex-grow p-4",children:n})]})})})});async function V3e(t){return(await fetch(t)).blob()}const z3e=()=>{const{isShareMenuOpen:t,closeShareMenu:e,shareContent:n}=xr(),[s,o]=ce.useState(!1);if(!t||!n)return null;const{url:r,type:i,title:a}=n,l="Check out this hairstyle I created with Barber Booth Pro!",u="https://github.com/google-gemini-v2/codestrela/tree/main/barber-booth",d=async()=>{var x;if(i==="image")try{if(!((x=navigator.clipboard)!=null&&x.write))throw new Error("Clipboard API not supported");const b=await V3e(r);await navigator.clipboard.write([new ClipboardItem({[b.type]:b})]),Ft.success("Image copied to clipboard!")}catch(b){console.error("Failed to copy image:",b),Ft.error("Could not copy image. Please download it instead.")}else Ft.error("Cannot copy video. Please download it to share.")},h=async()=>{if(s)return;if(i==="video"){const w=document.createElement("a");w.href=r,w.download="barber-booth-pro-video.mp4",document.body.appendChild(w),w.click(),document.body.removeChild(w);return}o(!0);let x=2;const b=Ft.loading("Starting upscaler...");try{const{instance:w,scale:C}=await JA();x=C,Ft.loading(`Upscaling image (${x}x)... (0%)`,{id:b});const T=await w.upscale(r,{output:"base64",patchSize:64,padding:2,progress:I=>Ft.loading(`Upscaling... ${Math.round(I*100)}%`,{id:b})});Ft.success("Upscaling complete!",{id:b});const N=document.createElement("a");N.href=T,N.download=`barber-booth-pro-${a.toLowerCase()}-upscaled.jpg`,document.body.appendChild(N),N.click(),document.body.removeChild(N)}catch(w){console.error("Upscaling failed:",w),Ft.error(`Upscaling failed (${x}x). Downloading original image.`,{id:b});const C=document.createElement("a");C.href=r,C.download=`barber-booth-pro-${a.toLowerCase()}.jpg`,document.body.appendChild(C),C.click(),document.body.removeChild(C)}finally{o(!1)}},p=[{name:"Twitter",icon:qoe,url:`https://twitter.com/intent/tweet?text=${encodeURIComponent(l)}&url=${encodeURIComponent(u)}`},{name:"Facebook",icon:Loe,url:`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(u)}`}];return U.jsx(L3e,{isOpen:t,onClose:e,title:`Share ${a}`,className:"w-full max-w-md",children:U.jsxs("div",{className:"flex flex-col gap-4",children:[i==="image"?U.jsx("img",{src:r,alt:a,className:"w-full rounded-lg object-cover aspect-square"}):U.jsx("video",{src:r,controls:!0,autoPlay:!0,loop:!0,muted:!0,className:"w-full rounded-lg"}),U.jsx("p",{className:"text-sm text-center text-neutral-400",children:"To share on social media, please download the file first, then upload it in your post."}),U.jsx("div",{className:"grid grid-cols-2 gap-3",children:p.map(x=>U.jsx("a",{href:x.url,target:"_blank",rel:"noopener noreferrer",className:"w-full",children:U.jsxs(St,{variant:"secondary",className:"w-full",children:[U.jsx(x.icon,{className:"mr-2 h-4 w-4"}),x.name]})},x.name))}),U.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[U.jsxs(St,{onClick:d,variant:"secondary",disabled:i==="video",children:[U.jsx(Poe,{className:"mr-2 h-4 w-4"}),i==="image"?"Copy Image":"Copy (Not supported)"]}),U.jsxs(St,{onClick:h,variant:"primary",disabled:s,children:[U.jsx(zp,{className:"mr-2 h-4 w-4"}),s?"Upscaling...":"Download"]})]})]})})},Pr=["front","left","right","back"],B3e={front:"Front",left:"Left Side",right:"Right Diagonal",back:"Back"},U3e=["A vibrant, rainbow-colored mohawk","Classic 1950s greaser pompadour","Long, flowing elven braids with silver clasps","A sharp, futuristic cyberpunk undercut","Neon pink highlights on a short bob","Messy, sun-bleached surfer hair","Elegant Victorian-era updo with curls","A fiery phoenix-inspired hairstyle","Short, textured French crop","Galaxy-themed hair with swirling blues and purples","A sleek, high-fashion top knot","Viking-style dreadlocks with beads"];function G3e(){const t=xr(),{setUploadedImage:e,setHairstyleDescription:n,setHairstyleReferenceImage:s,setHairstyleReferenceDescription:o,setHairstyleModification:r,setUseMasking:i,setInputMode:a,startGeneration:l,setAngleStatus:u,finishGeneration:d,addToHistory:h,setVideoStatus:p,setVideoUrl:x,setVideoProgress:b,setVideoError:w,openShareMenu:C,setComparisonSourceImage:T,setInstallPromptEvent:N}=xr.getState(),[I,k]=ce.useState(null),[A,$]=ce.useState(null),[M,O]=ce.useState(!1),[F,P]=ce.useState(null),[D,H]=ce.useState(!1),[Z,ne]=ce.useState(!1),[Q,G]=ce.useState(!1),[q,J]=ce.useState(!1),[oe,B]=ce.useState([]),[X,ie]=ce.useState(!1),[re,ye]=ce.useState(!1),[ve,be]=ce.useState(!1),[Re,Ae]=ce.useState([]),De=ce.useRef(null),Ke=ce.useRef(null),Xe=ce.useRef(null);ce.useEffect(()=>{const Ee=Ve=>{Ve.preventDefault(),N(Ve)};return window.addEventListener("beforeinstallprompt",Ee),()=>{window.removeEventListener("beforeinstallprompt",Ee)}},[N]),ce.useEffect(()=>{var ft;const Ee="barber-booth-storage",Ve=localStorage.getItem(Ee);if(Ve)try{const Tt=JSON.parse(Ve),zn=((ft=Tt==null?void 0:Tt.state)==null?void 0:ft.generationHistory)||[];if(zn.length>0){const ir=xr.getState().generationHistory,li=[...zn,...ir],Bn=Array.from(new Map(li.map(Oo=>[Oo.id,Oo])).values());Bn.sort((Oo,Zi)=>Zi.timestamp-Oo.timestamp),xr.getState().setHistory(Bn),localStorage.removeItem(Ee),Ft.success("Found and merged your previous history!")}else localStorage.removeItem(Ee)}catch(Tt){console.error("Failed to migrate old history:",Tt),localStorage.removeItem(Ee)}},[]),ce.useEffect(()=>{const Ee=[...U3e].sort(()=>.5-Math.random());Ae(Ee.slice(0,8))},[]),ce.useEffect(()=>(De.current&&clearTimeout(De.current),re&&t.hairstyleDescription.trim().length>2?De.current=window.setTimeout(async()=>{ie(!0);const Ee=await Wse(t.hairstyleDescription);B(Ee),ie(!1)},500):B([]),()=>{De.current&&clearTimeout(De.current)}),[t.hairstyleDescription,re]);const dt=(Ee,Ve)=>{J(!0);const ft=new FileReader;ft.onloadend=()=>{k(ft.result),$(Ve),J(!1)},ft.onerror=()=>{Ft.error("Failed to read the selected file."),J(!1)},ft.readAsDataURL(Ee)},wt=Ee=>{var Ve;(Ve=Ee.target.files)!=null&&Ve[0]&&(dt(Ee.target.files[0],"client"),Ee.target.value="")},$t=Ee=>{var Ve;(Ve=Ee.target.files)!=null&&Ve[0]&&(dt(Ee.target.files[0],"reference"),Ee.target.value="")},It=Ee=>{A==="client"?e(Ee):A==="reference"&&s(Ee),k(null),$(null),P(null)},Ct=()=>{k(null),$(null),P(null)},it=Ee=>{P(Ee),O(!0)},Dt=()=>{var Ee,Ve;F==="client"?(Ee=Ke.current)==null||Ee.click():(Ve=Xe.current)==null||Ve.click(),O(!1)},js=()=>{O(!1),H(!0)},an=Ee=>{H(!1),k(Ee),$(F)},Vs=Ee=>{n(Ee),a("text"),s(null),o(""),r(""),B([]),ye(!1)},Qn=ce.useCallback(async(Ee,Ve)=>{if(t.uploadedImage)try{const ft=await LC(t.uploadedImage),Tt=t.hairstyleReferenceImage?await LC(t.hairstyleReferenceImage):null,zn={};await Promise.all(Pr.map(async li=>{const Bn=Ee[li];(Bn==null?void 0:Bn.status)==="done"&&Bn.url?zn[li]={...Bn,url:await LC(Bn.url)}:zn[li]=Bn}));const ir={id:crypto.randomUUID(),timestamp:Date.now(),uploadedImage:ft,hairstyleDescription:t.hairstyleDescription,hairstyleReferenceImage:Tt,hairstyleReferenceDescription:t.hairstyleReferenceDescription,hairstyleModification:t.hairstyleModification,hairColor:t.hairColor,useMasking:t.hairstyleReferenceImage?t.useMasking:!1,generatedImages:zn,generatedVideoUrl:Ve||void 0};h(ir),Ft.success("Saved to history!")}catch(ft){console.error("Failed to save history item:",ft),Ft.error("Could not save to history.")}},[t.uploadedImage,t.hairstyleDescription,t.hairstyleReferenceImage,t.hairstyleReferenceDescription,t.hairstyleModification,t.hairColor,t.useMasking,h]),go=async()=>{if(!(!t.uploadedImage||!t.hairstyleDescription.trim()&&!t.hairstyleReferenceImage&&!t.hairColor.trim())){T(t.uploadedImage),l();try{const Ee=await qse({dataUrl:t.uploadedImage},{description:t.hairstyleDescription,referenceImage:t.hairstyleReferenceImage,referenceDescription:t.hairstyleReferenceDescription,modification:t.hairstyleModification,useMasking:t.hairstyleReferenceImage?t.useMasking:!1,hairColor:t.hairColor}),Ve=await Use(Ee),ft={};for(const Tt of Pr)if(Ve[Tt])u(Tt,"done",Ve[Tt]),ft[Tt]={status:"done",url:Ve[Tt]};else throw new Error(`Cropped image for angle '${Tt}' was not found.`);await Qn(ft)}catch(Ee){const Ve=Ee instanceof Error?Ee.message:"An unknown error occurred.";console.error("Failed to generate 4-up grid:",Ee);for(const ft of Pr)u(ft,"error",void 0,Ve)}finally{d()}}},Ts=async()=>{t.isGenerating||await go()},yo=async()=>{const Ee=t.generatedImages.front;if((Ee==null?void 0:Ee.status)!=="done"||!Ee.url){Ft.error("Front image must be generated first.");return}const Ve=t.hairstyleReferenceDescription.trim()||t.hairstyleDescription.trim();if(!Ve){Ft.error("A text description is required for video generation.");return}p("generating"),x(null),w(""),b("Initializing video generation...");try{const ft=await Kse({dataUrl:Ee.url},Ve,Tt=>b(Tt));x(ft),p("done"),await Qn(t.generatedImages,ft)}catch(ft){const Tt=ft instanceof Error?ft.message:"An unknown video error occurred.";w(Tt),p("error")}},Ss=async()=>{if(Z)return;ne(!0);let Ee=2;const Ve=Ft.loading("Preparing 4-up sheet...");try{const ft=Pr.reduce((Oo,Zi)=>{const ar=t.generatedImages[Zi];return(ar==null?void 0:ar.status)==="done"&&ar.url&&(Oo[Zi]=ar.url),Oo},{});if(Object.keys(ft).length<Pr.length){Ft.error("Please wait for all images to finish generating.",{id:Ve});return}const Tt=await EF(ft),{instance:zn,scale:ir}=await JA();Ee=ir,Ft.loading(`Upscaling 4-up sheet (${Ee}x)... (0%)`,{id:Ve});const li=await zn.upscale(Tt,{output:"base64",patchSize:64,padding:2,progress:Oo=>Ft.loading(`Upscaling... ${Math.round(Oo*100)}%`,{id:Ve})});Ft.success("Upscaling complete!",{id:Ve});const Bn=document.createElement("a");Bn.href=li,Bn.download="barber-booth-pro-4-up-upscaled.jpg",document.body.appendChild(Bn),Bn.click(),document.body.removeChild(Bn)}catch(ft){console.error("Error creating or upscaling 4-up sheet:",ft),Ft.error(`Error creating/upscaling sheet (${Ee}x).`,{id:Ve})}finally{ne(!1)}},jt=async()=>{G(!0);try{const Ee=Pr.reduce((ft,Tt)=>{const zn=t.generatedImages[Tt];return(zn==null?void 0:zn.status)==="done"&&zn.url&&(ft[Tt]=zn.url),ft},{});if(Object.keys(Ee).length<Pr.length){Ft.error("Please wait for all images to finish generating.");return}const Ve=await EF(Ee);await zN({url:Ve,title:"4-Up Result",type:"image"},()=>C({url:Ve,title:"4-Up Result",type:"image"}))}catch(Ee){console.error("Error sharing 4-up sheet:",Ee),Ft.error("Error creating 4-up sheet for sharing.")}finally{G(!1)}},Rn=Pr.every(Ee=>{var Ve;return((Ve=t.generatedImages[Ee])==null?void 0:Ve.status)==="done"}),ln=Pr.some(Ee=>{var Ve;return((Ve=t.generatedImages[Ee])==null?void 0:Ve.status)==="error"}),ul=Rn||ln,cl=()=>{switch(t.appState){case"idle":return U.jsx(Uc,{onClick:()=>it("client"),className:"w-full max-w-sm aspect-square flex flex-col items-center justify-center cursor-pointer group hover:border-pink-500/50 transition-colors duration-300",children:U.jsxs(Tn.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.2,type:"spring",stiffness:260,damping:20},children:[U.jsx(DF,{className:"h-24 w-24 text-neutral-600 group-hover:text-pink-400 transition-colors"}),U.jsx("p",{className:"mt-4 text-xl font-semibold text-neutral-300 group-hover:text-white",children:"Upload Your Photo"}),U.jsx("p",{className:"text-sm text-neutral-500",children:"to get started"})]})});case"image-uploaded":return U.jsxs(Tn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-lg",children:[U.jsxs("div",{className:"flex justify-center mb-6 relative group",children:[U.jsx("img",{src:t.uploadedImage,alt:"Your photo",className:"w-40 h-40 rounded-full object-cover border-4 border-neutral-700 shadow-lg"}),U.jsx("button",{onClick:()=>it("client"),className:"absolute inset-0 bg-black/60 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:U.jsx(BC,{className:"w-8 h-8 text-white"})})]}),U.jsx(Uc,{children:U.jsxs(PN,{className:"p-4 sm:p-6",children:[U.jsxs("div",{className:"flex bg-neutral-800 p-1 rounded-md mb-4",children:[U.jsx("button",{onClick:()=>a("text"),className:ls("w-1/2 py-2 text-sm font-semibold rounded-md transition-colors",t.inputMode==="text"?"bg-indigo-600 text-white":"text-neutral-400 hover:bg-neutral-700"),children:"Text Prompt"}),U.jsx("button",{onClick:()=>a("image"),className:ls("w-1/2 py-2 text-sm font-semibold rounded-md transition-colors",t.inputMode==="image"?"bg-indigo-600 text-white":"text-neutral-400 hover:bg-neutral-700"),children:"Reference Image"})]}),U.jsx(Vr,{mode:"wait",children:U.jsxs(Tn.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:[t.inputMode==="text"?U.jsxs("div",{className:"relative",children:[U.jsx("textarea",{value:t.hairstyleDescription,onChange:Ee=>{n(Ee.target.value),be(!1)},onFocus:()=>{ye(!0),be(!1)},onBlur:()=>setTimeout(()=>ye(!1),200),placeholder:"e.g., a neon pink mohawk",className:"w-full h-28 p-3 bg-neutral-800 rounded-md border border-neutral-700 focus:ring-2 focus:ring-pink-500 focus:border-pink-500 outline-none transition-all resize-none"}),U.jsx(Vr,{children:!ve&&(X||oe.length>0||re&&t.hairstyleDescription.length<3)&&U.jsxs(Tn.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"absolute top-full left-0 w-full bg-neutral-800/90 backdrop-blur-sm border border-neutral-700 rounded-b-md shadow-lg z-10",children:[U.jsx("button",{onClick:()=>be(!0),className:"absolute top-2 right-2 text-neutral-500 hover:text-white z-20 p-1 rounded-full hover:bg-neutral-700","aria-label":"Close suggestions",children:U.jsx(dd,{className:"w-4 h-4"})}),U.jsxs("div",{className:"max-h-60 overflow-y-auto scrollbar-thin",children:[U.jsx("p",{className:"px-4 pt-3 pb-1 text-xs text-neutral-400 font-semibold uppercase tracking-wider sticky top-0 bg-neutral-800/90 backdrop-blur-sm",children:oe.length>0?"AI Suggestions":"Quick Ideas"}),X?U.jsx(dp,{className:"p-4"}):(oe.length>0?oe:Re).map(Ee=>U.jsxs("button",{onMouseDown:()=>Vs(Ee),className:"flex items-center w-full text-left px-4 py-2 hover:bg-indigo-600/50 text-sm",children:[oe.length>0?U.jsx(Ky,{className:"w-4 h-4 mr-3 text-pink-400 flex-shrink-0"}):U.jsx(Boe,{className:"w-4 h-4 mr-3 text-yellow-400 flex-shrink-0"}),U.jsx("span",{className:"flex-grow",children:Ee})]},Ee))]})]})})]}):U.jsxs("div",{className:"space-y-4",children:[t.hairstyleReferenceImage?U.jsxs("div",{className:"relative group aspect-square w-full rounded-md overflow-hidden",children:[U.jsx("img",{src:t.hairstyleReferenceImage,alt:"Hairstyle reference",className:"w-full h-full object-cover"}),U.jsxs("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-4",children:[U.jsxs(St,{onClick:()=>it("reference"),variant:"secondary",size:"sm",children:[U.jsx(BC,{className:"mr-2 h-4 w-4"}),"Change"]}),U.jsxs(St,{onClick:()=>s(null),variant:"destructive",size:"sm",children:[U.jsx(hV,{className:"mr-2 h-4 w-4"}),"Remove"]})]})]}):U.jsxs("button",{onClick:()=>it("reference"),className:"w-full aspect-square flex flex-col items-center justify-center bg-neutral-800 rounded-md border-2 border-dashed border-neutral-700 hover:border-pink-500 transition-colors",children:[U.jsx(_F,{className:"w-8 h-8 text-neutral-500 mb-2"}),U.jsx("span",{className:"text-sm font-semibold",children:"Upload Reference"}),U.jsx("span",{className:"text-xs text-neutral-500",children:"Click or Drag & Drop"})]}),U.jsx("textarea",{value:t.hairstyleReferenceDescription,onChange:Ee=>o(Ee.target.value),placeholder:"Describe the hairstyle (optional but recommended)",className:"w-full p-3 bg-neutral-800 rounded-md border border-neutral-700 focus:ring-2 focus:ring-pink-500 outline-none transition-all resize-none text-sm",rows:2}),U.jsx("textarea",{value:t.hairstyleModification,onChange:Ee=>r(Ee.target.value),placeholder:"Any modifications? (e.g., 'make it shorter', 'add blonde highlights')",className:"w-full p-3 bg-neutral-800 rounded-md border border-neutral-700 focus:ring-2 focus:ring-pink-500 outline-none transition-all resize-none text-sm",rows:2}),t.hairstyleReferenceImage&&U.jsxs("div",{className:"flex items-center justify-between p-2 bg-neutral-800 rounded-md",children:[U.jsxs("label",{htmlFor:"masking-toggle",className:"text-sm font-medium text-neutral-300",children:["High-Fidelity Mode",U.jsx("p",{className:"text-xs text-neutral-500",children:"Best for precise style transfers."})]}),U.jsx("button",{role:"switch","aria-checked":t.useMasking,onClick:()=>i(!t.useMasking),id:"masking-toggle",className:ls("relative inline-flex h-6 w-11 items-center rounded-full transition-colors",t.useMasking?"bg-indigo-600":"bg-neutral-700"),children:U.jsx("span",{className:ls("inline-block h-4 w-4 transform rounded-full bg-white transition-transform",t.useMasking?"translate-x-6":"translate-x-1")})})]})]}),U.jsx(P3e,{})]},t.inputMode)})]})}),U.jsxs("div",{className:"flex items-center justify-between mt-6",children:[U.jsx(St,{variant:"ghost",onClick:()=>e(null),children:"Start Over"}),U.jsxs(St,{onClick:go,disabled:!t.uploadedImage||!t.hairstyleDescription.trim()&&!t.hairstyleReferenceImage&&!t.hairColor.trim()||t.isGenerating,size:"lg",children:[U.jsx(Ky,{className:"mr-2 h-5 w-5"}),t.isGenerating?"Generating...":"Generate Pro"]})]})]});case"generating-results":return U.jsxs(Tn.div,{initial:{opacity:0},animate:{opacity:1},className:"w-full max-w-screen-xl",children:[U.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6",children:Pr.map(Ee=>{const Ve=t.generatedImages[Ee];return U.jsx(o3e,{angle:Ee,caption:B3e[Ee],status:(Ve==null?void 0:Ve.status)??"pending",imageUrl:Ve==null?void 0:Ve.url,error:Ve==null?void 0:Ve.error,onRegenerate:Ts},Ee)})}),U.jsx(Vr,{children:ul&&U.jsxs(Tn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"flex flex-col sm:flex-row items-center justify-center gap-4 mt-8",children:[U.jsxs(St,{variant:"ghost",onClick:()=>e(t.uploadedImage),children:[U.jsx(BC,{className:"mr-2 h-4 w-4"}),"New Style"]}),ln?U.jsxs(St,{onClick:Ts,size:"lg",disabled:t.isGenerating,children:[U.jsx(Ky,{className:"mr-2 h-4 w-4"}),t.isGenerating?"Regenerating...":"Try Again"]}):U.jsxs(U.Fragment,{children:[U.jsxs(St,{variant:"secondary",onClick:Ss,disabled:Z,children:[U.jsx(zp,{className:"mr-2 h-4 w-4"}),Z?"Upscaling...":"Download 4-Up"]}),U.jsxs(St,{variant:"secondary",onClick:jt,disabled:Q,children:[U.jsx(LN,{className:"mr-2 h-4 w-4"}),Q?"Sharing...":"Share 4-Up"]})]})]})}),Rn&&!ln&&U.jsx("div",{className:"flex justify-center mt-6",children:U.jsxs(St,{onClick:yo,size:"lg",disabled:t.videoStatus==="generating",children:[U.jsx(Ky,{className:"mr-2 h-4 w-4"}),t.videoStatus==="generating"?"Creating Video...":"Create 360 Video"]})}),t.videoStatus!=="idle"&&U.jsx(Tn.div,{className:"mt-8 w-full max-w-xl mx-auto",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:U.jsx(v3e,{status:t.videoStatus,progressMessage:t.videoProgress,videoUrl:t.videoUrl,error:t.videoError,onClear:()=>p("idle")})})]})}};return U.jsxs("div",{className:"bg-neutral-950 text-slate-100 min-h-screen font-sans antialiased pb-24",children:[U.jsx("input",{type:"file",ref:Ke,onChange:wt,className:"hidden",accept:"image/png, image/jpeg, image/webp"}),U.jsx("input",{type:"file",ref:Xe,onChange:$t,className:"hidden",accept:"image/png, image/jpeg, image/webp"}),U.jsx("header",{className:"fixed top-0 left-0 right-0 bg-neutral-950/50 backdrop-blur-sm p-3 z-50 border-b border-neutral-800",children:U.jsxs("div",{className:"max-w-screen-xl mx-auto flex justify-between items-center px-4",children:[U.jsxs("div",{className:"flex items-center gap-3",children:[U.jsxs("div",{className:"relative w-12 h-12 flex items-center justify-center rounded-xl bg-gradient-to-br from-pink-500/80 to-purple-600/80 shadow-md overflow-hidden",role:"img","aria-label":"Barber Booth Pro Logo",children:[U.jsx("span",{className:"absolute text-4xl transform -rotate-[20deg] -translate-x-1.5 translate-y-0.5","aria-hidden":"true",children:""}),U.jsx("span",{className:"absolute text-4xl transform rotate-[20deg] translate-x-1","aria-hidden":"true",children:""})]}),U.jsxs("h1",{className:"text-2xl font-bold tracking-tight",children:["Barber ",U.jsx("span",{className:"text-pink-400",children:"Booth"})," Pro"]})]}),U.jsxs(St,{variant:"secondary",onClick:()=>xr.getState().setHistoryPanelOpen(!0),children:[U.jsx(zoe,{className:"mr-2 h-4 w-4"}),"History (",t.generationHistory.length,")"]})]})}),U.jsx("main",{className:"container mx-auto px-4 pt-28 flex flex-col items-center justify-start min-h-screen",children:U.jsx(Vr,{mode:"wait",children:cl()})}),U.jsx(r3e,{}),U.jsx(y3e,{}),U.jsx(z3e,{}),U.jsxs(Vr,{children:[q&&U.jsx(Tn.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-[100] flex flex-col items-center justify-center",children:U.jsx(dp,{message:"Processing image..."})}),I&&A&&U.jsx(m3e,{imageSrc:I,onSave:It,onCancel:Ct,title:A==="client"?"Crop Your Photo":"Crop Reference Image"}),D&&U.jsx(g3e,{onCapture:an,onCancel:()=>H(!1)})]}),U.jsx(Vr,{children:M&&U.jsx(Tn.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>O(!1),children:U.jsxs(Tn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},onClick:Ee=>Ee.stopPropagation(),className:"bg-neutral-900 rounded-xl p-6 w-full max-w-sm border border-neutral-700",children:[U.jsx("h3",{className:"text-center font-semibold text-xl text-white mb-2",children:"Choose Source"}),U.jsx("p",{className:"text-center text-sm text-neutral-400 mb-6",children:"Select a photo to get started."}),U.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[U.jsxs("button",{onClick:Dt,className:"group flex flex-col items-center justify-center p-6 bg-neutral-800 rounded-lg border border-neutral-700/80 hover:bg-neutral-700/60 hover:border-pink-500/50 transition-all duration-300 transform hover:-translate-y-1",children:[U.jsx(_F,{className:"w-10 h-10 mb-3 text-pink-400 transition-transform group-hover:scale-110"}),U.jsx("span",{className:"font-semibold text-white",children:"From File"}),U.jsx("span",{className:"text-xs text-neutral-400 mt-1",children:"Choose from your device"})]}),U.jsxs("button",{onClick:js,className:"group flex flex-col items-center justify-center p-6 bg-neutral-800 rounded-lg border border-neutral-700/80 hover:bg-neutral-700/60 hover:border-pink-500/50 transition-all duration-300 transform hover:-translate-y-1",children:[U.jsx(DF,{className:"w-10 h-10 mb-3 text-indigo-400 transition-transform group-hover:scale-110"}),U.jsx("span",{className:"font-semibold text-white",children:"Take Photo"}),U.jsx("span",{className:"text-xs text-neutral-400 mt-1",children:"Use your camera"})]})]})]})})})]})}const BW=document.getElementById("root");if(!BW)throw new Error("Could not find root element to mount to");const H3e=p5.createRoot(BW);H3e.render(U.jsxs(Ge.StrictMode,{children:[U.jsx(G3e,{}),U.jsx(Qre,{position:"bottom-center",toastOptions:{style:{background:"linear-gradient(to right, #1e1b4b, #312e81)",color:"#e2e8f0",border:"1px solid #4f46e5"}}})]}));
